<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: rename modulo to remainder and clarify - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/2bafbd817bba30e4e8fbd91f420fa3a679526398.html">2bafbd817bba30e4e8fbd91f420fa3a679526398</a>
<b>parent</b> <a href="../commit/e278382bfefb90175c53d5e6e4de47b42942ccf2.html">e278382bfefb90175c53d5e6e4de47b42942ccf2</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat, 20 Jul 2024 11:11:24 +0200

sql: rename modulo to remainder and clarify

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">docs/sql.md</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/sql/parser/ast.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/parser/parser.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/planner/planner.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">src/sql/testscripts/expressions/op_math_modulo</a></td><td> | </td><td class="num">68</td><td><span class="i"></span><span class="d">--------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">src/sql/testscripts/expressions/op_math_remainder</a></td><td> | </td><td class="num">71</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/types/expression.rs</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/types/value.rs</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++</span><span class="d">--</span></td></tr>
</table></pre><pre>8 files changed, 91 insertions(+), 85 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/docs/sql.md.html">docs/sql.md</a> b/<a href="../file/docs/sql.md.html">docs/sql.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -125,7 +125,7 @@ Binary operators:
</a> * `*`: multiplication, e.g. `3 * 2` yields `6`.
 * `/`: division, e.g. `6 / 2` yields `3`.
 * `^`: exponentiation, e.g. `2 ^ 4` yields `16`.
<a href="#h0-0-3" id="h0-0-3" class="d">-* `%`: modulo or remainder, e.g. `8 % 3` yields `2`. The result has the sign of the divisor.
</a><a href="#h0-0-4" id="h0-0-4" class="i">+* `%`: remainder, e.g. `8 % 3` yields `2`. Unlike modulo, the result has the sign of the dividend.
</a> 
 Unary operators:
 
<b>diff --git a/<a id="h1" href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a> b/<a href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -177,9 +177,9 @@ pub enum Operator {
</a>     Exponentiate(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
     Factorial(Box&lt;Expression&gt;),
     Identity(Box&lt;Expression&gt;),
<a href="#h1-0-3" id="h1-0-3" class="d">-    Modulo(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
</a>     Multiply(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
     Negate(Box&lt;Expression&gt;),
<a href="#h1-0-6" id="h1-0-6" class="i">+    Remainder(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
</a>     Subtract(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
 
     Like(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
<a href="#h1-1" id="h1-1" class="h">@@ -204,10 +204,10 @@ impl Expression {
</a>             | Self::Operator(LessThan(lhs, rhs))
             | Self::Operator(LessThanOrEqual(lhs, rhs))
             | Self::Operator(Like(lhs, rhs))
<a href="#h1-1-3" id="h1-1-3" class="d">-            | Self::Operator(Modulo(lhs, rhs))
</a>             | Self::Operator(Multiply(lhs, rhs))
             | Self::Operator(NotEqual(lhs, rhs))
             | Self::Operator(Or(lhs, rhs))
<a href="#h1-1-7" id="h1-1-7" class="i">+            | Self::Operator(Remainder(lhs, rhs))
</a>             | Self::Operator(Subtract(lhs, rhs)) =&gt; lhs.walk(visitor) &amp;&amp; rhs.walk(visitor),
 
             Self::Operator(Factorial(expr))
<a href="#h1-2" id="h1-2" class="h">@@ -248,10 +248,10 @@ impl Expression {
</a>             | Self::Operator(LessThan(lhs, rhs))
             | Self::Operator(LessThanOrEqual(lhs, rhs))
             | Self::Operator(Like(lhs, rhs))
<a href="#h1-2-3" id="h1-2-3" class="d">-            | Self::Operator(Modulo(lhs, rhs))
</a>             | Self::Operator(Multiply(lhs, rhs))
             | Self::Operator(NotEqual(lhs, rhs))
             | Self::Operator(Or(lhs, rhs))
<a href="#h1-2-7" id="h1-2-7" class="i">+            | Self::Operator(Remainder(lhs, rhs))
</a>             | Self::Operator(Subtract(lhs, rhs)) =&gt; {
                 lhs.collect(visitor, c);
                 rhs.collect(visitor, c);
<b>diff --git a/<a id="h2" href="../file/src/sql/parser/parser.rs.html">src/sql/parser/parser.rs</a> b/<a href="../file/src/sql/parser/parser.rs.html">src/sql/parser/parser.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -597,7 +597,7 @@ impl&lt;&#39;a&gt; Parser&lt;&#39;a&gt; {
</a>                 Token::LessThanOrEqual =&gt; InfixOperator::LessThanOrEqual,
                 Token::Minus =&gt; InfixOperator::Subtract,
                 Token::NotEqual =&gt; InfixOperator::NotEqual,
<a href="#h2-0-3" id="h2-0-3" class="d">-                Token::Percent =&gt; InfixOperator::Modulo,
</a><a href="#h2-0-4" id="h2-0-4" class="i">+                Token::Percent =&gt; InfixOperator::Remainder,
</a>                 Token::Plus =&gt; InfixOperator::Add,
                 Token::Slash =&gt; InfixOperator::Divide,
                 _ =&gt; return None,
<a href="#h2-1" id="h2-1" class="h">@@ -688,10 +688,10 @@ enum InfixOperator {
</a>     LessThan,
     LessThanOrEqual,
     Like,
<a href="#h2-1-3" id="h2-1-3" class="d">-    Modulo,
</a>     Multiply,
     NotEqual,
     Or,
<a href="#h2-1-7" id="h2-1-7" class="i">+    Remainder,
</a>     Subtract,
 }
 
<a href="#h2-2" id="h2-2" class="h">@@ -707,7 +707,7 @@ impl InfixOperator {
</a>             | Self::LessThan
             | Self::LessThanOrEqual =&gt; 4,
             Self::Add | Self::Subtract =&gt; 5,
<a href="#h2-2-3" id="h2-2-3" class="d">-            Self::Multiply | Self::Divide | Self::Modulo =&gt; 6,
</a><a href="#h2-2-4" id="h2-2-4" class="i">+            Self::Multiply | Self::Divide | Self::Remainder =&gt; 6,
</a>             Self::Exponentiate =&gt; 7,
         }
     }
<a href="#h2-3" id="h2-3" class="h">@@ -734,10 +734,10 @@ impl InfixOperator {
</a>             Self::LessThan =&gt; ast::Operator::LessThan(lhs, rhs).into(),
             Self::LessThanOrEqual =&gt; ast::Operator::LessThanOrEqual(lhs, rhs).into(),
             Self::Like =&gt; ast::Operator::Like(lhs, rhs).into(),
<a href="#h2-3-3" id="h2-3-3" class="d">-            Self::Modulo =&gt; ast::Operator::Modulo(lhs, rhs).into(),
</a>             Self::Multiply =&gt; ast::Operator::Multiply(lhs, rhs).into(),
             Self::NotEqual =&gt; ast::Operator::NotEqual(lhs, rhs).into(),
             Self::Or =&gt; ast::Operator::Or(lhs, rhs).into(),
<a href="#h2-3-7" id="h2-3-7" class="i">+            Self::Remainder =&gt; ast::Operator::Remainder(lhs, rhs).into(),
</a>             Self::Subtract =&gt; ast::Operator::Subtract(lhs, rhs).into(),
         }
     }
<b>diff --git a/<a id="h3" href="../file/src/sql/planner/planner.rs.html">src/sql/planner/planner.rs</a> b/<a href="../file/src/sql/planner/planner.rs.html">src/sql/planner/planner.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -544,7 +544,7 @@ impl&lt;&#39;a, C: Catalog&gt; Planner&lt;&#39;a, C&gt; {
</a>                 ast::Operator::Exponentiate(lhs, rhs) =&gt; Exponentiate(build(lhs)?, build(rhs)?),
                 ast::Operator::Factorial(expr) =&gt; Factorial(build(expr)?),
                 ast::Operator::Identity(expr) =&gt; Identity(build(expr)?),
<a href="#h3-0-3" id="h3-0-3" class="d">-                ast::Operator::Modulo(lhs, rhs) =&gt; Modulo(build(lhs)?, build(rhs)?),
</a><a href="#h3-0-4" id="h3-0-4" class="i">+                ast::Operator::Remainder(lhs, rhs) =&gt; Remainder(build(lhs)?, build(rhs)?),
</a>                 ast::Operator::Multiply(lhs, rhs) =&gt; Multiply(build(lhs)?, build(rhs)?),
                 ast::Operator::Negate(expr) =&gt; Negate(build(expr)?),
                 ast::Operator::Subtract(lhs, rhs) =&gt; Subtract(build(lhs)?, build(rhs)?),
<b>diff --git a/<a id="h4" href="../file/src/sql/testscripts/expressions/op_math_modulo.html">src/sql/testscripts/expressions/op_math_modulo</a> b/<a href="../file/src/sql/testscripts/expressions/op_math_modulo.html">src/sql/testscripts/expressions/op_math_modulo</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,68 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-# Tests the % remainder operator.
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-# Integers.
</a><a href="#h4-0-3" id="h4-0-3" class="d">-[expr]&gt; 5 % 3
</a><a href="#h4-0-4" id="h4-0-4" class="d">-[expr]&gt; -5 % 3
</a><a href="#h4-0-5" id="h4-0-5" class="d">-[expr]&gt; 5 % -3
</a><a href="#h4-0-6" id="h4-0-6" class="d">----
</a><a href="#h4-0-7" id="h4-0-7" class="d">-Integer(2) ← Modulo(Constant(Integer(5)), Constant(Integer(3)))
</a><a href="#h4-0-8" id="h4-0-8" class="d">-Integer(-2) ← Modulo(Negate(Constant(Integer(5))), Constant(Integer(3)))
</a><a href="#h4-0-9" id="h4-0-9" class="d">-Integer(2) ← Modulo(Constant(Integer(5)), Negate(Constant(Integer(3))))
</a><a href="#h4-0-10" id="h4-0-10" class="d">-
</a><a href="#h4-0-11" id="h4-0-11" class="d">-# Floats.
</a><a href="#h4-0-12" id="h4-0-12" class="d">-[expr]&gt; 6.28 % 2.2
</a><a href="#h4-0-13" id="h4-0-13" class="d">-[expr]&gt; 6.28 % -2.2
</a><a href="#h4-0-14" id="h4-0-14" class="d">----
</a><a href="#h4-0-15" id="h4-0-15" class="d">-Float(1.88) ← Modulo(Constant(Float(6.28)), Constant(Float(2.2)))
</a><a href="#h4-0-16" id="h4-0-16" class="d">-Float(1.88) ← Modulo(Constant(Float(6.28)), Negate(Constant(Float(2.2))))
</a><a href="#h4-0-17" id="h4-0-17" class="d">-
</a><a href="#h4-0-18" id="h4-0-18" class="d">-# Mixed.
</a><a href="#h4-0-19" id="h4-0-19" class="d">-&gt; 3.15 % 2
</a><a href="#h4-0-20" id="h4-0-20" class="d">-&gt; 6 % 3.15
</a><a href="#h4-0-21" id="h4-0-21" class="d">-&gt; 3.15 % -2
</a><a href="#h4-0-22" id="h4-0-22" class="d">----
</a><a href="#h4-0-23" id="h4-0-23" class="d">-Float(1.15)
</a><a href="#h4-0-24" id="h4-0-24" class="d">-Float(2.85)
</a><a href="#h4-0-25" id="h4-0-25" class="d">-Float(1.15)
</a><a href="#h4-0-26" id="h4-0-26" class="d">-
</a><a href="#h4-0-27" id="h4-0-27" class="d">-# Division by zero.
</a><a href="#h4-0-28" id="h4-0-28" class="d">-!&gt; 7 % 0
</a><a href="#h4-0-29" id="h4-0-29" class="d">-&gt; 6.28 % 0.0
</a><a href="#h4-0-30" id="h4-0-30" class="d">----
</a><a href="#h4-0-31" id="h4-0-31" class="d">-Error: invalid input: can&#39;t divide by zero
</a><a href="#h4-0-32" id="h4-0-32" class="d">-Float(NaN)
</a><a href="#h4-0-33" id="h4-0-33" class="d">-
</a><a href="#h4-0-34" id="h4-0-34" class="d">-# NULLs.
</a><a href="#h4-0-35" id="h4-0-35" class="d">-&gt; 1 % NULL
</a><a href="#h4-0-36" id="h4-0-36" class="d">-&gt; NULL % 3
</a><a href="#h4-0-37" id="h4-0-37" class="d">-&gt; 3.14 % NULL
</a><a href="#h4-0-38" id="h4-0-38" class="d">-&gt; NULL % NULL
</a><a href="#h4-0-39" id="h4-0-39" class="d">----
</a><a href="#h4-0-40" id="h4-0-40" class="d">-Null
</a><a href="#h4-0-41" id="h4-0-41" class="d">-Null
</a><a href="#h4-0-42" id="h4-0-42" class="d">-Null
</a><a href="#h4-0-43" id="h4-0-43" class="d">-Null
</a><a href="#h4-0-44" id="h4-0-44" class="d">-
</a><a href="#h4-0-45" id="h4-0-45" class="d">-# Infinity and NaN.
</a><a href="#h4-0-46" id="h4-0-46" class="d">-&gt; INFINITY % 7
</a><a href="#h4-0-47" id="h4-0-47" class="d">-&gt; 7 % INFINITY
</a><a href="#h4-0-48" id="h4-0-48" class="d">-&gt; 7 % -INFINITY
</a><a href="#h4-0-49" id="h4-0-49" class="d">-&gt; INFINITY % INFINITY
</a><a href="#h4-0-50" id="h4-0-50" class="d">-&gt; 7 % NAN
</a><a href="#h4-0-51" id="h4-0-51" class="d">-&gt; NAN % 7
</a><a href="#h4-0-52" id="h4-0-52" class="d">-&gt; NAN % NAN
</a><a href="#h4-0-53" id="h4-0-53" class="d">----
</a><a href="#h4-0-54" id="h4-0-54" class="d">-Float(NaN)
</a><a href="#h4-0-55" id="h4-0-55" class="d">-Float(7.0)
</a><a href="#h4-0-56" id="h4-0-56" class="d">-Float(7.0)
</a><a href="#h4-0-57" id="h4-0-57" class="d">-Float(NaN)
</a><a href="#h4-0-58" id="h4-0-58" class="d">-Float(NaN)
</a><a href="#h4-0-59" id="h4-0-59" class="d">-Float(NaN)
</a><a href="#h4-0-60" id="h4-0-60" class="d">-Float(NaN)
</a><a href="#h4-0-61" id="h4-0-61" class="d">-
</a><a href="#h4-0-62" id="h4-0-62" class="d">-# Bools and strings.
</a><a href="#h4-0-63" id="h4-0-63" class="d">-!&gt; TRUE % FALSE
</a><a href="#h4-0-64" id="h4-0-64" class="d">-!&gt; &#39;a&#39; % &#39;b&#39;
</a><a href="#h4-0-65" id="h4-0-65" class="d">----
</a><a href="#h4-0-66" id="h4-0-66" class="d">-Error: invalid input: can&#39;t take modulo of TRUE and FALSE
</a><a href="#h4-0-67" id="h4-0-67" class="d">-Error: invalid input: can&#39;t take modulo of a and b
</a><b>diff --git a/<a id="h5" href="../file/src/sql/testscripts/expressions/op_math_remainder.html">src/sql/testscripts/expressions/op_math_remainder</a> b/<a href="../file/src/sql/testscripts/expressions/op_math_remainder.html">src/sql/testscripts/expressions/op_math_remainder</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,71 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+# Tests the % remainder operator.
</a><a href="#h5-0-1" id="h5-0-1" class="i">+#
</a><a href="#h5-0-2" id="h5-0-2" class="i">+# Note that remainder is not the same as modulo: the former has the sign of the
</a><a href="#h5-0-3" id="h5-0-3" class="i">+# dividend, while the latter always has a positive value.
</a><a href="#h5-0-4" id="h5-0-4" class="i">+
</a><a href="#h5-0-5" id="h5-0-5" class="i">+# Integers.
</a><a href="#h5-0-6" id="h5-0-6" class="i">+[expr]&gt; 5 % 3
</a><a href="#h5-0-7" id="h5-0-7" class="i">+[expr]&gt; -5 % 3
</a><a href="#h5-0-8" id="h5-0-8" class="i">+[expr]&gt; 5 % -3
</a><a href="#h5-0-9" id="h5-0-9" class="i">+---
</a><a href="#h5-0-10" id="h5-0-10" class="i">+Integer(2) ← Remainder(Constant(Integer(5)), Constant(Integer(3)))
</a><a href="#h5-0-11" id="h5-0-11" class="i">+Integer(-2) ← Remainder(Negate(Constant(Integer(5))), Constant(Integer(3)))
</a><a href="#h5-0-12" id="h5-0-12" class="i">+Integer(2) ← Remainder(Constant(Integer(5)), Negate(Constant(Integer(3))))
</a><a href="#h5-0-13" id="h5-0-13" class="i">+
</a><a href="#h5-0-14" id="h5-0-14" class="i">+# Floats.
</a><a href="#h5-0-15" id="h5-0-15" class="i">+[expr]&gt; 6.28 % 2.2
</a><a href="#h5-0-16" id="h5-0-16" class="i">+[expr]&gt; 6.28 % -2.2
</a><a href="#h5-0-17" id="h5-0-17" class="i">+---
</a><a href="#h5-0-18" id="h5-0-18" class="i">+Float(1.88) ← Remainder(Constant(Float(6.28)), Constant(Float(2.2)))
</a><a href="#h5-0-19" id="h5-0-19" class="i">+Float(1.88) ← Remainder(Constant(Float(6.28)), Negate(Constant(Float(2.2))))
</a><a href="#h5-0-20" id="h5-0-20" class="i">+
</a><a href="#h5-0-21" id="h5-0-21" class="i">+# Mixed.
</a><a href="#h5-0-22" id="h5-0-22" class="i">+&gt; 3.15 % 2
</a><a href="#h5-0-23" id="h5-0-23" class="i">+&gt; 6 % 3.15
</a><a href="#h5-0-24" id="h5-0-24" class="i">+&gt; 3.15 % -2
</a><a href="#h5-0-25" id="h5-0-25" class="i">+---
</a><a href="#h5-0-26" id="h5-0-26" class="i">+Float(1.15)
</a><a href="#h5-0-27" id="h5-0-27" class="i">+Float(2.85)
</a><a href="#h5-0-28" id="h5-0-28" class="i">+Float(1.15)
</a><a href="#h5-0-29" id="h5-0-29" class="i">+
</a><a href="#h5-0-30" id="h5-0-30" class="i">+# Division by zero.
</a><a href="#h5-0-31" id="h5-0-31" class="i">+!&gt; 7 % 0
</a><a href="#h5-0-32" id="h5-0-32" class="i">+&gt; 6.28 % 0.0
</a><a href="#h5-0-33" id="h5-0-33" class="i">+---
</a><a href="#h5-0-34" id="h5-0-34" class="i">+Error: invalid input: can&#39;t divide by zero
</a><a href="#h5-0-35" id="h5-0-35" class="i">+Float(NaN)
</a><a href="#h5-0-36" id="h5-0-36" class="i">+
</a><a href="#h5-0-37" id="h5-0-37" class="i">+# NULLs.
</a><a href="#h5-0-38" id="h5-0-38" class="i">+&gt; 1 % NULL
</a><a href="#h5-0-39" id="h5-0-39" class="i">+&gt; NULL % 3
</a><a href="#h5-0-40" id="h5-0-40" class="i">+&gt; 3.14 % NULL
</a><a href="#h5-0-41" id="h5-0-41" class="i">+&gt; NULL % NULL
</a><a href="#h5-0-42" id="h5-0-42" class="i">+---
</a><a href="#h5-0-43" id="h5-0-43" class="i">+Null
</a><a href="#h5-0-44" id="h5-0-44" class="i">+Null
</a><a href="#h5-0-45" id="h5-0-45" class="i">+Null
</a><a href="#h5-0-46" id="h5-0-46" class="i">+Null
</a><a href="#h5-0-47" id="h5-0-47" class="i">+
</a><a href="#h5-0-48" id="h5-0-48" class="i">+# Infinity and NaN.
</a><a href="#h5-0-49" id="h5-0-49" class="i">+&gt; INFINITY % 7
</a><a href="#h5-0-50" id="h5-0-50" class="i">+&gt; 7 % INFINITY
</a><a href="#h5-0-51" id="h5-0-51" class="i">+&gt; 7 % -INFINITY
</a><a href="#h5-0-52" id="h5-0-52" class="i">+&gt; INFINITY % INFINITY
</a><a href="#h5-0-53" id="h5-0-53" class="i">+&gt; 7 % NAN
</a><a href="#h5-0-54" id="h5-0-54" class="i">+&gt; NAN % 7
</a><a href="#h5-0-55" id="h5-0-55" class="i">+&gt; NAN % NAN
</a><a href="#h5-0-56" id="h5-0-56" class="i">+---
</a><a href="#h5-0-57" id="h5-0-57" class="i">+Float(NaN)
</a><a href="#h5-0-58" id="h5-0-58" class="i">+Float(7.0)
</a><a href="#h5-0-59" id="h5-0-59" class="i">+Float(7.0)
</a><a href="#h5-0-60" id="h5-0-60" class="i">+Float(NaN)
</a><a href="#h5-0-61" id="h5-0-61" class="i">+Float(NaN)
</a><a href="#h5-0-62" id="h5-0-62" class="i">+Float(NaN)
</a><a href="#h5-0-63" id="h5-0-63" class="i">+Float(NaN)
</a><a href="#h5-0-64" id="h5-0-64" class="i">+
</a><a href="#h5-0-65" id="h5-0-65" class="i">+# Bools and strings.
</a><a href="#h5-0-66" id="h5-0-66" class="i">+!&gt; TRUE % FALSE
</a><a href="#h5-0-67" id="h5-0-67" class="i">+!&gt; &#39;a&#39; % &#39;b&#39;
</a><a href="#h5-0-68" id="h5-0-68" class="i">+---
</a><a href="#h5-0-69" id="h5-0-69" class="i">+Error: invalid input: can&#39;t take remainder of TRUE and FALSE
</a><a href="#h5-0-70" id="h5-0-70" class="i">+Error: invalid input: can&#39;t take remainder of a and b
</a><b>diff --git a/<a id="h6" href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a> b/<a href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -46,12 +46,12 @@ pub enum Expression {
</a>     Factorial(Box&lt;Expression&gt;),
     /// The identify function, which simply returns the same number.
     Identity(Box&lt;Expression&gt;),
<a href="#h6-0-3" id="h6-0-3" class="d">-    /// The remainder after dividing two numbers: a % b.
</a><a href="#h6-0-4" id="h6-0-4" class="d">-    Modulo(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
</a>     /// Multiplies two numbers: a * b.
     Multiply(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
     /// Negates the given number: -a.
     Negate(Box&lt;Expression&gt;),
<a href="#h6-0-9" id="h6-0-9" class="i">+    /// The remainder after dividing two numbers: a % b.
</a><a href="#h6-0-10" id="h6-0-10" class="i">+    Remainder(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
</a>     /// Takes the square root of a number: √a.
     SquareRoot(Box&lt;Expression&gt;),
     /// Subtracts two numbers: a - b.
<a href="#h6-1" id="h6-1" class="h">@@ -87,9 +87,9 @@ impl Expression {
</a>             Self::Exponentiate(lhs, rhs) =&gt; format!(&quot;{} ^ {}&quot;, format(lhs), format(rhs)),
             Self::Factorial(expr) =&gt; format!(&quot;{}!&quot;, format(expr)),
             Self::Identity(expr) =&gt; format(expr),
<a href="#h6-1-3" id="h6-1-3" class="d">-            Self::Modulo(lhs, rhs) =&gt; format!(&quot;{} % {}&quot;, format(lhs), format(rhs)),
</a>             Self::Multiply(lhs, rhs) =&gt; format!(&quot;{} * {}&quot;, format(lhs), format(rhs)),
             Self::Negate(expr) =&gt; format!(&quot;-{}&quot;, format(expr)),
<a href="#h6-1-6" id="h6-1-6" class="i">+            Self::Remainder(lhs, rhs) =&gt; format!(&quot;{} % {}&quot;, format(lhs), format(rhs)),
</a>             Self::SquareRoot(expr) =&gt; format!(&quot;sqrt({})&quot;, format(expr)),
             Self::Subtract(lhs, rhs) =&gt; format!(&quot;{} - {}&quot;, format(lhs), format(rhs)),
 
<a href="#h6-2" id="h6-2" class="h">@@ -197,7 +197,6 @@ impl Expression {
</a>                 v @ (Integer(_) | Float(_) | Null) =&gt; v,
                 expr =&gt; return errinput!(&quot;can&#39;t take the identity of {expr}&quot;),
             },
<a href="#h6-2-3" id="h6-2-3" class="d">-            Self::Modulo(lhs, rhs) =&gt; lhs.evaluate(row)?.checked_rem(&amp;rhs.evaluate(row)?)?,
</a>             Self::Multiply(lhs, rhs) =&gt; lhs.evaluate(row)?.checked_mul(&amp;rhs.evaluate(row)?)?,
             Self::Negate(expr) =&gt; match expr.evaluate(row)? {
                 Integer(i) =&gt; Integer(-i),
<a href="#h6-3" id="h6-3" class="h">@@ -205,6 +204,7 @@ impl Expression {
</a>                 Null =&gt; Null,
                 value =&gt; return errinput!(&quot;can&#39;t negate {value}&quot;),
             },
<a href="#h6-3-3" id="h6-3-3" class="i">+            Self::Remainder(lhs, rhs) =&gt; lhs.evaluate(row)?.checked_rem(&amp;rhs.evaluate(row)?)?,
</a>             Self::SquareRoot(expr) =&gt; match expr.evaluate(row)? {
                 Integer(i) if i &gt;= 0 =&gt; Float((i as f64).sqrt()),
                 Float(f) =&gt; Float(f.sqrt()),
<a href="#h6-4" id="h6-4" class="h">@@ -241,9 +241,9 @@ impl Expression {
</a>                 | Self::GreaterThan(lhs, rhs)
                 | Self::LessThan(lhs, rhs)
                 | Self::Like(lhs, rhs)
<a href="#h6-4-3" id="h6-4-3" class="d">-                | Self::Modulo(lhs, rhs)
</a>                 | Self::Multiply(lhs, rhs)
                 | Self::Or(lhs, rhs)
<a href="#h6-4-6" id="h6-4-6" class="i">+                | Self::Remainder(lhs, rhs)
</a>                 | Self::Subtract(lhs, rhs) =&gt; lhs.walk(visitor) &amp;&amp; rhs.walk(visitor),
 
                 Self::Factorial(expr)
<a href="#h6-5" id="h6-5" class="h">@@ -288,9 +288,9 @@ impl Expression {
</a>             Self::GreaterThan(lhs, rhs) =&gt; Self::GreaterThan(transform(lhs)?, transform(rhs)?),
             Self::LessThan(lhs, rhs) =&gt; Self::LessThan(transform(lhs)?, transform(rhs)?),
             Self::Like(lhs, rhs) =&gt; Self::Like(transform(lhs)?, transform(rhs)?),
<a href="#h6-5-3" id="h6-5-3" class="d">-            Self::Modulo(lhs, rhs) =&gt; Self::Modulo(transform(lhs)?, transform(rhs)?),
</a>             Self::Multiply(lhs, rhs) =&gt; Self::Multiply(transform(lhs)?, transform(rhs)?),
             Self::Or(lhs, rhs) =&gt; Self::Or(transform(lhs)?, transform(rhs)?),
<a href="#h6-5-6" id="h6-5-6" class="i">+            Self::Remainder(lhs, rhs) =&gt; Self::Remainder(transform(lhs)?, transform(rhs)?),
</a>             Self::SquareRoot(expr) =&gt; Self::SquareRoot(transform(expr)?),
             Self::Subtract(lhs, rhs) =&gt; Self::Subtract(transform(lhs)?, transform(rhs)?),
 
<b>diff --git a/<a id="h7" href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a> b/<a href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -192,10 +192,13 @@ impl Value {
</a>     }
 
     /// Finds the remainder of two values. Errors when invalid.
<a href="#h7-0-3" id="h7-0-3" class="i">+    ///
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    /// NB: uses the remainder, not modulo, like Postgres. For negative values,
</a><a href="#h7-0-5" id="h7-0-5" class="i">+    /// the result has the sign of the dividend, rather than always returning a
</a><a href="#h7-0-6" id="h7-0-6" class="i">+    /// positive value (modulo).
</a>     pub fn checked_rem(&amp;self, other: &amp;Self) -&gt; Result&lt;Self&gt; {
         use Value::*;
         Ok(match (self, other) {
<a href="#h7-0-10" id="h7-0-10" class="d">-            // Uses remainder semantics, like Postgres.
</a>             (Integer(_), Integer(0)) =&gt; return errinput!(&quot;can&#39;t divide by zero&quot;),
             (Integer(lhs), Integer(rhs)) =&gt; Integer(lhs % rhs),
             (Integer(lhs), Float(rhs)) =&gt; Float(*lhs as f64 % rhs),
<a href="#h7-1" id="h7-1" class="h">@@ -203,7 +206,7 @@ impl Value {
</a>             (Float(lhs), Float(rhs)) =&gt; Float(lhs % rhs),
             (Integer(_) | Float(_) | Null, Null) =&gt; Null,
             (Null, Integer(_) | Float(_)) =&gt; Null,
<a href="#h7-1-3" id="h7-1-3" class="d">-            (lhs, rhs) =&gt; return errinput!(&quot;can&#39;t take modulo of {lhs} and {rhs}&quot;),
</a><a href="#h7-1-4" id="h7-1-4" class="i">+            (lhs, rhs) =&gt; return errinput!(&quot;can&#39;t take remainder of {lhs} and {rhs}&quot;),
</a>         })
     }
 
</pre>
</div>
</body>
</html>
