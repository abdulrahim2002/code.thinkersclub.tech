<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>raft: add a Read message for confirming reads - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/44e086c95d99057f437baa7ee38a455325834423.html">44e086c95d99057f437baa7ee38a455325834423</a>
<b>parent</b> <a href="../commit/3c06bc6d7264001973f4deed1f4577ec2ac98a9b.html">3c06bc6d7264001973f4deed1f4577ec2ac98a9b</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Mon, 24 Jun 2024 14:24:33 +0200

raft: add a Read message for confirming reads

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/raft/message.rs</a></td><td> | </td><td class="num">27</td><td><span class="i">++++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/raft/mod.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/raft/node.rs</a></td><td> | </td><td class="num">45</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">src/raft/testscripts/node/heartbeat_lost_read</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/raft/testscripts/node/request_follower</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/raft/testscripts/node/request_leader</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/raft/testscripts/node/request_leader_campaign_abort</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/raft/testscripts/node/request_leader_change_linearizability</a></td><td> | </td><td class="num">32</td><td><span class="i">+++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/raft/testscripts/node/request_leader_disconnect</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/raft/testscripts/node/request_leader_read_quorum</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/raft/testscripts/node/request_leader_read_quorum_sequence</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++</span><span class="d">----------------</span></td></tr>
</table></pre><pre>11 files changed, 173 insertions(+), 80 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/raft/message.rs.html">src/raft/message.rs</a> b/<a href="../file/src/raft/message.rs.html">src/raft/message.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -27,11 +27,6 @@ impl encoding::Value for Envelope {}
</a> /// ensuring messages are not dropped or reordered as long as the connection
 /// remains intact. A message and its response are sent across separate TCP
 /// connections (outbound from their respective senders).
<a href="#h0-0-3" id="h0-0-3" class="d">-///
</a><a href="#h0-0-4" id="h0-0-4" class="d">-/// TODO: add a Read(Response) message type for reads, to avoid sending
</a><a href="#h0-0-5" id="h0-0-5" class="d">-/// heartbeats on every read -- these could otherwise cause spurious replication
</a><a href="#h0-0-6" id="h0-0-6" class="d">-/// probes for behind followers. We still need the read_seq in the heartbeat for
</a><a href="#h0-0-7" id="h0-0-7" class="d">-/// retries.
</a> #[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
 pub enum Message {
     /// Candidates campaign for leadership by soliciting votes from peers.
<a href="#h0-1" id="h0-1" class="h">@@ -53,17 +48,11 @@ pub enum Message {
</a>         vote: bool,
     },
 
<a href="#h0-1-3" id="h0-1-3" class="d">-    /// Leaders send heartbeats periodically, and on client read requests. This
</a><a href="#h0-1-4" id="h0-1-4" class="d">-    /// serves several purposes:
</a><a href="#h0-1-5" id="h0-1-5" class="i">+    /// Leaders send periodic heartbeats. This serves several purposes:
</a>     ///
     /// * Inform nodes about the leader, and prevent elections.
<a href="#h0-1-8" id="h0-1-8" class="d">-    /// * Probe follower log progress, and trigger append/ack retries.
</a><a href="#h0-1-9" id="h0-1-9" class="i">+    /// * Detect lost appends and reads, as a retry mechanism.
</a>     /// * Advance followers&#39; commit indexes, so they can apply entries.
<a href="#h0-1-11" id="h0-1-11" class="d">-    /// * Confirm leadership for client reads, to avoid stale reads.
</a><a href="#h0-1-12" id="h0-1-12" class="d">-    ///
</a><a href="#h0-1-13" id="h0-1-13" class="d">-    /// While some of this could be split out to other messages, the heartbeat
</a><a href="#h0-1-14" id="h0-1-14" class="d">-    /// periodicity implicitly provides retries, so it is convenient to
</a><a href="#h0-1-15" id="h0-1-15" class="d">-    /// piggyback on it.
</a>     ///
     /// The Raft paper does not have a distinct heartbeat message, and instead
     /// uses an empty AppendEntries RPC, but we choose to add one for better
<a href="#h0-2" id="h0-2" class="h">@@ -79,8 +68,7 @@ pub enum Message {
</a>         /// to commit this if the local log matches last_index, such that the
         /// follower&#39;s log is identical to the leader at the commit index.
         commit_index: Index,
<a href="#h0-2-3" id="h0-2-3" class="d">-        /// The leader&#39;s latest read sequence number in this term. Read requests
</a><a href="#h0-2-4" id="h0-2-4" class="d">-        /// are served once the sequence number has been confirmed by a quorum.
</a><a href="#h0-2-5" id="h0-2-5" class="i">+        /// The leader&#39;s latest read sequence number in this term.
</a>         read_seq: ReadSequence,
     },
 
<a href="#h0-3" id="h0-3" class="h">@@ -132,6 +120,15 @@ pub enum Message {
</a>         reject_index: Index,
     },
 
<a href="#h0-3-3" id="h0-3-3" class="i">+    /// Leaders need to confirm they are still the leader before serving reads,
</a><a href="#h0-3-4" id="h0-3-4" class="i">+    /// to guarantee linearizability in case a different leader has been
</a><a href="#h0-3-5" id="h0-3-5" class="i">+    /// estalished elsewhere. Read requests are served once the sequence number
</a><a href="#h0-3-6" id="h0-3-6" class="i">+    /// has been confirmed by a quorum.
</a><a href="#h0-3-7" id="h0-3-7" class="i">+    Read { seq: ReadSequence },
</a><a href="#h0-3-8" id="h0-3-8" class="i">+
</a><a href="#h0-3-9" id="h0-3-9" class="i">+    /// Followers confirm leadership at the read sequence numbers.
</a><a href="#h0-3-10" id="h0-3-10" class="i">+    ReadResponse { seq: ReadSequence },
</a><a href="#h0-3-11" id="h0-3-11" class="i">+
</a>     /// A client request. This can be submitted to the leader, or to a follower
     /// which will forward it to its leader. If there is no leader, or the
     /// leader or term changes, the request is aborted with an Error::Abort
<b>diff --git a/<a id="h1" href="../file/src/raft/mod.rs.html">src/raft/mod.rs</a> b/<a href="../file/src/raft/mod.rs.html">src/raft/mod.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -196,10 +196,10 @@
</a> //! Otherwise, it&#39;s possible that a new leader has been elected elsewhere and
 //! executed writes without us knowing about it. It does this by assigning an
 //! incrementing sequence number to each read, keeping track of the request in a
<a href="#h1-0-3" id="h1-0-3" class="d">-//! `Read` struct, and immediately sending a heartbeat with the latest sequence
</a><a href="#h1-0-4" id="h1-0-4" class="d">-//! number in `Heartbeat.read_seq`. Followers include the `read_seq` in their
</a><a href="#h1-0-5" id="h1-0-5" class="d">-//! `HeartbeatResponse`, and once a quorum have confirmed a sequence number the
</a><a href="#h1-0-6" id="h1-0-6" class="d">-//! read is executed and the result returned to the client.
</a><a href="#h1-0-7" id="h1-0-7" class="i">+//! `Read` struct, and immediately sending a `Read` message with the latest
</a><a href="#h1-0-8" id="h1-0-8" class="i">+//! sequence number. Followers respond with the sequence number, and once a
</a><a href="#h1-0-9" id="h1-0-9" class="i">+//! quorum have confirmed a sequence number the read is executed and the result
</a><a href="#h1-0-10" id="h1-0-10" class="i">+//! returned to the client.
</a> //!
 //! IMPLEMENTATION CAVEATS
 //! ======================
<b>diff --git a/<a id="h2" href="../file/src/raft/node.rs.html">src/raft/node.rs</a> b/<a href="../file/src/raft/node.rs.html">src/raft/node.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -417,6 +417,18 @@ impl RawNode&lt;Follower&gt; {
</a>                 self.send(msg.from, Message::AppendResponse { reject_index, match_index })?;
             }
 
<a href="#h2-0-3" id="h2-0-3" class="i">+            // Confirm the leader&#39;s read sequence number.
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            Message::Read { seq } =&gt; {
</a><a href="#h2-0-5" id="h2-0-5" class="i">+                // Make sure the read is from our leader, or follow it.
</a><a href="#h2-0-6" id="h2-0-6" class="i">+                match self.role.leader {
</a><a href="#h2-0-7" id="h2-0-7" class="i">+                    Some(leader) =&gt; assert_eq!(msg.from, leader, &quot;multiple leaders in term&quot;),
</a><a href="#h2-0-8" id="h2-0-8" class="i">+                    None =&gt; self = self.into_follower(msg.term, Some(msg.from))?,
</a><a href="#h2-0-9" id="h2-0-9" class="i">+                }
</a><a href="#h2-0-10" id="h2-0-10" class="i">+
</a><a href="#h2-0-11" id="h2-0-11" class="i">+                // Confirm the read.
</a><a href="#h2-0-12" id="h2-0-12" class="i">+                self.send(msg.from, Message::ReadResponse { seq })?;
</a><a href="#h2-0-13" id="h2-0-13" class="i">+            }
</a><a href="#h2-0-14" id="h2-0-14" class="i">+
</a>             // A candidate is requesting our vote. We&#39;ll only grant one.
             Message::Campaign { last_index, last_term } =&gt; {
                 // Don&#39;t vote if we already voted for someone else in this term.
<a href="#h2-1" id="h2-1" class="h">@@ -472,7 +484,9 @@ impl RawNode&lt;Follower&gt; {
</a>             Message::CampaignResponse { .. } =&gt; {}
 
             // We&#39;re not leader this term, so we shouldn&#39;t see these.
<a href="#h2-1-3" id="h2-1-3" class="d">-            Message::HeartbeatResponse { .. } | Message::AppendResponse { .. } =&gt; {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+            Message::HeartbeatResponse { .. }
</a><a href="#h2-1-5" id="h2-1-5" class="i">+            | Message::AppendResponse { .. }
</a><a href="#h2-1-6" id="h2-1-6" class="i">+            | Message::ReadResponse { .. } =&gt; {
</a>                 panic!(&quot;unexpected message {msg:?}&quot;)
             }
         };
<a href="#h2-2" id="h2-2" class="h">@@ -606,7 +620,7 @@ impl RawNode&lt;Candidate&gt; {
</a> 
             // If we hear from a leader in this term, we lost the election.
             // Follow it and step the message.
<a href="#h2-2-3" id="h2-2-3" class="d">-            Message::Heartbeat { .. } | Message::Append { .. } =&gt; {
</a><a href="#h2-2-4" id="h2-2-4" class="i">+            Message::Heartbeat { .. } | Message::Append { .. } | Message::Read { .. } =&gt; {
</a>                 return self.into_follower(msg.term, Some(msg.from))?.step(msg);
             }
 
<a href="#h2-3" id="h2-3" class="h">@@ -619,6 +633,7 @@ impl RawNode&lt;Candidate&gt; {
</a>             // so we shouldn&#39;t see these.
             Message::HeartbeatResponse { .. }
             | Message::AppendResponse { .. }
<a href="#h2-3-3" id="h2-3-3" class="i">+            | Message::ReadResponse { .. }
</a>             | Message::ClientResponse { .. } =&gt; panic!(&quot;unexpected message {msg:?}&quot;),
         }
         Ok(self.into())
<a href="#h2-4" id="h2-4" class="h">@@ -658,8 +673,8 @@ pub struct Leader {
</a>     writes: HashMap&lt;Index, Write&gt;,
     /// Tracks pending read requests. For linearizability, read requests are
     /// assigned a sequence number and only executed once a quorum of nodes have
<a href="#h2-4-3" id="h2-4-3" class="d">-    /// confirmed it via leader heartbeats. Otherwise, an old leader may serve
</a><a href="#h2-4-4" id="h2-4-4" class="d">-    /// stale reads if a new leader has been elected elsewhere.
</a><a href="#h2-4-5" id="h2-4-5" class="i">+    /// confirmed it. Otherwise, an old leader may serve stale reads if a new
</a><a href="#h2-4-6" id="h2-4-6" class="i">+    /// leader has been elected elsewhere.
</a>     reads: VecDeque&lt;Read&gt;,
     /// The read sequence number used for the last read. Initialized to 0 in
     /// this term, and incremented for every read command.
<a href="#h2-5" id="h2-5" class="h">@@ -846,6 +861,14 @@ impl RawNode&lt;Leader&gt; {
</a>                 self.maybe_send_append(msg.from, false)?;
             }
 
<a href="#h2-5-3" id="h2-5-3" class="i">+            // A follower confirmed our read sequence number. If it advances,
</a><a href="#h2-5-4" id="h2-5-4" class="i">+            // try to execute reads.
</a><a href="#h2-5-5" id="h2-5-5" class="i">+            Message::ReadResponse { seq } =&gt; {
</a><a href="#h2-5-6" id="h2-5-6" class="i">+                if self.progress(msg.from).advance_read(seq) {
</a><a href="#h2-5-7" id="h2-5-7" class="i">+                    self.maybe_read()?;
</a><a href="#h2-5-8" id="h2-5-8" class="i">+                }
</a><a href="#h2-5-9" id="h2-5-9" class="i">+            }
</a><a href="#h2-5-10" id="h2-5-10" class="i">+
</a>             // A follower rejected an append because the base entry in
             // reject_index did not match its log. Probe the previous entry by
             // sending an empty append until we find a common base.
<a href="#h2-6" id="h2-6" class="h">@@ -885,13 +908,13 @@ impl RawNode&lt;Leader&gt; {
</a>             }
 
             // A client submitted a read request. To ensure linearizability, we
<a href="#h2-6-3" id="h2-6-3" class="d">-            // must confirm that we are still the leader by sending a heartbeat
</a><a href="#h2-6-4" id="h2-6-4" class="d">-            // with the read&#39;s sequence number and wait for quorum confirmation.
</a><a href="#h2-6-5" id="h2-6-5" class="i">+            // must confirm that we are still the leader by sending the read&#39;s
</a><a href="#h2-6-6" id="h2-6-6" class="i">+            // sequence number and wait for quorum confirmation.
</a>             Message::ClientRequest { id, request: Request::Read(command) } =&gt; {
                 self.role.read_seq += 1;
                 let read = Read { seq: self.role.read_seq, from: msg.from, id, command };
                 self.role.reads.push_back(read);
<a href="#h2-6-11" id="h2-6-11" class="d">-                self.heartbeat()?;
</a><a href="#h2-6-12" id="h2-6-12" class="i">+                self.broadcast(Message::Read { seq: self.role.read_seq })?;
</a>                 if self.cluster_size() == 1 {
                     self.maybe_read()?;
                 }
<a href="#h2-7" id="h2-7" class="h">@@ -912,7 +935,7 @@ impl RawNode&lt;Leader&gt; {
</a>             Message::CampaignResponse { .. } =&gt; {}
 
             // There can&#39;t be another leader in this term.
<a href="#h2-7-3" id="h2-7-3" class="d">-            Message::Heartbeat { .. } | Message::Append { .. } =&gt; {
</a><a href="#h2-7-4" id="h2-7-4" class="i">+            Message::Heartbeat { .. } | Message::Append { .. } | Message::Read { .. } =&gt; {
</a>                 panic!(&quot;saw other leader {} in term {}&quot;, msg.from, msg.term);
             }
 
<a href="#h2-8" id="h2-8" class="h">@@ -2036,6 +2059,12 @@ mod tests {
</a>                         (_, _) =&gt; panic!(&quot;match_index and reject_index both set&quot;),
                     }
                 }
<a href="#h2-8-3" id="h2-8-3" class="i">+                Message::Read { seq } =&gt; {
</a><a href="#h2-8-4" id="h2-8-4" class="i">+                    format!(&quot;Read seq={seq}&quot;)
</a><a href="#h2-8-5" id="h2-8-5" class="i">+                }
</a><a href="#h2-8-6" id="h2-8-6" class="i">+                Message::ReadResponse { seq } =&gt; {
</a><a href="#h2-8-7" id="h2-8-7" class="i">+                    format!(&quot;ReadResponse seq={seq}&quot;)
</a><a href="#h2-8-8" id="h2-8-8" class="i">+                }
</a>                 Message::ClientRequest { id, request } =&gt; {
                     format!(
                         &quot;ClientRequest id=0x{} {}&quot;,
<b>diff --git a/<a id="h3" href="../file/src/raft/testscripts/node/heartbeat_lost_read.html">src/raft/testscripts/node/heartbeat_lost_read</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_lost_read.html">src/raft/testscripts/node/heartbeat_lost_read</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+# Heartbeats will recover from a lost read message.
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+cluster nodes=5 leader=1
</a><a href="#h3-0-3" id="h3-0-3" class="i">+---
</a><a href="#h3-0-4" id="h3-0-4" class="i">+n1@1 leader last=1@1 commit=1@1 applied=1 progress={2:1→2 3:1→2 4:1→2 5:1→2}
</a><a href="#h3-0-5" id="h3-0-5" class="i">+n2@1 follower(n1) last=1@1 commit=1@1 applied=1
</a><a href="#h3-0-6" id="h3-0-6" class="i">+n3@1 follower(n1) last=1@1 commit=1@1 applied=1
</a><a href="#h3-0-7" id="h3-0-7" class="i">+n4@1 follower(n1) last=1@1 commit=1@1 applied=1
</a><a href="#h3-0-8" id="h3-0-8" class="i">+n5@1 follower(n1) last=1@1 commit=1@1 applied=1
</a><a href="#h3-0-9" id="h3-0-9" class="i">+
</a><a href="#h3-0-10" id="h3-0-10" class="i">+# Write a key and replicate it.
</a><a href="#h3-0-11" id="h3-0-11" class="i">+(put 1 foo=bar)
</a><a href="#h3-0-12" id="h3-0-12" class="i">+(stabilize heartbeat=true)
</a><a href="#h3-0-13" id="h3-0-13" class="i">+---
</a><a href="#h3-0-14" id="h3-0-14" class="i">+ok
</a><a href="#h3-0-15" id="h3-0-15" class="i">+
</a><a href="#h3-0-16" id="h3-0-16" class="i">+# Partition the leader, and submit a read.
</a><a href="#h3-0-17" id="h3-0-17" class="i">+partition 1
</a><a href="#h3-0-18" id="h3-0-18" class="i">+---
</a><a href="#h3-0-19" id="h3-0-19" class="i">+n1 ⇹ n2 n3 n4 n5
</a><a href="#h3-0-20" id="h3-0-20" class="i">+
</a><a href="#h3-0-21" id="h3-0-21" class="i">+get 1 foo
</a><a href="#h3-0-22" id="h3-0-22" class="i">+---
</a><a href="#h3-0-23" id="h3-0-23" class="i">+c1@1 → n1 ClientRequest id=0x02 read 0x0003666f6f
</a><a href="#h3-0-24" id="h3-0-24" class="i">+n1@1 ⇥ n2 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a><a href="#h3-0-25" id="h3-0-25" class="i">+n1@1 ⇥ n3 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a><a href="#h3-0-26" id="h3-0-26" class="i">+n1@1 ⇥ n4 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a><a href="#h3-0-27" id="h3-0-27" class="i">+n1@1 ⇥ n5 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a><a href="#h3-0-28" id="h3-0-28" class="i">+
</a><a href="#h3-0-29" id="h3-0-29" class="i">+heal
</a><a href="#h3-0-30" id="h3-0-30" class="i">+---
</a><a href="#h3-0-31" id="h3-0-31" class="i">+n1 n2 n3 n4 n5 fully connected
</a><a href="#h3-0-32" id="h3-0-32" class="i">+
</a><a href="#h3-0-33" id="h3-0-33" class="i">+# The next heartbeat will detect the failed read, and serve it when
</a><a href="#h3-0-34" id="h3-0-34" class="i">+# it has a quorum.
</a><a href="#h3-0-35" id="h3-0-35" class="i">+heartbeat 1
</a><a href="#h3-0-36" id="h3-0-36" class="i">+deliver
</a><a href="#h3-0-37" id="h3-0-37" class="i">+---
</a><a href="#h3-0-38" id="h3-0-38" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h3-0-39" id="h3-0-39" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h3-0-40" id="h3-0-40" class="i">+n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h3-0-41" id="h3-0-41" class="i">+n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h3-0-42" id="h3-0-42" class="i">+n2@1 → n1 HeartbeatResponse match_index=2 read_seq=1
</a><a href="#h3-0-43" id="h3-0-43" class="i">+n3@1 → n1 HeartbeatResponse match_index=2 read_seq=1
</a><a href="#h3-0-44" id="h3-0-44" class="i">+n4@1 → n1 HeartbeatResponse match_index=2 read_seq=1
</a><a href="#h3-0-45" id="h3-0-45" class="i">+n5@1 → n1 HeartbeatResponse match_index=2 read_seq=1
</a><a href="#h3-0-46" id="h3-0-46" class="i">+
</a><a href="#h3-0-47" id="h3-0-47" class="i">+# The first response does not provide quorum.
</a><a href="#h3-0-48" id="h3-0-48" class="i">+deliver 1 from=2
</a><a href="#h3-0-49" id="h3-0-49" class="i">+---
</a><a href="#h3-0-50" id="h3-0-50" class="i">+ok
</a><a href="#h3-0-51" id="h3-0-51" class="i">+
</a><a href="#h3-0-52" id="h3-0-52" class="i">+# The second does, and the read is served.
</a><a href="#h3-0-53" id="h3-0-53" class="i">+deliver 1 from=3
</a><a href="#h3-0-54" id="h3-0-54" class="i">+---
</a><a href="#h3-0-55" id="h3-0-55" class="i">+n1@1 → c1 ClientResponse id=0x02 read 0x000103626172
</a><a href="#h3-0-56" id="h3-0-56" class="i">+c1@1 get foo ⇒ bar
</a><b>diff --git a/<a id="h4" href="../file/src/raft/testscripts/node/request_follower.html">src/raft/testscripts/node/request_follower</a> b/<a href="../file/src/raft/testscripts/node/request_follower.html">src/raft/testscripts/node/request_follower</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -12,10 +12,10 @@ stabilize
</a> ---
 c2@1 → n2 ClientRequest id=0x01 read 0x0003666f6f
 n2@1 → n1 ClientRequest id=0x01 read 0x0003666f6f
<a href="#h4-0-3" id="h4-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h4-0-4" id="h4-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h4-0-5" id="h4-0-5" class="d">-n2@1 → n1 HeartbeatResponse match_index=1 read_seq=1
</a><a href="#h4-0-6" id="h4-0-6" class="d">-n3@1 → n1 HeartbeatResponse match_index=1 read_seq=1
</a><a href="#h4-0-7" id="h4-0-7" class="i">+n1@1 → n2 Read seq=1
</a><a href="#h4-0-8" id="h4-0-8" class="i">+n1@1 → n3 Read seq=1
</a><a href="#h4-0-9" id="h4-0-9" class="i">+n2@1 → n1 ReadResponse seq=1
</a><a href="#h4-0-10" id="h4-0-10" class="i">+n3@1 → n1 ReadResponse seq=1
</a> n1@1 → n2 ClientResponse id=0x01 read 0x0000
 n2@1 → c2 ClientResponse id=0x01 read 0x0000
 c2@1 get foo ⇒ None
<a href="#h4-1" id="h4-1" class="h">@@ -46,10 +46,10 @@ stabilize
</a> ---
 c2@1 → n2 ClientRequest id=0x03 read 0x0003666f6f
 n2@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h4-1-3" id="h4-1-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h4-1-4" id="h4-1-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h4-1-5" id="h4-1-5" class="d">-n2@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h4-1-6" id="h4-1-6" class="d">-n3@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h4-1-7" id="h4-1-7" class="i">+n1@1 → n2 Read seq=2
</a><a href="#h4-1-8" id="h4-1-8" class="i">+n1@1 → n3 Read seq=2
</a><a href="#h4-1-9" id="h4-1-9" class="i">+n2@1 → n1 ReadResponse seq=2
</a><a href="#h4-1-10" id="h4-1-10" class="i">+n3@1 → n1 ReadResponse seq=2
</a> n1@1 → n2 ClientResponse id=0x03 read 0x000103626172
 n2@1 → c2 ClientResponse id=0x03 read 0x000103626172
 c2@1 get foo ⇒ bar
<b>diff --git a/<a id="h5" href="../file/src/raft/testscripts/node/request_leader.html">src/raft/testscripts/node/request_leader</a> b/<a href="../file/src/raft/testscripts/node/request_leader.html">src/raft/testscripts/node/request_leader</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -11,10 +11,10 @@ get 1 foo
</a> stabilize
 ---
 c1@1 → n1 ClientRequest id=0x01 read 0x0003666f6f
<a href="#h5-0-3" id="h5-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h5-0-4" id="h5-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h5-0-5" id="h5-0-5" class="d">-n2@1 → n1 HeartbeatResponse match_index=1 read_seq=1
</a><a href="#h5-0-6" id="h5-0-6" class="d">-n3@1 → n1 HeartbeatResponse match_index=1 read_seq=1
</a><a href="#h5-0-7" id="h5-0-7" class="i">+n1@1 → n2 Read seq=1
</a><a href="#h5-0-8" id="h5-0-8" class="i">+n1@1 → n3 Read seq=1
</a><a href="#h5-0-9" id="h5-0-9" class="i">+n2@1 → n1 ReadResponse seq=1
</a><a href="#h5-0-10" id="h5-0-10" class="i">+n3@1 → n1 ReadResponse seq=1
</a> n1@1 → c1 ClientResponse id=0x01 read 0x0000
 c1@1 get foo ⇒ None
 
<a href="#h5-1" id="h5-1" class="h">@@ -41,9 +41,9 @@ get 1 foo
</a> stabilize
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h5-1-3" id="h5-1-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h5-1-4" id="h5-1-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h5-1-5" id="h5-1-5" class="d">-n2@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h5-1-6" id="h5-1-6" class="d">-n3@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h5-1-7" id="h5-1-7" class="i">+n1@1 → n2 Read seq=2
</a><a href="#h5-1-8" id="h5-1-8" class="i">+n1@1 → n3 Read seq=2
</a><a href="#h5-1-9" id="h5-1-9" class="i">+n2@1 → n1 ReadResponse seq=2
</a><a href="#h5-1-10" id="h5-1-10" class="i">+n3@1 → n1 ReadResponse seq=2
</a> n1@1 → c1 ClientResponse id=0x03 read 0x000103626172
 c1@1 get foo ⇒ bar
<b>diff --git a/<a id="h6" href="../file/src/raft/testscripts/node/request_leader_campaign_abort.html">src/raft/testscripts/node/request_leader_campaign_abort</a> b/<a href="../file/src/raft/testscripts/node/request_leader_campaign_abort.html">src/raft/testscripts/node/request_leader_campaign_abort</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -15,8 +15,8 @@ n1@1 append 2@1 put foo=bar
</a> n1@1 → n2 Append base=1@1 [2@1]
 n1@1 → n3 Append base=1@1 [2@1]
 c1@1 → n1 ClientRequest id=0x02 read 0x0003666f6f
<a href="#h6-0-3" id="h6-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=1
</a><a href="#h6-0-4" id="h6-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=1
</a><a href="#h6-0-5" id="h6-0-5" class="i">+n1@1 → n2 Read seq=1
</a><a href="#h6-0-6" id="h6-0-6" class="i">+n1@1 → n3 Read seq=1
</a> 
 # n2 campaigns before n1&#39;s requests achieve quorum.
 campaign 2
<b>diff --git a/<a id="h7" href="../file/src/raft/testscripts/node/request_leader_change_linearizability.html">src/raft/testscripts/node/request_leader_change_linearizability</a> b/<a href="../file/src/raft/testscripts/node/request_leader_change_linearizability.html">src/raft/testscripts/node/request_leader_change_linearizability</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -64,33 +64,43 @@ deliver
</a> deliver
 ---
 c2@2 → n2 ClientRequest id=0x03 read 0x000162
<a href="#h7-0-3" id="h7-0-3" class="i">+n2@2 → n1 Read seq=1
</a><a href="#h7-0-4" id="h7-0-4" class="i">+n2@2 → n3 Read seq=1
</a><a href="#h7-0-5" id="h7-0-5" class="i">+n1@2 follower() ⇨ n1@2 follower(n2)
</a><a href="#h7-0-6" id="h7-0-6" class="i">+n1@2 → n2 ReadResponse seq=1
</a><a href="#h7-0-7" id="h7-0-7" class="i">+n3@2 follower() ⇨ n3@2 follower(n2)
</a><a href="#h7-0-8" id="h7-0-8" class="i">+n3@2 → n2 ReadResponse seq=1
</a><a href="#h7-0-9" id="h7-0-9" class="i">+
</a><a href="#h7-0-10" id="h7-0-10" class="i">+# The leader heartbeats and detects the lost appends.
</a><a href="#h7-0-11" id="h7-0-11" class="i">+heartbeat 2
</a><a href="#h7-0-12" id="h7-0-12" class="i">+deliver
</a><a href="#h7-0-13" id="h7-0-13" class="i">+deliver
</a><a href="#h7-0-14" id="h7-0-14" class="i">+deliver
</a><a href="#h7-0-15" id="h7-0-15" class="i">+---
</a> n2@2 → n1 Heartbeat last_index=4 commit_index=2 read_seq=1
 n2@2 → n3 Heartbeat last_index=4 commit_index=2 read_seq=1
<a href="#h7-0-18" id="h7-0-18" class="d">-n1@2 follower() ⇨ n1@2 follower(n2)
</a> n1@2 → n2 HeartbeatResponse match_index=0 read_seq=1
<a href="#h7-0-20" id="h7-0-20" class="d">-n3@2 follower() ⇨ n3@2 follower(n2)
</a> n3@2 → n2 HeartbeatResponse match_index=0 read_seq=1
 n2@2 → n1 Append base=3@1 []
 n2@2 → n3 Append base=3@1 []
<a href="#h7-0-24" id="h7-0-24" class="i">+n1@2 → n2 AppendResponse match_index=3
</a><a href="#h7-0-25" id="h7-0-25" class="i">+n3@2 → n2 AppendResponse match_index=3
</a> 
<a href="#h7-0-27" id="h7-0-27" class="d">-# However, the heartbeat resulted in probes for the dropped appends.
</a><a href="#h7-0-28" id="h7-0-28" class="d">-# The leader resends them.
</a><a href="#h7-0-29" id="h7-0-29" class="i">+# It resends the missing log entry.
</a> deliver
 deliver
 ---
<a href="#h7-0-33" id="h7-0-33" class="d">-n1@2 → n2 AppendResponse match_index=3
</a><a href="#h7-0-34" id="h7-0-34" class="d">-n3@2 → n2 AppendResponse match_index=3
</a> n2@2 → n1 Append base=3@1 [4@2]
 n2@2 → n3 Append base=3@1 [4@2]
<a href="#h7-0-37" id="h7-0-37" class="d">-
</a><a href="#h7-0-38" id="h7-0-38" class="d">-# Once the followers acknowledge the appends the leader commits them. The read
</a><a href="#h7-0-39" id="h7-0-39" class="d">-# can now be served, resulting in an up-to-date b=2.
</a><a href="#h7-0-40" id="h7-0-40" class="d">-stabilize
</a><a href="#h7-0-41" id="h7-0-41" class="d">----
</a> n1@2 append 4@2 None
 n1@2 → n2 AppendResponse match_index=4
 n3@2 append 4@2 None
 n3@2 → n2 AppendResponse match_index=4
<a href="#h7-0-46" id="h7-0-46" class="i">+
</a><a href="#h7-0-47" id="h7-0-47" class="i">+# Once the leader receives the acks it commits the entry. The read can now be
</a><a href="#h7-0-48" id="h7-0-48" class="i">+# served, resulting in an up-to-date b=2.
</a><a href="#h7-0-49" id="h7-0-49" class="i">+stabilize
</a><a href="#h7-0-50" id="h7-0-50" class="i">+---
</a> n2@2 commit 4@2
 n2@2 apply 3@1 put b=2
 n2@2 apply 4@2 None
<b>diff --git a/<a id="h8" href="../file/src/raft/testscripts/node/request_leader_disconnect.html">src/raft/testscripts/node/request_leader_disconnect</a> b/<a href="../file/src/raft/testscripts/node/request_leader_disconnect.html">src/raft/testscripts/node/request_leader_disconnect</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -22,8 +22,8 @@ n1@1 append 2@1 put foo=bar
</a> n1@1 ⇥ n2 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶1̶@̶1̶ ̶[̶2̶@̶1̶]̶
 n1@1 ⇥ n3 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶1̶@̶1̶ ̶[̶2̶@̶1̶]̶
 c1@1 → n1 ClientRequest id=0x02 read 0x0003666f6f
<a href="#h8-0-3" id="h8-0-3" class="d">-n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a><a href="#h8-0-4" id="h8-0-4" class="d">-n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a><a href="#h8-0-5" id="h8-0-5" class="i">+n1@1 ⇥ n2 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a><a href="#h8-0-6" id="h8-0-6" class="i">+n1@1 ⇥ n3 R̶e̶a̶d̶ ̶s̶e̶q̶=̶1̶
</a> 
 # Heal the partition and heartbeat. The requests eventually return results.
 heal
<b>diff --git a/<a id="h9" href="../file/src/raft/testscripts/node/request_leader_read_quorum.html">src/raft/testscripts/node/request_leader_read_quorum</a> b/<a href="../file/src/raft/testscripts/node/request_leader_read_quorum.html">src/raft/testscripts/node/request_leader_read_quorum</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -25,20 +25,20 @@ ok
</a> get 1 foo
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h9-0-3" id="h9-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h9-0-4" id="h9-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h9-0-5" id="h9-0-5" class="d">-n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h9-0-6" id="h9-0-6" class="d">-n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h9-0-7" id="h9-0-7" class="i">+n1@1 → n2 Read seq=2
</a><a href="#h9-0-8" id="h9-0-8" class="i">+n1@1 → n3 Read seq=2
</a><a href="#h9-0-9" id="h9-0-9" class="i">+n1@1 → n4 Read seq=2
</a><a href="#h9-0-10" id="h9-0-10" class="i">+n1@1 → n5 Read seq=2
</a> 
 deliver 2
 deliver 1
 ---
<a href="#h9-0-15" id="h9-0-15" class="d">-n2@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h9-0-16" id="h9-0-16" class="i">+n2@1 → n1 ReadResponse seq=2
</a> 
 deliver 3
 deliver 1
 ---
<a href="#h9-0-21" id="h9-0-21" class="d">-n3@1 → n1 HeartbeatResponse match_index=2 read_seq=2
</a><a href="#h9-0-22" id="h9-0-22" class="i">+n3@1 → n1 ReadResponse seq=2
</a> n1@1 → c1 ClientResponse id=0x03 read 0x000103626172
 c1@1 get foo ⇒ bar
 
<b>diff --git a/<a id="h10" href="../file/src/raft/testscripts/node/request_leader_read_quorum_sequence.html">src/raft/testscripts/node/request_leader_read_quorum_sequence</a> b/<a href="../file/src/raft/testscripts/node/request_leader_read_quorum_sequence.html">src/raft/testscripts/node/request_leader_read_quorum_sequence</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -35,14 +35,14 @@ partition 1
</a> ---
 n1 ⇹ n2 n3 n4 n5
 
<a href="#h10-0-3" id="h10-0-3" class="d">-# Perform a read at sequence number 2. The heartbeats are lost.
</a><a href="#h10-0-4" id="h10-0-4" class="i">+# Perform a read at sequence number 2. The read messages are lost.
</a> get 1 foo
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h10-0-8" id="h10-0-8" class="d">-n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-9" id="h10-0-9" class="d">-n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-10" id="h10-0-10" class="d">-n1@1 ⇥ n4 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-11" id="h10-0-11" class="d">-n1@1 ⇥ n5 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-12" id="h10-0-12" class="i">+n1@1 ⇥ n2 R̶e̶a̶d̶ ̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-13" id="h10-0-13" class="i">+n1@1 ⇥ n3 R̶e̶a̶d̶ ̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-14" id="h10-0-14" class="i">+n1@1 ⇥ n4 R̶e̶a̶d̶ ̶s̶e̶q̶=̶2̶
</a><a href="#h10-0-15" id="h10-0-15" class="i">+n1@1 ⇥ n5 R̶e̶a̶d̶ ̶s̶e̶q̶=̶2̶
</a> 
 # Deliver the heartbeat responses at sequence number 1. These should not satisfy
 # the read at sequence number 2.
<a href="#h10-1" id="h10-1" class="h">@@ -51,26 +51,26 @@ deliver 1
</a> ok
 
 # Heal the partition and perform another read at sequence number 3. Followers
<a href="#h10-1-3" id="h10-1-3" class="d">-# respond to the heartbeats at sequence number 3.
</a><a href="#h10-1-4" id="h10-1-4" class="i">+# respond to the reads at sequence number 3.
</a> heal
 get 1 foo
 ---
 n1 n2 n3 n4 n5 fully connected
 c1@1 → n1 ClientRequest id=0x04 read 0x0003666f6f
<a href="#h10-1-10" id="h10-1-10" class="d">-n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h10-1-11" id="h10-1-11" class="d">-n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h10-1-12" id="h10-1-12" class="d">-n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h10-1-13" id="h10-1-13" class="d">-n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h10-1-14" id="h10-1-14" class="i">+n1@1 → n2 Read seq=3
</a><a href="#h10-1-15" id="h10-1-15" class="i">+n1@1 → n3 Read seq=3
</a><a href="#h10-1-16" id="h10-1-16" class="i">+n1@1 → n4 Read seq=3
</a><a href="#h10-1-17" id="h10-1-17" class="i">+n1@1 → n5 Read seq=3
</a> 
 deliver
 ---
<a href="#h10-1-21" id="h10-1-21" class="d">-n2@1 → n1 HeartbeatResponse match_index=2 read_seq=3
</a><a href="#h10-1-22" id="h10-1-22" class="d">-n3@1 → n1 HeartbeatResponse match_index=2 read_seq=3
</a><a href="#h10-1-23" id="h10-1-23" class="d">-n4@1 → n1 HeartbeatResponse match_index=2 read_seq=3
</a><a href="#h10-1-24" id="h10-1-24" class="d">-n5@1 → n1 HeartbeatResponse match_index=2 read_seq=3
</a><a href="#h10-1-25" id="h10-1-25" class="i">+n2@1 → n1 ReadResponse seq=3
</a><a href="#h10-1-26" id="h10-1-26" class="i">+n3@1 → n1 ReadResponse seq=3
</a><a href="#h10-1-27" id="h10-1-27" class="i">+n4@1 → n1 ReadResponse seq=3
</a><a href="#h10-1-28" id="h10-1-28" class="i">+n5@1 → n1 ReadResponse seq=3
</a> 
<a href="#h10-1-30" id="h10-1-30" class="d">-# Once n1 receives two heartbeat responses it has a read quorum and
</a><a href="#h10-1-31" id="h10-1-31" class="d">-# serves both the read at seqnums 2 (id=0x03) and 3 (id=0x04).
</a><a href="#h10-1-32" id="h10-1-32" class="i">+# Once n1 receives two responses it has a read quorum and serves both the read
</a><a href="#h10-1-33" id="h10-1-33" class="i">+# at seqnums 2 (id=0x03) and 3 (id=0x04).
</a> deliver 1 from=3
 deliver 1 from=5
 ---
</pre>
</div>
</body>
</html>
