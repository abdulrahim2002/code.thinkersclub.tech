<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: add `DROP TABLE IF EXISTS` support - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/fe0ed7243fb90b321c59d5e609cff758e3e36d50.html">fe0ed7243fb90b321c59d5e609cff758e3e36d50</a>
<b>parent</b> <a href="../commit/b7322de1e1a081779af8dabad9423b334e2e88b3.html">b7322de1e1a081779af8dabad9423b334e2e88b3</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat,  6 Apr 2024 10:05:08 +0200

sql: add `DROP TABLE IF EXISTS` support

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">docs/sql.md</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/bin/toysql.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/execution/mod.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/execution/schema.rs</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/parser/ast.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/parser/lexer.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/parser/mod.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/plan/mod.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/plan/planner.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">tests/sql/schema.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">tests/sql/schema/drop_table</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">tests/sql/schema/drop_table_if_exists</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">tests/sql/schema/drop_table_if_exists_missing</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">tests/sql/schema/drop_table_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">tests/sql/schema/drop_table_ref_source</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>15 files changed, 90 insertions(+), 20 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/docs/sql.md.html">docs/sql.md</a> b/<a href="../file/docs/sql.md.html">docs/sql.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -19,7 +19,7 @@ Numeric types are not interchangable; a float value (even without a fractional p
</a> 
 Keywords are reserved words with special meaning in SQL statements. They are case-insensitive, and must be quoted with `&quot;` to be used as identifiers. The complete list is:
 
<a href="#h0-0-3" id="h0-0-3" class="d">-`AS`, `ASC`, `AND`, `BEGIN`, `BOOL`, `BOOLEAN`, `BY`, `CHAR`, `COMMIT`, `CREATE`, `CROSS`, `DEFAULT`,`DELETE`, `DESC`, `DOUBLE`, `DROP`, `EXPLAIN`, `FALSE`, `FLOAT`, `FROM`, `GROUP`, `HAVING`, `INDEX`, `INFINITY`, `INNER`, `INSERT`, `INT`, `INTEGER`, `INTO`, `IS`, `JOIN`, `KEY`, `LEFT`, `LIKE`, `LIMIT`, `NAN`, `NOT`, `NULL`, `OF`, `OFFSET`, `ON`, `ONLY`, `OR`, `ORDER`, `OUTER`, `PRIMARY`, `READ`, `REFERENCES`, `RIGHT`, `ROLLBACK`, `SELECT`, `SET`, `STRING`, `SYSTEM`, `TABLE`, `TEXT`, `TIME`, `TRANSACTION`, `TRUE`, `UNIQUE`, `UPDATE`, `VALUES`, `VARCHAR`, `WHERE`, `WRITE`
</a><a href="#h0-0-4" id="h0-0-4" class="i">+`AS`, `ASC`, `AND`, `BEGIN`, `BOOL`, `BOOLEAN`, `BY`, `CHAR`, `COMMIT`, `CREATE`, `CROSS`, `DEFAULT`,`DELETE`, `DESC`, `DOUBLE`, `DROP`, `EXISTS`, `EXPLAIN`, `FALSE`, `FLOAT`, `FROM`, `GROUP`, `HAVING`, `IF`, `INDEX`, `INFINITY`, `INNER`, `INSERT`, `INT`, `INTEGER`, `INTO`, `IS`, `JOIN`, `KEY`, `LEFT`, `LIKE`, `LIMIT`, `NAN`, `NOT`, `NULL`, `OF`, `OFFSET`, `ON`, `ONLY`, `OR`, `ORDER`, `OUTER`, `PRIMARY`, `READ`, `REFERENCES`, `RIGHT`, `ROLLBACK`, `SELECT`, `SET`, `STRING`, `SYSTEM`, `TABLE`, `TEXT`, `TIME`, `TRANSACTION`, `TRUE`, `UNIQUE`, `UPDATE`, `VALUES`, `VARCHAR`, `WHERE`, `WRITE`
</a> 
 ### Identifiers
 
<a href="#h0-1" id="h0-1" class="h">@@ -74,19 +74,19 @@ Logical operators apply standard logic operations on boolean operands.
</a> The complete truth tables are:
 
 | `AND`       | `TRUE`  | `FALSE` | `NULL`  |
<a href="#h0-1-3" id="h0-1-3" class="d">-| ----------- | ------- | ------- | ------- |
</a><a href="#h0-1-4" id="h0-1-4" class="i">+|-------------|---------|---------|---------|
</a> | **`TRUE`**  | `TRUE`  | `FALSE` | `NULL`  |
 | **`FALSE`** | `FALSE` | `FALSE` | `FALSE` |
 | **`NULL`**  | `NULL`  | `FALSE` | `NULL`  |
 
 | `OR`        | `TRUE` | `FALSE` | `NULL` |
<a href="#h0-1-10" id="h0-1-10" class="d">-| ----------- | ------ | ------- | ------ |
</a><a href="#h0-1-11" id="h0-1-11" class="i">+|-------------|--------|---------|--------|
</a> | **`TRUE`**  | `TRUE` | `TRUE`  | `TRUE` |
 | **`FALSE`** | `TRUE` | `FALSE` | `NULL` |
 | **`NULL`**  | `TRUE` | `NULL`  | `NULL` |
 
 | `NOT`       |         |
<a href="#h0-1-17" id="h0-1-17" class="d">-| ----------- | ------- |
</a><a href="#h0-1-18" id="h0-1-18" class="i">+|-------------|---------|
</a> | **`TRUE`**  | `FALSE` |
 | **`FALSE`** | `TRUE`  |
 | **`NULL`**  | `NULL`  |
<a href="#h0-2" id="h0-2" class="h">@@ -141,7 +141,7 @@ String operators operate on string operands.
</a> The operator precedence (order of operations) is as follows:
 
 | Precedence | Operator                 | Associativity |
<a href="#h0-2-3" id="h0-2-3" class="d">-| ---------- | ------------------------ | ------------- |
</a><a href="#h0-2-4" id="h0-2-4" class="i">+|------------|--------------------------|---------------|
</a> | 9          | `+`, `-`, `NOT` (prefix) | Right         |
 | 8          | `!`, `IS` (postfix)      | Left          |
 | 7          | `^`                      | Right         |
<a href="#h0-3" id="h0-3" class="h">@@ -254,13 +254,14 @@ WHERE release_year &lt; 2000 AND bluray = FALSE
</a> 
 ### `DROP TABLE`
 
<a href="#h0-3-3" id="h0-3-3" class="d">-Deletes a table and all contained data.
</a><a href="#h0-3-4" id="h0-3-4" class="i">+Deletes a table and all contained data. Errors if the table does not
</a><a href="#h0-3-5" id="h0-3-5" class="i">+exist, unless `IF EXISTS` is given.
</a> 
 &lt;pre&gt;
<a href="#h0-3-8" id="h0-3-8" class="d">-DROP TABLE &lt;b&gt;&lt;i&gt;table_name&lt;/i&gt;&lt;/b&gt;
</a><a href="#h0-3-9" id="h0-3-9" class="i">+DROP TABLE [ IF EXISTS ] &lt;b&gt;&lt;i&gt;table_name&lt;/i&gt;&lt;/b&gt;
</a> &lt;/pre&gt;
 
<a href="#h0-3-12" id="h0-3-12" class="d">-* ***`table_name`***: the table to delete. Errors if it does not exist.
</a><a href="#h0-3-13" id="h0-3-13" class="i">+* ***`table_name`***: the table to delete.
</a> 
 ### `EXPLAIN`
 
<b>diff --git a/<a id="h1" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -192,7 +192,10 @@ Storage:   {keys} keys, {logical_size} MB logical, {nodes}x {disk_size} MB disk,
</a>             ResultSet::Delete { count } =&gt; println!(&quot;Deleted {} rows&quot;, count),
             ResultSet::Update { count } =&gt; println!(&quot;Updated {} rows&quot;, count),
             ResultSet::CreateTable { name } =&gt; println!(&quot;Created table {}&quot;, name),
<a href="#h1-0-3" id="h1-0-3" class="d">-            ResultSet::DropTable { name } =&gt; println!(&quot;Dropped table {}&quot;, name),
</a><a href="#h1-0-4" id="h1-0-4" class="i">+            ResultSet::DropTable { name, existed } =&gt; match existed {
</a><a href="#h1-0-5" id="h1-0-5" class="i">+                true =&gt; println!(&quot;Dropped table {}&quot;, name),
</a><a href="#h1-0-6" id="h1-0-6" class="i">+                false =&gt; println!(&quot;Table {} did not exit&quot;, name),
</a><a href="#h1-0-7" id="h1-0-7" class="i">+            },
</a>             ResultSet::Explain(plan) =&gt; println!(&quot;{}&quot;, plan),
             ResultSet::Query { columns, mut rows } =&gt; {
                 if self.show_headers {
<b>diff --git a/<a id="h2" href="../file/src/sql/execution/mod.rs.html">src/sql/execution/mod.rs</a> b/<a href="../file/src/sql/execution/mod.rs.html">src/sql/execution/mod.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -35,7 +35,7 @@ impl&lt;T: Transaction + &#39;static&gt; dyn Executor&lt;T&gt; {
</a>             }
             Node::CreateTable { schema } =&gt; CreateTable::new(schema),
             Node::Delete { table, source } =&gt; Delete::new(table, Self::build(*source)),
<a href="#h2-0-3" id="h2-0-3" class="d">-            Node::DropTable { table } =&gt; DropTable::new(table),
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            Node::DropTable { table, if_exists } =&gt; DropTable::new(table, if_exists),
</a>             Node::Filter { source, predicate } =&gt; Filter::new(Self::build(*source), predicate),
             Node::HashJoin { left, left_field, right, right_field, outer } =&gt; HashJoin::new(
                 Self::build(*left),
<a href="#h2-1" id="h2-1" class="h">@@ -107,6 +107,7 @@ pub enum ResultSet {
</a>     // Table dropped
     DropTable {
         name: String,
<a href="#h2-1-3" id="h2-1-3" class="i">+        existed: bool,
</a>     },
     // Query result
     Query {
<b>diff --git a/<a id="h3" href="../file/src/sql/execution/schema.rs.html">src/sql/execution/schema.rs</a> b/<a href="../file/src/sql/execution/schema.rs.html">src/sql/execution/schema.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -25,17 +25,21 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for CreateTable {
</a> /// A DROP TABLE executor
 pub struct DropTable {
     table: String,
<a href="#h3-0-3" id="h3-0-3" class="i">+    if_exists: bool,
</a> }
 
 impl DropTable {
<a href="#h3-0-7" id="h3-0-7" class="d">-    pub fn new(table: String) -&gt; Box&lt;Self&gt; {
</a><a href="#h3-0-8" id="h3-0-8" class="d">-        Box::new(Self { table })
</a><a href="#h3-0-9" id="h3-0-9" class="i">+    pub fn new(table: String, if_exists: bool) -&gt; Box&lt;Self&gt; {
</a><a href="#h3-0-10" id="h3-0-10" class="i">+        Box::new(Self { table, if_exists })
</a>     }
 }
 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for DropTable {
     fn execute(self: Box&lt;Self&gt;, txn: &amp;mut T) -&gt; Result&lt;ResultSet&gt; {
<a href="#h3-0-16" id="h3-0-16" class="i">+        if self.if_exists &amp;&amp; txn.read_table(&amp;self.table)?.is_none() {
</a><a href="#h3-0-17" id="h3-0-17" class="i">+            return Ok(ResultSet::DropTable { name: self.table, existed: false });
</a><a href="#h3-0-18" id="h3-0-18" class="i">+        }
</a>         txn.delete_table(&amp;self.table)?;
<a href="#h3-0-20" id="h3-0-20" class="d">-        Ok(ResultSet::DropTable { name: self.table })
</a><a href="#h3-0-21" id="h3-0-21" class="i">+        Ok(ResultSet::DropTable { name: self.table, existed: true })
</a>     }
 }
<b>diff --git a/<a id="h4" href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a> b/<a href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -20,7 +20,10 @@ pub enum Statement {
</a>         name: String,
         columns: Vec&lt;Column&gt;,
     },
<a href="#h4-0-3" id="h4-0-3" class="d">-    DropTable(String),
</a><a href="#h4-0-4" id="h4-0-4" class="i">+    DropTable {
</a><a href="#h4-0-5" id="h4-0-5" class="i">+        name: String,
</a><a href="#h4-0-6" id="h4-0-6" class="i">+        if_exists: bool,
</a><a href="#h4-0-7" id="h4-0-7" class="i">+    },
</a> 
     Delete {
         table: String,
<b>diff --git a/<a id="h5" href="../file/src/sql/parser/lexer.rs.html">src/sql/parser/lexer.rs</a> b/<a href="../file/src/sql/parser/lexer.rs.html">src/sql/parser/lexer.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -88,12 +88,14 @@ pub enum Keyword {
</a>     Desc,
     Double,
     Drop,
<a href="#h5-0-3" id="h5-0-3" class="i">+    Exists,
</a>     Explain,
     False,
     Float,
     From,
     Group,
     Having,
<a href="#h5-0-10" id="h5-0-10" class="i">+    If,
</a>     Index,
     Infinity,
     Inner,
<a href="#h5-1" id="h5-1" class="h">@@ -159,12 +161,14 @@ impl Keyword {
</a>             &quot;DESC&quot; =&gt; Self::Desc,
             &quot;DOUBLE&quot; =&gt; Self::Double,
             &quot;DROP&quot; =&gt; Self::Drop,
<a href="#h5-1-3" id="h5-1-3" class="i">+            &quot;EXISTS&quot; =&gt; Self::Exists,
</a>             &quot;EXPLAIN&quot; =&gt; Self::Explain,
             &quot;FALSE&quot; =&gt; Self::False,
             &quot;FLOAT&quot; =&gt; Self::Float,
             &quot;FROM&quot; =&gt; Self::From,
             &quot;GROUP&quot; =&gt; Self::Group,
             &quot;HAVING&quot; =&gt; Self::Having,
<a href="#h5-1-10" id="h5-1-10" class="i">+            &quot;IF&quot; =&gt; Self::If,
</a>             &quot;INDEX&quot; =&gt; Self::Index,
             &quot;INFINITY&quot; =&gt; Self::Infinity,
             &quot;INNER&quot; =&gt; Self::Inner,
<a href="#h5-2" id="h5-2" class="h">@@ -230,12 +234,14 @@ impl Keyword {
</a>             Self::Desc =&gt; &quot;DESC&quot;,
             Self::Double =&gt; &quot;DOUBLE&quot;,
             Self::Drop =&gt; &quot;DROP&quot;,
<a href="#h5-2-3" id="h5-2-3" class="i">+            Self::Exists =&gt; &quot;EXISTS&quot;,
</a>             Self::Explain =&gt; &quot;EXPLAIN&quot;,
             Self::False =&gt; &quot;FALSE&quot;,
             Self::Float =&gt; &quot;FLOAT&quot;,
             Self::From =&gt; &quot;FROM&quot;,
             Self::Group =&gt; &quot;GROUP&quot;,
             Self::Having =&gt; &quot;HAVING&quot;,
<a href="#h5-2-10" id="h5-2-10" class="i">+            Self::If =&gt; &quot;IF&quot;,
</a>             Self::Index =&gt; &quot;INDEX&quot;,
             Self::Infinity =&gt; &quot;INFINITY&quot;,
             Self::Inner =&gt; &quot;INNER&quot;,
<b>diff --git a/<a id="h6" href="../file/src/sql/parser/mod.rs.html">src/sql/parser/mod.rs</a> b/<a href="../file/src/sql/parser/mod.rs.html">src/sql/parser/mod.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -153,7 +153,13 @@ impl&lt;&#39;a&gt; Parser&lt;&#39;a&gt; {
</a>     /// Parses a DROP TABLE DDL statement. The DROP TABLE prefix has
     /// already been consumed.
     fn parse_ddl_drop_table(&amp;mut self) -&gt; Result&lt;ast::Statement&gt; {
<a href="#h6-0-3" id="h6-0-3" class="d">-        Ok(ast::Statement::DropTable(self.next_ident()?))
</a><a href="#h6-0-4" id="h6-0-4" class="i">+        let mut if_exists = false;
</a><a href="#h6-0-5" id="h6-0-5" class="i">+        if let Some(Token::Keyword(Keyword::If)) = self.next_if_keyword() {
</a><a href="#h6-0-6" id="h6-0-6" class="i">+            self.next_expect(Some(Token::Keyword(Keyword::Exists)))?;
</a><a href="#h6-0-7" id="h6-0-7" class="i">+            if_exists = true;
</a><a href="#h6-0-8" id="h6-0-8" class="i">+        }
</a><a href="#h6-0-9" id="h6-0-9" class="i">+        let name = self.next_ident()?;
</a><a href="#h6-0-10" id="h6-0-10" class="i">+        Ok(ast::Statement::DropTable { name, if_exists })
</a>     }
 
     /// Parses a column specification
<b>diff --git a/<a id="h7" href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a> b/<a href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -62,6 +62,7 @@ pub enum Node {
</a>     },
     DropTable {
         table: String,
<a href="#h7-0-3" id="h7-0-3" class="i">+        if_exists: bool,
</a>     },
     Filter {
         source: Box&lt;Node&gt;,
<a href="#h7-1" id="h7-1" class="h">@@ -280,7 +281,7 @@ impl Node {
</a>                 s += &amp;format!(&quot;Delete: {}\n&quot;, table);
                 s += &amp;source.format(indent, false, true);
             }
<a href="#h7-1-3" id="h7-1-3" class="d">-            Self::DropTable { table } =&gt; {
</a><a href="#h7-1-4" id="h7-1-4" class="i">+            Self::DropTable { table, if_exists: _ } =&gt; {
</a>                 s += &amp;format!(&quot;DropTable: {}\n&quot;, table);
             }
             Self::Filter { source, predicate } =&gt; {
<b>diff --git a/<a id="h8" href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a> b/<a href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -66,7 +66,9 @@ impl&lt;&#39;a, C: Catalog&gt; Planner&lt;&#39;a, C&gt; {
</a>                 )?,
             },
 
<a href="#h8-0-3" id="h8-0-3" class="d">-            ast::Statement::DropTable(table) =&gt; Node::DropTable { table },
</a><a href="#h8-0-4" id="h8-0-4" class="i">+            ast::Statement::DropTable { name, if_exists } =&gt; {
</a><a href="#h8-0-5" id="h8-0-5" class="i">+                Node::DropTable { table: name, if_exists }
</a><a href="#h8-0-6" id="h8-0-6" class="i">+            }
</a> 
             // DML statements (mutations).
             ast::Statement::Delete { table, r#where } =&gt; {
<b>diff --git a/<a id="h9" href="../file/tests/sql/schema.rs.html">tests/sql/schema.rs</a> b/<a href="../file/tests/sql/schema.rs.html">tests/sql/schema.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -149,6 +149,8 @@ test_schema! { with [
</a>     drop_table_bare: &quot;DROP TABLE&quot;,
     drop_table_missing: &quot;DROP TABLE name&quot;,
     drop_table_multiple: &quot;DROP TABLE a, c&quot;,
<a href="#h9-0-3" id="h9-0-3" class="i">+    drop_table_if_exists: &quot;DROP TABLE IF EXISTS a&quot;,
</a><a href="#h9-0-4" id="h9-0-4" class="i">+    drop_table_if_exists_missing: &quot;DROP TABLE IF EXISTS name&quot;,
</a> }
 test_schema! { with [
         &quot;CREATE TABLE target (id INTEGER PRIMARY KEY)&quot;,
<b>diff --git a/<a id="h10" href="../file/tests/sql/schema/drop_table.html">tests/sql/schema/drop_table</a> b/<a href="../file/tests/sql/schema/drop_table.html">tests/sql/schema/drop_table</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE a
<a href="#h10-0-1" id="h10-0-1" class="d">-Result: DropTable { name: &quot;a&quot; }
</a><a href="#h10-0-2" id="h10-0-2" class="i">+Result: DropTable { name: &quot;a&quot;, existed: true }
</a> 
 Storage:
 CREATE TABLE b (
<b>diff --git a/<a id="h11" href="../file/tests/sql/schema/drop_table_if_exists.html">tests/sql/schema/drop_table_if_exists</a> b/<a href="../file/tests/sql/schema/drop_table_if_exists.html">tests/sql/schema/drop_table_if_exists</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+Query: DROP TABLE IF EXISTS a
</a><a href="#h11-0-1" id="h11-0-1" class="i">+Result: DropTable { name: &quot;a&quot;, existed: true }
</a><a href="#h11-0-2" id="h11-0-2" class="i">+
</a><a href="#h11-0-3" id="h11-0-3" class="i">+Storage:
</a><a href="#h11-0-4" id="h11-0-4" class="i">+CREATE TABLE b (
</a><a href="#h11-0-5" id="h11-0-5" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h11-0-6" id="h11-0-6" class="i">+)
</a><a href="#h11-0-7" id="h11-0-7" class="i">+[Integer(21)]
</a><a href="#h11-0-8" id="h11-0-8" class="i">+[Integer(22)]
</a><a href="#h11-0-9" id="h11-0-9" class="i">+[Integer(23)]
</a><a href="#h11-0-10" id="h11-0-10" class="i">+
</a><a href="#h11-0-11" id="h11-0-11" class="i">+CREATE TABLE c (
</a><a href="#h11-0-12" id="h11-0-12" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h11-0-13" id="h11-0-13" class="i">+)
</a><a href="#h11-0-14" id="h11-0-14" class="i">+[Integer(31)]
</a><a href="#h11-0-15" id="h11-0-15" class="i">+[Integer(32)]
</a><a href="#h11-0-16" id="h11-0-16" class="i">+[Integer(33)]
</a><b>diff --git a/<a id="h12" href="../file/tests/sql/schema/drop_table_if_exists_missing.html">tests/sql/schema/drop_table_if_exists_missing</a> b/<a href="../file/tests/sql/schema/drop_table_if_exists_missing.html">tests/sql/schema/drop_table_if_exists_missing</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+Query: DROP TABLE IF EXISTS name
</a><a href="#h12-0-1" id="h12-0-1" class="i">+Result: DropTable { name: &quot;name&quot;, existed: false }
</a><a href="#h12-0-2" id="h12-0-2" class="i">+
</a><a href="#h12-0-3" id="h12-0-3" class="i">+Storage:
</a><a href="#h12-0-4" id="h12-0-4" class="i">+CREATE TABLE a (
</a><a href="#h12-0-5" id="h12-0-5" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h12-0-6" id="h12-0-6" class="i">+)
</a><a href="#h12-0-7" id="h12-0-7" class="i">+[Integer(11)]
</a><a href="#h12-0-8" id="h12-0-8" class="i">+[Integer(12)]
</a><a href="#h12-0-9" id="h12-0-9" class="i">+[Integer(13)]
</a><a href="#h12-0-10" id="h12-0-10" class="i">+
</a><a href="#h12-0-11" id="h12-0-11" class="i">+CREATE TABLE b (
</a><a href="#h12-0-12" id="h12-0-12" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h12-0-13" id="h12-0-13" class="i">+)
</a><a href="#h12-0-14" id="h12-0-14" class="i">+[Integer(21)]
</a><a href="#h12-0-15" id="h12-0-15" class="i">+[Integer(22)]
</a><a href="#h12-0-16" id="h12-0-16" class="i">+[Integer(23)]
</a><a href="#h12-0-17" id="h12-0-17" class="i">+
</a><a href="#h12-0-18" id="h12-0-18" class="i">+CREATE TABLE c (
</a><a href="#h12-0-19" id="h12-0-19" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h12-0-20" id="h12-0-20" class="i">+)
</a><a href="#h12-0-21" id="h12-0-21" class="i">+[Integer(31)]
</a><a href="#h12-0-22" id="h12-0-22" class="i">+[Integer(32)]
</a><a href="#h12-0-23" id="h12-0-23" class="i">+[Integer(33)]
</a><b>diff --git a/<a id="h13" href="../file/tests/sql/schema/drop_table_ref_self.html">tests/sql/schema/drop_table_ref_self</a> b/<a href="../file/tests/sql/schema/drop_table_ref_self.html">tests/sql/schema/drop_table_ref_self</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE self
<a href="#h13-0-1" id="h13-0-1" class="d">-Result: DropTable { name: &quot;self&quot; }
</a><a href="#h13-0-2" id="h13-0-2" class="i">+Result: DropTable { name: &quot;self&quot;, existed: true }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h14" href="../file/tests/sql/schema/drop_table_ref_source.html">tests/sql/schema/drop_table_ref_source</a> b/<a href="../file/tests/sql/schema/drop_table_ref_source.html">tests/sql/schema/drop_table_ref_source</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE source
<a href="#h14-0-1" id="h14-0-1" class="d">-Result: DropTable { name: &quot;source&quot; }
</a><a href="#h14-0-2" id="h14-0-2" class="i">+Result: DropTable { name: &quot;source&quot;, existed: true }
</a> 
 Storage:
 CREATE TABLE self (
</pre>
</div>
</body>
</html>
