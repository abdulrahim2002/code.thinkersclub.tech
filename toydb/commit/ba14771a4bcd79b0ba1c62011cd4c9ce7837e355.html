<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: added support for default values - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/ba14771a4bcd79b0ba1c62011cd4c9ce7837e355.html">ba14771a4bcd79b0ba1c62011cd4c9ce7837e355</a>
<b>parent</b> <a href="../commit/322bc5079cccb3c2e8db25ab3bd583d62c45e46e.html">322bc5079cccb3c2e8db25ab3bd583d62c45e46e</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Fri, 10 Jan 2020 11:13:21 +0100

sql: added support for default values

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/sql/executor/insert.rs</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++</span><span class="d">--------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h1">src/sql/tests/results/insert_default_null</a></td><td> | </td><td class="num">134</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/tests/results/insert_error_columns_duplicate</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">src/sql/tests/results/insert_error_default_null_disallowed</a></td><td> | </td><td class="num">61</td><td><span class="i"></span><span class="d">-------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">src/sql/tests/results/insert_error_null_disallowed</a></td><td> | </td><td class="num">72</td><td><span class="i"></span><span class="d">------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/tests/schema.rs</a></td><td> | </td><td class="num">29</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">src/sql/tests/schema/insert_default</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">src/sql/tests/schema/insert_default_missing</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">src/sql/tests/schema/insert_default_override</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">src/sql/tests/schema/insert_default_override_null</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">src/sql/tests/schema/insert_default_unnamed</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">src/sql/tests/schema/insert_nulls</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">src/sql/tests/schema/insert_nulls_default</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">src/sql/tests/schema/insert_nulls_required</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">src/sql/tests/sql.rs</a></td><td> | </td><td class="num">3</td><td><span class="i"></span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">src/sql/types/schema.rs</a></td><td> | </td><td class="num">59</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
</table></pre><pre>16 files changed, 170 insertions(+), 302 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/sql/executor/insert.rs.html">src/sql/executor/insert.rs</a> b/<a href="../file/src/sql/executor/insert.rs.html">src/sql/executor/insert.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -17,16 +17,15 @@ impl Insert {
</a>             .txn
             .read_table(table)?
             .ok_or_else(|| Error::Value(format!(&quot;Table {} does not exist&quot;, table)))?;
<a href="#h0-0-3" id="h0-0-3" class="i">+        let env = Environment::empty();
</a>         for exprs in expressions {
<a href="#h0-0-5" id="h0-0-5" class="d">-            let mut row = Row::new();
</a><a href="#h0-0-6" id="h0-0-6" class="d">-            for expr in exprs {
</a><a href="#h0-0-7" id="h0-0-7" class="d">-                row.push(expr.evaluate(&amp;Environment::empty())?);
</a><a href="#h0-0-8" id="h0-0-8" class="d">-            }
</a><a href="#h0-0-9" id="h0-0-9" class="d">-            row = table.normalize_row(
</a><a href="#h0-0-10" id="h0-0-10" class="d">-                row,
</a><a href="#h0-0-11" id="h0-0-11" class="d">-                if !columns.is_empty() { Some(columns.clone()) } else { None },
</a><a href="#h0-0-12" id="h0-0-12" class="i">+            ctx.txn.create(
</a><a href="#h0-0-13" id="h0-0-13" class="i">+                &amp;table.name,
</a><a href="#h0-0-14" id="h0-0-14" class="i">+                table.make_row(
</a><a href="#h0-0-15" id="h0-0-15" class="i">+                    exprs.into_iter().map(|e| e.evaluate(&amp;env)).collect::&lt;Result&lt;_, Error&gt;&gt;()?,
</a><a href="#h0-0-16" id="h0-0-16" class="i">+                    if !columns.is_empty() { Some(&amp;columns) } else { None },
</a><a href="#h0-0-17" id="h0-0-17" class="i">+                )?,
</a>             )?;
<a href="#h0-0-19" id="h0-0-19" class="d">-            ctx.txn.create(&amp;table.name, row)?;
</a>         }
         Ok(Box::new(Self))
     }
<b>diff --git a/<a id="h1" href="../file/src/sql/tests/results/insert_default_null.html">src/sql/tests/results/insert_default_null</a> b/<a href="../file/src/sql/tests/results/insert_default_null.html">src/sql/tests/results/insert_default_null</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,134 +0,0 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-Query: INSERT INTO movies VALUES (9, &#39;District 9&#39;, 1, 2009)
</a><a href="#h1-0-1" id="h1-0-1" class="d">-
</a><a href="#h1-0-2" id="h1-0-2" class="d">-Tokens:
</a><a href="#h1-0-3" id="h1-0-3" class="d">-  Keyword(Insert)
</a><a href="#h1-0-4" id="h1-0-4" class="d">-  Keyword(Into)
</a><a href="#h1-0-5" id="h1-0-5" class="d">-  Ident(&quot;movies&quot;)
</a><a href="#h1-0-6" id="h1-0-6" class="d">-  Keyword(Values)
</a><a href="#h1-0-7" id="h1-0-7" class="d">-  OpenParen
</a><a href="#h1-0-8" id="h1-0-8" class="d">-  Number(&quot;9&quot;)
</a><a href="#h1-0-9" id="h1-0-9" class="d">-  Comma
</a><a href="#h1-0-10" id="h1-0-10" class="d">-  String(&quot;District 9&quot;)
</a><a href="#h1-0-11" id="h1-0-11" class="d">-  Comma
</a><a href="#h1-0-12" id="h1-0-12" class="d">-  Number(&quot;1&quot;)
</a><a href="#h1-0-13" id="h1-0-13" class="d">-  Comma
</a><a href="#h1-0-14" id="h1-0-14" class="d">-  Number(&quot;2009&quot;)
</a><a href="#h1-0-15" id="h1-0-15" class="d">-  CloseParen
</a><a href="#h1-0-16" id="h1-0-16" class="d">-
</a><a href="#h1-0-17" id="h1-0-17" class="d">-AST: Insert {
</a><a href="#h1-0-18" id="h1-0-18" class="d">-    table: &quot;movies&quot;,
</a><a href="#h1-0-19" id="h1-0-19" class="d">-    columns: None,
</a><a href="#h1-0-20" id="h1-0-20" class="d">-    values: [
</a><a href="#h1-0-21" id="h1-0-21" class="d">-        [
</a><a href="#h1-0-22" id="h1-0-22" class="d">-            Literal(
</a><a href="#h1-0-23" id="h1-0-23" class="d">-                Integer(
</a><a href="#h1-0-24" id="h1-0-24" class="d">-                    9,
</a><a href="#h1-0-25" id="h1-0-25" class="d">-                ),
</a><a href="#h1-0-26" id="h1-0-26" class="d">-            ),
</a><a href="#h1-0-27" id="h1-0-27" class="d">-            Literal(
</a><a href="#h1-0-28" id="h1-0-28" class="d">-                String(
</a><a href="#h1-0-29" id="h1-0-29" class="d">-                    &quot;District 9&quot;,
</a><a href="#h1-0-30" id="h1-0-30" class="d">-                ),
</a><a href="#h1-0-31" id="h1-0-31" class="d">-            ),
</a><a href="#h1-0-32" id="h1-0-32" class="d">-            Literal(
</a><a href="#h1-0-33" id="h1-0-33" class="d">-                Integer(
</a><a href="#h1-0-34" id="h1-0-34" class="d">-                    1,
</a><a href="#h1-0-35" id="h1-0-35" class="d">-                ),
</a><a href="#h1-0-36" id="h1-0-36" class="d">-            ),
</a><a href="#h1-0-37" id="h1-0-37" class="d">-            Literal(
</a><a href="#h1-0-38" id="h1-0-38" class="d">-                Integer(
</a><a href="#h1-0-39" id="h1-0-39" class="d">-                    2009,
</a><a href="#h1-0-40" id="h1-0-40" class="d">-                ),
</a><a href="#h1-0-41" id="h1-0-41" class="d">-            ),
</a><a href="#h1-0-42" id="h1-0-42" class="d">-        ],
</a><a href="#h1-0-43" id="h1-0-43" class="d">-    ],
</a><a href="#h1-0-44" id="h1-0-44" class="d">-}
</a><a href="#h1-0-45" id="h1-0-45" class="d">-
</a><a href="#h1-0-46" id="h1-0-46" class="d">-Plan: Plan {
</a><a href="#h1-0-47" id="h1-0-47" class="d">-    root: Insert {
</a><a href="#h1-0-48" id="h1-0-48" class="d">-        table: &quot;movies&quot;,
</a><a href="#h1-0-49" id="h1-0-49" class="d">-        columns: [],
</a><a href="#h1-0-50" id="h1-0-50" class="d">-        expressions: [
</a><a href="#h1-0-51" id="h1-0-51" class="d">-            [
</a><a href="#h1-0-52" id="h1-0-52" class="d">-                Constant(
</a><a href="#h1-0-53" id="h1-0-53" class="d">-                    Integer(
</a><a href="#h1-0-54" id="h1-0-54" class="d">-                        9,
</a><a href="#h1-0-55" id="h1-0-55" class="d">-                    ),
</a><a href="#h1-0-56" id="h1-0-56" class="d">-                ),
</a><a href="#h1-0-57" id="h1-0-57" class="d">-                Constant(
</a><a href="#h1-0-58" id="h1-0-58" class="d">-                    String(
</a><a href="#h1-0-59" id="h1-0-59" class="d">-                        &quot;District 9&quot;,
</a><a href="#h1-0-60" id="h1-0-60" class="d">-                    ),
</a><a href="#h1-0-61" id="h1-0-61" class="d">-                ),
</a><a href="#h1-0-62" id="h1-0-62" class="d">-                Constant(
</a><a href="#h1-0-63" id="h1-0-63" class="d">-                    Integer(
</a><a href="#h1-0-64" id="h1-0-64" class="d">-                        1,
</a><a href="#h1-0-65" id="h1-0-65" class="d">-                    ),
</a><a href="#h1-0-66" id="h1-0-66" class="d">-                ),
</a><a href="#h1-0-67" id="h1-0-67" class="d">-                Constant(
</a><a href="#h1-0-68" id="h1-0-68" class="d">-                    Integer(
</a><a href="#h1-0-69" id="h1-0-69" class="d">-                        2009,
</a><a href="#h1-0-70" id="h1-0-70" class="d">-                    ),
</a><a href="#h1-0-71" id="h1-0-71" class="d">-                ),
</a><a href="#h1-0-72" id="h1-0-72" class="d">-            ],
</a><a href="#h1-0-73" id="h1-0-73" class="d">-        ],
</a><a href="#h1-0-74" id="h1-0-74" class="d">-    },
</a><a href="#h1-0-75" id="h1-0-75" class="d">-}
</a><a href="#h1-0-76" id="h1-0-76" class="d">-
</a><a href="#h1-0-77" id="h1-0-77" class="d">-Optimized plan: Plan {
</a><a href="#h1-0-78" id="h1-0-78" class="d">-    root: Insert {
</a><a href="#h1-0-79" id="h1-0-79" class="d">-        table: &quot;movies&quot;,
</a><a href="#h1-0-80" id="h1-0-80" class="d">-        columns: [],
</a><a href="#h1-0-81" id="h1-0-81" class="d">-        expressions: [
</a><a href="#h1-0-82" id="h1-0-82" class="d">-            [
</a><a href="#h1-0-83" id="h1-0-83" class="d">-                Constant(
</a><a href="#h1-0-84" id="h1-0-84" class="d">-                    Integer(
</a><a href="#h1-0-85" id="h1-0-85" class="d">-                        9,
</a><a href="#h1-0-86" id="h1-0-86" class="d">-                    ),
</a><a href="#h1-0-87" id="h1-0-87" class="d">-                ),
</a><a href="#h1-0-88" id="h1-0-88" class="d">-                Constant(
</a><a href="#h1-0-89" id="h1-0-89" class="d">-                    String(
</a><a href="#h1-0-90" id="h1-0-90" class="d">-                        &quot;District 9&quot;,
</a><a href="#h1-0-91" id="h1-0-91" class="d">-                    ),
</a><a href="#h1-0-92" id="h1-0-92" class="d">-                ),
</a><a href="#h1-0-93" id="h1-0-93" class="d">-                Constant(
</a><a href="#h1-0-94" id="h1-0-94" class="d">-                    Integer(
</a><a href="#h1-0-95" id="h1-0-95" class="d">-                        1,
</a><a href="#h1-0-96" id="h1-0-96" class="d">-                    ),
</a><a href="#h1-0-97" id="h1-0-97" class="d">-                ),
</a><a href="#h1-0-98" id="h1-0-98" class="d">-                Constant(
</a><a href="#h1-0-99" id="h1-0-99" class="d">-                    Integer(
</a><a href="#h1-0-100" id="h1-0-100" class="d">-                        2009,
</a><a href="#h1-0-101" id="h1-0-101" class="d">-                    ),
</a><a href="#h1-0-102" id="h1-0-102" class="d">-                ),
</a><a href="#h1-0-103" id="h1-0-103" class="d">-            ],
</a><a href="#h1-0-104" id="h1-0-104" class="d">-        ],
</a><a href="#h1-0-105" id="h1-0-105" class="d">-    },
</a><a href="#h1-0-106" id="h1-0-106" class="d">-}
</a><a href="#h1-0-107" id="h1-0-107" class="d">-
</a><a href="#h1-0-108" id="h1-0-108" class="d">-Query: INSERT INTO movies VALUES (9, &#39;District 9&#39;, 1, 2009)
</a><a href="#h1-0-109" id="h1-0-109" class="d">-
</a><a href="#h1-0-110" id="h1-0-110" class="d">-Result: &lt;none&gt;
</a><a href="#h1-0-111" id="h1-0-111" class="d">-
</a><a href="#h1-0-112" id="h1-0-112" class="d">-Storage:
</a><a href="#h1-0-113" id="h1-0-113" class="d">-CREATE TABLE genres (
</a><a href="#h1-0-114" id="h1-0-114" class="d">-  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h1-0-115" id="h1-0-115" class="d">-  name STRING NOT NULL
</a><a href="#h1-0-116" id="h1-0-116" class="d">-)
</a><a href="#h1-0-117" id="h1-0-117" class="d">-[Integer(1), String(&quot;Science Fiction&quot;)]
</a><a href="#h1-0-118" id="h1-0-118" class="d">-[Integer(2), String(&quot;Action&quot;)]
</a><a href="#h1-0-119" id="h1-0-119" class="d">-
</a><a href="#h1-0-120" id="h1-0-120" class="d">-CREATE TABLE movies (
</a><a href="#h1-0-121" id="h1-0-121" class="d">-  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h1-0-122" id="h1-0-122" class="d">-  title STRING NOT NULL,
</a><a href="#h1-0-123" id="h1-0-123" class="d">-  genre_id INTEGER NOT NULL REFERENCES genres,
</a><a href="#h1-0-124" id="h1-0-124" class="d">-  released INTEGER NOT NULL,
</a><a href="#h1-0-125" id="h1-0-125" class="d">-  rating FLOAT DEFAULT NULL,
</a><a href="#h1-0-126" id="h1-0-126" class="d">-  bluray BOOLEAN DEFAULT NULL
</a><a href="#h1-0-127" id="h1-0-127" class="d">-)
</a><a href="#h1-0-128" id="h1-0-128" class="d">-[Integer(1), String(&quot;Stalker&quot;), Integer(1), Integer(1979), Float(8.2), Boolean(false)]
</a><a href="#h1-0-129" id="h1-0-129" class="d">-[Integer(2), String(&quot;Sicario&quot;), Integer(2), Integer(2015), Float(7.6), Boolean(true)]
</a><a href="#h1-0-130" id="h1-0-130" class="d">-[Integer(3), String(&quot;Primer&quot;), Integer(1), Integer(2004), Float(6.9), Null]
</a><a href="#h1-0-131" id="h1-0-131" class="d">-[Integer(4), String(&quot;Heat&quot;), Integer(2), Integer(1995), Float(8.2), Boolean(true)]
</a><a href="#h1-0-132" id="h1-0-132" class="d">-[Integer(5), String(&quot;The Fountain&quot;), Integer(1), Integer(2006), Float(7.2), Boolean(true)]
</a><a href="#h1-0-133" id="h1-0-133" class="d">-[Integer(9), String(&quot;District 9&quot;), Integer(1), Integer(2009), Null, Null]
</a><b>diff --git a/<a id="h2" href="../file/src/sql/tests/results/insert_error_columns_duplicate.html">src/sql/tests/results/insert_error_columns_duplicate</a> b/<a href="../file/src/sql/tests/results/insert_error_columns_duplicate.html">src/sql/tests/results/insert_error_columns_duplicate</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -112,4 +112,4 @@ Optimized plan: Plan {
</a> 
 Query: INSERT INTO genres (id, name, id) VALUES (9, &#39;Western&#39;, 9)
 
<a href="#h2-0-3" id="h2-0-3" class="d">-Result: Value(&quot;Column id specified multiple times&quot;)
</a><a href="#h2-0-4" id="h2-0-4" class="d">-\ No newline at end of file
</a><a href="#h2-0-5" id="h2-0-5" class="i">+Result: Value(&quot;Column id given multiple times&quot;)
</a><a href="#h2-0-6" id="h2-0-6" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/src/sql/tests/results/insert_error_default_null_disallowed.html">src/sql/tests/results/insert_error_default_null_disallowed</a> b/<a href="../file/src/sql/tests/results/insert_error_default_null_disallowed.html">src/sql/tests/results/insert_error_default_null_disallowed</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,60 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-Query: INSERT INTO movies VALUES (9)
</a><a href="#h3-0-1" id="h3-0-1" class="d">-
</a><a href="#h3-0-2" id="h3-0-2" class="d">-Tokens:
</a><a href="#h3-0-3" id="h3-0-3" class="d">-  Keyword(Insert)
</a><a href="#h3-0-4" id="h3-0-4" class="d">-  Keyword(Into)
</a><a href="#h3-0-5" id="h3-0-5" class="d">-  Ident(&quot;movies&quot;)
</a><a href="#h3-0-6" id="h3-0-6" class="d">-  Keyword(Values)
</a><a href="#h3-0-7" id="h3-0-7" class="d">-  OpenParen
</a><a href="#h3-0-8" id="h3-0-8" class="d">-  Number(&quot;9&quot;)
</a><a href="#h3-0-9" id="h3-0-9" class="d">-  CloseParen
</a><a href="#h3-0-10" id="h3-0-10" class="d">-
</a><a href="#h3-0-11" id="h3-0-11" class="d">-AST: Insert {
</a><a href="#h3-0-12" id="h3-0-12" class="d">-    table: &quot;movies&quot;,
</a><a href="#h3-0-13" id="h3-0-13" class="d">-    columns: None,
</a><a href="#h3-0-14" id="h3-0-14" class="d">-    values: [
</a><a href="#h3-0-15" id="h3-0-15" class="d">-        [
</a><a href="#h3-0-16" id="h3-0-16" class="d">-            Literal(
</a><a href="#h3-0-17" id="h3-0-17" class="d">-                Integer(
</a><a href="#h3-0-18" id="h3-0-18" class="d">-                    9,
</a><a href="#h3-0-19" id="h3-0-19" class="d">-                ),
</a><a href="#h3-0-20" id="h3-0-20" class="d">-            ),
</a><a href="#h3-0-21" id="h3-0-21" class="d">-        ],
</a><a href="#h3-0-22" id="h3-0-22" class="d">-    ],
</a><a href="#h3-0-23" id="h3-0-23" class="d">-}
</a><a href="#h3-0-24" id="h3-0-24" class="d">-
</a><a href="#h3-0-25" id="h3-0-25" class="d">-Plan: Plan {
</a><a href="#h3-0-26" id="h3-0-26" class="d">-    root: Insert {
</a><a href="#h3-0-27" id="h3-0-27" class="d">-        table: &quot;movies&quot;,
</a><a href="#h3-0-28" id="h3-0-28" class="d">-        columns: [],
</a><a href="#h3-0-29" id="h3-0-29" class="d">-        expressions: [
</a><a href="#h3-0-30" id="h3-0-30" class="d">-            [
</a><a href="#h3-0-31" id="h3-0-31" class="d">-                Constant(
</a><a href="#h3-0-32" id="h3-0-32" class="d">-                    Integer(
</a><a href="#h3-0-33" id="h3-0-33" class="d">-                        9,
</a><a href="#h3-0-34" id="h3-0-34" class="d">-                    ),
</a><a href="#h3-0-35" id="h3-0-35" class="d">-                ),
</a><a href="#h3-0-36" id="h3-0-36" class="d">-            ],
</a><a href="#h3-0-37" id="h3-0-37" class="d">-        ],
</a><a href="#h3-0-38" id="h3-0-38" class="d">-    },
</a><a href="#h3-0-39" id="h3-0-39" class="d">-}
</a><a href="#h3-0-40" id="h3-0-40" class="d">-
</a><a href="#h3-0-41" id="h3-0-41" class="d">-Optimized plan: Plan {
</a><a href="#h3-0-42" id="h3-0-42" class="d">-    root: Insert {
</a><a href="#h3-0-43" id="h3-0-43" class="d">-        table: &quot;movies&quot;,
</a><a href="#h3-0-44" id="h3-0-44" class="d">-        columns: [],
</a><a href="#h3-0-45" id="h3-0-45" class="d">-        expressions: [
</a><a href="#h3-0-46" id="h3-0-46" class="d">-            [
</a><a href="#h3-0-47" id="h3-0-47" class="d">-                Constant(
</a><a href="#h3-0-48" id="h3-0-48" class="d">-                    Integer(
</a><a href="#h3-0-49" id="h3-0-49" class="d">-                        9,
</a><a href="#h3-0-50" id="h3-0-50" class="d">-                    ),
</a><a href="#h3-0-51" id="h3-0-51" class="d">-                ),
</a><a href="#h3-0-52" id="h3-0-52" class="d">-            ],
</a><a href="#h3-0-53" id="h3-0-53" class="d">-        ],
</a><a href="#h3-0-54" id="h3-0-54" class="d">-    },
</a><a href="#h3-0-55" id="h3-0-55" class="d">-}
</a><a href="#h3-0-56" id="h3-0-56" class="d">-
</a><a href="#h3-0-57" id="h3-0-57" class="d">-Query: INSERT INTO movies VALUES (9)
</a><a href="#h3-0-58" id="h3-0-58" class="d">-
</a><a href="#h3-0-59" id="h3-0-59" class="d">-Result: Value(&quot;NULL value not allowed for column title&quot;)
</a><a href="#h3-0-60" id="h3-0-60" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/src/sql/tests/results/insert_error_null_disallowed.html">src/sql/tests/results/insert_error_null_disallowed</a> b/<a href="../file/src/sql/tests/results/insert_error_null_disallowed.html">src/sql/tests/results/insert_error_null_disallowed</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,71 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-Query: INSERT INTO genres VALUES (9, NULL)
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-Tokens:
</a><a href="#h4-0-3" id="h4-0-3" class="d">-  Keyword(Insert)
</a><a href="#h4-0-4" id="h4-0-4" class="d">-  Keyword(Into)
</a><a href="#h4-0-5" id="h4-0-5" class="d">-  Ident(&quot;genres&quot;)
</a><a href="#h4-0-6" id="h4-0-6" class="d">-  Keyword(Values)
</a><a href="#h4-0-7" id="h4-0-7" class="d">-  OpenParen
</a><a href="#h4-0-8" id="h4-0-8" class="d">-  Number(&quot;9&quot;)
</a><a href="#h4-0-9" id="h4-0-9" class="d">-  Comma
</a><a href="#h4-0-10" id="h4-0-10" class="d">-  Keyword(Null)
</a><a href="#h4-0-11" id="h4-0-11" class="d">-  CloseParen
</a><a href="#h4-0-12" id="h4-0-12" class="d">-
</a><a href="#h4-0-13" id="h4-0-13" class="d">-AST: Insert {
</a><a href="#h4-0-14" id="h4-0-14" class="d">-    table: &quot;genres&quot;,
</a><a href="#h4-0-15" id="h4-0-15" class="d">-    columns: None,
</a><a href="#h4-0-16" id="h4-0-16" class="d">-    values: [
</a><a href="#h4-0-17" id="h4-0-17" class="d">-        [
</a><a href="#h4-0-18" id="h4-0-18" class="d">-            Literal(
</a><a href="#h4-0-19" id="h4-0-19" class="d">-                Integer(
</a><a href="#h4-0-20" id="h4-0-20" class="d">-                    9,
</a><a href="#h4-0-21" id="h4-0-21" class="d">-                ),
</a><a href="#h4-0-22" id="h4-0-22" class="d">-            ),
</a><a href="#h4-0-23" id="h4-0-23" class="d">-            Literal(
</a><a href="#h4-0-24" id="h4-0-24" class="d">-                Null,
</a><a href="#h4-0-25" id="h4-0-25" class="d">-            ),
</a><a href="#h4-0-26" id="h4-0-26" class="d">-        ],
</a><a href="#h4-0-27" id="h4-0-27" class="d">-    ],
</a><a href="#h4-0-28" id="h4-0-28" class="d">-}
</a><a href="#h4-0-29" id="h4-0-29" class="d">-
</a><a href="#h4-0-30" id="h4-0-30" class="d">-Plan: Plan {
</a><a href="#h4-0-31" id="h4-0-31" class="d">-    root: Insert {
</a><a href="#h4-0-32" id="h4-0-32" class="d">-        table: &quot;genres&quot;,
</a><a href="#h4-0-33" id="h4-0-33" class="d">-        columns: [],
</a><a href="#h4-0-34" id="h4-0-34" class="d">-        expressions: [
</a><a href="#h4-0-35" id="h4-0-35" class="d">-            [
</a><a href="#h4-0-36" id="h4-0-36" class="d">-                Constant(
</a><a href="#h4-0-37" id="h4-0-37" class="d">-                    Integer(
</a><a href="#h4-0-38" id="h4-0-38" class="d">-                        9,
</a><a href="#h4-0-39" id="h4-0-39" class="d">-                    ),
</a><a href="#h4-0-40" id="h4-0-40" class="d">-                ),
</a><a href="#h4-0-41" id="h4-0-41" class="d">-                Constant(
</a><a href="#h4-0-42" id="h4-0-42" class="d">-                    Null,
</a><a href="#h4-0-43" id="h4-0-43" class="d">-                ),
</a><a href="#h4-0-44" id="h4-0-44" class="d">-            ],
</a><a href="#h4-0-45" id="h4-0-45" class="d">-        ],
</a><a href="#h4-0-46" id="h4-0-46" class="d">-    },
</a><a href="#h4-0-47" id="h4-0-47" class="d">-}
</a><a href="#h4-0-48" id="h4-0-48" class="d">-
</a><a href="#h4-0-49" id="h4-0-49" class="d">-Optimized plan: Plan {
</a><a href="#h4-0-50" id="h4-0-50" class="d">-    root: Insert {
</a><a href="#h4-0-51" id="h4-0-51" class="d">-        table: &quot;genres&quot;,
</a><a href="#h4-0-52" id="h4-0-52" class="d">-        columns: [],
</a><a href="#h4-0-53" id="h4-0-53" class="d">-        expressions: [
</a><a href="#h4-0-54" id="h4-0-54" class="d">-            [
</a><a href="#h4-0-55" id="h4-0-55" class="d">-                Constant(
</a><a href="#h4-0-56" id="h4-0-56" class="d">-                    Integer(
</a><a href="#h4-0-57" id="h4-0-57" class="d">-                        9,
</a><a href="#h4-0-58" id="h4-0-58" class="d">-                    ),
</a><a href="#h4-0-59" id="h4-0-59" class="d">-                ),
</a><a href="#h4-0-60" id="h4-0-60" class="d">-                Constant(
</a><a href="#h4-0-61" id="h4-0-61" class="d">-                    Null,
</a><a href="#h4-0-62" id="h4-0-62" class="d">-                ),
</a><a href="#h4-0-63" id="h4-0-63" class="d">-            ],
</a><a href="#h4-0-64" id="h4-0-64" class="d">-        ],
</a><a href="#h4-0-65" id="h4-0-65" class="d">-    },
</a><a href="#h4-0-66" id="h4-0-66" class="d">-}
</a><a href="#h4-0-67" id="h4-0-67" class="d">-
</a><a href="#h4-0-68" id="h4-0-68" class="d">-Query: INSERT INTO genres VALUES (9, NULL)
</a><a href="#h4-0-69" id="h4-0-69" class="d">-
</a><a href="#h4-0-70" id="h4-0-70" class="d">-Result: Value(&quot;NULL value not allowed for column name&quot;)
</a><a href="#h4-0-71" id="h4-0-71" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a> b/<a href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -186,3 +186,32 @@ test_schema! { with [
</a>     insert_pk_integer_negative: r#&quot;INSERT INTO &quot;integer&quot; VALUES (-1)&quot;#,
     insert_pk_integer_null: r#&quot;INSERT INTO &quot;integer&quot; VALUES (NULL)&quot;#,
 }
<a href="#h5-0-3" id="h5-0-3" class="i">+
</a><a href="#h5-0-4" id="h5-0-4" class="i">+test_schema! { with [
</a><a href="#h5-0-5" id="h5-0-5" class="i">+    r#&quot;CREATE TABLE nulls (
</a><a href="#h5-0-6" id="h5-0-6" class="i">+        id INTEGER PRIMARY KEY,
</a><a href="#h5-0-7" id="h5-0-7" class="i">+        &quot;null&quot; BOOLEAN NULL,
</a><a href="#h5-0-8" id="h5-0-8" class="i">+        not_null BOOLEAN NOT NULL,
</a><a href="#h5-0-9" id="h5-0-9" class="i">+        &quot;default&quot; BOOLEAN
</a><a href="#h5-0-10" id="h5-0-10" class="i">+    )&quot;#];
</a><a href="#h5-0-11" id="h5-0-11" class="i">+    insert_nulls: r#&quot;INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, TRUE, NULL)&quot;#,
</a><a href="#h5-0-12" id="h5-0-12" class="i">+    insert_nulls_default: r#&quot;INSERT INTO nulls (id, &quot;null&quot;, not_null) VALUES (1, NULL, TRUE)&quot;#,
</a><a href="#h5-0-13" id="h5-0-13" class="i">+    insert_nulls_required: r#&quot;INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, NULL, NULL)&quot;#,
</a><a href="#h5-0-14" id="h5-0-14" class="i">+}
</a><a href="#h5-0-15" id="h5-0-15" class="i">+
</a><a href="#h5-0-16" id="h5-0-16" class="i">+test_schema! { with [
</a><a href="#h5-0-17" id="h5-0-17" class="i">+    r#&quot;CREATE TABLE defaults (
</a><a href="#h5-0-18" id="h5-0-18" class="i">+        id INTEGER PRIMARY KEY,
</a><a href="#h5-0-19" id="h5-0-19" class="i">+        required BOOLEAN NOT NULL,
</a><a href="#h5-0-20" id="h5-0-20" class="i">+        &quot;null&quot; BOOLEAN,
</a><a href="#h5-0-21" id="h5-0-21" class="i">+        &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h5-0-22" id="h5-0-22" class="i">+        &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h5-0-23" id="h5-0-23" class="i">+        &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h5-0-24" id="h5-0-24" class="i">+        &quot;string&quot; STRING DEFAULT &#39;foo&#39;
</a><a href="#h5-0-25" id="h5-0-25" class="i">+    )&quot;#];
</a><a href="#h5-0-26" id="h5-0-26" class="i">+    insert_default: &quot;INSERT INTO defaults (id, required) VALUES (1, TRUE)&quot;,
</a><a href="#h5-0-27" id="h5-0-27" class="i">+    insert_default_unnamed: &quot;INSERT INTO defaults VALUES (1, TRUE)&quot;,
</a><a href="#h5-0-28" id="h5-0-28" class="i">+    insert_default_missing: &quot;INSERT INTO defaults (id) VALUES (1)&quot;,
</a><a href="#h5-0-29" id="h5-0-29" class="i">+    insert_default_override: &quot;INSERT INTO defaults VALUES (1, TRUE, TRUE, FALSE, 2.718, 3, &#39;bar&#39;)&quot;,
</a><a href="#h5-0-30" id="h5-0-30" class="i">+    insert_default_override_null: &quot;INSERT INTO defaults VALUES (1, TRUE, NULL, NULL, NULL, NULL, NULL)&quot;,
</a><a href="#h5-0-31" id="h5-0-31" class="i">+}
</a><b>diff --git a/<a id="h6" href="../file/src/sql/tests/schema/insert_default.html">src/sql/tests/schema/insert_default</a> b/<a href="../file/src/sql/tests/schema/insert_default.html">src/sql/tests/schema/insert_default</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+Query: INSERT INTO defaults (id, required) VALUES (1, TRUE)
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+Storage:
</a><a href="#h6-0-3" id="h6-0-3" class="i">+CREATE TABLE defaults (
</a><a href="#h6-0-4" id="h6-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h6-0-5" id="h6-0-5" class="i">+  required BOOLEAN NOT NULL,
</a><a href="#h6-0-6" id="h6-0-6" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h6-0-7" id="h6-0-7" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h6-0-8" id="h6-0-8" class="i">+  &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h6-0-9" id="h6-0-9" class="i">+  &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h6-0-10" id="h6-0-10" class="i">+  &quot;string&quot; STRING DEFAULT foo
</a><a href="#h6-0-11" id="h6-0-11" class="i">+)
</a><a href="#h6-0-12" id="h6-0-12" class="i">+[Integer(1), Boolean(true), Null, Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h7" href="../file/src/sql/tests/schema/insert_default_missing.html">src/sql/tests/schema/insert_default_missing</a> b/<a href="../file/src/sql/tests/schema/insert_default_missing.html">src/sql/tests/schema/insert_default_missing</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+Query: INSERT INTO defaults (id) VALUES (1)
</a><a href="#h7-0-1" id="h7-0-1" class="i">+Error: Value(&quot;No value given for column required&quot;)
</a><a href="#h7-0-2" id="h7-0-2" class="i">+
</a><a href="#h7-0-3" id="h7-0-3" class="i">+Storage:
</a><a href="#h7-0-4" id="h7-0-4" class="i">+CREATE TABLE defaults (
</a><a href="#h7-0-5" id="h7-0-5" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h7-0-6" id="h7-0-6" class="i">+  required BOOLEAN NOT NULL,
</a><a href="#h7-0-7" id="h7-0-7" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h7-0-8" id="h7-0-8" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h7-0-9" id="h7-0-9" class="i">+  &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h7-0-10" id="h7-0-10" class="i">+  &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h7-0-11" id="h7-0-11" class="i">+  &quot;string&quot; STRING DEFAULT foo
</a><a href="#h7-0-12" id="h7-0-12" class="i">+)
</a><b>diff --git a/<a id="h8" href="../file/src/sql/tests/schema/insert_default_override.html">src/sql/tests/schema/insert_default_override</a> b/<a href="../file/src/sql/tests/schema/insert_default_override.html">src/sql/tests/schema/insert_default_override</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+Query: INSERT INTO defaults VALUES (1, TRUE, TRUE, FALSE, 2.718, 3, &#39;bar&#39;)
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+Storage:
</a><a href="#h8-0-3" id="h8-0-3" class="i">+CREATE TABLE defaults (
</a><a href="#h8-0-4" id="h8-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h8-0-5" id="h8-0-5" class="i">+  required BOOLEAN NOT NULL,
</a><a href="#h8-0-6" id="h8-0-6" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h8-0-7" id="h8-0-7" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h8-0-8" id="h8-0-8" class="i">+  &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h8-0-9" id="h8-0-9" class="i">+  &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h8-0-10" id="h8-0-10" class="i">+  &quot;string&quot; STRING DEFAULT foo
</a><a href="#h8-0-11" id="h8-0-11" class="i">+)
</a><a href="#h8-0-12" id="h8-0-12" class="i">+[Integer(1), Boolean(true), Boolean(true), Boolean(false), Float(2.718), Integer(3), String(&quot;bar&quot;)]
</a><b>diff --git a/<a id="h9" href="../file/src/sql/tests/schema/insert_default_override_null.html">src/sql/tests/schema/insert_default_override_null</a> b/<a href="../file/src/sql/tests/schema/insert_default_override_null.html">src/sql/tests/schema/insert_default_override_null</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+Query: INSERT INTO defaults VALUES (1, TRUE, NULL, NULL, NULL, NULL, NULL)
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+Storage:
</a><a href="#h9-0-3" id="h9-0-3" class="i">+CREATE TABLE defaults (
</a><a href="#h9-0-4" id="h9-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h9-0-5" id="h9-0-5" class="i">+  required BOOLEAN NOT NULL,
</a><a href="#h9-0-6" id="h9-0-6" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h9-0-7" id="h9-0-7" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h9-0-8" id="h9-0-8" class="i">+  &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h9-0-9" id="h9-0-9" class="i">+  &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h9-0-10" id="h9-0-10" class="i">+  &quot;string&quot; STRING DEFAULT foo
</a><a href="#h9-0-11" id="h9-0-11" class="i">+)
</a><a href="#h9-0-12" id="h9-0-12" class="i">+[Integer(1), Boolean(true), Null, Null, Null, Null, Null]
</a><b>diff --git a/<a id="h10" href="../file/src/sql/tests/schema/insert_default_unnamed.html">src/sql/tests/schema/insert_default_unnamed</a> b/<a href="../file/src/sql/tests/schema/insert_default_unnamed.html">src/sql/tests/schema/insert_default_unnamed</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+Query: INSERT INTO defaults VALUES (1, TRUE)
</a><a href="#h10-0-1" id="h10-0-1" class="i">+
</a><a href="#h10-0-2" id="h10-0-2" class="i">+Storage:
</a><a href="#h10-0-3" id="h10-0-3" class="i">+CREATE TABLE defaults (
</a><a href="#h10-0-4" id="h10-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h10-0-5" id="h10-0-5" class="i">+  required BOOLEAN NOT NULL,
</a><a href="#h10-0-6" id="h10-0-6" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h10-0-7" id="h10-0-7" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT TRUE,
</a><a href="#h10-0-8" id="h10-0-8" class="i">+  &quot;float&quot; FLOAT DEFAULT 3.14,
</a><a href="#h10-0-9" id="h10-0-9" class="i">+  &quot;integer&quot; INTEGER DEFAULT 7,
</a><a href="#h10-0-10" id="h10-0-10" class="i">+  &quot;string&quot; STRING DEFAULT foo
</a><a href="#h10-0-11" id="h10-0-11" class="i">+)
</a><a href="#h10-0-12" id="h10-0-12" class="i">+[Integer(1), Boolean(true), Null, Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h11" href="../file/src/sql/tests/schema/insert_nulls.html">src/sql/tests/schema/insert_nulls</a> b/<a href="../file/src/sql/tests/schema/insert_nulls.html">src/sql/tests/schema/insert_nulls</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+Query: INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, TRUE, NULL)
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+Storage:
</a><a href="#h11-0-3" id="h11-0-3" class="i">+CREATE TABLE nulls (
</a><a href="#h11-0-4" id="h11-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h11-0-5" id="h11-0-5" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h11-0-6" id="h11-0-6" class="i">+  not_null BOOLEAN NOT NULL,
</a><a href="#h11-0-7" id="h11-0-7" class="i">+  &quot;default&quot; BOOLEAN DEFAULT NULL
</a><a href="#h11-0-8" id="h11-0-8" class="i">+)
</a><a href="#h11-0-9" id="h11-0-9" class="i">+[Integer(1), Null, Boolean(true), Null]
</a><b>diff --git a/<a id="h12" href="../file/src/sql/tests/schema/insert_nulls_default.html">src/sql/tests/schema/insert_nulls_default</a> b/<a href="../file/src/sql/tests/schema/insert_nulls_default.html">src/sql/tests/schema/insert_nulls_default</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+Query: INSERT INTO nulls (id, &quot;null&quot;, not_null) VALUES (1, NULL, TRUE)
</a><a href="#h12-0-1" id="h12-0-1" class="i">+
</a><a href="#h12-0-2" id="h12-0-2" class="i">+Storage:
</a><a href="#h12-0-3" id="h12-0-3" class="i">+CREATE TABLE nulls (
</a><a href="#h12-0-4" id="h12-0-4" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h12-0-5" id="h12-0-5" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h12-0-6" id="h12-0-6" class="i">+  not_null BOOLEAN NOT NULL,
</a><a href="#h12-0-7" id="h12-0-7" class="i">+  &quot;default&quot; BOOLEAN DEFAULT NULL
</a><a href="#h12-0-8" id="h12-0-8" class="i">+)
</a><a href="#h12-0-9" id="h12-0-9" class="i">+[Integer(1), Null, Boolean(true), Null]
</a><b>diff --git a/<a id="h13" href="../file/src/sql/tests/schema/insert_nulls_required.html">src/sql/tests/schema/insert_nulls_required</a> b/<a href="../file/src/sql/tests/schema/insert_nulls_required.html">src/sql/tests/schema/insert_nulls_required</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+Query: INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, NULL, NULL)
</a><a href="#h13-0-1" id="h13-0-1" class="i">+Error: Value(&quot;NULL value not allowed for column not_null&quot;)
</a><a href="#h13-0-2" id="h13-0-2" class="i">+
</a><a href="#h13-0-3" id="h13-0-3" class="i">+Storage:
</a><a href="#h13-0-4" id="h13-0-4" class="i">+CREATE TABLE nulls (
</a><a href="#h13-0-5" id="h13-0-5" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h13-0-6" id="h13-0-6" class="i">+  &quot;null&quot; BOOLEAN DEFAULT NULL,
</a><a href="#h13-0-7" id="h13-0-7" class="i">+  not_null BOOLEAN NOT NULL,
</a><a href="#h13-0-8" id="h13-0-8" class="i">+  &quot;default&quot; BOOLEAN DEFAULT NULL
</a><a href="#h13-0-9" id="h13-0-9" class="i">+)
</a><b>diff --git a/<a id="h14" href="../file/src/sql/tests/sql.rs.html">src/sql/tests/sql.rs</a> b/<a href="../file/src/sql/tests/sql.rs.html">src/sql/tests/sql.rs</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -141,14 +141,11 @@ test_sql! {
</a>     delete_where_null: &quot;DELETE FROM movies WHERE NULL&quot;,
     delete_where_true: &quot;DELETE FROM movies WHERE TRUE&quot;,
 
<a href="#h14-0-3" id="h14-0-3" class="d">-    insert_default_null: &quot;INSERT INTO movies VALUES (9, &#39;District 9&#39;, 1, 2009)&quot;,
</a>     insert_expression: &quot;INSERT INTO movies VALUES (2 * 5 - 1, &#39;District 9&#39;, 1 / 1, 2 * 1000 + 1 * 10 - --1, 793 / 1e2, TRUE OR FALSE)&quot;,
     insert_partial: &quot;INSERT INTO movies (title, released, id, genre_id, rating) VALUES (&#39;District 9&#39;, 2009, 9, 1, 7.9)&quot;,
     insert_values: &quot;INSERT INTO genres VALUES (9, &#39;Western&#39;)&quot;,
     insert_error_columns_duplicate: &quot;INSERT INTO genres (id, name, id) VALUES (9, &#39;Western&#39;, 9)&quot;,
     insert_error_columns_mismatch: &quot;INSERT INTO genres (id) VALUES (9, &#39;Western&#39;)&quot;,
<a href="#h14-0-9" id="h14-0-9" class="d">-    insert_error_default_null_disallowed: &quot;INSERT INTO movies VALUES (9)&quot;,
</a><a href="#h14-0-10" id="h14-0-10" class="d">-    insert_error_null_disallowed: &quot;INSERT INTO genres VALUES (9, NULL)&quot;,
</a> 
     select_all_from_table: &quot;SELECT * FROM movies&quot;,
     select_aliases: &quot;SELECT 1, 2 b, 3 AS c&quot;,
<b>diff --git a/<a id="h15" href="../file/src/sql/types/schema.rs.html">src/sql/types/schema.rs</a> b/<a href="../file/src/sql/types/schema.rs.html">src/sql/types/schema.rs</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -45,40 +45,55 @@ impl Table {
</a>         sql
     }
 
<a href="#h15-0-3" id="h15-0-3" class="d">-    /// Returns the index of a named column, if it exists
</a><a href="#h15-0-4" id="h15-0-4" class="d">-    pub fn column_index(&amp;self, name: &amp;str) -&gt; Option&lt;usize&gt; {
</a><a href="#h15-0-5" id="h15-0-5" class="d">-        self.columns.iter().position(|c| c.name == name)
</a><a href="#h15-0-6" id="h15-0-6" class="i">+    /// Fetches a column by name
</a><a href="#h15-0-7" id="h15-0-7" class="i">+    /// FIXME Should index these for performance
</a><a href="#h15-0-8" id="h15-0-8" class="i">+    pub fn get_column(&amp;self, name: &amp;str) -&gt; Option&lt;&amp;Column&gt; {
</a><a href="#h15-0-9" id="h15-0-9" class="i">+        self.columns.iter().find(|c| c.name == name)
</a>     }
 
<a href="#h15-0-12" id="h15-0-12" class="d">-    /// Normalizes a partial row into a full row, and reorders it
</a><a href="#h15-0-13" id="h15-0-13" class="d">-    /// according to the column names.
</a><a href="#h15-0-14" id="h15-0-14" class="d">-    pub fn normalize_row(&amp;self, mut row: Row, columns: Option&lt;Vec&lt;String&gt;&gt;) -&gt; Result&lt;Row, Error&gt; {
</a><a href="#h15-0-15" id="h15-0-15" class="d">-        if let Some(cols) = columns {
</a><a href="#h15-0-16" id="h15-0-16" class="d">-            if row.len() != cols.len() {
</a><a href="#h15-0-17" id="h15-0-17" class="i">+    // Builds a row from a set of values, optionally with a set of column names, padding
</a><a href="#h15-0-18" id="h15-0-18" class="i">+    // it with default values as necessary.
</a><a href="#h15-0-19" id="h15-0-19" class="i">+    pub fn make_row(&amp;self, values: Vec&lt;Value&gt;, columns: Option&lt;&amp;[String]&gt;) -&gt; Result&lt;Row, Error&gt; {
</a><a href="#h15-0-20" id="h15-0-20" class="i">+        if let Some(columns) = columns {
</a><a href="#h15-0-21" id="h15-0-21" class="i">+            if values.len() != columns.len() {
</a>                 return Err(Error::Value(&quot;Column and value counts do not match&quot;.into()));
             }
<a href="#h15-0-24" id="h15-0-24" class="d">-            let mut column_values = HashMap::new();
</a><a href="#h15-0-25" id="h15-0-25" class="d">-            for (c, v) in cols.into_iter().zip(row.into_iter()) {
</a><a href="#h15-0-26" id="h15-0-26" class="d">-                if self.column_index(&amp;c).is_none() {
</a><a href="#h15-0-27" id="h15-0-27" class="i">+            let mut inputs = HashMap::new();
</a><a href="#h15-0-28" id="h15-0-28" class="i">+            for (c, v) in columns.iter().zip(values.into_iter()) {
</a><a href="#h15-0-29" id="h15-0-29" class="i">+                if self.get_column(c).is_none() {
</a>                     return Err(Error::Value(format!(
                         &quot;Unknown column {} in table {}&quot;,
                         c, self.name
                     )));
                 }
<a href="#h15-0-35" id="h15-0-35" class="d">-                if column_values.insert(c.clone(), v).is_some() {
</a><a href="#h15-0-36" id="h15-0-36" class="d">-                    return Err(Error::Value(format!(&quot;Column {} specified multiple times&quot;, c)));
</a><a href="#h15-0-37" id="h15-0-37" class="i">+                if inputs.insert(c.clone(), v).is_some() {
</a><a href="#h15-0-38" id="h15-0-38" class="i">+                    return Err(Error::Value(format!(&quot;Column {} given multiple times&quot;, c)));
</a>                 }
             }
<a href="#h15-0-41" id="h15-0-41" class="d">-            row = self
</a><a href="#h15-0-42" id="h15-0-42" class="d">-                .columns
</a><a href="#h15-0-43" id="h15-0-43" class="d">-                .iter()
</a><a href="#h15-0-44" id="h15-0-44" class="d">-                .map(|c| column_values.get(&amp;c.name).cloned().unwrap_or(Value::Null))
</a><a href="#h15-0-45" id="h15-0-45" class="d">-                .collect();
</a><a href="#h15-0-46" id="h15-0-46" class="d">-        }
</a><a href="#h15-0-47" id="h15-0-47" class="d">-        while row.len() &lt; self.columns.len() {
</a><a href="#h15-0-48" id="h15-0-48" class="d">-            row.push(Value::Null)
</a><a href="#h15-0-49" id="h15-0-49" class="i">+            let mut row = Row::new();
</a><a href="#h15-0-50" id="h15-0-50" class="i">+            for column in self.columns.iter() {
</a><a href="#h15-0-51" id="h15-0-51" class="i">+                if let Some(value) = inputs.get(&amp;column.name) {
</a><a href="#h15-0-52" id="h15-0-52" class="i">+                    row.push(value.clone())
</a><a href="#h15-0-53" id="h15-0-53" class="i">+                } else if let Some(value) = &amp;column.default {
</a><a href="#h15-0-54" id="h15-0-54" class="i">+                    row.push(value.clone())
</a><a href="#h15-0-55" id="h15-0-55" class="i">+                } else {
</a><a href="#h15-0-56" id="h15-0-56" class="i">+                    return Err(Error::Value(format!(&quot;No value given for column {}&quot;, column.name)));
</a><a href="#h15-0-57" id="h15-0-57" class="i">+                }
</a><a href="#h15-0-58" id="h15-0-58" class="i">+            }
</a><a href="#h15-0-59" id="h15-0-59" class="i">+            Ok(row)
</a><a href="#h15-0-60" id="h15-0-60" class="i">+        } else {
</a><a href="#h15-0-61" id="h15-0-61" class="i">+            let mut row = Row::new();
</a><a href="#h15-0-62" id="h15-0-62" class="i">+            for (i, column) in self.columns.iter().enumerate() {
</a><a href="#h15-0-63" id="h15-0-63" class="i">+                if let Some(value) = values.get(i) {
</a><a href="#h15-0-64" id="h15-0-64" class="i">+                    row.push(value.clone())
</a><a href="#h15-0-65" id="h15-0-65" class="i">+                } else if let Some(value) = &amp;column.default {
</a><a href="#h15-0-66" id="h15-0-66" class="i">+                    row.push(value.clone())
</a><a href="#h15-0-67" id="h15-0-67" class="i">+                } else {
</a><a href="#h15-0-68" id="h15-0-68" class="i">+                    return Err(Error::Value(format!(&quot;No value given for column {}&quot;, column.name)));
</a><a href="#h15-0-69" id="h15-0-69" class="i">+                }
</a><a href="#h15-0-70" id="h15-0-70" class="i">+            }
</a><a href="#h15-0-71" id="h15-0-71" class="i">+            Ok(row)
</a>         }
<a href="#h15-0-73" id="h15-0-73" class="d">-        Ok(row)
</a>     }
 
     /// Returns a row from a hashmap keyed by column name, padding it with nulls if needed
</pre>
</div>
</body>
</html>
