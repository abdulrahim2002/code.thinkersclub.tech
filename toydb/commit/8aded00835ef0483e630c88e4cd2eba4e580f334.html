<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rename `raft::Address::Peer` to `Node` - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8aded00835ef0483e630c88e4cd2eba4e580f334.html">8aded00835ef0483e630c88e4cd2eba4e580f334</a>
<b>parent</b> <a href="../commit/8ce6af58a215db08dd39a13d98bcbd7127e42040.html">8ce6af58a215db08dd39a13d98bcbd7127e42040</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat, 18 Nov 2023 18:20:08 +0100

Rename `raft::Address::Peer` to `Node`

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/raft/message.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/raft/node/candidate.rs</a></td><td> | </td><td class="num">36</td><td><span class="i">++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/raft/node/follower.rs</a></td><td> | </td><td class="num">156</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/raft/node/leader.rs</a></td><td> | </td><td class="num">70</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/raft/node/mod.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/raft/server.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/raft/state.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
</table></pre><pre>7 files changed, 145 insertions(+), 144 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/raft/message.rs.html">src/raft/message.rs</a> b/<a href="../file/src/raft/message.rs.html">src/raft/message.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -8,8 +8,9 @@ use serde_derive::{Deserialize, Serialize};
</a> pub enum Address {
     /// Broadcast to all peers. Only valid as an outbound recipient (to).
     Broadcast,
<a href="#h0-0-3" id="h0-0-3" class="d">-    /// A remote peer.
</a><a href="#h0-0-4" id="h0-0-4" class="d">-    Peer(NodeID),
</a><a href="#h0-0-5" id="h0-0-5" class="i">+    /// A node with the specified node ID (local or remote). Valid both as
</a><a href="#h0-0-6" id="h0-0-6" class="i">+    /// sender and recipient.
</a><a href="#h0-0-7" id="h0-0-7" class="i">+    Node(NodeID),
</a>     /// The local node.
     Local,
     /// A local client.
<b>diff --git a/<a id="h1" href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a> b/<a href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -38,7 +38,7 @@ impl RoleNode&lt;Candidate&gt; {
</a>         self.log.set_term(term, None)?;
         let mut node = self.become_role(Follower::new(Some(leader), None))?;
         node.abort_proxied()?;
<a href="#h1-0-3" id="h1-0-3" class="d">-        node.forward_queued(Address::Peer(leader))?;
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        node.forward_queued(Address::Node(leader))?;
</a>         Ok(node)
     }
 
<a href="#h1-1" id="h1-1" class="h">@@ -62,14 +62,14 @@ impl RoleNode&lt;Candidate&gt; {
</a>             return Ok(self.into());
         }
         if msg.term &gt; self.term {
<a href="#h1-1-3" id="h1-1-3" class="d">-            if let Address::Peer(from) = msg.from {
</a><a href="#h1-1-4" id="h1-1-4" class="i">+            if let Address::Node(from) = msg.from {
</a>                 return self.become_follower(msg.term, from)?.step(msg);
             }
         }
 
         match msg.event {
             Event::Heartbeat { .. } =&gt; {
<a href="#h1-1-11" id="h1-1-11" class="d">-                if let Address::Peer(from) = msg.from {
</a><a href="#h1-1-12" id="h1-1-12" class="i">+                if let Address::Node(from) = msg.from {
</a>                     return self.become_follower(msg.term, from)?.step(msg);
                 }
             }
<a href="#h1-2" id="h1-2" class="h">@@ -178,8 +178,8 @@ mod tests {
</a>     fn step_heartbeat_current_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h1-2-3" id="h1-2-3" class="d">-            from: Address::Peer(2),
</a><a href="#h1-2-4" id="h1-2-4" class="d">-            to: Address::Peer(1),
</a><a href="#h1-2-5" id="h1-2-5" class="i">+            from: Address::Node(2),
</a><a href="#h1-2-6" id="h1-2-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
         })?;
<a href="#h1-3" id="h1-3" class="h">@@ -189,7 +189,7 @@ mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h1-3-3" id="h1-3-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h1-3-4" id="h1-3-4" class="i">+                    to: Address::Node(2),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0xaf],
<a href="#h1-4" id="h1-4" class="h">@@ -198,7 +198,7 @@ mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h1-4-3" id="h1-4-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h1-4-4" id="h1-4-4" class="i">+                    to: Address::Node(2),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 },
<a href="#h1-5" id="h1-5" class="h">@@ -214,8 +214,8 @@ mod tests {
</a>     fn step_heartbeat_future_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h1-5-3" id="h1-5-3" class="d">-            from: Address::Peer(2),
</a><a href="#h1-5-4" id="h1-5-4" class="d">-            to: Address::Peer(1),
</a><a href="#h1-5-5" id="h1-5-5" class="i">+            from: Address::Node(2),
</a><a href="#h1-5-6" id="h1-5-6" class="i">+            to: Address::Node(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
         })?;
<a href="#h1-6" id="h1-6" class="h">@@ -225,7 +225,7 @@ mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h1-6-3" id="h1-6-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h1-6-4" id="h1-6-4" class="i">+                    to: Address::Node(2),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0xaf],
<a href="#h1-7" id="h1-7" class="h">@@ -234,7 +234,7 @@ mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h1-7-3" id="h1-7-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h1-7-4" id="h1-7-4" class="i">+                    to: Address::Node(2),
</a>                     term: 4,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 },
<a href="#h1-8" id="h1-8" class="h">@@ -249,8 +249,8 @@ mod tests {
</a>     fn step_heartbeat_past_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h1-8-3" id="h1-8-3" class="d">-            from: Address::Peer(2),
</a><a href="#h1-8-4" id="h1-8-4" class="d">-            to: Address::Peer(1),
</a><a href="#h1-8-5" id="h1-8-5" class="i">+            from: Address::Node(2),
</a><a href="#h1-8-6" id="h1-8-6" class="i">+            to: Address::Node(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
         })?;
<a href="#h1-9" id="h1-9" class="h">@@ -268,8 +268,8 @@ mod tests {
</a> 
         // The first vote is not sufficient for a quorum (3 votes including self)
         node = node.step(Message {
<a href="#h1-9-3" id="h1-9-3" class="d">-            from: Address::Peer(3),
</a><a href="#h1-9-4" id="h1-9-4" class="d">-            to: Address::Peer(1),
</a><a href="#h1-9-5" id="h1-9-5" class="i">+            from: Address::Node(3),
</a><a href="#h1-9-6" id="h1-9-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<a href="#h1-10" id="h1-10" class="h">@@ -279,8 +279,8 @@ mod tests {
</a> 
         // However, the second external vote makes us leader
         node = node.step(Message {
<a href="#h1-10-3" id="h1-10-3" class="d">-            from: Address::Peer(5),
</a><a href="#h1-10-4" id="h1-10-4" class="d">-            to: Address::Peer(1),
</a><a href="#h1-10-5" id="h1-10-5" class="i">+            from: Address::Node(5),
</a><a href="#h1-10-6" id="h1-10-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<a href="#h1-11" id="h1-11" class="h">@@ -301,7 +301,7 @@ mod tests {
</a>                 node_rx.try_recv()?,
                 Message {
                     from: Address::Local,
<a href="#h1-11-3" id="h1-11-3" class="d">-                    to: Address::Peer(to),
</a><a href="#h1-11-4" id="h1-11-4" class="i">+                    to: Address::Node(to),
</a>                     term: 3,
                     event: Event::ReplicateEntries {
                         base_index: 3,
<b>diff --git a/<a id="h2" href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a> b/<a href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -56,13 +56,13 @@ impl RoleNode&lt;Follower&gt; {
</a>         };
         self.role = Follower::new(Some(leader), voted_for);
         self.abort_proxied()?;
<a href="#h2-0-3" id="h2-0-3" class="d">-        self.forward_queued(Address::Peer(leader))?;
</a><a href="#h2-0-4" id="h2-0-4" class="i">+        self.forward_queued(Address::Node(leader))?;
</a>         Ok(self)
     }
 
     /// Checks if an address is the current leader
     fn is_leader(&amp;self, from: &amp;Address) -&gt; bool {
<a href="#h2-0-10" id="h2-0-10" class="d">-        matches!((&amp;self.role.leader, from), (Some(leader), Address::Peer(from)) if leader == from)
</a><a href="#h2-0-11" id="h2-0-11" class="i">+        matches!((&amp;self.role.leader, from), (Some(leader), Address::Node(from)) if leader == from)
</a>     }
 
     /// Processes a message.
<a href="#h2-1" id="h2-1" class="h">@@ -71,7 +71,7 @@ impl RoleNode&lt;Follower&gt; {
</a>             warn!(&quot;Ignoring invalid message: {}&quot;, err);
             return Ok(self.into());
         }
<a href="#h2-1-3" id="h2-1-3" class="d">-        if let Address::Peer(from) = msg.from {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+        if let Address::Node(from) = msg.from {
</a>             if msg.term &gt; self.term || self.role.leader.is_none() {
                 return self.become_follower(from, msg.term)?.step(msg);
             }
<a href="#h2-2" id="h2-2" class="h">@@ -98,7 +98,7 @@ impl RoleNode&lt;Follower&gt; {
</a> 
             Event::SolicitVote { last_index, last_term } =&gt; {
                 if let Some(voted_for) = self.role.voted_for {
<a href="#h2-2-3" id="h2-2-3" class="d">-                    if msg.from != Address::Peer(voted_for) {
</a><a href="#h2-2-4" id="h2-2-4" class="i">+                    if msg.from != Address::Node(voted_for) {
</a>                         return Ok(self.into());
                     }
                 }
<a href="#h2-3" id="h2-3" class="h">@@ -109,9 +109,9 @@ impl RoleNode&lt;Follower&gt; {
</a>                 if last_term == log_last_term &amp;&amp; last_index &lt; log_last_index {
                     return Ok(self.into());
                 }
<a href="#h2-3-3" id="h2-3-3" class="d">-                if let Address::Peer(from) = msg.from {
</a><a href="#h2-3-4" id="h2-3-4" class="i">+                if let Address::Node(from) = msg.from {
</a>                     info!(&quot;Voting for {} in term {} election&quot;, from, self.term);
<a href="#h2-3-6" id="h2-3-6" class="d">-                    self.send(Address::Peer(from), Event::GrantVote)?;
</a><a href="#h2-3-7" id="h2-3-7" class="i">+                    self.send(Address::Node(from), Event::GrantVote)?;
</a>                     self.log.set_term(self.term, Some(from))?;
                     self.role.voted_for = Some(from);
                 }
<a href="#h2-4" id="h2-4" class="h">@@ -132,7 +132,7 @@ impl RoleNode&lt;Follower&gt; {
</a>             Event::ClientRequest { ref id, .. } =&gt; {
                 if let Some(leader) = self.role.leader {
                     self.proxied_reqs.insert(id.clone(), msg.from);
<a href="#h2-4-3" id="h2-4-3" class="d">-                    self.send(Address::Peer(leader), msg.event)?
</a><a href="#h2-4-4" id="h2-4-4" class="i">+                    self.send(Address::Node(leader), msg.event)?
</a>                 } else {
                     self.queued_reqs.push((msg.from, msg.event));
                 }
<a href="#h2-5" id="h2-5" class="h">@@ -219,8 +219,8 @@ pub mod tests {
</a>     fn step_heartbeat() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-5-3" id="h2-5-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-5-4" id="h2-5-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-5-5" id="h2-5-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-5-6" id="h2-5-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-6" id="h2-6" class="h">@@ -229,7 +229,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-6-3" id="h2-6-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-6-4" id="h2-6-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h2-7" id="h2-7" class="h">@@ -248,8 +248,8 @@ pub mod tests {
</a>     fn step_heartbeat_conflict_commit_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-7-3" id="h2-7-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-7-4" id="h2-7-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-7-5" id="h2-7-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-7-6" id="h2-7-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 3 },
         })?;
<a href="#h2-8" id="h2-8" class="h">@@ -258,7 +258,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-8-3" id="h2-8-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-8-4" id="h2-8-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: false },
             }],
<a href="#h2-9" id="h2-9" class="h">@@ -272,8 +272,8 @@ pub mod tests {
</a>     fn step_heartbeat_missing_commit_entry() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-9-3" id="h2-9-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-9-4" id="h2-9-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-9-5" id="h2-9-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-9-6" id="h2-9-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h2-10" id="h2-10" class="h">@@ -282,7 +282,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-10-3" id="h2-10-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-10-4" id="h2-10-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 5, has_committed: false },
             }],
<a href="#h2-11" id="h2-11" class="h">@@ -296,8 +296,8 @@ pub mod tests {
</a>     fn step_heartbeat_fake_leader() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-11-3" id="h2-11-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-11-4" id="h2-11-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-11-5" id="h2-11-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-11-6" id="h2-11-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h2-12" id="h2-12" class="h">@@ -313,8 +313,8 @@ pub mod tests {
</a>         let (mut follower, mut node_rx, mut state_rx) = setup()?;
         follower.role = Follower::new(None, None);
         let mut node = follower.step(Message {
<a href="#h2-12-3" id="h2-12-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-12-4" id="h2-12-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-12-5" id="h2-12-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-12-6" id="h2-12-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-13" id="h2-13" class="h">@@ -323,7 +323,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-13-3" id="h2-13-3" class="d">-                to: Address::Peer(3),
</a><a href="#h2-13-4" id="h2-13-4" class="i">+                to: Address::Node(3),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h2-14" id="h2-14" class="h">@@ -342,8 +342,8 @@ pub mod tests {
</a>     fn step_heartbeat_old_commit_index() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-14-3" id="h2-14-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-14-4" id="h2-14-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-14-5" id="h2-14-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-14-6" id="h2-14-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
         })?;
<a href="#h2-15" id="h2-15" class="h">@@ -352,7 +352,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-15-3" id="h2-15-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-15-4" id="h2-15-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 1, has_committed: true },
             }],
<a href="#h2-16" id="h2-16" class="h">@@ -366,8 +366,8 @@ pub mod tests {
</a>     fn step_heartbeat_future_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-16-3" id="h2-16-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-16-4" id="h2-16-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-16-5" id="h2-16-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-16-6" id="h2-16-6" class="i">+            to: Address::Node(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-17" id="h2-17" class="h">@@ -376,7 +376,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-17-3" id="h2-17-3" class="d">-                to: Address::Peer(3),
</a><a href="#h2-17-4" id="h2-17-4" class="i">+                to: Address::Node(3),
</a>                 term: 4,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h2-18" id="h2-18" class="h">@@ -395,8 +395,8 @@ pub mod tests {
</a>     fn step_heartbeat_past_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-18-3" id="h2-18-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-18-4" id="h2-18-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-18-5" id="h2-18-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-18-6" id="h2-18-6" class="i">+            to: Address::Node(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-19" id="h2-19" class="h">@@ -413,8 +413,8 @@ pub mod tests {
</a> 
         // The first vote request in this term yields a vote response.
         let mut node = follower.step(Message {
<a href="#h2-19-3" id="h2-19-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-19-4" id="h2-19-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-19-5" id="h2-19-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-19-6" id="h2-19-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h2-20" id="h2-20" class="h">@@ -423,7 +423,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-20-3" id="h2-20-3" class="d">-                to: Address::Peer(3),
</a><a href="#h2-20-4" id="h2-20-4" class="i">+                to: Address::Node(3),
</a>                 term: 3,
                 event: Event::GrantVote,
             }],
<a href="#h2-21" id="h2-21" class="h">@@ -432,8 +432,8 @@ pub mod tests {
</a> 
         // Another vote request from the same sender is granted.
         node = node.step(Message {
<a href="#h2-21-3" id="h2-21-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-21-4" id="h2-21-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-21-5" id="h2-21-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-21-6" id="h2-21-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h2-22" id="h2-22" class="h">@@ -442,7 +442,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-22-3" id="h2-22-3" class="d">-                to: Address::Peer(3),
</a><a href="#h2-22-4" id="h2-22-4" class="i">+                to: Address::Node(3),
</a>                 term: 3,
                 event: Event::GrantVote,
             }],
<a href="#h2-23" id="h2-23" class="h">@@ -451,8 +451,8 @@ pub mod tests {
</a> 
         // But a vote request from a different node is ignored.
         node = node.step(Message {
<a href="#h2-23-3" id="h2-23-3" class="d">-            from: Address::Peer(4),
</a><a href="#h2-23-4" id="h2-23-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-23-5" id="h2-23-5" class="i">+            from: Address::Node(4),
</a><a href="#h2-23-6" id="h2-23-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h2-24" id="h2-24" class="h">@@ -467,8 +467,8 @@ pub mod tests {
</a>     fn step_grantvote_noop() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-24-3" id="h2-24-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-24-4" id="h2-24-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-24-5" id="h2-24-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-24-6" id="h2-24-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<a href="#h2-25" id="h2-25" class="h">@@ -483,8 +483,8 @@ pub mod tests {
</a>     fn step_solicitvote_last_index_outdated() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-25-3" id="h2-25-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-25-4" id="h2-25-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-25-5" id="h2-25-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-25-6" id="h2-25-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 2, last_term: 2 },
         })?;
<a href="#h2-26" id="h2-26" class="h">@@ -499,8 +499,8 @@ pub mod tests {
</a>     fn step_solicitvote_last_term_outdated() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-26-3" id="h2-26-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-26-4" id="h2-26-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-26-5" id="h2-26-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-26-6" id="h2-26-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 1 },
         })?;
<a href="#h2-27" id="h2-27" class="h">@@ -534,8 +534,8 @@ pub mod tests {
</a>         };
 
         let mut node = follower.step(Message {
<a href="#h2-27-3" id="h2-27-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-27-4" id="h2-27-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-27-5" id="h2-27-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-27-6" id="h2-27-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 0,
<a href="#h2-28" id="h2-28" class="h">@@ -554,7 +554,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-28-3" id="h2-28-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-28-4" id="h2-28-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 2 },
             }],
<a href="#h2-29" id="h2-29" class="h">@@ -568,8 +568,8 @@ pub mod tests {
</a>     fn step_replicateentries_append() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-29-3" id="h2-29-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-29-4" id="h2-29-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-29-5" id="h2-29-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-29-6" id="h2-29-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 3,
<a href="#h2-30" id="h2-30" class="h">@@ -591,7 +591,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-30-3" id="h2-30-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-30-4" id="h2-30-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 5 },
             }],
<a href="#h2-31" id="h2-31" class="h">@@ -605,8 +605,8 @@ pub mod tests {
</a>     fn step_replicateentries_partial_overlap() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-31-3" id="h2-31-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-31-4" id="h2-31-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-31-5" id="h2-31-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-31-6" id="h2-31-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 1,
<a href="#h2-32" id="h2-32" class="h">@@ -627,7 +627,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-32-3" id="h2-32-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-32-4" id="h2-32-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h2-33" id="h2-33" class="h">@@ -641,8 +641,8 @@ pub mod tests {
</a>     fn step_replicateentries_replace() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-33-3" id="h2-33-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-33-4" id="h2-33-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-33-5" id="h2-33-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-33-6" id="h2-33-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 2,
<a href="#h2-34" id="h2-34" class="h">@@ -663,7 +663,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-34-3" id="h2-34-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-34-4" id="h2-34-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h2-35" id="h2-35" class="h">@@ -677,8 +677,8 @@ pub mod tests {
</a>     fn step_replicateentries_replace_partial() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-35-3" id="h2-35-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-35-4" id="h2-35-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-35-5" id="h2-35-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-35-6" id="h2-35-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 2,
<a href="#h2-36" id="h2-36" class="h">@@ -699,7 +699,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-36-3" id="h2-36-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-36-4" id="h2-36-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h2-37" id="h2-37" class="h">@@ -713,8 +713,8 @@ pub mod tests {
</a>     fn step_replicateentries_reject_missing_base_index() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-37-3" id="h2-37-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-37-4" id="h2-37-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-37-5" id="h2-37-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-37-6" id="h2-37-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 5,
<a href="#h2-38" id="h2-38" class="h">@@ -731,7 +731,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-38-3" id="h2-38-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-38-4" id="h2-38-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::RejectEntries,
             }],
<a href="#h2-39" id="h2-39" class="h">@@ -745,8 +745,8 @@ pub mod tests {
</a>     fn step_replicateentries_reject_missing_base_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h2-39-3" id="h2-39-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-39-4" id="h2-39-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-39-5" id="h2-39-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-39-6" id="h2-39-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 1,
<a href="#h2-40" id="h2-40" class="h">@@ -763,7 +763,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-40-3" id="h2-40-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-40-4" id="h2-40-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::RejectEntries,
             }],
<a href="#h2-41" id="h2-41" class="h">@@ -794,7 +794,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-41-3" id="h2-41-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-41-4" id="h2-41-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ClientRequest {
                     id: vec![0x01],
<a href="#h2-42" id="h2-42" class="h">@@ -805,8 +805,8 @@ pub mod tests {
</a>         assert_messages(&amp;mut state_rx, vec![]);
 
         node = node.step(Message {
<a href="#h2-42-3" id="h2-42-3" class="d">-            from: Address::Peer(2),
</a><a href="#h2-42-4" id="h2-42-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-42-5" id="h2-42-5" class="i">+            from: Address::Node(2),
</a><a href="#h2-42-6" id="h2-42-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ClientResponse {
                 id: vec![0x01],
<a href="#h2-43" id="h2-43" class="h">@@ -852,8 +852,8 @@ pub mod tests {
</a> 
         // When a leader appears, we will proxy the queued request to them.
         node = node.step(Message {
<a href="#h2-43-3" id="h2-43-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-43-4" id="h2-43-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-43-5" id="h2-43-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-43-6" id="h2-43-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-44" id="h2-44" class="h">@@ -868,7 +868,7 @@ pub mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h2-44-3" id="h2-44-3" class="d">-                    to: Address::Peer(3),
</a><a href="#h2-44-4" id="h2-44-4" class="i">+                    to: Address::Node(3),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0x01],
<a href="#h2-45" id="h2-45" class="h">@@ -877,7 +877,7 @@ pub mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h2-45-3" id="h2-45-3" class="d">-                    to: Address::Peer(3),
</a><a href="#h2-45-4" id="h2-45-4" class="i">+                    to: Address::Node(3),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
                 },
<a href="#h2-46" id="h2-46" class="h">@@ -914,7 +914,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h2-46-3" id="h2-46-3" class="d">-                to: Address::Peer(2),
</a><a href="#h2-46-4" id="h2-46-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ClientRequest {
                     id: vec![0x01],
<a href="#h2-47" id="h2-47" class="h">@@ -926,8 +926,8 @@ pub mod tests {
</a> 
         // When a new leader appears, the proxied request is aborted.
         node = node.step(Message {
<a href="#h2-47-3" id="h2-47-3" class="d">-            from: Address::Peer(3),
</a><a href="#h2-47-4" id="h2-47-4" class="d">-            to: Address::Peer(1),
</a><a href="#h2-47-5" id="h2-47-5" class="i">+            from: Address::Node(3),
</a><a href="#h2-47-6" id="h2-47-6" class="i">+            to: Address::Node(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h2-48" id="h2-48" class="h">@@ -943,7 +943,7 @@ pub mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h2-48-3" id="h2-48-3" class="d">-                    to: Address::Peer(3),
</a><a href="#h2-48-4" id="h2-48-4" class="i">+                    to: Address::Node(3),
</a>                     term: 4,
                     event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
                 },
<a href="#h2-49" id="h2-49" class="h">@@ -970,8 +970,8 @@ pub mod tests {
</a>             assert_node(&amp;mut node).is_follower().term(3).leader(Some(2));
             node = node.tick()?;
             node = node.step(Message {
<a href="#h2-49-3" id="h2-49-3" class="d">-                from: Address::Peer(2),
</a><a href="#h2-49-4" id="h2-49-4" class="d">-                to: Address::Peer(1),
</a><a href="#h2-49-5" id="h2-49-5" class="i">+                from: Address::Node(2),
</a><a href="#h2-49-6" id="h2-49-6" class="i">+                to: Address::Node(1),
</a>                 term: 3,
                 event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
             })?;
<a href="#h2-50" id="h2-50" class="h">@@ -979,7 +979,7 @@ pub mod tests {
</a>                 &amp;mut node_rx,
                 vec![Message {
                     from: Address::Local,
<a href="#h2-50-3" id="h2-50-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h2-50-4" id="h2-50-4" class="i">+                    to: Address::Node(2),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 }],
<b>diff --git a/<a id="h3" href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a> b/<a href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -91,7 +91,7 @@ impl RoleNode&lt;Leader&gt; {
</a>         };
         let entries = self.log.scan(peer_next..)?.collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;()?;
         debug!(&quot;Replicating {} entries at base {} to {}&quot;, entries.len(), base_index, peer);
<a href="#h3-0-3" id="h3-0-3" class="d">-        self.send(Address::Peer(peer), Event::ReplicateEntries { base_index, base_term, entries })?;
</a><a href="#h3-0-4" id="h3-0-4" class="i">+        self.send(Address::Node(peer), Event::ReplicateEntries { base_index, base_term, entries })?;
</a>         Ok(())
     }
 
<a href="#h3-1" id="h3-1" class="h">@@ -102,14 +102,14 @@ impl RoleNode&lt;Leader&gt; {
</a>             return Ok(self.into());
         }
         if msg.term &gt; self.term {
<a href="#h3-1-3" id="h3-1-3" class="d">-            if let Address::Peer(from) = msg.from {
</a><a href="#h3-1-4" id="h3-1-4" class="i">+            if let Address::Node(from) = msg.from {
</a>                 return self.become_follower(msg.term, from)?.step(msg);
             }
         }
 
         match msg.event {
             Event::ConfirmLeader { commit_index, has_committed } =&gt; {
<a href="#h3-1-11" id="h3-1-11" class="d">-                if let Address::Peer(from) = msg.from {
</a><a href="#h3-1-12" id="h3-1-12" class="i">+                if let Address::Node(from) = msg.from {
</a>                     self.state_tx.send(Instruction::Vote {
                         term: msg.term,
                         index: commit_index,
<a href="#h3-2" id="h3-2" class="h">@@ -122,7 +122,7 @@ impl RoleNode&lt;Leader&gt; {
</a>             }
 
             Event::AcceptEntries { last_index } =&gt; {
<a href="#h3-2-3" id="h3-2-3" class="d">-                if let Address::Peer(from) = msg.from {
</a><a href="#h3-2-4" id="h3-2-4" class="i">+                if let Address::Node(from) = msg.from {
</a>                     self.role.peer_last_index.insert(from, last_index);
                     self.role.peer_next_index.insert(from, last_index + 1);
                 }
<a href="#h3-3" id="h3-3" class="h">@@ -130,7 +130,7 @@ impl RoleNode&lt;Leader&gt; {
</a>             }
 
             Event::RejectEntries =&gt; {
<a href="#h3-3-3" id="h3-3-3" class="d">-                if let Address::Peer(from) = msg.from {
</a><a href="#h3-3-4" id="h3-3-4" class="i">+                if let Address::Node(from) = msg.from {
</a>                     self.role.peer_next_index.entry(from).and_modify(|i| {
                         if *i &gt; 1 {
                             *i -= 1
<a href="#h3-4" id="h3-4" class="h">@@ -265,8 +265,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-4-3" id="h3-4-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-4-4" id="h3-4-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-4-5" id="h3-4-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-4-6" id="h3-4-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
         })?;
<a href="#h3-5" id="h3-5" class="h">@@ -274,7 +274,7 @@ mod tests {
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(
             &amp;mut state_rx,
<a href="#h3-5-3" id="h3-5-3" class="d">-            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(2) }],
</a><a href="#h3-5-4" id="h3-5-4" class="i">+            vec![Instruction::Vote { term: 3, index: 2, address: Address::Node(2) }],
</a>         );
         Ok(())
     }
<a href="#h3-6" id="h3-6" class="h">@@ -286,8 +286,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-6-3" id="h3-6-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-6-4" id="h3-6-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-6-5" id="h3-6-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-6-6" id="h3-6-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::ConfirmLeader { commit_index: 2, has_committed: false },
         })?;
<a href="#h3-7" id="h3-7" class="h">@@ -296,14 +296,14 @@ mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h3-7-3" id="h3-7-3" class="d">-                to: Address::Peer(2),
</a><a href="#h3-7-4" id="h3-7-4" class="i">+                to: Address::Node(2),
</a>                 term: 3,
                 event: Event::ReplicateEntries { base_index: 5, base_term: 3, entries: vec![] },
             }],
         );
         assert_messages(
             &amp;mut state_rx,
<a href="#h3-7-11" id="h3-7-11" class="d">-            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(2) }],
</a><a href="#h3-7-12" id="h3-7-12" class="i">+            vec![Instruction::Vote { term: 3, index: 2, address: Address::Node(2) }],
</a>         );
         Ok(())
     }
<a href="#h3-8" id="h3-8" class="h">@@ -315,8 +315,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-8-3" id="h3-8-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-8-4" id="h3-8-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-8-5" id="h3-8-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-8-6" id="h3-8-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h3-9" id="h3-9" class="h">@@ -333,8 +333,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-9-3" id="h3-9-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-9-4" id="h3-9-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-9-5" id="h3-9-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-9-6" id="h3-9-6" class="i">+            to: Address::Node(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 7, commit_term: 4 },
         })?;
<a href="#h3-10" id="h3-10" class="h">@@ -343,7 +343,7 @@ mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h3-10-3" id="h3-10-3" class="d">-                to: Address::Peer(2),
</a><a href="#h3-10-4" id="h3-10-4" class="i">+                to: Address::Node(2),
</a>                 term: 4,
                 event: Event::ConfirmLeader { commit_index: 7, has_committed: false },
             }],
<a href="#h3-11" id="h3-11" class="h">@@ -359,8 +359,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-11-3" id="h3-11-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-11-4" id="h3-11-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-11-5" id="h3-11-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-11-6" id="h3-11-6" class="i">+            to: Address::Node(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h3-12" id="h3-12" class="h">@@ -376,8 +376,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h3-12-3" id="h3-12-3" class="d">-            from: Address::Peer(2),
</a><a href="#h3-12-4" id="h3-12-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-12-5" id="h3-12-5" class="i">+            from: Address::Node(2),
</a><a href="#h3-12-6" id="h3-12-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 4 },
         })?;
<a href="#h3-13" id="h3-13" class="h">@@ -386,8 +386,8 @@ mod tests {
</a>         assert_messages(&amp;mut state_rx, vec![]);
 
         node = node.step(Message {
<a href="#h3-13-3" id="h3-13-3" class="d">-            from: Address::Peer(3),
</a><a href="#h3-13-4" id="h3-13-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-13-5" id="h3-13-5" class="i">+            from: Address::Node(3),
</a><a href="#h3-13-6" id="h3-13-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 5 },
         })?;
<a href="#h3-14" id="h3-14" class="h">@@ -406,8 +406,8 @@ mod tests {
</a>         );
 
         node = node.step(Message {
<a href="#h3-14-3" id="h3-14-3" class="d">-            from: Address::Peer(4),
</a><a href="#h3-14-4" id="h3-14-4" class="d">-            to: Address::Peer(1),
</a><a href="#h3-14-5" id="h3-14-5" class="i">+            from: Address::Node(4),
</a><a href="#h3-14-6" id="h3-14-6" class="i">+            to: Address::Node(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 5 },
         })?;
<a href="#h3-15" id="h3-15" class="h">@@ -432,8 +432,8 @@ mod tests {
</a> 
         for _ in 0..5 {
             node = node.step(Message {
<a href="#h3-15-3" id="h3-15-3" class="d">-                from: Address::Peer(2),
</a><a href="#h3-15-4" id="h3-15-4" class="d">-                to: Address::Peer(1),
</a><a href="#h3-15-5" id="h3-15-5" class="i">+                from: Address::Node(2),
</a><a href="#h3-15-6" id="h3-15-6" class="i">+                to: Address::Node(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 5 },
             })?;
<a href="#h3-16" id="h3-16" class="h">@@ -453,8 +453,8 @@ mod tests {
</a> 
         for peer in peers.into_iter() {
             node = node.step(Message {
<a href="#h3-16-3" id="h3-16-3" class="d">-                from: Address::Peer(peer),
</a><a href="#h3-16-4" id="h3-16-4" class="d">-                to: Address::Peer(1),
</a><a href="#h3-16-5" id="h3-16-5" class="i">+                from: Address::Node(peer),
</a><a href="#h3-16-6" id="h3-16-6" class="i">+                to: Address::Node(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 3 },
             })?;
<a href="#h3-17" id="h3-17" class="h">@@ -474,8 +474,8 @@ mod tests {
</a> 
         for (i, peer) in peers.into_iter().enumerate() {
             node = node.step(Message {
<a href="#h3-17-3" id="h3-17-3" class="d">-                from: Address::Peer(peer),
</a><a href="#h3-17-4" id="h3-17-4" class="d">-                to: Address::Peer(1),
</a><a href="#h3-17-5" id="h3-17-5" class="i">+                from: Address::Node(peer),
</a><a href="#h3-17-6" id="h3-17-6" class="i">+                to: Address::Node(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 7 },
             })?;
<a href="#h3-18" id="h3-18" class="h">@@ -514,8 +514,8 @@ mod tests {
</a> 
         for i in 0..(entries.len() + 3) {
             node = node.step(Message {
<a href="#h3-18-3" id="h3-18-3" class="d">-                from: Address::Peer(2),
</a><a href="#h3-18-4" id="h3-18-4" class="d">-                to: Address::Peer(1),
</a><a href="#h3-18-5" id="h3-18-5" class="i">+                from: Address::Node(2),
</a><a href="#h3-18-6" id="h3-18-6" class="i">+                to: Address::Node(1),
</a>                 term: 3,
                 event: Event::RejectEntries,
             })?;
<a href="#h3-19" id="h3-19" class="h">@@ -526,7 +526,7 @@ mod tests {
</a>                 &amp;mut node_rx,
                 vec![Message {
                     from: Address::Local,
<a href="#h3-19-3" id="h3-19-3" class="d">-                    to: Address::Peer(2),
</a><a href="#h3-19-4" id="h3-19-4" class="i">+                    to: Address::Node(2),
</a>                     term: 3,
                     event: Event::ReplicateEntries {
                         base_index: index as Index,
<a href="#h3-20" id="h3-20" class="h">@@ -607,7 +607,7 @@ mod tests {
</a>                 node_rx.try_recv()?,
                 Message {
                     from: Address::Local,
<a href="#h3-20-3" id="h3-20-3" class="d">-                    to: Address::Peer(peer),
</a><a href="#h3-20-4" id="h3-20-4" class="i">+                    to: Address::Node(peer),
</a>                     term: 3,
                     event: Event::ReplicateEntries {
                         base_index: 5,
<b>diff --git a/<a id="h4" href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a> b/<a href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -221,10 +221,10 @@ impl&lt;R&gt; RoleNode&lt;R&gt; {
</a>         }
 
         match msg.to {
<a href="#h4-0-3" id="h4-0-3" class="d">-            Address::Peer(id) if id == self.id =&gt; Ok(()),
</a><a href="#h4-0-4" id="h4-0-4" class="i">+            Address::Node(id) if id == self.id =&gt; Ok(()),
</a>             Address::Local =&gt; Ok(()),
             Address::Broadcast =&gt; Ok(()),
<a href="#h4-0-7" id="h4-0-7" class="d">-            Address::Peer(id) =&gt; {
</a><a href="#h4-0-8" id="h4-0-8" class="i">+            Address::Node(id) =&gt; {
</a>                 Err(Error::Internal(format!(&quot;Received message for other node {}&quot;, id)))
             }
             Address::Client =&gt; Err(Error::Internal(&quot;Received message for client&quot;.into())),
<a href="#h4-1" id="h4-1" class="h">@@ -543,12 +543,12 @@ mod tests {
</a>     #[test]
     fn send() -&gt; Result&lt;()&gt; {
         let (node, mut rx) = setup_rolenode()?;
<a href="#h4-1-3" id="h4-1-3" class="d">-        node.send(Address::Peer(2), Event::Heartbeat { commit_index: 1, commit_term: 1 })?;
</a><a href="#h4-1-4" id="h4-1-4" class="i">+        node.send(Address::Node(2), Event::Heartbeat { commit_index: 1, commit_term: 1 })?;
</a>         assert_messages(
             &amp;mut rx,
             vec![Message {
                 from: Address::Local,
<a href="#h4-1-9" id="h4-1-9" class="d">-                to: Address::Peer(2),
</a><a href="#h4-1-10" id="h4-1-10" class="i">+                to: Address::Node(2),
</a>                 term: 1,
                 event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
             }],
<b>diff --git a/<a id="h5" href="../file/src/raft/server.rs.html">src/raft/server.rs</a> b/<a href="../file/src/raft/server.rs.html">src/raft/server.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -82,7 +82,7 @@ impl Server {
</a> 
                 Some(msg) = node_rx.next() =&gt; {
                     match msg {
<a href="#h5-0-3" id="h5-0-3" class="d">-                        Message{to: Address::Peer(_), ..} =&gt; tcp_tx.send(msg)?,
</a><a href="#h5-0-4" id="h5-0-4" class="i">+                        Message{to: Address::Node(_), ..} =&gt; tcp_tx.send(msg)?,
</a>                         Message{to: Address::Broadcast, ..} =&gt; tcp_tx.send(msg)?,
                         Message{to: Address::Client, event: Event::ClientResponse{ id, response }, ..} =&gt; {
                             if let Some(response_tx) = requests.remove(&amp;id) {
<a href="#h5-1" id="h5-1" class="h">@@ -161,11 +161,11 @@ impl Server {
</a> 
         while let Some(mut message) = out_rx.next().await {
             if message.from == Address::Local {
<a href="#h5-1-3" id="h5-1-3" class="d">-                message.from = Address::Peer(node_id)
</a><a href="#h5-1-4" id="h5-1-4" class="i">+                message.from = Address::Node(node_id)
</a>             }
             let to = match message.to {
                 Address::Broadcast =&gt; peer_txs.keys().copied().collect(),
<a href="#h5-1-8" id="h5-1-8" class="d">-                Address::Peer(peer) =&gt; vec![peer],
</a><a href="#h5-1-9" id="h5-1-9" class="i">+                Address::Node(peer) =&gt; vec![peer],
</a>                 addr =&gt; {
                     error!(&quot;Received outbound message for non-TCP address {:?}&quot;, addr);
                     continue;
<b>diff --git a/<a id="h6" href="../file/src/raft/state.rs.html">src/raft/state.rs</a> b/<a href="../file/src/raft/state.rs.html">src/raft/state.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -319,7 +319,7 @@ pub mod tests {
</a>         state_tx.send(Instruction::Notify {
             id: vec![0x01],
             index: 1,
<a href="#h6-0-3" id="h6-0-3" class="d">-            address: Address::Peer(1),
</a><a href="#h6-0-4" id="h6-0-4" class="i">+            address: Address::Node(1),
</a>         })?;
         state_tx.send(Instruction::Query {
             id: vec![0x02],
<a href="#h6-1" id="h6-1" class="h">@@ -339,7 +339,7 @@ pub mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h6-1-3" id="h6-1-3" class="d">-                    to: Address::Peer(1),
</a><a href="#h6-1-4" id="h6-1-4" class="i">+                    to: Address::Node(1),
</a>                     term: 0,
                     event: Event::ClientResponse { id: vec![0x01], response: Err(Error::Abort) }
                 },
<a href="#h6-2" id="h6-2" class="h">@@ -407,7 +407,7 @@ pub mod tests {
</a>             entry: Entry { index: 1, term: 2, command: Some(vec![0xaf]) },
         })?;
         state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Local })?;
<a href="#h6-2-3" id="h6-2-3" class="d">-        state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Peer(1) })?;
</a><a href="#h6-2-4" id="h6-2-4" class="i">+        state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Node(1) })?;
</a>         std::mem::drop(state_tx);
 
         let node_rx = UnboundedReceiverStream::new(node_rx);
<a href="#h6-3" id="h6-3" class="h">@@ -444,7 +444,7 @@ pub mod tests {
</a>             entry: Entry { index: 1, term: 1, command: Some(vec![0xaf]) },
         })?;
         state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Local })?;
<a href="#h6-3-3" id="h6-3-3" class="d">-        state_tx.send(Instruction::Vote { term: 1, index: 1, address: Address::Peer(1) })?;
</a><a href="#h6-3-4" id="h6-3-4" class="i">+        state_tx.send(Instruction::Vote { term: 1, index: 1, address: Address::Node(1) })?;
</a>         std::mem::drop(state_tx);
 
         let node_rx = UnboundedReceiverStream::new(node_rx);
</pre>
</div>
</body>
</html>
