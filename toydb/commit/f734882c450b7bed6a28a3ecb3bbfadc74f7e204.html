<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: added row validation - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/f734882c450b7bed6a28a3ecb3bbfadc74f7e204.html">f734882c450b7bed6a28a3ecb3bbfadc74f7e204</a>
<b>parent</b> <a href="../commit/df71163f17aada231f38abb62365014a28360a61.html">df71163f17aada231f38abb62365014a28360a61</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sun,  8 Sep 2019 15:18:35 +0200

sql: added row validation

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/sql/plan/mod.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">++++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/sql/schema.rs</a></td><td> | </td><td class="num">44</td><td><span class="i">+++++++++++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/storage.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">++++++++++++++</span><span class="d">-----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">src/sql/testdata/insert_error_datatype_conflict</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">src/sql/testdata/insert_error_null_disallowed</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">src/sql/testdata/insert_error_pk_exists</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">src/sql/testdata/insert_error_pk_null</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">src/sql/testdata/insert_values</a></td><td> | </td><td class="num">76</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/tests.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">++++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/sql/types.rs</a></td><td> | </td><td class="num">39</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">-------</span></td></tr>
</table></pre><pre>10 files changed, 391 insertions(+), 33 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a> b/<a href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -141,21 +141,22 @@ impl Planner {
</a>     fn build_schema_table(
         &amp;self,
         name: String,
<a href="#h0-0-3" id="h0-0-3" class="d">-        columnspecs: Vec&lt;ast::ColumnSpec&gt;,
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        cols: Vec&lt;ast::ColumnSpec&gt;,
</a>     ) -&gt; Result&lt;schema::Table, Error&gt; {
<a href="#h0-0-6" id="h0-0-6" class="d">-        match columnspecs.iter().filter(|c| c.primary_key).count() {
</a><a href="#h0-0-7" id="h0-0-7" class="i">+        match cols.iter().filter(|c| c.primary_key).count() {
</a>             0 =&gt; return Err(Error::Value(format!(&quot;No primary key defined for table {}&quot;, name))),
<a href="#h0-0-9" id="h0-0-9" class="d">-            n if n &gt; 1 =&gt; return Err(Error::Value(format!(
</a><a href="#h0-0-10" id="h0-0-10" class="d">-                &quot;{} primary keys defined for table {}, must set exactly 1&quot;,
</a><a href="#h0-0-11" id="h0-0-11" class="d">-                n,
</a><a href="#h0-0-12" id="h0-0-12" class="d">-                name
</a><a href="#h0-0-13" id="h0-0-13" class="d">-            ))),
</a><a href="#h0-0-14" id="h0-0-14" class="i">+            n if n &gt; 1 =&gt; {
</a><a href="#h0-0-15" id="h0-0-15" class="i">+                return Err(Error::Value(format!(
</a><a href="#h0-0-16" id="h0-0-16" class="i">+                    &quot;{} primary keys defined for table {}, must set exactly 1&quot;,
</a><a href="#h0-0-17" id="h0-0-17" class="i">+                    n, name
</a><a href="#h0-0-18" id="h0-0-18" class="i">+                )))
</a><a href="#h0-0-19" id="h0-0-19" class="i">+            }
</a>             _ =&gt; {}
         };
         let table = schema::Table {
             name,
<a href="#h0-0-24" id="h0-0-24" class="d">-            primary_key: columnspecs.iter().position(|c| c.primary_key).unwrap_or(0),
</a><a href="#h0-0-25" id="h0-0-25" class="d">-            columns: columnspecs
</a><a href="#h0-0-26" id="h0-0-26" class="i">+            primary_key: cols.iter().position(|c| c.primary_key).unwrap_or(0),
</a><a href="#h0-0-27" id="h0-0-27" class="i">+            columns: cols
</a>                 .into_iter()
                 .map(|spec| schema::Column {
                     name: spec.name,
<b>diff --git a/<a id="h1" href="../file/src/sql/schema.rs.html">src/sql/schema.rs</a> b/<a href="../file/src/sql/schema.rs.html">src/sql/schema.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,4 +1,4 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-use super::types::DataType;
</a><a href="#h1-0-1" id="h1-0-1" class="i">+use super::types::{DataType, Value};
</a> use crate::Error;
 
 /// A table
<a href="#h1-1" id="h1-1" class="h">@@ -17,16 +17,7 @@ impl Table {
</a>     pub fn to_query(&amp;self) -&gt; String {
         let mut query = format!(&quot;CREATE TABLE {} (\n&quot;, self.name);
         for (i, column) in self.columns.iter().enumerate() {
<a href="#h1-1-3" id="h1-1-3" class="d">-            query += &amp;format!(
</a><a href="#h1-1-4" id="h1-1-4" class="d">-                &quot;  {} {}&quot;,
</a><a href="#h1-1-5" id="h1-1-5" class="d">-                column.name,
</a><a href="#h1-1-6" id="h1-1-6" class="d">-                match column.datatype {
</a><a href="#h1-1-7" id="h1-1-7" class="d">-                    DataType::Boolean =&gt; &quot;BOOLEAN&quot;,
</a><a href="#h1-1-8" id="h1-1-8" class="d">-                    DataType::Float =&gt; &quot;FLOAT&quot;,
</a><a href="#h1-1-9" id="h1-1-9" class="d">-                    DataType::Integer =&gt; &quot;INTEGER&quot;,
</a><a href="#h1-1-10" id="h1-1-10" class="d">-                    DataType::String =&gt; &quot;VARCHAR&quot;,
</a><a href="#h1-1-11" id="h1-1-11" class="d">-                }
</a><a href="#h1-1-12" id="h1-1-12" class="d">-            );
</a><a href="#h1-1-13" id="h1-1-13" class="i">+            query += &amp;format!(&quot;  {} {}&quot;, column.name, column.datatype);
</a>             if i == self.primary_key {
                 query += &quot; PRIMARY KEY&quot;;
             }
<a href="#h1-2" id="h1-2" class="h">@@ -56,6 +47,22 @@ impl Table {
</a>         }
         Ok(())
     }
<a href="#h1-2-3" id="h1-2-3" class="i">+
</a><a href="#h1-2-4" id="h1-2-4" class="i">+    /// Validates a row
</a><a href="#h1-2-5" id="h1-2-5" class="i">+    pub fn validate_row(&amp;self, row: &amp;[Value]) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h1-2-6" id="h1-2-6" class="i">+        if row.len() != self.columns.len() {
</a><a href="#h1-2-7" id="h1-2-7" class="i">+            return Err(Error::Value(format!(
</a><a href="#h1-2-8" id="h1-2-8" class="i">+                &quot;Invalid row size {} for table {}, expected {}&quot;,
</a><a href="#h1-2-9" id="h1-2-9" class="i">+                row.len(),
</a><a href="#h1-2-10" id="h1-2-10" class="i">+                self.name,
</a><a href="#h1-2-11" id="h1-2-11" class="i">+                self.columns.len()
</a><a href="#h1-2-12" id="h1-2-12" class="i">+            )));
</a><a href="#h1-2-13" id="h1-2-13" class="i">+        }
</a><a href="#h1-2-14" id="h1-2-14" class="i">+        for (column, value) in self.columns.iter().zip(row.iter()) {
</a><a href="#h1-2-15" id="h1-2-15" class="i">+            column.validate_value(value)?;
</a><a href="#h1-2-16" id="h1-2-16" class="i">+        }
</a><a href="#h1-2-17" id="h1-2-17" class="i">+        Ok(())
</a><a href="#h1-2-18" id="h1-2-18" class="i">+    }
</a> }
 
 /// A table column
<a href="#h1-3" id="h1-3" class="h">@@ -68,3 +75,18 @@ pub struct Column {
</a>     /// Whether the column allows null values
     pub nullable: bool,
 }
<a href="#h1-3-3" id="h1-3-3" class="i">+
</a><a href="#h1-3-4" id="h1-3-4" class="i">+impl Column {
</a><a href="#h1-3-5" id="h1-3-5" class="i">+    /// Validates a column value
</a><a href="#h1-3-6" id="h1-3-6" class="i">+    pub fn validate_value(&amp;self, value: &amp;Value) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h1-3-7" id="h1-3-7" class="i">+        match value.datatype() {
</a><a href="#h1-3-8" id="h1-3-8" class="i">+            None if self.nullable =&gt; Ok(()),
</a><a href="#h1-3-9" id="h1-3-9" class="i">+            None =&gt; Err(Error::Value(format!(&quot;NULL value not allowed for column {}&quot;, self.name))),
</a><a href="#h1-3-10" id="h1-3-10" class="i">+            Some(ref datatype) if datatype != &amp;self.datatype =&gt; Err(Error::Value(format!(
</a><a href="#h1-3-11" id="h1-3-11" class="i">+                &quot;Invalid datatype {} for {} column {}&quot;,
</a><a href="#h1-3-12" id="h1-3-12" class="i">+                datatype, self.datatype, self.name
</a><a href="#h1-3-13" id="h1-3-13" class="i">+            ))),
</a><a href="#h1-3-14" id="h1-3-14" class="i">+            _ =&gt; Ok(()),
</a><a href="#h1-3-15" id="h1-3-15" class="i">+        }
</a><a href="#h1-3-16" id="h1-3-16" class="i">+    }
</a><a href="#h1-3-17" id="h1-3-17" class="i">+}
</a><b>diff --git a/<a id="h2" href="../file/src/sql/storage.rs.html">src/sql/storage.rs</a> b/<a href="../file/src/sql/storage.rs.html">src/sql/storage.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -19,11 +19,15 @@ impl Storage {
</a>     /// Creates a row
     pub fn create_row(&amp;mut self, table: &amp;str, row: types::Row) -&gt; Result&lt;(), Error&gt; {
         let table = self.get_table(&amp;table)?;
<a href="#h2-0-3" id="h2-0-3" class="d">-        let id = row
</a><a href="#h2-0-4" id="h2-0-4" class="d">-            .get(table.primary_key)
</a><a href="#h2-0-5" id="h2-0-5" class="d">-            .ok_or_else(|| Error::Value(&quot;No primary key value&quot;.into()))?;
</a><a href="#h2-0-6" id="h2-0-6" class="d">-        // FIXME Needs to check existence
</a><a href="#h2-0-7" id="h2-0-7" class="d">-        self.kv.write()?.set(&amp;Self::key_row(&amp;table.name, &amp;id.to_string()), serialize(row)?)?;
</a><a href="#h2-0-8" id="h2-0-8" class="i">+        table.validate_row(&amp;row)?;
</a><a href="#h2-0-9" id="h2-0-9" class="i">+        let pk = row.get(table.primary_key).unwrap();
</a><a href="#h2-0-10" id="h2-0-10" class="i">+        if self.get_row(&amp;table.name, &amp;pk)?.is_some() {
</a><a href="#h2-0-11" id="h2-0-11" class="i">+            return Err(Error::Value(format!(
</a><a href="#h2-0-12" id="h2-0-12" class="i">+                &quot;Primary key {} already exists for table {}&quot;,
</a><a href="#h2-0-13" id="h2-0-13" class="i">+                pk, table.name
</a><a href="#h2-0-14" id="h2-0-14" class="i">+            )));
</a><a href="#h2-0-15" id="h2-0-15" class="i">+        }
</a><a href="#h2-0-16" id="h2-0-16" class="i">+        self.kv.write()?.set(&amp;Self::key_row(&amp;table.name, &amp;pk.to_string()), serialize(row)?)?;
</a>         Ok(())
     }
 
<a href="#h2-1" id="h2-1" class="h">@@ -44,6 +48,11 @@ impl Storage {
</a>         Ok(())
     }
 
<a href="#h2-1-3" id="h2-1-3" class="i">+    /// Fetches a row
</a><a href="#h2-1-4" id="h2-1-4" class="i">+    pub fn get_row(&amp;self, table: &amp;str, id: &amp;types::Value) -&gt; Result&lt;Option&lt;types::Row&gt;, Error&gt; {
</a><a href="#h2-1-5" id="h2-1-5" class="i">+        self.kv.read()?.get(&amp;Self::key_row(table, &amp;id.to_string()))?.map(deserialize).transpose()
</a><a href="#h2-1-6" id="h2-1-6" class="i">+    }
</a><a href="#h2-1-7" id="h2-1-7" class="i">+
</a>     /// Fetches a table schema
     pub fn get_table(&amp;self, table: &amp;str) -&gt; Result&lt;schema::Table, Error&gt; {
         deserialize(
<b>diff --git a/<a id="h3" href="../file/src/sql/testdata/insert_error_datatype_conflict.html">src/sql/testdata/insert_error_datatype_conflict</a> b/<a href="../file/src/sql/testdata/insert_error_datatype_conflict.html">src/sql/testdata/insert_error_datatype_conflict</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,55 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+Query: INSERT INTO genres VALUES (9, 3.14)
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+Tokens:
</a><a href="#h3-0-3" id="h3-0-3" class="i">+  Keyword(Insert)
</a><a href="#h3-0-4" id="h3-0-4" class="i">+  Keyword(Into)
</a><a href="#h3-0-5" id="h3-0-5" class="i">+  Ident(&quot;genres&quot;)
</a><a href="#h3-0-6" id="h3-0-6" class="i">+  Keyword(Values)
</a><a href="#h3-0-7" id="h3-0-7" class="i">+  OpenParen
</a><a href="#h3-0-8" id="h3-0-8" class="i">+  Number(&quot;9&quot;)
</a><a href="#h3-0-9" id="h3-0-9" class="i">+  Comma
</a><a href="#h3-0-10" id="h3-0-10" class="i">+  Number(&quot;3.14&quot;)
</a><a href="#h3-0-11" id="h3-0-11" class="i">+  CloseParen
</a><a href="#h3-0-12" id="h3-0-12" class="i">+
</a><a href="#h3-0-13" id="h3-0-13" class="i">+AST: Insert {
</a><a href="#h3-0-14" id="h3-0-14" class="i">+    table: &quot;genres&quot;,
</a><a href="#h3-0-15" id="h3-0-15" class="i">+    columns: None,
</a><a href="#h3-0-16" id="h3-0-16" class="i">+    values: [
</a><a href="#h3-0-17" id="h3-0-17" class="i">+        [
</a><a href="#h3-0-18" id="h3-0-18" class="i">+            Literal(
</a><a href="#h3-0-19" id="h3-0-19" class="i">+                Integer(
</a><a href="#h3-0-20" id="h3-0-20" class="i">+                    9,
</a><a href="#h3-0-21" id="h3-0-21" class="i">+                ),
</a><a href="#h3-0-22" id="h3-0-22" class="i">+            ),
</a><a href="#h3-0-23" id="h3-0-23" class="i">+            Literal(
</a><a href="#h3-0-24" id="h3-0-24" class="i">+                Float(
</a><a href="#h3-0-25" id="h3-0-25" class="i">+                    3.14,
</a><a href="#h3-0-26" id="h3-0-26" class="i">+                ),
</a><a href="#h3-0-27" id="h3-0-27" class="i">+            ),
</a><a href="#h3-0-28" id="h3-0-28" class="i">+        ],
</a><a href="#h3-0-29" id="h3-0-29" class="i">+    ],
</a><a href="#h3-0-30" id="h3-0-30" class="i">+}
</a><a href="#h3-0-31" id="h3-0-31" class="i">+
</a><a href="#h3-0-32" id="h3-0-32" class="i">+Plan: Plan {
</a><a href="#h3-0-33" id="h3-0-33" class="i">+    root: Insert {
</a><a href="#h3-0-34" id="h3-0-34" class="i">+        table: &quot;genres&quot;,
</a><a href="#h3-0-35" id="h3-0-35" class="i">+        expressions: [
</a><a href="#h3-0-36" id="h3-0-36" class="i">+            [
</a><a href="#h3-0-37" id="h3-0-37" class="i">+                Constant(
</a><a href="#h3-0-38" id="h3-0-38" class="i">+                    Integer(
</a><a href="#h3-0-39" id="h3-0-39" class="i">+                        9,
</a><a href="#h3-0-40" id="h3-0-40" class="i">+                    ),
</a><a href="#h3-0-41" id="h3-0-41" class="i">+                ),
</a><a href="#h3-0-42" id="h3-0-42" class="i">+                Constant(
</a><a href="#h3-0-43" id="h3-0-43" class="i">+                    Float(
</a><a href="#h3-0-44" id="h3-0-44" class="i">+                        3.14,
</a><a href="#h3-0-45" id="h3-0-45" class="i">+                    ),
</a><a href="#h3-0-46" id="h3-0-46" class="i">+                ),
</a><a href="#h3-0-47" id="h3-0-47" class="i">+            ],
</a><a href="#h3-0-48" id="h3-0-48" class="i">+        ],
</a><a href="#h3-0-49" id="h3-0-49" class="i">+    },
</a><a href="#h3-0-50" id="h3-0-50" class="i">+}
</a><a href="#h3-0-51" id="h3-0-51" class="i">+
</a><a href="#h3-0-52" id="h3-0-52" class="i">+Query: INSERT INTO genres VALUES (9, 3.14)
</a><a href="#h3-0-53" id="h3-0-53" class="i">+
</a><a href="#h3-0-54" id="h3-0-54" class="i">+Result: Value(&quot;Invalid datatype FLOAT for VARCHAR column name&quot;)
</a><a href="#h3-0-55" id="h3-0-55" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/src/sql/testdata/insert_error_null_disallowed.html">src/sql/testdata/insert_error_null_disallowed</a> b/<a href="../file/src/sql/testdata/insert_error_null_disallowed.html">src/sql/testdata/insert_error_null_disallowed</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,51 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+Query: INSERT INTO genres VALUES (9, NULL)
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+Tokens:
</a><a href="#h4-0-3" id="h4-0-3" class="i">+  Keyword(Insert)
</a><a href="#h4-0-4" id="h4-0-4" class="i">+  Keyword(Into)
</a><a href="#h4-0-5" id="h4-0-5" class="i">+  Ident(&quot;genres&quot;)
</a><a href="#h4-0-6" id="h4-0-6" class="i">+  Keyword(Values)
</a><a href="#h4-0-7" id="h4-0-7" class="i">+  OpenParen
</a><a href="#h4-0-8" id="h4-0-8" class="i">+  Number(&quot;9&quot;)
</a><a href="#h4-0-9" id="h4-0-9" class="i">+  Comma
</a><a href="#h4-0-10" id="h4-0-10" class="i">+  Keyword(Null)
</a><a href="#h4-0-11" id="h4-0-11" class="i">+  CloseParen
</a><a href="#h4-0-12" id="h4-0-12" class="i">+
</a><a href="#h4-0-13" id="h4-0-13" class="i">+AST: Insert {
</a><a href="#h4-0-14" id="h4-0-14" class="i">+    table: &quot;genres&quot;,
</a><a href="#h4-0-15" id="h4-0-15" class="i">+    columns: None,
</a><a href="#h4-0-16" id="h4-0-16" class="i">+    values: [
</a><a href="#h4-0-17" id="h4-0-17" class="i">+        [
</a><a href="#h4-0-18" id="h4-0-18" class="i">+            Literal(
</a><a href="#h4-0-19" id="h4-0-19" class="i">+                Integer(
</a><a href="#h4-0-20" id="h4-0-20" class="i">+                    9,
</a><a href="#h4-0-21" id="h4-0-21" class="i">+                ),
</a><a href="#h4-0-22" id="h4-0-22" class="i">+            ),
</a><a href="#h4-0-23" id="h4-0-23" class="i">+            Literal(
</a><a href="#h4-0-24" id="h4-0-24" class="i">+                Null,
</a><a href="#h4-0-25" id="h4-0-25" class="i">+            ),
</a><a href="#h4-0-26" id="h4-0-26" class="i">+        ],
</a><a href="#h4-0-27" id="h4-0-27" class="i">+    ],
</a><a href="#h4-0-28" id="h4-0-28" class="i">+}
</a><a href="#h4-0-29" id="h4-0-29" class="i">+
</a><a href="#h4-0-30" id="h4-0-30" class="i">+Plan: Plan {
</a><a href="#h4-0-31" id="h4-0-31" class="i">+    root: Insert {
</a><a href="#h4-0-32" id="h4-0-32" class="i">+        table: &quot;genres&quot;,
</a><a href="#h4-0-33" id="h4-0-33" class="i">+        expressions: [
</a><a href="#h4-0-34" id="h4-0-34" class="i">+            [
</a><a href="#h4-0-35" id="h4-0-35" class="i">+                Constant(
</a><a href="#h4-0-36" id="h4-0-36" class="i">+                    Integer(
</a><a href="#h4-0-37" id="h4-0-37" class="i">+                        9,
</a><a href="#h4-0-38" id="h4-0-38" class="i">+                    ),
</a><a href="#h4-0-39" id="h4-0-39" class="i">+                ),
</a><a href="#h4-0-40" id="h4-0-40" class="i">+                Constant(
</a><a href="#h4-0-41" id="h4-0-41" class="i">+                    Null,
</a><a href="#h4-0-42" id="h4-0-42" class="i">+                ),
</a><a href="#h4-0-43" id="h4-0-43" class="i">+            ],
</a><a href="#h4-0-44" id="h4-0-44" class="i">+        ],
</a><a href="#h4-0-45" id="h4-0-45" class="i">+    },
</a><a href="#h4-0-46" id="h4-0-46" class="i">+}
</a><a href="#h4-0-47" id="h4-0-47" class="i">+
</a><a href="#h4-0-48" id="h4-0-48" class="i">+Query: INSERT INTO genres VALUES (9, NULL)
</a><a href="#h4-0-49" id="h4-0-49" class="i">+
</a><a href="#h4-0-50" id="h4-0-50" class="i">+Result: Value(&quot;NULL value not allowed for column name&quot;)
</a><a href="#h4-0-51" id="h4-0-51" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/src/sql/testdata/insert_error_pk_exists.html">src/sql/testdata/insert_error_pk_exists</a> b/<a href="../file/src/sql/testdata/insert_error_pk_exists.html">src/sql/testdata/insert_error_pk_exists</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,55 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+Query: INSERT INTO genres VALUES (1, &#39;Western&#39;)
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+Tokens:
</a><a href="#h5-0-3" id="h5-0-3" class="i">+  Keyword(Insert)
</a><a href="#h5-0-4" id="h5-0-4" class="i">+  Keyword(Into)
</a><a href="#h5-0-5" id="h5-0-5" class="i">+  Ident(&quot;genres&quot;)
</a><a href="#h5-0-6" id="h5-0-6" class="i">+  Keyword(Values)
</a><a href="#h5-0-7" id="h5-0-7" class="i">+  OpenParen
</a><a href="#h5-0-8" id="h5-0-8" class="i">+  Number(&quot;1&quot;)
</a><a href="#h5-0-9" id="h5-0-9" class="i">+  Comma
</a><a href="#h5-0-10" id="h5-0-10" class="i">+  String(&quot;Western&quot;)
</a><a href="#h5-0-11" id="h5-0-11" class="i">+  CloseParen
</a><a href="#h5-0-12" id="h5-0-12" class="i">+
</a><a href="#h5-0-13" id="h5-0-13" class="i">+AST: Insert {
</a><a href="#h5-0-14" id="h5-0-14" class="i">+    table: &quot;genres&quot;,
</a><a href="#h5-0-15" id="h5-0-15" class="i">+    columns: None,
</a><a href="#h5-0-16" id="h5-0-16" class="i">+    values: [
</a><a href="#h5-0-17" id="h5-0-17" class="i">+        [
</a><a href="#h5-0-18" id="h5-0-18" class="i">+            Literal(
</a><a href="#h5-0-19" id="h5-0-19" class="i">+                Integer(
</a><a href="#h5-0-20" id="h5-0-20" class="i">+                    1,
</a><a href="#h5-0-21" id="h5-0-21" class="i">+                ),
</a><a href="#h5-0-22" id="h5-0-22" class="i">+            ),
</a><a href="#h5-0-23" id="h5-0-23" class="i">+            Literal(
</a><a href="#h5-0-24" id="h5-0-24" class="i">+                String(
</a><a href="#h5-0-25" id="h5-0-25" class="i">+                    &quot;Western&quot;,
</a><a href="#h5-0-26" id="h5-0-26" class="i">+                ),
</a><a href="#h5-0-27" id="h5-0-27" class="i">+            ),
</a><a href="#h5-0-28" id="h5-0-28" class="i">+        ],
</a><a href="#h5-0-29" id="h5-0-29" class="i">+    ],
</a><a href="#h5-0-30" id="h5-0-30" class="i">+}
</a><a href="#h5-0-31" id="h5-0-31" class="i">+
</a><a href="#h5-0-32" id="h5-0-32" class="i">+Plan: Plan {
</a><a href="#h5-0-33" id="h5-0-33" class="i">+    root: Insert {
</a><a href="#h5-0-34" id="h5-0-34" class="i">+        table: &quot;genres&quot;,
</a><a href="#h5-0-35" id="h5-0-35" class="i">+        expressions: [
</a><a href="#h5-0-36" id="h5-0-36" class="i">+            [
</a><a href="#h5-0-37" id="h5-0-37" class="i">+                Constant(
</a><a href="#h5-0-38" id="h5-0-38" class="i">+                    Integer(
</a><a href="#h5-0-39" id="h5-0-39" class="i">+                        1,
</a><a href="#h5-0-40" id="h5-0-40" class="i">+                    ),
</a><a href="#h5-0-41" id="h5-0-41" class="i">+                ),
</a><a href="#h5-0-42" id="h5-0-42" class="i">+                Constant(
</a><a href="#h5-0-43" id="h5-0-43" class="i">+                    String(
</a><a href="#h5-0-44" id="h5-0-44" class="i">+                        &quot;Western&quot;,
</a><a href="#h5-0-45" id="h5-0-45" class="i">+                    ),
</a><a href="#h5-0-46" id="h5-0-46" class="i">+                ),
</a><a href="#h5-0-47" id="h5-0-47" class="i">+            ],
</a><a href="#h5-0-48" id="h5-0-48" class="i">+        ],
</a><a href="#h5-0-49" id="h5-0-49" class="i">+    },
</a><a href="#h5-0-50" id="h5-0-50" class="i">+}
</a><a href="#h5-0-51" id="h5-0-51" class="i">+
</a><a href="#h5-0-52" id="h5-0-52" class="i">+Query: INSERT INTO genres VALUES (1, &#39;Western&#39;)
</a><a href="#h5-0-53" id="h5-0-53" class="i">+
</a><a href="#h5-0-54" id="h5-0-54" class="i">+Result: Value(&quot;Primary key 1 already exists for table genres&quot;)
</a><a href="#h5-0-55" id="h5-0-55" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/src/sql/testdata/insert_error_pk_null.html">src/sql/testdata/insert_error_pk_null</a> b/<a href="../file/src/sql/testdata/insert_error_pk_null.html">src/sql/testdata/insert_error_pk_null</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,51 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+Query: INSERT INTO genres VALUES (NULL, &#39;Western&#39;)
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+Tokens:
</a><a href="#h6-0-3" id="h6-0-3" class="i">+  Keyword(Insert)
</a><a href="#h6-0-4" id="h6-0-4" class="i">+  Keyword(Into)
</a><a href="#h6-0-5" id="h6-0-5" class="i">+  Ident(&quot;genres&quot;)
</a><a href="#h6-0-6" id="h6-0-6" class="i">+  Keyword(Values)
</a><a href="#h6-0-7" id="h6-0-7" class="i">+  OpenParen
</a><a href="#h6-0-8" id="h6-0-8" class="i">+  Keyword(Null)
</a><a href="#h6-0-9" id="h6-0-9" class="i">+  Comma
</a><a href="#h6-0-10" id="h6-0-10" class="i">+  String(&quot;Western&quot;)
</a><a href="#h6-0-11" id="h6-0-11" class="i">+  CloseParen
</a><a href="#h6-0-12" id="h6-0-12" class="i">+
</a><a href="#h6-0-13" id="h6-0-13" class="i">+AST: Insert {
</a><a href="#h6-0-14" id="h6-0-14" class="i">+    table: &quot;genres&quot;,
</a><a href="#h6-0-15" id="h6-0-15" class="i">+    columns: None,
</a><a href="#h6-0-16" id="h6-0-16" class="i">+    values: [
</a><a href="#h6-0-17" id="h6-0-17" class="i">+        [
</a><a href="#h6-0-18" id="h6-0-18" class="i">+            Literal(
</a><a href="#h6-0-19" id="h6-0-19" class="i">+                Null,
</a><a href="#h6-0-20" id="h6-0-20" class="i">+            ),
</a><a href="#h6-0-21" id="h6-0-21" class="i">+            Literal(
</a><a href="#h6-0-22" id="h6-0-22" class="i">+                String(
</a><a href="#h6-0-23" id="h6-0-23" class="i">+                    &quot;Western&quot;,
</a><a href="#h6-0-24" id="h6-0-24" class="i">+                ),
</a><a href="#h6-0-25" id="h6-0-25" class="i">+            ),
</a><a href="#h6-0-26" id="h6-0-26" class="i">+        ],
</a><a href="#h6-0-27" id="h6-0-27" class="i">+    ],
</a><a href="#h6-0-28" id="h6-0-28" class="i">+}
</a><a href="#h6-0-29" id="h6-0-29" class="i">+
</a><a href="#h6-0-30" id="h6-0-30" class="i">+Plan: Plan {
</a><a href="#h6-0-31" id="h6-0-31" class="i">+    root: Insert {
</a><a href="#h6-0-32" id="h6-0-32" class="i">+        table: &quot;genres&quot;,
</a><a href="#h6-0-33" id="h6-0-33" class="i">+        expressions: [
</a><a href="#h6-0-34" id="h6-0-34" class="i">+            [
</a><a href="#h6-0-35" id="h6-0-35" class="i">+                Constant(
</a><a href="#h6-0-36" id="h6-0-36" class="i">+                    Null,
</a><a href="#h6-0-37" id="h6-0-37" class="i">+                ),
</a><a href="#h6-0-38" id="h6-0-38" class="i">+                Constant(
</a><a href="#h6-0-39" id="h6-0-39" class="i">+                    String(
</a><a href="#h6-0-40" id="h6-0-40" class="i">+                        &quot;Western&quot;,
</a><a href="#h6-0-41" id="h6-0-41" class="i">+                    ),
</a><a href="#h6-0-42" id="h6-0-42" class="i">+                ),
</a><a href="#h6-0-43" id="h6-0-43" class="i">+            ],
</a><a href="#h6-0-44" id="h6-0-44" class="i">+        ],
</a><a href="#h6-0-45" id="h6-0-45" class="i">+    },
</a><a href="#h6-0-46" id="h6-0-46" class="i">+}
</a><a href="#h6-0-47" id="h6-0-47" class="i">+
</a><a href="#h6-0-48" id="h6-0-48" class="i">+Query: INSERT INTO genres VALUES (NULL, &#39;Western&#39;)
</a><a href="#h6-0-49" id="h6-0-49" class="i">+
</a><a href="#h6-0-50" id="h6-0-50" class="i">+Result: Value(&quot;NULL value not allowed for column id&quot;)
</a><a href="#h6-0-51" id="h6-0-51" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/src/sql/testdata/insert_values.html">src/sql/testdata/insert_values</a> b/<a href="../file/src/sql/testdata/insert_values.html">src/sql/testdata/insert_values</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,76 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+Query: INSERT INTO genres VALUES (9, &#39;Western&#39;)
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+Tokens:
</a><a href="#h7-0-3" id="h7-0-3" class="i">+  Keyword(Insert)
</a><a href="#h7-0-4" id="h7-0-4" class="i">+  Keyword(Into)
</a><a href="#h7-0-5" id="h7-0-5" class="i">+  Ident(&quot;genres&quot;)
</a><a href="#h7-0-6" id="h7-0-6" class="i">+  Keyword(Values)
</a><a href="#h7-0-7" id="h7-0-7" class="i">+  OpenParen
</a><a href="#h7-0-8" id="h7-0-8" class="i">+  Number(&quot;9&quot;)
</a><a href="#h7-0-9" id="h7-0-9" class="i">+  Comma
</a><a href="#h7-0-10" id="h7-0-10" class="i">+  String(&quot;Western&quot;)
</a><a href="#h7-0-11" id="h7-0-11" class="i">+  CloseParen
</a><a href="#h7-0-12" id="h7-0-12" class="i">+
</a><a href="#h7-0-13" id="h7-0-13" class="i">+AST: Insert {
</a><a href="#h7-0-14" id="h7-0-14" class="i">+    table: &quot;genres&quot;,
</a><a href="#h7-0-15" id="h7-0-15" class="i">+    columns: None,
</a><a href="#h7-0-16" id="h7-0-16" class="i">+    values: [
</a><a href="#h7-0-17" id="h7-0-17" class="i">+        [
</a><a href="#h7-0-18" id="h7-0-18" class="i">+            Literal(
</a><a href="#h7-0-19" id="h7-0-19" class="i">+                Integer(
</a><a href="#h7-0-20" id="h7-0-20" class="i">+                    9,
</a><a href="#h7-0-21" id="h7-0-21" class="i">+                ),
</a><a href="#h7-0-22" id="h7-0-22" class="i">+            ),
</a><a href="#h7-0-23" id="h7-0-23" class="i">+            Literal(
</a><a href="#h7-0-24" id="h7-0-24" class="i">+                String(
</a><a href="#h7-0-25" id="h7-0-25" class="i">+                    &quot;Western&quot;,
</a><a href="#h7-0-26" id="h7-0-26" class="i">+                ),
</a><a href="#h7-0-27" id="h7-0-27" class="i">+            ),
</a><a href="#h7-0-28" id="h7-0-28" class="i">+        ],
</a><a href="#h7-0-29" id="h7-0-29" class="i">+    ],
</a><a href="#h7-0-30" id="h7-0-30" class="i">+}
</a><a href="#h7-0-31" id="h7-0-31" class="i">+
</a><a href="#h7-0-32" id="h7-0-32" class="i">+Plan: Plan {
</a><a href="#h7-0-33" id="h7-0-33" class="i">+    root: Insert {
</a><a href="#h7-0-34" id="h7-0-34" class="i">+        table: &quot;genres&quot;,
</a><a href="#h7-0-35" id="h7-0-35" class="i">+        expressions: [
</a><a href="#h7-0-36" id="h7-0-36" class="i">+            [
</a><a href="#h7-0-37" id="h7-0-37" class="i">+                Constant(
</a><a href="#h7-0-38" id="h7-0-38" class="i">+                    Integer(
</a><a href="#h7-0-39" id="h7-0-39" class="i">+                        9,
</a><a href="#h7-0-40" id="h7-0-40" class="i">+                    ),
</a><a href="#h7-0-41" id="h7-0-41" class="i">+                ),
</a><a href="#h7-0-42" id="h7-0-42" class="i">+                Constant(
</a><a href="#h7-0-43" id="h7-0-43" class="i">+                    String(
</a><a href="#h7-0-44" id="h7-0-44" class="i">+                        &quot;Western&quot;,
</a><a href="#h7-0-45" id="h7-0-45" class="i">+                    ),
</a><a href="#h7-0-46" id="h7-0-46" class="i">+                ),
</a><a href="#h7-0-47" id="h7-0-47" class="i">+            ],
</a><a href="#h7-0-48" id="h7-0-48" class="i">+        ],
</a><a href="#h7-0-49" id="h7-0-49" class="i">+    },
</a><a href="#h7-0-50" id="h7-0-50" class="i">+}
</a><a href="#h7-0-51" id="h7-0-51" class="i">+
</a><a href="#h7-0-52" id="h7-0-52" class="i">+Query: INSERT INTO genres VALUES (9, &#39;Western&#39;)
</a><a href="#h7-0-53" id="h7-0-53" class="i">+
</a><a href="#h7-0-54" id="h7-0-54" class="i">+Result:
</a><a href="#h7-0-55" id="h7-0-55" class="i">+
</a><a href="#h7-0-56" id="h7-0-56" class="i">+Storage:
</a><a href="#h7-0-57" id="h7-0-57" class="i">+CREATE TABLE genres (
</a><a href="#h7-0-58" id="h7-0-58" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h7-0-59" id="h7-0-59" class="i">+  name VARCHAR NOT NULL
</a><a href="#h7-0-60" id="h7-0-60" class="i">+)
</a><a href="#h7-0-61" id="h7-0-61" class="i">+[Integer(1), String(&quot;Science Fiction&quot;)]
</a><a href="#h7-0-62" id="h7-0-62" class="i">+[Integer(2), String(&quot;Action&quot;)]
</a><a href="#h7-0-63" id="h7-0-63" class="i">+[Integer(9), String(&quot;Western&quot;)]
</a><a href="#h7-0-64" id="h7-0-64" class="i">+
</a><a href="#h7-0-65" id="h7-0-65" class="i">+CREATE TABLE movies (
</a><a href="#h7-0-66" id="h7-0-66" class="i">+  id INTEGER PRIMARY KEY NOT NULL,
</a><a href="#h7-0-67" id="h7-0-67" class="i">+  title VARCHAR NOT NULL,
</a><a href="#h7-0-68" id="h7-0-68" class="i">+  genre_id INTEGER NOT NULL,
</a><a href="#h7-0-69" id="h7-0-69" class="i">+  released INTEGER NOT NULL,
</a><a href="#h7-0-70" id="h7-0-70" class="i">+  rating FLOAT,
</a><a href="#h7-0-71" id="h7-0-71" class="i">+  bluray BOOLEAN
</a><a href="#h7-0-72" id="h7-0-72" class="i">+)
</a><a href="#h7-0-73" id="h7-0-73" class="i">+[Integer(1), String(&quot;Stalker&quot;), Integer(1), Integer(1979), Float(8.2), Boolean(false)]
</a><a href="#h7-0-74" id="h7-0-74" class="i">+[Integer(2), String(&quot;Sicario&quot;), Integer(2), Integer(2015), Float(7.6), Boolean(true)]
</a><a href="#h7-0-75" id="h7-0-75" class="i">+[Integer(3), String(&quot;Primer&quot;), Integer(1), Integer(2004), Float(6.9), Null]
</a><b>diff --git a/<a id="h8" href="../file/src/sql/tests.rs.html">src/sql/tests.rs</a> b/<a href="../file/src/sql/tests.rs.html">src/sql/tests.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,3 +1,7 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+/**
</a><a href="#h8-0-1" id="h8-0-1" class="i">+ * Tests for the SQL engine. Runs SQL queries against an in-memory database,
</a><a href="#h8-0-2" id="h8-0-2" class="i">+ * and compares the results with golden files stored under src/sql/testdata/
</a><a href="#h8-0-3" id="h8-0-3" class="i">+ */
</a> use super::lexer::{Lexer, Token};
 use super::schema;
 use super::types::{DataType, Row, Value};
<a href="#h8-1" id="h8-1" class="h">@@ -7,7 +11,6 @@ use crate::Error;
</a> use goldenfile::Mint;
 use std::io::Write;
 
<a href="#h8-1-3" id="h8-1-3" class="d">-// test_sql! tests
</a> macro_rules! test_sql {
     ( $( $name:ident: $sql:expr, )* ) =&gt; {
     $(
<a href="#h8-2" id="h8-2" class="h">@@ -192,6 +195,12 @@ test_sql! {
</a>     expr_literal_numbers: &quot;SELECT 0, 1, -2, --3, +-4, 3.14, 293, 3.14e3, 2.718E-2&quot;,
     expr_literal_string_quotes: r#&quot;SELECT &#39;Literal with &#39;&#39;single&#39;&#39; and &quot;double&quot; quotes&#39;&quot;#,
 
<a href="#h8-2-3" id="h8-2-3" class="i">+    insert_error_datatype_conflict: &quot;INSERT INTO genres VALUES (9, 3.14)&quot;,
</a><a href="#h8-2-4" id="h8-2-4" class="i">+    insert_error_null_disallowed: &quot;INSERT INTO genres VALUES (9, NULL)&quot;,
</a><a href="#h8-2-5" id="h8-2-5" class="i">+    insert_error_pk_exists: &quot;INSERT INTO genres VALUES (1, &#39;Western&#39;)&quot;,
</a><a href="#h8-2-6" id="h8-2-6" class="i">+    insert_error_pk_null: &quot;INSERT INTO genres VALUES (NULL, &#39;Western&#39;)&quot;,
</a><a href="#h8-2-7" id="h8-2-7" class="i">+    insert_values: &quot;INSERT INTO genres VALUES (9, &#39;Western&#39;)&quot;,
</a><a href="#h8-2-8" id="h8-2-8" class="i">+
</a>     select_all_from_table: &quot;SELECT * FROM movies&quot;,
     select_aliases: &quot;SELECT 1, 2 b, 3 AS c&quot;,
     select_error_bare: &quot;SELECT&quot;,
<b>diff --git a/<a id="h9" href="../file/src/sql/types.rs.html">src/sql/types.rs</a> b/<a href="../file/src/sql/types.rs.html">src/sql/types.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -7,6 +7,17 @@ pub enum DataType {
</a>     String,
 }
 
<a href="#h9-0-3" id="h9-0-3" class="i">+impl std::fmt::Display for DataType {
</a><a href="#h9-0-4" id="h9-0-4" class="i">+    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter) -&gt; std::fmt::Result {
</a><a href="#h9-0-5" id="h9-0-5" class="i">+        f.write_str(match self {
</a><a href="#h9-0-6" id="h9-0-6" class="i">+            Self::Boolean =&gt; &quot;BOOLEAN&quot;,
</a><a href="#h9-0-7" id="h9-0-7" class="i">+            Self::Integer =&gt; &quot;INTEGER&quot;,
</a><a href="#h9-0-8" id="h9-0-8" class="i">+            Self::Float =&gt; &quot;FLOAT&quot;,
</a><a href="#h9-0-9" id="h9-0-9" class="i">+            Self::String =&gt; &quot;VARCHAR&quot;,
</a><a href="#h9-0-10" id="h9-0-10" class="i">+        })
</a><a href="#h9-0-11" id="h9-0-11" class="i">+    }
</a><a href="#h9-0-12" id="h9-0-12" class="i">+}
</a><a href="#h9-0-13" id="h9-0-13" class="i">+
</a> /// A value
 #[derive(Clone, Debug, PartialEq, PartialOrd, Serialize, Deserialize)]
 pub enum Value {
<a href="#h9-1" id="h9-1" class="h">@@ -26,18 +37,31 @@ impl std::fmt::Display for Value {
</a>     fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter) -&gt; std::fmt::Result {
         f.write_str(
             match self {
<a href="#h9-1-3" id="h9-1-3" class="d">-                Value::Null =&gt; &quot;NULL&quot;.to_string(),
</a><a href="#h9-1-4" id="h9-1-4" class="d">-                Value::Boolean(b) if *b =&gt; &quot;TRUE&quot;.to_string(),
</a><a href="#h9-1-5" id="h9-1-5" class="d">-                Value::Boolean(_) =&gt; &quot;FALSE&quot;.to_string(),
</a><a href="#h9-1-6" id="h9-1-6" class="d">-                Value::Integer(i) =&gt; i.to_string(),
</a><a href="#h9-1-7" id="h9-1-7" class="d">-                Value::Float(f) =&gt; f.to_string(),
</a><a href="#h9-1-8" id="h9-1-8" class="d">-                Value::String(s) =&gt; s.clone(),
</a><a href="#h9-1-9" id="h9-1-9" class="i">+                Self::Null =&gt; &quot;NULL&quot;.to_string(),
</a><a href="#h9-1-10" id="h9-1-10" class="i">+                Self::Boolean(b) if *b =&gt; &quot;TRUE&quot;.to_string(),
</a><a href="#h9-1-11" id="h9-1-11" class="i">+                Self::Boolean(_) =&gt; &quot;FALSE&quot;.to_string(),
</a><a href="#h9-1-12" id="h9-1-12" class="i">+                Self::Integer(i) =&gt; i.to_string(),
</a><a href="#h9-1-13" id="h9-1-13" class="i">+                Self::Float(f) =&gt; f.to_string(),
</a><a href="#h9-1-14" id="h9-1-14" class="i">+                Self::String(s) =&gt; s.clone(),
</a>             }
             .as_ref(),
         )
     }
 }
 
<a href="#h9-1-21" id="h9-1-21" class="i">+impl Value {
</a><a href="#h9-1-22" id="h9-1-22" class="i">+    /// Returns the value&#39;s datatype, or None for null values
</a><a href="#h9-1-23" id="h9-1-23" class="i">+    pub fn datatype(&amp;self) -&gt; Option&lt;DataType&gt; {
</a><a href="#h9-1-24" id="h9-1-24" class="i">+        match self {
</a><a href="#h9-1-25" id="h9-1-25" class="i">+            Self::Null =&gt; None,
</a><a href="#h9-1-26" id="h9-1-26" class="i">+            Self::Boolean(_) =&gt; Some(DataType::Boolean),
</a><a href="#h9-1-27" id="h9-1-27" class="i">+            Self::Integer(_) =&gt; Some(DataType::Integer),
</a><a href="#h9-1-28" id="h9-1-28" class="i">+            Self::Float(_) =&gt; Some(DataType::Float),
</a><a href="#h9-1-29" id="h9-1-29" class="i">+            Self::String(_) =&gt; Some(DataType::String),
</a><a href="#h9-1-30" id="h9-1-30" class="i">+        }
</a><a href="#h9-1-31" id="h9-1-31" class="i">+    }
</a><a href="#h9-1-32" id="h9-1-32" class="i">+}
</a><a href="#h9-1-33" id="h9-1-33" class="i">+
</a> impl From&lt;bool&gt; for Value {
     fn from(v: bool) -&gt; Self {
         Value::Boolean(v)
<a href="#h9-2" id="h9-2" class="h">@@ -69,4 +93,4 @@ impl From&lt;&amp;str&gt; for Value {
</a> }
 
 /// A row of values
<a href="#h9-2-3" id="h9-2-3" class="d">-pub type Row = Vec&lt;Value&gt;;
</a><a href="#h9-2-4" id="h9-2-4" class="i">+pub type Row = Vec&lt;Value&gt;;
</a><a href="#h9-2-5" id="h9-2-5" class="i">+\ No newline at end of file
</a></pre>
</div>
</body>
</html>
