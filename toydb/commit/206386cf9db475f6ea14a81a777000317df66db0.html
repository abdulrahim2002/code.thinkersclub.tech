<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upgrade clap - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/206386cf9db475f6ea14a81a777000317df66db0.html">206386cf9db475f6ea14a81a777000317df66db0</a>
<b>parent</b> <a href="../commit/10a8e74d84ca2c100a79b7a31a1c1c95aa03ee8a.html">10a8e74d84ca2c100a79b7a31a1c1c95aa03ee8a</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sun, 13 Aug 2023 21:15:46 +0200

Upgrade clap

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Cargo.lock</a></td><td> | </td><td class="num">135</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Cargo.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/bin/bank.rs</a></td><td> | </td><td class="num">80</td><td><span class="i">+++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/bin/toydb.rs</a></td><td> | </td><td class="num">10</td><td><span class="i">++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/bin/toysql.rs</a></td><td> | </td><td class="num">34</td><td><span class="i">+++++++++++++</span><span class="d">---------------------</span></td></tr>
</table></pre><pre>5 files changed, 143 insertions(+), 118 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Cargo.lock.html">Cargo.lock</a> b/<a href="../file/Cargo.lock.html">Cargo.lock</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -23,12 +23,52 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-0-3" id="h0-0-3" class="d">-name = &quot;ansi_term&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="d">-version = &quot;0.11.0&quot;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+name = &quot;anstream&quot;
</a><a href="#h0-0-6" id="h0-0-6" class="i">+version = &quot;0.3.2&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-0-8" id="h0-0-8" class="d">-checksum = &quot;ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b&quot;
</a><a href="#h0-0-9" id="h0-0-9" class="i">+checksum = &quot;0ca84f3628370c59db74ee214b3263d58f9aadd9b4fe7e711fd87dc452b7f163&quot;
</a> dependencies = [
<a href="#h0-0-11" id="h0-0-11" class="d">- &quot;winapi&quot;,
</a><a href="#h0-0-12" id="h0-0-12" class="i">+ &quot;anstyle&quot;,
</a><a href="#h0-0-13" id="h0-0-13" class="i">+ &quot;anstyle-parse&quot;,
</a><a href="#h0-0-14" id="h0-0-14" class="i">+ &quot;anstyle-query&quot;,
</a><a href="#h0-0-15" id="h0-0-15" class="i">+ &quot;anstyle-wincon&quot;,
</a><a href="#h0-0-16" id="h0-0-16" class="i">+ &quot;colorchoice&quot;,
</a><a href="#h0-0-17" id="h0-0-17" class="i">+ &quot;is-terminal&quot;,
</a><a href="#h0-0-18" id="h0-0-18" class="i">+ &quot;utf8parse&quot;,
</a><a href="#h0-0-19" id="h0-0-19" class="i">+]
</a><a href="#h0-0-20" id="h0-0-20" class="i">+
</a><a href="#h0-0-21" id="h0-0-21" class="i">+[[package]]
</a><a href="#h0-0-22" id="h0-0-22" class="i">+name = &quot;anstyle&quot;
</a><a href="#h0-0-23" id="h0-0-23" class="i">+version = &quot;1.0.1&quot;
</a><a href="#h0-0-24" id="h0-0-24" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-25" id="h0-0-25" class="i">+checksum = &quot;3a30da5c5f2d5e72842e00bcb57657162cdabef0931f40e2deb9b4140440cecd&quot;
</a><a href="#h0-0-26" id="h0-0-26" class="i">+
</a><a href="#h0-0-27" id="h0-0-27" class="i">+[[package]]
</a><a href="#h0-0-28" id="h0-0-28" class="i">+name = &quot;anstyle-parse&quot;
</a><a href="#h0-0-29" id="h0-0-29" class="i">+version = &quot;0.2.1&quot;
</a><a href="#h0-0-30" id="h0-0-30" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-31" id="h0-0-31" class="i">+checksum = &quot;938874ff5980b03a87c5524b3ae5b59cf99b1d6bc836848df7bc5ada9643c333&quot;
</a><a href="#h0-0-32" id="h0-0-32" class="i">+dependencies = [
</a><a href="#h0-0-33" id="h0-0-33" class="i">+ &quot;utf8parse&quot;,
</a><a href="#h0-0-34" id="h0-0-34" class="i">+]
</a><a href="#h0-0-35" id="h0-0-35" class="i">+
</a><a href="#h0-0-36" id="h0-0-36" class="i">+[[package]]
</a><a href="#h0-0-37" id="h0-0-37" class="i">+name = &quot;anstyle-query&quot;
</a><a href="#h0-0-38" id="h0-0-38" class="i">+version = &quot;1.0.0&quot;
</a><a href="#h0-0-39" id="h0-0-39" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-40" id="h0-0-40" class="i">+checksum = &quot;5ca11d4be1bab0c8bc8734a9aa7bf4ee8316d462a08c6ac5052f888fef5b494b&quot;
</a><a href="#h0-0-41" id="h0-0-41" class="i">+dependencies = [
</a><a href="#h0-0-42" id="h0-0-42" class="i">+ &quot;windows-sys 0.48.0&quot;,
</a><a href="#h0-0-43" id="h0-0-43" class="i">+]
</a><a href="#h0-0-44" id="h0-0-44" class="i">+
</a><a href="#h0-0-45" id="h0-0-45" class="i">+[[package]]
</a><a href="#h0-0-46" id="h0-0-46" class="i">+name = &quot;anstyle-wincon&quot;
</a><a href="#h0-0-47" id="h0-0-47" class="i">+version = &quot;1.0.2&quot;
</a><a href="#h0-0-48" id="h0-0-48" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-49" id="h0-0-49" class="i">+checksum = &quot;c677ab05e09154296dd37acecd46420c17b9713e8366facafa8fc0885167cf4c&quot;
</a><a href="#h0-0-50" id="h0-0-50" class="i">+dependencies = [
</a><a href="#h0-0-51" id="h0-0-51" class="i">+ &quot;anstyle&quot;,
</a><a href="#h0-0-52" id="h0-0-52" class="i">+ &quot;windows-sys 0.48.0&quot;,
</a> ]
 
 [[package]]
<a href="#h0-1" id="h0-1" class="h">@@ -129,34 +169,41 @@ checksum = &quot;baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd&quot;
</a> 
 [[package]]
 name = &quot;clap&quot;
<a href="#h0-1-3" id="h0-1-3" class="d">-version = &quot;2.33.4&quot;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+version = &quot;3.2.25&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-1-6" id="h0-1-6" class="d">-checksum = &quot;826bf7bc84f9435630275cb8e802a4a0ec792b615969934bd16d42ffed10f207&quot;
</a><a href="#h0-1-7" id="h0-1-7" class="i">+checksum = &quot;4ea181bf566f71cb9a5d17a59e1871af638180a18fb0035c92ae62b705207123&quot;
</a> dependencies = [
<a href="#h0-1-9" id="h0-1-9" class="d">- &quot;ansi_term&quot;,
</a>  &quot;atty&quot;,
  &quot;bitflags 1.2.1&quot;,
<a href="#h0-1-12" id="h0-1-12" class="d">- &quot;strsim 0.8.0&quot;,
</a><a href="#h0-1-13" id="h0-1-13" class="d">- &quot;textwrap 0.11.0&quot;,
</a><a href="#h0-1-14" id="h0-1-14" class="d">- &quot;unicode-width&quot;,
</a><a href="#h0-1-15" id="h0-1-15" class="d">- &quot;vec_map&quot;,
</a><a href="#h0-1-16" id="h0-1-16" class="i">+ &quot;clap_derive&quot;,
</a><a href="#h0-1-17" id="h0-1-17" class="i">+ &quot;clap_lex 0.2.4&quot;,
</a><a href="#h0-1-18" id="h0-1-18" class="i">+ &quot;indexmap&quot;,
</a><a href="#h0-1-19" id="h0-1-19" class="i">+ &quot;once_cell&quot;,
</a><a href="#h0-1-20" id="h0-1-20" class="i">+ &quot;strsim&quot;,
</a><a href="#h0-1-21" id="h0-1-21" class="i">+ &quot;termcolor&quot;,
</a><a href="#h0-1-22" id="h0-1-22" class="i">+ &quot;textwrap&quot;,
</a> ]
 
 [[package]]
 name = &quot;clap&quot;
<a href="#h0-1-27" id="h0-1-27" class="d">-version = &quot;3.2.25&quot;
</a><a href="#h0-1-28" id="h0-1-28" class="i">+version = &quot;4.3.21&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-1-30" id="h0-1-30" class="d">-checksum = &quot;4ea181bf566f71cb9a5d17a59e1871af638180a18fb0035c92ae62b705207123&quot;
</a><a href="#h0-1-31" id="h0-1-31" class="i">+checksum = &quot;c27cdf28c0f604ba3f512b0c9a409f8de8513e4816705deb0498b627e7c3a3fd&quot;
</a> dependencies = [
<a href="#h0-1-33" id="h0-1-33" class="d">- &quot;atty&quot;,
</a><a href="#h0-1-34" id="h0-1-34" class="d">- &quot;bitflags 1.2.1&quot;,
</a><a href="#h0-1-35" id="h0-1-35" class="d">- &quot;clap_derive&quot;,
</a><a href="#h0-1-36" id="h0-1-36" class="d">- &quot;clap_lex&quot;,
</a><a href="#h0-1-37" id="h0-1-37" class="d">- &quot;indexmap&quot;,
</a><a href="#h0-1-38" id="h0-1-38" class="i">+ &quot;clap_builder&quot;,
</a><a href="#h0-1-39" id="h0-1-39" class="i">+]
</a><a href="#h0-1-40" id="h0-1-40" class="i">+
</a><a href="#h0-1-41" id="h0-1-41" class="i">+[[package]]
</a><a href="#h0-1-42" id="h0-1-42" class="i">+name = &quot;clap_builder&quot;
</a><a href="#h0-1-43" id="h0-1-43" class="i">+version = &quot;4.3.21&quot;
</a><a href="#h0-1-44" id="h0-1-44" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-1-45" id="h0-1-45" class="i">+checksum = &quot;08a9f1ab5e9f01a9b81f202e8562eb9a10de70abf9eaeac1be465c28b75aa4aa&quot;
</a><a href="#h0-1-46" id="h0-1-46" class="i">+dependencies = [
</a><a href="#h0-1-47" id="h0-1-47" class="i">+ &quot;anstream&quot;,
</a><a href="#h0-1-48" id="h0-1-48" class="i">+ &quot;anstyle&quot;,
</a><a href="#h0-1-49" id="h0-1-49" class="i">+ &quot;clap_lex 0.5.0&quot;,
</a>  &quot;once_cell&quot;,
<a href="#h0-1-51" id="h0-1-51" class="d">- &quot;strsim 0.10.0&quot;,
</a><a href="#h0-1-52" id="h0-1-52" class="d">- &quot;termcolor&quot;,
</a><a href="#h0-1-53" id="h0-1-53" class="d">- &quot;textwrap 0.16.0&quot;,
</a><a href="#h0-1-54" id="h0-1-54" class="i">+ &quot;strsim&quot;,
</a> ]
 
 [[package]]
<a href="#h0-2" id="h0-2" class="h">@@ -182,6 +229,12 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-2-3" id="h0-2-3" class="i">+name = &quot;clap_lex&quot;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+version = &quot;0.5.0&quot;
</a><a href="#h0-2-5" id="h0-2-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-2-6" id="h0-2-6" class="i">+checksum = &quot;2da6da31387c7e4ef160ffab6d5e7f00c42626fe39aea70a7b0f1773f7dd6c1b&quot;
</a><a href="#h0-2-7" id="h0-2-7" class="i">+
</a><a href="#h0-2-8" id="h0-2-8" class="i">+[[package]]
</a> name = &quot;clipboard-win&quot;
 version = &quot;4.5.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-3" id="h0-3" class="h">@@ -193,6 +246,12 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-3-3" id="h0-3-3" class="i">+name = &quot;colorchoice&quot;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+version = &quot;1.0.0&quot;
</a><a href="#h0-3-5" id="h0-3-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-3-6" id="h0-3-6" class="i">+checksum = &quot;acbf1af155f9b9ef647e42cdc158db4b64a1b61f743629225fde6f3e0be2a7c7&quot;
</a><a href="#h0-3-7" id="h0-3-7" class="i">+
</a><a href="#h0-3-8" id="h0-3-8" class="i">+[[package]]
</a> name = &quot;config&quot;
 version = &quot;0.13.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-4" id="h0-4" class="h">@@ -572,6 +631,17 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-4-3" id="h0-4-3" class="i">+name = &quot;is-terminal&quot;
</a><a href="#h0-4-4" id="h0-4-4" class="i">+version = &quot;0.4.9&quot;
</a><a href="#h0-4-5" id="h0-4-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-4-6" id="h0-4-6" class="i">+checksum = &quot;cb0889898416213fab133e1d33a0e5858a48177452750691bde3666d0fdbaf8b&quot;
</a><a href="#h0-4-7" id="h0-4-7" class="i">+dependencies = [
</a><a href="#h0-4-8" id="h0-4-8" class="i">+ &quot;hermit-abi 0.3.2&quot;,
</a><a href="#h0-4-9" id="h0-4-9" class="i">+ &quot;rustix&quot;,
</a><a href="#h0-4-10" id="h0-4-10" class="i">+ &quot;windows-sys 0.48.0&quot;,
</a><a href="#h0-4-11" id="h0-4-11" class="i">+]
</a><a href="#h0-4-12" id="h0-4-12" class="i">+
</a><a href="#h0-4-13" id="h0-4-13" class="i">+[[package]]
</a> name = &quot;itoa&quot;
 version = &quot;1.0.9&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-5" id="h0-5" class="h">@@ -1307,12 +1377,6 @@ checksum = &quot;9e08d8363704e6c71fc928674353e6b7c23dcea9d82d7012c8faf2a3a025f8d0&quot;
</a> 
 [[package]]
 name = &quot;strsim&quot;
<a href="#h0-5-3" id="h0-5-3" class="d">-version = &quot;0.8.0&quot;
</a><a href="#h0-5-4" id="h0-5-4" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-5-5" id="h0-5-5" class="d">-checksum = &quot;8ea5119cdb4c55b55d432abb513a0429384878c15dde60cc77b1c99de1a95a6a&quot;
</a><a href="#h0-5-6" id="h0-5-6" class="d">-
</a><a href="#h0-5-7" id="h0-5-7" class="d">-[[package]]
</a><a href="#h0-5-8" id="h0-5-8" class="d">-name = &quot;strsim&quot;
</a> version = &quot;0.10.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;73473c0e59e6d5812c5dfe2a064a6444949f089e20eec9a2e5506596494e4623&quot;
<a href="#h0-6" id="h0-6" class="h">@@ -1373,15 +1437,6 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;textwrap&quot;
<a href="#h0-6-3" id="h0-6-3" class="d">-version = &quot;0.11.0&quot;
</a><a href="#h0-6-4" id="h0-6-4" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-6-5" id="h0-6-5" class="d">-checksum = &quot;d326610f408c7a4eb6f51c37c330e496b08506c9457c9d34287ecc38809fb060&quot;
</a><a href="#h0-6-6" id="h0-6-6" class="d">-dependencies = [
</a><a href="#h0-6-7" id="h0-6-7" class="d">- &quot;unicode-width&quot;,
</a><a href="#h0-6-8" id="h0-6-8" class="d">-]
</a><a href="#h0-6-9" id="h0-6-9" class="d">-
</a><a href="#h0-6-10" id="h0-6-10" class="d">-[[package]]
</a><a href="#h0-6-11" id="h0-6-11" class="d">-name = &quot;textwrap&quot;
</a> version = &quot;0.16.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;222a222a5bfe1bba4a77b45ec488a741b3cb8872e5e499451fd7d0129c9c7c3d&quot;
<a href="#h0-7" id="h0-7" class="h">@@ -1517,7 +1572,7 @@ name = &quot;toydb&quot;
</a> version = &quot;0.1.0&quot;
 dependencies = [
  &quot;bincode&quot;,
<a href="#h0-7-3" id="h0-7-3" class="d">- &quot;clap 2.33.4&quot;,
</a><a href="#h0-7-4" id="h0-7-4" class="i">+ &quot;clap 4.3.21&quot;,
</a>  &quot;config&quot;,
  &quot;derivative&quot;,
  &quot;futures&quot;,
<a href="#h0-8" id="h0-8" class="h">@@ -1590,12 +1645,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-8-3" id="h0-8-3" class="d">-name = &quot;vec_map&quot;
</a><a href="#h0-8-4" id="h0-8-4" class="d">-version = &quot;0.8.2&quot;
</a><a href="#h0-8-5" id="h0-8-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-8-6" id="h0-8-6" class="d">-checksum = &quot;f1bddf1187be692e79c5ffeab891132dfb0f236ed36a43c7ed39f1165ee20191&quot;
</a><a href="#h0-8-7" id="h0-8-7" class="d">-
</a><a href="#h0-8-8" id="h0-8-8" class="d">-[[package]]
</a> name = &quot;version_check&quot;
 version = &quot;0.9.4&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<b>diff --git a/<a id="h1" href="../file/Cargo.toml.html">Cargo.toml</a> b/<a href="../file/Cargo.toml.html">Cargo.toml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -8,7 +8,7 @@ default-run = &quot;toydb&quot;
</a> 
 [dependencies]
 bincode = &quot;~1.3.3&quot;
<a href="#h1-0-3" id="h1-0-3" class="d">-clap = &quot;~2.33.3&quot;
</a><a href="#h1-0-4" id="h1-0-4" class="i">+clap = { version = &quot;4.3.21&quot;, features = [&quot;cargo&quot;] }
</a> config = &quot;~0.13.3&quot;
 derivative = &quot;~2.2.0&quot;
 futures = &quot;~0.3.15&quot;
<b>diff --git a/<a id="h2" href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a> b/<a href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,7 +1,7 @@
</a> /*
  * Simulates a bank, by creating a set of accounts and making concurrent transfers between them:
  *
<a href="#h2-0-3" id="h2-0-3" class="d">- * - Connect to the given toyDB hosts (-h default 127.0.0.1:9605, can give multiple)
</a><a href="#h2-0-4" id="h2-0-4" class="i">+ * - Connect to the given toyDB hosts (-H default 127.0.0.1:9605, can give multiple)
</a>  * - Create C customers (-C default 100)
  * - Create a accounts per customer with initial balance 100 (-a default 10)
  * - Spawn c concurrent workers (-c default 8)
<a href="#h2-1" id="h2-1" class="h">@@ -17,7 +17,6 @@
</a> 
 #![warn(clippy::all)]
 
<a href="#h2-1-3" id="h2-1-3" class="d">-use clap::{app_from_crate, crate_authors, crate_description, crate_name, crate_version};
</a> use futures::stream::TryStreamExt as _;
 use rand::distributions::Distribution;
 use rand::Rng as _;
<a href="#h2-2" id="h2-2" class="h">@@ -29,71 +28,57 @@ use toydb::error::{Error, Result};
</a> 
 #[tokio::main]
 async fn main() -&gt; Result&lt;()&gt; {
<a href="#h2-2-3" id="h2-2-3" class="d">-    let opts = app_from_crate!()
</a><a href="#h2-2-4" id="h2-2-4" class="d">-        .arg(
</a><a href="#h2-2-5" id="h2-2-5" class="d">-            clap::Arg::with_name(&quot;host&quot;)
</a><a href="#h2-2-6" id="h2-2-6" class="d">-                .short(&quot;h&quot;)
</a><a href="#h2-2-7" id="h2-2-7" class="i">+    let args = clap::command!()
</a><a href="#h2-2-8" id="h2-2-8" class="i">+        .about(&quot;A bank workload, which makes concurrent transfers between accounts.&quot;)
</a><a href="#h2-2-9" id="h2-2-9" class="i">+        .args([
</a><a href="#h2-2-10" id="h2-2-10" class="i">+            clap::Arg::new(&quot;host&quot;)
</a><a href="#h2-2-11" id="h2-2-11" class="i">+                .short(&#39;H&#39;)
</a>                 .long(&quot;host&quot;)
                 .help(&quot;Host to connect to, optionally with port number&quot;)
<a href="#h2-2-14" id="h2-2-14" class="d">-                .takes_value(true)
</a><a href="#h2-2-15" id="h2-2-15" class="d">-                .number_of_values(1)
</a><a href="#h2-2-16" id="h2-2-16" class="d">-                .multiple(true)
</a><a href="#h2-2-17" id="h2-2-17" class="d">-                .required(true)
</a><a href="#h2-2-18" id="h2-2-18" class="i">+                .num_args(1..)
</a>                 .default_value(&quot;127.0.0.1:9605&quot;),
<a href="#h2-2-20" id="h2-2-20" class="d">-        )
</a><a href="#h2-2-21" id="h2-2-21" class="d">-        .arg(
</a><a href="#h2-2-22" id="h2-2-22" class="d">-            clap::Arg::with_name(&quot;concurrency&quot;)
</a><a href="#h2-2-23" id="h2-2-23" class="d">-                .short(&quot;c&quot;)
</a><a href="#h2-2-24" id="h2-2-24" class="i">+            clap::Arg::new(&quot;concurrency&quot;)
</a><a href="#h2-2-25" id="h2-2-25" class="i">+                .short(&#39;c&#39;)
</a>                 .long(&quot;concurrency&quot;)
                 .help(&quot;Concurrent workers to spawn&quot;)
<a href="#h2-2-28" id="h2-2-28" class="d">-                .takes_value(true)
</a><a href="#h2-2-29" id="h2-2-29" class="d">-                .required(true)
</a><a href="#h2-2-30" id="h2-2-30" class="i">+                .value_parser(clap::value_parser!(u64))
</a>                 .default_value(&quot;8&quot;),
<a href="#h2-2-32" id="h2-2-32" class="d">-        )
</a><a href="#h2-2-33" id="h2-2-33" class="d">-        .arg(
</a><a href="#h2-2-34" id="h2-2-34" class="d">-            clap::Arg::with_name(&quot;customers&quot;)
</a><a href="#h2-2-35" id="h2-2-35" class="d">-                .short(&quot;C&quot;)
</a><a href="#h2-2-36" id="h2-2-36" class="i">+            clap::Arg::new(&quot;customers&quot;)
</a><a href="#h2-2-37" id="h2-2-37" class="i">+                .short(&#39;C&#39;)
</a>                 .long(&quot;customers&quot;)
                 .help(&quot;Number of customers to create&quot;)
<a href="#h2-2-40" id="h2-2-40" class="d">-                .takes_value(true)
</a><a href="#h2-2-41" id="h2-2-41" class="d">-                .required(true)
</a><a href="#h2-2-42" id="h2-2-42" class="i">+                .value_parser(clap::value_parser!(u64))
</a>                 .default_value(&quot;100&quot;),
<a href="#h2-2-44" id="h2-2-44" class="d">-        )
</a><a href="#h2-2-45" id="h2-2-45" class="d">-        .arg(
</a><a href="#h2-2-46" id="h2-2-46" class="d">-            clap::Arg::with_name(&quot;accounts&quot;)
</a><a href="#h2-2-47" id="h2-2-47" class="d">-                .short(&quot;a&quot;)
</a><a href="#h2-2-48" id="h2-2-48" class="i">+            clap::Arg::new(&quot;accounts&quot;)
</a><a href="#h2-2-49" id="h2-2-49" class="i">+                .short(&#39;a&#39;)
</a>                 .long(&quot;accounts&quot;)
                 .help(&quot;Number of accounts to create per customer&quot;)
<a href="#h2-2-52" id="h2-2-52" class="d">-                .takes_value(true)
</a><a href="#h2-2-53" id="h2-2-53" class="d">-                .required(true)
</a><a href="#h2-2-54" id="h2-2-54" class="i">+                .value_parser(clap::value_parser!(u64))
</a>                 .default_value(&quot;10&quot;),
<a href="#h2-2-56" id="h2-2-56" class="d">-        )
</a><a href="#h2-2-57" id="h2-2-57" class="d">-        .arg(
</a><a href="#h2-2-58" id="h2-2-58" class="d">-            clap::Arg::with_name(&quot;transactions&quot;)
</a><a href="#h2-2-59" id="h2-2-59" class="d">-                .short(&quot;t&quot;)
</a><a href="#h2-2-60" id="h2-2-60" class="i">+            clap::Arg::new(&quot;transactions&quot;)
</a><a href="#h2-2-61" id="h2-2-61" class="i">+                .short(&#39;t&#39;)
</a>                 .long(&quot;transactions&quot;)
                 .help(&quot;Number of account transfers to execute&quot;)
<a href="#h2-2-64" id="h2-2-64" class="d">-                .takes_value(true)
</a><a href="#h2-2-65" id="h2-2-65" class="d">-                .required(true)
</a><a href="#h2-2-66" id="h2-2-66" class="i">+                .value_parser(clap::value_parser!(u64))
</a>                 .default_value(&quot;1000&quot;),
<a href="#h2-2-68" id="h2-2-68" class="d">-        )
</a><a href="#h2-2-69" id="h2-2-69" class="i">+        ])
</a>         .get_matches();
 
     Bank::new(
<a href="#h2-2-73" id="h2-2-73" class="d">-        opts.values_of(&quot;host&quot;).unwrap().map(String::from).collect(),
</a><a href="#h2-2-74" id="h2-2-74" class="d">-        opts.value_of(&quot;concurrency&quot;).unwrap().parse()?,
</a><a href="#h2-2-75" id="h2-2-75" class="d">-        opts.value_of(&quot;customers&quot;).unwrap().parse()?,
</a><a href="#h2-2-76" id="h2-2-76" class="d">-        opts.value_of(&quot;accounts&quot;).unwrap().parse()?,
</a><a href="#h2-2-77" id="h2-2-77" class="i">+        args.get_many::&lt;String&gt;(&quot;host&quot;).unwrap().collect(),
</a><a href="#h2-2-78" id="h2-2-78" class="i">+        *args.get_one::&lt;u64&gt;(&quot;concurrency&quot;).unwrap(),
</a><a href="#h2-2-79" id="h2-2-79" class="i">+        *args.get_one(&quot;customers&quot;).unwrap(),
</a><a href="#h2-2-80" id="h2-2-80" class="i">+        *args.get_one(&quot;accounts&quot;).unwrap(),
</a>     )
     .await?
<a href="#h2-2-83" id="h2-2-83" class="d">-    .run(opts.value_of(&quot;transactions&quot;).unwrap().parse()?)
</a><a href="#h2-2-84" id="h2-2-84" class="i">+    .run(*args.get_one(&quot;transactions&quot;).unwrap())
</a>     .await
 }
 
 struct Bank {
     clients: Pool,
<a href="#h2-2-90" id="h2-2-90" class="d">-    customers: i64,
</a><a href="#h2-2-91" id="h2-2-91" class="d">-    customer_accounts: i64,
</a><a href="#h2-2-92" id="h2-2-92" class="i">+    customers: u64,
</a><a href="#h2-2-93" id="h2-2-93" class="i">+    customer_accounts: u64,
</a> }
 
 impl Bank {
<a href="#h2-3" id="h2-3" class="h">@@ -103,8 +88,8 @@ impl Bank {
</a>     async fn new&lt;A: ToSocketAddrs + Clone&gt;(
         addrs: Vec&lt;A&gt;,
         concurrency: u64,
<a href="#h2-3-3" id="h2-3-3" class="d">-        customers: i64,
</a><a href="#h2-3-4" id="h2-3-4" class="d">-        accounts: i64,
</a><a href="#h2-3-5" id="h2-3-5" class="i">+        customers: u64,
</a><a href="#h2-3-6" id="h2-3-6" class="i">+        accounts: u64,
</a>     ) -&gt; Result&lt;Self&gt; {
         Ok(Self {
             clients: Pool::new(addrs, concurrency).await?,
<a href="#h2-4" id="h2-4" class="h">@@ -203,9 +188,10 @@ impl Bank {
</a>     /// Verifies that all invariants hold (same total balance, no negative balances).
     async fn verify(&amp;self) -&gt; Result&lt;()&gt; {
         let client = self.clients.get().await;
<a href="#h2-4-3" id="h2-4-3" class="d">-        let expect = self.customers * self.customer_accounts * Self::INITIAL_BALANCE as i64;
</a><a href="#h2-4-4" id="h2-4-4" class="i">+        let expect = self.customers * self.customer_accounts * Self::INITIAL_BALANCE;
</a>         let balance =
<a href="#h2-4-6" id="h2-4-6" class="d">-            client.execute(&quot;SELECT SUM(balance) FROM account&quot;).await?.into_value()?.integer()?;
</a><a href="#h2-4-7" id="h2-4-7" class="i">+            client.execute(&quot;SELECT SUM(balance) FROM account&quot;).await?.into_value()?.integer()?
</a><a href="#h2-4-8" id="h2-4-8" class="i">+                as u64;
</a>         if balance != expect {
             return Err(Error::Value(format!(
                 &quot;Expected total balance {}, found {}&quot;,
<a href="#h2-5" id="h2-5" class="h">@@ -225,7 +211,7 @@ impl Bank {
</a>     }
 
     /// Transfers a random amount between two customers, retrying serialization failures.
<a href="#h2-5-3" id="h2-5-3" class="d">-    async fn transfer(&amp;self, from: i64, to: i64) -&gt; Result&lt;()&gt; {
</a><a href="#h2-5-4" id="h2-5-4" class="i">+    async fn transfer(&amp;self, from: u64, to: u64) -&gt; Result&lt;()&gt; {
</a>         let client = self.clients.get().await;
         let attempts = Rc::new(Cell::new(0_u8));
         let start = std::time::Instant::now();
<b>diff --git a/<a id="h3" href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a> b/<a href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -6,7 +6,6 @@
</a> 
 #![warn(clippy::all)]
 
<a href="#h3-0-3" id="h3-0-3" class="d">-use clap::{app_from_crate, crate_authors, crate_description, crate_name, crate_version};
</a> use serde_derive::Deserialize;
 use std::collections::HashMap;
 use toydb::error::{Error, Result};
<a href="#h3-1" id="h3-1" class="h">@@ -15,17 +14,16 @@ use toydb::Server;
</a> 
 #[tokio::main]
 async fn main() -&gt; Result&lt;()&gt; {
<a href="#h3-1-3" id="h3-1-3" class="d">-    let opts = app_from_crate!()
</a><a href="#h3-1-4" id="h3-1-4" class="i">+    let args = clap::command!()
</a>         .arg(
<a href="#h3-1-6" id="h3-1-6" class="d">-            clap::Arg::with_name(&quot;config&quot;)
</a><a href="#h3-1-7" id="h3-1-7" class="d">-                .short(&quot;c&quot;)
</a><a href="#h3-1-8" id="h3-1-8" class="i">+            clap::Arg::new(&quot;config&quot;)
</a><a href="#h3-1-9" id="h3-1-9" class="i">+                .short(&#39;c&#39;)
</a>                 .long(&quot;config&quot;)
                 .help(&quot;Configuration file path&quot;)
<a href="#h3-1-12" id="h3-1-12" class="d">-                .takes_value(true)
</a>                 .default_value(&quot;/etc/toydb.yaml&quot;),
         )
         .get_matches();
<a href="#h3-1-16" id="h3-1-16" class="d">-    let cfg = Config::new(opts.value_of(&quot;config&quot;).unwrap())?;
</a><a href="#h3-1-17" id="h3-1-17" class="i">+    let cfg = Config::new(args.get_one::&lt;String&gt;(&quot;config&quot;).unwrap().as_ref())?;
</a> 
     let loglevel = cfg.log_level.parse::&lt;simplelog::LevelFilter&gt;()?;
     let mut logconfig = simplelog::ConfigBuilder::new();
<b>diff --git a/<a id="h4" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -5,7 +5,6 @@
</a> 
 #![warn(clippy::all)]
 
<a href="#h4-0-3" id="h4-0-3" class="d">-use clap::{app_from_crate, crate_authors, crate_description, crate_name, crate_version};
</a> use rustyline::validate::{ValidationContext, ValidationResult, Validator};
 use rustyline::{error::ReadlineError, Editor, Modifiers};
 use rustyline_derive::{Completer, Helper, Highlighter, Hinter};
<a href="#h4-1" id="h4-1" class="h">@@ -17,37 +16,30 @@ use toydb::Client;
</a> 
 #[tokio::main]
 async fn main() -&gt; Result&lt;()&gt; {
<a href="#h4-1-3" id="h4-1-3" class="d">-    let opts = app_from_crate!()
</a><a href="#h4-1-4" id="h4-1-4" class="d">-        .arg(clap::Arg::with_name(&quot;command&quot;))
</a><a href="#h4-1-5" id="h4-1-5" class="d">-        .arg(clap::Arg::with_name(&quot;headers&quot;).short(&quot;H&quot;).long(&quot;headers&quot;).help(&quot;Show column headers&quot;))
</a><a href="#h4-1-6" id="h4-1-6" class="d">-        .arg(
</a><a href="#h4-1-7" id="h4-1-7" class="d">-            clap::Arg::with_name(&quot;host&quot;)
</a><a href="#h4-1-8" id="h4-1-8" class="d">-                .short(&quot;h&quot;)
</a><a href="#h4-1-9" id="h4-1-9" class="i">+    let opts = clap::command!()
</a><a href="#h4-1-10" id="h4-1-10" class="i">+        .name(&quot;toysql&quot;)
</a><a href="#h4-1-11" id="h4-1-11" class="i">+        .about(&quot;A ToyDB client.&quot;)
</a><a href="#h4-1-12" id="h4-1-12" class="i">+        .args([
</a><a href="#h4-1-13" id="h4-1-13" class="i">+            clap::Arg::new(&quot;command&quot;),
</a><a href="#h4-1-14" id="h4-1-14" class="i">+            clap::Arg::new(&quot;host&quot;)
</a><a href="#h4-1-15" id="h4-1-15" class="i">+                .short(&#39;H&#39;)
</a>                 .long(&quot;host&quot;)
                 .help(&quot;Host to connect to&quot;)
<a href="#h4-1-18" id="h4-1-18" class="d">-                .takes_value(true)
</a><a href="#h4-1-19" id="h4-1-19" class="d">-                .required(true)
</a>                 .default_value(&quot;127.0.0.1&quot;),
<a href="#h4-1-21" id="h4-1-21" class="d">-        )
</a><a href="#h4-1-22" id="h4-1-22" class="d">-        .arg(
</a><a href="#h4-1-23" id="h4-1-23" class="d">-            clap::Arg::with_name(&quot;port&quot;)
</a><a href="#h4-1-24" id="h4-1-24" class="d">-                .short(&quot;p&quot;)
</a><a href="#h4-1-25" id="h4-1-25" class="i">+            clap::Arg::new(&quot;port&quot;)
</a><a href="#h4-1-26" id="h4-1-26" class="i">+                .short(&#39;p&#39;)
</a>                 .long(&quot;port&quot;)
                 .help(&quot;Port number to connect to&quot;)
<a href="#h4-1-29" id="h4-1-29" class="d">-                .takes_value(true)
</a><a href="#h4-1-30" id="h4-1-30" class="d">-                .required(true)
</a><a href="#h4-1-31" id="h4-1-31" class="i">+                .value_parser(clap::value_parser!(u16))
</a>                 .default_value(&quot;9605&quot;),
<a href="#h4-1-33" id="h4-1-33" class="d">-        )
</a><a href="#h4-1-34" id="h4-1-34" class="i">+        ])
</a>         .get_matches();
 
     let mut toysql =
<a href="#h4-1-38" id="h4-1-38" class="d">-        ToySQL::new(opts.value_of(&quot;host&quot;).unwrap(), opts.value_of(&quot;port&quot;).unwrap().parse()?)
</a><a href="#h4-1-39" id="h4-1-39" class="i">+        ToySQL::new(opts.get_one::&lt;String&gt;(&quot;host&quot;).unwrap(), *opts.get_one(&quot;port&quot;).unwrap())
</a>             .await?;
<a href="#h4-1-41" id="h4-1-41" class="d">-    if opts.is_present(&quot;headers&quot;) {
</a><a href="#h4-1-42" id="h4-1-42" class="d">-        toysql.show_headers = true
</a><a href="#h4-1-43" id="h4-1-43" class="d">-    }
</a> 
<a href="#h4-1-45" id="h4-1-45" class="d">-    if let Some(command) = opts.value_of(&quot;command&quot;) {
</a><a href="#h4-1-46" id="h4-1-46" class="i">+    if let Some(command) = opts.get_one::&lt;&amp;str&gt;(&quot;command&quot;) {
</a>         toysql.execute(command).await
     } else {
         toysql.run().await
</pre>
</div>
</body>
</html>
