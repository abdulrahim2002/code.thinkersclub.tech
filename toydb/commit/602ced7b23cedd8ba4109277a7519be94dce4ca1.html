<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: clean up `Session` - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/602ced7b23cedd8ba4109277a7519be94dce4ca1.html">602ced7b23cedd8ba4109277a7519be94dce4ca1</a>
<b>parent</b> <a href="../commit/d599d2a833e56688433f6fccf2db4fbceaec977c.html">d599d2a833e56688433f6fccf2db4fbceaec977c</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Thu, 20 Jun 2024 13:41:23 +0200

sql: clean up `Session`

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/bin/toysql.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/bin/workload.rs</a></td><td> | </td><td class="num">30</td><td><span class="i">+++++++++++++</span><span class="d">-----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/server.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/engine/session.rs</a></td><td> | </td><td class="num">270</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/types/value.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">tests/e2e/client.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">tests/e2e/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">tests/sql/expression.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">tests/sql/mutation/insert_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">tests/sql/mutation/insert_expression</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">tests/sql/mutation/insert_full</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">tests/sql/mutation/insert_full_multiple</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">tests/sql/mutation/insert_full_order</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">tests/sql/mutation/insert_no_columns</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">tests/sql/mutation/insert_no_columns_multiple</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">tests/sql/mutation/insert_partial</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">tests/sql/mutation/insert_partial_vary</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">tests/sql/query.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">tests/sql/schema/insert_boolean_false</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">tests/sql/schema/insert_boolean_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">tests/sql/schema/insert_boolean_true</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">tests/sql/schema/insert_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">tests/sql/schema/insert_default_override</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">tests/sql/schema/insert_default_override_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">tests/sql/schema/insert_default_unnamed</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">tests/sql/schema/insert_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">tests/sql/schema/insert_float_infinity</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">tests/sql/schema/insert_float_infinity_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">tests/sql/schema/insert_float_max</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">tests/sql/schema/insert_float_max_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">tests/sql/schema/insert_float_min</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">tests/sql/schema/insert_float_min_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">tests/sql/schema/insert_float_min_round</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">tests/sql/schema/insert_float_nan</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">tests/sql/schema/insert_float_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">tests/sql/schema/insert_index_exists</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">tests/sql/schema/insert_index_new</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">tests/sql/schema/insert_index_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">tests/sql/schema/insert_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">tests/sql/schema/insert_integer_max</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">tests/sql/schema/insert_integer_min</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">tests/sql/schema/insert_integer_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">tests/sql/schema/insert_nulls</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">tests/sql/schema/insert_nulls_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">tests/sql/schema/insert_pk_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">tests/sql/schema/insert_pk_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">tests/sql/schema/insert_pk_float_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">tests/sql/schema/insert_pk_float_zero</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">tests/sql/schema/insert_pk_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h49">tests/sql/schema/insert_pk_integer_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h50">tests/sql/schema/insert_pk_integer_zero</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h51">tests/sql/schema/insert_pk_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h52">tests/sql/schema/insert_pk_string_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h53">tests/sql/schema/insert_pk_string_empty</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h54">tests/sql/schema/insert_ref_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h55">tests/sql/schema/insert_ref_boolean_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h56">tests/sql/schema/insert_ref_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h57">tests/sql/schema/insert_ref_float_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h58">tests/sql/schema/insert_ref_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h59">tests/sql/schema/insert_ref_integer_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h60">tests/sql/schema/insert_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h61">tests/sql/schema/insert_ref_self_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h62">tests/sql/schema/insert_ref_self_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h63">tests/sql/schema/insert_ref_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h64">tests/sql/schema/insert_ref_string_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h65">tests/sql/schema/insert_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h66">tests/sql/schema/insert_string_empty</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h67">tests/sql/schema/insert_string_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h68">tests/sql/schema/insert_string_unicode</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h69">tests/sql/schema/insert_unique_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h70">tests/sql/schema/insert_unique_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h71">tests/sql/schema/insert_unique_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h72">tests/sql/schema/insert_unique_nulls</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h73">tests/sql/schema/insert_unique_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h74">tests/sql/schema/insert_unique_string_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>75 files changed, 243 insertions(+), 221 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -188,7 +188,7 @@ Storage:   {keys} keys, {logical_size} MB logical, {nodes}x {disk_size} MB disk,
</a>             },
             StatementResult::Commit { version: id } =&gt; println!(&quot;Committed transaction {}&quot;, id),
             StatementResult::Rollback { version: id } =&gt; println!(&quot;Rolled back transaction {}&quot;, id),
<a href="#h0-0-3" id="h0-0-3" class="d">-            StatementResult::Create { count } =&gt; println!(&quot;Created {} rows&quot;, count),
</a><a href="#h0-0-4" id="h0-0-4" class="i">+            StatementResult::Insert { count } =&gt; println!(&quot;Created {} rows&quot;, count),
</a>             StatementResult::Delete { count } =&gt; println!(&quot;Deleted {} rows&quot;, count),
             StatementResult::Update { count } =&gt; println!(&quot;Updated {} rows&quot;, count),
             StatementResult::CreateTable { name } =&gt; println!(&quot;Created table {}&quot;, name),
<a href="#h0-1" id="h0-1" class="h">@@ -197,7 +197,7 @@ Storage:   {keys} keys, {logical_size} MB logical, {nodes}x {disk_size} MB disk,
</a>                 false =&gt; println!(&quot;Table {} did not exit&quot;, name),
             },
             StatementResult::Explain(plan) =&gt; println!(&quot;{}&quot;, plan),
<a href="#h0-1-3" id="h0-1-3" class="d">-            StatementResult::Query { columns, rows } =&gt; {
</a><a href="#h0-1-4" id="h0-1-4" class="i">+            StatementResult::Select { columns, rows } =&gt; {
</a>                 if self.show_headers {
                     println!(
                         &quot;{}&quot;,
<b>diff --git a/<a id="h1" href="../file/src/bin/workload.rs.html">src/bin/workload.rs</a> b/<a href="../file/src/bin/workload.rs.html">src/bin/workload.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -20,6 +20,7 @@ use std::collections::HashSet;
</a> use std::io::Write as _;
 use std::time::Duration;
 use toydb::error::Result;
<a href="#h1-0-3" id="h1-0-3" class="i">+use toydb::sql::types::{Row, Rows};
</a> use toydb::{Client, StatementResult};
 
 fn main() -&gt; Result&lt;()&gt; {
<a href="#h1-1" id="h1-1" class="h">@@ -259,14 +260,13 @@ impl Workload for Read {
</a>             r#&quot;SELECT * FROM &quot;read&quot; WHERE {}&quot;#,
             item.iter().map(|id| format!(&quot;id = {}&quot;, id)).join(&quot; OR &quot;)
         );
<a href="#h1-1-3" id="h1-1-3" class="d">-        let rows = client.execute(&amp;query)?.into_rows()?;
</a><a href="#h1-1-4" id="h1-1-4" class="i">+        let rows: Rows = client.execute(&amp;query)?.try_into()?;
</a>         assert_eq!(rows.count(), batch_size, &quot;Unexpected row count&quot;);
         Ok(())
     }
 
     fn verify(&amp;self, client: &amp;mut Client, _: usize) -&gt; Result&lt;()&gt; {
<a href="#h1-1-10" id="h1-1-10" class="d">-        let count: i64 =
</a><a href="#h1-1-11" id="h1-1-11" class="d">-            client.execute(r#&quot;SELECT COUNT(*) FROM &quot;read&quot;&quot;#)?.into_value()?.try_into()?;
</a><a href="#h1-1-12" id="h1-1-12" class="i">+        let count: i64 = client.execute(r#&quot;SELECT COUNT(*) FROM &quot;read&quot;&quot;#)?.try_into()?;
</a>         assert_eq!(count, self.rows as i64, &quot;Unexpected row count&quot;);
         Ok(())
     }
<a href="#h1-2" id="h1-2" class="h">@@ -337,7 +337,7 @@ impl Workload for Write {
</a>             r#&quot;INSERT INTO &quot;write&quot; (id, value) VALUES {}&quot;#,
             item.iter().map(|(id, value)| format!(&quot;({}, &#39;{}&#39;)&quot;, id, value)).join(&quot;, &quot;)
         );
<a href="#h1-2-3" id="h1-2-3" class="d">-        if let StatementResult::Create { count } = client.execute(&amp;query)? {
</a><a href="#h1-2-4" id="h1-2-4" class="i">+        if let StatementResult::Insert { count } = client.execute(&amp;query)? {
</a>             assert_eq!(count as usize, batch_size, &quot;Unexpected row count&quot;);
         } else {
             panic!(&quot;Unexpected result&quot;)
<a href="#h1-3" id="h1-3" class="h">@@ -346,8 +346,7 @@ impl Workload for Write {
</a>     }
 
     fn verify(&amp;self, client: &amp;mut Client, txns: usize) -&gt; Result&lt;()&gt; {
<a href="#h1-3-3" id="h1-3-3" class="d">-        let count: i64 =
</a><a href="#h1-3-4" id="h1-3-4" class="d">-            client.execute(r#&quot;SELECT COUNT(*) FROM &quot;write&quot;&quot;#)?.into_value()?.try_into()?;
</a><a href="#h1-3-5" id="h1-3-5" class="i">+        let count: i64 = client.execute(r#&quot;SELECT COUNT(*) FROM &quot;write&quot;&quot;#)?.try_into()?;
</a>         assert_eq!(count as usize, txns * self.batch, &quot;Unexpected row count&quot;);
         Ok(())
     }
<a href="#h1-4" id="h1-4" class="h">@@ -465,7 +464,7 @@ impl Workload for Bank {
</a> 
         client.execute(&quot;BEGIN&quot;)?;
 
<a href="#h1-4-3" id="h1-4-3" class="d">-        let mut row = client
</a><a href="#h1-4-4" id="h1-4-4" class="i">+        let row: Row = client
</a>             .execute(&amp;format!(
                 &quot;SELECT a.id, a.balance
                         FROM account a JOIN customer c ON a.customer_id = c.id
<a href="#h1-5" id="h1-5" class="h">@@ -474,9 +473,10 @@ impl Workload for Bank {
</a>                         LIMIT 1&quot;,
                 from
             ))?
<a href="#h1-5-3" id="h1-5-3" class="d">-            .into_row()?;
</a><a href="#h1-5-4" id="h1-5-4" class="d">-        let from_balance: i64 = row.pop().unwrap().try_into()?;
</a><a href="#h1-5-5" id="h1-5-5" class="d">-        let from_account: i64 = row.pop().unwrap().try_into()?;
</a><a href="#h1-5-6" id="h1-5-6" class="i">+            .try_into()?;
</a><a href="#h1-5-7" id="h1-5-7" class="i">+        let mut row = row.into_iter();
</a><a href="#h1-5-8" id="h1-5-8" class="i">+        let from_account: i64 = row.next().unwrap().try_into()?;
</a><a href="#h1-5-9" id="h1-5-9" class="i">+        let from_balance: i64 = row.next().unwrap().try_into()?;
</a>         amount = std::cmp::min(amount, from_balance as u64);
 
         let to_account: i64 = client
<a href="#h1-6" id="h1-6" class="h">@@ -488,7 +488,6 @@ impl Workload for Bank {
</a>                         LIMIT 1&quot;,
                 to
             ))?
<a href="#h1-6-3" id="h1-6-3" class="d">-            .into_value()?
</a>             .try_into()?;
 
         client.execute(&amp;format!(
<a href="#h1-7" id="h1-7" class="h">@@ -506,13 +505,10 @@ impl Workload for Bank {
</a>     }
 
     fn verify(&amp;self, client: &amp;mut Client, _: usize) -&gt; Result&lt;()&gt; {
<a href="#h1-7-3" id="h1-7-3" class="d">-        let balance: i64 =
</a><a href="#h1-7-4" id="h1-7-4" class="d">-            client.execute(&quot;SELECT SUM(balance) FROM account&quot;)?.into_value()?.try_into()?;
</a><a href="#h1-7-5" id="h1-7-5" class="i">+        let balance: i64 = client.execute(&quot;SELECT SUM(balance) FROM account&quot;)?.try_into()?;
</a>         assert_eq!(balance as u64, self.customers * self.accounts * self.balance);
<a href="#h1-7-7" id="h1-7-7" class="d">-        let negative: i64 = client
</a><a href="#h1-7-8" id="h1-7-8" class="d">-            .execute(&quot;SELECT COUNT(*) FROM account WHERE balance &lt; 0&quot;)?
</a><a href="#h1-7-9" id="h1-7-9" class="d">-            .into_value()?
</a><a href="#h1-7-10" id="h1-7-10" class="d">-            .try_into()?;
</a><a href="#h1-7-11" id="h1-7-11" class="i">+        let negative: i64 =
</a><a href="#h1-7-12" id="h1-7-12" class="i">+            client.execute(&quot;SELECT COUNT(*) FROM account WHERE balance &lt; 0&quot;)?.try_into()?;
</a>         assert_eq!(negative, 0);
         Ok(())
     }
<b>diff --git a/<a id="h2" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -285,11 +285,11 @@ impl Server {
</a>             debug!(&quot;Received request {request:?}&quot;);
             let response = match request {
                 Request::Execute(query) =&gt; session.execute(&amp;query).map(Response::Execute),
<a href="#h2-0-3" id="h2-0-3" class="d">-                Request::GetTable(table) =&gt; session
</a><a href="#h2-0-4" id="h2-0-4" class="d">-                    .with_txn_read_only(|txn| txn.must_get_table(&amp;table))
</a><a href="#h2-0-5" id="h2-0-5" class="d">-                    .map(Response::GetTable),
</a><a href="#h2-0-6" id="h2-0-6" class="i">+                Request::GetTable(table) =&gt; {
</a><a href="#h2-0-7" id="h2-0-7" class="i">+                    session.with_txn(true, |txn| txn.must_get_table(&amp;table)).map(Response::GetTable)
</a><a href="#h2-0-8" id="h2-0-8" class="i">+                }
</a>                 Request::ListTables =&gt; session
<a href="#h2-0-10" id="h2-0-10" class="d">-                    .with_txn_read_only(|txn| {
</a><a href="#h2-0-11" id="h2-0-11" class="i">+                    .with_txn(true, |txn| {
</a>                         Ok(txn.list_tables()?.into_iter().map(|t| t.name).collect())
                     })
                     .map(Response::ListTables),
<b>diff --git a/<a id="h3" href="../file/src/sql/engine/session.rs.html">src/sql/engine/session.rs</a> b/<a href="../file/src/sql/engine/session.rs.html">src/sql/engine/session.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -5,205 +5,231 @@ use crate::sql::execution::ExecutionResult;
</a> use crate::sql::parser::{ast, Parser};
 use crate::sql::plan::Plan;
 use crate::sql::types::{Columns, Row, Rows, Value};
<a href="#h3-0-3" id="h3-0-3" class="i">+use crate::storage::mvcc;
</a> use crate::{errdata, errinput};
 
<a href="#h3-0-6" id="h3-0-6" class="i">+use log::error;
</a> use serde::{Deserialize, Serialize};
 
<a href="#h3-0-9" id="h3-0-9" class="d">-/// An SQL session, which handles transaction control and simplified query execution
</a><a href="#h3-0-10" id="h3-0-10" class="i">+/// A SQL client session. Executes raw SQL statements against a SQL engine and
</a><a href="#h3-0-11" id="h3-0-11" class="i">+/// handles transaction control.
</a> pub struct Session&lt;&#39;a, E: Engine&lt;&#39;a&gt;&gt; {
<a href="#h3-0-13" id="h3-0-13" class="d">-    /// The underlying engine
</a><a href="#h3-0-14" id="h3-0-14" class="i">+    /// The SQL engine.
</a>     engine: &amp;&#39;a E,
<a href="#h3-0-16" id="h3-0-16" class="d">-    /// The current session transaction, if any
</a><a href="#h3-0-17" id="h3-0-17" class="i">+    /// The current transaction, if any.
</a>     txn: Option&lt;E::Transaction&gt;,
 }
 
 impl&lt;&#39;a, E: Engine&lt;&#39;a&gt;&gt; Session&lt;&#39;a, E&gt; {
<a href="#h3-0-22" id="h3-0-22" class="i">+    /// Creates a new session using the given SQL engine.
</a>     pub fn new(engine: &amp;&#39;a E) -&gt; Self {
         Self { engine, txn: None }
     }
 
<a href="#h3-0-27" id="h3-0-27" class="d">-    /// Executes a query, managing transaction status for the session
</a><a href="#h3-0-28" id="h3-0-28" class="d">-    pub fn execute(&amp;mut self, query: &amp;str) -&gt; Result&lt;StatementResult&gt; {
</a><a href="#h3-0-29" id="h3-0-29" class="d">-        // FIXME We should match on self.txn as well, but get this error:
</a><a href="#h3-0-30" id="h3-0-30" class="d">-        // error[E0009]: cannot bind by-move and by-ref in the same pattern
</a><a href="#h3-0-31" id="h3-0-31" class="d">-        // ...which seems like an arbitrary compiler limitation
</a><a href="#h3-0-32" id="h3-0-32" class="d">-        match Parser::new(query).parse()? {
</a><a href="#h3-0-33" id="h3-0-33" class="i">+    /// Executes a client statement.
</a><a href="#h3-0-34" id="h3-0-34" class="i">+    pub fn execute(&amp;mut self, statement: &amp;str) -&gt; Result&lt;StatementResult&gt; {
</a><a href="#h3-0-35" id="h3-0-35" class="i">+        match Parser::new(statement).parse()? {
</a>             ast::Statement::Begin { .. } if self.txn.is_some() =&gt; {
                 errinput!(&quot;already in a transaction&quot;)
             }
<a href="#h3-0-39" id="h3-0-39" class="d">-            ast::Statement::Begin { read_only: true, as_of: None } =&gt; {
</a><a href="#h3-0-40" id="h3-0-40" class="d">-                let txn = self.engine.begin_read_only()?;
</a><a href="#h3-0-41" id="h3-0-41" class="d">-                let result = StatementResult::Begin { version: txn.version(), read_only: true };
</a><a href="#h3-0-42" id="h3-0-42" class="d">-                self.txn = Some(txn);
</a><a href="#h3-0-43" id="h3-0-43" class="d">-                Ok(result)
</a><a href="#h3-0-44" id="h3-0-44" class="d">-            }
</a><a href="#h3-0-45" id="h3-0-45" class="d">-            ast::Statement::Begin { read_only: true, as_of: Some(version) } =&gt; {
</a><a href="#h3-0-46" id="h3-0-46" class="d">-                let txn = self.engine.begin_as_of(version)?;
</a><a href="#h3-0-47" id="h3-0-47" class="d">-                let result = StatementResult::Begin { version, read_only: true };
</a><a href="#h3-0-48" id="h3-0-48" class="d">-                self.txn = Some(txn);
</a><a href="#h3-0-49" id="h3-0-49" class="d">-                Ok(result)
</a><a href="#h3-0-50" id="h3-0-50" class="d">-            }
</a>             ast::Statement::Begin { read_only: false, as_of: Some(_) } =&gt; {
                 errinput!(&quot;can&#39;t start read-write transaction in a given version&quot;)
             }
             ast::Statement::Begin { read_only: false, as_of: None } =&gt; {
                 let txn = self.engine.begin()?;
<a href="#h3-0-56" id="h3-0-56" class="d">-                let result = StatementResult::Begin { version: txn.version(), read_only: false };
</a><a href="#h3-0-57" id="h3-0-57" class="i">+                let version = txn.version();
</a>                 self.txn = Some(txn);
<a href="#h3-0-59" id="h3-0-59" class="d">-                Ok(result)
</a><a href="#h3-0-60" id="h3-0-60" class="i">+                Ok(StatementResult::Begin { version, read_only: false })
</a>             }
<a href="#h3-0-62" id="h3-0-62" class="d">-            ast::Statement::Commit | ast::Statement::Rollback if self.txn.is_none() =&gt; {
</a><a href="#h3-0-63" id="h3-0-63" class="d">-                errinput!(&quot;not in a transaction&quot;)
</a><a href="#h3-0-64" id="h3-0-64" class="i">+            ast::Statement::Begin { read_only: true, as_of: None } =&gt; {
</a><a href="#h3-0-65" id="h3-0-65" class="i">+                let txn = self.engine.begin_read_only()?;
</a><a href="#h3-0-66" id="h3-0-66" class="i">+                let version = txn.version();
</a><a href="#h3-0-67" id="h3-0-67" class="i">+                self.txn = Some(txn);
</a><a href="#h3-0-68" id="h3-0-68" class="i">+                Ok(StatementResult::Begin { version, read_only: true })
</a><a href="#h3-0-69" id="h3-0-69" class="i">+            }
</a><a href="#h3-0-70" id="h3-0-70" class="i">+            ast::Statement::Begin { read_only: true, as_of: Some(version) } =&gt; {
</a><a href="#h3-0-71" id="h3-0-71" class="i">+                self.txn = Some(self.engine.begin_as_of(version)?);
</a><a href="#h3-0-72" id="h3-0-72" class="i">+                Ok(StatementResult::Begin { version, read_only: true })
</a>             }
             ast::Statement::Commit =&gt; {
<a href="#h3-0-75" id="h3-0-75" class="d">-                let txn = self.txn.take().unwrap();
</a><a href="#h3-0-76" id="h3-0-76" class="i">+                let Some(txn) = self.txn.take() else {
</a><a href="#h3-0-77" id="h3-0-77" class="i">+                    return errinput!(&quot;not in a transaction&quot;);
</a><a href="#h3-0-78" id="h3-0-78" class="i">+                };
</a>                 let version = txn.version();
                 txn.commit()?;
                 Ok(StatementResult::Commit { version })
             }
             ast::Statement::Rollback =&gt; {
<a href="#h3-0-84" id="h3-0-84" class="d">-                let txn = self.txn.take().unwrap();
</a><a href="#h3-0-85" id="h3-0-85" class="i">+                let Some(txn) = self.txn.take() else {
</a><a href="#h3-0-86" id="h3-0-86" class="i">+                    return errinput!(&quot;not in a transaction&quot;);
</a><a href="#h3-0-87" id="h3-0-87" class="i">+                };
</a>                 let version = txn.version();
                 txn.rollback()?;
                 Ok(StatementResult::Rollback { version })
             }
<a href="#h3-0-92" id="h3-0-92" class="d">-            // TODO: this needs testing.
</a><a href="#h3-0-93" id="h3-0-93" class="d">-            ast::Statement::Explain(statement) =&gt; self.with_txn_read_only(|txn| {
</a><a href="#h3-0-94" id="h3-0-94" class="i">+            ast::Statement::Explain(statement) =&gt; self.with_txn(true, |txn| {
</a>                 Ok(StatementResult::Explain(Plan::build(*statement, txn)?.optimize()?))
             }),
<a href="#h3-0-97" id="h3-0-97" class="d">-            statement if self.txn.is_some() =&gt; {
</a><a href="#h3-0-98" id="h3-0-98" class="d">-                Self::execute_with(statement, self.txn.as_mut().unwrap())
</a><a href="#h3-0-99" id="h3-0-99" class="d">-            }
</a><a href="#h3-0-100" id="h3-0-100" class="d">-            statement @ ast::Statement::Select { .. } =&gt; {
</a><a href="#h3-0-101" id="h3-0-101" class="d">-                let mut txn = self.engine.begin_read_only()?;
</a><a href="#h3-0-102" id="h3-0-102" class="d">-                let result = Self::execute_with(statement, &amp;mut txn);
</a><a href="#h3-0-103" id="h3-0-103" class="d">-                txn.rollback()?;
</a><a href="#h3-0-104" id="h3-0-104" class="d">-                result
</a><a href="#h3-0-105" id="h3-0-105" class="d">-            }
</a>             statement =&gt; {
<a href="#h3-0-107" id="h3-0-107" class="d">-                let mut txn = self.engine.begin()?;
</a><a href="#h3-0-108" id="h3-0-108" class="d">-                let result = Self::execute_with(statement, &amp;mut txn);
</a><a href="#h3-0-109" id="h3-0-109" class="d">-                match &amp;result {
</a><a href="#h3-0-110" id="h3-0-110" class="d">-                    Ok(_) =&gt; txn.commit()?,
</a><a href="#h3-0-111" id="h3-0-111" class="d">-                    Err(_) =&gt; txn.rollback()?,
</a><a href="#h3-0-112" id="h3-0-112" class="d">-                }
</a><a href="#h3-0-113" id="h3-0-113" class="d">-                result
</a><a href="#h3-0-114" id="h3-0-114" class="i">+                let read_only = matches!(statement, ast::Statement::Select { .. });
</a><a href="#h3-0-115" id="h3-0-115" class="i">+                self.with_txn(read_only, |txn| {
</a><a href="#h3-0-116" id="h3-0-116" class="i">+                    Plan::build(statement, txn)?.optimize()?.execute(txn)?.try_into()
</a><a href="#h3-0-117" id="h3-0-117" class="i">+                })
</a>             }
         }
     }
 
<a href="#h3-0-122" id="h3-0-122" class="d">-    /// Helper function to execute a statement with the given transaction.
</a><a href="#h3-0-123" id="h3-0-123" class="d">-    /// Allows using a mutable borrow either to the session&#39;s transaction
</a><a href="#h3-0-124" id="h3-0-124" class="d">-    /// or a temporary read-only or read/write transaction.
</a><a href="#h3-0-125" id="h3-0-125" class="d">-    ///
</a><a href="#h3-0-126" id="h3-0-126" class="d">-    /// TODO: reconsider this.
</a><a href="#h3-0-127" id="h3-0-127" class="d">-    fn execute_with(
</a><a href="#h3-0-128" id="h3-0-128" class="d">-        statement: ast::Statement,
</a><a href="#h3-0-129" id="h3-0-129" class="d">-        txn: &amp;mut E::Transaction,
</a><a href="#h3-0-130" id="h3-0-130" class="d">-    ) -&gt; Result&lt;StatementResult&gt; {
</a><a href="#h3-0-131" id="h3-0-131" class="d">-        Plan::build(statement, txn)?.optimize()?.execute(txn)?.try_into()
</a><a href="#h3-0-132" id="h3-0-132" class="d">-    }
</a><a href="#h3-0-133" id="h3-0-133" class="d">-
</a><a href="#h3-0-134" id="h3-0-134" class="d">-    /// Runs a read-only closure in the session&#39;s transaction, or a new
</a><a href="#h3-0-135" id="h3-0-135" class="d">-    /// read-only transaction if none is active.
</a><a href="#h3-0-136" id="h3-0-136" class="d">-    ///
</a><a href="#h3-0-137" id="h3-0-137" class="d">-    /// TODO: reconsider this.
</a><a href="#h3-0-138" id="h3-0-138" class="d">-    pub fn with_txn_read_only&lt;F, R&gt;(&amp;mut self, f: F) -&gt; Result&lt;R&gt;
</a><a href="#h3-0-139" id="h3-0-139" class="i">+    /// Runs a closure in the session&#39;s explicit transaction, if there is one,
</a><a href="#h3-0-140" id="h3-0-140" class="i">+    /// otherwise a temporary implicit transaction. If read_only is true, uses a
</a><a href="#h3-0-141" id="h3-0-141" class="i">+    /// read-only implicit transaction. Does not retry errors.
</a><a href="#h3-0-142" id="h3-0-142" class="i">+    pub fn with_txn&lt;F, T&gt;(&amp;mut self, read_only: bool, f: F) -&gt; Result&lt;T&gt;
</a>     where
<a href="#h3-0-144" id="h3-0-144" class="d">-        F: FnOnce(&amp;mut E::Transaction) -&gt; Result&lt;R&gt;,
</a><a href="#h3-0-145" id="h3-0-145" class="i">+        F: FnOnce(&amp;mut E::Transaction) -&gt; Result&lt;T&gt;,
</a>     {
<a href="#h3-0-147" id="h3-0-147" class="i">+        // Use the current explicit transaction, if there is one.
</a>         if let Some(ref mut txn) = self.txn {
             return f(txn);
         }
<a href="#h3-0-151" id="h3-0-151" class="d">-        let mut txn = self.engine.begin_read_only()?;
</a><a href="#h3-0-152" id="h3-0-152" class="i">+        // Otherwise, use an implicit transaction. Doing this session-side
</a><a href="#h3-0-153" id="h3-0-153" class="i">+        // results in additional Raft roundtrips to begin and complete the
</a><a href="#h3-0-154" id="h3-0-154" class="i">+        // transaction -- we could avoid this if the below-Raft engine supported
</a><a href="#h3-0-155" id="h3-0-155" class="i">+        // implicit transactions, but we keep it simple.
</a><a href="#h3-0-156" id="h3-0-156" class="i">+        let mut txn = match read_only {
</a><a href="#h3-0-157" id="h3-0-157" class="i">+            true =&gt; self.engine.begin_read_only()?,
</a><a href="#h3-0-158" id="h3-0-158" class="i">+            false =&gt; self.engine.begin()?,
</a><a href="#h3-0-159" id="h3-0-159" class="i">+        };
</a>         let result = f(&amp;mut txn);
<a href="#h3-0-161" id="h3-0-161" class="d">-        txn.rollback()?;
</a><a href="#h3-0-162" id="h3-0-162" class="i">+        match result {
</a><a href="#h3-0-163" id="h3-0-163" class="i">+            Ok(_) =&gt; txn.commit()?,
</a><a href="#h3-0-164" id="h3-0-164" class="i">+            Err(_) =&gt; txn.rollback()?,
</a><a href="#h3-0-165" id="h3-0-165" class="i">+        }
</a>         result
     }
 }
 
 impl&lt;&#39;a&gt; Session&lt;&#39;a, Raft&gt; {
<a href="#h3-0-171" id="h3-0-171" class="i">+    /// Returns Raft SQL engine status.
</a>     pub fn status(&amp;self) -&gt; Result&lt;Status&gt; {
         self.engine.status()
     }
 }
 
<a href="#h3-0-177" id="h3-0-177" class="i">+/// If the session has an open transaction when dropped, roll it back.
</a> impl&lt;&#39;a, E: Engine&lt;&#39;a&gt;&gt; Drop for Session&lt;&#39;a, E&gt; {
     fn drop(&amp;mut self) {
<a href="#h3-0-180" id="h3-0-180" class="d">-        self.execute(&quot;ROLLBACK&quot;).ok();
</a><a href="#h3-0-181" id="h3-0-181" class="i">+        if let Some(txn) = self.txn.take() {
</a><a href="#h3-0-182" id="h3-0-182" class="i">+            if let Err(error) = txn.rollback() {
</a><a href="#h3-0-183" id="h3-0-183" class="i">+                error!(&quot;implicit transaction rollback failed: {error}&quot;)
</a><a href="#h3-0-184" id="h3-0-184" class="i">+            }
</a><a href="#h3-0-185" id="h3-0-185" class="i">+        }
</a>     }
 }
 
<a href="#h3-0-189" id="h3-0-189" class="d">-/// A session statement result. This is also sent across the wire to SQL
</a><a href="#h3-0-190" id="h3-0-190" class="d">-/// clients.
</a><a href="#h3-0-191" id="h3-0-191" class="i">+/// A session statement result. Sent across the wire to SQL clients.
</a> #[derive(Debug, PartialEq, Serialize, Deserialize)]
 pub enum StatementResult {
<a href="#h3-0-194" id="h3-0-194" class="d">-    // Transaction started
</a><a href="#h3-0-195" id="h3-0-195" class="d">-    Begin { version: u64, read_only: bool },
</a><a href="#h3-0-196" id="h3-0-196" class="d">-    // Transaction committed
</a><a href="#h3-0-197" id="h3-0-197" class="d">-    Commit { version: u64 },
</a><a href="#h3-0-198" id="h3-0-198" class="d">-    // Transaction rolled back
</a><a href="#h3-0-199" id="h3-0-199" class="d">-    Rollback { version: u64 },
</a><a href="#h3-0-200" id="h3-0-200" class="d">-    // Rows created
</a><a href="#h3-0-201" id="h3-0-201" class="d">-    Create { count: u64 },
</a><a href="#h3-0-202" id="h3-0-202" class="d">-    // Rows deleted
</a><a href="#h3-0-203" id="h3-0-203" class="d">-    Delete { count: u64 },
</a><a href="#h3-0-204" id="h3-0-204" class="d">-    // Rows updated
</a><a href="#h3-0-205" id="h3-0-205" class="d">-    Update { count: u64 },
</a><a href="#h3-0-206" id="h3-0-206" class="d">-    // Table created
</a><a href="#h3-0-207" id="h3-0-207" class="i">+    Begin { version: mvcc::Version, read_only: bool },
</a><a href="#h3-0-208" id="h3-0-208" class="i">+    Commit { version: mvcc::Version },
</a><a href="#h3-0-209" id="h3-0-209" class="i">+    Rollback { version: mvcc::Version },
</a><a href="#h3-0-210" id="h3-0-210" class="i">+    Explain(Plan),
</a>     CreateTable { name: String },
<a href="#h3-0-212" id="h3-0-212" class="d">-    // Table dropped
</a>     DropTable { name: String, existed: bool },
<a href="#h3-0-214" id="h3-0-214" class="d">-    // Query result.
</a><a href="#h3-0-215" id="h3-0-215" class="d">-    //
</a><a href="#h3-0-216" id="h3-0-216" class="d">-    // For simplicity, buffer and send the entire result as a vector instead of
</a><a href="#h3-0-217" id="h3-0-217" class="d">-    // streaming it to the client. Streaming reads haven&#39;t been implemented from
</a><a href="#h3-0-218" id="h3-0-218" class="d">-    // Raft either.
</a><a href="#h3-0-219" id="h3-0-219" class="d">-    Query { columns: Columns, rows: Vec&lt;Row&gt; },
</a><a href="#h3-0-220" id="h3-0-220" class="d">-    // Explain result
</a><a href="#h3-0-221" id="h3-0-221" class="d">-    Explain(Plan),
</a><a href="#h3-0-222" id="h3-0-222" class="i">+    Delete { count: u64 },
</a><a href="#h3-0-223" id="h3-0-223" class="i">+    Insert { count: u64 },
</a><a href="#h3-0-224" id="h3-0-224" class="i">+    Update { count: u64 },
</a><a href="#h3-0-225" id="h3-0-225" class="i">+    // For simplicity, we buffer and send the entire set of rows as a vector
</a><a href="#h3-0-226" id="h3-0-226" class="i">+    // instead of streaming them to the client. Streaming reads haven&#39;t been
</a><a href="#h3-0-227" id="h3-0-227" class="i">+    // implemented from Raft either, so they&#39;re buffered all the way through.
</a><a href="#h3-0-228" id="h3-0-228" class="i">+    Select { columns: Columns, rows: Vec&lt;Row&gt; },
</a> }
 
<a href="#h3-0-231" id="h3-0-231" class="d">-impl StatementResult {
</a><a href="#h3-0-232" id="h3-0-232" class="d">-    /// Converts the ResultSet into a row, or errors if not a query result with rows.
</a><a href="#h3-0-233" id="h3-0-233" class="d">-    pub fn into_row(self) -&gt; Result&lt;Row&gt; {
</a><a href="#h3-0-234" id="h3-0-234" class="d">-        self.into_rows()?.next().transpose()?.ok_or(errdata!(&quot;no rows returned&quot;))
</a><a href="#h3-0-235" id="h3-0-235" class="i">+/// Converts an execution result into a statement result.
</a><a href="#h3-0-236" id="h3-0-236" class="i">+impl TryFrom&lt;ExecutionResult&gt; for StatementResult {
</a><a href="#h3-0-237" id="h3-0-237" class="i">+    type Error = Error;
</a><a href="#h3-0-238" id="h3-0-238" class="i">+
</a><a href="#h3-0-239" id="h3-0-239" class="i">+    fn try_from(result: ExecutionResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-240" id="h3-0-240" class="i">+        Ok(match result {
</a><a href="#h3-0-241" id="h3-0-241" class="i">+            ExecutionResult::CreateTable { name } =&gt; Self::CreateTable { name },
</a><a href="#h3-0-242" id="h3-0-242" class="i">+            ExecutionResult::DropTable { name, existed } =&gt; Self::DropTable { name, existed },
</a><a href="#h3-0-243" id="h3-0-243" class="i">+            ExecutionResult::Delete { count } =&gt; Self::Delete { count },
</a><a href="#h3-0-244" id="h3-0-244" class="i">+            ExecutionResult::Insert { count } =&gt; Self::Insert { count },
</a><a href="#h3-0-245" id="h3-0-245" class="i">+            ExecutionResult::Update { count } =&gt; Self::Update { count },
</a><a href="#h3-0-246" id="h3-0-246" class="i">+            ExecutionResult::Select { iter } =&gt; {
</a><a href="#h3-0-247" id="h3-0-247" class="i">+                // We buffer the entire set of rows, for simplicity.
</a><a href="#h3-0-248" id="h3-0-248" class="i">+                Self::Select { columns: iter.columns, rows: iter.rows.collect::&lt;Result&lt;_&gt;&gt;()? }
</a><a href="#h3-0-249" id="h3-0-249" class="i">+            }
</a><a href="#h3-0-250" id="h3-0-250" class="i">+        })
</a>     }
<a href="#h3-0-252" id="h3-0-252" class="i">+}
</a> 
<a href="#h3-0-254" id="h3-0-254" class="d">-    /// Converts the ResultSet into a row iterator, or errors if not a query
</a><a href="#h3-0-255" id="h3-0-255" class="d">-    /// result with rows.
</a><a href="#h3-0-256" id="h3-0-256" class="d">-    pub fn into_rows(self) -&gt; Result&lt;Rows&gt; {
</a><a href="#h3-0-257" id="h3-0-257" class="d">-        if let StatementResult::Query { rows, .. } = self {
</a><a href="#h3-0-258" id="h3-0-258" class="d">-            Ok(Box::new(rows.into_iter().map(Ok)))
</a><a href="#h3-0-259" id="h3-0-259" class="d">-        } else {
</a><a href="#h3-0-260" id="h3-0-260" class="d">-            errdata!(&quot;not a query result: {self:?}&quot;)
</a><a href="#h3-0-261" id="h3-0-261" class="d">-        }
</a><a href="#h3-0-262" id="h3-0-262" class="i">+/// Converts a query result into a row iterator.
</a><a href="#h3-0-263" id="h3-0-263" class="i">+impl TryFrom&lt;StatementResult&gt; for Rows {
</a><a href="#h3-0-264" id="h3-0-264" class="i">+    type Error = Error;
</a><a href="#h3-0-265" id="h3-0-265" class="i">+
</a><a href="#h3-0-266" id="h3-0-266" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-267" id="h3-0-267" class="i">+        let StatementResult::Select { rows, .. } = result else {
</a><a href="#h3-0-268" id="h3-0-268" class="i">+            return errdata!(&quot;expected select result, found {result:?}&quot;);
</a><a href="#h3-0-269" id="h3-0-269" class="i">+        };
</a><a href="#h3-0-270" id="h3-0-270" class="i">+        Ok(Box::new(rows.into_iter().map(Ok)))
</a>     }
<a href="#h3-0-272" id="h3-0-272" class="i">+}
</a><a href="#h3-0-273" id="h3-0-273" class="i">+
</a><a href="#h3-0-274" id="h3-0-274" class="i">+/// Extracts the first row from a query result.
</a><a href="#h3-0-275" id="h3-0-275" class="i">+impl TryFrom&lt;StatementResult&gt; for Row {
</a><a href="#h3-0-276" id="h3-0-276" class="i">+    type Error = Error;
</a> 
<a href="#h3-0-278" id="h3-0-278" class="d">-    /// Converts the ResultSet into a value, if possible.
</a><a href="#h3-0-279" id="h3-0-279" class="d">-    /// TODO: use TryFrom for this, also to primitive types via Value as TryFrom.
</a><a href="#h3-0-280" id="h3-0-280" class="d">-    pub fn into_value(self) -&gt; Result&lt;Value&gt; {
</a><a href="#h3-0-281" id="h3-0-281" class="d">-        self.into_row()?.into_iter().next().ok_or(errdata!(&quot;no value returned&quot;))
</a><a href="#h3-0-282" id="h3-0-282" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-283" id="h3-0-283" class="i">+        let mut rows: Rows = result.try_into()?;
</a><a href="#h3-0-284" id="h3-0-284" class="i">+        rows.next().transpose()?.ok_or(errdata!(&quot;no rows returned&quot;))
</a>     }
 }
 
<a href="#h3-0-288" id="h3-0-288" class="d">-// TODO: remove or revisit this.
</a><a href="#h3-0-289" id="h3-0-289" class="d">-impl TryFrom&lt;ExecutionResult&gt; for StatementResult {
</a><a href="#h3-0-290" id="h3-0-290" class="i">+/// Extracts the value of the first field in the first row.
</a><a href="#h3-0-291" id="h3-0-291" class="i">+impl TryFrom&lt;StatementResult&gt; for Value {
</a>     type Error = Error;
 
<a href="#h3-0-294" id="h3-0-294" class="d">-    fn try_from(result: ExecutionResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-295" id="h3-0-295" class="d">-        Ok(match result {
</a><a href="#h3-0-296" id="h3-0-296" class="d">-            ExecutionResult::CreateTable { name } =&gt; StatementResult::CreateTable { name },
</a><a href="#h3-0-297" id="h3-0-297" class="d">-            ExecutionResult::DropTable { name, existed } =&gt; {
</a><a href="#h3-0-298" id="h3-0-298" class="d">-                StatementResult::DropTable { name, existed }
</a><a href="#h3-0-299" id="h3-0-299" class="d">-            }
</a><a href="#h3-0-300" id="h3-0-300" class="d">-            ExecutionResult::Delete { count } =&gt; StatementResult::Delete { count },
</a><a href="#h3-0-301" id="h3-0-301" class="d">-            ExecutionResult::Insert { count } =&gt; StatementResult::Create { count },
</a><a href="#h3-0-302" id="h3-0-302" class="d">-            ExecutionResult::Select { iter } =&gt; StatementResult::Query {
</a><a href="#h3-0-303" id="h3-0-303" class="d">-                columns: iter.columns,
</a><a href="#h3-0-304" id="h3-0-304" class="d">-                rows: iter.rows.collect::&lt;Result&lt;_&gt;&gt;()?,
</a><a href="#h3-0-305" id="h3-0-305" class="d">-            },
</a><a href="#h3-0-306" id="h3-0-306" class="d">-            ExecutionResult::Update { count } =&gt; StatementResult::Update { count },
</a><a href="#h3-0-307" id="h3-0-307" class="d">-        })
</a><a href="#h3-0-308" id="h3-0-308" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-309" id="h3-0-309" class="i">+        let row: Row = result.try_into()?;
</a><a href="#h3-0-310" id="h3-0-310" class="i">+        row.into_iter().next().ok_or(errdata!(&quot;no fields returned&quot;))
</a><a href="#h3-0-311" id="h3-0-311" class="i">+    }
</a><a href="#h3-0-312" id="h3-0-312" class="i">+}
</a><a href="#h3-0-313" id="h3-0-313" class="i">+
</a><a href="#h3-0-314" id="h3-0-314" class="i">+/// Extracts the first boolean value of the first field in the first row.
</a><a href="#h3-0-315" id="h3-0-315" class="i">+impl TryFrom&lt;StatementResult&gt; for bool {
</a><a href="#h3-0-316" id="h3-0-316" class="i">+    type Error = Error;
</a><a href="#h3-0-317" id="h3-0-317" class="i">+
</a><a href="#h3-0-318" id="h3-0-318" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-319" id="h3-0-319" class="i">+        let value: Value = result.try_into()?;
</a><a href="#h3-0-320" id="h3-0-320" class="i">+        value.try_into()
</a><a href="#h3-0-321" id="h3-0-321" class="i">+    }
</a><a href="#h3-0-322" id="h3-0-322" class="i">+}
</a><a href="#h3-0-323" id="h3-0-323" class="i">+
</a><a href="#h3-0-324" id="h3-0-324" class="i">+/// Extracts the first f64 value of the first field in the first row.
</a><a href="#h3-0-325" id="h3-0-325" class="i">+impl TryFrom&lt;StatementResult&gt; for f64 {
</a><a href="#h3-0-326" id="h3-0-326" class="i">+    type Error = Error;
</a><a href="#h3-0-327" id="h3-0-327" class="i">+
</a><a href="#h3-0-328" id="h3-0-328" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-329" id="h3-0-329" class="i">+        let value: Value = result.try_into()?;
</a><a href="#h3-0-330" id="h3-0-330" class="i">+        value.try_into()
</a><a href="#h3-0-331" id="h3-0-331" class="i">+    }
</a><a href="#h3-0-332" id="h3-0-332" class="i">+}
</a><a href="#h3-0-333" id="h3-0-333" class="i">+
</a><a href="#h3-0-334" id="h3-0-334" class="i">+/// Extracts the first i64 value of the first field in the first row.
</a><a href="#h3-0-335" id="h3-0-335" class="i">+impl TryFrom&lt;StatementResult&gt; for i64 {
</a><a href="#h3-0-336" id="h3-0-336" class="i">+    type Error = Error;
</a><a href="#h3-0-337" id="h3-0-337" class="i">+
</a><a href="#h3-0-338" id="h3-0-338" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-339" id="h3-0-339" class="i">+        let value: Value = result.try_into()?;
</a><a href="#h3-0-340" id="h3-0-340" class="i">+        value.try_into()
</a><a href="#h3-0-341" id="h3-0-341" class="i">+    }
</a><a href="#h3-0-342" id="h3-0-342" class="i">+}
</a><a href="#h3-0-343" id="h3-0-343" class="i">+
</a><a href="#h3-0-344" id="h3-0-344" class="i">+/// Extracts the first string value of the first field in the first row.
</a><a href="#h3-0-345" id="h3-0-345" class="i">+impl TryFrom&lt;StatementResult&gt; for String {
</a><a href="#h3-0-346" id="h3-0-346" class="i">+    type Error = Error;
</a><a href="#h3-0-347" id="h3-0-347" class="i">+
</a><a href="#h3-0-348" id="h3-0-348" class="i">+    fn try_from(result: StatementResult) -&gt; Result&lt;Self&gt; {
</a><a href="#h3-0-349" id="h3-0-349" class="i">+        let value: Value = result.try_into()?;
</a><a href="#h3-0-350" id="h3-0-350" class="i">+        value.try_into()
</a>     }
 }
<b>diff --git a/<a id="h4" href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a> b/<a href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -169,7 +169,7 @@ impl TryFrom&lt;Value&gt; for bool {
</a>     type Error = Error;
 
     fn try_from(value: Value) -&gt; Result&lt;Self&gt; {
<a href="#h4-0-3" id="h4-0-3" class="d">-        let Value::Boolean(b) = value else { return errdata!(&quot;not boolean: {value}&quot;) };
</a><a href="#h4-0-4" id="h4-0-4" class="i">+        let Value::Boolean(b) = value else { return errdata!(&quot;not a boolean: {value}&quot;) };
</a>         Ok(b)
     }
 }
<a href="#h4-1" id="h4-1" class="h">@@ -178,7 +178,7 @@ impl TryFrom&lt;Value&gt; for f64 {
</a>     type Error = Error;
 
     fn try_from(value: Value) -&gt; Result&lt;Self&gt; {
<a href="#h4-1-3" id="h4-1-3" class="d">-        let Value::Float(f) = value else { return errdata!(&quot;not float: {value}&quot;) };
</a><a href="#h4-1-4" id="h4-1-4" class="i">+        let Value::Float(f) = value else { return errdata!(&quot;not a float: {value}&quot;) };
</a>         Ok(f)
     }
 }
<a href="#h4-2" id="h4-2" class="h">@@ -187,7 +187,7 @@ impl TryFrom&lt;Value&gt; for i64 {
</a>     type Error = Error;
 
     fn try_from(value: Value) -&gt; Result&lt;Self&gt; {
<a href="#h4-2-3" id="h4-2-3" class="d">-        let Value::Integer(i) = value else { return errdata!(&quot;not integer: {value}&quot;) };
</a><a href="#h4-2-4" id="h4-2-4" class="i">+        let Value::Integer(i) = value else { return errdata!(&quot;not an integer: {value}&quot;) };
</a>         Ok(i)
     }
 }
<a href="#h4-3" id="h4-3" class="h">@@ -196,7 +196,7 @@ impl TryFrom&lt;Value&gt; for String {
</a>     type Error = Error;
 
     fn try_from(value: Value) -&gt; Result&lt;Self&gt; {
<a href="#h4-3-3" id="h4-3-3" class="d">-        let Value::String(s) = value else { return errdata!(&quot;not string: {value}&quot;) };
</a><a href="#h4-3-4" id="h4-3-4" class="i">+        let Value::String(s) = value else { return errdata!(&quot;not a string: {value}&quot;) };
</a>         Ok(s)
     }
 }
<b>diff --git a/<a id="h5" href="../file/tests/e2e/client.rs.html">tests/e2e/client.rs</a> b/<a href="../file/tests/e2e/client.rs.html">tests/e2e/client.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -159,7 +159,7 @@ fn execute() -&gt; Result&lt;()&gt; {
</a>     let result = c.execute(&quot;SELECT * FROM genres&quot;)?;
     assert_eq!(
         result,
<a href="#h5-0-3" id="h5-0-3" class="d">-        StatementResult::Query {
</a><a href="#h5-0-4" id="h5-0-4" class="i">+        StatementResult::Select {
</a>             columns: vec![Column { name: Some(&quot;id&quot;.into()) }, Column { name: Some(&quot;name&quot;.into()) }],
             rows: vec![
                 vec![Value::Integer(1), Value::String(&quot;Science Fiction&quot;.into())],
<a href="#h5-1" id="h5-1" class="h">@@ -172,7 +172,7 @@ fn execute() -&gt; Result&lt;()&gt; {
</a>     let result = c.execute(&quot;SELECT * FROM genres WHERE FALSE&quot;)?;
     assert_eq!(
         result,
<a href="#h5-1-3" id="h5-1-3" class="d">-        StatementResult::Query {
</a><a href="#h5-1-4" id="h5-1-4" class="i">+        StatementResult::Select {
</a>             columns: vec![Column { name: Some(&quot;id&quot;.into()) }, Column { name: Some(&quot;name&quot;.into()) }],
             rows: vec![],
         }
<a href="#h5-2" id="h5-2" class="h">@@ -190,7 +190,7 @@ fn execute() -&gt; Result&lt;()&gt; {
</a>     );
     assert_eq!(
         c.execute(&quot;INSERT INTO genres VALUES (9, &#39;Western&#39;)&quot;),
<a href="#h5-2-3" id="h5-2-3" class="d">-        Ok(StatementResult::Create { count: 1 }),
</a><a href="#h5-2-4" id="h5-2-4" class="i">+        Ok(StatementResult::Insert { count: 1 }),
</a>     );
     assert_eq!(
         c.execute(&quot;INSERT INTO x VALUES (9, &#39;Western&#39;)&quot;),
<b>diff --git a/<a id="h6" href="../file/tests/e2e/mod.rs.html">tests/e2e/mod.rs</a> b/<a href="../file/tests/e2e/mod.rs.html">tests/e2e/mod.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -16,7 +16,7 @@ use testcluster::TestCluster;
</a> /// TODO: get rid of these.
 fn assert_rows(result: toydb::StatementResult, expect: Vec&lt;toydb::sql::types::Row&gt;) {
     match result {
<a href="#h6-0-3" id="h6-0-3" class="d">-        toydb::StatementResult::Query { rows, .. } =&gt; {
</a><a href="#h6-0-4" id="h6-0-4" class="i">+        toydb::StatementResult::Select { rows, .. } =&gt; {
</a>             pretty_assertions::assert_eq!(rows, expect)
         }
         r =&gt; panic!(&quot;Unexpected result {:?}&quot;, r),
<b>diff --git a/<a id="h7" href="../file/tests/sql/expression.rs.html">tests/sql/expression.rs</a> b/<a href="../file/tests/sql/expression.rs.html">tests/sql/expression.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -6,7 +6,7 @@ use toydb::sql::types::Value;
</a> fn eval_expr(expr: &amp;str) -&gt; Result&lt;Value&gt; {
     let engine = super::setup(Vec::new())?;
     let mut session = engine.session();
<a href="#h7-0-3" id="h7-0-3" class="d">-    session.execute(&amp;format!(&quot;SELECT {}&quot;, expr))?.into_value()
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    session.execute(&amp;format!(&quot;SELECT {}&quot;, expr))?.try_into()
</a> }
 
 macro_rules! test_expr {
<b>diff --git a/<a id="h8" href="../file/tests/sql/mutation/insert_case.html">tests/sql/mutation/insert_case</a> b/<a href="../file/tests/sql/mutation/insert_case.html">tests/sql/mutation/insert_case</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO TeSt (ID, Name) VALUES (1, &#39;a&#39;)
<a href="#h8-0-1" id="h8-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h8-0-2" id="h8-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h9" href="../file/tests/sql/mutation/insert_expression.html">tests/sql/mutation/insert_expression</a> b/<a href="../file/tests/sql/mutation/insert_expression.html">tests/sql/mutation/insert_expression</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 1 + 2 * 3)
<a href="#h9-0-1" id="h9-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h9-0-2" id="h9-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h10" href="../file/tests/sql/mutation/insert_full.html">tests/sql/mutation/insert_full</a> b/<a href="../file/tests/sql/mutation/insert_full.html">tests/sql/mutation/insert_full</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 101)
<a href="#h10-0-1" id="h10-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h10-0-2" id="h10-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h11" href="../file/tests/sql/mutation/insert_full_multiple.html">tests/sql/mutation/insert_full_multiple</a> b/<a href="../file/tests/sql/mutation/insert_full_multiple.html">tests/sql/mutation/insert_full_multiple</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 101), (2, &#39;b&#39;, 102), (3, &#39;c&#39;, 103)
<a href="#h11-0-1" id="h11-0-1" class="d">-Result: Create { count: 3 }
</a><a href="#h11-0-2" id="h11-0-2" class="i">+Result: Insert { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h12" href="../file/tests/sql/mutation/insert_full_order.html">tests/sql/mutation/insert_full_order</a> b/<a href="../file/tests/sql/mutation/insert_full_order.html">tests/sql/mutation/insert_full_order</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (name, value, id) VALUES (&#39;a&#39;, 101, 1)
<a href="#h12-0-1" id="h12-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h12-0-2" id="h12-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h13" href="../file/tests/sql/mutation/insert_no_columns.html">tests/sql/mutation/insert_no_columns</a> b/<a href="../file/tests/sql/mutation/insert_no_columns.html">tests/sql/mutation/insert_no_columns</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 101)
<a href="#h13-0-1" id="h13-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h13-0-2" id="h13-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h14" href="../file/tests/sql/mutation/insert_no_columns_multiple.html">tests/sql/mutation/insert_no_columns_multiple</a> b/<a href="../file/tests/sql/mutation/insert_no_columns_multiple.html">tests/sql/mutation/insert_no_columns_multiple</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 101), (2, &#39;b&#39;, 102), (3, &#39;c&#39;, 103)
<a href="#h14-0-1" id="h14-0-1" class="d">-Result: Create { count: 3 }
</a><a href="#h14-0-2" id="h14-0-2" class="i">+Result: Insert { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h15" href="../file/tests/sql/mutation/insert_partial.html">tests/sql/mutation/insert_partial</a> b/<a href="../file/tests/sql/mutation/insert_partial.html">tests/sql/mutation/insert_partial</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;)
<a href="#h15-0-1" id="h15-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h15-0-2" id="h15-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h16" href="../file/tests/sql/mutation/insert_partial_vary.html">tests/sql/mutation/insert_partial_vary</a> b/<a href="../file/tests/sql/mutation/insert_partial_vary.html">tests/sql/mutation/insert_partial_vary</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 100), (2, &#39;b&#39;), (3)
<a href="#h16-0-1" id="h16-0-1" class="d">-Result: Create { count: 3 }
</a><a href="#h16-0-2" id="h16-0-2" class="i">+Result: Insert { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h17" href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a> b/<a href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -87,7 +87,7 @@ macro_rules! test_query {
</a>                 });
 
             match result {
<a href="#h17-0-3" id="h17-0-3" class="d">-                Ok(StatementResult::Query{columns, rows}) =&gt; {
</a><a href="#h17-0-4" id="h17-0-4" class="i">+                Ok(StatementResult::Select{columns, rows}) =&gt; {
</a>                     write!(f, &quot;Result:&quot;)?;
                     if !columns.is_empty() || !rows.is_empty() {
                         write!(f, &quot; {:?}\n&quot;, columns
<b>diff --git a/<a id="h18" href="../file/tests/sql/schema/insert_boolean_false.html">tests/sql/schema/insert_boolean_false</a> b/<a href="../file/tests/sql/schema/insert_boolean_false.html">tests/sql/schema/insert_boolean_false</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, FALSE)
<a href="#h18-0-1" id="h18-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h18-0-2" id="h18-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h19" href="../file/tests/sql/schema/insert_boolean_null.html">tests/sql/schema/insert_boolean_null</a> b/<a href="../file/tests/sql/schema/insert_boolean_null.html">tests/sql/schema/insert_boolean_null</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, NULL)
<a href="#h19-0-1" id="h19-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h19-0-2" id="h19-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h20" href="../file/tests/sql/schema/insert_boolean_true.html">tests/sql/schema/insert_boolean_true</a> b/<a href="../file/tests/sql/schema/insert_boolean_true.html">tests/sql/schema/insert_boolean_true</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, TRUE)
<a href="#h20-0-1" id="h20-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h20-0-2" id="h20-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h21" href="../file/tests/sql/schema/insert_default.html">tests/sql/schema/insert_default</a> b/<a href="../file/tests/sql/schema/insert_default.html">tests/sql/schema/insert_default</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults (id, required) VALUES (1, TRUE)
<a href="#h21-0-1" id="h21-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h21-0-2" id="h21-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h22" href="../file/tests/sql/schema/insert_default_override.html">tests/sql/schema/insert_default_override</a> b/<a href="../file/tests/sql/schema/insert_default_override.html">tests/sql/schema/insert_default_override</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE, TRUE, FALSE, 2.718, 3, &#39;bar&#39;)
<a href="#h22-0-1" id="h22-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h22-0-2" id="h22-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h23" href="../file/tests/sql/schema/insert_default_override_null.html">tests/sql/schema/insert_default_override_null</a> b/<a href="../file/tests/sql/schema/insert_default_override_null.html">tests/sql/schema/insert_default_override_null</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE, NULL, NULL, NULL, NULL, NULL)
<a href="#h23-0-1" id="h23-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h23-0-2" id="h23-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h24" href="../file/tests/sql/schema/insert_default_unnamed.html">tests/sql/schema/insert_default_unnamed</a> b/<a href="../file/tests/sql/schema/insert_default_unnamed.html">tests/sql/schema/insert_default_unnamed</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE)
<a href="#h24-0-1" id="h24-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h24-0-2" id="h24-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h25" href="../file/tests/sql/schema/insert_float.html">tests/sql/schema/insert_float</a> b/<a href="../file/tests/sql/schema/insert_float.html">tests/sql/schema/insert_float</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 3.14)
<a href="#h25-0-1" id="h25-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h25-0-2" id="h25-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h26" href="../file/tests/sql/schema/insert_float_infinity.html">tests/sql/schema/insert_float_infinity</a> b/<a href="../file/tests/sql/schema/insert_float_infinity.html">tests/sql/schema/insert_float_infinity</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, INFINITY)
<a href="#h26-0-1" id="h26-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h26-0-2" id="h26-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h27" href="../file/tests/sql/schema/insert_float_infinity_negative.html">tests/sql/schema/insert_float_infinity_negative</a> b/<a href="../file/tests/sql/schema/insert_float_infinity_negative.html">tests/sql/schema/insert_float_infinity_negative</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -INFINITY)
<a href="#h27-0-1" id="h27-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h27-0-2" id="h27-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h28" href="../file/tests/sql/schema/insert_float_max.html">tests/sql/schema/insert_float_max</a> b/<a href="../file/tests/sql/schema/insert_float_max.html">tests/sql/schema/insert_float_max</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e308)
<a href="#h28-0-1" id="h28-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h28-0-2" id="h28-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h29" href="../file/tests/sql/schema/insert_float_max_negative.html">tests/sql/schema/insert_float_max_negative</a> b/<a href="../file/tests/sql/schema/insert_float_max_negative.html">tests/sql/schema/insert_float_max_negative</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -1.23456789012345e308)
<a href="#h29-0-1" id="h29-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h29-0-2" id="h29-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h30" href="../file/tests/sql/schema/insert_float_min.html">tests/sql/schema/insert_float_min</a> b/<a href="../file/tests/sql/schema/insert_float_min.html">tests/sql/schema/insert_float_min</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e-307)
<a href="#h30-0-1" id="h30-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h30-0-2" id="h30-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h31" href="../file/tests/sql/schema/insert_float_min_negative.html">tests/sql/schema/insert_float_min_negative</a> b/<a href="../file/tests/sql/schema/insert_float_min_negative.html">tests/sql/schema/insert_float_min_negative</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -1.23456789012345e-307)
<a href="#h31-0-1" id="h31-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h31-0-2" id="h31-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h32" href="../file/tests/sql/schema/insert_float_min_round.html">tests/sql/schema/insert_float_min_round</a> b/<a href="../file/tests/sql/schema/insert_float_min_round.html">tests/sql/schema/insert_float_min_round</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e-323)
<a href="#h32-0-1" id="h32-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h32-0-2" id="h32-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h33" href="../file/tests/sql/schema/insert_float_nan.html">tests/sql/schema/insert_float_nan</a> b/<a href="../file/tests/sql/schema/insert_float_nan.html">tests/sql/schema/insert_float_nan</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, NAN)
<a href="#h33-0-1" id="h33-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h33-0-2" id="h33-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h34" href="../file/tests/sql/schema/insert_float_null.html">tests/sql/schema/insert_float_null</a> b/<a href="../file/tests/sql/schema/insert_float_null.html">tests/sql/schema/insert_float_null</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, NULL)
<a href="#h34-0-1" id="h34-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h34-0-2" id="h34-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h35" href="../file/tests/sql/schema/insert_index_exists.html">tests/sql/schema/insert_index_exists</a> b/<a href="../file/tests/sql/schema/insert_index_exists.html">tests/sql/schema/insert_index_exists</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (4, &#39;b&#39;, 104)
<a href="#h35-0-1" id="h35-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h35-0-2" id="h35-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE test (
<b>diff --git a/<a id="h36" href="../file/tests/sql/schema/insert_index_new.html">tests/sql/schema/insert_index_new</a> b/<a href="../file/tests/sql/schema/insert_index_new.html">tests/sql/schema/insert_index_new</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (4, &#39;c&#39;, 104)
<a href="#h36-0-1" id="h36-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h36-0-2" id="h36-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE test (
<b>diff --git a/<a id="h37" href="../file/tests/sql/schema/insert_index_null.html">tests/sql/schema/insert_index_null</a> b/<a href="../file/tests/sql/schema/insert_index_null.html">tests/sql/schema/insert_index_null</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (4, NULL, 104)
<a href="#h37-0-1" id="h37-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h37-0-2" id="h37-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE test (
<b>diff --git a/<a id="h38" href="../file/tests/sql/schema/insert_integer.html">tests/sql/schema/insert_integer</a> b/<a href="../file/tests/sql/schema/insert_integer.html">tests/sql/schema/insert_integer</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, 1)
<a href="#h38-0-1" id="h38-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h38-0-2" id="h38-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h39" href="../file/tests/sql/schema/insert_integer_max.html">tests/sql/schema/insert_integer_max</a> b/<a href="../file/tests/sql/schema/insert_integer_max.html">tests/sql/schema/insert_integer_max</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, 9223372036854775807)
<a href="#h39-0-1" id="h39-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h39-0-2" id="h39-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h40" href="../file/tests/sql/schema/insert_integer_min.html">tests/sql/schema/insert_integer_min</a> b/<a href="../file/tests/sql/schema/insert_integer_min.html">tests/sql/schema/insert_integer_min</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, -9223372036854775807)
<a href="#h40-0-1" id="h40-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h40-0-2" id="h40-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h41" href="../file/tests/sql/schema/insert_integer_null.html">tests/sql/schema/insert_integer_null</a> b/<a href="../file/tests/sql/schema/insert_integer_null.html">tests/sql/schema/insert_integer_null</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, NULL)
<a href="#h41-0-1" id="h41-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h41-0-2" id="h41-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h42" href="../file/tests/sql/schema/insert_nulls.html">tests/sql/schema/insert_nulls</a> b/<a href="../file/tests/sql/schema/insert_nulls.html">tests/sql/schema/insert_nulls</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, TRUE, NULL)
<a href="#h42-0-1" id="h42-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h42-0-2" id="h42-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE nulls (
<b>diff --git a/<a id="h43" href="../file/tests/sql/schema/insert_nulls_default.html">tests/sql/schema/insert_nulls_default</a> b/<a href="../file/tests/sql/schema/insert_nulls_default.html">tests/sql/schema/insert_nulls_default</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO nulls (id, &quot;null&quot;, not_null) VALUES (1, NULL, TRUE)
<a href="#h43-0-1" id="h43-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h43-0-2" id="h43-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE nulls (
<b>diff --git a/<a id="h44" href="../file/tests/sql/schema/insert_pk_boolean.html">tests/sql/schema/insert_pk_boolean</a> b/<a href="../file/tests/sql/schema/insert_pk_boolean.html">tests/sql/schema/insert_pk_boolean</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;boolean&quot; VALUES (TRUE)
<a href="#h44-0-1" id="h44-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h44-0-2" id="h44-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;boolean&quot; (
<b>diff --git a/<a id="h45" href="../file/tests/sql/schema/insert_pk_float.html">tests/sql/schema/insert_pk_float</a> b/<a href="../file/tests/sql/schema/insert_pk_float.html">tests/sql/schema/insert_pk_float</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (1.618)
<a href="#h45-0-1" id="h45-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h45-0-2" id="h45-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h46" href="../file/tests/sql/schema/insert_pk_float_negative.html">tests/sql/schema/insert_pk_float_negative</a> b/<a href="../file/tests/sql/schema/insert_pk_float_negative.html">tests/sql/schema/insert_pk_float_negative</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (-3.14)
<a href="#h46-0-1" id="h46-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h46-0-2" id="h46-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h47" href="../file/tests/sql/schema/insert_pk_float_zero.html">tests/sql/schema/insert_pk_float_zero</a> b/<a href="../file/tests/sql/schema/insert_pk_float_zero.html">tests/sql/schema/insert_pk_float_zero</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (0.0)
<a href="#h47-0-1" id="h47-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h47-0-2" id="h47-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h48" href="../file/tests/sql/schema/insert_pk_integer.html">tests/sql/schema/insert_pk_integer</a> b/<a href="../file/tests/sql/schema/insert_pk_integer.html">tests/sql/schema/insert_pk_integer</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (3)
<a href="#h48-0-1" id="h48-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h48-0-2" id="h48-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h49" href="../file/tests/sql/schema/insert_pk_integer_negative.html">tests/sql/schema/insert_pk_integer_negative</a> b/<a href="../file/tests/sql/schema/insert_pk_integer_negative.html">tests/sql/schema/insert_pk_integer_negative</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (-1)
<a href="#h49-0-1" id="h49-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h49-0-2" id="h49-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h50" href="../file/tests/sql/schema/insert_pk_integer_zero.html">tests/sql/schema/insert_pk_integer_zero</a> b/<a href="../file/tests/sql/schema/insert_pk_integer_zero.html">tests/sql/schema/insert_pk_integer_zero</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (0)
<a href="#h50-0-1" id="h50-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h50-0-2" id="h50-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h51" href="../file/tests/sql/schema/insert_pk_string.html">tests/sql/schema/insert_pk_string</a> b/<a href="../file/tests/sql/schema/insert_pk_string.html">tests/sql/schema/insert_pk_string</a></b>
<a href="#h51-0" id="h51-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;baz&#39;)
<a href="#h51-0-1" id="h51-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h51-0-2" id="h51-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h52" href="../file/tests/sql/schema/insert_pk_string_case.html">tests/sql/schema/insert_pk_string_case</a> b/<a href="../file/tests/sql/schema/insert_pk_string_case.html">tests/sql/schema/insert_pk_string_case</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;Foo&#39;)
<a href="#h52-0-1" id="h52-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h52-0-2" id="h52-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h53" href="../file/tests/sql/schema/insert_pk_string_empty.html">tests/sql/schema/insert_pk_string_empty</a> b/<a href="../file/tests/sql/schema/insert_pk_string_empty.html">tests/sql/schema/insert_pk_string_empty</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;&#39;)
<a href="#h53-0-1" id="h53-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h53-0-2" id="h53-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h54" href="../file/tests/sql/schema/insert_ref_boolean.html">tests/sql/schema/insert_ref_boolean</a> b/<a href="../file/tests/sql/schema/insert_ref_boolean.html">tests/sql/schema/insert_ref_boolean</a></b>
<a href="#h54-0" id="h54-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, TRUE)
<a href="#h54-0-1" id="h54-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h54-0-2" id="h54-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h55" href="../file/tests/sql/schema/insert_ref_boolean_null.html">tests/sql/schema/insert_ref_boolean_null</a> b/<a href="../file/tests/sql/schema/insert_ref_boolean_null.html">tests/sql/schema/insert_ref_boolean_null</a></b>
<a href="#h55-0" id="h55-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h55-0-1" id="h55-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h55-0-2" id="h55-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h56" href="../file/tests/sql/schema/insert_ref_float.html">tests/sql/schema/insert_ref_float</a> b/<a href="../file/tests/sql/schema/insert_ref_float.html">tests/sql/schema/insert_ref_float</a></b>
<a href="#h56-0" id="h56-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, 3.14)
<a href="#h56-0-1" id="h56-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h56-0-2" id="h56-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h57" href="../file/tests/sql/schema/insert_ref_float_null.html">tests/sql/schema/insert_ref_float_null</a> b/<a href="../file/tests/sql/schema/insert_ref_float_null.html">tests/sql/schema/insert_ref_float_null</a></b>
<a href="#h57-0" id="h57-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h57-0-1" id="h57-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h57-0-2" id="h57-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h58" href="../file/tests/sql/schema/insert_ref_integer.html">tests/sql/schema/insert_ref_integer</a> b/<a href="../file/tests/sql/schema/insert_ref_integer.html">tests/sql/schema/insert_ref_integer</a></b>
<a href="#h58-0" id="h58-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, 1)
<a href="#h58-0-1" id="h58-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h58-0-2" id="h58-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h59" href="../file/tests/sql/schema/insert_ref_integer_null.html">tests/sql/schema/insert_ref_integer_null</a> b/<a href="../file/tests/sql/schema/insert_ref_integer_null.html">tests/sql/schema/insert_ref_integer_null</a></b>
<a href="#h59-0" id="h59-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h59-0-1" id="h59-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h59-0-2" id="h59-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h60" href="../file/tests/sql/schema/insert_ref_self.html">tests/sql/schema/insert_ref_self</a> b/<a href="../file/tests/sql/schema/insert_ref_self.html">tests/sql/schema/insert_ref_self</a></b>
<a href="#h60-0" id="h60-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, 1, &#39;e&#39;)
<a href="#h60-0-1" id="h60-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h60-0-2" id="h60-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h61" href="../file/tests/sql/schema/insert_ref_self_null.html">tests/sql/schema/insert_ref_self_null</a> b/<a href="../file/tests/sql/schema/insert_ref_self_null.html">tests/sql/schema/insert_ref_self_null</a></b>
<a href="#h61-0" id="h61-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, NULL, &#39;e&#39;)
<a href="#h61-0-1" id="h61-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h61-0-2" id="h61-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h62" href="../file/tests/sql/schema/insert_ref_self_self.html">tests/sql/schema/insert_ref_self_self</a> b/<a href="../file/tests/sql/schema/insert_ref_self_self.html">tests/sql/schema/insert_ref_self_self</a></b>
<a href="#h62-0" id="h62-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, 5, &#39;e&#39;)
<a href="#h62-0-1" id="h62-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h62-0-2" id="h62-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h63" href="../file/tests/sql/schema/insert_ref_string.html">tests/sql/schema/insert_ref_string</a> b/<a href="../file/tests/sql/schema/insert_ref_string.html">tests/sql/schema/insert_ref_string</a></b>
<a href="#h63-0" id="h63-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, &#39;foo&#39;)
<a href="#h63-0-1" id="h63-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h63-0-2" id="h63-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h64" href="../file/tests/sql/schema/insert_ref_string_null.html">tests/sql/schema/insert_ref_string_null</a> b/<a href="../file/tests/sql/schema/insert_ref_string_null.html">tests/sql/schema/insert_ref_string_null</a></b>
<a href="#h64-0" id="h64-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h64-0-1" id="h64-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h64-0-2" id="h64-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h65" href="../file/tests/sql/schema/insert_string.html">tests/sql/schema/insert_string</a> b/<a href="../file/tests/sql/schema/insert_string.html">tests/sql/schema/insert_string</a></b>
<a href="#h65-0" id="h65-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;abc&#39;)
<a href="#h65-0-1" id="h65-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h65-0-2" id="h65-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h66" href="../file/tests/sql/schema/insert_string_empty.html">tests/sql/schema/insert_string_empty</a> b/<a href="../file/tests/sql/schema/insert_string_empty.html">tests/sql/schema/insert_string_empty</a></b>
<a href="#h66-0" id="h66-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;&#39;)
<a href="#h66-0-1" id="h66-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h66-0-2" id="h66-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h67" href="../file/tests/sql/schema/insert_string_null.html">tests/sql/schema/insert_string_null</a> b/<a href="../file/tests/sql/schema/insert_string_null.html">tests/sql/schema/insert_string_null</a></b>
<a href="#h67-0" id="h67-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, NULL)
<a href="#h67-0-1" id="h67-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h67-0-2" id="h67-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h68" href="../file/tests/sql/schema/insert_string_unicode.html">tests/sql/schema/insert_string_unicode</a> b/<a href="../file/tests/sql/schema/insert_string_unicode.html">tests/sql/schema/insert_string_unicode</a></b>
<a href="#h68-0" id="h68-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39; Hi! 👋&#39;)
<a href="#h68-0-1" id="h68-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h68-0-2" id="h68-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h69" href="../file/tests/sql/schema/insert_unique_boolean.html">tests/sql/schema/insert_unique_boolean</a> b/<a href="../file/tests/sql/schema/insert_unique_boolean.html">tests/sql/schema/insert_unique_boolean</a></b>
<a href="#h69-0" id="h69-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, FALSE)
<a href="#h69-0-1" id="h69-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h69-0-2" id="h69-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h70" href="../file/tests/sql/schema/insert_unique_float.html">tests/sql/schema/insert_unique_float</a> b/<a href="../file/tests/sql/schema/insert_unique_float.html">tests/sql/schema/insert_unique_float</a></b>
<a href="#h70-0" id="h70-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 2.718)
<a href="#h70-0-1" id="h70-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h70-0-2" id="h70-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h71" href="../file/tests/sql/schema/insert_unique_integer.html">tests/sql/schema/insert_unique_integer</a> b/<a href="../file/tests/sql/schema/insert_unique_integer.html">tests/sql/schema/insert_unique_integer</a></b>
<a href="#h71-0" id="h71-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 3)
<a href="#h71-0-1" id="h71-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h71-0-2" id="h71-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h72" href="../file/tests/sql/schema/insert_unique_nulls.html">tests/sql/schema/insert_unique_nulls</a> b/<a href="../file/tests/sql/schema/insert_unique_nulls.html">tests/sql/schema/insert_unique_nulls</a></b>
<a href="#h72-0" id="h72-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; VALUES (2, NULL, NULL, NULL, NULL)
<a href="#h72-0-1" id="h72-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h72-0-2" id="h72-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h73" href="../file/tests/sql/schema/insert_unique_string.html">tests/sql/schema/insert_unique_string</a> b/<a href="../file/tests/sql/schema/insert_unique_string.html">tests/sql/schema/insert_unique_string</a></b>
<a href="#h73-0" id="h73-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;bar&#39;)
<a href="#h73-0-1" id="h73-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h73-0-2" id="h73-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h74" href="../file/tests/sql/schema/insert_unique_string_case.html">tests/sql/schema/insert_unique_string_case</a> b/<a href="../file/tests/sql/schema/insert_unique_string_case.html">tests/sql/schema/insert_unique_string_case</a></b>
<a href="#h74-0" id="h74-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;Foo&#39;)
<a href="#h74-0-1" id="h74-0-1" class="d">-Result: Create { count: 1 }
</a><a href="#h74-0-2" id="h74-0-2" class="i">+Result: Insert { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
</pre>
</div>
</body>
</html>
