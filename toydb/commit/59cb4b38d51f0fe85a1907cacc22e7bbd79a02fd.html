<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: remove result set column type - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/59cb4b38d51f0fe85a1907cacc22e7bbd79a02fd.html">59cb4b38d51f0fe85a1907cacc22e7bbd79a02fd</a>
<b>parent</b> <a href="../commit/602ced7b23cedd8ba4109277a7519be94dce4ca1.html">602ced7b23cedd8ba4109277a7519be94dce4ca1</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Thu, 20 Jun 2024 14:48:35 +0200

sql: remove result set column type

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/bin/toysql.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/client.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/server.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/engine/engine.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/engine/local.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/engine/raft.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/engine/session.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/execution/aggregate.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/execution/execute.rs</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/sql/execution/schema.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/sql/execution/source.rs</a></td><td> | </td><td class="num">9</td><td><span class="i">++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">src/sql/execution/transform.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">src/sql/execution/write.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">src/sql/plan/plan.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">src/sql/plan/planner.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">src/sql/types/mod.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">src/sql/types/value.rs</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">tests/e2e/client.rs</a></td><td> | </td><td class="num">26</td><td><span class="i">++++++++++++</span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">tests/sql/query.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>19 files changed, 45 insertions(+), 62 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -203,7 +203,7 @@ Storage:   {keys} keys, {logical_size} MB logical, {nodes}x {disk_size} MB disk,
</a>                         &quot;{}&quot;,
                         columns
                             .iter()
<a href="#h0-0-3" id="h0-0-3" class="d">-                            .map(|c| c.name.as_deref().unwrap_or(&quot;?&quot;))
</a><a href="#h0-0-4" id="h0-0-4" class="i">+                            .map(|c| c.as_deref().unwrap_or(&quot;?&quot;))
</a>                             .collect::&lt;Vec&lt;_&gt;&gt;()
                             .join(&quot;|&quot;)
                     );
<b>diff --git a/<a id="h1" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -5,7 +5,7 @@ use crate::errdata;
</a> use crate::error::{Error, Result};
 use crate::server::{Request, Response, Status};
 use crate::sql::engine::StatementResult;
<a href="#h1-0-3" id="h1-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h1-0-4" id="h1-0-4" class="i">+use crate::sql::types::Table;
</a> 
 use rand::Rng;
 
<b>diff --git a/<a id="h2" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -3,8 +3,7 @@ use crate::error::{Error, Result};
</a> use crate::raft;
 use crate::sql;
 use crate::sql::engine::{Catalog as _, Engine as _, StatementResult};
<a href="#h2-0-3" id="h2-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h2-0-4" id="h2-0-4" class="d">-use crate::sql::types::Row;
</a><a href="#h2-0-5" id="h2-0-5" class="i">+use crate::sql::types::{Row, Table};
</a> use crate::storage;
 
 use crossbeam::channel::{Receiver, Sender};
<b>diff --git a/<a id="h3" href="../file/src/sql/engine/engine.rs.html">src/sql/engine/engine.rs</a> b/<a href="../file/src/sql/engine/engine.rs.html">src/sql/engine/engine.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -3,8 +3,7 @@
</a> use super::Session;
 use crate::errinput;
 use crate::error::Result;
<a href="#h3-0-3" id="h3-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h3-0-4" id="h3-0-4" class="d">-use crate::sql::types::{Expression, Row, Rows, Value};
</a><a href="#h3-0-5" id="h3-0-5" class="i">+use crate::sql::types::{Expression, Row, Rows, Table, Value};
</a> use crate::storage::mvcc;
 
 use std::collections::{HashMap, HashSet};
<b>diff --git a/<a id="h4" href="../file/src/sql/engine/local.rs.html">src/sql/engine/local.rs</a> b/<a href="../file/src/sql/engine/local.rs.html">src/sql/engine/local.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,8 +1,7 @@
</a> use super::Catalog;
 use crate::encoding::{self, Key as _, Value as _};
 use crate::error::Result;
<a href="#h4-0-3" id="h4-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h4-0-4" id="h4-0-4" class="d">-use crate::sql::types::{Expression, Row, Rows, Value};
</a><a href="#h4-0-5" id="h4-0-5" class="i">+use crate::sql::types::{Expression, Row, Rows, Table, Value};
</a> use crate::storage::{self, mvcc};
 use crate::{errdata, errinput};
 
<b>diff --git a/<a id="h5" href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a> b/<a href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -3,8 +3,7 @@ use crate::encoding::{self, bincode, Value as _};
</a> use crate::errdata;
 use crate::error::Result;
 use crate::raft;
<a href="#h5-0-3" id="h5-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h5-0-4" id="h5-0-4" class="d">-use crate::sql::types::{Expression, Row, Rows, Value};
</a><a href="#h5-0-5" id="h5-0-5" class="i">+use crate::sql::types::{Expression, Row, Rows, Table, Value};
</a> use crate::storage::{self, mvcc};
 
 use crossbeam::channel::Sender;
<b>diff --git a/<a id="h6" href="../file/src/sql/engine/session.rs.html">src/sql/engine/session.rs</a> b/<a href="../file/src/sql/engine/session.rs.html">src/sql/engine/session.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -4,7 +4,7 @@ use crate::error::{Error, Result};
</a> use crate::sql::execution::ExecutionResult;
 use crate::sql::parser::{ast, Parser};
 use crate::sql::plan::Plan;
<a href="#h6-0-3" id="h6-0-3" class="d">-use crate::sql::types::{Columns, Row, Rows, Value};
</a><a href="#h6-0-4" id="h6-0-4" class="i">+use crate::sql::types::{Row, Rows, Value};
</a> use crate::storage::mvcc;
 use crate::{errdata, errinput};
 
<a href="#h6-1" id="h6-1" class="h">@@ -140,7 +140,7 @@ pub enum StatementResult {
</a>     // For simplicity, we buffer and send the entire set of rows as a vector
     // instead of streaming them to the client. Streaming reads haven&#39;t been
     // implemented from Raft either, so they&#39;re buffered all the way through.
<a href="#h6-1-3" id="h6-1-3" class="d">-    Select { columns: Columns, rows: Vec&lt;Row&gt; },
</a><a href="#h6-1-4" id="h6-1-4" class="i">+    Select { columns: Vec&lt;Option&lt;String&gt;&gt;, rows: Vec&lt;Row&gt; },
</a> }
 
 /// Converts an execution result into a statement result.
<b>diff --git a/<a id="h7" href="../file/src/sql/execution/aggregate.rs.html">src/sql/execution/aggregate.rs</a> b/<a href="../file/src/sql/execution/aggregate.rs.html">src/sql/execution/aggregate.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,7 +1,7 @@
</a> use super::QueryIterator;
 use crate::error::Result;
 use crate::sql::plan::Aggregate;
<a href="#h7-0-3" id="h7-0-3" class="d">-use crate::sql::types::{Column, Value};
</a><a href="#h7-0-4" id="h7-0-4" class="i">+use crate::sql::types::Value;
</a> 
 use std::cmp::Ordering;
 use std::collections::HashMap;
<a href="#h7-1" id="h7-1" class="h">@@ -33,7 +33,7 @@ pub(super) fn aggregate(
</a>             .columns
             .into_iter()
             .enumerate()
<a href="#h7-1-3" id="h7-1-3" class="d">-            .map(|(i, c)| if i &lt; agg_count { Column { name: None } } else { c })
</a><a href="#h7-1-4" id="h7-1-4" class="i">+            .map(|(i, c)| if i &lt; agg_count { None } else { c })
</a>             .collect(),
         rows: Box::new(accumulators.into_iter().map(|(bucket, accs)| {
             Ok(accs.into_iter().map(|acc| acc.aggregate()).chain(bucket).collect())
<b>diff --git a/<a id="h8" href="../file/src/sql/execution/execute.rs.html">src/sql/execution/execute.rs</a> b/<a href="../file/src/sql/execution/execute.rs.html">src/sql/execution/execute.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -7,7 +7,7 @@ use super::write;
</a> use crate::error::Result;
 use crate::sql::engine::{Catalog, Transaction};
 use crate::sql::plan::{Node, Plan};
<a href="#h8-0-3" id="h8-0-3" class="d">-use crate::sql::types::{Columns, Row, Rows};
</a><a href="#h8-0-4" id="h8-0-4" class="i">+use crate::sql::types::{Row, Rows};
</a> 
 /// Executes a plan, returning an execution result.
 pub fn execute_plan(
<a href="#h8-1" id="h8-1" class="h">@@ -120,8 +120,9 @@ pub enum ExecutionResult {
</a> 
 /// A query result iterator, containing the columns and row iterator.
 pub struct QueryIterator {
<a href="#h8-1-3" id="h8-1-3" class="d">-    // TODO: use a different type here.
</a><a href="#h8-1-4" id="h8-1-4" class="d">-    pub columns: Columns,
</a><a href="#h8-1-5" id="h8-1-5" class="i">+    /// Column names.
</a><a href="#h8-1-6" id="h8-1-6" class="i">+    pub columns: Vec&lt;Option&lt;String&gt;&gt;,
</a><a href="#h8-1-7" id="h8-1-7" class="i">+    /// Row iterator.
</a>     pub rows: Rows,
 }
 
<a href="#h8-2" id="h8-2" class="h">@@ -135,7 +136,10 @@ impl Iterator for QueryIterator {
</a> 
 impl QueryIterator {
     /// Replaces the columns with the result of the closure.
<a href="#h8-2-3" id="h8-2-3" class="d">-    pub fn map_columns(mut self, f: impl FnOnce(Columns) -&gt; Columns) -&gt; Self {
</a><a href="#h8-2-4" id="h8-2-4" class="i">+    pub fn map_columns&lt;F&gt;(mut self, f: F) -&gt; Self
</a><a href="#h8-2-5" id="h8-2-5" class="i">+    where
</a><a href="#h8-2-6" id="h8-2-6" class="i">+        F: FnOnce(Vec&lt;Option&lt;String&gt;&gt;) -&gt; Vec&lt;Option&lt;String&gt;&gt;,
</a><a href="#h8-2-7" id="h8-2-7" class="i">+    {
</a>         self.columns = f(self.columns);
         self
     }
<b>diff --git a/<a id="h9" href="../file/src/sql/execution/schema.rs.html">src/sql/execution/schema.rs</a> b/<a href="../file/src/sql/execution/schema.rs.html">src/sql/execution/schema.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,6 +1,6 @@
</a> use crate::error::Result;
 use crate::sql::engine::Catalog;
<a href="#h9-0-2" id="h9-0-2" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h9-0-3" id="h9-0-3" class="i">+use crate::sql::types::Table;
</a> 
 // Creates a table (i.e. CREATE TABLE).
 pub(super) fn create_table(catalog: &amp;impl Catalog, schema: Table) -&gt; Result&lt;()&gt; {
<b>diff --git a/<a id="h10" href="../file/src/sql/execution/source.rs.html">src/sql/execution/source.rs</a> b/<a href="../file/src/sql/execution/source.rs.html">src/sql/execution/source.rs</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,8 +1,7 @@
</a> use super::QueryIterator;
 use crate::error::Result;
 use crate::sql::engine::Transaction;
<a href="#h10-0-3" id="h10-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h10-0-4" id="h10-0-4" class="d">-use crate::sql::types::{Column, Expression, Row, Value};
</a><a href="#h10-0-5" id="h10-0-5" class="i">+use crate::sql::types::{Expression, Row, Table, Value};
</a> 
 /// A table scan source.
 pub(super) fn scan(
<a href="#h10-1" id="h10-1" class="h">@@ -11,7 +10,7 @@ pub(super) fn scan(
</a>     filter: Option&lt;Expression&gt;,
 ) -&gt; Result&lt;QueryIterator&gt; {
     Ok(QueryIterator {
<a href="#h10-1-3" id="h10-1-3" class="d">-        columns: table.columns.into_iter().map(|c| Column { name: Some(c.name) }).collect(),
</a><a href="#h10-1-4" id="h10-1-4" class="i">+        columns: table.columns.into_iter().map(|c| Some(c.name)).collect(),
</a>         rows: Box::new(txn.scan(&amp;table.name, filter)?),
     })
 }
<a href="#h10-2" id="h10-2" class="h">@@ -23,7 +22,7 @@ pub(super) fn lookup_key(
</a>     keys: Vec&lt;Value&gt;,
 ) -&gt; Result&lt;QueryIterator&gt; {
     Ok(QueryIterator {
<a href="#h10-2-3" id="h10-2-3" class="d">-        columns: table.columns.iter().map(|c| Column { name: Some(c.name.clone()) }).collect(),
</a><a href="#h10-2-4" id="h10-2-4" class="i">+        columns: table.columns.into_iter().map(|c| Some(c.name)).collect(),
</a>         rows: Box::new(txn.get(&amp;table.name, &amp;keys)?.into_iter().map(Ok)),
     })
 }
<a href="#h10-3" id="h10-3" class="h">@@ -39,7 +38,7 @@ pub(super) fn lookup_index(
</a>     let rows = txn.get(&amp;table.name, &amp;pks)?;
 
     Ok(QueryIterator {
<a href="#h10-3-3" id="h10-3-3" class="d">-        columns: table.columns.iter().map(|c| Column { name: Some(c.name.clone()) }).collect(),
</a><a href="#h10-3-4" id="h10-3-4" class="i">+        columns: table.columns.into_iter().map(|c| Some(c.name)).collect(),
</a>         rows: Box::new(rows.into_iter().map(Ok)),
     })
 }
<b>diff --git a/<a id="h11" href="../file/src/sql/execution/transform.rs.html">src/sql/execution/transform.rs</a> b/<a href="../file/src/sql/execution/transform.rs.html">src/sql/execution/transform.rs</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -4,7 +4,7 @@ use super::QueryIterator;
</a> use crate::errinput;
 use crate::error::Result;
 use crate::sql::plan::Direction;
<a href="#h11-0-3" id="h11-0-3" class="d">-use crate::sql::types::{Column, Expression, Value};
</a><a href="#h11-0-4" id="h11-0-4" class="i">+use crate::sql::types::{Expression, Value};
</a> 
 /// Filters the input rows (i.e. WHERE).
 pub(super) fn filter(source: QueryIterator, predicate: Expression) -&gt; QueryIterator {
<a href="#h11-1" id="h11-1" class="h">@@ -81,11 +81,11 @@ pub(super) fn project(
</a>                 .enumerate()
                 .map(|(i, label)| {
                     if let Some(label) = label {
<a href="#h11-1-3" id="h11-1-3" class="d">-                        Column { name: Some(label) }
</a><a href="#h11-1-4" id="h11-1-4" class="i">+                        Some(label)
</a>                     } else if let Expression::Field(f, _) = &amp;expressions[i] {
                         columns.get(*f).cloned().expect(&quot;invalid field reference&quot;)
                     } else {
<a href="#h11-1-8" id="h11-1-8" class="d">-                        Column { name: None }
</a><a href="#h11-1-9" id="h11-1-9" class="i">+                        None
</a>                     }
                 })
                 .collect()
<b>diff --git a/<a id="h12" href="../file/src/sql/execution/write.rs.html">src/sql/execution/write.rs</a> b/<a href="../file/src/sql/execution/write.rs.html">src/sql/execution/write.rs</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -2,8 +2,7 @@ use super::QueryIterator;
</a> use crate::errinput;
 use crate::error::Result;
 use crate::sql::engine::Transaction;
<a href="#h12-0-3" id="h12-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h12-0-4" id="h12-0-4" class="d">-use crate::sql::types::{Expression, Row, Value};
</a><a href="#h12-0-5" id="h12-0-5" class="i">+use crate::sql::types::{Expression, Row, Table, Value};
</a> 
 /// Deletes rows, taking primary keys from the source (i.e. DELETE).
 /// Returns the number of rows deleted.
<b>diff --git a/<a id="h13" href="../file/src/sql/plan/plan.rs.html">src/sql/plan/plan.rs</a> b/<a href="../file/src/sql/plan/plan.rs.html">src/sql/plan/plan.rs</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -6,8 +6,7 @@ use crate::error::Result;
</a> use crate::sql::engine::{Catalog, Transaction};
 use crate::sql::execution::{self, ExecutionResult};
 use crate::sql::parser::ast;
<a href="#h13-0-3" id="h13-0-3" class="d">-use crate::sql::types::schema::Table;
</a><a href="#h13-0-4" id="h13-0-4" class="d">-use crate::sql::types::{Expression, Value};
</a><a href="#h13-0-5" id="h13-0-5" class="i">+use crate::sql::types::{Expression, Table, Value};
</a> 
 use serde::{Deserialize, Serialize};
 
<b>diff --git a/<a id="h14" href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a> b/<a href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,10 +1,9 @@
</a> use super::super::parser::ast;
<a href="#h14-0-1" id="h14-0-1" class="d">-use super::super::types::schema::{Column, Table};
</a><a href="#h14-0-2" id="h14-0-2" class="d">-use super::super::types::{Expression, Value};
</a> use super::{plan::Node, plan::Plan, Aggregate, Direction};
 use crate::errinput;
 use crate::error::Result;
 use crate::sql::engine::Catalog;
<a href="#h14-0-7" id="h14-0-7" class="i">+use crate::sql::types::{Column, Expression, Table, Value};
</a> 
 use std::collections::{HashMap, HashSet};
 use std::mem::replace;
<b>diff --git a/<a id="h15" href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a> b/<a href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -1,7 +1,7 @@
</a> mod expression;
<a href="#h15-0-1" id="h15-0-1" class="d">-// TODO: import schema types here once e.g. Column conflicts are resolved.
</a><a href="#h15-0-2" id="h15-0-2" class="d">-pub mod schema;
</a><a href="#h15-0-3" id="h15-0-3" class="i">+mod schema;
</a> mod value;
 
 pub use expression::Expression;
<a href="#h15-0-7" id="h15-0-7" class="d">-pub use value::{Column, Columns, DataType, Row, Rows, Value};
</a><a href="#h15-0-8" id="h15-0-8" class="i">+pub use schema::{Column, Table};
</a><a href="#h15-0-9" id="h15-0-9" class="i">+pub use value::{DataType, Row, Rows, Value};
</a><b>diff --git a/<a id="h16" href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a> b/<a href="../file/src/sql/types/value.rs.html">src/sql/types/value.rs</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -221,14 +221,3 @@ pub type Row = Vec&lt;Value&gt;;
</a> ///
 /// TODO: try to avoid boxing here.
 pub type Rows = Box&lt;dyn Iterator&lt;Item = Result&lt;Row&gt;&gt;&gt;;
<a href="#h16-0-3" id="h16-0-3" class="d">-
</a><a href="#h16-0-4" id="h16-0-4" class="d">-/// A column (in a result set, see schema::Column for table columns).
</a><a href="#h16-0-5" id="h16-0-5" class="d">-///
</a><a href="#h16-0-6" id="h16-0-6" class="d">-/// TODO: revisit column handling in result sets.
</a><a href="#h16-0-7" id="h16-0-7" class="d">-#[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
</a><a href="#h16-0-8" id="h16-0-8" class="d">-pub struct Column {
</a><a href="#h16-0-9" id="h16-0-9" class="d">-    pub name: Option&lt;String&gt;,
</a><a href="#h16-0-10" id="h16-0-10" class="d">-}
</a><a href="#h16-0-11" id="h16-0-11" class="d">-
</a><a href="#h16-0-12" id="h16-0-12" class="d">-/// A set of columns.
</a><a href="#h16-0-13" id="h16-0-13" class="d">-pub type Columns = Vec&lt;Column&gt;;
</a><b>diff --git a/<a id="h17" href="../file/tests/e2e/client.rs.html">tests/e2e/client.rs</a> b/<a href="../file/tests/e2e/client.rs.html">tests/e2e/client.rs</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -4,9 +4,7 @@ use toydb::error::{Error, Result};
</a> use toydb::raft;
 use toydb::server::Status;
 use toydb::sql::engine::StatementResult;
<a href="#h17-0-3" id="h17-0-3" class="d">-use toydb::sql::types::schema;
</a><a href="#h17-0-4" id="h17-0-4" class="d">-use toydb::sql::types::{Column, DataType, Value};
</a><a href="#h17-0-5" id="h17-0-5" class="d">-use toydb::storage;
</a><a href="#h17-0-6" id="h17-0-6" class="i">+use toydb::sql::types::{Column, DataType, Table, Value};
</a> use toydb::storage::{engine, mvcc};
 
 use pretty_assertions::assert_eq;
<a href="#h17-1" id="h17-1" class="h">@@ -24,11 +22,11 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>     );
     assert_eq!(
         c.get_table(&quot;movies&quot;)?,
<a href="#h17-1-3" id="h17-1-3" class="d">-        schema::Table {
</a><a href="#h17-1-4" id="h17-1-4" class="i">+        Table {
</a>             name: &quot;movies&quot;.into(),
             primary_key: 0,
             columns: vec![
<a href="#h17-1-8" id="h17-1-8" class="d">-                schema::Column {
</a><a href="#h17-1-9" id="h17-1-9" class="i">+                Column {
</a>                     name: &quot;id&quot;.into(),
                     datatype: DataType::Integer,
                     nullable: false,
<a href="#h17-2" id="h17-2" class="h">@@ -37,7 +35,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: false,
                     references: None,
                 },
<a href="#h17-2-3" id="h17-2-3" class="d">-                schema::Column {
</a><a href="#h17-2-4" id="h17-2-4" class="i">+                Column {
</a>                     name: &quot;title&quot;.into(),
                     datatype: DataType::String,
                     nullable: false,
<a href="#h17-3" id="h17-3" class="h">@@ -46,7 +44,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: false,
                     references: None,
                 },
<a href="#h17-3-3" id="h17-3-3" class="d">-                schema::Column {
</a><a href="#h17-3-4" id="h17-3-4" class="i">+                Column {
</a>                     name: &quot;studio_id&quot;.into(),
                     datatype: DataType::Integer,
                     nullable: false,
<a href="#h17-4" id="h17-4" class="h">@@ -55,7 +53,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: true,
                     references: Some(&quot;studios&quot;.into()),
                 },
<a href="#h17-4-3" id="h17-4-3" class="d">-                schema::Column {
</a><a href="#h17-4-4" id="h17-4-4" class="i">+                Column {
</a>                     name: &quot;genre_id&quot;.into(),
                     datatype: DataType::Integer,
                     nullable: false,
<a href="#h17-5" id="h17-5" class="h">@@ -64,7 +62,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: true,
                     references: Some(&quot;genres&quot;.into()),
                 },
<a href="#h17-5-3" id="h17-5-3" class="d">-                schema::Column {
</a><a href="#h17-5-4" id="h17-5-4" class="i">+                Column {
</a>                     name: &quot;released&quot;.into(),
                     datatype: DataType::Integer,
                     nullable: false,
<a href="#h17-6" id="h17-6" class="h">@@ -73,7 +71,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: false,
                     references: None,
                 },
<a href="#h17-6-3" id="h17-6-3" class="d">-                schema::Column {
</a><a href="#h17-6-4" id="h17-6-4" class="i">+                Column {
</a>                     name: &quot;rating&quot;.into(),
                     datatype: DataType::Float,
                     nullable: true,
<a href="#h17-7" id="h17-7" class="h">@@ -82,7 +80,7 @@ fn get_table() -&gt; Result&lt;()&gt; {
</a>                     index: false,
                     references: None,
                 },
<a href="#h17-7-3" id="h17-7-3" class="d">-                schema::Column {
</a><a href="#h17-7-4" id="h17-7-4" class="i">+                Column {
</a>                     name: &quot;ultrahd&quot;.into(),
                     datatype: DataType::Boolean,
                     nullable: true,
<a href="#h17-8" id="h17-8" class="h">@@ -123,7 +121,7 @@ fn status() -&gt; Result&lt;()&gt; {
</a>                 match_index: [(1, 11)].into(),
                 commit_index: 11,
                 applied_index: 11,
<a href="#h17-8-3" id="h17-8-3" class="d">-                storage: storage::engine::Status {
</a><a href="#h17-8-4" id="h17-8-4" class="i">+                storage: engine::Status {
</a>                     name: &quot;bitcask&quot;.to_string(),
                     keys: 13,
                     size: 952,
<a href="#h17-9" id="h17-9" class="h">@@ -160,7 +158,7 @@ fn execute() -&gt; Result&lt;()&gt; {
</a>     assert_eq!(
         result,
         StatementResult::Select {
<a href="#h17-9-3" id="h17-9-3" class="d">-            columns: vec![Column { name: Some(&quot;id&quot;.into()) }, Column { name: Some(&quot;name&quot;.into()) }],
</a><a href="#h17-9-4" id="h17-9-4" class="i">+            columns: vec![Some(&quot;id&quot;.into()), Some(&quot;name&quot;.into())],
</a>             rows: vec![
                 vec![Value::Integer(1), Value::String(&quot;Science Fiction&quot;.into())],
                 vec![Value::Integer(2), Value::String(&quot;Action&quot;.into())],
<a href="#h17-10" id="h17-10" class="h">@@ -173,7 +171,7 @@ fn execute() -&gt; Result&lt;()&gt; {
</a>     assert_eq!(
         result,
         StatementResult::Select {
<a href="#h17-10-3" id="h17-10-3" class="d">-            columns: vec![Column { name: Some(&quot;id&quot;.into()) }, Column { name: Some(&quot;name&quot;.into()) }],
</a><a href="#h17-10-4" id="h17-10-4" class="i">+            columns: vec![Some(&quot;id&quot;.into()), Some(&quot;name&quot;.into())],
</a>             rows: vec![],
         }
     );
<b>diff --git a/<a id="h18" href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a> b/<a href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -92,7 +92,7 @@ macro_rules! test_query {
</a>                     if !columns.is_empty() || !rows.is_empty() {
                         write!(f, &quot; {:?}\n&quot;, columns
                             .into_iter()
<a href="#h18-0-3" id="h18-0-3" class="d">-                            .map(|c| c.name.unwrap_or_else(|| &quot;?&quot;.to_string()))
</a><a href="#h18-0-4" id="h18-0-4" class="i">+                            .map(|c| c.unwrap_or_else(|| &quot;?&quot;.to_string()))
</a>                             .collect::&lt;Vec&lt;_&gt;&gt;())?;
                         for row in rows {
                             write!(f, &quot;{:?}\n&quot;, row)?;
</pre>
</div>
</body>
</html>
