<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: resolve fields during planning (fixes #21) - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/2703a5a7ab64f58cdbb42175bb945314c377cff9.html">2703a5a7ab64f58cdbb42175bb945314c377cff9</a>
<b>parent</b> <a href="../commit/fe8e2fb5ffeead59ae39c21d9a181f2623aad5ae.html">fe8e2fb5ffeead59ae39c21d9a181f2623aad5ae</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat, 30 May 2020 17:38:28 +0200

sql: resolve fields during planning (fixes #21)

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/bin/toysql.rs</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/client.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/server.rs</a></td><td> | </td><td class="num">9</td><td><span class="i">++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/engine/kv.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/engine/mod.rs</a></td><td> | </td><td class="num">13</td><td><span class="i">++++++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/execution/aggregation.rs</a></td><td> | </td><td class="num">41</td><td><span class="i">+++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/execution/delete.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/execution/filter.rs</a></td><td> | </td><td class="num">22</td><td><span class="i">+++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/execution/index_lookup.rs</a></td><td> | </td><td class="num">16</td><td><span class="i">+++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/sql/execution/insert.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/sql/execution/key_lookup.rs</a></td><td> | </td><td class="num">16</td><td><span class="i">+++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">src/sql/execution/limit.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">src/sql/execution/mod.rs</a></td><td> | </td><td class="num">173</td><td><span class="i">++++++++++++++++++++++</span><span class="d">---------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">src/sql/execution/nested_loop_join.rs</a></td><td> | </td><td class="num">60</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d">--------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">src/sql/execution/nothing.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">+++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">src/sql/execution/offset.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">src/sql/execution/order.rs</a></td><td> | </td><td class="num">74</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">src/sql/execution/projection.rs</a></td><td> | </td><td class="num">63</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">-------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">src/sql/execution/scan.rs</a></td><td> | </td><td class="num">27</td><td><span class="i">+++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">src/sql/execution/update.rs</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">src/sql/parser/ast.rs</a></td><td> | </td><td class="num">107</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">src/sql/plan/mod.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++</span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">src/sql/plan/optimizer.rs</a></td><td> | </td><td class="num">60</td><td><span class="i">+++++++++++++++++++</span><span class="d">-----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">src/sql/plan/planner.rs</a></td><td> | </td><td class="num">770</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">src/sql/schema.rs</a></td><td> | </td><td class="num">12</td><td><span class="i">+</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">src/sql/types/expression.rs</a></td><td> | </td><td class="num">240</td><td><span class="i">+++++++++++++++++++++++++</span><span class="d">------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">src/sql/types/mod.rs</a></td><td> | </td><td class="num">47</td><td><span class="i">++</span><span class="d">---------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">tests/client/mod.rs</a></td><td> | </td><td class="num">26</td><td><span class="i">+++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">tests/sql/expression.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">tests/sql/query.rs</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">tests/sql/query/agg_boolean</a></td><td> | </td><td class="num">142</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">tests/sql/query/agg_boolean_null</a></td><td> | </td><td class="num">124</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">tests/sql/query/agg_const</a></td><td> | </td><td class="num">30</td><td><span class="i">++++++++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">tests/sql/query/agg_const_from</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">tests/sql/query/agg_count_star</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">tests/sql/query/agg_expr</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">tests/sql/query/agg_float</a></td><td> | </td><td class="num">142</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">tests/sql/query/agg_float_null</a></td><td> | </td><td class="num">124</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">tests/sql/query/agg_integer</a></td><td> | </td><td class="num">142</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">tests/sql/query/agg_integer_null</a></td><td> | </td><td class="num">124</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">tests/sql/query/agg_nested</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">tests/sql/query/agg_norows</a></td><td> | </td><td class="num">124</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">tests/sql/query/agg_norows_group</a></td><td> | </td><td class="num">142</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">tests/sql/query/agg_string</a></td><td> | </td><td class="num">142</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">tests/sql/query/agg_string_null</a></td><td> | </td><td class="num">124</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">tests/sql/query/agg_ungrouped</a></td><td> | </td><td class="num">86</td><td><span class="i">++</span><span class="d">-----------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">tests/sql/query/all</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">tests/sql/query/as_</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">tests/sql/query/expr_dynamic</a></td><td> | </td><td class="num">62</td><td><span class="i">++</span><span class="d">------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h49">tests/sql/query/expr_mixed</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h50">tests/sql/query/field_aliased</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h51">tests/sql/query/field_ambiguous</a></td><td> | </td><td class="num">64</td><td><span class="i">++</span><span class="d">--------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h52">tests/sql/query/field_multi</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h53">tests/sql/query/field_qualified</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h54">tests/sql/query/field_qualified_multi</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h55">tests/sql/query/field_single</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h56">tests/sql/query/field_unknown</a></td><td> | </td><td class="num">44</td><td><span class="i">++</span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h57">tests/sql/query/field_unknown_aliased</a></td><td> | </td><td class="num">52</td><td><span class="i">++</span><span class="d">--------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h58">tests/sql/query/field_unknown_qualified</a></td><td> | </td><td class="num">48</td><td><span class="i">++</span><span class="d">----------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h59">tests/sql/query/field_unknown_table</a></td><td> | </td><td class="num">48</td><td><span class="i">++</span><span class="d">----------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h60">tests/sql/query/from_alias_duplicate</a></td><td> | </td><td class="num">35</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h61">tests/sql/query/from_alias_duplicate_join</a></td><td> | </td><td class="num">45</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h62">tests/sql/query/from_duplicate</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h63">tests/sql/query/from_multiple</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h64">tests/sql/query/from_unknown</a></td><td> | </td><td class="num">22</td><td><span class="i">++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h65">tests/sql/query/group_expr</a></td><td> | </td><td class="num">64</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h66">tests/sql/query/group_expr_aggr</a></td><td> | </td><td class="num">74</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h67">tests/sql/query/group_expr_aggr_nogroupref</a></td><td> | </td><td class="num">166</td><td><span class="i">+</span><span class="d">------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h68">tests/sql/query/group_expr_aggr_selfref</a></td><td> | </td><td class="num">92</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h69">tests/sql/query/group_expr_aliased</a></td><td> | </td><td class="num">70</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h70">tests/sql/query/group_expr_both</a></td><td> | </td><td class="num">70</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h71">tests/sql/query/group_expr_extended</a></td><td> | </td><td class="num">162</td><td><span class="i">+</span><span class="d">------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h72">tests/sql/query/group_expr_multigroup</a></td><td> | </td><td class="num">136</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h73">tests/sql/query/group_expr_select</a></td><td> | </td><td class="num">82</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h74">tests/sql/query/group_join</a></td><td> | </td><td class="num">100</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h75">tests/sql/query/group_noaggregate</a></td><td> | </td><td class="num">94</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h76">tests/sql/query/group_noselect</a></td><td> | </td><td class="num">64</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h77">tests/sql/query/group_order_agg</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h78">tests/sql/query/group_simple</a></td><td> | </td><td class="num">68</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h79">tests/sql/query/group_unknown</a></td><td> | </td><td class="num">86</td><td><span class="i">++</span><span class="d">-----------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h80">tests/sql/query/having</a></td><td> | </td><td class="num">86</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h81">tests/sql/query/having_nogroup</a></td><td> | </td><td class="num">76</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h82">tests/sql/query/join_cross</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h83">tests/sql/query/join_cross_alias</a></td><td> | </td><td class="num">204</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h84">tests/sql/query/join_cross_multi</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h85">tests/sql/query/join_inner</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h86">tests/sql/query/join_inner_implicit</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h87">tests/sql/query/join_inner_multi</a></td><td> | </td><td class="num">138</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h88">tests/sql/query/join_inner_on_aliased</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h89">tests/sql/query/join_inner_on_false</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h90">tests/sql/query/join_inner_on_multi</a></td><td> | </td><td class="num">80</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h91">tests/sql/query/join_inner_on_true</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h92">tests/sql/query/join_inner_on_where</a></td><td> | </td><td class="num">80</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h93">tests/sql/query/join_left</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h94">tests/sql/query/join_left_outer</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h95">tests/sql/query/join_left_truncate</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h96">tests/sql/query/join_right</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h97">tests/sql/query/join_right_outer</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h98">tests/sql/query/join_right_truncate</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h99">tests/sql/query/limit</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h100">tests/sql/query/limit_dynamic</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h101">tests/sql/query/limit_expr</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h102">tests/sql/query/limit_large</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h103">tests/sql/query/limit_offset</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h104">tests/sql/query/limit_zero</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h105">tests/sql/query/offset</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h106">tests/sql/query/offset_dynamic</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h107">tests/sql/query/offset_expr</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h108">tests/sql/query/offset_large</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h109">tests/sql/query/offset_zero</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h110">tests/sql/query/order</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h111">tests/sql/query/order_asc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h112">tests/sql/query/order_asc_lowercase</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h113">tests/sql/query/order_boolean_asc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h114">tests/sql/query/order_boolean_desc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h115">tests/sql/query/order_desc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h116">tests/sql/query/order_desc_lowercase</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h117">tests/sql/query/order_expr</a></td><td> | </td><td class="num">94</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h118">tests/sql/query/order_field_aliased</a></td><td> | </td><td class="num">134</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h119">tests/sql/query/order_field_ambiguous</a></td><td> | </td><td class="num">95</td><td><span class="i">++</span><span class="d">-----------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h120">tests/sql/query/order_field_qualified</a></td><td> | </td><td class="num">134</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h121">tests/sql/query/order_field_unknown</a></td><td> | </td><td class="num">44</td><td><span class="i">++</span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h122">tests/sql/query/order_float_asc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h123">tests/sql/query/order_float_desc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h124">tests/sql/query/order_integer_asc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h125">tests/sql/query/order_integer_desc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h126">tests/sql/query/order_multi</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h127">tests/sql/query/order_string_asc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h128">tests/sql/query/order_string_desc</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h129">tests/sql/query/where_expr</a></td><td> | </td><td class="num">58</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h130">tests/sql/query/where_false</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h131">tests/sql/query/where_field_aliased_select</a></td><td> | </td><td class="num">175</td><td><span class="i">+</span><span class="d">------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h132">tests/sql/query/where_field_aliased_table</a></td><td> | </td><td class="num">106</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h133">tests/sql/query/where_field_ambiguous</a></td><td> | </td><td class="num">133</td><td><span class="i">++</span><span class="d">-----------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h134">tests/sql/query/where_field_qualified</a></td><td> | </td><td class="num">98</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h135">tests/sql/query/where_field_unknown</a></td><td> | </td><td class="num">33</td><td><span class="i">++</span><span class="d">-------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h136">tests/sql/query/where_float</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h137">tests/sql/query/where_index_lookup</a></td><td> | </td><td class="num">29</td><td><span class="i">++++++++++++++++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h138">tests/sql/query/where_integer</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h139">tests/sql/query/where_join_inner</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h140">tests/sql/query/where_null</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h141">tests/sql/query/where_primary_key</a></td><td> | </td><td class="num">11</td><td><span class="i">++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h142">tests/sql/query/where_string</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h143">tests/sql/query/where_true</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h144">tests/tests.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
</table></pre><pre>145 files changed, 4789 insertions(+), 3622 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -184,19 +184,18 @@ SQL txns:  {txns_active} active, {txns} total ({sql_storage} storage)
</a>             ResultSet::CreateTable { name } =&gt; println!(&quot;Created table {}&quot;, name),
             ResultSet::DropTable { name } =&gt; println!(&quot;Dropped table {}&quot;, name),
             ResultSet::Explain(plan) =&gt; println!(&quot;{:#?}&quot;, plan),
<a href="#h0-0-3" id="h0-0-3" class="d">-            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h0-0-4" id="h0-0-4" class="i">+            ResultSet::Query { columns, mut rows } =&gt; {
</a>                 if self.show_headers {
                     println!(
                         &quot;{}&quot;,
<a href="#h0-0-8" id="h0-0-8" class="d">-                        relation
</a><a href="#h0-0-9" id="h0-0-9" class="d">-                            .columns
</a><a href="#h0-0-10" id="h0-0-10" class="i">+                        columns
</a>                             .iter()
                             .map(|c| c.name.as_deref().unwrap_or(&quot;?&quot;))
                             .collect::&lt;Vec&lt;_&gt;&gt;()
                             .join(&quot;|&quot;)
                     );
                 }
<a href="#h0-0-17" id="h0-0-17" class="d">-                while let Some(row) = relation.next().transpose()? {
</a><a href="#h0-0-18" id="h0-0-18" class="i">+                while let Some(row) = rows.next().transpose()? {
</a>                     println!(
                         &quot;{}&quot;,
                         row.into_iter().map(|v| format!(&quot;{}&quot;, v)).collect::&lt;Vec&lt;_&gt;&gt;().join(&quot;|&quot;)
<b>diff --git a/<a id="h1" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -72,7 +72,7 @@ impl Client {
</a>                 Response::Execute(rs) =&gt; rs,
                 resp =&gt; return Err(Error::Internal(format!(&quot;Unexpected response {:?}&quot;, resp))),
             };
<a href="#h1-0-3" id="h1-0-3" class="d">-        if let ResultSet::Query { ref mut relation } = &amp;mut resultset {
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        if let ResultSet::Query { columns, .. } = resultset {
</a>             // FIXME We buffer rows for now to avoid lifetime hassles
             let mut rows = Vec::new();
             while let Some(result) = conn.try_next().await? {
<a href="#h1-1" id="h1-1" class="h">@@ -84,7 +84,7 @@ impl Client {
</a>                     }
                 }
             }
<a href="#h1-1-3" id="h1-1-3" class="d">-            relation.rows = Some(Box::new(rows.into_iter().map(Ok)));
</a><a href="#h1-1-4" id="h1-1-4" class="i">+            resultset = ResultSet::Query { columns, rows: Box::new(rows.into_iter().map(Ok)) }
</a>         };
         match &amp;resultset {
             ResultSet::Begin { id, mode } =&gt; self.txn.set(Some((*id, *mode))),
<b>diff --git a/<a id="h2" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -130,12 +130,11 @@ impl Session {
</a>             let mut response = tokio::task::block_in_place(|| self.request(request));
             let mut rows: Box&lt;dyn Iterator&lt;Item = Result&lt;Response&gt;&gt; + Send&gt; =
                 Box::new(std::iter::empty());
<a href="#h2-0-3" id="h2-0-3" class="d">-            if let Ok(Response::Execute(ResultSet::Query { ref mut relation })) = &amp;mut response {
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            if let Ok(Response::Execute(ResultSet::Query { rows: ref mut resultrows, .. })) =
</a><a href="#h2-0-5" id="h2-0-5" class="i">+                &amp;mut response
</a><a href="#h2-0-6" id="h2-0-6" class="i">+            {
</a>                 rows = Box::new(
<a href="#h2-0-8" id="h2-0-8" class="d">-                    relation
</a><a href="#h2-0-9" id="h2-0-9" class="d">-                        .rows
</a><a href="#h2-0-10" id="h2-0-10" class="d">-                        .take()
</a><a href="#h2-0-11" id="h2-0-11" class="d">-                        .unwrap_or_else(|| Box::new(std::iter::empty()))
</a><a href="#h2-0-12" id="h2-0-12" class="i">+                    std::mem::replace(resultrows, Box::new(std::iter::empty()))
</a>                         .map(|result| result.map(|row| Response::Row(Some(row))))
                         .chain(std::iter::once(Ok(Response::Row(None))))
                         .scan(false, |err_sent, response| match (&amp;err_sent, &amp;response) {
<b>diff --git a/<a id="h3" href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a> b/<a href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -181,7 +181,7 @@ impl super::Transaction for Transaction {
</a>                 .map(|r| r.and_then(|(_, v)| deserialize(&amp;v)))
                 .filter_map(move |r| match r {
                     Ok(row) =&gt; match &amp;filter {
<a href="#h3-0-3" id="h3-0-3" class="d">-                        Some(filter) =&gt; match filter.evaluate(&amp;table.row_env(&amp;row)) {
</a><a href="#h3-0-4" id="h3-0-4" class="i">+                        Some(filter) =&gt; match filter.evaluate(Some(&amp;row)) {
</a>                             Ok(Value::Boolean(b)) if b =&gt; Some(Ok(row)),
                             Ok(Value::Boolean(_)) | Ok(Value::Null) =&gt; None,
                             Ok(v) =&gt; Some(Err(Error::Value(format!(
<b>diff --git a/<a id="h4" href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a> b/<a href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -112,21 +112,24 @@ impl&lt;E: Engine + &#39;static&gt; Session&lt;E&gt; {
</a>                 Ok(result)
             }
             ast::Statement::Explain(statement) =&gt; self.with_txn(Mode::ReadOnly, |txn| {
<a href="#h4-0-3" id="h4-0-3" class="d">-                Ok(ResultSet::Explain(Plan::build(*statement)?.optimize(txn)?.0))
</a><a href="#h4-0-4" id="h4-0-4" class="i">+                Ok(ResultSet::Explain(Plan::build(*statement, txn)?.optimize(txn)?.0))
</a>             }),
<a href="#h4-0-6" id="h4-0-6" class="d">-            statement if self.txn.is_some() =&gt; Plan::build(statement)?
</a><a href="#h4-0-7" id="h4-0-7" class="i">+            statement if self.txn.is_some() =&gt; Plan::build(statement, self.txn.as_mut().unwrap())?
</a>                 .optimize(self.txn.as_mut().unwrap())?
                 .execute(Context { txn: self.txn.as_mut().unwrap() }),
             statement @ ast::Statement::Select { .. } =&gt; {
                 let mut txn = self.engine.begin(Mode::ReadOnly)?;
<a href="#h4-0-12" id="h4-0-12" class="d">-                let result =
</a><a href="#h4-0-13" id="h4-0-13" class="d">-                    Plan::build(statement)?.optimize(&amp;mut txn)?.execute(Context { txn: &amp;mut txn });
</a><a href="#h4-0-14" id="h4-0-14" class="i">+                let result = Plan::build(statement, &amp;mut txn)?
</a><a href="#h4-0-15" id="h4-0-15" class="i">+                    .optimize(&amp;mut txn)?
</a><a href="#h4-0-16" id="h4-0-16" class="i">+                    .execute(Context { txn: &amp;mut txn });
</a>                 txn.rollback()?;
                 result
             }
             statement =&gt; {
                 let mut txn = self.engine.begin(Mode::ReadWrite)?;
<a href="#h4-0-22" id="h4-0-22" class="d">-                match Plan::build(statement)?.optimize(&amp;mut txn)?.execute(Context { txn: &amp;mut txn })
</a><a href="#h4-0-23" id="h4-0-23" class="i">+                match Plan::build(statement, &amp;mut txn)?
</a><a href="#h4-0-24" id="h4-0-24" class="i">+                    .optimize(&amp;mut txn)?
</a><a href="#h4-0-25" id="h4-0-25" class="i">+                    .execute(Context { txn: &amp;mut txn })
</a>                 {
                     Ok(result) =&gt; {
                         txn.commit()?;
<b>diff --git a/<a id="h5" href="../file/src/sql/execution/aggregation.rs.html">src/sql/execution/aggregation.rs</a> b/<a href="../file/src/sql/execution/aggregation.rs.html">src/sql/execution/aggregation.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::plan::Aggregate;
<a href="#h5-0-2" id="h5-0-2" class="d">-use super::super::types::{Column, Relation, Value};
</a><a href="#h5-0-3" id="h5-0-3" class="i">+use super::super::types::{Column, Value};
</a> use super::{Context, Executor, ResultSet};
 use crate::error::{Error, Result};
 
<a href="#h5-1" id="h5-1" class="h">@@ -28,8 +28,8 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Aggregation&lt;T&gt; {
</a>     fn execute(mut self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         let agg_count = self.aggregates.len();
         match self.source.execute(ctx)? {
<a href="#h5-1-3" id="h5-1-3" class="d">-            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h5-1-4" id="h5-1-4" class="d">-                while let Some(mut row) = relation.next().transpose()? {
</a><a href="#h5-1-5" id="h5-1-5" class="i">+            ResultSet::Query { columns, mut rows } =&gt; {
</a><a href="#h5-1-6" id="h5-1-6" class="i">+                while let Some(mut row) = rows.next().transpose()? {
</a>                     self.accumulators
                         .entry(row.split_off(self.aggregates.len()))
                         .or_insert(
<a href="#h5-2" id="h5-2" class="h">@@ -41,36 +41,33 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Aggregation&lt;T&gt; {
</a>                 }
                 // If there were no rows and no group-by columns, return a row of empty accumulators:
                 // SELECT COUNT(*) FROM t WHERE FALSE
<a href="#h5-2-3" id="h5-2-3" class="d">-                if self.accumulators.is_empty() &amp;&amp; self.aggregates.len() == relation.columns.len() {
</a><a href="#h5-2-4" id="h5-2-4" class="i">+                if self.accumulators.is_empty() &amp;&amp; self.aggregates.len() == columns.len() {
</a>                     self.accumulators.insert(
                         Vec::new(),
                         self.aggregates.iter().map(|agg| Accumulator::from(agg)).collect(),
                     );
                 }
                 Ok(ResultSet::Query {
<a href="#h5-2-11" id="h5-2-11" class="d">-                    relation: Relation {
</a><a href="#h5-2-12" id="h5-2-12" class="d">-                        columns: relation
</a><a href="#h5-2-13" id="h5-2-13" class="d">-                            .columns
</a><a href="#h5-2-14" id="h5-2-14" class="d">-                            .into_iter()
</a><a href="#h5-2-15" id="h5-2-15" class="d">-                            .enumerate()
</a><a href="#h5-2-16" id="h5-2-16" class="d">-                            .map(|(i, c)| {
</a><a href="#h5-2-17" id="h5-2-17" class="i">+                    columns: columns
</a><a href="#h5-2-18" id="h5-2-18" class="i">+                        .into_iter()
</a><a href="#h5-2-19" id="h5-2-19" class="i">+                        .enumerate()
</a><a href="#h5-2-20" id="h5-2-20" class="i">+                        .map(
</a><a href="#h5-2-21" id="h5-2-21" class="i">+                            |(i, c)| {
</a>                                 if i &lt; agg_count {
<a href="#h5-2-23" id="h5-2-23" class="d">-                                    Column { relation: None, name: None }
</a><a href="#h5-2-24" id="h5-2-24" class="i">+                                    Column { table: None, name: None }
</a>                                 } else {
                                     c
                                 }
<a href="#h5-2-28" id="h5-2-28" class="d">-                            })
</a><a href="#h5-2-29" id="h5-2-29" class="d">-                            .collect(),
</a><a href="#h5-2-30" id="h5-2-30" class="d">-                        rows: Some(Box::new(self.accumulators.into_iter().map(
</a><a href="#h5-2-31" id="h5-2-31" class="d">-                            |(bucket, accs)| {
</a><a href="#h5-2-32" id="h5-2-32" class="d">-                                Ok(accs
</a><a href="#h5-2-33" id="h5-2-33" class="d">-                                    .into_iter()
</a><a href="#h5-2-34" id="h5-2-34" class="d">-                                    .map(|acc| acc.aggregate())
</a><a href="#h5-2-35" id="h5-2-35" class="d">-                                    .chain(bucket.into_iter())
</a><a href="#h5-2-36" id="h5-2-36" class="d">-                                    .collect())
</a>                             },
<a href="#h5-2-38" id="h5-2-38" class="d">-                        ))),
</a><a href="#h5-2-39" id="h5-2-39" class="d">-                    },
</a><a href="#h5-2-40" id="h5-2-40" class="i">+                        )
</a><a href="#h5-2-41" id="h5-2-41" class="i">+                        .collect(),
</a><a href="#h5-2-42" id="h5-2-42" class="i">+                    rows: Box::new(self.accumulators.into_iter().map(|(bucket, accs)| {
</a><a href="#h5-2-43" id="h5-2-43" class="i">+                        Ok(accs
</a><a href="#h5-2-44" id="h5-2-44" class="i">+                            .into_iter()
</a><a href="#h5-2-45" id="h5-2-45" class="i">+                            .map(|acc| acc.aggregate())
</a><a href="#h5-2-46" id="h5-2-46" class="i">+                            .chain(bucket.into_iter())
</a><a href="#h5-2-47" id="h5-2-47" class="i">+                            .collect())
</a><a href="#h5-2-48" id="h5-2-48" class="i">+                    })),
</a>                 })
             }
             r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
<b>diff --git a/<a id="h6" href="../file/src/sql/execution/delete.rs.html">src/sql/execution/delete.rs</a> b/<a href="../file/src/sql/execution/delete.rs.html">src/sql/execution/delete.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -21,8 +21,8 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Delete&lt;T&gt; {
</a>         let table = ctx.txn.must_read_table(&amp;self.table)?;
         let mut count = 0;
         match self.source.execute(ctx)? {
<a href="#h6-0-3" id="h6-0-3" class="d">-            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h6-0-4" id="h6-0-4" class="d">-                while let Some(row) = relation.next().transpose()? {
</a><a href="#h6-0-5" id="h6-0-5" class="i">+            ResultSet::Query { mut rows, .. } =&gt; {
</a><a href="#h6-0-6" id="h6-0-6" class="i">+                while let Some(row) = rows.next().transpose()? {
</a>                     ctx.txn.delete(&amp;table.name, &amp;table.get_row_key(&amp;row)?)?;
                     count += 1
                 }
<b>diff --git a/<a id="h7" href="../file/src/sql/execution/filter.rs.html">src/sql/execution/filter.rs</a> b/<a href="../file/src/sql/execution/filter.rs.html">src/sql/execution/filter.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,7 +1,7 @@
</a> use super::super::engine::Transaction;
 use super::super::types::Expression;
 use super::super::types::Value;
<a href="#h7-0-3" id="h7-0-3" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h7-0-4" id="h7-0-4" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::error::{Error, Result};
 
 /// A filter executor
<a href="#h7-1" id="h7-1" class="h">@@ -21,12 +21,12 @@ impl&lt;T: Transaction&gt; Filter&lt;T&gt; {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Filter&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         let result = self.source.execute(ctx)?;
<a href="#h7-1-3" id="h7-1-3" class="d">-        if let ResultSet::Query { mut relation } = result {
</a><a href="#h7-1-4" id="h7-1-4" class="d">-            if let Some(rows) = relation.rows {
</a><a href="#h7-1-5" id="h7-1-5" class="d">-                let columns = ResultColumns::from_new_columns(relation.columns.clone());
</a><a href="#h7-1-6" id="h7-1-6" class="d">-                let predicate = self.predicate;
</a><a href="#h7-1-7" id="h7-1-7" class="d">-                relation.rows = Some(Box::new(rows.filter_map(move |r| {
</a><a href="#h7-1-8" id="h7-1-8" class="d">-                    r.and_then(|row| match predicate.evaluate(&amp;columns.as_env(&amp;row))? {
</a><a href="#h7-1-9" id="h7-1-9" class="i">+        if let ResultSet::Query { columns, rows } = result {
</a><a href="#h7-1-10" id="h7-1-10" class="i">+            let predicate = self.predicate;
</a><a href="#h7-1-11" id="h7-1-11" class="i">+            Ok(ResultSet::Query {
</a><a href="#h7-1-12" id="h7-1-12" class="i">+                columns,
</a><a href="#h7-1-13" id="h7-1-13" class="i">+                rows: Box::new(rows.filter_map(move |r| {
</a><a href="#h7-1-14" id="h7-1-14" class="i">+                    r.and_then(|row| match predicate.evaluate(Some(&amp;row))? {
</a>                         Value::Boolean(true) =&gt; Ok(Some(row)),
                         Value::Boolean(false) =&gt; Ok(None),
                         Value::Null =&gt; Ok(None),
<a href="#h7-2" id="h7-2" class="h">@@ -36,10 +36,10 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Filter&lt;T&gt; {
</a>                         ))),
                     })
                     .transpose()
<a href="#h7-2-3" id="h7-2-3" class="d">-                })));
</a><a href="#h7-2-4" id="h7-2-4" class="d">-            }
</a><a href="#h7-2-5" id="h7-2-5" class="d">-            return Ok(ResultSet::Query { relation });
</a><a href="#h7-2-6" id="h7-2-6" class="i">+                })),
</a><a href="#h7-2-7" id="h7-2-7" class="i">+            })
</a><a href="#h7-2-8" id="h7-2-8" class="i">+        } else {
</a><a href="#h7-2-9" id="h7-2-9" class="i">+            Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>         }
<a href="#h7-2-11" id="h7-2-11" class="d">-        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h8" href="../file/src/sql/execution/index_lookup.rs.html">src/sql/execution/index_lookup.rs</a> b/<a href="../file/src/sql/execution/index_lookup.rs.html">src/sql/execution/index_lookup.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::engine::Transaction;
<a href="#h8-0-1" id="h8-0-1" class="d">-use super::super::types::{Column, Relation, Row, Value};
</a><a href="#h8-0-2" id="h8-0-2" class="i">+use super::super::types::{Column, Row, Value};
</a> use super::{Context, Executor, ResultSet};
 use crate::error::Result;
 
<a href="#h8-1" id="h8-1" class="h">@@ -46,14 +46,12 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for IndexLookup {
</a>             .collect::&lt;Result&lt;Vec&lt;Row&gt;&gt;&gt;()?;
 
         Ok(ResultSet::Query {
<a href="#h8-1-3" id="h8-1-3" class="d">-            relation: Relation {
</a><a href="#h8-1-4" id="h8-1-4" class="d">-                columns: table
</a><a href="#h8-1-5" id="h8-1-5" class="d">-                    .columns
</a><a href="#h8-1-6" id="h8-1-6" class="d">-                    .iter()
</a><a href="#h8-1-7" id="h8-1-7" class="d">-                    .map(|c| Column { relation: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h8-1-8" id="h8-1-8" class="d">-                    .collect(),
</a><a href="#h8-1-9" id="h8-1-9" class="d">-                rows: Some(Box::new(rows.into_iter().map(Ok))),
</a><a href="#h8-1-10" id="h8-1-10" class="d">-            },
</a><a href="#h8-1-11" id="h8-1-11" class="i">+            columns: table
</a><a href="#h8-1-12" id="h8-1-12" class="i">+                .columns
</a><a href="#h8-1-13" id="h8-1-13" class="i">+                .iter()
</a><a href="#h8-1-14" id="h8-1-14" class="i">+                .map(|c| Column { table: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h8-1-15" id="h8-1-15" class="i">+                .collect(),
</a><a href="#h8-1-16" id="h8-1-16" class="i">+            rows: Box::new(rows.into_iter().map(Ok)),
</a>         })
     }
 }
<b>diff --git a/<a id="h9" href="../file/src/sql/execution/insert.rs.html">src/sql/execution/insert.rs</a> b/<a href="../file/src/sql/execution/insert.rs.html">src/sql/execution/insert.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::engine::Transaction;
<a href="#h9-0-1" id="h9-0-1" class="d">-use super::super::types::{Environment, Expressions};
</a><a href="#h9-0-2" id="h9-0-2" class="i">+use super::super::types::Expressions;
</a> use super::{Context, Executor, ResultSet};
 use crate::error::Result;
 
<a href="#h9-1" id="h9-1" class="h">@@ -22,11 +22,10 @@ impl Insert {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Insert {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         let table = ctx.txn.must_read_table(&amp;self.table)?;
<a href="#h9-1-3" id="h9-1-3" class="d">-        let env = Environment::new();
</a>         let mut count = 0;
         for expressions in self.rows {
             let mut row =
<a href="#h9-1-7" id="h9-1-7" class="d">-                expressions.into_iter().map(|expr| expr.evaluate(&amp;env)).collect::&lt;Result&lt;_&gt;&gt;()?;
</a><a href="#h9-1-8" id="h9-1-8" class="i">+                expressions.into_iter().map(|expr| expr.evaluate(None)).collect::&lt;Result&lt;_&gt;&gt;()?;
</a>             if self.columns.is_empty() {
                 row = table.pad_row(row)?;
             } else {
<b>diff --git a/<a id="h10" href="../file/src/sql/execution/key_lookup.rs.html">src/sql/execution/key_lookup.rs</a> b/<a href="../file/src/sql/execution/key_lookup.rs.html">src/sql/execution/key_lookup.rs</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::engine::Transaction;
<a href="#h10-0-1" id="h10-0-1" class="d">-use super::super::types::{Column, Relation, Row, Value};
</a><a href="#h10-0-2" id="h10-0-2" class="i">+use super::super::types::{Column, Row, Value};
</a> use super::{Context, Executor, ResultSet};
 use crate::error::Result;
 
<a href="#h10-1" id="h10-1" class="h">@@ -33,14 +33,12 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for KeyLookup {
</a>             .collect::&lt;Result&lt;Vec&lt;Row&gt;&gt;&gt;()?;
 
         Ok(ResultSet::Query {
<a href="#h10-1-3" id="h10-1-3" class="d">-            relation: Relation {
</a><a href="#h10-1-4" id="h10-1-4" class="d">-                columns: table
</a><a href="#h10-1-5" id="h10-1-5" class="d">-                    .columns
</a><a href="#h10-1-6" id="h10-1-6" class="d">-                    .iter()
</a><a href="#h10-1-7" id="h10-1-7" class="d">-                    .map(|c| Column { relation: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h10-1-8" id="h10-1-8" class="d">-                    .collect(),
</a><a href="#h10-1-9" id="h10-1-9" class="d">-                rows: Some(Box::new(rows.into_iter().map(Ok))),
</a><a href="#h10-1-10" id="h10-1-10" class="d">-            },
</a><a href="#h10-1-11" id="h10-1-11" class="i">+            columns: table
</a><a href="#h10-1-12" id="h10-1-12" class="i">+                .columns
</a><a href="#h10-1-13" id="h10-1-13" class="i">+                .iter()
</a><a href="#h10-1-14" id="h10-1-14" class="i">+                .map(|c| Column { table: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h10-1-15" id="h10-1-15" class="i">+                .collect(),
</a><a href="#h10-1-16" id="h10-1-16" class="i">+            rows: Box::new(rows.into_iter().map(Ok)),
</a>         })
     }
 }
<b>diff --git a/<a id="h11" href="../file/src/sql/execution/limit.rs.html">src/sql/execution/limit.rs</a> b/<a href="../file/src/sql/execution/limit.rs.html">src/sql/execution/limit.rs</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -18,13 +18,10 @@ impl&lt;T: Transaction&gt; Limit&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Limit&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
<a href="#h11-0-3" id="h11-0-3" class="d">-        let result = self.source.execute(ctx)?;
</a><a href="#h11-0-4" id="h11-0-4" class="d">-        if let ResultSet::Query { mut relation } = result {
</a><a href="#h11-0-5" id="h11-0-5" class="d">-            if let Some(rows) = relation.rows {
</a><a href="#h11-0-6" id="h11-0-6" class="d">-                relation.rows = Some(Box::new(rows.take(self.limit as usize)))
</a><a href="#h11-0-7" id="h11-0-7" class="d">-            }
</a><a href="#h11-0-8" id="h11-0-8" class="d">-            return Ok(ResultSet::Query { relation });
</a><a href="#h11-0-9" id="h11-0-9" class="i">+        if let ResultSet::Query { columns, rows } = self.source.execute(ctx)? {
</a><a href="#h11-0-10" id="h11-0-10" class="i">+            Ok(ResultSet::Query { columns, rows: Box::new(rows.take(self.limit as usize)) })
</a><a href="#h11-0-11" id="h11-0-11" class="i">+        } else {
</a><a href="#h11-0-12" id="h11-0-12" class="i">+            Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>         }
<a href="#h11-0-14" id="h11-0-14" class="d">-        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h12" href="../file/src/sql/execution/mod.rs.html">src/sql/execution/mod.rs</a> b/<a href="../file/src/sql/execution/mod.rs.html">src/sql/execution/mod.rs</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -34,10 +34,10 @@ use update::Update;
</a> 
 use super::engine::{Mode, Transaction};
 use super::plan::Node;
<a href="#h12-0-3" id="h12-0-3" class="d">-use super::types::Environment;
</a><a href="#h12-0-4" id="h12-0-4" class="d">-use super::types::{Columns, Relation, Row, Value};
</a><a href="#h12-0-5" id="h12-0-5" class="i">+use super::types::{Columns, Row, Rows, Value};
</a> use crate::error::{Error, Result};
 
<a href="#h12-0-8" id="h12-0-8" class="i">+use derivative::Derivative;
</a> use serde_derive::{Deserialize, Serialize};
 
 /// A plan executor
<a href="#h12-1" id="h12-1" class="h">@@ -74,7 +74,7 @@ impl&lt;T: Transaction + &#39;static&gt; dyn Executor&lt;T&gt; {
</a>             Node::Projection { source, labels, expressions } =&gt; {
                 Projection::new(Self::build(*source), labels, expressions)
             }
<a href="#h12-1-3" id="h12-1-3" class="d">-            Node::Scan { table, alias, filter } =&gt; Scan::new(table, alias, filter),
</a><a href="#h12-1-4" id="h12-1-4" class="i">+            Node::Scan { table, label, filter } =&gt; Scan::new(table, label, filter),
</a>             Node::Update { table, source, expressions } =&gt; {
                 Update::new(table, Self::build(*source), expressions)
             }
<a href="#h12-2" id="h12-2" class="h">@@ -89,148 +89,71 @@ pub struct Context&lt;&#39;a, T: Transaction&gt; {
</a> }
 
 /// An executor result set
<a href="#h12-2-3" id="h12-2-3" class="d">-#[derive(Debug, PartialEq, Serialize, Deserialize)]
</a><a href="#h12-2-4" id="h12-2-4" class="i">+#[derive(Derivative, Serialize, Deserialize)]
</a><a href="#h12-2-5" id="h12-2-5" class="i">+#[derivative(Debug, PartialEq)]
</a> pub enum ResultSet {
     // Transaction started
<a href="#h12-2-8" id="h12-2-8" class="d">-    Begin { id: u64, mode: Mode },
</a><a href="#h12-2-9" id="h12-2-9" class="i">+    Begin {
</a><a href="#h12-2-10" id="h12-2-10" class="i">+        id: u64,
</a><a href="#h12-2-11" id="h12-2-11" class="i">+        mode: Mode,
</a><a href="#h12-2-12" id="h12-2-12" class="i">+    },
</a>     // Transaction committed
<a href="#h12-2-14" id="h12-2-14" class="d">-    Commit { id: u64 },
</a><a href="#h12-2-15" id="h12-2-15" class="i">+    Commit {
</a><a href="#h12-2-16" id="h12-2-16" class="i">+        id: u64,
</a><a href="#h12-2-17" id="h12-2-17" class="i">+    },
</a>     // Transaction rolled back
<a href="#h12-2-19" id="h12-2-19" class="d">-    Rollback { id: u64 },
</a><a href="#h12-2-20" id="h12-2-20" class="i">+    Rollback {
</a><a href="#h12-2-21" id="h12-2-21" class="i">+        id: u64,
</a><a href="#h12-2-22" id="h12-2-22" class="i">+    },
</a>     // Rows created
<a href="#h12-2-24" id="h12-2-24" class="d">-    Create { count: u64 },
</a><a href="#h12-2-25" id="h12-2-25" class="i">+    Create {
</a><a href="#h12-2-26" id="h12-2-26" class="i">+        count: u64,
</a><a href="#h12-2-27" id="h12-2-27" class="i">+    },
</a>     // Rows deleted
<a href="#h12-2-29" id="h12-2-29" class="d">-    Delete { count: u64 },
</a><a href="#h12-2-30" id="h12-2-30" class="i">+    Delete {
</a><a href="#h12-2-31" id="h12-2-31" class="i">+        count: u64,
</a><a href="#h12-2-32" id="h12-2-32" class="i">+    },
</a>     // Rows updated
<a href="#h12-2-34" id="h12-2-34" class="d">-    Update { count: u64 },
</a><a href="#h12-2-35" id="h12-2-35" class="i">+    Update {
</a><a href="#h12-2-36" id="h12-2-36" class="i">+        count: u64,
</a><a href="#h12-2-37" id="h12-2-37" class="i">+    },
</a>     // Table created
<a href="#h12-2-39" id="h12-2-39" class="d">-    CreateTable { name: String },
</a><a href="#h12-2-40" id="h12-2-40" class="i">+    CreateTable {
</a><a href="#h12-2-41" id="h12-2-41" class="i">+        name: String,
</a><a href="#h12-2-42" id="h12-2-42" class="i">+    },
</a>     // Table dropped
<a href="#h12-2-44" id="h12-2-44" class="d">-    DropTable { name: String },
</a><a href="#h12-2-45" id="h12-2-45" class="i">+    DropTable {
</a><a href="#h12-2-46" id="h12-2-46" class="i">+        name: String,
</a><a href="#h12-2-47" id="h12-2-47" class="i">+    },
</a>     // Query result
<a href="#h12-2-49" id="h12-2-49" class="d">-    Query { relation: Relation },
</a><a href="#h12-2-50" id="h12-2-50" class="i">+    Query {
</a><a href="#h12-2-51" id="h12-2-51" class="i">+        columns: Columns,
</a><a href="#h12-2-52" id="h12-2-52" class="i">+        #[derivative(Debug = &quot;ignore&quot;)]
</a><a href="#h12-2-53" id="h12-2-53" class="i">+        #[derivative(PartialEq = &quot;ignore&quot;)]
</a><a href="#h12-2-54" id="h12-2-54" class="i">+        #[serde(skip, default = &quot;ResultSet::empty_rows&quot;)]
</a><a href="#h12-2-55" id="h12-2-55" class="i">+        rows: Rows,
</a><a href="#h12-2-56" id="h12-2-56" class="i">+    },
</a>     // Explain result
     Explain(Node),
 }
 
 impl ResultSet {
<a href="#h12-2-62" id="h12-2-62" class="d">-    /// Converts the ResultSet into a Relation, or errors if not a query result.
</a><a href="#h12-2-63" id="h12-2-63" class="d">-    pub fn into_relation(self) -&gt; Result&lt;Relation&gt; {
</a><a href="#h12-2-64" id="h12-2-64" class="d">-        match self {
</a><a href="#h12-2-65" id="h12-2-65" class="d">-            ResultSet::Query { relation } =&gt; Ok(relation),
</a><a href="#h12-2-66" id="h12-2-66" class="d">-            r =&gt; Err(Error::Value(format!(&quot;Not a query result: {:?}&quot;, r))),
</a><a href="#h12-2-67" id="h12-2-67" class="d">-        }
</a><a href="#h12-2-68" id="h12-2-68" class="i">+    /// Creates an empty row iteratur, for use by serde(default).
</a><a href="#h12-2-69" id="h12-2-69" class="i">+    fn empty_rows() -&gt; Rows {
</a><a href="#h12-2-70" id="h12-2-70" class="i">+        Box::new(std::iter::empty())
</a>     }
 
<a href="#h12-2-73" id="h12-2-73" class="d">-    /// Converts the ResultSet into a Row, or errors if not a query result with rows.
</a><a href="#h12-2-74" id="h12-2-74" class="i">+    /// Converts the ResultSet into a row, or errors if not a query result with rows.
</a>     pub fn into_row(self) -&gt; Result&lt;Row&gt; {
<a href="#h12-2-76" id="h12-2-76" class="d">-        self.into_relation()?.into_row()?.ok_or_else(|| Error::Value(&quot;No rows returned&quot;.into()))
</a><a href="#h12-2-77" id="h12-2-77" class="d">-    }
</a><a href="#h12-2-78" id="h12-2-78" class="d">-
</a><a href="#h12-2-79" id="h12-2-79" class="d">-    /// Converts the ResultSet into a Value, if possible.
</a><a href="#h12-2-80" id="h12-2-80" class="d">-    pub fn into_value(self) -&gt; Result&lt;Value&gt; {
</a><a href="#h12-2-81" id="h12-2-81" class="d">-        self.into_relation()?.into_value()?.ok_or_else(|| Error::Value(&quot;No value returned&quot;.into()))
</a><a href="#h12-2-82" id="h12-2-82" class="d">-    }
</a><a href="#h12-2-83" id="h12-2-83" class="d">-}
</a><a href="#h12-2-84" id="h12-2-84" class="d">-
</a><a href="#h12-2-85" id="h12-2-85" class="d">-/// Column metadata for a result.
</a><a href="#h12-2-86" id="h12-2-86" class="d">-/// FIXME This is outdated and should be removed.
</a><a href="#h12-2-87" id="h12-2-87" class="d">-#[derive(Clone, Serialize, Deserialize)]
</a><a href="#h12-2-88" id="h12-2-88" class="d">-pub struct ResultColumns {
</a><a href="#h12-2-89" id="h12-2-89" class="d">-    columns: Vec&lt;(Option&lt;String&gt;, Option&lt;String&gt;)&gt;,
</a><a href="#h12-2-90" id="h12-2-90" class="d">-}
</a><a href="#h12-2-91" id="h12-2-91" class="d">-
</a><a href="#h12-2-92" id="h12-2-92" class="d">-impl ResultColumns {
</a><a href="#h12-2-93" id="h12-2-93" class="d">-    pub fn new(columns: Vec&lt;(Option&lt;String&gt;, Option&lt;String&gt;)&gt;) -&gt; Self {
</a><a href="#h12-2-94" id="h12-2-94" class="d">-        Self { columns }
</a><a href="#h12-2-95" id="h12-2-95" class="d">-    }
</a><a href="#h12-2-96" id="h12-2-96" class="d">-
</a><a href="#h12-2-97" id="h12-2-97" class="d">-    pub fn from(columns: Vec&lt;Option&lt;String&gt;&gt;) -&gt; Self {
</a><a href="#h12-2-98" id="h12-2-98" class="d">-        Self { columns: columns.into_iter().map(|c| (None, c)).collect() }
</a><a href="#h12-2-99" id="h12-2-99" class="d">-    }
</a><a href="#h12-2-100" id="h12-2-100" class="d">-
</a><a href="#h12-2-101" id="h12-2-101" class="d">-    pub fn from_new_columns(columns: Columns) -&gt; Self {
</a><a href="#h12-2-102" id="h12-2-102" class="d">-        Self { columns: columns.into_iter().map(|c| (c.relation, c.name)).collect() }
</a><a href="#h12-2-103" id="h12-2-103" class="d">-    }
</a><a href="#h12-2-104" id="h12-2-104" class="d">-
</a><a href="#h12-2-105" id="h12-2-105" class="d">-    fn as_env&lt;&#39;b&gt;(&amp;&#39;b self, row: &amp;&#39;b [Value]) -&gt; Environment&lt;&#39;b&gt; {
</a><a href="#h12-2-106" id="h12-2-106" class="d">-        let mut env = Environment::new();
</a><a href="#h12-2-107" id="h12-2-107" class="d">-        for ((relation, field), value) in self.columns.iter().zip(row.iter()) {
</a><a href="#h12-2-108" id="h12-2-108" class="d">-            env.append(relation.as_deref(), field.as_deref(), value)
</a><a href="#h12-2-109" id="h12-2-109" class="i">+        if let ResultSet::Query { mut rows, .. } = self {
</a><a href="#h12-2-110" id="h12-2-110" class="i">+            rows.next().transpose()?.ok_or_else(|| Error::Value(&quot;No rows returned&quot;.into()))
</a><a href="#h12-2-111" id="h12-2-111" class="i">+        } else {
</a><a href="#h12-2-112" id="h12-2-112" class="i">+            Err(Error::Value(format!(&quot;Not a query result: {:?}&quot;, self)))
</a>         }
<a href="#h12-2-114" id="h12-2-114" class="d">-        env
</a>     }
 
<a href="#h12-2-117" id="h12-2-117" class="d">-    fn format(&amp;self, relation: Option&lt;&amp;str&gt;, field: &amp;str) -&gt; String {
</a><a href="#h12-2-118" id="h12-2-118" class="d">-        let mut s = super::parser::format_ident(field);
</a><a href="#h12-2-119" id="h12-2-119" class="d">-        if let Some(relation) = relation {
</a><a href="#h12-2-120" id="h12-2-120" class="d">-            s = format!(&quot;{}.{}&quot;, super::parser::format_ident(relation), s)
</a><a href="#h12-2-121" id="h12-2-121" class="d">-        }
</a><a href="#h12-2-122" id="h12-2-122" class="d">-        s
</a><a href="#h12-2-123" id="h12-2-123" class="d">-    }
</a><a href="#h12-2-124" id="h12-2-124" class="d">-
</a><a href="#h12-2-125" id="h12-2-125" class="d">-    fn get(&amp;self, relation: Option&lt;&amp;str&gt;, field: &amp;str) -&gt; Result&lt;(Option&lt;String&gt;, String)&gt; {
</a><a href="#h12-2-126" id="h12-2-126" class="d">-        let matches: Vec&lt;_&gt; = self
</a><a href="#h12-2-127" id="h12-2-127" class="d">-            .columns
</a><a href="#h12-2-128" id="h12-2-128" class="d">-            .iter()
</a><a href="#h12-2-129" id="h12-2-129" class="d">-            .filter_map(|(r, c)| {
</a><a href="#h12-2-130" id="h12-2-130" class="d">-                if c.as_deref() == Some(field) {
</a><a href="#h12-2-131" id="h12-2-131" class="d">-                    if relation.is_none() || r.as_deref() == relation {
</a><a href="#h12-2-132" id="h12-2-132" class="d">-                        Some((r.clone(), c.clone().unwrap()))
</a><a href="#h12-2-133" id="h12-2-133" class="d">-                    } else {
</a><a href="#h12-2-134" id="h12-2-134" class="d">-                        None
</a><a href="#h12-2-135" id="h12-2-135" class="d">-                    }
</a><a href="#h12-2-136" id="h12-2-136" class="d">-                } else {
</a><a href="#h12-2-137" id="h12-2-137" class="d">-                    None
</a><a href="#h12-2-138" id="h12-2-138" class="d">-                }
</a><a href="#h12-2-139" id="h12-2-139" class="d">-            })
</a><a href="#h12-2-140" id="h12-2-140" class="d">-            .collect();
</a><a href="#h12-2-141" id="h12-2-141" class="d">-        match matches.len() {
</a><a href="#h12-2-142" id="h12-2-142" class="d">-            0 =&gt; Err(Error::Value(format!(&quot;Unknown field {}&quot;, self.format(relation, field)))),
</a><a href="#h12-2-143" id="h12-2-143" class="d">-            1 =&gt; Ok(matches.into_iter().next().unwrap()),
</a><a href="#h12-2-144" id="h12-2-144" class="d">-            _ =&gt; Err(Error::Value(format!(&quot;Field reference {} is ambiguous&quot;, field))),
</a><a href="#h12-2-145" id="h12-2-145" class="d">-        }
</a><a href="#h12-2-146" id="h12-2-146" class="d">-    }
</a><a href="#h12-2-147" id="h12-2-147" class="d">-
</a><a href="#h12-2-148" id="h12-2-148" class="d">-    pub fn index(&amp;self, relation: Option&lt;&amp;str&gt;, field: &amp;str) -&gt; Result&lt;usize&gt; {
</a><a href="#h12-2-149" id="h12-2-149" class="d">-        let matches: Vec&lt;_&gt; = self
</a><a href="#h12-2-150" id="h12-2-150" class="d">-            .columns
</a><a href="#h12-2-151" id="h12-2-151" class="d">-            .iter()
</a><a href="#h12-2-152" id="h12-2-152" class="d">-            .enumerate()
</a><a href="#h12-2-153" id="h12-2-153" class="d">-            .filter_map(|(i, (r, c))| {
</a><a href="#h12-2-154" id="h12-2-154" class="d">-                if c.as_deref() == Some(field) {
</a><a href="#h12-2-155" id="h12-2-155" class="d">-                    if relation.is_none() || r.as_deref() == relation {
</a><a href="#h12-2-156" id="h12-2-156" class="d">-                        Some(i)
</a><a href="#h12-2-157" id="h12-2-157" class="d">-                    } else {
</a><a href="#h12-2-158" id="h12-2-158" class="d">-                        None
</a><a href="#h12-2-159" id="h12-2-159" class="d">-                    }
</a><a href="#h12-2-160" id="h12-2-160" class="d">-                } else {
</a><a href="#h12-2-161" id="h12-2-161" class="d">-                    None
</a><a href="#h12-2-162" id="h12-2-162" class="d">-                }
</a><a href="#h12-2-163" id="h12-2-163" class="d">-            })
</a><a href="#h12-2-164" id="h12-2-164" class="d">-            .collect();
</a><a href="#h12-2-165" id="h12-2-165" class="d">-        match matches.len() {
</a><a href="#h12-2-166" id="h12-2-166" class="d">-            0 =&gt; Err(Error::Value(format!(&quot;Unknown field {}&quot;, self.format(relation, field)))),
</a><a href="#h12-2-167" id="h12-2-167" class="d">-            1 =&gt; Ok(matches.into_iter().next().unwrap()),
</a><a href="#h12-2-168" id="h12-2-168" class="d">-            _ =&gt; Err(Error::Value(format!(&quot;Field reference {} is ambiguous&quot;, field))),
</a><a href="#h12-2-169" id="h12-2-169" class="d">-        }
</a><a href="#h12-2-170" id="h12-2-170" class="d">-    }
</a><a href="#h12-2-171" id="h12-2-171" class="d">-
</a><a href="#h12-2-172" id="h12-2-172" class="d">-    pub fn is_empty(&amp;self) -&gt; bool {
</a><a href="#h12-2-173" id="h12-2-173" class="d">-        self.columns.len() == 0
</a><a href="#h12-2-174" id="h12-2-174" class="d">-    }
</a><a href="#h12-2-175" id="h12-2-175" class="d">-
</a><a href="#h12-2-176" id="h12-2-176" class="d">-    pub fn len(&amp;self) -&gt; usize {
</a><a href="#h12-2-177" id="h12-2-177" class="d">-        self.columns.len()
</a><a href="#h12-2-178" id="h12-2-178" class="d">-    }
</a><a href="#h12-2-179" id="h12-2-179" class="d">-
</a><a href="#h12-2-180" id="h12-2-180" class="d">-    pub fn merge(self, other: Self) -&gt; Self {
</a><a href="#h12-2-181" id="h12-2-181" class="d">-        let mut columns = self.columns;
</a><a href="#h12-2-182" id="h12-2-182" class="d">-        columns.extend(other.columns);
</a><a href="#h12-2-183" id="h12-2-183" class="d">-        Self::new(columns)
</a><a href="#h12-2-184" id="h12-2-184" class="d">-    }
</a><a href="#h12-2-185" id="h12-2-185" class="d">-
</a><a href="#h12-2-186" id="h12-2-186" class="d">-    pub fn names(&amp;self) -&gt; Vec&lt;Option&lt;String&gt;&gt; {
</a><a href="#h12-2-187" id="h12-2-187" class="d">-        self.columns.iter().map(|(_, c)| c.clone()).collect()
</a><a href="#h12-2-188" id="h12-2-188" class="i">+    /// Converts the ResultSet into a value, if possible.
</a><a href="#h12-2-189" id="h12-2-189" class="i">+    pub fn into_value(self) -&gt; Result&lt;Value&gt; {
</a><a href="#h12-2-190" id="h12-2-190" class="i">+        self.into_row()?.into_iter().next().ok_or_else(|| Error::Value(&quot;No value returned&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h13" href="../file/src/sql/execution/nested_loop_join.rs.html">src/sql/execution/nested_loop_join.rs</a> b/<a href="../file/src/sql/execution/nested_loop_join.rs.html">src/sql/execution/nested_loop_join.rs</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
<a href="#h13-0-1" id="h13-0-1" class="d">-use super::super::types::{Columns, Expression, Relation, Rows};
</a><a href="#h13-0-2" id="h13-0-2" class="d">-use super::{Context, Executor, ResultColumns, ResultSet, Row, Value};
</a><a href="#h13-0-3" id="h13-0-3" class="i">+use super::super::types::{Columns, Expression, Rows};
</a><a href="#h13-0-4" id="h13-0-4" class="i">+use super::{Context, Executor, ResultSet, Row, Value};
</a> use crate::error::{Error, Result};
 
 /// A nested loop join executor
<a href="#h13-1" id="h13-1" class="h">@@ -37,37 +37,28 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for NestedLoopJoin&lt;T&gt; {
</a>         } else {
             (self.outer.execute(ctx)?, self.inner.execute(ctx)?)
         };
<a href="#h13-1-3" id="h13-1-3" class="d">-        if let ResultSet::Query { relation } = result {
</a><a href="#h13-1-4" id="h13-1-4" class="d">-            if let ResultSet::Query { relation: inner } = inner {
</a><a href="#h13-1-5" id="h13-1-5" class="d">-                let env_columns = ResultColumns::from_new_columns(relation.columns.clone())
</a><a href="#h13-1-6" id="h13-1-6" class="d">-                    .merge(ResultColumns::from_new_columns(inner.columns.clone()));
</a><a href="#h13-1-7" id="h13-1-7" class="d">-                let mut join = Relation { columns: Columns::new(), rows: None };
</a><a href="#h13-1-8" id="h13-1-8" class="i">+        if let ResultSet::Query { columns, rows } = result {
</a><a href="#h13-1-9" id="h13-1-9" class="i">+            if let ResultSet::Query { columns: inner_columns, rows: inner_rows } = inner {
</a><a href="#h13-1-10" id="h13-1-10" class="i">+                let mut join_columns = Columns::new();
</a>                 if self.flip {
<a href="#h13-1-12" id="h13-1-12" class="d">-                    join.columns.extend(inner.columns);
</a><a href="#h13-1-13" id="h13-1-13" class="d">-                    join.columns.extend(relation.columns);
</a><a href="#h13-1-14" id="h13-1-14" class="i">+                    join_columns.extend(inner_columns);
</a><a href="#h13-1-15" id="h13-1-15" class="i">+                    join_columns.extend(columns);
</a>                 } else {
<a href="#h13-1-17" id="h13-1-17" class="d">-                    join.columns.extend(relation.columns);
</a><a href="#h13-1-18" id="h13-1-18" class="d">-                    join.columns.extend(inner.columns);
</a><a href="#h13-1-19" id="h13-1-19" class="i">+                    join_columns.extend(columns);
</a><a href="#h13-1-20" id="h13-1-20" class="i">+                    join_columns.extend(inner_columns);
</a>                 }
 
<a href="#h13-1-23" id="h13-1-23" class="d">-                let mut inner_rows = vec![];
</a><a href="#h13-1-24" id="h13-1-24" class="d">-                if let Some(mut rows) = inner.rows {
</a><a href="#h13-1-25" id="h13-1-25" class="d">-                    while let Some(row) = rows.next().transpose()? {
</a><a href="#h13-1-26" id="h13-1-26" class="d">-                        inner_rows.push(row);
</a><a href="#h13-1-27" id="h13-1-27" class="d">-                    }
</a><a href="#h13-1-28" id="h13-1-28" class="d">-                }
</a><a href="#h13-1-29" id="h13-1-29" class="d">-
</a><a href="#h13-1-30" id="h13-1-30" class="d">-                if let Some(rows) = relation.rows {
</a><a href="#h13-1-31" id="h13-1-31" class="d">-                    join.rows = Some(Box::new(NestedLoopRows::new(
</a><a href="#h13-1-32" id="h13-1-32" class="d">-                        env_columns,
</a><a href="#h13-1-33" id="h13-1-33" class="i">+                return Ok(ResultSet::Query {
</a><a href="#h13-1-34" id="h13-1-34" class="i">+                    columns: join_columns.clone(),
</a><a href="#h13-1-35" id="h13-1-35" class="i">+                    rows: Box::new(NestedLoopRows::new(
</a><a href="#h13-1-36" id="h13-1-36" class="i">+                        join_columns,
</a>                         rows,
<a href="#h13-1-38" id="h13-1-38" class="d">-                        inner_rows,
</a><a href="#h13-1-39" id="h13-1-39" class="i">+                        inner_rows.collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;()?,
</a>                         self.predicate,
                         self.pad_inner,
                         self.flip,
<a href="#h13-1-43" id="h13-1-43" class="d">-                    )));
</a><a href="#h13-1-44" id="h13-1-44" class="d">-                }
</a><a href="#h13-1-45" id="h13-1-45" class="d">-                return Ok(ResultSet::Query { relation: join });
</a><a href="#h13-1-46" id="h13-1-46" class="i">+                    )),
</a><a href="#h13-1-47" id="h13-1-47" class="i">+                });
</a>             }
         }
         Err(Error::Internal(&quot;Unexpected result set&quot;.into()))
<a href="#h13-2" id="h13-2" class="h">@@ -75,7 +66,7 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for NestedLoopJoin&lt;T&gt; {
</a> }
 
 struct NestedLoopRows {
<a href="#h13-2-3" id="h13-2-3" class="d">-    columns: ResultColumns,
</a><a href="#h13-2-4" id="h13-2-4" class="i">+    columns: Columns,
</a>     predicate: Option&lt;Expression&gt;,
     outer: Rows,
     outer_cur: Option&lt;Result&lt;Row&gt;&gt;,
<a href="#h13-3" id="h13-3" class="h">@@ -89,7 +80,7 @@ struct NestedLoopRows {
</a> 
 impl NestedLoopRows {
     fn new(
<a href="#h13-3-3" id="h13-3-3" class="d">-        columns: ResultColumns,
</a><a href="#h13-3-4" id="h13-3-4" class="i">+        columns: Columns,
</a>         mut outer: Rows,
         inner: Vec&lt;Row&gt;,
         predicate: Option&lt;Expression&gt;,
<a href="#h13-4" id="h13-4" class="h">@@ -117,10 +108,15 @@ impl NestedLoopRows {
</a>         };
         while let Some(i) = self.inner.next() {
             if let Some(predicate) = &amp;self.predicate {
<a href="#h13-4-3" id="h13-4-3" class="d">-                let mut row = o.clone();
</a><a href="#h13-4-4" id="h13-4-4" class="d">-                row.extend(i.clone());
</a><a href="#h13-4-5" id="h13-4-5" class="d">-                let env = self.columns.as_env(&amp;row);
</a><a href="#h13-4-6" id="h13-4-6" class="d">-                match predicate.evaluate(&amp;env)? {
</a><a href="#h13-4-7" id="h13-4-7" class="i">+                let mut row = Vec::new();
</a><a href="#h13-4-8" id="h13-4-8" class="i">+                if self.flipped {
</a><a href="#h13-4-9" id="h13-4-9" class="i">+                    row.extend(i.clone());
</a><a href="#h13-4-10" id="h13-4-10" class="i">+                    row.extend(o.clone());
</a><a href="#h13-4-11" id="h13-4-11" class="i">+                } else {
</a><a href="#h13-4-12" id="h13-4-12" class="i">+                    row.extend(o.clone());
</a><a href="#h13-4-13" id="h13-4-13" class="i">+                    row.extend(i.clone());
</a><a href="#h13-4-14" id="h13-4-14" class="i">+                }
</a><a href="#h13-4-15" id="h13-4-15" class="i">+                match predicate.evaluate(Some(&amp;row))? {
</a>                     Value::Boolean(true) =&gt; return Ok(Some(i)),
                     Value::Boolean(false) =&gt; {}
                     Value::Null =&gt; {}
<a href="#h13-5" id="h13-5" class="h">@@ -157,7 +153,7 @@ impl Iterator for NestedLoopRows {
</a>                     self.inner = Box::new(self.inner_orig.clone().into_iter());
                     if self.inner_pad &amp;&amp; !self.inner_emitted {
                         let mut row = self.outer_cur.clone().unwrap().unwrap();
<a href="#h13-5-3" id="h13-5-3" class="d">-                        while row.len() &lt; self.columns.columns.len() {
</a><a href="#h13-5-4" id="h13-5-4" class="i">+                        while row.len() &lt; self.columns.len() {
</a>                             if self.flipped {
                                 row.insert(0, Value::Null)
                             } else {
<b>diff --git a/<a id="h14" href="../file/src/sql/execution/nothing.rs.html">src/sql/execution/nothing.rs</a> b/<a href="../file/src/sql/execution/nothing.rs.html">src/sql/execution/nothing.rs</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::types::Row;
<a href="#h14-0-2" id="h14-0-2" class="d">-use super::{Context, Executor, Relation, ResultSet};
</a><a href="#h14-0-3" id="h14-0-3" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::error::Result;
 
 /// An executor that produces a single empty row
<a href="#h14-1" id="h14-1" class="h">@@ -15,10 +15,8 @@ impl Nothing {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Nothing {
     fn execute(self: Box&lt;Self&gt;, _ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         Ok(ResultSet::Query {
<a href="#h14-1-3" id="h14-1-3" class="d">-            relation: Relation {
</a><a href="#h14-1-4" id="h14-1-4" class="d">-                columns: Vec::new(),
</a><a href="#h14-1-5" id="h14-1-5" class="d">-                rows: Some(Box::new(std::iter::once(Ok(Row::new())))),
</a><a href="#h14-1-6" id="h14-1-6" class="d">-            },
</a><a href="#h14-1-7" id="h14-1-7" class="i">+            columns: Vec::new(),
</a><a href="#h14-1-8" id="h14-1-8" class="i">+            rows: Box::new(std::iter::once(Ok(Row::new()))),
</a>         })
     }
 }
<b>diff --git a/<a id="h15" href="../file/src/sql/execution/offset.rs.html">src/sql/execution/offset.rs</a> b/<a href="../file/src/sql/execution/offset.rs.html">src/sql/execution/offset.rs</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -18,13 +18,10 @@ impl&lt;T: Transaction&gt; Offset&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Offset&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
<a href="#h15-0-3" id="h15-0-3" class="d">-        let result = self.source.execute(ctx)?;
</a><a href="#h15-0-4" id="h15-0-4" class="d">-        if let ResultSet::Query { mut relation } = result {
</a><a href="#h15-0-5" id="h15-0-5" class="d">-            if let Some(rows) = relation.rows {
</a><a href="#h15-0-6" id="h15-0-6" class="d">-                relation.rows = Some(Box::new(rows.skip(self.offset as usize)))
</a><a href="#h15-0-7" id="h15-0-7" class="d">-            }
</a><a href="#h15-0-8" id="h15-0-8" class="d">-            return Ok(ResultSet::Query { relation });
</a><a href="#h15-0-9" id="h15-0-9" class="i">+        if let ResultSet::Query { columns, rows } = self.source.execute(ctx)? {
</a><a href="#h15-0-10" id="h15-0-10" class="i">+            Ok(ResultSet::Query { columns, rows: Box::new(rows.skip(self.offset as usize)) })
</a><a href="#h15-0-11" id="h15-0-11" class="i">+        } else {
</a><a href="#h15-0-12" id="h15-0-12" class="i">+            Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>         }
<a href="#h15-0-14" id="h15-0-14" class="d">-        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h16" href="../file/src/sql/execution/order.rs.html">src/sql/execution/order.rs</a> b/<a href="../file/src/sql/execution/order.rs.html">src/sql/execution/order.rs</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,7 +1,7 @@
</a> use super::super::engine::Transaction;
 use super::super::plan::Direction;
 use super::super::types::{Expression, Row, Value};
<a href="#h16-0-3" id="h16-0-3" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h16-0-4" id="h16-0-4" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::error::{Error, Result};
 
 /// An order executor
<a href="#h16-1" id="h16-1" class="h">@@ -21,50 +21,44 @@ impl&lt;T: Transaction&gt; Order&lt;T&gt; {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Order&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         match self.source.execute(ctx)? {
<a href="#h16-1-3" id="h16-1-3" class="d">-            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h16-1-4" id="h16-1-4" class="d">-                if let Some(mut rows) = relation.rows {
</a><a href="#h16-1-5" id="h16-1-5" class="d">-                    // FIXME Since we can&#39;t return errors from the sort_by closure, we have to
</a><a href="#h16-1-6" id="h16-1-6" class="d">-                    // pre-evaluate all values. This means that we can&#39;t short-circuit evaluation,
</a><a href="#h16-1-7" id="h16-1-7" class="d">-                    // and have to temporarily store evaluated values, which is bad for performance
</a><a href="#h16-1-8" id="h16-1-8" class="d">-                    // and memory usage respectively
</a><a href="#h16-1-9" id="h16-1-9" class="d">-                    struct Item {
</a><a href="#h16-1-10" id="h16-1-10" class="d">-                        row: Row,
</a><a href="#h16-1-11" id="h16-1-11" class="d">-                        values: Vec&lt;Value&gt;,
</a><a href="#h16-1-12" id="h16-1-12" class="d">-                    };
</a><a href="#h16-1-13" id="h16-1-13" class="d">-                    let mut items = Vec::new();
</a><a href="#h16-1-14" id="h16-1-14" class="d">-                    while let Some(row) = rows.next().transpose()? {
</a><a href="#h16-1-15" id="h16-1-15" class="d">-                        let env_columns = ResultColumns::from_new_columns(relation.columns.clone());
</a><a href="#h16-1-16" id="h16-1-16" class="d">-                        let env = env_columns.as_env(&amp;row);
</a><a href="#h16-1-17" id="h16-1-17" class="d">-                        let mut values = Vec::new();
</a><a href="#h16-1-18" id="h16-1-18" class="d">-                        for (expr, _) in self.order.iter() {
</a><a href="#h16-1-19" id="h16-1-19" class="d">-                            values.push(expr.evaluate(&amp;env)?);
</a><a href="#h16-1-20" id="h16-1-20" class="d">-                        }
</a><a href="#h16-1-21" id="h16-1-21" class="d">-                        items.push(Item { row, values })
</a><a href="#h16-1-22" id="h16-1-22" class="i">+            ResultSet::Query { columns, mut rows } =&gt; {
</a><a href="#h16-1-23" id="h16-1-23" class="i">+                // FIXME Since we can&#39;t return errors from the sort_by closure, we have to
</a><a href="#h16-1-24" id="h16-1-24" class="i">+                // pre-evaluate all values. This means that we can&#39;t short-circuit evaluation,
</a><a href="#h16-1-25" id="h16-1-25" class="i">+                // and have to temporarily store evaluated values, which is bad for performance
</a><a href="#h16-1-26" id="h16-1-26" class="i">+                // and memory usage respectively
</a><a href="#h16-1-27" id="h16-1-27" class="i">+                struct Item {
</a><a href="#h16-1-28" id="h16-1-28" class="i">+                    row: Row,
</a><a href="#h16-1-29" id="h16-1-29" class="i">+                    values: Vec&lt;Value&gt;,
</a><a href="#h16-1-30" id="h16-1-30" class="i">+                };
</a><a href="#h16-1-31" id="h16-1-31" class="i">+                let mut items = Vec::new();
</a><a href="#h16-1-32" id="h16-1-32" class="i">+                while let Some(row) = rows.next().transpose()? {
</a><a href="#h16-1-33" id="h16-1-33" class="i">+                    let mut values = Vec::new();
</a><a href="#h16-1-34" id="h16-1-34" class="i">+                    for (expr, _) in self.order.iter() {
</a><a href="#h16-1-35" id="h16-1-35" class="i">+                        values.push(expr.evaluate(Some(&amp;row))?);
</a>                     }
<a href="#h16-1-37" id="h16-1-37" class="i">+                    items.push(Item { row, values })
</a><a href="#h16-1-38" id="h16-1-38" class="i">+                }
</a> 
<a href="#h16-1-40" id="h16-1-40" class="d">-                    let order = &amp;self.order;
</a><a href="#h16-1-41" id="h16-1-41" class="d">-                    items.sort_by(|a, b| {
</a><a href="#h16-1-42" id="h16-1-42" class="d">-                        for (i, (_, order)) in order.iter().enumerate() {
</a><a href="#h16-1-43" id="h16-1-43" class="d">-                            let value_a = &amp;a.values[i];
</a><a href="#h16-1-44" id="h16-1-44" class="d">-                            let value_b = &amp;b.values[i];
</a><a href="#h16-1-45" id="h16-1-45" class="d">-                            match value_a.partial_cmp(value_b) {
</a><a href="#h16-1-46" id="h16-1-46" class="d">-                                Some(std::cmp::Ordering::Equal) =&gt; {}
</a><a href="#h16-1-47" id="h16-1-47" class="d">-                                Some(o) =&gt; {
</a><a href="#h16-1-48" id="h16-1-48" class="d">-                                    return if *order == Direction::Ascending {
</a><a href="#h16-1-49" id="h16-1-49" class="d">-                                        o
</a><a href="#h16-1-50" id="h16-1-50" class="d">-                                    } else {
</a><a href="#h16-1-51" id="h16-1-51" class="d">-                                        o.reverse()
</a><a href="#h16-1-52" id="h16-1-52" class="d">-                                    }
</a><a href="#h16-1-53" id="h16-1-53" class="d">-                                }
</a><a href="#h16-1-54" id="h16-1-54" class="d">-                                None =&gt; {}
</a><a href="#h16-1-55" id="h16-1-55" class="i">+                let order = &amp;self.order;
</a><a href="#h16-1-56" id="h16-1-56" class="i">+                items.sort_by(|a, b| {
</a><a href="#h16-1-57" id="h16-1-57" class="i">+                    for (i, (_, order)) in order.iter().enumerate() {
</a><a href="#h16-1-58" id="h16-1-58" class="i">+                        let value_a = &amp;a.values[i];
</a><a href="#h16-1-59" id="h16-1-59" class="i">+                        let value_b = &amp;b.values[i];
</a><a href="#h16-1-60" id="h16-1-60" class="i">+                        match value_a.partial_cmp(value_b) {
</a><a href="#h16-1-61" id="h16-1-61" class="i">+                            Some(std::cmp::Ordering::Equal) =&gt; {}
</a><a href="#h16-1-62" id="h16-1-62" class="i">+                            Some(o) =&gt; {
</a><a href="#h16-1-63" id="h16-1-63" class="i">+                                return if *order == Direction::Ascending { o } else { o.reverse() }
</a>                             }
<a href="#h16-1-65" id="h16-1-65" class="i">+                            None =&gt; {}
</a>                         }
<a href="#h16-1-67" id="h16-1-67" class="d">-                        std::cmp::Ordering::Equal
</a><a href="#h16-1-68" id="h16-1-68" class="d">-                    });
</a><a href="#h16-1-69" id="h16-1-69" class="i">+                    }
</a><a href="#h16-1-70" id="h16-1-70" class="i">+                    std::cmp::Ordering::Equal
</a><a href="#h16-1-71" id="h16-1-71" class="i">+                });
</a> 
<a href="#h16-1-73" id="h16-1-73" class="d">-                    relation.rows = Some(Box::new(items.into_iter().map(|i| Ok(i.row))));
</a><a href="#h16-1-74" id="h16-1-74" class="d">-                }
</a><a href="#h16-1-75" id="h16-1-75" class="d">-                Ok(ResultSet::Query { relation })
</a><a href="#h16-1-76" id="h16-1-76" class="i">+                Ok(ResultSet::Query {
</a><a href="#h16-1-77" id="h16-1-77" class="i">+                    columns,
</a><a href="#h16-1-78" id="h16-1-78" class="i">+                    rows: Box::new(items.into_iter().map(|i| Ok(i.row))),
</a><a href="#h16-1-79" id="h16-1-79" class="i">+                })
</a>             }
             r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
         }
<b>diff --git a/<a id="h17" href="../file/src/sql/execution/projection.rs.html">src/sql/execution/projection.rs</a> b/<a href="../file/src/sql/execution/projection.rs.html">src/sql/execution/projection.rs</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
<a href="#h17-0-1" id="h17-0-1" class="d">-use super::super::types::{Column, Expression, Expressions, Relation};
</a><a href="#h17-0-2" id="h17-0-2" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h17-0-3" id="h17-0-3" class="i">+use super::super::types::{Column, Expression, Expressions};
</a><a href="#h17-0-4" id="h17-0-4" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::error::{Error, Result};
 
 /// A filter executor
<a href="#h17-1" id="h17-1" class="h">@@ -26,43 +26,32 @@ impl&lt;T: Transaction&gt; Projection&lt;T&gt; {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Projection&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         match self.source.execute(ctx)? {
<a href="#h17-1-3" id="h17-1-3" class="d">-            ResultSet::Query { relation } =&gt; {
</a><a href="#h17-1-4" id="h17-1-4" class="i">+            ResultSet::Query { columns, rows } =&gt; {
</a>                 let labels = self.labels;
<a href="#h17-1-6" id="h17-1-6" class="d">-                let columns = ResultColumns::from_new_columns(relation.columns);
</a><a href="#h17-1-7" id="h17-1-7" class="d">-                let mut projection = Relation {
</a><a href="#h17-1-8" id="h17-1-8" class="d">-                    columns: self
</a><a href="#h17-1-9" id="h17-1-9" class="d">-                        .expressions
</a><a href="#h17-1-10" id="h17-1-10" class="d">-                        .iter()
</a><a href="#h17-1-11" id="h17-1-11" class="d">-                        .enumerate()
</a><a href="#h17-1-12" id="h17-1-12" class="d">-                        .map(|(i, e)| {
</a><a href="#h17-1-13" id="h17-1-13" class="d">-                            Ok(if let Some(Some(label)) = labels.get(i) {
</a><a href="#h17-1-14" id="h17-1-14" class="d">-                                Column { relation: None, name: Some(label.clone()) }
</a><a href="#h17-1-15" id="h17-1-15" class="d">-                            } else if let Expression::Field(relation, field) = e {
</a><a href="#h17-1-16" id="h17-1-16" class="d">-                                let (r, f) = columns.get(relation.as_deref(), field)?;
</a><a href="#h17-1-17" id="h17-1-17" class="d">-                                Column { relation: r, name: Some(f) }
</a><a href="#h17-1-18" id="h17-1-18" class="d">-                            } else if let Expression::Column(i) = e {
</a><a href="#h17-1-19" id="h17-1-19" class="d">-                                let (r, f) = columns.columns[*i].clone(); // FIXME Should have method for this
</a><a href="#h17-1-20" id="h17-1-20" class="d">-                                Column { relation: r, name: f }
</a><a href="#h17-1-21" id="h17-1-21" class="d">-                            } else {
</a><a href="#h17-1-22" id="h17-1-22" class="d">-                                Column { relation: None, name: None }
</a><a href="#h17-1-23" id="h17-1-23" class="d">-                            })
</a><a href="#h17-1-24" id="h17-1-24" class="i">+                let columns = self
</a><a href="#h17-1-25" id="h17-1-25" class="i">+                    .expressions
</a><a href="#h17-1-26" id="h17-1-26" class="i">+                    .iter()
</a><a href="#h17-1-27" id="h17-1-27" class="i">+                    .enumerate()
</a><a href="#h17-1-28" id="h17-1-28" class="i">+                    .map(|(i, e)| {
</a><a href="#h17-1-29" id="h17-1-29" class="i">+                        Ok(if let Some(Some(label)) = labels.get(i) {
</a><a href="#h17-1-30" id="h17-1-30" class="i">+                            Column { table: None, name: Some(label.clone()) }
</a><a href="#h17-1-31" id="h17-1-31" class="i">+                        } else if let Expression::Field(i, _) = e {
</a><a href="#h17-1-32" id="h17-1-32" class="i">+                            columns[*i].clone()
</a><a href="#h17-1-33" id="h17-1-33" class="i">+                        } else {
</a><a href="#h17-1-34" id="h17-1-34" class="i">+                            Column { table: None, name: None }
</a>                         })
<a href="#h17-1-36" id="h17-1-36" class="d">-                        .collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;()?,
</a><a href="#h17-1-37" id="h17-1-37" class="d">-                    rows: None,
</a><a href="#h17-1-38" id="h17-1-38" class="d">-                };
</a><a href="#h17-1-39" id="h17-1-39" class="d">-                if let Some(rows) = relation.rows {
</a><a href="#h17-1-40" id="h17-1-40" class="d">-                    let expressions = self.expressions;
</a><a href="#h17-1-41" id="h17-1-41" class="d">-                    projection.rows = Some(Box::new(rows.map(move |r| {
</a><a href="#h17-1-42" id="h17-1-42" class="d">-                        r.and_then(|row| {
</a><a href="#h17-1-43" id="h17-1-43" class="d">-                            let env = columns.as_env(&amp;row);
</a><a href="#h17-1-44" id="h17-1-44" class="d">-                            Ok(expressions
</a><a href="#h17-1-45" id="h17-1-45" class="d">-                                .iter()
</a><a href="#h17-1-46" id="h17-1-46" class="d">-                                .map(|e| e.evaluate(&amp;env))
</a><a href="#h17-1-47" id="h17-1-47" class="d">-                                .collect::&lt;Result&lt;_&gt;&gt;()?)
</a><a href="#h17-1-48" id="h17-1-48" class="d">-                        })
</a><a href="#h17-1-49" id="h17-1-49" class="d">-                    })));
</a><a href="#h17-1-50" id="h17-1-50" class="d">-                }
</a><a href="#h17-1-51" id="h17-1-51" class="d">-                Ok(ResultSet::Query { relation: projection })
</a><a href="#h17-1-52" id="h17-1-52" class="i">+                    })
</a><a href="#h17-1-53" id="h17-1-53" class="i">+                    .collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;()?;
</a><a href="#h17-1-54" id="h17-1-54" class="i">+                let expressions = self.expressions;
</a><a href="#h17-1-55" id="h17-1-55" class="i">+                let rows = Box::new(rows.map(move |r| {
</a><a href="#h17-1-56" id="h17-1-56" class="i">+                    r.and_then(|row| {
</a><a href="#h17-1-57" id="h17-1-57" class="i">+                        Ok(expressions
</a><a href="#h17-1-58" id="h17-1-58" class="i">+                            .iter()
</a><a href="#h17-1-59" id="h17-1-59" class="i">+                            .map(|e| e.evaluate(Some(&amp;row)))
</a><a href="#h17-1-60" id="h17-1-60" class="i">+                            .collect::&lt;Result&lt;_&gt;&gt;()?)
</a><a href="#h17-1-61" id="h17-1-61" class="i">+                    })
</a><a href="#h17-1-62" id="h17-1-62" class="i">+                }));
</a><a href="#h17-1-63" id="h17-1-63" class="i">+                Ok(ResultSet::Query { columns, rows })
</a>             }
             r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
         }
<b>diff --git a/<a id="h18" href="../file/src/sql/execution/scan.rs.html">src/sql/execution/scan.rs</a> b/<a href="../file/src/sql/execution/scan.rs.html">src/sql/execution/scan.rs</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,37 +1,32 @@
</a> use super::super::engine::Transaction;
<a href="#h18-0-1" id="h18-0-1" class="d">-use super::super::types::{Column, Expression, Relation};
</a><a href="#h18-0-2" id="h18-0-2" class="i">+use super::super::types::{Column, Expression};
</a> use super::{Context, Executor, ResultSet};
 use crate::error::Result;
 
 /// A table scan executor
 pub struct Scan {
<a href="#h18-0-8" id="h18-0-8" class="d">-    /// The table to scan
</a>     table: String,
<a href="#h18-0-10" id="h18-0-10" class="d">-    /// The table alias to use
</a><a href="#h18-0-11" id="h18-0-11" class="d">-    alias: Option&lt;String&gt;,
</a><a href="#h18-0-12" id="h18-0-12" class="d">-    /// The row filter to apply
</a><a href="#h18-0-13" id="h18-0-13" class="i">+    label: String,
</a>     filter: Option&lt;Expression&gt;,
 }
 
 impl Scan {
<a href="#h18-0-18" id="h18-0-18" class="d">-    pub fn new(table: String, alias: Option&lt;String&gt;, filter: Option&lt;Expression&gt;) -&gt; Box&lt;Self&gt; {
</a><a href="#h18-0-19" id="h18-0-19" class="d">-        Box::new(Self { table, alias, filter })
</a><a href="#h18-0-20" id="h18-0-20" class="i">+    // FIXME label should not be necessary.
</a><a href="#h18-0-21" id="h18-0-21" class="i">+    pub fn new(table: String, label: String, filter: Option&lt;Expression&gt;) -&gt; Box&lt;Self&gt; {
</a><a href="#h18-0-22" id="h18-0-22" class="i">+        Box::new(Self { table, label, filter })
</a>     }
 }
 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Scan {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         let table = ctx.txn.must_read_table(&amp;self.table)?;
<a href="#h18-0-29" id="h18-0-29" class="d">-        let name = if let Some(alias) = &amp;self.alias { alias } else { &amp;table.name };
</a>         Ok(ResultSet::Query {
<a href="#h18-0-31" id="h18-0-31" class="d">-            relation: Relation {
</a><a href="#h18-0-32" id="h18-0-32" class="d">-                columns: table
</a><a href="#h18-0-33" id="h18-0-33" class="d">-                    .columns
</a><a href="#h18-0-34" id="h18-0-34" class="d">-                    .iter()
</a><a href="#h18-0-35" id="h18-0-35" class="d">-                    .map(|c| Column { relation: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h18-0-36" id="h18-0-36" class="d">-                    .collect(),
</a><a href="#h18-0-37" id="h18-0-37" class="d">-                rows: Some(Box::new(ctx.txn.scan(&amp;table.name, self.filter)?)),
</a><a href="#h18-0-38" id="h18-0-38" class="d">-            },
</a><a href="#h18-0-39" id="h18-0-39" class="i">+            columns: table
</a><a href="#h18-0-40" id="h18-0-40" class="i">+                .columns
</a><a href="#h18-0-41" id="h18-0-41" class="i">+                .iter()
</a><a href="#h18-0-42" id="h18-0-42" class="i">+                .map(|c| Column { table: Some(self.label.clone()), name: Some(c.name.clone()) })
</a><a href="#h18-0-43" id="h18-0-43" class="i">+                .collect(),
</a><a href="#h18-0-44" id="h18-0-44" class="i">+            rows: Box::new(ctx.txn.scan(&amp;table.name, self.filter)?),
</a>         })
     }
 }
<b>diff --git a/<a id="h19" href="../file/src/sql/execution/update.rs.html">src/sql/execution/update.rs</a> b/<a href="../file/src/sql/execution/update.rs.html">src/sql/execution/update.rs</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -29,7 +29,7 @@ impl&lt;T: Transaction&gt; Update&lt;T&gt; {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Update&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet&gt; {
         match self.source.execute(ctx)? {
<a href="#h19-0-3" id="h19-0-3" class="d">-            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h19-0-4" id="h19-0-4" class="i">+            ResultSet::Query { mut rows, .. } =&gt; {
</a>                 let table = ctx.txn.must_read_table(&amp;self.table)?;
 
                 // The iterator will see our changes, such that the same item may be iterated over
<a href="#h19-1" id="h19-1" class="h">@@ -40,15 +40,14 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Update&lt;T&gt; {
</a>                 // multiple times - it should be possible to come up with a pathological case that
                 // loops forever (e.g. UPDATE test SET id = id + 1).
                 let mut updated = HashSet::new();
<a href="#h19-1-3" id="h19-1-3" class="d">-                while let Some(row) = relation.next().transpose()? {
</a><a href="#h19-1-4" id="h19-1-4" class="i">+                while let Some(row) = rows.next().transpose()? {
</a>                     let id = table.get_row_key(&amp;row)?;
                     if updated.contains(&amp;id) {
                         continue;
                     }
<a href="#h19-1-9" id="h19-1-9" class="d">-                    let env = table.row_env(&amp;row);
</a>                     let mut new = row.clone();
                     for (field, expr) in &amp;self.expressions {
<a href="#h19-1-12" id="h19-1-12" class="d">-                        table.set_row_field(&amp;mut new, field, expr.evaluate(&amp;env)?)?;
</a><a href="#h19-1-13" id="h19-1-13" class="i">+                        table.set_row_field(&amp;mut new, field, expr.evaluate(Some(&amp;row))?)?;
</a>                     }
                     ctx.txn.update(&amp;table.name, &amp;id, new)?;
                     updated.insert(id);
<b>diff --git a/<a id="h20" href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a> b/<a href="../file/src/sql/parser/ast.rs.html">src/sql/parser/ast.rs</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,6 +1,8 @@
</a> use super::super::types::DataType;
<a href="#h20-0-1" id="h20-0-1" class="i">+use crate::error::Result;
</a> 
 use std::collections::BTreeMap;
<a href="#h20-0-4" id="h20-0-4" class="i">+use std::mem::replace;
</a> 
 /// Statements
 #[derive(Clone, Debug, PartialEq)]
<a href="#h20-1" id="h20-1" class="h">@@ -114,6 +116,7 @@ pub enum Order {
</a> #[derive(Clone, Debug, PartialEq)]
 pub enum Expression {
     Field(Option&lt;String&gt;, String),
<a href="#h20-1-3" id="h20-1-3" class="i">+    Column(usize), // only used during plan building to break off expression subtrees
</a>     Literal(Literal),
     Function(String, Expressions),
     Operation(Operation),
<a href="#h20-2" id="h20-2" class="h">@@ -174,3 +177,107 @@ pub enum Operation {
</a>     // String operators
     Like(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
 }
<a href="#h20-2-3" id="h20-2-3" class="i">+
</a><a href="#h20-2-4" id="h20-2-4" class="i">+impl Expression {
</a><a href="#h20-2-5" id="h20-2-5" class="i">+    /// Walks the expression tree while calling a closure. Returns true as soon as the closure
</a><a href="#h20-2-6" id="h20-2-6" class="i">+    /// returns true. This is the inverse of walk().
</a><a href="#h20-2-7" id="h20-2-7" class="i">+    pub fn contains&lt;F: Fn(&amp;Expression) -&gt; bool&gt;(&amp;self, visitor: &amp;F) -&gt; bool {
</a><a href="#h20-2-8" id="h20-2-8" class="i">+        !self.walk(&amp;|e| !visitor(e))
</a><a href="#h20-2-9" id="h20-2-9" class="i">+    }
</a><a href="#h20-2-10" id="h20-2-10" class="i">+
</a><a href="#h20-2-11" id="h20-2-11" class="i">+    /// Replaces the expression with result of the closure. Mosty helper function for transform().
</a><a href="#h20-2-12" id="h20-2-12" class="i">+    pub fn replace_with&lt;F: FnMut(Self) -&gt; Result&lt;Self&gt;&gt;(&amp;mut self, mut f: F) -&gt; Result&lt;()&gt; {
</a><a href="#h20-2-13" id="h20-2-13" class="i">+        // Temporarily replace expression with a null value, in case closure panics. May consider
</a><a href="#h20-2-14" id="h20-2-14" class="i">+        // replace_with crate if this hampers performance.
</a><a href="#h20-2-15" id="h20-2-15" class="i">+        let expr = replace(self, Expression::Literal(Literal::Null));
</a><a href="#h20-2-16" id="h20-2-16" class="i">+        replace(self, f(expr)?);
</a><a href="#h20-2-17" id="h20-2-17" class="i">+        Ok(())
</a><a href="#h20-2-18" id="h20-2-18" class="i">+    }
</a><a href="#h20-2-19" id="h20-2-19" class="i">+
</a><a href="#h20-2-20" id="h20-2-20" class="i">+    /// Transforms the expression tree by applying a closure before and after descending.
</a><a href="#h20-2-21" id="h20-2-21" class="i">+    pub fn transform&lt;B, A&gt;(mut self, before: &amp;mut B, after: &amp;mut A) -&gt; Result&lt;Self&gt;
</a><a href="#h20-2-22" id="h20-2-22" class="i">+    where
</a><a href="#h20-2-23" id="h20-2-23" class="i">+        B: FnMut(Self) -&gt; Result&lt;Self&gt;,
</a><a href="#h20-2-24" id="h20-2-24" class="i">+        A: FnMut(Self) -&gt; Result&lt;Self&gt;,
</a><a href="#h20-2-25" id="h20-2-25" class="i">+    {
</a><a href="#h20-2-26" id="h20-2-26" class="i">+        use Operation::*;
</a><a href="#h20-2-27" id="h20-2-27" class="i">+        self = before(self)?;
</a><a href="#h20-2-28" id="h20-2-28" class="i">+        match &amp;mut self {
</a><a href="#h20-2-29" id="h20-2-29" class="i">+            Self::Operation(Add(lhs, rhs))
</a><a href="#h20-2-30" id="h20-2-30" class="i">+            | Self::Operation(And(lhs, rhs))
</a><a href="#h20-2-31" id="h20-2-31" class="i">+            | Self::Operation(Divide(lhs, rhs))
</a><a href="#h20-2-32" id="h20-2-32" class="i">+            | Self::Operation(Equal(lhs, rhs))
</a><a href="#h20-2-33" id="h20-2-33" class="i">+            | Self::Operation(Exponentiate(lhs, rhs))
</a><a href="#h20-2-34" id="h20-2-34" class="i">+            | Self::Operation(GreaterThan(lhs, rhs))
</a><a href="#h20-2-35" id="h20-2-35" class="i">+            | Self::Operation(GreaterThanOrEqual(lhs, rhs))
</a><a href="#h20-2-36" id="h20-2-36" class="i">+            | Self::Operation(LessThan(lhs, rhs))
</a><a href="#h20-2-37" id="h20-2-37" class="i">+            | Self::Operation(LessThanOrEqual(lhs, rhs))
</a><a href="#h20-2-38" id="h20-2-38" class="i">+            | Self::Operation(Like(lhs, rhs))
</a><a href="#h20-2-39" id="h20-2-39" class="i">+            | Self::Operation(Modulo(lhs, rhs))
</a><a href="#h20-2-40" id="h20-2-40" class="i">+            | Self::Operation(Multiply(lhs, rhs))
</a><a href="#h20-2-41" id="h20-2-41" class="i">+            | Self::Operation(NotEqual(lhs, rhs))
</a><a href="#h20-2-42" id="h20-2-42" class="i">+            | Self::Operation(Or(lhs, rhs))
</a><a href="#h20-2-43" id="h20-2-43" class="i">+            | Self::Operation(Subtract(lhs, rhs)) =&gt; {
</a><a href="#h20-2-44" id="h20-2-44" class="i">+                Self::replace_with(lhs, |e| e.transform(before, after))?;
</a><a href="#h20-2-45" id="h20-2-45" class="i">+                Self::replace_with(rhs, |e| e.transform(before, after))?;
</a><a href="#h20-2-46" id="h20-2-46" class="i">+            }
</a><a href="#h20-2-47" id="h20-2-47" class="i">+
</a><a href="#h20-2-48" id="h20-2-48" class="i">+            Self::Operation(Assert(expr))
</a><a href="#h20-2-49" id="h20-2-49" class="i">+            | Self::Operation(Factorial(expr))
</a><a href="#h20-2-50" id="h20-2-50" class="i">+            | Self::Operation(IsNull(expr))
</a><a href="#h20-2-51" id="h20-2-51" class="i">+            | Self::Operation(Negate(expr))
</a><a href="#h20-2-52" id="h20-2-52" class="i">+            | Self::Operation(Not(expr)) =&gt; {
</a><a href="#h20-2-53" id="h20-2-53" class="i">+                Self::replace_with(expr, |e| e.transform(before, after))?
</a><a href="#h20-2-54" id="h20-2-54" class="i">+            }
</a><a href="#h20-2-55" id="h20-2-55" class="i">+
</a><a href="#h20-2-56" id="h20-2-56" class="i">+            Self::Function(_, exprs) =&gt; {
</a><a href="#h20-2-57" id="h20-2-57" class="i">+                for expr in exprs {
</a><a href="#h20-2-58" id="h20-2-58" class="i">+                    Self::replace_with(expr, |e| e.transform(before, after))?;
</a><a href="#h20-2-59" id="h20-2-59" class="i">+                }
</a><a href="#h20-2-60" id="h20-2-60" class="i">+            }
</a><a href="#h20-2-61" id="h20-2-61" class="i">+
</a><a href="#h20-2-62" id="h20-2-62" class="i">+            Self::Literal(_) | Self::Field(_, _) | Self::Column(_) =&gt; {}
</a><a href="#h20-2-63" id="h20-2-63" class="i">+        };
</a><a href="#h20-2-64" id="h20-2-64" class="i">+        after(self)
</a><a href="#h20-2-65" id="h20-2-65" class="i">+    }
</a><a href="#h20-2-66" id="h20-2-66" class="i">+
</a><a href="#h20-2-67" id="h20-2-67" class="i">+    /// Walks the expression tree, calling a closure for every node. Halts if closure returns false.
</a><a href="#h20-2-68" id="h20-2-68" class="i">+    pub fn walk&lt;F: Fn(&amp;Expression) -&gt; bool&gt;(&amp;self, visitor: &amp;F) -&gt; bool {
</a><a href="#h20-2-69" id="h20-2-69" class="i">+        use Operation::*;
</a><a href="#h20-2-70" id="h20-2-70" class="i">+        visitor(self)
</a><a href="#h20-2-71" id="h20-2-71" class="i">+            &amp;&amp; match self {
</a><a href="#h20-2-72" id="h20-2-72" class="i">+                Self::Operation(Add(lhs, rhs))
</a><a href="#h20-2-73" id="h20-2-73" class="i">+                | Self::Operation(And(lhs, rhs))
</a><a href="#h20-2-74" id="h20-2-74" class="i">+                | Self::Operation(Divide(lhs, rhs))
</a><a href="#h20-2-75" id="h20-2-75" class="i">+                | Self::Operation(Equal(lhs, rhs))
</a><a href="#h20-2-76" id="h20-2-76" class="i">+                | Self::Operation(Exponentiate(lhs, rhs))
</a><a href="#h20-2-77" id="h20-2-77" class="i">+                | Self::Operation(GreaterThan(lhs, rhs))
</a><a href="#h20-2-78" id="h20-2-78" class="i">+                | Self::Operation(GreaterThanOrEqual(lhs, rhs))
</a><a href="#h20-2-79" id="h20-2-79" class="i">+                | Self::Operation(LessThan(lhs, rhs))
</a><a href="#h20-2-80" id="h20-2-80" class="i">+                | Self::Operation(LessThanOrEqual(lhs, rhs))
</a><a href="#h20-2-81" id="h20-2-81" class="i">+                | Self::Operation(Like(lhs, rhs))
</a><a href="#h20-2-82" id="h20-2-82" class="i">+                | Self::Operation(Modulo(lhs, rhs))
</a><a href="#h20-2-83" id="h20-2-83" class="i">+                | Self::Operation(Multiply(lhs, rhs))
</a><a href="#h20-2-84" id="h20-2-84" class="i">+                | Self::Operation(NotEqual(lhs, rhs))
</a><a href="#h20-2-85" id="h20-2-85" class="i">+                | Self::Operation(Or(lhs, rhs))
</a><a href="#h20-2-86" id="h20-2-86" class="i">+                | Self::Operation(Subtract(lhs, rhs)) =&gt; lhs.walk(visitor) &amp;&amp; rhs.walk(visitor),
</a><a href="#h20-2-87" id="h20-2-87" class="i">+
</a><a href="#h20-2-88" id="h20-2-88" class="i">+                Self::Operation(Assert(expr))
</a><a href="#h20-2-89" id="h20-2-89" class="i">+                | Self::Operation(Factorial(expr))
</a><a href="#h20-2-90" id="h20-2-90" class="i">+                | Self::Operation(IsNull(expr))
</a><a href="#h20-2-91" id="h20-2-91" class="i">+                | Self::Operation(Negate(expr))
</a><a href="#h20-2-92" id="h20-2-92" class="i">+                | Self::Operation(Not(expr)) =&gt; expr.walk(visitor),
</a><a href="#h20-2-93" id="h20-2-93" class="i">+
</a><a href="#h20-2-94" id="h20-2-94" class="i">+                Self::Function(_, exprs) =&gt; {
</a><a href="#h20-2-95" id="h20-2-95" class="i">+                    for expr in exprs {
</a><a href="#h20-2-96" id="h20-2-96" class="i">+                        if !expr.walk(visitor) {
</a><a href="#h20-2-97" id="h20-2-97" class="i">+                            return false;
</a><a href="#h20-2-98" id="h20-2-98" class="i">+                        }
</a><a href="#h20-2-99" id="h20-2-99" class="i">+                    }
</a><a href="#h20-2-100" id="h20-2-100" class="i">+                    true
</a><a href="#h20-2-101" id="h20-2-101" class="i">+                }
</a><a href="#h20-2-102" id="h20-2-102" class="i">+
</a><a href="#h20-2-103" id="h20-2-103" class="i">+                Self::Literal(_) | Self::Field(_, _) | Self::Column(_) =&gt; true,
</a><a href="#h20-2-104" id="h20-2-104" class="i">+            }
</a><a href="#h20-2-105" id="h20-2-105" class="i">+    }
</a><a href="#h20-2-106" id="h20-2-106" class="i">+}
</a><b>diff --git a/<a id="h21" href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a> b/<a href="../file/src/sql/plan/mod.rs.html">src/sql/plan/mod.rs</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -19,8 +19,8 @@ pub struct Plan(pub Node);
</a> 
 impl Plan {
     /// Builds a plan from an AST statement
<a href="#h21-0-3" id="h21-0-3" class="d">-    pub fn build(statement: ast::Statement) -&gt; Result&lt;Self&gt; {
</a><a href="#h21-0-4" id="h21-0-4" class="d">-        Planner::new().build(statement)
</a><a href="#h21-0-5" id="h21-0-5" class="i">+    pub fn build(statement: ast::Statement, catalog: &amp;mut dyn Catalog) -&gt; Result&lt;Self&gt; {
</a><a href="#h21-0-6" id="h21-0-6" class="i">+        Planner::new(catalog).build(statement)
</a>     }
 
     /// Executes the plan, consuming it
<a href="#h21-1" id="h21-1" class="h">@@ -102,7 +102,7 @@ pub enum Node {
</a>     },
     Scan {
         table: String,
<a href="#h21-1-3" id="h21-1-3" class="d">-        alias: Option&lt;String&gt;,
</a><a href="#h21-1-4" id="h21-1-4" class="i">+        label: String,
</a>         filter: Option&lt;Expression&gt;,
     },
     // Uses BTreeMap for test stability
<a href="#h21-2" id="h21-2" class="h">@@ -211,8 +211,8 @@ impl Node {
</a>                     .map(|e| e.transform(pre, post))
                     .collect::&lt;Result&lt;_&gt;&gt;()?,
             },
<a href="#h21-2-3" id="h21-2-3" class="d">-            Self::Scan { table, alias, filter: Some(filter) } =&gt; {
</a><a href="#h21-2-4" id="h21-2-4" class="d">-                Self::Scan { table, alias, filter: Some(filter.transform(pre, post)?) }
</a><a href="#h21-2-5" id="h21-2-5" class="i">+            Self::Scan { table, label, filter: Some(filter) } =&gt; {
</a><a href="#h21-2-6" id="h21-2-6" class="i">+                Self::Scan { table, label, filter: Some(filter.transform(pre, post)?) }
</a>             }
             Self::Update { table, source, expressions } =&gt; Self::Update {
                 table,
<a href="#h21-3" id="h21-3" class="h">@@ -244,12 +244,3 @@ pub enum Direction {
</a>     Ascending,
     Descending,
 }
<a href="#h21-3-3" id="h21-3-3" class="d">-
</a><a href="#h21-3-4" id="h21-3-4" class="d">-impl From&lt;ast::Order&gt; for Direction {
</a><a href="#h21-3-5" id="h21-3-5" class="d">-    fn from(order: ast::Order) -&gt; Self {
</a><a href="#h21-3-6" id="h21-3-6" class="d">-        match order {
</a><a href="#h21-3-7" id="h21-3-7" class="d">-            ast::Order::Ascending =&gt; Self::Ascending,
</a><a href="#h21-3-8" id="h21-3-8" class="d">-            ast::Order::Descending =&gt; Self::Descending,
</a><a href="#h21-3-9" id="h21-3-9" class="d">-        }
</a><a href="#h21-3-10" id="h21-3-10" class="d">-    }
</a><a href="#h21-3-11" id="h21-3-11" class="d">-}
</a><b>diff --git a/<a id="h22" href="../file/src/sql/plan/optimizer.rs.html">src/sql/plan/optimizer.rs</a> b/<a href="../file/src/sql/plan/optimizer.rs.html">src/sql/plan/optimizer.rs</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,26 +1,22 @@
</a> use super::super::schema::Catalog;
<a href="#h22-0-1" id="h22-0-1" class="d">-use super::super::types::{Environment, Expression, Value};
</a><a href="#h22-0-2" id="h22-0-2" class="i">+use super::super::types::{Expression, Value};
</a> use super::Node;
 use crate::error::Result;
 
<a href="#h22-0-6" id="h22-0-6" class="d">-use std::collections::HashMap;
</a><a href="#h22-0-7" id="h22-0-7" class="d">-
</a> /// A plan optimizer
 pub trait Optimizer {
     fn optimize(&amp;mut self, node: Node) -&gt; Result&lt;Node&gt;;
 }
 
<a href="#h22-0-13" id="h22-0-13" class="d">-/// A constant folding optimizer, which replaces constant expressions
</a><a href="#h22-0-14" id="h22-0-14" class="d">-/// with their evaluated value, to prevent it from being re-evaluated
</a><a href="#h22-0-15" id="h22-0-15" class="d">-/// over and over again during plan execution.
</a><a href="#h22-0-16" id="h22-0-16" class="i">+/// A constant folding optimizer, which replaces constant expressions with their evaluated value, to
</a><a href="#h22-0-17" id="h22-0-17" class="i">+/// prevent it from being re-evaluated over and over again during plan execution.
</a> pub struct ConstantFolder;
 
 impl Optimizer for ConstantFolder {
     fn optimize(&amp;mut self, node: Node) -&gt; Result&lt;Node&gt; {
<a href="#h22-0-22" id="h22-0-22" class="d">-        let env = Environment::new();
</a>         node.transform(&amp;|n| Ok(n), &amp;|n| {
             n.transform_expressions(&amp;|e| Ok(e), &amp;|e| {
<a href="#h22-0-25" id="h22-0-25" class="d">-                Ok(if e.is_constant() { Expression::Constant(e.evaluate(&amp;env)?) } else { e })
</a><a href="#h22-0-26" id="h22-0-26" class="i">+                Ok(if e.is_constant() { Expression::Constant(e.evaluate(None)?) } else { e })
</a>             })
         })
     }
<a href="#h22-1" id="h22-1" class="h">@@ -48,17 +44,11 @@ impl FilterPushdown {
</a>         Ok(match target {
             // Filter nodes immediately before a scan node can be trivially pushed down, as long as
             // we remove any field qualifyers (e.g. movies table aliased as m).
<a href="#h22-1-3" id="h22-1-3" class="d">-            Node::Scan { table, alias, filter } =&gt; {
</a><a href="#h22-1-4" id="h22-1-4" class="d">-                let mut map = HashMap::new();
</a><a href="#h22-1-5" id="h22-1-5" class="d">-                map.insert(Some(table.clone()), None);
</a><a href="#h22-1-6" id="h22-1-6" class="d">-                if let Some(alias) = &amp;alias {
</a><a href="#h22-1-7" id="h22-1-7" class="d">-                    map.insert(Some(alias.clone()), None);
</a><a href="#h22-1-8" id="h22-1-8" class="d">-                }
</a><a href="#h22-1-9" id="h22-1-9" class="d">-                predicate = predicate.transform(&amp;|e| Self::requalify(e, &amp;map), &amp;|e| Ok(e))?;
</a><a href="#h22-1-10" id="h22-1-10" class="i">+            Node::Scan { table, label, filter } =&gt; {
</a>                 if let Some(filter) = filter {
                     predicate = Expression::And(Box::new(predicate), Box::new(filter))
                 }
<a href="#h22-1-14" id="h22-1-14" class="d">-                Node::Scan { table, alias, filter: Some(predicate) }
</a><a href="#h22-1-15" id="h22-1-15" class="i">+                Node::Scan { table, label, filter: Some(predicate) }
</a>             }
             // Filter nodes immediately before a nested loop join can be trivially pushed down.
             Node::NestedLoopJoin { outer, inner, predicate: join_predicate, pad, flip } =&gt; {
<a href="#h22-2" id="h22-2" class="h">@@ -70,21 +60,6 @@ impl FilterPushdown {
</a>             n =&gt; Node::Filter { predicate, source: Box::new(n) },
         })
     }
<a href="#h22-2-3" id="h22-2-3" class="d">-
</a><a href="#h22-2-4" id="h22-2-4" class="d">-    /// Rewrites field relations, e.g. for mapping &quot;movies.id&quot; or &quot;m.id&quot; to &quot;id&quot;. If a field
</a><a href="#h22-2-5" id="h22-2-5" class="d">-    /// cannot be rewritten, the original field is returned (to propagate errors).
</a><a href="#h22-2-6" id="h22-2-6" class="d">-    fn requalify(
</a><a href="#h22-2-7" id="h22-2-7" class="d">-        expr: Expression,
</a><a href="#h22-2-8" id="h22-2-8" class="d">-        map: &amp;HashMap&lt;Option&lt;String&gt;, Option&lt;String&gt;&gt;,
</a><a href="#h22-2-9" id="h22-2-9" class="d">-    ) -&gt; Result&lt;Expression&gt; {
</a><a href="#h22-2-10" id="h22-2-10" class="d">-        Ok(match expr {
</a><a href="#h22-2-11" id="h22-2-11" class="d">-            Expression::Field(relation, name) =&gt; match map.get(&amp;relation) {
</a><a href="#h22-2-12" id="h22-2-12" class="d">-                Some(mapped) =&gt; Expression::Field(mapped.clone(), name),
</a><a href="#h22-2-13" id="h22-2-13" class="d">-                None =&gt; Expression::Field(relation, name),
</a><a href="#h22-2-14" id="h22-2-14" class="d">-            },
</a><a href="#h22-2-15" id="h22-2-15" class="d">-            expr =&gt; expr,
</a><a href="#h22-2-16" id="h22-2-16" class="d">-        })
</a><a href="#h22-2-17" id="h22-2-17" class="d">-    }
</a> }
 
 /// An index lookup optimizer, which converts table scans to index lookups or scans.
<a href="#h22-3" id="h22-3" class="h">@@ -97,12 +72,12 @@ impl&lt;&#39;a, C: Catalog&gt; IndexLookup&lt;&#39;a, C&gt; {
</a>         Self { catalog }
     }
 
<a href="#h22-3-3" id="h22-3-3" class="d">-    pub fn is_lookup(column: &amp;str, expr: &amp;Expression) -&gt; Option&lt;Value&gt; {
</a><a href="#h22-3-4" id="h22-3-4" class="i">+    pub fn is_lookup(field: usize, expr: &amp;Expression) -&gt; Option&lt;Value&gt; {
</a>         if let Expression::Equal(lhs, rhs) = expr {
             match (*lhs.clone(), *rhs.clone()) {
<a href="#h22-3-7" id="h22-3-7" class="d">-                (Expression::Field(None, name), Expression::Constant(v))
</a><a href="#h22-3-8" id="h22-3-8" class="d">-                | (Expression::Constant(v), Expression::Field(None, name))
</a><a href="#h22-3-9" id="h22-3-9" class="d">-                    if name == column =&gt;
</a><a href="#h22-3-10" id="h22-3-10" class="i">+                (Expression::Field(i, _), Expression::Constant(v))
</a><a href="#h22-3-11" id="h22-3-11" class="i">+                | (Expression::Constant(v), Expression::Field(i, _))
</a><a href="#h22-3-12" id="h22-3-12" class="i">+                    if field == i =&gt;
</a>                 {
                     // FIXME Handle IS NULL instead
                     return match v {
<a href="#h22-4" id="h22-4" class="h">@@ -122,18 +97,21 @@ impl&lt;&#39;a, C: Catalog&gt; Optimizer for IndexLookup&lt;&#39;a, C&gt; {
</a>         node.transform(
             &amp;|n| match n {
                 // FIXME This needs to be smarter - at least handle ORs. Could be prettier too.
<a href="#h22-4-3" id="h22-4-3" class="d">-                Node::Scan { table, alias, filter: Some(expr @ Expression::Equal(_, _)) } =&gt; {
</a><a href="#h22-4-4" id="h22-4-4" class="i">+                Node::Scan { table, label, filter: Some(expr @ Expression::Equal(_, _)) } =&gt; {
</a>                     if let Some(table) = self.catalog.read_table(&amp;table)? {
<a href="#h22-4-6" id="h22-4-6" class="d">-                        let pk = table.get_primary_key()?.name.clone();
</a><a href="#h22-4-7" id="h22-4-7" class="d">-                        if let Some(value) = Self::is_lookup(&amp;pk, &amp;expr) {
</a><a href="#h22-4-8" id="h22-4-8" class="i">+                        let pk = table.get_column_index(&amp;table.get_primary_key()?.name)?;
</a><a href="#h22-4-9" id="h22-4-9" class="i">+                        let alias = if label != table.name { Some(label.clone()) } else { None }; // FIXME
</a><a href="#h22-4-10" id="h22-4-10" class="i">+                        if let Some(value) = Self::is_lookup(pk, &amp;expr) {
</a>                             return Ok(Node::KeyLookup {
                                 table: table.name,
                                 alias,
                                 keys: vec![value],
                             });
                         }
<a href="#h22-4-17" id="h22-4-17" class="d">-                        for column in table.columns.into_iter().filter(|c| c.index) {
</a><a href="#h22-4-18" id="h22-4-18" class="d">-                            if let Some(value) = Self::is_lookup(&amp;column.name, &amp;expr) {
</a><a href="#h22-4-19" id="h22-4-19" class="i">+                        for (i, column) in
</a><a href="#h22-4-20" id="h22-4-20" class="i">+                            table.columns.into_iter().enumerate().filter(|(_, c)| c.index)
</a><a href="#h22-4-21" id="h22-4-21" class="i">+                        {
</a><a href="#h22-4-22" id="h22-4-22" class="i">+                            if let Some(value) = Self::is_lookup(i, &amp;expr) {
</a>                                 return Ok(Node::IndexLookup {
                                     table: table.name,
                                     alias,
<a href="#h22-5" id="h22-5" class="h">@@ -143,7 +121,7 @@ impl&lt;&#39;a, C: Catalog&gt; Optimizer for IndexLookup&lt;&#39;a, C&gt; {
</a>                             }
                         }
                     }
<a href="#h22-5-3" id="h22-5-3" class="d">-                    Ok(Node::Scan { table, alias, filter: Some(expr) })
</a><a href="#h22-5-4" id="h22-5-4" class="i">+                    Ok(Node::Scan { table, label, filter: Some(expr) })
</a>                 }
                 n =&gt; Ok(n),
             },
<b>diff --git a/<a id="h23" href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a> b/<a href="../file/src/sql/plan/planner.rs.html">src/sql/plan/planner.rs</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -1,58 +1,125 @@
</a> use super::super::parser::ast;
<a href="#h23-0-1" id="h23-0-1" class="d">-use super::super::schema;
</a><a href="#h23-0-2" id="h23-0-2" class="d">-use super::super::types::{Environment, Expression, Expressions, Value};
</a><a href="#h23-0-3" id="h23-0-3" class="d">-use super::{Aggregate, Aggregates, Node, Plan};
</a><a href="#h23-0-4" id="h23-0-4" class="i">+use super::super::schema::{Catalog, Column, Table};
</a><a href="#h23-0-5" id="h23-0-5" class="i">+use super::super::types::{Expression, Expressions, Value};
</a><a href="#h23-0-6" id="h23-0-6" class="i">+use super::{Aggregate, Direction, Node, Plan};
</a> use crate::error::{Error, Result};
 
<a href="#h23-0-9" id="h23-0-9" class="i">+use std::collections::{HashMap, HashSet};
</a><a href="#h23-0-10" id="h23-0-10" class="i">+use std::mem::replace;
</a><a href="#h23-0-11" id="h23-0-11" class="i">+
</a> /// The plan builder
<a href="#h23-0-13" id="h23-0-13" class="d">-pub struct Planner {}
</a><a href="#h23-0-14" id="h23-0-14" class="i">+pub struct Planner&lt;&#39;a&gt; {
</a><a href="#h23-0-15" id="h23-0-15" class="i">+    catalog: &amp;&#39;a mut dyn Catalog,
</a><a href="#h23-0-16" id="h23-0-16" class="i">+}
</a> 
<a href="#h23-0-18" id="h23-0-18" class="d">-impl Planner {
</a><a href="#h23-0-19" id="h23-0-19" class="i">+impl&lt;&#39;a&gt; Planner&lt;&#39;a&gt; {
</a>     /// Creates a new planner
<a href="#h23-0-21" id="h23-0-21" class="d">-    pub fn new() -&gt; Self {
</a><a href="#h23-0-22" id="h23-0-22" class="d">-        Self {}
</a><a href="#h23-0-23" id="h23-0-23" class="i">+    pub fn new(catalog: &amp;&#39;a mut dyn Catalog) -&gt; Self {
</a><a href="#h23-0-24" id="h23-0-24" class="i">+        Self { catalog }
</a>     }
 
     /// Builds a plan tree for an AST statement
<a href="#h23-0-28" id="h23-0-28" class="d">-    pub fn build(&amp;self, statement: ast::Statement) -&gt; Result&lt;Plan&gt; {
</a><a href="#h23-0-29" id="h23-0-29" class="i">+    pub fn build(&amp;mut self, statement: ast::Statement) -&gt; Result&lt;Plan&gt; {
</a>         Ok(Plan(self.build_statement(statement)?))
     }
 
     /// Builds a plan node for a statement
<a href="#h23-0-34" id="h23-0-34" class="d">-    fn build_statement(&amp;self, statement: ast::Statement) -&gt; Result&lt;Node&gt; {
</a><a href="#h23-0-35" id="h23-0-35" class="i">+    fn build_statement(&amp;mut self, statement: ast::Statement) -&gt; Result&lt;Node&gt; {
</a>         Ok(match statement {
<a href="#h23-0-37" id="h23-0-37" class="i">+            // Transaction control and explain statements should be handled by session.
</a>             ast::Statement::Begin { .. } | ast::Statement::Commit | ast::Statement::Rollback =&gt; {
                 return Err(Error::Internal(format!(
                     &quot;Unexpected transaction statement {:?}&quot;,
                     statement
                 )))
             }
<a href="#h23-0-44" id="h23-0-44" class="i">+
</a>             ast::Statement::Explain(_) =&gt; {
                 return Err(Error::Internal(&quot;Unexpected explain statement&quot;.into()))
             }
<a href="#h23-0-48" id="h23-0-48" class="d">-            ast::Statement::CreateTable { name, columns } =&gt; {
</a><a href="#h23-0-49" id="h23-0-49" class="d">-                Node::CreateTable { schema: self.build_schema_table(name, columns)? }
</a><a href="#h23-0-50" id="h23-0-50" class="d">-            }
</a><a href="#h23-0-51" id="h23-0-51" class="d">-            ast::Statement::Delete { table, r#where } =&gt; Node::Delete {
</a><a href="#h23-0-52" id="h23-0-52" class="d">-                table: table.clone(),
</a><a href="#h23-0-53" id="h23-0-53" class="d">-                source: Box::new(Node::Scan {
</a><a href="#h23-0-54" id="h23-0-54" class="d">-                    table,
</a><a href="#h23-0-55" id="h23-0-55" class="d">-                    alias: None,
</a><a href="#h23-0-56" id="h23-0-56" class="d">-                    filter: match r#where {
</a><a href="#h23-0-57" id="h23-0-57" class="d">-                        Some(ast::WhereClause(expr)) =&gt; Some(self.build_expression(expr)?),
</a><a href="#h23-0-58" id="h23-0-58" class="d">-                        None =&gt; None,
</a><a href="#h23-0-59" id="h23-0-59" class="d">-                    },
</a><a href="#h23-0-60" id="h23-0-60" class="d">-                }),
</a><a href="#h23-0-61" id="h23-0-61" class="i">+
</a><a href="#h23-0-62" id="h23-0-62" class="i">+            // Data definition language.
</a><a href="#h23-0-63" id="h23-0-63" class="i">+            ast::Statement::CreateTable { name, columns } =&gt; Node::CreateTable {
</a><a href="#h23-0-64" id="h23-0-64" class="i">+                schema: Table::new(
</a><a href="#h23-0-65" id="h23-0-65" class="i">+                    name,
</a><a href="#h23-0-66" id="h23-0-66" class="i">+                    columns
</a><a href="#h23-0-67" id="h23-0-67" class="i">+                        .into_iter()
</a><a href="#h23-0-68" id="h23-0-68" class="i">+                        .map(|c| {
</a><a href="#h23-0-69" id="h23-0-69" class="i">+                            let nullable = c.nullable.unwrap_or(!c.primary_key);
</a><a href="#h23-0-70" id="h23-0-70" class="i">+                            let default = match c.default {
</a><a href="#h23-0-71" id="h23-0-71" class="i">+                                Some(expr) =&gt; {
</a><a href="#h23-0-72" id="h23-0-72" class="i">+                                    Some(self.build_expression_constant(expr)?.evaluate(None)?)
</a><a href="#h23-0-73" id="h23-0-73" class="i">+                                }
</a><a href="#h23-0-74" id="h23-0-74" class="i">+                                None if nullable =&gt; Some(Value::Null),
</a><a href="#h23-0-75" id="h23-0-75" class="i">+                                None =&gt; None,
</a><a href="#h23-0-76" id="h23-0-76" class="i">+                            };
</a><a href="#h23-0-77" id="h23-0-77" class="i">+                            Ok(Column {
</a><a href="#h23-0-78" id="h23-0-78" class="i">+                                name: c.name,
</a><a href="#h23-0-79" id="h23-0-79" class="i">+                                datatype: c.datatype,
</a><a href="#h23-0-80" id="h23-0-80" class="i">+                                primary_key: c.primary_key,
</a><a href="#h23-0-81" id="h23-0-81" class="i">+                                nullable,
</a><a href="#h23-0-82" id="h23-0-82" class="i">+                                default,
</a><a href="#h23-0-83" id="h23-0-83" class="i">+                                index: c.index &amp;&amp; !c.primary_key,
</a><a href="#h23-0-84" id="h23-0-84" class="i">+                                unique: c.unique || c.primary_key,
</a><a href="#h23-0-85" id="h23-0-85" class="i">+                                references: c.references,
</a><a href="#h23-0-86" id="h23-0-86" class="i">+                            })
</a><a href="#h23-0-87" id="h23-0-87" class="i">+                        })
</a><a href="#h23-0-88" id="h23-0-88" class="i">+                        .collect::&lt;Result&lt;_&gt;&gt;()?,
</a><a href="#h23-0-89" id="h23-0-89" class="i">+                )?,
</a>             },
<a href="#h23-0-91" id="h23-0-91" class="i">+
</a>             ast::Statement::DropTable(name) =&gt; Node::DropTable { name },
<a href="#h23-0-93" id="h23-0-93" class="i">+
</a><a href="#h23-0-94" id="h23-0-94" class="i">+            // Data modification language.
</a><a href="#h23-0-95" id="h23-0-95" class="i">+            // FIXME Delete and update should handle aliases in the same way as select
</a><a href="#h23-0-96" id="h23-0-96" class="i">+            ast::Statement::Delete { table, r#where } =&gt; {
</a><a href="#h23-0-97" id="h23-0-97" class="i">+                let scope = &amp;mut Scope::from_table(self.catalog.must_read_table(&amp;table)?)?;
</a><a href="#h23-0-98" id="h23-0-98" class="i">+                Node::Delete {
</a><a href="#h23-0-99" id="h23-0-99" class="i">+                    table: table.clone(),
</a><a href="#h23-0-100" id="h23-0-100" class="i">+                    source: Box::new(Node::Scan {
</a><a href="#h23-0-101" id="h23-0-101" class="i">+                        label: table.clone(),
</a><a href="#h23-0-102" id="h23-0-102" class="i">+                        table,
</a><a href="#h23-0-103" id="h23-0-103" class="i">+                        filter: match r#where {
</a><a href="#h23-0-104" id="h23-0-104" class="i">+                            Some(ast::WhereClause(expr)) =&gt; {
</a><a href="#h23-0-105" id="h23-0-105" class="i">+                                Some(self.build_expression(scope, expr)?)
</a><a href="#h23-0-106" id="h23-0-106" class="i">+                            }
</a><a href="#h23-0-107" id="h23-0-107" class="i">+                            None =&gt; None,
</a><a href="#h23-0-108" id="h23-0-108" class="i">+                        },
</a><a href="#h23-0-109" id="h23-0-109" class="i">+                    }),
</a><a href="#h23-0-110" id="h23-0-110" class="i">+                }
</a><a href="#h23-0-111" id="h23-0-111" class="i">+            }
</a><a href="#h23-0-112" id="h23-0-112" class="i">+
</a>             ast::Statement::Insert { table, columns, values } =&gt; Node::Insert {
                 table,
                 columns: columns.unwrap_or_else(Vec::new),
                 expressions: values
                     .into_iter()
<a href="#h23-0-118" id="h23-0-118" class="d">-                    .map(|exprs| self.build_expressions(exprs))
</a><a href="#h23-0-119" id="h23-0-119" class="i">+                    .map(|exprs| self.build_expressions(&amp;mut Scope::new(), exprs))
</a>                     .collect::&lt;Result&lt;_&gt;&gt;()?,
             },
<a href="#h23-0-122" id="h23-0-122" class="i">+
</a><a href="#h23-0-123" id="h23-0-123" class="i">+            ast::Statement::Update { table, set, r#where } =&gt; {
</a><a href="#h23-0-124" id="h23-0-124" class="i">+                let scope = &amp;mut Scope::from_table(self.catalog.must_read_table(&amp;table)?)?;
</a><a href="#h23-0-125" id="h23-0-125" class="i">+                Node::Update {
</a><a href="#h23-0-126" id="h23-0-126" class="i">+                    table: table.clone(),
</a><a href="#h23-0-127" id="h23-0-127" class="i">+                    source: Box::new(Node::Scan {
</a><a href="#h23-0-128" id="h23-0-128" class="i">+                        label: table.clone(),
</a><a href="#h23-0-129" id="h23-0-129" class="i">+                        table,
</a><a href="#h23-0-130" id="h23-0-130" class="i">+                        filter: match r#where {
</a><a href="#h23-0-131" id="h23-0-131" class="i">+                            Some(ast::WhereClause(expr)) =&gt; {
</a><a href="#h23-0-132" id="h23-0-132" class="i">+                                Some(self.build_expression(scope, expr)?)
</a><a href="#h23-0-133" id="h23-0-133" class="i">+                            }
</a><a href="#h23-0-134" id="h23-0-134" class="i">+                            None =&gt; None,
</a><a href="#h23-0-135" id="h23-0-135" class="i">+                        },
</a><a href="#h23-0-136" id="h23-0-136" class="i">+                    }),
</a><a href="#h23-0-137" id="h23-0-137" class="i">+                    expressions: set
</a><a href="#h23-0-138" id="h23-0-138" class="i">+                        .into_iter()
</a><a href="#h23-0-139" id="h23-0-139" class="i">+                        .map(|(c, e)| self.build_expression(scope, e).map(|e| (c, e)))
</a><a href="#h23-0-140" id="h23-0-140" class="i">+                        .collect::&lt;Result&lt;_&gt;&gt;()?,
</a><a href="#h23-0-141" id="h23-0-141" class="i">+                }
</a><a href="#h23-0-142" id="h23-0-142" class="i">+            }
</a><a href="#h23-0-143" id="h23-0-143" class="i">+
</a><a href="#h23-0-144" id="h23-0-144" class="i">+            // Queries.
</a>             ast::Statement::Select {
                 select,
                 from,
<a href="#h23-1" id="h23-1" class="h">@@ -63,129 +130,95 @@ impl Planner {
</a>                 limit,
                 offset,
             } =&gt; {
<a href="#h23-1-3" id="h23-1-3" class="d">-                let mut n: Node = match from {
</a><a href="#h23-1-4" id="h23-1-4" class="d">-                    Some(from) =&gt; {
</a><a href="#h23-1-5" id="h23-1-5" class="d">-                        let mut items = from.items.into_iter().rev();
</a><a href="#h23-1-6" id="h23-1-6" class="d">-                        let mut node = match items.next() {
</a><a href="#h23-1-7" id="h23-1-7" class="d">-                            Some(item) =&gt; self.build_from_item(item)?,
</a><a href="#h23-1-8" id="h23-1-8" class="d">-                            None =&gt; return Err(Error::Value(&quot;No from items given&quot;.into())),
</a><a href="#h23-1-9" id="h23-1-9" class="d">-                        };
</a><a href="#h23-1-10" id="h23-1-10" class="d">-                        for item in items {
</a><a href="#h23-1-11" id="h23-1-11" class="d">-                            node = Node::NestedLoopJoin {
</a><a href="#h23-1-12" id="h23-1-12" class="d">-                                outer: Box::new(self.build_from_item(item)?),
</a><a href="#h23-1-13" id="h23-1-13" class="d">-                                inner: Box::new(node),
</a><a href="#h23-1-14" id="h23-1-14" class="d">-                                predicate: None,
</a><a href="#h23-1-15" id="h23-1-15" class="d">-                                pad: false,
</a><a href="#h23-1-16" id="h23-1-16" class="d">-                                flip: false,
</a><a href="#h23-1-17" id="h23-1-17" class="d">-                            }
</a><a href="#h23-1-18" id="h23-1-18" class="d">-                        }
</a><a href="#h23-1-19" id="h23-1-19" class="d">-                        node
</a><a href="#h23-1-20" id="h23-1-20" class="d">-                    }
</a><a href="#h23-1-21" id="h23-1-21" class="i">+                let scope = &amp;mut Scope::new();
</a><a href="#h23-1-22" id="h23-1-22" class="i">+
</a><a href="#h23-1-23" id="h23-1-23" class="i">+                // Build FROM clause.
</a><a href="#h23-1-24" id="h23-1-24" class="i">+                let mut node = match from {
</a><a href="#h23-1-25" id="h23-1-25" class="i">+                    Some(from) =&gt; self.build_from_clause(scope, from)?,
</a>                     None if select.expressions.is_empty() =&gt; {
                         return Err(Error::Value(&quot;Can&#39;t select * without a table&quot;.into()))
                     }
                     None =&gt; Node::Nothing,
                 };
<a href="#h23-1-31" id="h23-1-31" class="i">+
</a><a href="#h23-1-32" id="h23-1-32" class="i">+                // Build WHERE clause.
</a>                 if let Some(ast::WhereClause(expr)) = r#where {
<a href="#h23-1-34" id="h23-1-34" class="d">-                    n = Node::Filter {
</a><a href="#h23-1-35" id="h23-1-35" class="d">-                        source: Box::new(n),
</a><a href="#h23-1-36" id="h23-1-36" class="d">-                        predicate: self.build_expression(expr)?,
</a><a href="#h23-1-37" id="h23-1-37" class="i">+                    node = Node::Filter {
</a><a href="#h23-1-38" id="h23-1-38" class="i">+                        source: Box::new(node),
</a><a href="#h23-1-39" id="h23-1-39" class="i">+                        predicate: self.build_expression(scope, expr)?,
</a>                     };
                 };
<a href="#h23-1-42" id="h23-1-42" class="i">+
</a><a href="#h23-1-43" id="h23-1-43" class="i">+                // Build SELECT clause.
</a>                 if !select.expressions.is_empty() {
<a href="#h23-1-45" id="h23-1-45" class="d">-                    let (mut pre, aggregates, mut post) =
</a><a href="#h23-1-46" id="h23-1-46" class="d">-                        self.build_aggregate_expressions(select.expressions)?;
</a><a href="#h23-1-47" id="h23-1-47" class="d">-                    let mut pre_labels: Vec&lt;Option&lt;String&gt;&gt; =
</a><a href="#h23-1-48" id="h23-1-48" class="d">-                        std::iter::repeat(None).take(pre.len()).collect();
</a><a href="#h23-1-49" id="h23-1-49" class="d">-                    if let Some(ast::GroupByClause(exprs)) = group_by {
</a><a href="#h23-1-50" id="h23-1-50" class="d">-                        for group in self.build_expressions(exprs)? {
</a><a href="#h23-1-51" id="h23-1-51" class="d">-                            if let Expression::Field(None, label) = &amp;group {
</a><a href="#h23-1-52" id="h23-1-52" class="d">-                                // If the group is a field reference to an AS label in the output,
</a><a href="#h23-1-53" id="h23-1-53" class="d">-                                // move the SELECT expression to the pre-projection and reference it
</a><a href="#h23-1-54" id="h23-1-54" class="d">-                                // in post unless it contains an aggregate. This handles e.g.:
</a><a href="#h23-1-55" id="h23-1-55" class="d">-                                // SELECT a * 2 AS p, SUM(b) FROM t GROUP BY p
</a><a href="#h23-1-56" id="h23-1-56" class="d">-                                if let Some(index) =
</a><a href="#h23-1-57" id="h23-1-57" class="d">-                                    select.labels.iter().position(|l| l.as_deref() == Some(label))
</a><a href="#h23-1-58" id="h23-1-58" class="d">-                                {
</a><a href="#h23-1-59" id="h23-1-59" class="d">-                                    if !post[index].walk(&amp;|expr| match expr {
</a><a href="#h23-1-60" id="h23-1-60" class="d">-                                        Expression::Column(i) if i &lt; &amp;aggregates.len() =&gt; false,
</a><a href="#h23-1-61" id="h23-1-61" class="d">-                                        _ =&gt; true,
</a><a href="#h23-1-62" id="h23-1-62" class="d">-                                    }) {
</a><a href="#h23-1-63" id="h23-1-63" class="d">-                                        return Err(Error::Value(
</a><a href="#h23-1-64" id="h23-1-64" class="d">-                                            &quot;cannot group by aggregate column&quot;.into(),
</a><a href="#h23-1-65" id="h23-1-65" class="d">-                                        ));
</a><a href="#h23-1-66" id="h23-1-66" class="d">-                                    }
</a><a href="#h23-1-67" id="h23-1-67" class="d">-                                    pre.push(std::mem::replace(
</a><a href="#h23-1-68" id="h23-1-68" class="d">-                                        &amp;mut post[index],
</a><a href="#h23-1-69" id="h23-1-69" class="d">-                                        Expression::Column(pre.len()),
</a><a href="#h23-1-70" id="h23-1-70" class="d">-                                    ));
</a><a href="#h23-1-71" id="h23-1-71" class="d">-                                    pre_labels.push(Some(label.clone()));
</a><a href="#h23-1-72" id="h23-1-72" class="d">-                                } else {
</a><a href="#h23-1-73" id="h23-1-73" class="d">-                                    pre.push(group);
</a><a href="#h23-1-74" id="h23-1-74" class="d">-                                    pre_labels.push(None);
</a><a href="#h23-1-75" id="h23-1-75" class="d">-                                }
</a><a href="#h23-1-76" id="h23-1-76" class="d">-                            } else {
</a><a href="#h23-1-77" id="h23-1-77" class="d">-                                // If the group expression is exactly equal as a SELECT expression,
</a><a href="#h23-1-78" id="h23-1-78" class="d">-                                // push them both to the pre-projection.
</a><a href="#h23-1-79" id="h23-1-79" class="d">-                                let mut pushed = false;
</a><a href="#h23-1-80" id="h23-1-80" class="d">-                                while let Some(index) = post.iter().position(|e| e == &amp;group) {
</a><a href="#h23-1-81" id="h23-1-81" class="d">-                                    pre.push(std::mem::replace(
</a><a href="#h23-1-82" id="h23-1-82" class="d">-                                        &amp;mut post[index],
</a><a href="#h23-1-83" id="h23-1-83" class="d">-                                        Expression::Column(pre.len()),
</a><a href="#h23-1-84" id="h23-1-84" class="d">-                                    ));
</a><a href="#h23-1-85" id="h23-1-85" class="d">-                                    pre_labels.push(None);
</a><a href="#h23-1-86" id="h23-1-86" class="d">-                                    pushed = true;
</a><a href="#h23-1-87" id="h23-1-87" class="d">-                                }
</a><a href="#h23-1-88" id="h23-1-88" class="d">-                                if !pushed {
</a><a href="#h23-1-89" id="h23-1-89" class="d">-                                    pre.push(group);
</a><a href="#h23-1-90" id="h23-1-90" class="d">-                                    pre_labels.push(None);
</a><a href="#h23-1-91" id="h23-1-91" class="d">-                                }
</a><a href="#h23-1-92" id="h23-1-92" class="d">-                            }
</a><a href="#h23-1-93" id="h23-1-93" class="d">-                        }
</a><a href="#h23-1-94" id="h23-1-94" class="d">-                    }
</a><a href="#h23-1-95" id="h23-1-95" class="d">-                    if !pre.is_empty() {
</a><a href="#h23-1-96" id="h23-1-96" class="d">-                        n = Node::Projection {
</a><a href="#h23-1-97" id="h23-1-97" class="d">-                            source: Box::new(n),
</a><a href="#h23-1-98" id="h23-1-98" class="d">-                            labels: pre_labels,
</a><a href="#h23-1-99" id="h23-1-99" class="d">-                            expressions: pre,
</a><a href="#h23-1-100" id="h23-1-100" class="d">-                        };
</a><a href="#h23-1-101" id="h23-1-101" class="d">-                    }
</a><a href="#h23-1-102" id="h23-1-102" class="d">-                    if !aggregates.is_empty() {
</a><a href="#h23-1-103" id="h23-1-103" class="d">-                        n = Node::Aggregation { source: Box::new(n), aggregates };
</a><a href="#h23-1-104" id="h23-1-104" class="i">+                    let mut exprs = select.expressions.clone(); // FIXME No need to clone
</a><a href="#h23-1-105" id="h23-1-105" class="i">+
</a><a href="#h23-1-106" id="h23-1-106" class="i">+                    // Extract any aggregate functions and GROUP BY expressions, replacing them with
</a><a href="#h23-1-107" id="h23-1-107" class="i">+                    // Column placeholders. Aggregations are handled by evaluating group expressions
</a><a href="#h23-1-108" id="h23-1-108" class="i">+                    // and aggregate function arguments in a pre-projection, passing the results
</a><a href="#h23-1-109" id="h23-1-109" class="i">+                    // to an aggregation node, and then evaluating the final SELECT expressions
</a><a href="#h23-1-110" id="h23-1-110" class="i">+                    // in the post-projection. See build_aggregates() for details.
</a><a href="#h23-1-111" id="h23-1-111" class="i">+                    let aggregates = self.extract_aggregates(&amp;mut exprs)?;
</a><a href="#h23-1-112" id="h23-1-112" class="i">+                    let groups = if let Some(ast::GroupByClause(group_by)) = group_by {
</a><a href="#h23-1-113" id="h23-1-113" class="i">+                        self.extract_groups(&amp;mut exprs, &amp;select.labels, group_by, aggregates.len())?
</a><a href="#h23-1-114" id="h23-1-114" class="i">+                    } else {
</a><a href="#h23-1-115" id="h23-1-115" class="i">+                        Vec::new()
</a><a href="#h23-1-116" id="h23-1-116" class="i">+                    };
</a><a href="#h23-1-117" id="h23-1-117" class="i">+                    if !aggregates.is_empty() || !groups.is_empty() {
</a><a href="#h23-1-118" id="h23-1-118" class="i">+                        node = self.build_aggregation(scope, node, groups, aggregates)?;
</a>                     }
<a href="#h23-1-120" id="h23-1-120" class="d">-                    n = Node::Projection {
</a><a href="#h23-1-121" id="h23-1-121" class="d">-                        source: Box::new(n),
</a><a href="#h23-1-122" id="h23-1-122" class="i">+
</a><a href="#h23-1-123" id="h23-1-123" class="i">+                    // Build the remaining non-aggregate projection.
</a><a href="#h23-1-124" id="h23-1-124" class="i">+                    let exprs = self.build_expressions(scope, exprs)?;
</a><a href="#h23-1-125" id="h23-1-125" class="i">+                    scope.project(
</a><a href="#h23-1-126" id="h23-1-126" class="i">+                        exprs.iter().cloned().zip(select.labels.iter().cloned()).collect(),
</a><a href="#h23-1-127" id="h23-1-127" class="i">+                    )?;
</a><a href="#h23-1-128" id="h23-1-128" class="i">+                    node = Node::Projection {
</a><a href="#h23-1-129" id="h23-1-129" class="i">+                        source: Box::new(node),
</a>                         labels: select.labels,
<a href="#h23-1-131" id="h23-1-131" class="d">-                        expressions: post,
</a><a href="#h23-1-132" id="h23-1-132" class="d">-                    }
</a><a href="#h23-1-133" id="h23-1-133" class="i">+                        expressions: exprs,
</a><a href="#h23-1-134" id="h23-1-134" class="i">+                    };
</a>                 };
 
<a href="#h23-1-137" id="h23-1-137" class="i">+                // Build HAVING clause.
</a>                 if let Some(ast::HavingClause(expr)) = having {
<a href="#h23-1-139" id="h23-1-139" class="d">-                    n = Node::Filter {
</a><a href="#h23-1-140" id="h23-1-140" class="d">-                        source: Box::new(n),
</a><a href="#h23-1-141" id="h23-1-141" class="d">-                        predicate: self.build_expression(expr)?,
</a><a href="#h23-1-142" id="h23-1-142" class="i">+                    node = Node::Filter {
</a><a href="#h23-1-143" id="h23-1-143" class="i">+                        source: Box::new(node),
</a><a href="#h23-1-144" id="h23-1-144" class="i">+                        predicate: self.build_expression(scope, expr)?,
</a>                     };
                 };
 
<a href="#h23-1-148" id="h23-1-148" class="i">+                // Build ORDER clause.
</a>                 // FIXME Because the projection doesn&#39;t retain original table values, we can&#39;t
                 // order by fields which are not in the result set.
                 if !order.is_empty() {
<a href="#h23-1-152" id="h23-1-152" class="d">-                    n = Node::Order {
</a><a href="#h23-1-153" id="h23-1-153" class="d">-                        source: Box::new(n),
</a><a href="#h23-1-154" id="h23-1-154" class="i">+                    node = Node::Order {
</a><a href="#h23-1-155" id="h23-1-155" class="i">+                        source: Box::new(node),
</a>                         orders: order
                             .into_iter()
<a href="#h23-1-158" id="h23-1-158" class="d">-                            .map(|(e, o)| self.build_expression(e).map(|e| (e, o.into())))
</a><a href="#h23-1-159" id="h23-1-159" class="i">+                            .map(|(e, o)| {
</a><a href="#h23-1-160" id="h23-1-160" class="i">+                                if Self::is_aggregate(&amp;e) {
</a><a href="#h23-1-161" id="h23-1-161" class="i">+                                    return Err(Error::Value(
</a><a href="#h23-1-162" id="h23-1-162" class="i">+                                        &quot;Aggregate function not allowed here&quot;.into(),
</a><a href="#h23-1-163" id="h23-1-163" class="i">+                                    ));
</a><a href="#h23-1-164" id="h23-1-164" class="i">+                                }
</a><a href="#h23-1-165" id="h23-1-165" class="i">+                                Ok((
</a><a href="#h23-1-166" id="h23-1-166" class="i">+                                    self.build_expression(scope, e)?,
</a><a href="#h23-1-167" id="h23-1-167" class="i">+                                    match o {
</a><a href="#h23-1-168" id="h23-1-168" class="i">+                                        ast::Order::Ascending =&gt; Direction::Ascending,
</a><a href="#h23-1-169" id="h23-1-169" class="i">+                                        ast::Order::Descending =&gt; Direction::Descending,
</a><a href="#h23-1-170" id="h23-1-170" class="i">+                                    },
</a><a href="#h23-1-171" id="h23-1-171" class="i">+                                ))
</a><a href="#h23-1-172" id="h23-1-172" class="i">+                            })
</a>                             .collect::&lt;Result&lt;_&gt;&gt;()?,
                     };
                 }
<a href="#h23-1-176" id="h23-1-176" class="i">+
</a><a href="#h23-1-177" id="h23-1-177" class="i">+                // Build OFFSET clause.
</a>                 if let Some(expr) = offset {
<a href="#h23-1-179" id="h23-1-179" class="d">-                    let expr = self.build_expression(expr)?;
</a><a href="#h23-1-180" id="h23-1-180" class="d">-                    if !expr.is_constant() {
</a><a href="#h23-1-181" id="h23-1-181" class="d">-                        return Err(Error::Value(&quot;Offset must be constant value&quot;.into()));
</a><a href="#h23-1-182" id="h23-1-182" class="d">-                    }
</a><a href="#h23-1-183" id="h23-1-183" class="d">-                    n = Node::Offset {
</a><a href="#h23-1-184" id="h23-1-184" class="d">-                        source: Box::new(n),
</a><a href="#h23-1-185" id="h23-1-185" class="d">-                        offset: match expr.evaluate(&amp;Environment::new())? {
</a><a href="#h23-1-186" id="h23-1-186" class="i">+                    node = Node::Offset {
</a><a href="#h23-1-187" id="h23-1-187" class="i">+                        source: Box::new(node),
</a><a href="#h23-1-188" id="h23-1-188" class="i">+                        offset: match self.build_expression_constant(expr)?.evaluate(None)? {
</a>                             Value::Integer(i) if i &gt;= 0 =&gt; i as u64,
                             v =&gt; {
                                 return Err(Error::Value(format!(&quot;Invalid value {} for offset&quot;, v)))
<a href="#h23-2" id="h23-2" class="h">@@ -193,14 +226,12 @@ impl Planner {
</a>                         },
                     }
                 }
<a href="#h23-2-3" id="h23-2-3" class="i">+
</a><a href="#h23-2-4" id="h23-2-4" class="i">+                // Build LIMIT clause.
</a>                 if let Some(expr) = limit {
<a href="#h23-2-6" id="h23-2-6" class="d">-                    let expr = self.build_expression(expr)?;
</a><a href="#h23-2-7" id="h23-2-7" class="d">-                    if !expr.is_constant() {
</a><a href="#h23-2-8" id="h23-2-8" class="d">-                        return Err(Error::Value(&quot;Limit must be constant value&quot;.into()));
</a><a href="#h23-2-9" id="h23-2-9" class="d">-                    }
</a><a href="#h23-2-10" id="h23-2-10" class="d">-                    n = Node::Limit {
</a><a href="#h23-2-11" id="h23-2-11" class="d">-                        source: Box::new(n),
</a><a href="#h23-2-12" id="h23-2-12" class="d">-                        limit: match expr.evaluate(&amp;Environment::new())? {
</a><a href="#h23-2-13" id="h23-2-13" class="i">+                    node = Node::Limit {
</a><a href="#h23-2-14" id="h23-2-14" class="i">+                        source: Box::new(node),
</a><a href="#h23-2-15" id="h23-2-15" class="i">+                        limit: match self.build_expression_constant(expr)?.evaluate(None)? {
</a>                             Value::Integer(i) if i &gt;= 0 =&gt; i as u64,
                             v =&gt; {
                                 return Err(Error::Value(format!(&quot;Invalid value {} for limit&quot;, v)))
<a href="#h23-3" id="h23-3" class="h">@@ -208,49 +239,63 @@ impl Planner {
</a>                         },
                     }
                 }
<a href="#h23-3-3" id="h23-3-3" class="d">-                n
</a><a href="#h23-3-4" id="h23-3-4" class="i">+                node
</a>             }
<a href="#h23-3-6" id="h23-3-6" class="d">-            ast::Statement::Update { table, set, r#where } =&gt; Node::Update {
</a><a href="#h23-3-7" id="h23-3-7" class="d">-                table: table.clone(),
</a><a href="#h23-3-8" id="h23-3-8" class="d">-                source: Box::new(Node::Scan {
</a><a href="#h23-3-9" id="h23-3-9" class="d">-                    table,
</a><a href="#h23-3-10" id="h23-3-10" class="d">-                    alias: None,
</a><a href="#h23-3-11" id="h23-3-11" class="d">-                    filter: match r#where {
</a><a href="#h23-3-12" id="h23-3-12" class="d">-                        Some(ast::WhereClause(expr)) =&gt; Some(self.build_expression(expr)?),
</a><a href="#h23-3-13" id="h23-3-13" class="d">-                        None =&gt; None,
</a><a href="#h23-3-14" id="h23-3-14" class="d">-                    },
</a><a href="#h23-3-15" id="h23-3-15" class="d">-                }),
</a><a href="#h23-3-16" id="h23-3-16" class="d">-                expressions: set
</a><a href="#h23-3-17" id="h23-3-17" class="d">-                    .into_iter()
</a><a href="#h23-3-18" id="h23-3-18" class="d">-                    .map(|(c, e)| self.build_expression(e).map(|e| (c, e)))
</a><a href="#h23-3-19" id="h23-3-19" class="d">-                    .collect::&lt;Result&lt;_&gt;&gt;()?,
</a><a href="#h23-3-20" id="h23-3-20" class="d">-            },
</a>         })
     }
 
<a href="#h23-3-24" id="h23-3-24" class="d">-    /// Builds FROM items
</a><a href="#h23-3-25" id="h23-3-25" class="d">-    fn build_from_item(&amp;self, item: ast::FromItem) -&gt; Result&lt;Node&gt; {
</a><a href="#h23-3-26" id="h23-3-26" class="i">+    /// Builds a FROM clause consisting of several items. Each item is either a single table or a
</a><a href="#h23-3-27" id="h23-3-27" class="i">+    /// join of an arbitrary number of tables. All of the items are joined, since e.g. &#39;SELECT * FROM
</a><a href="#h23-3-28" id="h23-3-28" class="i">+    /// a, b&#39; is an implicit join of a and b.
</a><a href="#h23-3-29" id="h23-3-29" class="i">+    fn build_from_clause(&amp;mut self, scope: &amp;mut Scope, from: ast::FromClause) -&gt; Result&lt;Node&gt; {
</a><a href="#h23-3-30" id="h23-3-30" class="i">+        let mut items = from.items.into_iter();
</a><a href="#h23-3-31" id="h23-3-31" class="i">+        let mut node = match items.next() {
</a><a href="#h23-3-32" id="h23-3-32" class="i">+            Some(item) =&gt; self.build_from_item(scope, item)?,
</a><a href="#h23-3-33" id="h23-3-33" class="i">+            None =&gt; return Err(Error::Value(&quot;No from items given&quot;.into())),
</a><a href="#h23-3-34" id="h23-3-34" class="i">+        };
</a><a href="#h23-3-35" id="h23-3-35" class="i">+        for item in items {
</a><a href="#h23-3-36" id="h23-3-36" class="i">+            node = Node::NestedLoopJoin {
</a><a href="#h23-3-37" id="h23-3-37" class="i">+                outer: Box::new(node),
</a><a href="#h23-3-38" id="h23-3-38" class="i">+                inner: Box::new(self.build_from_item(scope, item)?),
</a><a href="#h23-3-39" id="h23-3-39" class="i">+                predicate: None,
</a><a href="#h23-3-40" id="h23-3-40" class="i">+                pad: false,
</a><a href="#h23-3-41" id="h23-3-41" class="i">+                flip: false,
</a><a href="#h23-3-42" id="h23-3-42" class="i">+            }
</a><a href="#h23-3-43" id="h23-3-43" class="i">+        }
</a><a href="#h23-3-44" id="h23-3-44" class="i">+        Ok(node)
</a><a href="#h23-3-45" id="h23-3-45" class="i">+    }
</a><a href="#h23-3-46" id="h23-3-46" class="i">+
</a><a href="#h23-3-47" id="h23-3-47" class="i">+    /// Builds FROM items, which can either be a single table or a chained join of multiple tables,
</a><a href="#h23-3-48" id="h23-3-48" class="i">+    /// e.g. &#39;SELECT * FROM a LEFT JOIN b ON b.a_id = a.id&#39;. Any tables will be stored in
</a><a href="#h23-3-49" id="h23-3-49" class="i">+    /// self.tables keyed by their query name (i.e. alias if given, otherwise name). The table can
</a><a href="#h23-3-50" id="h23-3-50" class="i">+    /// only be referenced by the query name (so if alias is given, cannot reference by name).
</a><a href="#h23-3-51" id="h23-3-51" class="i">+    fn build_from_item(&amp;mut self, scope: &amp;mut Scope, item: ast::FromItem) -&gt; Result&lt;Node&gt; {
</a>         Ok(match item {
<a href="#h23-3-53" id="h23-3-53" class="d">-            ast::FromItem::Table { name, alias } =&gt; Node::Scan { table: name, alias, filter: None },
</a><a href="#h23-3-54" id="h23-3-54" class="i">+            ast::FromItem::Table { name, alias } =&gt; {
</a><a href="#h23-3-55" id="h23-3-55" class="i">+                let label = alias.unwrap_or_else(|| name.clone());
</a><a href="#h23-3-56" id="h23-3-56" class="i">+                scope.add_table(label.clone(), self.catalog.must_read_table(&amp;name)?)?;
</a><a href="#h23-3-57" id="h23-3-57" class="i">+                Node::Scan { table: name, label, filter: None }
</a><a href="#h23-3-58" id="h23-3-58" class="i">+            }
</a><a href="#h23-3-59" id="h23-3-59" class="i">+
</a>             ast::FromItem::Join { left, right, r#type, predicate } =&gt; match r#type {
                 ast::JoinType::Cross | ast::JoinType::Inner =&gt; Node::NestedLoopJoin {
<a href="#h23-3-62" id="h23-3-62" class="d">-                    outer: Box::new(self.build_from_item(*left)?),
</a><a href="#h23-3-63" id="h23-3-63" class="d">-                    inner: Box::new(self.build_from_item(*right)?),
</a><a href="#h23-3-64" id="h23-3-64" class="d">-                    predicate: predicate.map(|e| self.build_expression(e)).transpose()?,
</a><a href="#h23-3-65" id="h23-3-65" class="i">+                    outer: Box::new(self.build_from_item(scope, *left)?),
</a><a href="#h23-3-66" id="h23-3-66" class="i">+                    inner: Box::new(self.build_from_item(scope, *right)?),
</a><a href="#h23-3-67" id="h23-3-67" class="i">+                    predicate: predicate.map(|e| self.build_expression(scope, e)).transpose()?,
</a>                     pad: false,
                     flip: false,
                 },
                 ast::JoinType::Left =&gt; Node::NestedLoopJoin {
<a href="#h23-3-72" id="h23-3-72" class="d">-                    outer: Box::new(self.build_from_item(*left)?),
</a><a href="#h23-3-73" id="h23-3-73" class="d">-                    inner: Box::new(self.build_from_item(*right)?),
</a><a href="#h23-3-74" id="h23-3-74" class="d">-                    predicate: predicate.map(|e| self.build_expression(e)).transpose()?,
</a><a href="#h23-3-75" id="h23-3-75" class="i">+                    outer: Box::new(self.build_from_item(scope, *left)?),
</a><a href="#h23-3-76" id="h23-3-76" class="i">+                    inner: Box::new(self.build_from_item(scope, *right)?),
</a><a href="#h23-3-77" id="h23-3-77" class="i">+                    predicate: predicate.map(|e| self.build_expression(scope, e)).transpose()?,
</a>                     pad: true,
                     flip: false,
                 },
                 ast::JoinType::Right =&gt; Node::NestedLoopJoin {
<a href="#h23-3-82" id="h23-3-82" class="d">-                    outer: Box::new(self.build_from_item(*left)?),
</a><a href="#h23-3-83" id="h23-3-83" class="d">-                    inner: Box::new(self.build_from_item(*right)?),
</a><a href="#h23-3-84" id="h23-3-84" class="d">-                    predicate: predicate.map(|e| self.build_expression(e)).transpose()?,
</a><a href="#h23-3-85" id="h23-3-85" class="i">+                    outer: Box::new(self.build_from_item(scope, *left)?),
</a><a href="#h23-3-86" id="h23-3-86" class="i">+                    inner: Box::new(self.build_from_item(scope, *right)?),
</a><a href="#h23-3-87" id="h23-3-87" class="i">+                    predicate: predicate.map(|e| self.build_expression(scope, e)).transpose()?,
</a>                     pad: true,
                     flip: true,
                 },
<a href="#h23-4" id="h23-4" class="h">@@ -258,102 +303,176 @@ impl Planner {
</a>         })
     }
 
<a href="#h23-4-3" id="h23-4-3" class="i">+    /// Builds an aggregation node.
</a><a href="#h23-4-4" id="h23-4-4" class="i">+    fn build_aggregation(
</a><a href="#h23-4-5" id="h23-4-5" class="i">+        &amp;self,
</a><a href="#h23-4-6" id="h23-4-6" class="i">+        scope: &amp;mut Scope,
</a><a href="#h23-4-7" id="h23-4-7" class="i">+        source: Node,
</a><a href="#h23-4-8" id="h23-4-8" class="i">+        groups: Vec&lt;(ast::Expression, Option&lt;String&gt;)&gt;,
</a><a href="#h23-4-9" id="h23-4-9" class="i">+        aggregations: Vec&lt;(Aggregate, ast::Expression)&gt;,
</a><a href="#h23-4-10" id="h23-4-10" class="i">+    ) -&gt; Result&lt;Node&gt; {
</a><a href="#h23-4-11" id="h23-4-11" class="i">+        let mut aggregates = Vec::new();
</a><a href="#h23-4-12" id="h23-4-12" class="i">+        let mut expressions = Vec::new();
</a><a href="#h23-4-13" id="h23-4-13" class="i">+        let mut labels = Vec::new();
</a><a href="#h23-4-14" id="h23-4-14" class="i">+        for (aggregate, expr) in aggregations {
</a><a href="#h23-4-15" id="h23-4-15" class="i">+            aggregates.push(aggregate);
</a><a href="#h23-4-16" id="h23-4-16" class="i">+            expressions.push(self.build_expression(scope, expr)?);
</a><a href="#h23-4-17" id="h23-4-17" class="i">+            labels.push(None);
</a><a href="#h23-4-18" id="h23-4-18" class="i">+        }
</a><a href="#h23-4-19" id="h23-4-19" class="i">+        for (expr, label) in groups {
</a><a href="#h23-4-20" id="h23-4-20" class="i">+            expressions.push(self.build_expression(scope, expr)?);
</a><a href="#h23-4-21" id="h23-4-21" class="i">+            labels.push(label);
</a><a href="#h23-4-22" id="h23-4-22" class="i">+        }
</a><a href="#h23-4-23" id="h23-4-23" class="i">+        // FIXME This is probably wrong for the aggregate columns, since we don&#39;t want to inherit
</a><a href="#h23-4-24" id="h23-4-24" class="i">+        // from them if they are simple field references.
</a><a href="#h23-4-25" id="h23-4-25" class="i">+        scope.project(expressions.iter().cloned().zip(labels.iter().cloned()).collect())?;
</a><a href="#h23-4-26" id="h23-4-26" class="i">+        let node = Node::Aggregation {
</a><a href="#h23-4-27" id="h23-4-27" class="i">+            source: Box::new(Node::Projection { source: Box::new(source), labels, expressions }),
</a><a href="#h23-4-28" id="h23-4-28" class="i">+            aggregates,
</a><a href="#h23-4-29" id="h23-4-29" class="i">+        };
</a><a href="#h23-4-30" id="h23-4-30" class="i">+        Ok(node)
</a><a href="#h23-4-31" id="h23-4-31" class="i">+    }
</a><a href="#h23-4-32" id="h23-4-32" class="i">+
</a>     /// Builds an expression from an AST expression
<a href="#h23-4-34" id="h23-4-34" class="d">-    fn build_expression(&amp;self, expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-35" id="h23-4-35" class="d">-        ExpressionBuilder::build(expr)
</a><a href="#h23-4-36" id="h23-4-36" class="i">+    fn build_expression(&amp;self, scope: &amp;mut Scope, expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-37" id="h23-4-37" class="i">+        ExpressionBuilder::build(scope, expr)
</a><a href="#h23-4-38" id="h23-4-38" class="i">+    }
</a><a href="#h23-4-39" id="h23-4-39" class="i">+
</a><a href="#h23-4-40" id="h23-4-40" class="i">+    /// Build a constant expression from an AST expression
</a><a href="#h23-4-41" id="h23-4-41" class="i">+    fn build_expression_constant(&amp;self, expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-42" id="h23-4-42" class="i">+        ExpressionBuilder::build_constant(expr)
</a>     }
 
     /// Builds expressions from AST expressions
<a href="#h23-4-46" id="h23-4-46" class="d">-    fn build_expressions(&amp;self, exprs: ast::Expressions) -&gt; Result&lt;Expressions&gt; {
</a><a href="#h23-4-47" id="h23-4-47" class="d">-        ExpressionBuilder::build_many(exprs)
</a><a href="#h23-4-48" id="h23-4-48" class="i">+    fn build_expressions(&amp;self, scope: &amp;mut Scope, exprs: ast::Expressions) -&gt; Result&lt;Expressions&gt; {
</a><a href="#h23-4-49" id="h23-4-49" class="i">+        ExpressionBuilder::build_many(scope, exprs)
</a>     }
 
<a href="#h23-4-52" id="h23-4-52" class="d">-    /// Builds partitioned aggregate expressions from AST expressions
</a><a href="#h23-4-53" id="h23-4-53" class="d">-    fn build_aggregate_expressions(
</a><a href="#h23-4-54" id="h23-4-54" class="i">+    /// Extracts aggregate functions from an AST expression tree. This finds the aggregate
</a><a href="#h23-4-55" id="h23-4-55" class="i">+    /// function calls, replaces them with ast::Expression::Column(i), maps the aggregate functions
</a><a href="#h23-4-56" id="h23-4-56" class="i">+    /// to aggregates, and returns them along with their argument expressions.
</a><a href="#h23-4-57" id="h23-4-57" class="i">+    fn extract_aggregates(
</a>         &amp;self,
<a href="#h23-4-59" id="h23-4-59" class="d">-        exprs: ast::Expressions,
</a><a href="#h23-4-60" id="h23-4-60" class="d">-    ) -&gt; Result&lt;(Expressions, Vec&lt;Aggregate&gt;, Expressions)&gt; {
</a><a href="#h23-4-61" id="h23-4-61" class="d">-        ExpressionBuilder::build_aggregates(exprs)
</a><a href="#h23-4-62" id="h23-4-62" class="i">+        exprs: &amp;mut [ast::Expression],
</a><a href="#h23-4-63" id="h23-4-63" class="i">+    ) -&gt; Result&lt;Vec&lt;(Aggregate, ast::Expression)&gt;&gt; {
</a><a href="#h23-4-64" id="h23-4-64" class="i">+        let mut aggregates = Vec::new();
</a><a href="#h23-4-65" id="h23-4-65" class="i">+        for expr in exprs {
</a><a href="#h23-4-66" id="h23-4-66" class="i">+            expr.replace_with(|e| {
</a><a href="#h23-4-67" id="h23-4-67" class="i">+                e.transform(
</a><a href="#h23-4-68" id="h23-4-68" class="i">+                    &amp;mut |mut e| match &amp;mut e {
</a><a href="#h23-4-69" id="h23-4-69" class="i">+                        ast::Expression::Function(f, args) if args.len() == 1 =&gt; {
</a><a href="#h23-4-70" id="h23-4-70" class="i">+                            if let Some(aggregate) = Self::aggregate_from_name(f) {
</a><a href="#h23-4-71" id="h23-4-71" class="i">+                                aggregates.push((aggregate, args.remove(0)));
</a><a href="#h23-4-72" id="h23-4-72" class="i">+                                Ok(ast::Expression::Column(aggregates.len() - 1))
</a><a href="#h23-4-73" id="h23-4-73" class="i">+                            } else {
</a><a href="#h23-4-74" id="h23-4-74" class="i">+                                Ok(e)
</a><a href="#h23-4-75" id="h23-4-75" class="i">+                            }
</a><a href="#h23-4-76" id="h23-4-76" class="i">+                        }
</a><a href="#h23-4-77" id="h23-4-77" class="i">+                        _ =&gt; Ok(e),
</a><a href="#h23-4-78" id="h23-4-78" class="i">+                    },
</a><a href="#h23-4-79" id="h23-4-79" class="i">+                    &amp;mut |e| Ok(e),
</a><a href="#h23-4-80" id="h23-4-80" class="i">+                )
</a><a href="#h23-4-81" id="h23-4-81" class="i">+            })?;
</a><a href="#h23-4-82" id="h23-4-82" class="i">+        }
</a><a href="#h23-4-83" id="h23-4-83" class="i">+        for (_, expr) in &amp;aggregates {
</a><a href="#h23-4-84" id="h23-4-84" class="i">+            if Self::is_aggregate(expr) {
</a><a href="#h23-4-85" id="h23-4-85" class="i">+                return Err(Error::Value(&quot;Aggregate functions can&#39;t be nested&quot;.into()));
</a><a href="#h23-4-86" id="h23-4-86" class="i">+            }
</a><a href="#h23-4-87" id="h23-4-87" class="i">+        }
</a><a href="#h23-4-88" id="h23-4-88" class="i">+        Ok(aggregates)
</a>     }
 
<a href="#h23-4-91" id="h23-4-91" class="d">-    /// Builds a table schema from an AST CreateTable node
</a><a href="#h23-4-92" id="h23-4-92" class="d">-    fn build_schema_table(
</a><a href="#h23-4-93" id="h23-4-93" class="i">+    /// Extracts group by expressions, and replaces them with column references with the given
</a><a href="#h23-4-94" id="h23-4-94" class="i">+    /// offset. These can be either an arbitray expression, a reference to a SELECT column, or the
</a><a href="#h23-4-95" id="h23-4-95" class="i">+    /// same expression as a SELECT column. The following are all valid:
</a><a href="#h23-4-96" id="h23-4-96" class="i">+    ///
</a><a href="#h23-4-97" id="h23-4-97" class="i">+    /// SELECT released / 100 AS century, COUNT(*) FROM movies GROUP BY century
</a><a href="#h23-4-98" id="h23-4-98" class="i">+    /// SELECT released / 100, COUNT(*) FROM movies GROUP BY released / 100
</a><a href="#h23-4-99" id="h23-4-99" class="i">+    /// SELECT COUNT(*) FROM movies GROUP BY released / 100
</a><a href="#h23-4-100" id="h23-4-100" class="i">+    ///
</a><a href="#h23-4-101" id="h23-4-101" class="i">+    /// FIXME Perhaps put labels and expressions in common structure, and add new type for labels.
</a><a href="#h23-4-102" id="h23-4-102" class="i">+    fn extract_groups(
</a>         &amp;self,
<a href="#h23-4-104" id="h23-4-104" class="d">-        name: String,
</a><a href="#h23-4-105" id="h23-4-105" class="d">-        columns: Vec&lt;ast::ColumnSpec&gt;,
</a><a href="#h23-4-106" id="h23-4-106" class="d">-    ) -&gt; Result&lt;schema::Table&gt; {
</a><a href="#h23-4-107" id="h23-4-107" class="d">-        schema::Table::new(
</a><a href="#h23-4-108" id="h23-4-108" class="d">-            name,
</a><a href="#h23-4-109" id="h23-4-109" class="d">-            columns
</a><a href="#h23-4-110" id="h23-4-110" class="d">-                .into_iter()
</a><a href="#h23-4-111" id="h23-4-111" class="d">-                .map(|c| {
</a><a href="#h23-4-112" id="h23-4-112" class="d">-                    let nullable = c.nullable.unwrap_or(!c.primary_key);
</a><a href="#h23-4-113" id="h23-4-113" class="d">-                    let default = if let Some(expr) = c.default {
</a><a href="#h23-4-114" id="h23-4-114" class="d">-                        let expr = self.build_expression(expr)?;
</a><a href="#h23-4-115" id="h23-4-115" class="d">-                        if !expr.is_constant() {
</a><a href="#h23-4-116" id="h23-4-116" class="d">-                            return Err(Error::Value(format!(
</a><a href="#h23-4-117" id="h23-4-117" class="d">-                                &quot;Default expression for column {} must be constant&quot;,
</a><a href="#h23-4-118" id="h23-4-118" class="d">-                                c.name
</a><a href="#h23-4-119" id="h23-4-119" class="d">-                            )));
</a><a href="#h23-4-120" id="h23-4-120" class="d">-                        }
</a><a href="#h23-4-121" id="h23-4-121" class="d">-                        Some(expr.evaluate(&amp;Environment::new())?)
</a><a href="#h23-4-122" id="h23-4-122" class="d">-                    } else if nullable {
</a><a href="#h23-4-123" id="h23-4-123" class="d">-                        Some(Value::Null)
</a><a href="#h23-4-124" id="h23-4-124" class="d">-                    } else {
</a><a href="#h23-4-125" id="h23-4-125" class="d">-                        None
</a><a href="#h23-4-126" id="h23-4-126" class="d">-                    };
</a><a href="#h23-4-127" id="h23-4-127" class="i">+        exprs: &amp;mut Vec&lt;ast::Expression&gt;,
</a><a href="#h23-4-128" id="h23-4-128" class="i">+        labels: &amp;[Option&lt;String&gt;],
</a><a href="#h23-4-129" id="h23-4-129" class="i">+        group_by: Vec&lt;ast::Expression&gt;,
</a><a href="#h23-4-130" id="h23-4-130" class="i">+        offset: usize,
</a><a href="#h23-4-131" id="h23-4-131" class="i">+    ) -&gt; Result&lt;Vec&lt;(ast::Expression, Option&lt;String&gt;)&gt;&gt; {
</a><a href="#h23-4-132" id="h23-4-132" class="i">+        let labels = labels.to_vec(); // FIXME Avoid this
</a><a href="#h23-4-133" id="h23-4-133" class="i">+        let mut groups = Vec::new();
</a><a href="#h23-4-134" id="h23-4-134" class="i">+        for g in group_by {
</a><a href="#h23-4-135" id="h23-4-135" class="i">+            // Look for references to SELECT columns with AS labels
</a><a href="#h23-4-136" id="h23-4-136" class="i">+            if let ast::Expression::Field(None, label) = &amp;g {
</a><a href="#h23-4-137" id="h23-4-137" class="i">+                if let Some(i) = labels.iter().position(|l| l.as_deref() == Some(label)) {
</a><a href="#h23-4-138" id="h23-4-138" class="i">+                    groups.push((
</a><a href="#h23-4-139" id="h23-4-139" class="i">+                        replace(&amp;mut exprs[i], ast::Expression::Column(offset + groups.len())),
</a><a href="#h23-4-140" id="h23-4-140" class="i">+                        labels[i].clone(),
</a><a href="#h23-4-141" id="h23-4-141" class="i">+                    ));
</a><a href="#h23-4-142" id="h23-4-142" class="i">+                    continue;
</a><a href="#h23-4-143" id="h23-4-143" class="i">+                }
</a><a href="#h23-4-144" id="h23-4-144" class="i">+            }
</a><a href="#h23-4-145" id="h23-4-145" class="i">+            // Look for expressions exactly equal to the group expression
</a><a href="#h23-4-146" id="h23-4-146" class="i">+            if let Some(i) = exprs.iter().position(|e| e == &amp;g) {
</a><a href="#h23-4-147" id="h23-4-147" class="i">+                groups.push((
</a><a href="#h23-4-148" id="h23-4-148" class="i">+                    replace(&amp;mut exprs[i], ast::Expression::Column(offset + groups.len())),
</a><a href="#h23-4-149" id="h23-4-149" class="i">+                    labels[i].clone(),
</a><a href="#h23-4-150" id="h23-4-150" class="i">+                ));
</a><a href="#h23-4-151" id="h23-4-151" class="i">+                continue;
</a><a href="#h23-4-152" id="h23-4-152" class="i">+            }
</a><a href="#h23-4-153" id="h23-4-153" class="i">+            // Otherwise, just use the group expression directly
</a><a href="#h23-4-154" id="h23-4-154" class="i">+            groups.push((g, None))
</a><a href="#h23-4-155" id="h23-4-155" class="i">+        }
</a><a href="#h23-4-156" id="h23-4-156" class="i">+        // Make sure no group expressions contain Column references, which would be placed here
</a><a href="#h23-4-157" id="h23-4-157" class="i">+        // during extract_aggregates().
</a><a href="#h23-4-158" id="h23-4-158" class="i">+        for (expr, _) in &amp;groups {
</a><a href="#h23-4-159" id="h23-4-159" class="i">+            if Self::is_aggregate(expr) {
</a><a href="#h23-4-160" id="h23-4-160" class="i">+                return Err(Error::Value(&quot;Group expression cannot contain aggregates&quot;.into()));
</a><a href="#h23-4-161" id="h23-4-161" class="i">+            }
</a><a href="#h23-4-162" id="h23-4-162" class="i">+        }
</a><a href="#h23-4-163" id="h23-4-163" class="i">+        Ok(groups)
</a><a href="#h23-4-164" id="h23-4-164" class="i">+    }
</a><a href="#h23-4-165" id="h23-4-165" class="i">+
</a><a href="#h23-4-166" id="h23-4-166" class="i">+    /// Returns the aggregate corresponding to the given aggregate function name.
</a><a href="#h23-4-167" id="h23-4-167" class="i">+    fn aggregate_from_name(name: &amp;str) -&gt; Option&lt;Aggregate&gt; {
</a><a href="#h23-4-168" id="h23-4-168" class="i">+        match name {
</a><a href="#h23-4-169" id="h23-4-169" class="i">+            &quot;avg&quot; =&gt; Some(Aggregate::Average),
</a><a href="#h23-4-170" id="h23-4-170" class="i">+            &quot;count&quot; =&gt; Some(Aggregate::Count),
</a><a href="#h23-4-171" id="h23-4-171" class="i">+            &quot;max&quot; =&gt; Some(Aggregate::Max),
</a><a href="#h23-4-172" id="h23-4-172" class="i">+            &quot;min&quot; =&gt; Some(Aggregate::Min),
</a><a href="#h23-4-173" id="h23-4-173" class="i">+            &quot;sum&quot; =&gt; Some(Aggregate::Sum),
</a><a href="#h23-4-174" id="h23-4-174" class="i">+            _ =&gt; None,
</a><a href="#h23-4-175" id="h23-4-175" class="i">+        }
</a><a href="#h23-4-176" id="h23-4-176" class="i">+    }
</a> 
<a href="#h23-4-178" id="h23-4-178" class="d">-                    Ok(schema::Column {
</a><a href="#h23-4-179" id="h23-4-179" class="d">-                        name: c.name,
</a><a href="#h23-4-180" id="h23-4-180" class="d">-                        datatype: c.datatype,
</a><a href="#h23-4-181" id="h23-4-181" class="d">-                        primary_key: c.primary_key,
</a><a href="#h23-4-182" id="h23-4-182" class="d">-                        nullable,
</a><a href="#h23-4-183" id="h23-4-183" class="d">-                        default,
</a><a href="#h23-4-184" id="h23-4-184" class="d">-                        index: c.index &amp;&amp; !c.primary_key,
</a><a href="#h23-4-185" id="h23-4-185" class="d">-                        unique: c.unique || c.primary_key,
</a><a href="#h23-4-186" id="h23-4-186" class="d">-                        references: c.references,
</a><a href="#h23-4-187" id="h23-4-187" class="d">-                    })
</a><a href="#h23-4-188" id="h23-4-188" class="d">-                })
</a><a href="#h23-4-189" id="h23-4-189" class="d">-                .collect::&lt;Result&lt;_&gt;&gt;()?,
</a><a href="#h23-4-190" id="h23-4-190" class="d">-        )
</a><a href="#h23-4-191" id="h23-4-191" class="i">+    /// Checks whether a given expression is an aggregate expression.
</a><a href="#h23-4-192" id="h23-4-192" class="i">+    fn is_aggregate(expr: &amp;ast::Expression) -&gt; bool {
</a><a href="#h23-4-193" id="h23-4-193" class="i">+        expr.contains(&amp;|e| match e {
</a><a href="#h23-4-194" id="h23-4-194" class="i">+            ast::Expression::Function(f, _) =&gt; Self::aggregate_from_name(f).is_some(),
</a><a href="#h23-4-195" id="h23-4-195" class="i">+            _ =&gt; false,
</a><a href="#h23-4-196" id="h23-4-196" class="i">+        })
</a>     }
 }
 
 /// Builds expressions.
<a href="#h23-4-201" id="h23-4-201" class="d">-struct ExpressionBuilder {
</a><a href="#h23-4-202" id="h23-4-202" class="d">-    agg_allow: bool,
</a><a href="#h23-4-203" id="h23-4-203" class="d">-    aggs: Vec&lt;Aggregate&gt;,
</a><a href="#h23-4-204" id="h23-4-204" class="d">-    agg_args: Expressions,
</a><a href="#h23-4-205" id="h23-4-205" class="i">+struct ExpressionBuilder&lt;&#39;a&gt; {
</a><a href="#h23-4-206" id="h23-4-206" class="i">+    // Variable scope
</a><a href="#h23-4-207" id="h23-4-207" class="i">+    scope: &amp;&#39;a Scope,
</a> }
 
<a href="#h23-4-210" id="h23-4-210" class="d">-impl ExpressionBuilder {
</a><a href="#h23-4-211" id="h23-4-211" class="i">+impl&lt;&#39;a&gt; ExpressionBuilder&lt;&#39;a&gt; {
</a>     /// Builds a single expression.
<a href="#h23-4-213" id="h23-4-213" class="d">-    fn build(expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-214" id="h23-4-214" class="d">-        Ok(*ExpressionBuilder { agg_allow: false, aggs: Vec::new(), agg_args: Vec::new() }
</a><a href="#h23-4-215" id="h23-4-215" class="d">-            .make(Box::new(expr))?)
</a><a href="#h23-4-216" id="h23-4-216" class="i">+    fn build(scope: &amp;&#39;a Scope, expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-217" id="h23-4-217" class="i">+        Ok(*ExpressionBuilder { scope }.make(Box::new(expr))?)
</a>     }
 
<a href="#h23-4-220" id="h23-4-220" class="d">-    /// Builds multiple expressions.
</a><a href="#h23-4-221" id="h23-4-221" class="d">-    fn build_many(exprs: ast::Expressions) -&gt; Result&lt;Expressions&gt; {
</a><a href="#h23-4-222" id="h23-4-222" class="d">-        exprs.into_iter().map(Self::build).collect()
</a><a href="#h23-4-223" id="h23-4-223" class="i">+    /// Builds a single expression, errors if it&#39;s not constant (i.e. has field reference).
</a><a href="#h23-4-224" id="h23-4-224" class="i">+    fn build_constant(expr: ast::Expression) -&gt; Result&lt;Expression&gt; {
</a><a href="#h23-4-225" id="h23-4-225" class="i">+        Ok(*ExpressionBuilder { scope: &amp;mut Scope::constant() }.make(Box::new(expr))?)
</a>     }
 
<a href="#h23-4-228" id="h23-4-228" class="d">-    /// Builds aggregate expressions as a pre-projection, aggregation, and post-projection. All
</a><a href="#h23-4-229" id="h23-4-229" class="d">-    /// non-constant, non-aggregate expressions are pushed to the pre-projection as grouping
</a><a href="#h23-4-230" id="h23-4-230" class="d">-    /// expressions (caller should validate against GROUP BY), following expressions referenced by
</a><a href="#h23-4-231" id="h23-4-231" class="d">-    /// the aggregates.
</a><a href="#h23-4-232" id="h23-4-232" class="d">-    fn build_aggregates(exprs: ast::Expressions) -&gt; Result&lt;(Expressions, Aggregates, Expressions)&gt; {
</a><a href="#h23-4-233" id="h23-4-233" class="d">-        let mut builder =
</a><a href="#h23-4-234" id="h23-4-234" class="d">-            ExpressionBuilder { agg_allow: true, aggs: Vec::new(), agg_args: Vec::new() };
</a><a href="#h23-4-235" id="h23-4-235" class="d">-
</a><a href="#h23-4-236" id="h23-4-236" class="d">-        let mut post = Vec::new();
</a><a href="#h23-4-237" id="h23-4-237" class="d">-        for expr in exprs.into_iter() {
</a><a href="#h23-4-238" id="h23-4-238" class="d">-            post.push(*builder.make(Box::new(expr))?);
</a><a href="#h23-4-239" id="h23-4-239" class="d">-        }
</a><a href="#h23-4-240" id="h23-4-240" class="d">-        let pre = builder.agg_args;
</a><a href="#h23-4-241" id="h23-4-241" class="d">-        let aggs = builder.aggs;
</a><a href="#h23-4-242" id="h23-4-242" class="d">-
</a><a href="#h23-4-243" id="h23-4-243" class="d">-        Ok((pre, aggs, post))
</a><a href="#h23-4-244" id="h23-4-244" class="i">+    /// Builds multiple expressions.
</a><a href="#h23-4-245" id="h23-4-245" class="i">+    fn build_many(scope: &amp;&#39;a Scope, exprs: ast::Expressions) -&gt; Result&lt;Expressions&gt; {
</a><a href="#h23-4-246" id="h23-4-246" class="i">+        exprs.into_iter().map(|e| Self::build(scope, e)).collect()
</a>     }
 
     /// Used internally, with more convenient signature.
<a href="#h23-5" id="h23-5" class="h">@@ -368,19 +487,17 @@ impl ExpressionBuilder {
</a>                 ast::Literal::Float(f) =&gt; Value::Float(f),
                 ast::Literal::String(s) =&gt; Value::String(s),
             }),
<a href="#h23-5-3" id="h23-5-3" class="d">-            ast::Expression::Field(rel, name) =&gt; Field(rel, name),
</a><a href="#h23-5-4" id="h23-5-4" class="d">-            ast::Expression::Function(name, mut args) =&gt; match name.as_str() {
</a><a href="#h23-5-5" id="h23-5-5" class="d">-                &quot;avg&quot; | &quot;count&quot; | &quot;max&quot; | &quot;min&quot; | &quot;sum&quot; if args.len() == 1 =&gt; {
</a><a href="#h23-5-6" id="h23-5-6" class="d">-                    *self.make_aggregate(&amp;name, Box::new(args.remove(0)))?
</a><a href="#h23-5-7" id="h23-5-7" class="d">-                }
</a><a href="#h23-5-8" id="h23-5-8" class="d">-                _ =&gt; {
</a><a href="#h23-5-9" id="h23-5-9" class="d">-                    return Err(Error::Value(format!(
</a><a href="#h23-5-10" id="h23-5-10" class="d">-                        &quot;Unknown function {} with {} arguments&quot;,
</a><a href="#h23-5-11" id="h23-5-11" class="d">-                        name,
</a><a href="#h23-5-12" id="h23-5-12" class="d">-                        args.len()
</a><a href="#h23-5-13" id="h23-5-13" class="d">-                    )))
</a><a href="#h23-5-14" id="h23-5-14" class="d">-                }
</a><a href="#h23-5-15" id="h23-5-15" class="d">-            },
</a><a href="#h23-5-16" id="h23-5-16" class="i">+            ast::Expression::Column(i) =&gt; Field(self.scope.assert(i)?, None),
</a><a href="#h23-5-17" id="h23-5-17" class="i">+            ast::Expression::Field(table, name) =&gt; {
</a><a href="#h23-5-18" id="h23-5-18" class="i">+                Field(self.scope.resolve(table.as_deref(), &amp;name)?, Some((table, name)))
</a><a href="#h23-5-19" id="h23-5-19" class="i">+            }
</a><a href="#h23-5-20" id="h23-5-20" class="i">+            ast::Expression::Function(name, args) =&gt; {
</a><a href="#h23-5-21" id="h23-5-21" class="i">+                return Err(Error::Value(format!(
</a><a href="#h23-5-22" id="h23-5-22" class="i">+                    &quot;Unknown function {} with {} arguments&quot;,
</a><a href="#h23-5-23" id="h23-5-23" class="i">+                    name,
</a><a href="#h23-5-24" id="h23-5-24" class="i">+                    args.len()
</a><a href="#h23-5-25" id="h23-5-25" class="i">+                )))
</a><a href="#h23-5-26" id="h23-5-26" class="i">+            }
</a>             ast::Expression::Operation(op) =&gt; match op {
                 // Logical operators
                 ast::Operation::And(lhs, rhs) =&gt; And(self.make(lhs)?, self.make(rhs)?),
<a href="#h23-6" id="h23-6" class="h">@@ -422,35 +539,154 @@ impl ExpressionBuilder {
</a>             },
         }))
     }
<a href="#h23-6-3" id="h23-6-3" class="i">+}
</a><a href="#h23-6-4" id="h23-6-4" class="i">+
</a><a href="#h23-6-5" id="h23-6-5" class="i">+/// Manages names available to expressions and executors, and maps them onto columns/fields.
</a><a href="#h23-6-6" id="h23-6-6" class="i">+#[derive(Debug)]
</a><a href="#h23-6-7" id="h23-6-7" class="i">+pub struct Scope {
</a><a href="#h23-6-8" id="h23-6-8" class="i">+    // If true, the scope is constant and cannot contain any variables.
</a><a href="#h23-6-9" id="h23-6-9" class="i">+    constant: bool,
</a><a href="#h23-6-10" id="h23-6-10" class="i">+    // Currently visible tables, by query name (i.e. alias or actual name).
</a><a href="#h23-6-11" id="h23-6-11" class="i">+    tables: HashMap&lt;String, Table&gt;,
</a><a href="#h23-6-12" id="h23-6-12" class="i">+    // Column labels, if any (qualified by table name when available)
</a><a href="#h23-6-13" id="h23-6-13" class="i">+    columns: Vec&lt;(Option&lt;String&gt;, Option&lt;String&gt;)&gt;,
</a><a href="#h23-6-14" id="h23-6-14" class="i">+    // Qualified names to column indexes.
</a><a href="#h23-6-15" id="h23-6-15" class="i">+    qualified: HashMap&lt;(String, String), usize&gt;,
</a><a href="#h23-6-16" id="h23-6-16" class="i">+    // Unqualified names to column indexes, if unique.
</a><a href="#h23-6-17" id="h23-6-17" class="i">+    unqualified: HashMap&lt;String, usize&gt;,
</a><a href="#h23-6-18" id="h23-6-18" class="i">+    // Unqialified ambiguous names.
</a><a href="#h23-6-19" id="h23-6-19" class="i">+    ambiguous: HashSet&lt;String&gt;,
</a><a href="#h23-6-20" id="h23-6-20" class="i">+}
</a><a href="#h23-6-21" id="h23-6-21" class="i">+
</a><a href="#h23-6-22" id="h23-6-22" class="i">+impl Scope {
</a><a href="#h23-6-23" id="h23-6-23" class="i">+    /// Creates a new, empty scope.
</a><a href="#h23-6-24" id="h23-6-24" class="i">+    fn new() -&gt; Self {
</a><a href="#h23-6-25" id="h23-6-25" class="i">+        Self {
</a><a href="#h23-6-26" id="h23-6-26" class="i">+            constant: false,
</a><a href="#h23-6-27" id="h23-6-27" class="i">+            tables: HashMap::new(),
</a><a href="#h23-6-28" id="h23-6-28" class="i">+            columns: Vec::new(),
</a><a href="#h23-6-29" id="h23-6-29" class="i">+            qualified: HashMap::new(),
</a><a href="#h23-6-30" id="h23-6-30" class="i">+            unqualified: HashMap::new(),
</a><a href="#h23-6-31" id="h23-6-31" class="i">+            ambiguous: HashSet::new(),
</a><a href="#h23-6-32" id="h23-6-32" class="i">+        }
</a><a href="#h23-6-33" id="h23-6-33" class="i">+    }
</a> 
<a href="#h23-6-35" id="h23-6-35" class="d">-    fn make_aggregate(
</a><a href="#h23-6-36" id="h23-6-36" class="d">-        &amp;mut self,
</a><a href="#h23-6-37" id="h23-6-37" class="d">-        name: &amp;str,
</a><a href="#h23-6-38" id="h23-6-38" class="d">-        expr: Box&lt;ast::Expression&gt;,
</a><a href="#h23-6-39" id="h23-6-39" class="d">-    ) -&gt; Result&lt;Box&lt;Expression&gt;&gt; {
</a><a href="#h23-6-40" id="h23-6-40" class="d">-        if !self.agg_allow {
</a><a href="#h23-6-41" id="h23-6-41" class="i">+    /// Creates a constant scope.
</a><a href="#h23-6-42" id="h23-6-42" class="i">+    fn constant() -&gt; Self {
</a><a href="#h23-6-43" id="h23-6-43" class="i">+        let mut scope = Self::new();
</a><a href="#h23-6-44" id="h23-6-44" class="i">+        scope.constant = true;
</a><a href="#h23-6-45" id="h23-6-45" class="i">+        scope
</a><a href="#h23-6-46" id="h23-6-46" class="i">+    }
</a><a href="#h23-6-47" id="h23-6-47" class="i">+
</a><a href="#h23-6-48" id="h23-6-48" class="i">+    /// Creates a scope from a table.
</a><a href="#h23-6-49" id="h23-6-49" class="i">+    fn from_table(table: Table) -&gt; Result&lt;Self&gt; {
</a><a href="#h23-6-50" id="h23-6-50" class="i">+        let mut scope = Self::new();
</a><a href="#h23-6-51" id="h23-6-51" class="i">+        scope.add_table(table.name.clone(), table)?;
</a><a href="#h23-6-52" id="h23-6-52" class="i">+        Ok(scope)
</a><a href="#h23-6-53" id="h23-6-53" class="i">+    }
</a><a href="#h23-6-54" id="h23-6-54" class="i">+
</a><a href="#h23-6-55" id="h23-6-55" class="i">+    /// Adds a column to the scope.
</a><a href="#h23-6-56" id="h23-6-56" class="i">+    #[allow(clippy::map_entry)]
</a><a href="#h23-6-57" id="h23-6-57" class="i">+    fn add_column(&amp;mut self, table: Option&lt;String&gt;, label: Option&lt;String&gt;) {
</a><a href="#h23-6-58" id="h23-6-58" class="i">+        if let Some(l) = label.clone() {
</a><a href="#h23-6-59" id="h23-6-59" class="i">+            if let Some(t) = table.clone() {
</a><a href="#h23-6-60" id="h23-6-60" class="i">+                self.qualified.insert((t, l.clone()), self.columns.len());
</a><a href="#h23-6-61" id="h23-6-61" class="i">+            }
</a><a href="#h23-6-62" id="h23-6-62" class="i">+            if !self.ambiguous.contains(&amp;l) {
</a><a href="#h23-6-63" id="h23-6-63" class="i">+                if !self.unqualified.contains_key(&amp;l) {
</a><a href="#h23-6-64" id="h23-6-64" class="i">+                    self.unqualified.insert(l, self.columns.len());
</a><a href="#h23-6-65" id="h23-6-65" class="i">+                } else {
</a><a href="#h23-6-66" id="h23-6-66" class="i">+                    self.unqualified.remove(&amp;l);
</a><a href="#h23-6-67" id="h23-6-67" class="i">+                    self.ambiguous.insert(l);
</a><a href="#h23-6-68" id="h23-6-68" class="i">+                }
</a><a href="#h23-6-69" id="h23-6-69" class="i">+            }
</a><a href="#h23-6-70" id="h23-6-70" class="i">+        }
</a><a href="#h23-6-71" id="h23-6-71" class="i">+        self.columns.push((table, label));
</a><a href="#h23-6-72" id="h23-6-72" class="i">+    }
</a><a href="#h23-6-73" id="h23-6-73" class="i">+
</a><a href="#h23-6-74" id="h23-6-74" class="i">+    /// Adds a table to the scope.
</a><a href="#h23-6-75" id="h23-6-75" class="i">+    fn add_table(&amp;mut self, label: String, table: Table) -&gt; Result&lt;()&gt; {
</a><a href="#h23-6-76" id="h23-6-76" class="i">+        if self.constant {
</a><a href="#h23-6-77" id="h23-6-77" class="i">+            return Err(Error::Internal(&quot;Can&#39;t modify constant scope&quot;.into()));
</a><a href="#h23-6-78" id="h23-6-78" class="i">+        }
</a><a href="#h23-6-79" id="h23-6-79" class="i">+        if self.tables.contains_key(&amp;label) {
</a><a href="#h23-6-80" id="h23-6-80" class="i">+            return Err(Error::Value(format!(&quot;Duplicate table name {}&quot;, label)));
</a><a href="#h23-6-81" id="h23-6-81" class="i">+        }
</a><a href="#h23-6-82" id="h23-6-82" class="i">+        for column in &amp;table.columns {
</a><a href="#h23-6-83" id="h23-6-83" class="i">+            self.add_column(Some(label.clone()), Some(column.name.clone()));
</a><a href="#h23-6-84" id="h23-6-84" class="i">+        }
</a><a href="#h23-6-85" id="h23-6-85" class="i">+        self.tables.insert(label, table);
</a><a href="#h23-6-86" id="h23-6-86" class="i">+        Ok(())
</a><a href="#h23-6-87" id="h23-6-87" class="i">+    }
</a><a href="#h23-6-88" id="h23-6-88" class="i">+
</a><a href="#h23-6-89" id="h23-6-89" class="i">+    /// Checks if a column index is present in the scope, errors if missing or constant.
</a><a href="#h23-6-90" id="h23-6-90" class="i">+    fn assert(&amp;self, index: usize) -&gt; Result&lt;usize&gt; {
</a><a href="#h23-6-91" id="h23-6-91" class="i">+        if self.constant {
</a>             return Err(Error::Value(format!(
<a href="#h23-6-93" id="h23-6-93" class="d">-                &quot;Aggregate function {}() not allowed here&quot;,
</a><a href="#h23-6-94" id="h23-6-94" class="d">-                name.to_uppercase()
</a><a href="#h23-6-95" id="h23-6-95" class="i">+                &quot;Expression must be constant, found column {}&quot;,
</a><a href="#h23-6-96" id="h23-6-96" class="i">+                index
</a>             )));
         }
<a href="#h23-6-99" id="h23-6-99" class="d">-        self.aggs.push(match name {
</a><a href="#h23-6-100" id="h23-6-100" class="d">-            &quot;avg&quot; =&gt; Aggregate::Average,
</a><a href="#h23-6-101" id="h23-6-101" class="d">-            &quot;count&quot; =&gt; Aggregate::Count,
</a><a href="#h23-6-102" id="h23-6-102" class="d">-            &quot;max&quot; =&gt; Aggregate::Max,
</a><a href="#h23-6-103" id="h23-6-103" class="d">-            &quot;min&quot; =&gt; Aggregate::Min,
</a><a href="#h23-6-104" id="h23-6-104" class="d">-            &quot;sum&quot; =&gt; Aggregate::Sum,
</a><a href="#h23-6-105" id="h23-6-105" class="d">-            _ =&gt; {
</a><a href="#h23-6-106" id="h23-6-106" class="d">-                return Err(Error::Internal(format!(
</a><a href="#h23-6-107" id="h23-6-107" class="d">-                    &quot;Invalid aggregate function {}()&quot;,
</a><a href="#h23-6-108" id="h23-6-108" class="d">-                    name.to_uppercase()
</a><a href="#h23-6-109" id="h23-6-109" class="d">-                )))
</a><a href="#h23-6-110" id="h23-6-110" class="i">+        if index &gt;= self.columns.len() {
</a><a href="#h23-6-111" id="h23-6-111" class="i">+            return Err(Error::Value(format!(&quot;Column index {} not found&quot;, index)));
</a><a href="#h23-6-112" id="h23-6-112" class="i">+        }
</a><a href="#h23-6-113" id="h23-6-113" class="i">+        Ok(index)
</a><a href="#h23-6-114" id="h23-6-114" class="i">+    }
</a><a href="#h23-6-115" id="h23-6-115" class="i">+
</a><a href="#h23-6-116" id="h23-6-116" class="i">+    /// Resolves a name, optionally qualified by a table name.
</a><a href="#h23-6-117" id="h23-6-117" class="i">+    fn resolve(&amp;self, table: Option&lt;&amp;str&gt;, name: &amp;str) -&gt; Result&lt;usize&gt; {
</a><a href="#h23-6-118" id="h23-6-118" class="i">+        if self.constant {
</a><a href="#h23-6-119" id="h23-6-119" class="i">+            return Err(Error::Value(format!(
</a><a href="#h23-6-120" id="h23-6-120" class="i">+                &quot;Expression must be constant, found field {}&quot;,
</a><a href="#h23-6-121" id="h23-6-121" class="i">+                if let Some(table) = table { format!(&quot;{}.{}&quot;, table, name) } else { name.into() }
</a><a href="#h23-6-122" id="h23-6-122" class="i">+            )));
</a><a href="#h23-6-123" id="h23-6-123" class="i">+        }
</a><a href="#h23-6-124" id="h23-6-124" class="i">+        if let Some(table) = table {
</a><a href="#h23-6-125" id="h23-6-125" class="i">+            if !self.tables.contains_key(table) {
</a><a href="#h23-6-126" id="h23-6-126" class="i">+                return Err(Error::Value(format!(&quot;Unknown table {}&quot;, table)));
</a><a href="#h23-6-127" id="h23-6-127" class="i">+            }
</a><a href="#h23-6-128" id="h23-6-128" class="i">+            self.qualified
</a><a href="#h23-6-129" id="h23-6-129" class="i">+                .get(&amp;(table.into(), name.into()))
</a><a href="#h23-6-130" id="h23-6-130" class="i">+                .copied()
</a><a href="#h23-6-131" id="h23-6-131" class="i">+                .ok_or_else(|| Error::Value(format!(&quot;Unknown field {}.{}&quot;, table, name)))
</a><a href="#h23-6-132" id="h23-6-132" class="i">+        } else if self.ambiguous.contains(name) {
</a><a href="#h23-6-133" id="h23-6-133" class="i">+            Err(Error::Value(format!(&quot;Ambiguous field {}&quot;, name)))
</a><a href="#h23-6-134" id="h23-6-134" class="i">+        } else {
</a><a href="#h23-6-135" id="h23-6-135" class="i">+            self.unqualified
</a><a href="#h23-6-136" id="h23-6-136" class="i">+                .get(name)
</a><a href="#h23-6-137" id="h23-6-137" class="i">+                .copied()
</a><a href="#h23-6-138" id="h23-6-138" class="i">+                .ok_or_else(|| Error::Value(format!(&quot;Unknown field {}&quot;, name)))
</a><a href="#h23-6-139" id="h23-6-139" class="i">+        }
</a><a href="#h23-6-140" id="h23-6-140" class="i">+    }
</a><a href="#h23-6-141" id="h23-6-141" class="i">+
</a><a href="#h23-6-142" id="h23-6-142" class="i">+    /// Projects the scope. This takes a set of expressions and labels in the current scope,
</a><a href="#h23-6-143" id="h23-6-143" class="i">+    /// and returns a new scope for the projection.
</a><a href="#h23-6-144" id="h23-6-144" class="i">+    fn project(&amp;mut self, projection: Vec&lt;(Expression, Option&lt;String&gt;)&gt;) -&gt; Result&lt;()&gt; {
</a><a href="#h23-6-145" id="h23-6-145" class="i">+        if self.constant {
</a><a href="#h23-6-146" id="h23-6-146" class="i">+            return Err(Error::Internal(&quot;Can&#39;t modify constant scope&quot;.into()));
</a><a href="#h23-6-147" id="h23-6-147" class="i">+        }
</a><a href="#h23-6-148" id="h23-6-148" class="i">+        let mut new = Self::new();
</a><a href="#h23-6-149" id="h23-6-149" class="i">+        new.tables = self.tables.clone();
</a><a href="#h23-6-150" id="h23-6-150" class="i">+        for (expr, label) in projection {
</a><a href="#h23-6-151" id="h23-6-151" class="i">+            match (expr, label) {
</a><a href="#h23-6-152" id="h23-6-152" class="i">+                (_, Some(label)) =&gt; new.add_column(None, Some(label)),
</a><a href="#h23-6-153" id="h23-6-153" class="i">+                (Expression::Field(_, Some((Some(table), name))), _) =&gt; {
</a><a href="#h23-6-154" id="h23-6-154" class="i">+                    new.add_column(Some(table), Some(name))
</a><a href="#h23-6-155" id="h23-6-155" class="i">+                }
</a><a href="#h23-6-156" id="h23-6-156" class="i">+                (Expression::Field(_, Some((None, name))), _) =&gt; {
</a><a href="#h23-6-157" id="h23-6-157" class="i">+                    if let Some(i) = self.unqualified.get(&amp;name) {
</a><a href="#h23-6-158" id="h23-6-158" class="i">+                        let (table, name) = self.columns[*i].clone();
</a><a href="#h23-6-159" id="h23-6-159" class="i">+                        new.add_column(table, name);
</a><a href="#h23-6-160" id="h23-6-160" class="i">+                    }
</a><a href="#h23-6-161" id="h23-6-161" class="i">+                }
</a><a href="#h23-6-162" id="h23-6-162" class="i">+                (Expression::Field(i, None), _) =&gt; {
</a><a href="#h23-6-163" id="h23-6-163" class="i">+                    let (table, label) = self.columns.get(i).cloned().unwrap_or((None, None));
</a><a href="#h23-6-164" id="h23-6-164" class="i">+                    new.add_column(table, label)
</a><a href="#h23-6-165" id="h23-6-165" class="i">+                }
</a><a href="#h23-6-166" id="h23-6-166" class="i">+                _ =&gt; new.add_column(None, None),
</a>             }
<a href="#h23-6-168" id="h23-6-168" class="d">-        });
</a><a href="#h23-6-169" id="h23-6-169" class="d">-        self.agg_allow = false;
</a><a href="#h23-6-170" id="h23-6-170" class="d">-        let arg = *self.make(expr)?;
</a><a href="#h23-6-171" id="h23-6-171" class="d">-        self.agg_args.push(arg);
</a><a href="#h23-6-172" id="h23-6-172" class="d">-        self.agg_allow = true;
</a><a href="#h23-6-173" id="h23-6-173" class="d">-        Ok(Box::new(Expression::Column(self.aggs.len() - 1)))
</a><a href="#h23-6-174" id="h23-6-174" class="i">+        }
</a><a href="#h23-6-175" id="h23-6-175" class="i">+        replace(self, new);
</a><a href="#h23-6-176" id="h23-6-176" class="i">+        Ok(())
</a>     }
 }
<b>diff --git a/<a id="h24" href="../file/src/sql/schema.rs.html">src/sql/schema.rs</a> b/<a href="../file/src/sql/schema.rs.html">src/sql/schema.rs</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -1,6 +1,6 @@
</a> use super::engine::Transaction;
 use super::parser::format_ident;
<a href="#h24-0-2" id="h24-0-2" class="d">-use super::types::{DataType, Environment, Row, Value};
</a><a href="#h24-0-3" id="h24-0-3" class="i">+use super::types::{DataType, Row, Value};
</a> use crate::error::{Error, Result};
 
 use serde_derive::{Deserialize, Serialize};
<a href="#h24-1" id="h24-1" class="h">@@ -172,16 +172,6 @@ impl Table {
</a>         Ok(row)
     }
 
<a href="#h24-1-3" id="h24-1-3" class="d">-    /// Creates an expression environment for a row in a table
</a><a href="#h24-1-4" id="h24-1-4" class="d">-    #[allow(clippy::ptr_arg)]
</a><a href="#h24-1-5" id="h24-1-5" class="d">-    pub fn row_env&lt;&#39;a&gt;(&amp;&#39;a self, row: &amp;&#39;a Row) -&gt; Environment&lt;&#39;a&gt; {
</a><a href="#h24-1-6" id="h24-1-6" class="d">-        let mut env = Environment::new();
</a><a href="#h24-1-7" id="h24-1-7" class="d">-        for (c, v) in self.columns.iter().zip(row.iter().chain(std::iter::repeat(&amp;Value::Null))) {
</a><a href="#h24-1-8" id="h24-1-8" class="d">-            env.append(Some(&amp;self.name), Some(&amp;c.name), v)
</a><a href="#h24-1-9" id="h24-1-9" class="d">-        }
</a><a href="#h24-1-10" id="h24-1-10" class="d">-        env
</a><a href="#h24-1-11" id="h24-1-11" class="d">-    }
</a><a href="#h24-1-12" id="h24-1-12" class="d">-
</a>     /// Sets a named row field to a value
     pub fn set_row_field(&amp;self, row: &amp;mut Row, field: &amp;str, value: Value) -&gt; Result&lt;()&gt; {
         *row.get_mut(self.get_column_index(field)?)
<b>diff --git a/<a id="h25" href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a> b/<a href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -1,17 +1,16 @@
</a><a href="#h25-0-0" id="h25-0-0" class="d">-use super::Value;
</a><a href="#h25-0-1" id="h25-0-1" class="i">+use super::{Row, Value};
</a> use crate::error::{Error, Result};
 
 use regex::Regex;
 use serde_derive::{Deserialize, Serialize};
<a href="#h25-0-6" id="h25-0-6" class="d">-use std::collections::{HashMap, HashSet};
</a><a href="#h25-0-7" id="h25-0-7" class="i">+use std::mem::replace;
</a> 
 /// An expression, made up of constants and operations
 #[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
 pub enum Expression {
     // Values
     Constant(Value),
<a href="#h25-0-14" id="h25-0-14" class="d">-    Field(Option&lt;String&gt;, String),
</a><a href="#h25-0-15" id="h25-0-15" class="d">-    Column(usize),
</a><a href="#h25-0-16" id="h25-0-16" class="i">+    Field(usize, Option&lt;(Option&lt;String&gt;, String)&gt;),
</a> 
     // Logical operations
     And(Box&lt;Expression&gt;, Box&lt;Expression&gt;),
<a href="#h25-1" id="h25-1" class="h">@@ -44,16 +43,15 @@ pub type Expressions = Vec&lt;Expression&gt;;
</a> 
 impl Expression {
     /// Evaluates an expression to a value, given an environment
<a href="#h25-1-3" id="h25-1-3" class="d">-    pub fn evaluate(&amp;self, env: &amp;Environment) -&gt; Result&lt;Value&gt; {
</a><a href="#h25-1-4" id="h25-1-4" class="i">+    pub fn evaluate(&amp;self, row: Option&lt;&amp;Row&gt;) -&gt; Result&lt;Value&gt; {
</a>         use Value::*;
         Ok(match self {
             // Constant values
             Self::Constant(c) =&gt; c.clone(),
<a href="#h25-1-9" id="h25-1-9" class="d">-            Self::Field(r, f) =&gt; env.lookup_field(r.as_deref(), f)?,
</a><a href="#h25-1-10" id="h25-1-10" class="d">-            Self::Column(i) =&gt; env.lookup_index(*i)?,
</a><a href="#h25-1-11" id="h25-1-11" class="i">+            Self::Field(i, _) =&gt; row.and_then(|row| row.get(*i).cloned()).unwrap_or(Null),
</a> 
             // Logical operations
<a href="#h25-1-14" id="h25-1-14" class="d">-            Self::And(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-1-15" id="h25-1-15" class="i">+            Self::And(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Boolean(lhs), Boolean(rhs)) =&gt; Boolean(lhs &amp;&amp; rhs),
                 (Boolean(lhs), Null) if !lhs =&gt; Boolean(false),
                 (Boolean(_), Null) =&gt; Null,
<a href="#h25-2" id="h25-2" class="h">@@ -62,12 +60,12 @@ impl Expression {
</a>                 (Null, Null) =&gt; Null,
                 (lhs, rhs) =&gt; return Err(Error::Value(format!(&quot;Can&#39;t and {} and {}&quot;, lhs, rhs))),
             },
<a href="#h25-2-3" id="h25-2-3" class="d">-            Self::Not(expr) =&gt; match expr.evaluate(env)? {
</a><a href="#h25-2-4" id="h25-2-4" class="i">+            Self::Not(expr) =&gt; match expr.evaluate(row)? {
</a>                 Boolean(b) =&gt; Boolean(!b),
                 Null =&gt; Null,
                 value =&gt; return Err(Error::Value(format!(&quot;Can&#39;t negate {}&quot;, value))),
             },
<a href="#h25-2-9" id="h25-2-9" class="d">-            Self::Or(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-2-10" id="h25-2-10" class="i">+            Self::Or(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Boolean(lhs), Boolean(rhs)) =&gt; Boolean(lhs || rhs),
                 (Boolean(lhs), Null) if lhs =&gt; Boolean(true),
                 (Boolean(_), Null) =&gt; Null,
<a href="#h25-3" id="h25-3" class="h">@@ -79,7 +77,7 @@ impl Expression {
</a> 
             // Comparison operations
             #[allow(clippy::float_cmp)] // Up to the user if they want to compare or not
<a href="#h25-3-3" id="h25-3-3" class="d">-            Self::Equal(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-3-4" id="h25-3-4" class="i">+            Self::Equal(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Boolean(lhs), Boolean(rhs)) =&gt; Boolean(lhs == rhs),
                 (Integer(lhs), Integer(rhs)) =&gt; Boolean(lhs == rhs),
                 (Integer(lhs), Float(rhs)) =&gt; Boolean(lhs as f64 == rhs),
<a href="#h25-4" id="h25-4" class="h">@@ -91,7 +89,7 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t compare {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-4-3" id="h25-4-3" class="d">-            Self::GreaterThan(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-4-4" id="h25-4-4" class="i">+            Self::GreaterThan(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 #[allow(clippy::bool_comparison)]
                 (Boolean(lhs), Boolean(rhs)) =&gt; Boolean(lhs &gt; rhs),
                 (Integer(lhs), Integer(rhs)) =&gt; Boolean(lhs &gt; rhs),
<a href="#h25-5" id="h25-5" class="h">@@ -104,7 +102,7 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t compare {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-5-3" id="h25-5-3" class="d">-            Self::LessThan(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-5-4" id="h25-5-4" class="i">+            Self::LessThan(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 #[allow(clippy::bool_comparison)]
                 (Boolean(lhs), Boolean(rhs)) =&gt; Boolean(lhs &lt; rhs),
                 (Integer(lhs), Integer(rhs)) =&gt; Boolean(lhs &lt; rhs),
<a href="#h25-6" id="h25-6" class="h">@@ -117,13 +115,13 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t compare {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-6-3" id="h25-6-3" class="d">-            Self::IsNull(expr) =&gt; match expr.evaluate(env)? {
</a><a href="#h25-6-4" id="h25-6-4" class="i">+            Self::IsNull(expr) =&gt; match expr.evaluate(row)? {
</a>                 Null =&gt; Boolean(true),
                 _ =&gt; Boolean(false),
             },
 
             // Mathematical operations
<a href="#h25-6-10" id="h25-6-10" class="d">-            Self::Add(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-6-11" id="h25-6-11" class="i">+            Self::Add(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Integer(lhs), Integer(rhs)) =&gt; Integer(
                     lhs.checked_add(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
                 ),
<a href="#h25-7" id="h25-7" class="h">@@ -137,13 +135,13 @@ impl Expression {
</a>                 (Null, Null) =&gt; Null,
                 (lhs, rhs) =&gt; return Err(Error::Value(format!(&quot;Can&#39;t add {} and {}&quot;, lhs, rhs))),
             },
<a href="#h25-7-3" id="h25-7-3" class="d">-            Self::Assert(expr) =&gt; match expr.evaluate(env)? {
</a><a href="#h25-7-4" id="h25-7-4" class="i">+            Self::Assert(expr) =&gt; match expr.evaluate(row)? {
</a>                 Float(f) =&gt; Float(f),
                 Integer(i) =&gt; Integer(i),
                 Null =&gt; Null,
                 expr =&gt; return Err(Error::Value(format!(&quot;Can&#39;t take the positive of {}&quot;, expr))),
             },
<a href="#h25-7-10" id="h25-7-10" class="d">-            Self::Divide(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-7-11" id="h25-7-11" class="i">+            Self::Divide(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Integer(_), Integer(rhs)) if rhs == 0 =&gt; {
                     return Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into()))
                 }
<a href="#h25-8" id="h25-8" class="h">@@ -160,7 +158,7 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t divide {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-8-3" id="h25-8-3" class="d">-            Self::Exponentiate(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-8-4" id="h25-8-4" class="i">+            Self::Exponentiate(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Integer(lhs), Integer(rhs)) if rhs &gt;= 0 =&gt; Integer(
                     lhs.checked_pow(rhs as u32)
                         .ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
<a href="#h25-9" id="h25-9" class="h">@@ -178,7 +176,7 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t exponentiate {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-9-3" id="h25-9-3" class="d">-            Self::Factorial(expr) =&gt; match expr.evaluate(env)? {
</a><a href="#h25-9-4" id="h25-9-4" class="i">+            Self::Factorial(expr) =&gt; match expr.evaluate(row)? {
</a>                 Integer(i) if i &lt; 0 =&gt; {
                     return Err(Error::Value(&quot;Can&#39;t take factorial of negative number&quot;.into()))
                 }
<a href="#h25-10" id="h25-10" class="h">@@ -186,7 +184,7 @@ impl Expression {
</a>                 Null =&gt; Null,
                 value =&gt; return Err(Error::Value(format!(&quot;Can&#39;t take factorial of {}&quot;, value))),
             },
<a href="#h25-10-3" id="h25-10-3" class="d">-            Self::Modulo(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-10-4" id="h25-10-4" class="i">+            Self::Modulo(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 // This uses remainder semantics, like Postgres.
                 (Integer(_), Integer(rhs)) if rhs == 0 =&gt; {
                     return Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into()))
<a href="#h25-11" id="h25-11" class="h">@@ -204,7 +202,7 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t take modulo of {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-11-3" id="h25-11-3" class="d">-            Self::Multiply(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-11-4" id="h25-11-4" class="i">+            Self::Multiply(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Integer(lhs), Integer(rhs)) =&gt; Integer(
                     lhs.checked_mul(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
                 ),
<a href="#h25-12" id="h25-12" class="h">@@ -220,13 +218,13 @@ impl Expression {
</a>                     return Err(Error::Value(format!(&quot;Can&#39;t multiply {} and {}&quot;, lhs, rhs)))
                 }
             },
<a href="#h25-12-3" id="h25-12-3" class="d">-            Self::Negate(expr) =&gt; match expr.evaluate(env)? {
</a><a href="#h25-12-4" id="h25-12-4" class="i">+            Self::Negate(expr) =&gt; match expr.evaluate(row)? {
</a>                 Integer(i) =&gt; Integer(-i),
                 Float(f) =&gt; Float(-f),
                 Null =&gt; Null,
                 value =&gt; return Err(Error::Value(format!(&quot;Can&#39;t negate {}&quot;, value))),
             },
<a href="#h25-12-10" id="h25-12-10" class="d">-            Self::Subtract(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-12-11" id="h25-12-11" class="i">+            Self::Subtract(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (Integer(lhs), Integer(rhs)) =&gt; Integer(
                     lhs.checked_sub(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
                 ),
<a href="#h25-13" id="h25-13" class="h">@@ -244,7 +242,7 @@ impl Expression {
</a>             },
 
             // String operations
<a href="#h25-13-3" id="h25-13-3" class="d">-            Self::Like(lhs, rhs) =&gt; match (lhs.evaluate(env)?, rhs.evaluate(env)?) {
</a><a href="#h25-13-4" id="h25-13-4" class="i">+            Self::Like(lhs, rhs) =&gt; match (lhs.evaluate(row)?, rhs.evaluate(row)?) {
</a>                 (String(lhs), String(rhs)) =&gt; Boolean(
                     Regex::new(&amp;format!(
                         &quot;^{}$&quot;,
<a href="#h25-14" id="h25-14" class="h">@@ -263,88 +261,37 @@ impl Expression {
</a>         })
     }
 
<a href="#h25-14-3" id="h25-14-3" class="d">-    /// Checks whether the expression is constant
</a><a href="#h25-14-4" id="h25-14-4" class="i">+    /// Walks the expression tree while calling a closure. Returns true as soon as the closure
</a><a href="#h25-14-5" id="h25-14-5" class="i">+    /// returns true. This is the inverse of walk().
</a><a href="#h25-14-6" id="h25-14-6" class="i">+    pub fn contains&lt;F: Fn(&amp;Expression) -&gt; bool&gt;(&amp;self, visitor: &amp;F) -&gt; bool {
</a><a href="#h25-14-7" id="h25-14-7" class="i">+        !self.walk(&amp;|e| !visitor(e))
</a><a href="#h25-14-8" id="h25-14-8" class="i">+    }
</a><a href="#h25-14-9" id="h25-14-9" class="i">+
</a><a href="#h25-14-10" id="h25-14-10" class="i">+    /// Checks whether the expression is constant, i.e. that it does not contains field references.
</a>     pub fn is_constant(&amp;self) -&gt; bool {
<a href="#h25-14-12" id="h25-14-12" class="d">-        self.walk(&amp;|expr| match expr {
</a><a href="#h25-14-13" id="h25-14-13" class="d">-            Self::Column(_) =&gt; false,
</a><a href="#h25-14-14" id="h25-14-14" class="d">-            Self::Field(_, _) =&gt; false,
</a><a href="#h25-14-15" id="h25-14-15" class="d">-            _ =&gt; true,
</a><a href="#h25-14-16" id="h25-14-16" class="i">+        !self.contains(&amp;|expr| match expr {
</a><a href="#h25-14-17" id="h25-14-17" class="i">+            Self::Field(_, _) =&gt; true,
</a><a href="#h25-14-18" id="h25-14-18" class="i">+            _ =&gt; false,
</a>         })
     }
 
<a href="#h25-14-22" id="h25-14-22" class="d">-    /// Transforms the expression tree, by applying a callback function to it
</a><a href="#h25-14-23" id="h25-14-23" class="d">-    /// before and/or after descending into it.
</a><a href="#h25-14-24" id="h25-14-24" class="d">-    pub fn transform&lt;B, A&gt;(mut self, pre: &amp;B, post: &amp;A) -&gt; Result&lt;Self&gt;
</a><a href="#h25-14-25" id="h25-14-25" class="i">+    /// Replaces the expression with result of the closure. Helper function for transform().
</a><a href="#h25-14-26" id="h25-14-26" class="i">+    fn replace_with&lt;F: Fn(Self) -&gt; Result&lt;Self&gt;&gt;(&amp;mut self, f: F) -&gt; Result&lt;()&gt; {
</a><a href="#h25-14-27" id="h25-14-27" class="i">+        // Temporarily replace expression with a null value, in case closure panics. May consider
</a><a href="#h25-14-28" id="h25-14-28" class="i">+        // replace_with crate if this hampers performance.
</a><a href="#h25-14-29" id="h25-14-29" class="i">+        let expr = replace(self, Expression::Constant(Value::Null));
</a><a href="#h25-14-30" id="h25-14-30" class="i">+        replace(self, f(expr)?);
</a><a href="#h25-14-31" id="h25-14-31" class="i">+        Ok(())
</a><a href="#h25-14-32" id="h25-14-32" class="i">+    }
</a><a href="#h25-14-33" id="h25-14-33" class="i">+
</a><a href="#h25-14-34" id="h25-14-34" class="i">+    /// Transforms the expression tree by applying a closure before and after descending.
</a><a href="#h25-14-35" id="h25-14-35" class="i">+    pub fn transform&lt;B, A&gt;(mut self, before: &amp;B, after: &amp;A) -&gt; Result&lt;Self&gt;
</a>     where
         B: Fn(Self) -&gt; Result&lt;Self&gt;,
         A: Fn(Self) -&gt; Result&lt;Self&gt;,
     {
<a href="#h25-14-40" id="h25-14-40" class="d">-        self = pre(self)?;
</a><a href="#h25-14-41" id="h25-14-41" class="d">-        // FIXME Ugly having to explicitly reconstruct each variant, but unable to
</a><a href="#h25-14-42" id="h25-14-42" class="d">-        // find a way to dynamically construct or update without changing signatures
</a><a href="#h25-14-43" id="h25-14-43" class="d">-        // to use mutable references over ownership.
</a><a href="#h25-14-44" id="h25-14-44" class="d">-        self = match self {
</a><a href="#h25-14-45" id="h25-14-45" class="d">-            // Constants
</a><a href="#h25-14-46" id="h25-14-46" class="d">-            node @ Self::Constant(_) | node @ Self::Field(_, _) | node @ Self::Column(_) =&gt; node,
</a><a href="#h25-14-47" id="h25-14-47" class="d">-
</a><a href="#h25-14-48" id="h25-14-48" class="d">-            // Logical operations
</a><a href="#h25-14-49" id="h25-14-49" class="d">-            Self::And(lhs, rhs) =&gt; {
</a><a href="#h25-14-50" id="h25-14-50" class="d">-                Self::And(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-51" id="h25-14-51" class="d">-            }
</a><a href="#h25-14-52" id="h25-14-52" class="d">-            Self::Not(expr) =&gt; Self::Not(expr.transform(pre, post)?.into()),
</a><a href="#h25-14-53" id="h25-14-53" class="d">-            Self::Or(lhs, rhs) =&gt; {
</a><a href="#h25-14-54" id="h25-14-54" class="d">-                Self::Or(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-55" id="h25-14-55" class="d">-            }
</a><a href="#h25-14-56" id="h25-14-56" class="d">-
</a><a href="#h25-14-57" id="h25-14-57" class="d">-            // Comparisons
</a><a href="#h25-14-58" id="h25-14-58" class="d">-            Self::Equal(lhs, rhs) =&gt; {
</a><a href="#h25-14-59" id="h25-14-59" class="d">-                Self::Equal(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-60" id="h25-14-60" class="d">-            }
</a><a href="#h25-14-61" id="h25-14-61" class="d">-            Self::GreaterThan(lhs, rhs) =&gt; Self::GreaterThan(
</a><a href="#h25-14-62" id="h25-14-62" class="d">-                lhs.transform(pre, post)?.into(),
</a><a href="#h25-14-63" id="h25-14-63" class="d">-                rhs.transform(pre, post)?.into(),
</a><a href="#h25-14-64" id="h25-14-64" class="d">-            ),
</a><a href="#h25-14-65" id="h25-14-65" class="d">-            Self::LessThan(lhs, rhs) =&gt; {
</a><a href="#h25-14-66" id="h25-14-66" class="d">-                Self::LessThan(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-67" id="h25-14-67" class="d">-            }
</a><a href="#h25-14-68" id="h25-14-68" class="d">-            Self::IsNull(expr) =&gt; Self::IsNull(expr.transform(pre, post)?.into()),
</a><a href="#h25-14-69" id="h25-14-69" class="d">-
</a><a href="#h25-14-70" id="h25-14-70" class="d">-            // Mathematical operations
</a><a href="#h25-14-71" id="h25-14-71" class="d">-            Self::Add(lhs, rhs) =&gt; {
</a><a href="#h25-14-72" id="h25-14-72" class="d">-                Self::Add(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-73" id="h25-14-73" class="d">-            }
</a><a href="#h25-14-74" id="h25-14-74" class="d">-            Self::Assert(expr) =&gt; Self::Assert(expr.transform(pre, post)?.into()),
</a><a href="#h25-14-75" id="h25-14-75" class="d">-            Self::Divide(lhs, rhs) =&gt; {
</a><a href="#h25-14-76" id="h25-14-76" class="d">-                Self::Divide(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-77" id="h25-14-77" class="d">-            }
</a><a href="#h25-14-78" id="h25-14-78" class="d">-            Self::Exponentiate(lhs, rhs) =&gt; Self::Exponentiate(
</a><a href="#h25-14-79" id="h25-14-79" class="d">-                lhs.transform(pre, post)?.into(),
</a><a href="#h25-14-80" id="h25-14-80" class="d">-                rhs.transform(pre, post)?.into(),
</a><a href="#h25-14-81" id="h25-14-81" class="d">-            ),
</a><a href="#h25-14-82" id="h25-14-82" class="d">-            Self::Factorial(expr) =&gt; Self::Factorial(expr.transform(pre, post)?.into()),
</a><a href="#h25-14-83" id="h25-14-83" class="d">-            Self::Modulo(lhs, rhs) =&gt; {
</a><a href="#h25-14-84" id="h25-14-84" class="d">-                Self::Modulo(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-85" id="h25-14-85" class="d">-            }
</a><a href="#h25-14-86" id="h25-14-86" class="d">-            Self::Multiply(lhs, rhs) =&gt; {
</a><a href="#h25-14-87" id="h25-14-87" class="d">-                Self::Multiply(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-88" id="h25-14-88" class="d">-            }
</a><a href="#h25-14-89" id="h25-14-89" class="d">-            Self::Negate(expr) =&gt; Self::Negate(expr.transform(pre, post)?.into()),
</a><a href="#h25-14-90" id="h25-14-90" class="d">-            Self::Subtract(lhs, rhs) =&gt; {
</a><a href="#h25-14-91" id="h25-14-91" class="d">-                Self::Subtract(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-92" id="h25-14-92" class="d">-            }
</a><a href="#h25-14-93" id="h25-14-93" class="d">-
</a><a href="#h25-14-94" id="h25-14-94" class="d">-            // String operations
</a><a href="#h25-14-95" id="h25-14-95" class="d">-            Self::Like(lhs, rhs) =&gt; {
</a><a href="#h25-14-96" id="h25-14-96" class="d">-                Self::Like(lhs.transform(pre, post)?.into(), rhs.transform(pre, post)?.into())
</a><a href="#h25-14-97" id="h25-14-97" class="d">-            }
</a><a href="#h25-14-98" id="h25-14-98" class="d">-        };
</a><a href="#h25-14-99" id="h25-14-99" class="d">-        post(self)
</a><a href="#h25-14-100" id="h25-14-100" class="d">-    }
</a><a href="#h25-14-101" id="h25-14-101" class="d">-
</a><a href="#h25-14-102" id="h25-14-102" class="d">-    /// Walks the expression tree depth-first, calling a closure for every element.
</a><a href="#h25-14-103" id="h25-14-103" class="d">-    /// If the closure returns false, walking is halted.
</a><a href="#h25-14-104" id="h25-14-104" class="d">-    pub fn walk&lt;F: Fn(&amp;Expression) -&gt; bool&gt;(&amp;self, visitor: &amp;F) -&gt; bool {
</a><a href="#h25-14-105" id="h25-14-105" class="d">-        if match self {
</a><a href="#h25-14-106" id="h25-14-106" class="i">+        self = before(self)?;
</a><a href="#h25-14-107" id="h25-14-107" class="i">+        match &amp;mut self {
</a>             Self::Add(lhs, rhs)
             | Self::And(lhs, rhs)
             | Self::Divide(lhs, rhs)
<a href="#h25-15" id="h25-15" class="h">@@ -356,83 +303,46 @@ impl Expression {
</a>             | Self::Modulo(lhs, rhs)
             | Self::Multiply(lhs, rhs)
             | Self::Or(lhs, rhs)
<a href="#h25-15-3" id="h25-15-3" class="d">-            | Self::Subtract(lhs, rhs) =&gt; lhs.walk(visitor) &amp;&amp; rhs.walk(visitor),
</a><a href="#h25-15-4" id="h25-15-4" class="i">+            | Self::Subtract(lhs, rhs) =&gt; {
</a><a href="#h25-15-5" id="h25-15-5" class="i">+                Self::replace_with(lhs, |e| e.transform(before, after))?;
</a><a href="#h25-15-6" id="h25-15-6" class="i">+                Self::replace_with(rhs, |e| e.transform(before, after))?;
</a><a href="#h25-15-7" id="h25-15-7" class="i">+            }
</a> 
             Self::Assert(expr)
             | Self::Factorial(expr)
             | Self::IsNull(expr)
             | Self::Negate(expr)
<a href="#h25-15-13" id="h25-15-13" class="d">-            | Self::Not(expr) =&gt; expr.walk(visitor),
</a><a href="#h25-15-14" id="h25-15-14" class="i">+            | Self::Not(expr) =&gt; Self::replace_with(expr, |e| e.transform(before, after))?,
</a> 
<a href="#h25-15-16" id="h25-15-16" class="d">-            Self::Constant(_) | Self::Field(_, _) | Self::Column(_) =&gt; true,
</a><a href="#h25-15-17" id="h25-15-17" class="d">-        } {
</a><a href="#h25-15-18" id="h25-15-18" class="d">-            visitor(self)
</a><a href="#h25-15-19" id="h25-15-19" class="d">-        } else {
</a><a href="#h25-15-20" id="h25-15-20" class="d">-            false
</a><a href="#h25-15-21" id="h25-15-21" class="d">-        }
</a><a href="#h25-15-22" id="h25-15-22" class="i">+            Self::Constant(_) | Self::Field(_, _) =&gt; {}
</a><a href="#h25-15-23" id="h25-15-23" class="i">+        };
</a><a href="#h25-15-24" id="h25-15-24" class="i">+        after(self)
</a>     }
<a href="#h25-15-26" id="h25-15-26" class="d">-}
</a> 
<a href="#h25-15-28" id="h25-15-28" class="d">-/// An expression evaluation environment
</a><a href="#h25-15-29" id="h25-15-29" class="d">-pub struct Environment&lt;&#39;a&gt; {
</a><a href="#h25-15-30" id="h25-15-30" class="d">-    // For lookups by index (i.e. column number)
</a><a href="#h25-15-31" id="h25-15-31" class="d">-    index: Vec&lt;&amp;&#39;a Value&gt;,
</a><a href="#h25-15-32" id="h25-15-32" class="d">-    // For qualified lookups, with both relation and field name
</a><a href="#h25-15-33" id="h25-15-33" class="d">-    qualified: HashMap&lt;(&amp;&#39;a str, &amp;&#39;a str), &amp;&#39;a Value&gt;,
</a><a href="#h25-15-34" id="h25-15-34" class="d">-    // For unqualified lookups. Multiple fields with same unqualified name are ambiguous.
</a><a href="#h25-15-35" id="h25-15-35" class="d">-    unqualified: HashMap&lt;&amp;&#39;a str, &amp;&#39;a Value&gt;,
</a><a href="#h25-15-36" id="h25-15-36" class="d">-    ambiguous: HashSet&lt;&amp;&#39;a str&gt;,
</a><a href="#h25-15-37" id="h25-15-37" class="d">-}
</a><a href="#h25-15-38" id="h25-15-38" class="i">+    /// Walks the expression tree, calling a closure for every node. Halts if closure returns false.
</a><a href="#h25-15-39" id="h25-15-39" class="i">+    pub fn walk&lt;F: Fn(&amp;Expression) -&gt; bool&gt;(&amp;self, visitor: &amp;F) -&gt; bool {
</a><a href="#h25-15-40" id="h25-15-40" class="i">+        visitor(self)
</a><a href="#h25-15-41" id="h25-15-41" class="i">+            &amp;&amp; match self {
</a><a href="#h25-15-42" id="h25-15-42" class="i">+                Self::Add(lhs, rhs)
</a><a href="#h25-15-43" id="h25-15-43" class="i">+                | Self::And(lhs, rhs)
</a><a href="#h25-15-44" id="h25-15-44" class="i">+                | Self::Divide(lhs, rhs)
</a><a href="#h25-15-45" id="h25-15-45" class="i">+                | Self::Equal(lhs, rhs)
</a><a href="#h25-15-46" id="h25-15-46" class="i">+                | Self::Exponentiate(lhs, rhs)
</a><a href="#h25-15-47" id="h25-15-47" class="i">+                | Self::GreaterThan(lhs, rhs)
</a><a href="#h25-15-48" id="h25-15-48" class="i">+                | Self::LessThan(lhs, rhs)
</a><a href="#h25-15-49" id="h25-15-49" class="i">+                | Self::Like(lhs, rhs)
</a><a href="#h25-15-50" id="h25-15-50" class="i">+                | Self::Modulo(lhs, rhs)
</a><a href="#h25-15-51" id="h25-15-51" class="i">+                | Self::Multiply(lhs, rhs)
</a><a href="#h25-15-52" id="h25-15-52" class="i">+                | Self::Or(lhs, rhs)
</a><a href="#h25-15-53" id="h25-15-53" class="i">+                | Self::Subtract(lhs, rhs) =&gt; lhs.walk(visitor) &amp;&amp; rhs.walk(visitor),
</a> 
<a href="#h25-15-55" id="h25-15-55" class="d">-impl&lt;&#39;a&gt; Environment&lt;&#39;a&gt; {
</a><a href="#h25-15-56" id="h25-15-56" class="d">-    /// Creates a new environment
</a><a href="#h25-15-57" id="h25-15-57" class="d">-    pub fn new() -&gt; Self {
</a><a href="#h25-15-58" id="h25-15-58" class="d">-        Self {
</a><a href="#h25-15-59" id="h25-15-59" class="d">-            index: Vec::new(),
</a><a href="#h25-15-60" id="h25-15-60" class="d">-            qualified: HashMap::new(),
</a><a href="#h25-15-61" id="h25-15-61" class="d">-            unqualified: HashMap::new(),
</a><a href="#h25-15-62" id="h25-15-62" class="d">-            ambiguous: HashSet::new(),
</a><a href="#h25-15-63" id="h25-15-63" class="d">-        }
</a><a href="#h25-15-64" id="h25-15-64" class="d">-    }
</a><a href="#h25-15-65" id="h25-15-65" class="i">+                Self::Assert(expr)
</a><a href="#h25-15-66" id="h25-15-66" class="i">+                | Self::Factorial(expr)
</a><a href="#h25-15-67" id="h25-15-67" class="i">+                | Self::IsNull(expr)
</a><a href="#h25-15-68" id="h25-15-68" class="i">+                | Self::Negate(expr)
</a><a href="#h25-15-69" id="h25-15-69" class="i">+                | Self::Not(expr) =&gt; expr.walk(visitor),
</a> 
<a href="#h25-15-71" id="h25-15-71" class="d">-    /// Appends a value to the environment
</a><a href="#h25-15-72" id="h25-15-72" class="d">-    pub fn append(&amp;mut self, relation: Option&lt;&amp;&#39;a str&gt;, field: Option&lt;&amp;&#39;a str&gt;, value: &amp;&#39;a Value) {
</a><a href="#h25-15-73" id="h25-15-73" class="d">-        self.index.push(value);
</a><a href="#h25-15-74" id="h25-15-74" class="d">-        if let Some(field) = field {
</a><a href="#h25-15-75" id="h25-15-75" class="d">-            if self.unqualified.contains_key(field) {
</a><a href="#h25-15-76" id="h25-15-76" class="d">-                self.unqualified.remove(field);
</a><a href="#h25-15-77" id="h25-15-77" class="d">-                self.ambiguous.insert(field);
</a><a href="#h25-15-78" id="h25-15-78" class="d">-            } else {
</a><a href="#h25-15-79" id="h25-15-79" class="d">-                self.unqualified.insert(field, value);
</a><a href="#h25-15-80" id="h25-15-80" class="i">+                Self::Constant(_) | Self::Field(_, _) =&gt; true,
</a>             }
<a href="#h25-15-82" id="h25-15-82" class="d">-        }
</a><a href="#h25-15-83" id="h25-15-83" class="d">-        if let (Some(relation), Some(field)) = (relation, field) {
</a><a href="#h25-15-84" id="h25-15-84" class="d">-            self.qualified.insert((relation, field), value);
</a><a href="#h25-15-85" id="h25-15-85" class="d">-        }
</a><a href="#h25-15-86" id="h25-15-86" class="d">-    }
</a><a href="#h25-15-87" id="h25-15-87" class="d">-
</a><a href="#h25-15-88" id="h25-15-88" class="d">-    /// Looks up a value by field
</a><a href="#h25-15-89" id="h25-15-89" class="d">-    pub fn lookup_field(&amp;self, relation: Option&lt;&amp;&#39;a str&gt;, field: &amp;&#39;a str) -&gt; Result&lt;Value&gt; {
</a><a href="#h25-15-90" id="h25-15-90" class="d">-        if let Some(relation) = relation {
</a><a href="#h25-15-91" id="h25-15-91" class="d">-            match self.qualified.get(&amp;(relation, field)) {
</a><a href="#h25-15-92" id="h25-15-92" class="d">-                Some(r) =&gt; Ok((*r).clone()),
</a><a href="#h25-15-93" id="h25-15-93" class="d">-                None =&gt; Err(Error::Value(format!(&quot;Unknown field {}.{}&quot;, relation, field))),
</a><a href="#h25-15-94" id="h25-15-94" class="d">-            }
</a><a href="#h25-15-95" id="h25-15-95" class="d">-        } else if self.ambiguous.contains(field) {
</a><a href="#h25-15-96" id="h25-15-96" class="d">-            Err(Error::Value(format!(&quot;Ambiguous field {}&quot;, field)))
</a><a href="#h25-15-97" id="h25-15-97" class="d">-        } else {
</a><a href="#h25-15-98" id="h25-15-98" class="d">-            match self.unqualified.get(field) {
</a><a href="#h25-15-99" id="h25-15-99" class="d">-                Some(r) =&gt; Ok((*r).clone()),
</a><a href="#h25-15-100" id="h25-15-100" class="d">-                None =&gt; Err(Error::Value(format!(&quot;Unknown field {}&quot;, field))),
</a><a href="#h25-15-101" id="h25-15-101" class="d">-            }
</a><a href="#h25-15-102" id="h25-15-102" class="d">-        }
</a><a href="#h25-15-103" id="h25-15-103" class="d">-    }
</a><a href="#h25-15-104" id="h25-15-104" class="d">-
</a><a href="#h25-15-105" id="h25-15-105" class="d">-    /// Looks up a value by index
</a><a href="#h25-15-106" id="h25-15-106" class="d">-    pub fn lookup_index(&amp;self, index: usize) -&gt; Result&lt;Value&gt; {
</a><a href="#h25-15-107" id="h25-15-107" class="d">-        match self.index.get(index) {
</a><a href="#h25-15-108" id="h25-15-108" class="d">-            Some(r) =&gt; Ok((*r).clone()),
</a><a href="#h25-15-109" id="h25-15-109" class="d">-            None =&gt; Err(Error::Value(format!(&quot;Index {} out of bounds&quot;, index))),
</a><a href="#h25-15-110" id="h25-15-110" class="d">-        }
</a>     }
 }
<b>diff --git a/<a id="h26" href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a> b/<a href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -1,9 +1,8 @@
</a> mod expression;
<a href="#h26-0-1" id="h26-0-1" class="d">-pub use expression::{Environment, Expression, Expressions};
</a><a href="#h26-0-2" id="h26-0-2" class="i">+pub use expression::{Expression, Expressions};
</a> 
 use crate::error::{Error, Result};
 
<a href="#h26-0-6" id="h26-0-6" class="d">-use derivative::Derivative;
</a> use serde_derive::{Deserialize, Serialize};
 use std::borrow::Cow;
 use std::cmp::Ordering;
<a href="#h26-1" id="h26-1" class="h">@@ -184,51 +183,9 @@ pub type Rows = Box&lt;dyn Iterator&lt;Item = Result&lt;Row&gt;&gt; + Send&gt;;
</a> /// A column (in a result set, see schema::Column for table columns)
 #[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
 pub struct Column {
<a href="#h26-1-3" id="h26-1-3" class="d">-    pub relation: Option&lt;String&gt;,
</a><a href="#h26-1-4" id="h26-1-4" class="i">+    pub table: Option&lt;String&gt;,
</a>     pub name: Option&lt;String&gt;,
 }
 
 /// A set of columns
 pub type Columns = Vec&lt;Column&gt;;
<a href="#h26-1-10" id="h26-1-10" class="d">-
</a><a href="#h26-1-11" id="h26-1-11" class="d">-/// A relation, i.e. combination of columns and rows - used for query results.
</a><a href="#h26-1-12" id="h26-1-12" class="d">-/// FIXME This should possibly have a name as well, and be used to qualify query fields.
</a><a href="#h26-1-13" id="h26-1-13" class="d">-#[derive(Derivative, Serialize, Deserialize)]
</a><a href="#h26-1-14" id="h26-1-14" class="d">-#[derivative(Debug, PartialEq)]
</a><a href="#h26-1-15" id="h26-1-15" class="d">-pub struct Relation {
</a><a href="#h26-1-16" id="h26-1-16" class="d">-    pub columns: Columns,
</a><a href="#h26-1-17" id="h26-1-17" class="d">-    #[derivative(Debug = &quot;ignore&quot;)]
</a><a href="#h26-1-18" id="h26-1-18" class="d">-    #[derivative(PartialEq = &quot;ignore&quot;)]
</a><a href="#h26-1-19" id="h26-1-19" class="d">-    #[serde(skip)]
</a><a href="#h26-1-20" id="h26-1-20" class="d">-    pub rows: Option&lt;Rows&gt;,
</a><a href="#h26-1-21" id="h26-1-21" class="d">-}
</a><a href="#h26-1-22" id="h26-1-22" class="d">-
</a><a href="#h26-1-23" id="h26-1-23" class="d">-impl Relation {
</a><a href="#h26-1-24" id="h26-1-24" class="d">-    /// Converts the relation into a single row, if any
</a><a href="#h26-1-25" id="h26-1-25" class="d">-    pub fn into_row(mut self) -&gt; Result&lt;Option&lt;Row&gt;&gt; {
</a><a href="#h26-1-26" id="h26-1-26" class="d">-        self.next().transpose()
</a><a href="#h26-1-27" id="h26-1-27" class="d">-    }
</a><a href="#h26-1-28" id="h26-1-28" class="d">-
</a><a href="#h26-1-29" id="h26-1-29" class="d">-    /// Converts the relation into the first value of the first row, if any
</a><a href="#h26-1-30" id="h26-1-30" class="d">-    pub fn into_value(self) -&gt; Result&lt;Option&lt;Value&gt;&gt; {
</a><a href="#h26-1-31" id="h26-1-31" class="d">-        Ok(self.into_row()?.filter(|row| !row.is_empty()).map(|mut row| row.remove(0)))
</a><a href="#h26-1-32" id="h26-1-32" class="d">-    }
</a><a href="#h26-1-33" id="h26-1-33" class="d">-}
</a><a href="#h26-1-34" id="h26-1-34" class="d">-
</a><a href="#h26-1-35" id="h26-1-35" class="d">-impl Iterator for Relation {
</a><a href="#h26-1-36" id="h26-1-36" class="d">-    type Item = Result&lt;Row&gt;;
</a><a href="#h26-1-37" id="h26-1-37" class="d">-
</a><a href="#h26-1-38" id="h26-1-38" class="d">-    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
</a><a href="#h26-1-39" id="h26-1-39" class="d">-        // Make sure iteration is aborted on the first error, otherwise callers
</a><a href="#h26-1-40" id="h26-1-40" class="d">-        // will keep calling next for as long as it keeps returning errors
</a><a href="#h26-1-41" id="h26-1-41" class="d">-        if let Some(ref mut rows) = self.rows {
</a><a href="#h26-1-42" id="h26-1-42" class="d">-            let result = rows.next();
</a><a href="#h26-1-43" id="h26-1-43" class="d">-            if let Some(Err(_)) = result {
</a><a href="#h26-1-44" id="h26-1-44" class="d">-                self.rows = None;
</a><a href="#h26-1-45" id="h26-1-45" class="d">-            }
</a><a href="#h26-1-46" id="h26-1-46" class="d">-            result
</a><a href="#h26-1-47" id="h26-1-47" class="d">-        } else {
</a><a href="#h26-1-48" id="h26-1-48" class="d">-            None
</a><a href="#h26-1-49" id="h26-1-49" class="d">-        }
</a><a href="#h26-1-50" id="h26-1-50" class="d">-    }
</a><a href="#h26-1-51" id="h26-1-51" class="d">-}
</a><b>diff --git a/<a id="h27" href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a> b/<a href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -7,7 +7,7 @@ use toydb::raft;
</a> use toydb::sql::engine::{Mode, Status};
 use toydb::sql::execution::ResultSet;
 use toydb::sql::schema;
<a href="#h27-0-3" id="h27-0-3" class="d">-use toydb::sql::types::{Column, DataType, Relation, Value};
</a><a href="#h27-0-4" id="h27-0-4" class="i">+use toydb::sql::types::{Column, DataType, Value};
</a> use toydb::storage::kv;
 use toydb::Client;
 
<a href="#h27-1" id="h27-1" class="h">@@ -147,13 +147,11 @@ async fn execute() -&gt; Result&lt;()&gt; {
</a>     assert_eq!(
         result,
         ResultSet::Query {
<a href="#h27-1-3" id="h27-1-3" class="d">-            relation: Relation {
</a><a href="#h27-1-4" id="h27-1-4" class="d">-                columns: vec![
</a><a href="#h27-1-5" id="h27-1-5" class="d">-                    Column { relation: Some(&quot;genres&quot;.into()), name: Some(&quot;id&quot;.into()) },
</a><a href="#h27-1-6" id="h27-1-6" class="d">-                    Column { relation: Some(&quot;genres&quot;.into()), name: Some(&quot;name&quot;.into()) }
</a><a href="#h27-1-7" id="h27-1-7" class="d">-                ],
</a><a href="#h27-1-8" id="h27-1-8" class="d">-                rows: None
</a><a href="#h27-1-9" id="h27-1-9" class="d">-            }
</a><a href="#h27-1-10" id="h27-1-10" class="i">+            columns: vec![
</a><a href="#h27-1-11" id="h27-1-11" class="i">+                Column { table: Some(&quot;genres&quot;.into()), name: Some(&quot;id&quot;.into()) },
</a><a href="#h27-1-12" id="h27-1-12" class="i">+                Column { table: Some(&quot;genres&quot;.into()), name: Some(&quot;name&quot;.into()) }
</a><a href="#h27-1-13" id="h27-1-13" class="i">+            ],
</a><a href="#h27-1-14" id="h27-1-14" class="i">+            rows: Box::new(std::iter::empty()),
</a>         }
     );
     assert_rows(
<a href="#h27-2" id="h27-2" class="h">@@ -169,13 +167,11 @@ async fn execute() -&gt; Result&lt;()&gt; {
</a>     assert_eq!(
         result,
         ResultSet::Query {
<a href="#h27-2-3" id="h27-2-3" class="d">-            relation: Relation {
</a><a href="#h27-2-4" id="h27-2-4" class="d">-                columns: vec![
</a><a href="#h27-2-5" id="h27-2-5" class="d">-                    Column { relation: Some(&quot;genres&quot;.into()), name: Some(&quot;id&quot;.into()) },
</a><a href="#h27-2-6" id="h27-2-6" class="d">-                    Column { relation: Some(&quot;genres&quot;.into()), name: Some(&quot;name&quot;.into()) }
</a><a href="#h27-2-7" id="h27-2-7" class="d">-                ],
</a><a href="#h27-2-8" id="h27-2-8" class="d">-                rows: None
</a><a href="#h27-2-9" id="h27-2-9" class="d">-            }
</a><a href="#h27-2-10" id="h27-2-10" class="i">+            columns: vec![
</a><a href="#h27-2-11" id="h27-2-11" class="i">+                Column { table: Some(&quot;genres&quot;.into()), name: Some(&quot;id&quot;.into()) },
</a><a href="#h27-2-12" id="h27-2-12" class="i">+                Column { table: Some(&quot;genres&quot;.into()), name: Some(&quot;name&quot;.into()) }
</a><a href="#h27-2-13" id="h27-2-13" class="i">+            ],
</a><a href="#h27-2-14" id="h27-2-14" class="i">+            rows: Box::new(std::iter::empty()),
</a>         }
     );
     assert_rows(result, Vec::new());
<b>diff --git a/<a id="h28" href="../file/tests/sql/expression.rs.html">tests/sql/expression.rs</a> b/<a href="../file/tests/sql/expression.rs.html">tests/sql/expression.rs</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -7,8 +7,9 @@ use toydb::sql::types::Value;
</a> fn eval_expr(expr: &amp;str) -&gt; Result&lt;Value&gt; {
     let engine = super::setup(Vec::new())?;
     match engine.session()?.execute(&amp;format!(&quot;SELECT {}&quot;, expr))? {
<a href="#h28-0-3" id="h28-0-3" class="d">-        ResultSet::Query { mut relation } =&gt; {
</a><a href="#h28-0-4" id="h28-0-4" class="d">-            Ok(relation.next().unwrap().unwrap().get(0).unwrap().clone())
</a><a href="#h28-0-5" id="h28-0-5" class="i">+        ResultSet::Query { mut rows, .. } =&gt; {
</a><a href="#h28-0-6" id="h28-0-6" class="i">+            // FIXME Should use into_value or something
</a><a href="#h28-0-7" id="h28-0-7" class="i">+            Ok(rows.next().unwrap().unwrap().get(0).unwrap().clone())
</a>         }
         r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
     }
<b>diff --git a/<a id="h29" href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a> b/<a href="../file/tests/sql/query.rs.html">tests/sql/query.rs</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -86,8 +86,10 @@ macro_rules! test_query {
</a>             };
             write!(f, &quot;{:#?}\n\n&quot;, ast)?;
 
<a href="#h29-0-3" id="h29-0-3" class="i">+            let mut txn = engine.begin(Mode::ReadWrite)?;
</a><a href="#h29-0-4" id="h29-0-4" class="i">+
</a>             write!(f, &quot;Plan: &quot;)?;
<a href="#h29-0-6" id="h29-0-6" class="d">-            let plan = match Plan::build(ast) {
</a><a href="#h29-0-7" id="h29-0-7" class="i">+            let plan = match Plan::build(ast, &amp;mut txn) {
</a>                 Ok(plan) =&gt; plan,
                 Err(err) =&gt; {
                     write!(f, &quot;{:?}&quot;, err)?;
<a href="#h29-1" id="h29-1" class="h">@@ -96,7 +98,6 @@ macro_rules! test_query {
</a>             };
             write!(f, &quot;{:#?}\n\n&quot;, plan)?;
 
<a href="#h29-1-3" id="h29-1-3" class="d">-            let mut txn = engine.begin(Mode::ReadWrite)?;
</a>             write!(f, &quot;Optimized plan: &quot;)?;
             let plan = match plan.optimize(&amp;mut txn) {
                 Ok(plan) =&gt; plan,
<a href="#h29-2" id="h29-2" class="h">@@ -120,9 +121,8 @@ macro_rules! test_query {
</a>             };
             txn.commit()?;
             match result {
<a href="#h29-2-3" id="h29-2-3" class="d">-                ResultSet::Query{relation} =&gt; {
</a><a href="#h29-2-4" id="h29-2-4" class="d">-                    let columns = relation.columns.clone();
</a><a href="#h29-2-5" id="h29-2-5" class="d">-                    let rows: Vec&lt;Row&gt; = match relation.collect() {
</a><a href="#h29-2-6" id="h29-2-6" class="i">+                ResultSet::Query{columns, rows} =&gt; {
</a><a href="#h29-2-7" id="h29-2-7" class="i">+                    let rows: Vec&lt;Row&gt; = match rows.collect() {
</a>                         Ok(rows) =&gt; rows,
                         Err(err) =&gt; {
                             write!(f, &quot; {:?}&quot;, err)?;
<a href="#h29-3" id="h29-3" class="h">@@ -178,8 +178,11 @@ test_query! {
</a>     as_qualified: r#&quot;SELECT 1 AS a.b FROM movies&quot;#,
 
     from_bare: &quot;SELECT * FROM&quot;,
<a href="#h29-3-3" id="h29-3-3" class="d">-    from_unknown: &quot;SELECT * FROM unknown&quot;,
</a>     from_multiple: &quot;SELECT * FROM movies, genres, countries&quot;,
<a href="#h29-3-5" id="h29-3-5" class="i">+    from_unknown: &quot;SELECT * FROM unknown&quot;,
</a><a href="#h29-3-6" id="h29-3-6" class="i">+    from_alias_duplicate: &quot;SELECT * FROM movies a, genres a&quot;,
</a><a href="#h29-3-7" id="h29-3-7" class="i">+    from_alias_duplicate_join: &quot;SELECT * FROM movies a JOIN genres a ON TRUE&quot;,
</a><a href="#h29-3-8" id="h29-3-8" class="i">+    from_duplicate: &quot;SELECT * FROM movies, movies&quot;,
</a> 
     where_bare: &quot;SELECT * FROM movies WHERE&quot;,
     where_true: &quot;SELECT * FROM movies WHERE TRUE&quot;,
<b>diff --git a/<a id="h30" href="../file/tests/sql/query/agg_boolean.html">tests/sql/query/agg_boolean</a> b/<a href="../file/tests/sql/query/agg_boolean.html">tests/sql/query/agg_boolean</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -97,14 +97,19 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;booleans&quot;,
<a href="#h30-0-3" id="h30-0-3" class="d">-                        alias: None,
</a><a href="#h30-0-4" id="h30-0-4" class="i">+                        label: &quot;booleans&quot;,
</a>                         filter: None,
                     },
                     predicate: Not(
                         IsNull(
                             Field(
<a href="#h30-0-10" id="h30-0-10" class="d">-                                None,
</a><a href="#h30-0-11" id="h30-0-11" class="d">-                                &quot;b&quot;,
</a><a href="#h30-0-12" id="h30-0-12" class="i">+                                1,
</a><a href="#h30-0-13" id="h30-0-13" class="i">+                                Some(
</a><a href="#h30-0-14" id="h30-0-14" class="i">+                                    (
</a><a href="#h30-0-15" id="h30-0-15" class="i">+                                        None,
</a><a href="#h30-0-16" id="h30-0-16" class="i">+                                        &quot;b&quot;,
</a><a href="#h30-0-17" id="h30-0-17" class="i">+                                    ),
</a><a href="#h30-0-18" id="h30-0-18" class="i">+                                ),
</a>                             ),
                         ),
                     ),
<a href="#h30-1" id="h30-1" class="h">@@ -118,24 +123,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h30-1-3" id="h30-1-3" class="d">-                        None,
</a><a href="#h30-1-4" id="h30-1-4" class="d">-                        &quot;b&quot;,
</a><a href="#h30-1-5" id="h30-1-5" class="i">+                        1,
</a><a href="#h30-1-6" id="h30-1-6" class="i">+                        Some(
</a><a href="#h30-1-7" id="h30-1-7" class="i">+                            (
</a><a href="#h30-1-8" id="h30-1-8" class="i">+                                None,
</a><a href="#h30-1-9" id="h30-1-9" class="i">+                                &quot;b&quot;,
</a><a href="#h30-1-10" id="h30-1-10" class="i">+                            ),
</a><a href="#h30-1-11" id="h30-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-1-14" id="h30-1-14" class="d">-                        None,
</a><a href="#h30-1-15" id="h30-1-15" class="d">-                        &quot;b&quot;,
</a><a href="#h30-1-16" id="h30-1-16" class="i">+                        1,
</a><a href="#h30-1-17" id="h30-1-17" class="i">+                        Some(
</a><a href="#h30-1-18" id="h30-1-18" class="i">+                            (
</a><a href="#h30-1-19" id="h30-1-19" class="i">+                                None,
</a><a href="#h30-1-20" id="h30-1-20" class="i">+                                &quot;b&quot;,
</a><a href="#h30-1-21" id="h30-1-21" class="i">+                            ),
</a><a href="#h30-1-22" id="h30-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-1-25" id="h30-1-25" class="d">-                        None,
</a><a href="#h30-1-26" id="h30-1-26" class="d">-                        &quot;b&quot;,
</a><a href="#h30-1-27" id="h30-1-27" class="i">+                        1,
</a><a href="#h30-1-28" id="h30-1-28" class="i">+                        Some(
</a><a href="#h30-1-29" id="h30-1-29" class="i">+                            (
</a><a href="#h30-1-30" id="h30-1-30" class="i">+                                None,
</a><a href="#h30-1-31" id="h30-1-31" class="i">+                                &quot;b&quot;,
</a><a href="#h30-1-32" id="h30-1-32" class="i">+                            ),
</a><a href="#h30-1-33" id="h30-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-1-36" id="h30-1-36" class="d">-                        None,
</a><a href="#h30-1-37" id="h30-1-37" class="d">-                        &quot;b&quot;,
</a><a href="#h30-1-38" id="h30-1-38" class="i">+                        1,
</a><a href="#h30-1-39" id="h30-1-39" class="i">+                        Some(
</a><a href="#h30-1-40" id="h30-1-40" class="i">+                            (
</a><a href="#h30-1-41" id="h30-1-41" class="i">+                                None,
</a><a href="#h30-1-42" id="h30-1-42" class="i">+                                &quot;b&quot;,
</a><a href="#h30-1-43" id="h30-1-43" class="i">+                            ),
</a><a href="#h30-1-44" id="h30-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-1-47" id="h30-1-47" class="d">-                        None,
</a><a href="#h30-1-48" id="h30-1-48" class="d">-                        &quot;b&quot;,
</a><a href="#h30-1-49" id="h30-1-49" class="i">+                        1,
</a><a href="#h30-1-50" id="h30-1-50" class="i">+                        Some(
</a><a href="#h30-1-51" id="h30-1-51" class="i">+                            (
</a><a href="#h30-1-52" id="h30-1-52" class="i">+                                None,
</a><a href="#h30-1-53" id="h30-1-53" class="i">+                                &quot;b&quot;,
</a><a href="#h30-1-54" id="h30-1-54" class="i">+                            ),
</a><a href="#h30-1-55" id="h30-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h30-2" id="h30-2" class="h">@@ -155,20 +185,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h30-2-3" id="h30-2-3" class="d">-            Column(
</a><a href="#h30-2-4" id="h30-2-4" class="i">+            Field(
</a>                 0,
<a href="#h30-2-6" id="h30-2-6" class="i">+                None,
</a>             ),
<a href="#h30-2-8" id="h30-2-8" class="d">-            Column(
</a><a href="#h30-2-9" id="h30-2-9" class="i">+            Field(
</a>                 1,
<a href="#h30-2-11" id="h30-2-11" class="i">+                None,
</a>             ),
<a href="#h30-2-13" id="h30-2-13" class="d">-            Column(
</a><a href="#h30-2-14" id="h30-2-14" class="i">+            Field(
</a>                 2,
<a href="#h30-2-16" id="h30-2-16" class="i">+                None,
</a>             ),
<a href="#h30-2-18" id="h30-2-18" class="d">-            Column(
</a><a href="#h30-2-19" id="h30-2-19" class="i">+            Field(
</a>                 3,
<a href="#h30-2-21" id="h30-2-21" class="i">+                None,
</a>             ),
<a href="#h30-2-23" id="h30-2-23" class="d">-            Column(
</a><a href="#h30-2-24" id="h30-2-24" class="i">+            Field(
</a>                 4,
<a href="#h30-2-26" id="h30-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h30-3" id="h30-3" class="h">@@ -180,13 +215,18 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;booleans&quot;,
<a href="#h30-3-3" id="h30-3-3" class="d">-                    alias: None,
</a><a href="#h30-3-4" id="h30-3-4" class="i">+                    label: &quot;booleans&quot;,
</a>                     filter: Some(
                         Not(
                             IsNull(
                                 Field(
<a href="#h30-3-9" id="h30-3-9" class="d">-                                    None,
</a><a href="#h30-3-10" id="h30-3-10" class="d">-                                    &quot;b&quot;,
</a><a href="#h30-3-11" id="h30-3-11" class="i">+                                    1,
</a><a href="#h30-3-12" id="h30-3-12" class="i">+                                    Some(
</a><a href="#h30-3-13" id="h30-3-13" class="i">+                                        (
</a><a href="#h30-3-14" id="h30-3-14" class="i">+                                            None,
</a><a href="#h30-3-15" id="h30-3-15" class="i">+                                            &quot;b&quot;,
</a><a href="#h30-3-16" id="h30-3-16" class="i">+                                        ),
</a><a href="#h30-3-17" id="h30-3-17" class="i">+                                    ),
</a>                                 ),
                             ),
                         ),
<a href="#h30-4" id="h30-4" class="h">@@ -201,24 +241,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h30-4-3" id="h30-4-3" class="d">-                        None,
</a><a href="#h30-4-4" id="h30-4-4" class="d">-                        &quot;b&quot;,
</a><a href="#h30-4-5" id="h30-4-5" class="i">+                        1,
</a><a href="#h30-4-6" id="h30-4-6" class="i">+                        Some(
</a><a href="#h30-4-7" id="h30-4-7" class="i">+                            (
</a><a href="#h30-4-8" id="h30-4-8" class="i">+                                None,
</a><a href="#h30-4-9" id="h30-4-9" class="i">+                                &quot;b&quot;,
</a><a href="#h30-4-10" id="h30-4-10" class="i">+                            ),
</a><a href="#h30-4-11" id="h30-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-4-14" id="h30-4-14" class="d">-                        None,
</a><a href="#h30-4-15" id="h30-4-15" class="d">-                        &quot;b&quot;,
</a><a href="#h30-4-16" id="h30-4-16" class="i">+                        1,
</a><a href="#h30-4-17" id="h30-4-17" class="i">+                        Some(
</a><a href="#h30-4-18" id="h30-4-18" class="i">+                            (
</a><a href="#h30-4-19" id="h30-4-19" class="i">+                                None,
</a><a href="#h30-4-20" id="h30-4-20" class="i">+                                &quot;b&quot;,
</a><a href="#h30-4-21" id="h30-4-21" class="i">+                            ),
</a><a href="#h30-4-22" id="h30-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-4-25" id="h30-4-25" class="d">-                        None,
</a><a href="#h30-4-26" id="h30-4-26" class="d">-                        &quot;b&quot;,
</a><a href="#h30-4-27" id="h30-4-27" class="i">+                        1,
</a><a href="#h30-4-28" id="h30-4-28" class="i">+                        Some(
</a><a href="#h30-4-29" id="h30-4-29" class="i">+                            (
</a><a href="#h30-4-30" id="h30-4-30" class="i">+                                None,
</a><a href="#h30-4-31" id="h30-4-31" class="i">+                                &quot;b&quot;,
</a><a href="#h30-4-32" id="h30-4-32" class="i">+                            ),
</a><a href="#h30-4-33" id="h30-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-4-36" id="h30-4-36" class="d">-                        None,
</a><a href="#h30-4-37" id="h30-4-37" class="d">-                        &quot;b&quot;,
</a><a href="#h30-4-38" id="h30-4-38" class="i">+                        1,
</a><a href="#h30-4-39" id="h30-4-39" class="i">+                        Some(
</a><a href="#h30-4-40" id="h30-4-40" class="i">+                            (
</a><a href="#h30-4-41" id="h30-4-41" class="i">+                                None,
</a><a href="#h30-4-42" id="h30-4-42" class="i">+                                &quot;b&quot;,
</a><a href="#h30-4-43" id="h30-4-43" class="i">+                            ),
</a><a href="#h30-4-44" id="h30-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h30-4-47" id="h30-4-47" class="d">-                        None,
</a><a href="#h30-4-48" id="h30-4-48" class="d">-                        &quot;b&quot;,
</a><a href="#h30-4-49" id="h30-4-49" class="i">+                        1,
</a><a href="#h30-4-50" id="h30-4-50" class="i">+                        Some(
</a><a href="#h30-4-51" id="h30-4-51" class="i">+                            (
</a><a href="#h30-4-52" id="h30-4-52" class="i">+                                None,
</a><a href="#h30-4-53" id="h30-4-53" class="i">+                                &quot;b&quot;,
</a><a href="#h30-4-54" id="h30-4-54" class="i">+                            ),
</a><a href="#h30-4-55" id="h30-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h30-5" id="h30-5" class="h">@@ -238,20 +303,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h30-5-3" id="h30-5-3" class="d">-            Column(
</a><a href="#h30-5-4" id="h30-5-4" class="i">+            Field(
</a>                 0,
<a href="#h30-5-6" id="h30-5-6" class="i">+                None,
</a>             ),
<a href="#h30-5-8" id="h30-5-8" class="d">-            Column(
</a><a href="#h30-5-9" id="h30-5-9" class="i">+            Field(
</a>                 1,
<a href="#h30-5-11" id="h30-5-11" class="i">+                None,
</a>             ),
<a href="#h30-5-13" id="h30-5-13" class="d">-            Column(
</a><a href="#h30-5-14" id="h30-5-14" class="i">+            Field(
</a>                 2,
<a href="#h30-5-16" id="h30-5-16" class="i">+                None,
</a>             ),
<a href="#h30-5-18" id="h30-5-18" class="d">-            Column(
</a><a href="#h30-5-19" id="h30-5-19" class="i">+            Field(
</a>                 3,
<a href="#h30-5-21" id="h30-5-21" class="i">+                None,
</a>             ),
<a href="#h30-5-23" id="h30-5-23" class="d">-            Column(
</a><a href="#h30-5-24" id="h30-5-24" class="i">+            Field(
</a>                 4,
<a href="#h30-5-26" id="h30-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h31" href="../file/tests/sql/query/agg_boolean_null.html">tests/sql/query/agg_boolean_null</a> b/<a href="../file/tests/sql/query/agg_boolean_null.html">tests/sql/query/agg_boolean_null</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -81,7 +81,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;booleans&quot;,
<a href="#h31-0-3" id="h31-0-3" class="d">-                    alias: None,
</a><a href="#h31-0-4" id="h31-0-4" class="i">+                    label: &quot;booleans&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h31-1" id="h31-1" class="h">@@ -93,24 +93,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h31-1-3" id="h31-1-3" class="d">-                        None,
</a><a href="#h31-1-4" id="h31-1-4" class="d">-                        &quot;b&quot;,
</a><a href="#h31-1-5" id="h31-1-5" class="i">+                        1,
</a><a href="#h31-1-6" id="h31-1-6" class="i">+                        Some(
</a><a href="#h31-1-7" id="h31-1-7" class="i">+                            (
</a><a href="#h31-1-8" id="h31-1-8" class="i">+                                None,
</a><a href="#h31-1-9" id="h31-1-9" class="i">+                                &quot;b&quot;,
</a><a href="#h31-1-10" id="h31-1-10" class="i">+                            ),
</a><a href="#h31-1-11" id="h31-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-1-14" id="h31-1-14" class="d">-                        None,
</a><a href="#h31-1-15" id="h31-1-15" class="d">-                        &quot;b&quot;,
</a><a href="#h31-1-16" id="h31-1-16" class="i">+                        1,
</a><a href="#h31-1-17" id="h31-1-17" class="i">+                        Some(
</a><a href="#h31-1-18" id="h31-1-18" class="i">+                            (
</a><a href="#h31-1-19" id="h31-1-19" class="i">+                                None,
</a><a href="#h31-1-20" id="h31-1-20" class="i">+                                &quot;b&quot;,
</a><a href="#h31-1-21" id="h31-1-21" class="i">+                            ),
</a><a href="#h31-1-22" id="h31-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-1-25" id="h31-1-25" class="d">-                        None,
</a><a href="#h31-1-26" id="h31-1-26" class="d">-                        &quot;b&quot;,
</a><a href="#h31-1-27" id="h31-1-27" class="i">+                        1,
</a><a href="#h31-1-28" id="h31-1-28" class="i">+                        Some(
</a><a href="#h31-1-29" id="h31-1-29" class="i">+                            (
</a><a href="#h31-1-30" id="h31-1-30" class="i">+                                None,
</a><a href="#h31-1-31" id="h31-1-31" class="i">+                                &quot;b&quot;,
</a><a href="#h31-1-32" id="h31-1-32" class="i">+                            ),
</a><a href="#h31-1-33" id="h31-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-1-36" id="h31-1-36" class="d">-                        None,
</a><a href="#h31-1-37" id="h31-1-37" class="d">-                        &quot;b&quot;,
</a><a href="#h31-1-38" id="h31-1-38" class="i">+                        1,
</a><a href="#h31-1-39" id="h31-1-39" class="i">+                        Some(
</a><a href="#h31-1-40" id="h31-1-40" class="i">+                            (
</a><a href="#h31-1-41" id="h31-1-41" class="i">+                                None,
</a><a href="#h31-1-42" id="h31-1-42" class="i">+                                &quot;b&quot;,
</a><a href="#h31-1-43" id="h31-1-43" class="i">+                            ),
</a><a href="#h31-1-44" id="h31-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-1-47" id="h31-1-47" class="d">-                        None,
</a><a href="#h31-1-48" id="h31-1-48" class="d">-                        &quot;b&quot;,
</a><a href="#h31-1-49" id="h31-1-49" class="i">+                        1,
</a><a href="#h31-1-50" id="h31-1-50" class="i">+                        Some(
</a><a href="#h31-1-51" id="h31-1-51" class="i">+                            (
</a><a href="#h31-1-52" id="h31-1-52" class="i">+                                None,
</a><a href="#h31-1-53" id="h31-1-53" class="i">+                                &quot;b&quot;,
</a><a href="#h31-1-54" id="h31-1-54" class="i">+                            ),
</a><a href="#h31-1-55" id="h31-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h31-2" id="h31-2" class="h">@@ -130,20 +155,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h31-2-3" id="h31-2-3" class="d">-            Column(
</a><a href="#h31-2-4" id="h31-2-4" class="i">+            Field(
</a>                 0,
<a href="#h31-2-6" id="h31-2-6" class="i">+                None,
</a>             ),
<a href="#h31-2-8" id="h31-2-8" class="d">-            Column(
</a><a href="#h31-2-9" id="h31-2-9" class="i">+            Field(
</a>                 1,
<a href="#h31-2-11" id="h31-2-11" class="i">+                None,
</a>             ),
<a href="#h31-2-13" id="h31-2-13" class="d">-            Column(
</a><a href="#h31-2-14" id="h31-2-14" class="i">+            Field(
</a>                 2,
<a href="#h31-2-16" id="h31-2-16" class="i">+                None,
</a>             ),
<a href="#h31-2-18" id="h31-2-18" class="d">-            Column(
</a><a href="#h31-2-19" id="h31-2-19" class="i">+            Field(
</a>                 3,
<a href="#h31-2-21" id="h31-2-21" class="i">+                None,
</a>             ),
<a href="#h31-2-23" id="h31-2-23" class="d">-            Column(
</a><a href="#h31-2-24" id="h31-2-24" class="i">+            Field(
</a>                 4,
<a href="#h31-2-26" id="h31-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h31-3" id="h31-3" class="h">@@ -155,7 +185,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;booleans&quot;,
<a href="#h31-3-3" id="h31-3-3" class="d">-                    alias: None,
</a><a href="#h31-3-4" id="h31-3-4" class="i">+                    label: &quot;booleans&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h31-4" id="h31-4" class="h">@@ -167,24 +197,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h31-4-3" id="h31-4-3" class="d">-                        None,
</a><a href="#h31-4-4" id="h31-4-4" class="d">-                        &quot;b&quot;,
</a><a href="#h31-4-5" id="h31-4-5" class="i">+                        1,
</a><a href="#h31-4-6" id="h31-4-6" class="i">+                        Some(
</a><a href="#h31-4-7" id="h31-4-7" class="i">+                            (
</a><a href="#h31-4-8" id="h31-4-8" class="i">+                                None,
</a><a href="#h31-4-9" id="h31-4-9" class="i">+                                &quot;b&quot;,
</a><a href="#h31-4-10" id="h31-4-10" class="i">+                            ),
</a><a href="#h31-4-11" id="h31-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-4-14" id="h31-4-14" class="d">-                        None,
</a><a href="#h31-4-15" id="h31-4-15" class="d">-                        &quot;b&quot;,
</a><a href="#h31-4-16" id="h31-4-16" class="i">+                        1,
</a><a href="#h31-4-17" id="h31-4-17" class="i">+                        Some(
</a><a href="#h31-4-18" id="h31-4-18" class="i">+                            (
</a><a href="#h31-4-19" id="h31-4-19" class="i">+                                None,
</a><a href="#h31-4-20" id="h31-4-20" class="i">+                                &quot;b&quot;,
</a><a href="#h31-4-21" id="h31-4-21" class="i">+                            ),
</a><a href="#h31-4-22" id="h31-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-4-25" id="h31-4-25" class="d">-                        None,
</a><a href="#h31-4-26" id="h31-4-26" class="d">-                        &quot;b&quot;,
</a><a href="#h31-4-27" id="h31-4-27" class="i">+                        1,
</a><a href="#h31-4-28" id="h31-4-28" class="i">+                        Some(
</a><a href="#h31-4-29" id="h31-4-29" class="i">+                            (
</a><a href="#h31-4-30" id="h31-4-30" class="i">+                                None,
</a><a href="#h31-4-31" id="h31-4-31" class="i">+                                &quot;b&quot;,
</a><a href="#h31-4-32" id="h31-4-32" class="i">+                            ),
</a><a href="#h31-4-33" id="h31-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-4-36" id="h31-4-36" class="d">-                        None,
</a><a href="#h31-4-37" id="h31-4-37" class="d">-                        &quot;b&quot;,
</a><a href="#h31-4-38" id="h31-4-38" class="i">+                        1,
</a><a href="#h31-4-39" id="h31-4-39" class="i">+                        Some(
</a><a href="#h31-4-40" id="h31-4-40" class="i">+                            (
</a><a href="#h31-4-41" id="h31-4-41" class="i">+                                None,
</a><a href="#h31-4-42" id="h31-4-42" class="i">+                                &quot;b&quot;,
</a><a href="#h31-4-43" id="h31-4-43" class="i">+                            ),
</a><a href="#h31-4-44" id="h31-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h31-4-47" id="h31-4-47" class="d">-                        None,
</a><a href="#h31-4-48" id="h31-4-48" class="d">-                        &quot;b&quot;,
</a><a href="#h31-4-49" id="h31-4-49" class="i">+                        1,
</a><a href="#h31-4-50" id="h31-4-50" class="i">+                        Some(
</a><a href="#h31-4-51" id="h31-4-51" class="i">+                            (
</a><a href="#h31-4-52" id="h31-4-52" class="i">+                                None,
</a><a href="#h31-4-53" id="h31-4-53" class="i">+                                &quot;b&quot;,
</a><a href="#h31-4-54" id="h31-4-54" class="i">+                            ),
</a><a href="#h31-4-55" id="h31-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h31-5" id="h31-5" class="h">@@ -204,20 +259,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h31-5-3" id="h31-5-3" class="d">-            Column(
</a><a href="#h31-5-4" id="h31-5-4" class="i">+            Field(
</a>                 0,
<a href="#h31-5-6" id="h31-5-6" class="i">+                None,
</a>             ),
<a href="#h31-5-8" id="h31-5-8" class="d">-            Column(
</a><a href="#h31-5-9" id="h31-5-9" class="i">+            Field(
</a>                 1,
<a href="#h31-5-11" id="h31-5-11" class="i">+                None,
</a>             ),
<a href="#h31-5-13" id="h31-5-13" class="d">-            Column(
</a><a href="#h31-5-14" id="h31-5-14" class="i">+            Field(
</a>                 2,
<a href="#h31-5-16" id="h31-5-16" class="i">+                None,
</a>             ),
<a href="#h31-5-18" id="h31-5-18" class="d">-            Column(
</a><a href="#h31-5-19" id="h31-5-19" class="i">+            Field(
</a>                 3,
<a href="#h31-5-21" id="h31-5-21" class="i">+                None,
</a>             ),
<a href="#h31-5-23" id="h31-5-23" class="d">-            Column(
</a><a href="#h31-5-24" id="h31-5-24" class="i">+            Field(
</a>                 4,
<a href="#h31-5-26" id="h31-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h32" href="../file/tests/sql/query/agg_const.html">tests/sql/query/agg_const</a> b/<a href="../file/tests/sql/query/agg_const.html">tests/sql/query/agg_const</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -127,20 +127,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h32-0-3" id="h32-0-3" class="d">-            Column(
</a><a href="#h32-0-4" id="h32-0-4" class="i">+            Field(
</a>                 0,
<a href="#h32-0-6" id="h32-0-6" class="i">+                None,
</a>             ),
<a href="#h32-0-8" id="h32-0-8" class="d">-            Column(
</a><a href="#h32-0-9" id="h32-0-9" class="i">+            Field(
</a>                 1,
<a href="#h32-0-11" id="h32-0-11" class="i">+                None,
</a>             ),
<a href="#h32-0-13" id="h32-0-13" class="d">-            Column(
</a><a href="#h32-0-14" id="h32-0-14" class="i">+            Field(
</a>                 2,
<a href="#h32-0-16" id="h32-0-16" class="i">+                None,
</a>             ),
<a href="#h32-0-18" id="h32-0-18" class="d">-            Column(
</a><a href="#h32-0-19" id="h32-0-19" class="i">+            Field(
</a>                 3,
<a href="#h32-0-21" id="h32-0-21" class="i">+                None,
</a>             ),
<a href="#h32-0-23" id="h32-0-23" class="d">-            Column(
</a><a href="#h32-0-24" id="h32-0-24" class="i">+            Field(
</a>                 4,
<a href="#h32-0-26" id="h32-0-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h32-1" id="h32-1" class="h">@@ -202,20 +207,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h32-1-3" id="h32-1-3" class="d">-            Column(
</a><a href="#h32-1-4" id="h32-1-4" class="i">+            Field(
</a>                 0,
<a href="#h32-1-6" id="h32-1-6" class="i">+                None,
</a>             ),
<a href="#h32-1-8" id="h32-1-8" class="d">-            Column(
</a><a href="#h32-1-9" id="h32-1-9" class="i">+            Field(
</a>                 1,
<a href="#h32-1-11" id="h32-1-11" class="i">+                None,
</a>             ),
<a href="#h32-1-13" id="h32-1-13" class="d">-            Column(
</a><a href="#h32-1-14" id="h32-1-14" class="i">+            Field(
</a>                 2,
<a href="#h32-1-16" id="h32-1-16" class="i">+                None,
</a>             ),
<a href="#h32-1-18" id="h32-1-18" class="d">-            Column(
</a><a href="#h32-1-19" id="h32-1-19" class="i">+            Field(
</a>                 3,
<a href="#h32-1-21" id="h32-1-21" class="i">+                None,
</a>             ),
<a href="#h32-1-23" id="h32-1-23" class="d">-            Column(
</a><a href="#h32-1-24" id="h32-1-24" class="i">+            Field(
</a>                 4,
<a href="#h32-1-26" id="h32-1-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h33" href="../file/tests/sql/query/agg_const_from.html">tests/sql/query/agg_const_from</a> b/<a href="../file/tests/sql/query/agg_const_from.html">tests/sql/query/agg_const_from</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -86,7 +86,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;genres&quot;,
<a href="#h33-0-3" id="h33-0-3" class="d">-                    alias: None,
</a><a href="#h33-0-4" id="h33-0-4" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h33-1" id="h33-1" class="h">@@ -140,20 +140,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h33-1-3" id="h33-1-3" class="d">-            Column(
</a><a href="#h33-1-4" id="h33-1-4" class="i">+            Field(
</a>                 0,
<a href="#h33-1-6" id="h33-1-6" class="i">+                None,
</a>             ),
<a href="#h33-1-8" id="h33-1-8" class="d">-            Column(
</a><a href="#h33-1-9" id="h33-1-9" class="i">+            Field(
</a>                 1,
<a href="#h33-1-11" id="h33-1-11" class="i">+                None,
</a>             ),
<a href="#h33-1-13" id="h33-1-13" class="d">-            Column(
</a><a href="#h33-1-14" id="h33-1-14" class="i">+            Field(
</a>                 2,
<a href="#h33-1-16" id="h33-1-16" class="i">+                None,
</a>             ),
<a href="#h33-1-18" id="h33-1-18" class="d">-            Column(
</a><a href="#h33-1-19" id="h33-1-19" class="i">+            Field(
</a>                 3,
<a href="#h33-1-21" id="h33-1-21" class="i">+                None,
</a>             ),
<a href="#h33-1-23" id="h33-1-23" class="d">-            Column(
</a><a href="#h33-1-24" id="h33-1-24" class="i">+            Field(
</a>                 4,
<a href="#h33-1-26" id="h33-1-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h33-2" id="h33-2" class="h">@@ -165,7 +170,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;genres&quot;,
<a href="#h33-2-3" id="h33-2-3" class="d">-                    alias: None,
</a><a href="#h33-2-4" id="h33-2-4" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h33-3" id="h33-3" class="h">@@ -219,20 +224,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h33-3-3" id="h33-3-3" class="d">-            Column(
</a><a href="#h33-3-4" id="h33-3-4" class="i">+            Field(
</a>                 0,
<a href="#h33-3-6" id="h33-3-6" class="i">+                None,
</a>             ),
<a href="#h33-3-8" id="h33-3-8" class="d">-            Column(
</a><a href="#h33-3-9" id="h33-3-9" class="i">+            Field(
</a>                 1,
<a href="#h33-3-11" id="h33-3-11" class="i">+                None,
</a>             ),
<a href="#h33-3-13" id="h33-3-13" class="d">-            Column(
</a><a href="#h33-3-14" id="h33-3-14" class="i">+            Field(
</a>                 2,
<a href="#h33-3-16" id="h33-3-16" class="i">+                None,
</a>             ),
<a href="#h33-3-18" id="h33-3-18" class="d">-            Column(
</a><a href="#h33-3-19" id="h33-3-19" class="i">+            Field(
</a>                 3,
<a href="#h33-3-21" id="h33-3-21" class="i">+                None,
</a>             ),
<a href="#h33-3-23" id="h33-3-23" class="d">-            Column(
</a><a href="#h33-3-24" id="h33-3-24" class="i">+            Field(
</a>                 4,
<a href="#h33-3-26" id="h33-3-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h34" href="../file/tests/sql/query/agg_count_star.html">tests/sql/query/agg_count_star</a> b/<a href="../file/tests/sql/query/agg_count_star.html">tests/sql/query/agg_count_star</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -42,7 +42,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h34-0-3" id="h34-0-3" class="d">-                    alias: None,
</a><a href="#h34-0-4" id="h34-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h34-1" id="h34-1" class="h">@@ -64,8 +64,9 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h34-1-3" id="h34-1-3" class="d">-            Column(
</a><a href="#h34-1-4" id="h34-1-4" class="i">+            Field(
</a>                 0,
<a href="#h34-1-6" id="h34-1-6" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h34-2" id="h34-2" class="h">@@ -77,7 +78,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h34-2-3" id="h34-2-3" class="d">-                    alias: None,
</a><a href="#h34-2-4" id="h34-2-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h34-3" id="h34-3" class="h">@@ -99,8 +100,9 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h34-3-3" id="h34-3-3" class="d">-            Column(
</a><a href="#h34-3-4" id="h34-3-4" class="i">+            Field(
</a>                 0,
<a href="#h34-3-6" id="h34-3-6" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h35" href="../file/tests/sql/query/agg_expr.html">tests/sql/query/agg_expr</a> b/<a href="../file/tests/sql/query/agg_expr.html">tests/sql/query/agg_expr</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -64,7 +64,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h35-0-3" id="h35-0-3" class="d">-                    alias: None,
</a><a href="#h35-0-4" id="h35-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h35-1" id="h35-1" class="h">@@ -74,8 +74,13 @@ Plan: Plan(
</a>                 expressions: [
                     Multiply(
                         Field(
<a href="#h35-1-3" id="h35-1-3" class="d">-                            None,
</a><a href="#h35-1-4" id="h35-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h35-1-5" id="h35-1-5" class="i">+                            5,
</a><a href="#h35-1-6" id="h35-1-6" class="i">+                            Some(
</a><a href="#h35-1-7" id="h35-1-7" class="i">+                                (
</a><a href="#h35-1-8" id="h35-1-8" class="i">+                                    None,
</a><a href="#h35-1-9" id="h35-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h35-1-10" id="h35-1-10" class="i">+                                ),
</a><a href="#h35-1-11" id="h35-1-11" class="i">+                            ),
</a>                         ),
                         Constant(
                             Integer(
<a href="#h35-2" id="h35-2" class="h">@@ -100,11 +105,13 @@ Plan: Plan(
</a>         ],
         expressions: [
             Divide(
<a href="#h35-2-3" id="h35-2-3" class="d">-                Column(
</a><a href="#h35-2-4" id="h35-2-4" class="i">+                Field(
</a>                     0,
<a href="#h35-2-6" id="h35-2-6" class="i">+                    None,
</a>                 ),
<a href="#h35-2-8" id="h35-2-8" class="d">-                Column(
</a><a href="#h35-2-9" id="h35-2-9" class="i">+                Field(
</a>                     1,
<a href="#h35-2-11" id="h35-2-11" class="i">+                    None,
</a>                 ),
             ),
         ],
<a href="#h35-3" id="h35-3" class="h">@@ -117,7 +124,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h35-3-3" id="h35-3-3" class="d">-                    alias: None,
</a><a href="#h35-3-4" id="h35-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h35-4" id="h35-4" class="h">@@ -127,8 +134,13 @@ Optimized plan: Plan(
</a>                 expressions: [
                     Multiply(
                         Field(
<a href="#h35-4-3" id="h35-4-3" class="d">-                            None,
</a><a href="#h35-4-4" id="h35-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h35-4-5" id="h35-4-5" class="i">+                            5,
</a><a href="#h35-4-6" id="h35-4-6" class="i">+                            Some(
</a><a href="#h35-4-7" id="h35-4-7" class="i">+                                (
</a><a href="#h35-4-8" id="h35-4-8" class="i">+                                    None,
</a><a href="#h35-4-9" id="h35-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h35-4-10" id="h35-4-10" class="i">+                                ),
</a><a href="#h35-4-11" id="h35-4-11" class="i">+                            ),
</a>                         ),
                         Constant(
                             Integer(
<a href="#h35-5" id="h35-5" class="h">@@ -153,11 +165,13 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Divide(
<a href="#h35-5-3" id="h35-5-3" class="d">-                Column(
</a><a href="#h35-5-4" id="h35-5-4" class="i">+                Field(
</a>                     0,
<a href="#h35-5-6" id="h35-5-6" class="i">+                    None,
</a>                 ),
<a href="#h35-5-8" id="h35-5-8" class="d">-                Column(
</a><a href="#h35-5-9" id="h35-5-9" class="i">+                Field(
</a>                     1,
<a href="#h35-5-11" id="h35-5-11" class="i">+                    None,
</a>                 ),
             ),
         ],
<b>diff --git a/<a id="h36" href="../file/tests/sql/query/agg_float.html">tests/sql/query/agg_float</a> b/<a href="../file/tests/sql/query/agg_float.html">tests/sql/query/agg_float</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -97,14 +97,19 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;floats&quot;,
<a href="#h36-0-3" id="h36-0-3" class="d">-                        alias: None,
</a><a href="#h36-0-4" id="h36-0-4" class="i">+                        label: &quot;floats&quot;,
</a>                         filter: None,
                     },
                     predicate: Not(
                         IsNull(
                             Field(
<a href="#h36-0-10" id="h36-0-10" class="d">-                                None,
</a><a href="#h36-0-11" id="h36-0-11" class="d">-                                &quot;f&quot;,
</a><a href="#h36-0-12" id="h36-0-12" class="i">+                                1,
</a><a href="#h36-0-13" id="h36-0-13" class="i">+                                Some(
</a><a href="#h36-0-14" id="h36-0-14" class="i">+                                    (
</a><a href="#h36-0-15" id="h36-0-15" class="i">+                                        None,
</a><a href="#h36-0-16" id="h36-0-16" class="i">+                                        &quot;f&quot;,
</a><a href="#h36-0-17" id="h36-0-17" class="i">+                                    ),
</a><a href="#h36-0-18" id="h36-0-18" class="i">+                                ),
</a>                             ),
                         ),
                     ),
<a href="#h36-1" id="h36-1" class="h">@@ -118,24 +123,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h36-1-3" id="h36-1-3" class="d">-                        None,
</a><a href="#h36-1-4" id="h36-1-4" class="d">-                        &quot;f&quot;,
</a><a href="#h36-1-5" id="h36-1-5" class="i">+                        1,
</a><a href="#h36-1-6" id="h36-1-6" class="i">+                        Some(
</a><a href="#h36-1-7" id="h36-1-7" class="i">+                            (
</a><a href="#h36-1-8" id="h36-1-8" class="i">+                                None,
</a><a href="#h36-1-9" id="h36-1-9" class="i">+                                &quot;f&quot;,
</a><a href="#h36-1-10" id="h36-1-10" class="i">+                            ),
</a><a href="#h36-1-11" id="h36-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-1-14" id="h36-1-14" class="d">-                        None,
</a><a href="#h36-1-15" id="h36-1-15" class="d">-                        &quot;f&quot;,
</a><a href="#h36-1-16" id="h36-1-16" class="i">+                        1,
</a><a href="#h36-1-17" id="h36-1-17" class="i">+                        Some(
</a><a href="#h36-1-18" id="h36-1-18" class="i">+                            (
</a><a href="#h36-1-19" id="h36-1-19" class="i">+                                None,
</a><a href="#h36-1-20" id="h36-1-20" class="i">+                                &quot;f&quot;,
</a><a href="#h36-1-21" id="h36-1-21" class="i">+                            ),
</a><a href="#h36-1-22" id="h36-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-1-25" id="h36-1-25" class="d">-                        None,
</a><a href="#h36-1-26" id="h36-1-26" class="d">-                        &quot;f&quot;,
</a><a href="#h36-1-27" id="h36-1-27" class="i">+                        1,
</a><a href="#h36-1-28" id="h36-1-28" class="i">+                        Some(
</a><a href="#h36-1-29" id="h36-1-29" class="i">+                            (
</a><a href="#h36-1-30" id="h36-1-30" class="i">+                                None,
</a><a href="#h36-1-31" id="h36-1-31" class="i">+                                &quot;f&quot;,
</a><a href="#h36-1-32" id="h36-1-32" class="i">+                            ),
</a><a href="#h36-1-33" id="h36-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-1-36" id="h36-1-36" class="d">-                        None,
</a><a href="#h36-1-37" id="h36-1-37" class="d">-                        &quot;f&quot;,
</a><a href="#h36-1-38" id="h36-1-38" class="i">+                        1,
</a><a href="#h36-1-39" id="h36-1-39" class="i">+                        Some(
</a><a href="#h36-1-40" id="h36-1-40" class="i">+                            (
</a><a href="#h36-1-41" id="h36-1-41" class="i">+                                None,
</a><a href="#h36-1-42" id="h36-1-42" class="i">+                                &quot;f&quot;,
</a><a href="#h36-1-43" id="h36-1-43" class="i">+                            ),
</a><a href="#h36-1-44" id="h36-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-1-47" id="h36-1-47" class="d">-                        None,
</a><a href="#h36-1-48" id="h36-1-48" class="d">-                        &quot;f&quot;,
</a><a href="#h36-1-49" id="h36-1-49" class="i">+                        1,
</a><a href="#h36-1-50" id="h36-1-50" class="i">+                        Some(
</a><a href="#h36-1-51" id="h36-1-51" class="i">+                            (
</a><a href="#h36-1-52" id="h36-1-52" class="i">+                                None,
</a><a href="#h36-1-53" id="h36-1-53" class="i">+                                &quot;f&quot;,
</a><a href="#h36-1-54" id="h36-1-54" class="i">+                            ),
</a><a href="#h36-1-55" id="h36-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h36-2" id="h36-2" class="h">@@ -155,20 +185,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h36-2-3" id="h36-2-3" class="d">-            Column(
</a><a href="#h36-2-4" id="h36-2-4" class="i">+            Field(
</a>                 0,
<a href="#h36-2-6" id="h36-2-6" class="i">+                None,
</a>             ),
<a href="#h36-2-8" id="h36-2-8" class="d">-            Column(
</a><a href="#h36-2-9" id="h36-2-9" class="i">+            Field(
</a>                 1,
<a href="#h36-2-11" id="h36-2-11" class="i">+                None,
</a>             ),
<a href="#h36-2-13" id="h36-2-13" class="d">-            Column(
</a><a href="#h36-2-14" id="h36-2-14" class="i">+            Field(
</a>                 2,
<a href="#h36-2-16" id="h36-2-16" class="i">+                None,
</a>             ),
<a href="#h36-2-18" id="h36-2-18" class="d">-            Column(
</a><a href="#h36-2-19" id="h36-2-19" class="i">+            Field(
</a>                 3,
<a href="#h36-2-21" id="h36-2-21" class="i">+                None,
</a>             ),
<a href="#h36-2-23" id="h36-2-23" class="d">-            Column(
</a><a href="#h36-2-24" id="h36-2-24" class="i">+            Field(
</a>                 4,
<a href="#h36-2-26" id="h36-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h36-3" id="h36-3" class="h">@@ -180,13 +215,18 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;floats&quot;,
<a href="#h36-3-3" id="h36-3-3" class="d">-                    alias: None,
</a><a href="#h36-3-4" id="h36-3-4" class="i">+                    label: &quot;floats&quot;,
</a>                     filter: Some(
                         Not(
                             IsNull(
                                 Field(
<a href="#h36-3-9" id="h36-3-9" class="d">-                                    None,
</a><a href="#h36-3-10" id="h36-3-10" class="d">-                                    &quot;f&quot;,
</a><a href="#h36-3-11" id="h36-3-11" class="i">+                                    1,
</a><a href="#h36-3-12" id="h36-3-12" class="i">+                                    Some(
</a><a href="#h36-3-13" id="h36-3-13" class="i">+                                        (
</a><a href="#h36-3-14" id="h36-3-14" class="i">+                                            None,
</a><a href="#h36-3-15" id="h36-3-15" class="i">+                                            &quot;f&quot;,
</a><a href="#h36-3-16" id="h36-3-16" class="i">+                                        ),
</a><a href="#h36-3-17" id="h36-3-17" class="i">+                                    ),
</a>                                 ),
                             ),
                         ),
<a href="#h36-4" id="h36-4" class="h">@@ -201,24 +241,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h36-4-3" id="h36-4-3" class="d">-                        None,
</a><a href="#h36-4-4" id="h36-4-4" class="d">-                        &quot;f&quot;,
</a><a href="#h36-4-5" id="h36-4-5" class="i">+                        1,
</a><a href="#h36-4-6" id="h36-4-6" class="i">+                        Some(
</a><a href="#h36-4-7" id="h36-4-7" class="i">+                            (
</a><a href="#h36-4-8" id="h36-4-8" class="i">+                                None,
</a><a href="#h36-4-9" id="h36-4-9" class="i">+                                &quot;f&quot;,
</a><a href="#h36-4-10" id="h36-4-10" class="i">+                            ),
</a><a href="#h36-4-11" id="h36-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-4-14" id="h36-4-14" class="d">-                        None,
</a><a href="#h36-4-15" id="h36-4-15" class="d">-                        &quot;f&quot;,
</a><a href="#h36-4-16" id="h36-4-16" class="i">+                        1,
</a><a href="#h36-4-17" id="h36-4-17" class="i">+                        Some(
</a><a href="#h36-4-18" id="h36-4-18" class="i">+                            (
</a><a href="#h36-4-19" id="h36-4-19" class="i">+                                None,
</a><a href="#h36-4-20" id="h36-4-20" class="i">+                                &quot;f&quot;,
</a><a href="#h36-4-21" id="h36-4-21" class="i">+                            ),
</a><a href="#h36-4-22" id="h36-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-4-25" id="h36-4-25" class="d">-                        None,
</a><a href="#h36-4-26" id="h36-4-26" class="d">-                        &quot;f&quot;,
</a><a href="#h36-4-27" id="h36-4-27" class="i">+                        1,
</a><a href="#h36-4-28" id="h36-4-28" class="i">+                        Some(
</a><a href="#h36-4-29" id="h36-4-29" class="i">+                            (
</a><a href="#h36-4-30" id="h36-4-30" class="i">+                                None,
</a><a href="#h36-4-31" id="h36-4-31" class="i">+                                &quot;f&quot;,
</a><a href="#h36-4-32" id="h36-4-32" class="i">+                            ),
</a><a href="#h36-4-33" id="h36-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-4-36" id="h36-4-36" class="d">-                        None,
</a><a href="#h36-4-37" id="h36-4-37" class="d">-                        &quot;f&quot;,
</a><a href="#h36-4-38" id="h36-4-38" class="i">+                        1,
</a><a href="#h36-4-39" id="h36-4-39" class="i">+                        Some(
</a><a href="#h36-4-40" id="h36-4-40" class="i">+                            (
</a><a href="#h36-4-41" id="h36-4-41" class="i">+                                None,
</a><a href="#h36-4-42" id="h36-4-42" class="i">+                                &quot;f&quot;,
</a><a href="#h36-4-43" id="h36-4-43" class="i">+                            ),
</a><a href="#h36-4-44" id="h36-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h36-4-47" id="h36-4-47" class="d">-                        None,
</a><a href="#h36-4-48" id="h36-4-48" class="d">-                        &quot;f&quot;,
</a><a href="#h36-4-49" id="h36-4-49" class="i">+                        1,
</a><a href="#h36-4-50" id="h36-4-50" class="i">+                        Some(
</a><a href="#h36-4-51" id="h36-4-51" class="i">+                            (
</a><a href="#h36-4-52" id="h36-4-52" class="i">+                                None,
</a><a href="#h36-4-53" id="h36-4-53" class="i">+                                &quot;f&quot;,
</a><a href="#h36-4-54" id="h36-4-54" class="i">+                            ),
</a><a href="#h36-4-55" id="h36-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h36-5" id="h36-5" class="h">@@ -238,20 +303,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h36-5-3" id="h36-5-3" class="d">-            Column(
</a><a href="#h36-5-4" id="h36-5-4" class="i">+            Field(
</a>                 0,
<a href="#h36-5-6" id="h36-5-6" class="i">+                None,
</a>             ),
<a href="#h36-5-8" id="h36-5-8" class="d">-            Column(
</a><a href="#h36-5-9" id="h36-5-9" class="i">+            Field(
</a>                 1,
<a href="#h36-5-11" id="h36-5-11" class="i">+                None,
</a>             ),
<a href="#h36-5-13" id="h36-5-13" class="d">-            Column(
</a><a href="#h36-5-14" id="h36-5-14" class="i">+            Field(
</a>                 2,
<a href="#h36-5-16" id="h36-5-16" class="i">+                None,
</a>             ),
<a href="#h36-5-18" id="h36-5-18" class="d">-            Column(
</a><a href="#h36-5-19" id="h36-5-19" class="i">+            Field(
</a>                 3,
<a href="#h36-5-21" id="h36-5-21" class="i">+                None,
</a>             ),
<a href="#h36-5-23" id="h36-5-23" class="d">-            Column(
</a><a href="#h36-5-24" id="h36-5-24" class="i">+            Field(
</a>                 4,
<a href="#h36-5-26" id="h36-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h37" href="../file/tests/sql/query/agg_float_null.html">tests/sql/query/agg_float_null</a> b/<a href="../file/tests/sql/query/agg_float_null.html">tests/sql/query/agg_float_null</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -81,7 +81,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;floats&quot;,
<a href="#h37-0-3" id="h37-0-3" class="d">-                    alias: None,
</a><a href="#h37-0-4" id="h37-0-4" class="i">+                    label: &quot;floats&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h37-1" id="h37-1" class="h">@@ -93,24 +93,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h37-1-3" id="h37-1-3" class="d">-                        None,
</a><a href="#h37-1-4" id="h37-1-4" class="d">-                        &quot;f&quot;,
</a><a href="#h37-1-5" id="h37-1-5" class="i">+                        1,
</a><a href="#h37-1-6" id="h37-1-6" class="i">+                        Some(
</a><a href="#h37-1-7" id="h37-1-7" class="i">+                            (
</a><a href="#h37-1-8" id="h37-1-8" class="i">+                                None,
</a><a href="#h37-1-9" id="h37-1-9" class="i">+                                &quot;f&quot;,
</a><a href="#h37-1-10" id="h37-1-10" class="i">+                            ),
</a><a href="#h37-1-11" id="h37-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-1-14" id="h37-1-14" class="d">-                        None,
</a><a href="#h37-1-15" id="h37-1-15" class="d">-                        &quot;f&quot;,
</a><a href="#h37-1-16" id="h37-1-16" class="i">+                        1,
</a><a href="#h37-1-17" id="h37-1-17" class="i">+                        Some(
</a><a href="#h37-1-18" id="h37-1-18" class="i">+                            (
</a><a href="#h37-1-19" id="h37-1-19" class="i">+                                None,
</a><a href="#h37-1-20" id="h37-1-20" class="i">+                                &quot;f&quot;,
</a><a href="#h37-1-21" id="h37-1-21" class="i">+                            ),
</a><a href="#h37-1-22" id="h37-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-1-25" id="h37-1-25" class="d">-                        None,
</a><a href="#h37-1-26" id="h37-1-26" class="d">-                        &quot;f&quot;,
</a><a href="#h37-1-27" id="h37-1-27" class="i">+                        1,
</a><a href="#h37-1-28" id="h37-1-28" class="i">+                        Some(
</a><a href="#h37-1-29" id="h37-1-29" class="i">+                            (
</a><a href="#h37-1-30" id="h37-1-30" class="i">+                                None,
</a><a href="#h37-1-31" id="h37-1-31" class="i">+                                &quot;f&quot;,
</a><a href="#h37-1-32" id="h37-1-32" class="i">+                            ),
</a><a href="#h37-1-33" id="h37-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-1-36" id="h37-1-36" class="d">-                        None,
</a><a href="#h37-1-37" id="h37-1-37" class="d">-                        &quot;f&quot;,
</a><a href="#h37-1-38" id="h37-1-38" class="i">+                        1,
</a><a href="#h37-1-39" id="h37-1-39" class="i">+                        Some(
</a><a href="#h37-1-40" id="h37-1-40" class="i">+                            (
</a><a href="#h37-1-41" id="h37-1-41" class="i">+                                None,
</a><a href="#h37-1-42" id="h37-1-42" class="i">+                                &quot;f&quot;,
</a><a href="#h37-1-43" id="h37-1-43" class="i">+                            ),
</a><a href="#h37-1-44" id="h37-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-1-47" id="h37-1-47" class="d">-                        None,
</a><a href="#h37-1-48" id="h37-1-48" class="d">-                        &quot;f&quot;,
</a><a href="#h37-1-49" id="h37-1-49" class="i">+                        1,
</a><a href="#h37-1-50" id="h37-1-50" class="i">+                        Some(
</a><a href="#h37-1-51" id="h37-1-51" class="i">+                            (
</a><a href="#h37-1-52" id="h37-1-52" class="i">+                                None,
</a><a href="#h37-1-53" id="h37-1-53" class="i">+                                &quot;f&quot;,
</a><a href="#h37-1-54" id="h37-1-54" class="i">+                            ),
</a><a href="#h37-1-55" id="h37-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h37-2" id="h37-2" class="h">@@ -130,20 +155,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h37-2-3" id="h37-2-3" class="d">-            Column(
</a><a href="#h37-2-4" id="h37-2-4" class="i">+            Field(
</a>                 0,
<a href="#h37-2-6" id="h37-2-6" class="i">+                None,
</a>             ),
<a href="#h37-2-8" id="h37-2-8" class="d">-            Column(
</a><a href="#h37-2-9" id="h37-2-9" class="i">+            Field(
</a>                 1,
<a href="#h37-2-11" id="h37-2-11" class="i">+                None,
</a>             ),
<a href="#h37-2-13" id="h37-2-13" class="d">-            Column(
</a><a href="#h37-2-14" id="h37-2-14" class="i">+            Field(
</a>                 2,
<a href="#h37-2-16" id="h37-2-16" class="i">+                None,
</a>             ),
<a href="#h37-2-18" id="h37-2-18" class="d">-            Column(
</a><a href="#h37-2-19" id="h37-2-19" class="i">+            Field(
</a>                 3,
<a href="#h37-2-21" id="h37-2-21" class="i">+                None,
</a>             ),
<a href="#h37-2-23" id="h37-2-23" class="d">-            Column(
</a><a href="#h37-2-24" id="h37-2-24" class="i">+            Field(
</a>                 4,
<a href="#h37-2-26" id="h37-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h37-3" id="h37-3" class="h">@@ -155,7 +185,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;floats&quot;,
<a href="#h37-3-3" id="h37-3-3" class="d">-                    alias: None,
</a><a href="#h37-3-4" id="h37-3-4" class="i">+                    label: &quot;floats&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h37-4" id="h37-4" class="h">@@ -167,24 +197,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h37-4-3" id="h37-4-3" class="d">-                        None,
</a><a href="#h37-4-4" id="h37-4-4" class="d">-                        &quot;f&quot;,
</a><a href="#h37-4-5" id="h37-4-5" class="i">+                        1,
</a><a href="#h37-4-6" id="h37-4-6" class="i">+                        Some(
</a><a href="#h37-4-7" id="h37-4-7" class="i">+                            (
</a><a href="#h37-4-8" id="h37-4-8" class="i">+                                None,
</a><a href="#h37-4-9" id="h37-4-9" class="i">+                                &quot;f&quot;,
</a><a href="#h37-4-10" id="h37-4-10" class="i">+                            ),
</a><a href="#h37-4-11" id="h37-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-4-14" id="h37-4-14" class="d">-                        None,
</a><a href="#h37-4-15" id="h37-4-15" class="d">-                        &quot;f&quot;,
</a><a href="#h37-4-16" id="h37-4-16" class="i">+                        1,
</a><a href="#h37-4-17" id="h37-4-17" class="i">+                        Some(
</a><a href="#h37-4-18" id="h37-4-18" class="i">+                            (
</a><a href="#h37-4-19" id="h37-4-19" class="i">+                                None,
</a><a href="#h37-4-20" id="h37-4-20" class="i">+                                &quot;f&quot;,
</a><a href="#h37-4-21" id="h37-4-21" class="i">+                            ),
</a><a href="#h37-4-22" id="h37-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-4-25" id="h37-4-25" class="d">-                        None,
</a><a href="#h37-4-26" id="h37-4-26" class="d">-                        &quot;f&quot;,
</a><a href="#h37-4-27" id="h37-4-27" class="i">+                        1,
</a><a href="#h37-4-28" id="h37-4-28" class="i">+                        Some(
</a><a href="#h37-4-29" id="h37-4-29" class="i">+                            (
</a><a href="#h37-4-30" id="h37-4-30" class="i">+                                None,
</a><a href="#h37-4-31" id="h37-4-31" class="i">+                                &quot;f&quot;,
</a><a href="#h37-4-32" id="h37-4-32" class="i">+                            ),
</a><a href="#h37-4-33" id="h37-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-4-36" id="h37-4-36" class="d">-                        None,
</a><a href="#h37-4-37" id="h37-4-37" class="d">-                        &quot;f&quot;,
</a><a href="#h37-4-38" id="h37-4-38" class="i">+                        1,
</a><a href="#h37-4-39" id="h37-4-39" class="i">+                        Some(
</a><a href="#h37-4-40" id="h37-4-40" class="i">+                            (
</a><a href="#h37-4-41" id="h37-4-41" class="i">+                                None,
</a><a href="#h37-4-42" id="h37-4-42" class="i">+                                &quot;f&quot;,
</a><a href="#h37-4-43" id="h37-4-43" class="i">+                            ),
</a><a href="#h37-4-44" id="h37-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h37-4-47" id="h37-4-47" class="d">-                        None,
</a><a href="#h37-4-48" id="h37-4-48" class="d">-                        &quot;f&quot;,
</a><a href="#h37-4-49" id="h37-4-49" class="i">+                        1,
</a><a href="#h37-4-50" id="h37-4-50" class="i">+                        Some(
</a><a href="#h37-4-51" id="h37-4-51" class="i">+                            (
</a><a href="#h37-4-52" id="h37-4-52" class="i">+                                None,
</a><a href="#h37-4-53" id="h37-4-53" class="i">+                                &quot;f&quot;,
</a><a href="#h37-4-54" id="h37-4-54" class="i">+                            ),
</a><a href="#h37-4-55" id="h37-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h37-5" id="h37-5" class="h">@@ -204,20 +259,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h37-5-3" id="h37-5-3" class="d">-            Column(
</a><a href="#h37-5-4" id="h37-5-4" class="i">+            Field(
</a>                 0,
<a href="#h37-5-6" id="h37-5-6" class="i">+                None,
</a>             ),
<a href="#h37-5-8" id="h37-5-8" class="d">-            Column(
</a><a href="#h37-5-9" id="h37-5-9" class="i">+            Field(
</a>                 1,
<a href="#h37-5-11" id="h37-5-11" class="i">+                None,
</a>             ),
<a href="#h37-5-13" id="h37-5-13" class="d">-            Column(
</a><a href="#h37-5-14" id="h37-5-14" class="i">+            Field(
</a>                 2,
<a href="#h37-5-16" id="h37-5-16" class="i">+                None,
</a>             ),
<a href="#h37-5-18" id="h37-5-18" class="d">-            Column(
</a><a href="#h37-5-19" id="h37-5-19" class="i">+            Field(
</a>                 3,
<a href="#h37-5-21" id="h37-5-21" class="i">+                None,
</a>             ),
<a href="#h37-5-23" id="h37-5-23" class="d">-            Column(
</a><a href="#h37-5-24" id="h37-5-24" class="i">+            Field(
</a>                 4,
<a href="#h37-5-26" id="h37-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h38" href="../file/tests/sql/query/agg_integer.html">tests/sql/query/agg_integer</a> b/<a href="../file/tests/sql/query/agg_integer.html">tests/sql/query/agg_integer</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -97,14 +97,19 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;integers&quot;,
<a href="#h38-0-3" id="h38-0-3" class="d">-                        alias: None,
</a><a href="#h38-0-4" id="h38-0-4" class="i">+                        label: &quot;integers&quot;,
</a>                         filter: None,
                     },
                     predicate: Not(
                         IsNull(
                             Field(
<a href="#h38-0-10" id="h38-0-10" class="d">-                                None,
</a><a href="#h38-0-11" id="h38-0-11" class="d">-                                &quot;i&quot;,
</a><a href="#h38-0-12" id="h38-0-12" class="i">+                                1,
</a><a href="#h38-0-13" id="h38-0-13" class="i">+                                Some(
</a><a href="#h38-0-14" id="h38-0-14" class="i">+                                    (
</a><a href="#h38-0-15" id="h38-0-15" class="i">+                                        None,
</a><a href="#h38-0-16" id="h38-0-16" class="i">+                                        &quot;i&quot;,
</a><a href="#h38-0-17" id="h38-0-17" class="i">+                                    ),
</a><a href="#h38-0-18" id="h38-0-18" class="i">+                                ),
</a>                             ),
                         ),
                     ),
<a href="#h38-1" id="h38-1" class="h">@@ -118,24 +123,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h38-1-3" id="h38-1-3" class="d">-                        None,
</a><a href="#h38-1-4" id="h38-1-4" class="d">-                        &quot;i&quot;,
</a><a href="#h38-1-5" id="h38-1-5" class="i">+                        1,
</a><a href="#h38-1-6" id="h38-1-6" class="i">+                        Some(
</a><a href="#h38-1-7" id="h38-1-7" class="i">+                            (
</a><a href="#h38-1-8" id="h38-1-8" class="i">+                                None,
</a><a href="#h38-1-9" id="h38-1-9" class="i">+                                &quot;i&quot;,
</a><a href="#h38-1-10" id="h38-1-10" class="i">+                            ),
</a><a href="#h38-1-11" id="h38-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-1-14" id="h38-1-14" class="d">-                        None,
</a><a href="#h38-1-15" id="h38-1-15" class="d">-                        &quot;i&quot;,
</a><a href="#h38-1-16" id="h38-1-16" class="i">+                        1,
</a><a href="#h38-1-17" id="h38-1-17" class="i">+                        Some(
</a><a href="#h38-1-18" id="h38-1-18" class="i">+                            (
</a><a href="#h38-1-19" id="h38-1-19" class="i">+                                None,
</a><a href="#h38-1-20" id="h38-1-20" class="i">+                                &quot;i&quot;,
</a><a href="#h38-1-21" id="h38-1-21" class="i">+                            ),
</a><a href="#h38-1-22" id="h38-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-1-25" id="h38-1-25" class="d">-                        None,
</a><a href="#h38-1-26" id="h38-1-26" class="d">-                        &quot;i&quot;,
</a><a href="#h38-1-27" id="h38-1-27" class="i">+                        1,
</a><a href="#h38-1-28" id="h38-1-28" class="i">+                        Some(
</a><a href="#h38-1-29" id="h38-1-29" class="i">+                            (
</a><a href="#h38-1-30" id="h38-1-30" class="i">+                                None,
</a><a href="#h38-1-31" id="h38-1-31" class="i">+                                &quot;i&quot;,
</a><a href="#h38-1-32" id="h38-1-32" class="i">+                            ),
</a><a href="#h38-1-33" id="h38-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-1-36" id="h38-1-36" class="d">-                        None,
</a><a href="#h38-1-37" id="h38-1-37" class="d">-                        &quot;i&quot;,
</a><a href="#h38-1-38" id="h38-1-38" class="i">+                        1,
</a><a href="#h38-1-39" id="h38-1-39" class="i">+                        Some(
</a><a href="#h38-1-40" id="h38-1-40" class="i">+                            (
</a><a href="#h38-1-41" id="h38-1-41" class="i">+                                None,
</a><a href="#h38-1-42" id="h38-1-42" class="i">+                                &quot;i&quot;,
</a><a href="#h38-1-43" id="h38-1-43" class="i">+                            ),
</a><a href="#h38-1-44" id="h38-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-1-47" id="h38-1-47" class="d">-                        None,
</a><a href="#h38-1-48" id="h38-1-48" class="d">-                        &quot;i&quot;,
</a><a href="#h38-1-49" id="h38-1-49" class="i">+                        1,
</a><a href="#h38-1-50" id="h38-1-50" class="i">+                        Some(
</a><a href="#h38-1-51" id="h38-1-51" class="i">+                            (
</a><a href="#h38-1-52" id="h38-1-52" class="i">+                                None,
</a><a href="#h38-1-53" id="h38-1-53" class="i">+                                &quot;i&quot;,
</a><a href="#h38-1-54" id="h38-1-54" class="i">+                            ),
</a><a href="#h38-1-55" id="h38-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h38-2" id="h38-2" class="h">@@ -155,20 +185,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h38-2-3" id="h38-2-3" class="d">-            Column(
</a><a href="#h38-2-4" id="h38-2-4" class="i">+            Field(
</a>                 0,
<a href="#h38-2-6" id="h38-2-6" class="i">+                None,
</a>             ),
<a href="#h38-2-8" id="h38-2-8" class="d">-            Column(
</a><a href="#h38-2-9" id="h38-2-9" class="i">+            Field(
</a>                 1,
<a href="#h38-2-11" id="h38-2-11" class="i">+                None,
</a>             ),
<a href="#h38-2-13" id="h38-2-13" class="d">-            Column(
</a><a href="#h38-2-14" id="h38-2-14" class="i">+            Field(
</a>                 2,
<a href="#h38-2-16" id="h38-2-16" class="i">+                None,
</a>             ),
<a href="#h38-2-18" id="h38-2-18" class="d">-            Column(
</a><a href="#h38-2-19" id="h38-2-19" class="i">+            Field(
</a>                 3,
<a href="#h38-2-21" id="h38-2-21" class="i">+                None,
</a>             ),
<a href="#h38-2-23" id="h38-2-23" class="d">-            Column(
</a><a href="#h38-2-24" id="h38-2-24" class="i">+            Field(
</a>                 4,
<a href="#h38-2-26" id="h38-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h38-3" id="h38-3" class="h">@@ -180,13 +215,18 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;integers&quot;,
<a href="#h38-3-3" id="h38-3-3" class="d">-                    alias: None,
</a><a href="#h38-3-4" id="h38-3-4" class="i">+                    label: &quot;integers&quot;,
</a>                     filter: Some(
                         Not(
                             IsNull(
                                 Field(
<a href="#h38-3-9" id="h38-3-9" class="d">-                                    None,
</a><a href="#h38-3-10" id="h38-3-10" class="d">-                                    &quot;i&quot;,
</a><a href="#h38-3-11" id="h38-3-11" class="i">+                                    1,
</a><a href="#h38-3-12" id="h38-3-12" class="i">+                                    Some(
</a><a href="#h38-3-13" id="h38-3-13" class="i">+                                        (
</a><a href="#h38-3-14" id="h38-3-14" class="i">+                                            None,
</a><a href="#h38-3-15" id="h38-3-15" class="i">+                                            &quot;i&quot;,
</a><a href="#h38-3-16" id="h38-3-16" class="i">+                                        ),
</a><a href="#h38-3-17" id="h38-3-17" class="i">+                                    ),
</a>                                 ),
                             ),
                         ),
<a href="#h38-4" id="h38-4" class="h">@@ -201,24 +241,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h38-4-3" id="h38-4-3" class="d">-                        None,
</a><a href="#h38-4-4" id="h38-4-4" class="d">-                        &quot;i&quot;,
</a><a href="#h38-4-5" id="h38-4-5" class="i">+                        1,
</a><a href="#h38-4-6" id="h38-4-6" class="i">+                        Some(
</a><a href="#h38-4-7" id="h38-4-7" class="i">+                            (
</a><a href="#h38-4-8" id="h38-4-8" class="i">+                                None,
</a><a href="#h38-4-9" id="h38-4-9" class="i">+                                &quot;i&quot;,
</a><a href="#h38-4-10" id="h38-4-10" class="i">+                            ),
</a><a href="#h38-4-11" id="h38-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-4-14" id="h38-4-14" class="d">-                        None,
</a><a href="#h38-4-15" id="h38-4-15" class="d">-                        &quot;i&quot;,
</a><a href="#h38-4-16" id="h38-4-16" class="i">+                        1,
</a><a href="#h38-4-17" id="h38-4-17" class="i">+                        Some(
</a><a href="#h38-4-18" id="h38-4-18" class="i">+                            (
</a><a href="#h38-4-19" id="h38-4-19" class="i">+                                None,
</a><a href="#h38-4-20" id="h38-4-20" class="i">+                                &quot;i&quot;,
</a><a href="#h38-4-21" id="h38-4-21" class="i">+                            ),
</a><a href="#h38-4-22" id="h38-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-4-25" id="h38-4-25" class="d">-                        None,
</a><a href="#h38-4-26" id="h38-4-26" class="d">-                        &quot;i&quot;,
</a><a href="#h38-4-27" id="h38-4-27" class="i">+                        1,
</a><a href="#h38-4-28" id="h38-4-28" class="i">+                        Some(
</a><a href="#h38-4-29" id="h38-4-29" class="i">+                            (
</a><a href="#h38-4-30" id="h38-4-30" class="i">+                                None,
</a><a href="#h38-4-31" id="h38-4-31" class="i">+                                &quot;i&quot;,
</a><a href="#h38-4-32" id="h38-4-32" class="i">+                            ),
</a><a href="#h38-4-33" id="h38-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-4-36" id="h38-4-36" class="d">-                        None,
</a><a href="#h38-4-37" id="h38-4-37" class="d">-                        &quot;i&quot;,
</a><a href="#h38-4-38" id="h38-4-38" class="i">+                        1,
</a><a href="#h38-4-39" id="h38-4-39" class="i">+                        Some(
</a><a href="#h38-4-40" id="h38-4-40" class="i">+                            (
</a><a href="#h38-4-41" id="h38-4-41" class="i">+                                None,
</a><a href="#h38-4-42" id="h38-4-42" class="i">+                                &quot;i&quot;,
</a><a href="#h38-4-43" id="h38-4-43" class="i">+                            ),
</a><a href="#h38-4-44" id="h38-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h38-4-47" id="h38-4-47" class="d">-                        None,
</a><a href="#h38-4-48" id="h38-4-48" class="d">-                        &quot;i&quot;,
</a><a href="#h38-4-49" id="h38-4-49" class="i">+                        1,
</a><a href="#h38-4-50" id="h38-4-50" class="i">+                        Some(
</a><a href="#h38-4-51" id="h38-4-51" class="i">+                            (
</a><a href="#h38-4-52" id="h38-4-52" class="i">+                                None,
</a><a href="#h38-4-53" id="h38-4-53" class="i">+                                &quot;i&quot;,
</a><a href="#h38-4-54" id="h38-4-54" class="i">+                            ),
</a><a href="#h38-4-55" id="h38-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h38-5" id="h38-5" class="h">@@ -238,20 +303,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h38-5-3" id="h38-5-3" class="d">-            Column(
</a><a href="#h38-5-4" id="h38-5-4" class="i">+            Field(
</a>                 0,
<a href="#h38-5-6" id="h38-5-6" class="i">+                None,
</a>             ),
<a href="#h38-5-8" id="h38-5-8" class="d">-            Column(
</a><a href="#h38-5-9" id="h38-5-9" class="i">+            Field(
</a>                 1,
<a href="#h38-5-11" id="h38-5-11" class="i">+                None,
</a>             ),
<a href="#h38-5-13" id="h38-5-13" class="d">-            Column(
</a><a href="#h38-5-14" id="h38-5-14" class="i">+            Field(
</a>                 2,
<a href="#h38-5-16" id="h38-5-16" class="i">+                None,
</a>             ),
<a href="#h38-5-18" id="h38-5-18" class="d">-            Column(
</a><a href="#h38-5-19" id="h38-5-19" class="i">+            Field(
</a>                 3,
<a href="#h38-5-21" id="h38-5-21" class="i">+                None,
</a>             ),
<a href="#h38-5-23" id="h38-5-23" class="d">-            Column(
</a><a href="#h38-5-24" id="h38-5-24" class="i">+            Field(
</a>                 4,
<a href="#h38-5-26" id="h38-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h39" href="../file/tests/sql/query/agg_integer_null.html">tests/sql/query/agg_integer_null</a> b/<a href="../file/tests/sql/query/agg_integer_null.html">tests/sql/query/agg_integer_null</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -81,7 +81,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;integers&quot;,
<a href="#h39-0-3" id="h39-0-3" class="d">-                    alias: None,
</a><a href="#h39-0-4" id="h39-0-4" class="i">+                    label: &quot;integers&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h39-1" id="h39-1" class="h">@@ -93,24 +93,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h39-1-3" id="h39-1-3" class="d">-                        None,
</a><a href="#h39-1-4" id="h39-1-4" class="d">-                        &quot;i&quot;,
</a><a href="#h39-1-5" id="h39-1-5" class="i">+                        1,
</a><a href="#h39-1-6" id="h39-1-6" class="i">+                        Some(
</a><a href="#h39-1-7" id="h39-1-7" class="i">+                            (
</a><a href="#h39-1-8" id="h39-1-8" class="i">+                                None,
</a><a href="#h39-1-9" id="h39-1-9" class="i">+                                &quot;i&quot;,
</a><a href="#h39-1-10" id="h39-1-10" class="i">+                            ),
</a><a href="#h39-1-11" id="h39-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-1-14" id="h39-1-14" class="d">-                        None,
</a><a href="#h39-1-15" id="h39-1-15" class="d">-                        &quot;i&quot;,
</a><a href="#h39-1-16" id="h39-1-16" class="i">+                        1,
</a><a href="#h39-1-17" id="h39-1-17" class="i">+                        Some(
</a><a href="#h39-1-18" id="h39-1-18" class="i">+                            (
</a><a href="#h39-1-19" id="h39-1-19" class="i">+                                None,
</a><a href="#h39-1-20" id="h39-1-20" class="i">+                                &quot;i&quot;,
</a><a href="#h39-1-21" id="h39-1-21" class="i">+                            ),
</a><a href="#h39-1-22" id="h39-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-1-25" id="h39-1-25" class="d">-                        None,
</a><a href="#h39-1-26" id="h39-1-26" class="d">-                        &quot;i&quot;,
</a><a href="#h39-1-27" id="h39-1-27" class="i">+                        1,
</a><a href="#h39-1-28" id="h39-1-28" class="i">+                        Some(
</a><a href="#h39-1-29" id="h39-1-29" class="i">+                            (
</a><a href="#h39-1-30" id="h39-1-30" class="i">+                                None,
</a><a href="#h39-1-31" id="h39-1-31" class="i">+                                &quot;i&quot;,
</a><a href="#h39-1-32" id="h39-1-32" class="i">+                            ),
</a><a href="#h39-1-33" id="h39-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-1-36" id="h39-1-36" class="d">-                        None,
</a><a href="#h39-1-37" id="h39-1-37" class="d">-                        &quot;i&quot;,
</a><a href="#h39-1-38" id="h39-1-38" class="i">+                        1,
</a><a href="#h39-1-39" id="h39-1-39" class="i">+                        Some(
</a><a href="#h39-1-40" id="h39-1-40" class="i">+                            (
</a><a href="#h39-1-41" id="h39-1-41" class="i">+                                None,
</a><a href="#h39-1-42" id="h39-1-42" class="i">+                                &quot;i&quot;,
</a><a href="#h39-1-43" id="h39-1-43" class="i">+                            ),
</a><a href="#h39-1-44" id="h39-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-1-47" id="h39-1-47" class="d">-                        None,
</a><a href="#h39-1-48" id="h39-1-48" class="d">-                        &quot;i&quot;,
</a><a href="#h39-1-49" id="h39-1-49" class="i">+                        1,
</a><a href="#h39-1-50" id="h39-1-50" class="i">+                        Some(
</a><a href="#h39-1-51" id="h39-1-51" class="i">+                            (
</a><a href="#h39-1-52" id="h39-1-52" class="i">+                                None,
</a><a href="#h39-1-53" id="h39-1-53" class="i">+                                &quot;i&quot;,
</a><a href="#h39-1-54" id="h39-1-54" class="i">+                            ),
</a><a href="#h39-1-55" id="h39-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h39-2" id="h39-2" class="h">@@ -130,20 +155,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h39-2-3" id="h39-2-3" class="d">-            Column(
</a><a href="#h39-2-4" id="h39-2-4" class="i">+            Field(
</a>                 0,
<a href="#h39-2-6" id="h39-2-6" class="i">+                None,
</a>             ),
<a href="#h39-2-8" id="h39-2-8" class="d">-            Column(
</a><a href="#h39-2-9" id="h39-2-9" class="i">+            Field(
</a>                 1,
<a href="#h39-2-11" id="h39-2-11" class="i">+                None,
</a>             ),
<a href="#h39-2-13" id="h39-2-13" class="d">-            Column(
</a><a href="#h39-2-14" id="h39-2-14" class="i">+            Field(
</a>                 2,
<a href="#h39-2-16" id="h39-2-16" class="i">+                None,
</a>             ),
<a href="#h39-2-18" id="h39-2-18" class="d">-            Column(
</a><a href="#h39-2-19" id="h39-2-19" class="i">+            Field(
</a>                 3,
<a href="#h39-2-21" id="h39-2-21" class="i">+                None,
</a>             ),
<a href="#h39-2-23" id="h39-2-23" class="d">-            Column(
</a><a href="#h39-2-24" id="h39-2-24" class="i">+            Field(
</a>                 4,
<a href="#h39-2-26" id="h39-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h39-3" id="h39-3" class="h">@@ -155,7 +185,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;integers&quot;,
<a href="#h39-3-3" id="h39-3-3" class="d">-                    alias: None,
</a><a href="#h39-3-4" id="h39-3-4" class="i">+                    label: &quot;integers&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h39-4" id="h39-4" class="h">@@ -167,24 +197,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h39-4-3" id="h39-4-3" class="d">-                        None,
</a><a href="#h39-4-4" id="h39-4-4" class="d">-                        &quot;i&quot;,
</a><a href="#h39-4-5" id="h39-4-5" class="i">+                        1,
</a><a href="#h39-4-6" id="h39-4-6" class="i">+                        Some(
</a><a href="#h39-4-7" id="h39-4-7" class="i">+                            (
</a><a href="#h39-4-8" id="h39-4-8" class="i">+                                None,
</a><a href="#h39-4-9" id="h39-4-9" class="i">+                                &quot;i&quot;,
</a><a href="#h39-4-10" id="h39-4-10" class="i">+                            ),
</a><a href="#h39-4-11" id="h39-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-4-14" id="h39-4-14" class="d">-                        None,
</a><a href="#h39-4-15" id="h39-4-15" class="d">-                        &quot;i&quot;,
</a><a href="#h39-4-16" id="h39-4-16" class="i">+                        1,
</a><a href="#h39-4-17" id="h39-4-17" class="i">+                        Some(
</a><a href="#h39-4-18" id="h39-4-18" class="i">+                            (
</a><a href="#h39-4-19" id="h39-4-19" class="i">+                                None,
</a><a href="#h39-4-20" id="h39-4-20" class="i">+                                &quot;i&quot;,
</a><a href="#h39-4-21" id="h39-4-21" class="i">+                            ),
</a><a href="#h39-4-22" id="h39-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-4-25" id="h39-4-25" class="d">-                        None,
</a><a href="#h39-4-26" id="h39-4-26" class="d">-                        &quot;i&quot;,
</a><a href="#h39-4-27" id="h39-4-27" class="i">+                        1,
</a><a href="#h39-4-28" id="h39-4-28" class="i">+                        Some(
</a><a href="#h39-4-29" id="h39-4-29" class="i">+                            (
</a><a href="#h39-4-30" id="h39-4-30" class="i">+                                None,
</a><a href="#h39-4-31" id="h39-4-31" class="i">+                                &quot;i&quot;,
</a><a href="#h39-4-32" id="h39-4-32" class="i">+                            ),
</a><a href="#h39-4-33" id="h39-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-4-36" id="h39-4-36" class="d">-                        None,
</a><a href="#h39-4-37" id="h39-4-37" class="d">-                        &quot;i&quot;,
</a><a href="#h39-4-38" id="h39-4-38" class="i">+                        1,
</a><a href="#h39-4-39" id="h39-4-39" class="i">+                        Some(
</a><a href="#h39-4-40" id="h39-4-40" class="i">+                            (
</a><a href="#h39-4-41" id="h39-4-41" class="i">+                                None,
</a><a href="#h39-4-42" id="h39-4-42" class="i">+                                &quot;i&quot;,
</a><a href="#h39-4-43" id="h39-4-43" class="i">+                            ),
</a><a href="#h39-4-44" id="h39-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h39-4-47" id="h39-4-47" class="d">-                        None,
</a><a href="#h39-4-48" id="h39-4-48" class="d">-                        &quot;i&quot;,
</a><a href="#h39-4-49" id="h39-4-49" class="i">+                        1,
</a><a href="#h39-4-50" id="h39-4-50" class="i">+                        Some(
</a><a href="#h39-4-51" id="h39-4-51" class="i">+                            (
</a><a href="#h39-4-52" id="h39-4-52" class="i">+                                None,
</a><a href="#h39-4-53" id="h39-4-53" class="i">+                                &quot;i&quot;,
</a><a href="#h39-4-54" id="h39-4-54" class="i">+                            ),
</a><a href="#h39-4-55" id="h39-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h39-5" id="h39-5" class="h">@@ -204,20 +259,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h39-5-3" id="h39-5-3" class="d">-            Column(
</a><a href="#h39-5-4" id="h39-5-4" class="i">+            Field(
</a>                 0,
<a href="#h39-5-6" id="h39-5-6" class="i">+                None,
</a>             ),
<a href="#h39-5-8" id="h39-5-8" class="d">-            Column(
</a><a href="#h39-5-9" id="h39-5-9" class="i">+            Field(
</a>                 1,
<a href="#h39-5-11" id="h39-5-11" class="i">+                None,
</a>             ),
<a href="#h39-5-13" id="h39-5-13" class="d">-            Column(
</a><a href="#h39-5-14" id="h39-5-14" class="i">+            Field(
</a>                 2,
<a href="#h39-5-16" id="h39-5-16" class="i">+                None,
</a>             ),
<a href="#h39-5-18" id="h39-5-18" class="d">-            Column(
</a><a href="#h39-5-19" id="h39-5-19" class="i">+            Field(
</a>                 3,
<a href="#h39-5-21" id="h39-5-21" class="i">+                None,
</a>             ),
<a href="#h39-5-23" id="h39-5-23" class="d">-            Column(
</a><a href="#h39-5-24" id="h39-5-24" class="i">+            Field(
</a>                 4,
<a href="#h39-5-26" id="h39-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h40" href="../file/tests/sql/query/agg_nested.html">tests/sql/query/agg_nested</a> b/<a href="../file/tests/sql/query/agg_nested.html">tests/sql/query/agg_nested</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -40,4 +40,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h40-0-3" id="h40-0-3" class="d">-Plan: Value(&quot;Aggregate function MIN() not allowed here&quot;)
</a><a href="#h40-0-4" id="h40-0-4" class="d">-\ No newline at end of file
</a><a href="#h40-0-5" id="h40-0-5" class="i">+Plan: Value(&quot;Aggregate functions can\&#39;t be nested&quot;)
</a><a href="#h40-0-6" id="h40-0-6" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h41" href="../file/tests/sql/query/agg_norows.html">tests/sql/query/agg_norows</a> b/<a href="../file/tests/sql/query/agg_norows.html">tests/sql/query/agg_norows</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -90,7 +90,7 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h41-0-3" id="h41-0-3" class="d">-                        alias: None,
</a><a href="#h41-0-4" id="h41-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     predicate: Constant(
<a href="#h41-1" id="h41-1" class="h">@@ -108,24 +108,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h41-1-3" id="h41-1-3" class="d">-                        None,
</a><a href="#h41-1-4" id="h41-1-4" class="d">-                        &quot;id&quot;,
</a><a href="#h41-1-5" id="h41-1-5" class="i">+                        0,
</a><a href="#h41-1-6" id="h41-1-6" class="i">+                        Some(
</a><a href="#h41-1-7" id="h41-1-7" class="i">+                            (
</a><a href="#h41-1-8" id="h41-1-8" class="i">+                                None,
</a><a href="#h41-1-9" id="h41-1-9" class="i">+                                &quot;id&quot;,
</a><a href="#h41-1-10" id="h41-1-10" class="i">+                            ),
</a><a href="#h41-1-11" id="h41-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-1-14" id="h41-1-14" class="d">-                        None,
</a><a href="#h41-1-15" id="h41-1-15" class="d">-                        &quot;id&quot;,
</a><a href="#h41-1-16" id="h41-1-16" class="i">+                        0,
</a><a href="#h41-1-17" id="h41-1-17" class="i">+                        Some(
</a><a href="#h41-1-18" id="h41-1-18" class="i">+                            (
</a><a href="#h41-1-19" id="h41-1-19" class="i">+                                None,
</a><a href="#h41-1-20" id="h41-1-20" class="i">+                                &quot;id&quot;,
</a><a href="#h41-1-21" id="h41-1-21" class="i">+                            ),
</a><a href="#h41-1-22" id="h41-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-1-25" id="h41-1-25" class="d">-                        None,
</a><a href="#h41-1-26" id="h41-1-26" class="d">-                        &quot;id&quot;,
</a><a href="#h41-1-27" id="h41-1-27" class="i">+                        0,
</a><a href="#h41-1-28" id="h41-1-28" class="i">+                        Some(
</a><a href="#h41-1-29" id="h41-1-29" class="i">+                            (
</a><a href="#h41-1-30" id="h41-1-30" class="i">+                                None,
</a><a href="#h41-1-31" id="h41-1-31" class="i">+                                &quot;id&quot;,
</a><a href="#h41-1-32" id="h41-1-32" class="i">+                            ),
</a><a href="#h41-1-33" id="h41-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-1-36" id="h41-1-36" class="d">-                        None,
</a><a href="#h41-1-37" id="h41-1-37" class="d">-                        &quot;id&quot;,
</a><a href="#h41-1-38" id="h41-1-38" class="i">+                        0,
</a><a href="#h41-1-39" id="h41-1-39" class="i">+                        Some(
</a><a href="#h41-1-40" id="h41-1-40" class="i">+                            (
</a><a href="#h41-1-41" id="h41-1-41" class="i">+                                None,
</a><a href="#h41-1-42" id="h41-1-42" class="i">+                                &quot;id&quot;,
</a><a href="#h41-1-43" id="h41-1-43" class="i">+                            ),
</a><a href="#h41-1-44" id="h41-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-1-47" id="h41-1-47" class="d">-                        None,
</a><a href="#h41-1-48" id="h41-1-48" class="d">-                        &quot;id&quot;,
</a><a href="#h41-1-49" id="h41-1-49" class="i">+                        0,
</a><a href="#h41-1-50" id="h41-1-50" class="i">+                        Some(
</a><a href="#h41-1-51" id="h41-1-51" class="i">+                            (
</a><a href="#h41-1-52" id="h41-1-52" class="i">+                                None,
</a><a href="#h41-1-53" id="h41-1-53" class="i">+                                &quot;id&quot;,
</a><a href="#h41-1-54" id="h41-1-54" class="i">+                            ),
</a><a href="#h41-1-55" id="h41-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h41-2" id="h41-2" class="h">@@ -145,20 +170,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h41-2-3" id="h41-2-3" class="d">-            Column(
</a><a href="#h41-2-4" id="h41-2-4" class="i">+            Field(
</a>                 0,
<a href="#h41-2-6" id="h41-2-6" class="i">+                None,
</a>             ),
<a href="#h41-2-8" id="h41-2-8" class="d">-            Column(
</a><a href="#h41-2-9" id="h41-2-9" class="i">+            Field(
</a>                 1,
<a href="#h41-2-11" id="h41-2-11" class="i">+                None,
</a>             ),
<a href="#h41-2-13" id="h41-2-13" class="d">-            Column(
</a><a href="#h41-2-14" id="h41-2-14" class="i">+            Field(
</a>                 2,
<a href="#h41-2-16" id="h41-2-16" class="i">+                None,
</a>             ),
<a href="#h41-2-18" id="h41-2-18" class="d">-            Column(
</a><a href="#h41-2-19" id="h41-2-19" class="i">+            Field(
</a>                 3,
<a href="#h41-2-21" id="h41-2-21" class="i">+                None,
</a>             ),
<a href="#h41-2-23" id="h41-2-23" class="d">-            Column(
</a><a href="#h41-2-24" id="h41-2-24" class="i">+            Field(
</a>                 4,
<a href="#h41-2-26" id="h41-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h41-3" id="h41-3" class="h">@@ -170,7 +200,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h41-3-3" id="h41-3-3" class="d">-                    alias: None,
</a><a href="#h41-3-4" id="h41-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: Some(
                         Constant(
                             Boolean(
<a href="#h41-4" id="h41-4" class="h">@@ -188,24 +218,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h41-4-3" id="h41-4-3" class="d">-                        None,
</a><a href="#h41-4-4" id="h41-4-4" class="d">-                        &quot;id&quot;,
</a><a href="#h41-4-5" id="h41-4-5" class="i">+                        0,
</a><a href="#h41-4-6" id="h41-4-6" class="i">+                        Some(
</a><a href="#h41-4-7" id="h41-4-7" class="i">+                            (
</a><a href="#h41-4-8" id="h41-4-8" class="i">+                                None,
</a><a href="#h41-4-9" id="h41-4-9" class="i">+                                &quot;id&quot;,
</a><a href="#h41-4-10" id="h41-4-10" class="i">+                            ),
</a><a href="#h41-4-11" id="h41-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-4-14" id="h41-4-14" class="d">-                        None,
</a><a href="#h41-4-15" id="h41-4-15" class="d">-                        &quot;id&quot;,
</a><a href="#h41-4-16" id="h41-4-16" class="i">+                        0,
</a><a href="#h41-4-17" id="h41-4-17" class="i">+                        Some(
</a><a href="#h41-4-18" id="h41-4-18" class="i">+                            (
</a><a href="#h41-4-19" id="h41-4-19" class="i">+                                None,
</a><a href="#h41-4-20" id="h41-4-20" class="i">+                                &quot;id&quot;,
</a><a href="#h41-4-21" id="h41-4-21" class="i">+                            ),
</a><a href="#h41-4-22" id="h41-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-4-25" id="h41-4-25" class="d">-                        None,
</a><a href="#h41-4-26" id="h41-4-26" class="d">-                        &quot;id&quot;,
</a><a href="#h41-4-27" id="h41-4-27" class="i">+                        0,
</a><a href="#h41-4-28" id="h41-4-28" class="i">+                        Some(
</a><a href="#h41-4-29" id="h41-4-29" class="i">+                            (
</a><a href="#h41-4-30" id="h41-4-30" class="i">+                                None,
</a><a href="#h41-4-31" id="h41-4-31" class="i">+                                &quot;id&quot;,
</a><a href="#h41-4-32" id="h41-4-32" class="i">+                            ),
</a><a href="#h41-4-33" id="h41-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-4-36" id="h41-4-36" class="d">-                        None,
</a><a href="#h41-4-37" id="h41-4-37" class="d">-                        &quot;id&quot;,
</a><a href="#h41-4-38" id="h41-4-38" class="i">+                        0,
</a><a href="#h41-4-39" id="h41-4-39" class="i">+                        Some(
</a><a href="#h41-4-40" id="h41-4-40" class="i">+                            (
</a><a href="#h41-4-41" id="h41-4-41" class="i">+                                None,
</a><a href="#h41-4-42" id="h41-4-42" class="i">+                                &quot;id&quot;,
</a><a href="#h41-4-43" id="h41-4-43" class="i">+                            ),
</a><a href="#h41-4-44" id="h41-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h41-4-47" id="h41-4-47" class="d">-                        None,
</a><a href="#h41-4-48" id="h41-4-48" class="d">-                        &quot;id&quot;,
</a><a href="#h41-4-49" id="h41-4-49" class="i">+                        0,
</a><a href="#h41-4-50" id="h41-4-50" class="i">+                        Some(
</a><a href="#h41-4-51" id="h41-4-51" class="i">+                            (
</a><a href="#h41-4-52" id="h41-4-52" class="i">+                                None,
</a><a href="#h41-4-53" id="h41-4-53" class="i">+                                &quot;id&quot;,
</a><a href="#h41-4-54" id="h41-4-54" class="i">+                            ),
</a><a href="#h41-4-55" id="h41-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h41-5" id="h41-5" class="h">@@ -225,20 +280,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h41-5-3" id="h41-5-3" class="d">-            Column(
</a><a href="#h41-5-4" id="h41-5-4" class="i">+            Field(
</a>                 0,
<a href="#h41-5-6" id="h41-5-6" class="i">+                None,
</a>             ),
<a href="#h41-5-8" id="h41-5-8" class="d">-            Column(
</a><a href="#h41-5-9" id="h41-5-9" class="i">+            Field(
</a>                 1,
<a href="#h41-5-11" id="h41-5-11" class="i">+                None,
</a>             ),
<a href="#h41-5-13" id="h41-5-13" class="d">-            Column(
</a><a href="#h41-5-14" id="h41-5-14" class="i">+            Field(
</a>                 2,
<a href="#h41-5-16" id="h41-5-16" class="i">+                None,
</a>             ),
<a href="#h41-5-18" id="h41-5-18" class="d">-            Column(
</a><a href="#h41-5-19" id="h41-5-19" class="i">+            Field(
</a>                 3,
<a href="#h41-5-21" id="h41-5-21" class="i">+                None,
</a>             ),
<a href="#h41-5-23" id="h41-5-23" class="d">-            Column(
</a><a href="#h41-5-24" id="h41-5-24" class="i">+            Field(
</a>                 4,
<a href="#h41-5-26" id="h41-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h42" href="../file/tests/sql/query/agg_norows_group.html">tests/sql/query/agg_norows_group</a> b/<a href="../file/tests/sql/query/agg_norows_group.html">tests/sql/query/agg_norows_group</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -99,7 +99,7 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h42-0-3" id="h42-0-3" class="d">-                        alias: None,
</a><a href="#h42-0-4" id="h42-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     predicate: Constant(
<a href="#h42-1" id="h42-1" class="h">@@ -118,28 +118,58 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h42-1-3" id="h42-1-3" class="d">-                        None,
</a><a href="#h42-1-4" id="h42-1-4" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-5" id="h42-1-5" class="i">+                        0,
</a><a href="#h42-1-6" id="h42-1-6" class="i">+                        Some(
</a><a href="#h42-1-7" id="h42-1-7" class="i">+                            (
</a><a href="#h42-1-8" id="h42-1-8" class="i">+                                None,
</a><a href="#h42-1-9" id="h42-1-9" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-10" id="h42-1-10" class="i">+                            ),
</a><a href="#h42-1-11" id="h42-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-1-14" id="h42-1-14" class="d">-                        None,
</a><a href="#h42-1-15" id="h42-1-15" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-16" id="h42-1-16" class="i">+                        0,
</a><a href="#h42-1-17" id="h42-1-17" class="i">+                        Some(
</a><a href="#h42-1-18" id="h42-1-18" class="i">+                            (
</a><a href="#h42-1-19" id="h42-1-19" class="i">+                                None,
</a><a href="#h42-1-20" id="h42-1-20" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-21" id="h42-1-21" class="i">+                            ),
</a><a href="#h42-1-22" id="h42-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-1-25" id="h42-1-25" class="d">-                        None,
</a><a href="#h42-1-26" id="h42-1-26" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-27" id="h42-1-27" class="i">+                        0,
</a><a href="#h42-1-28" id="h42-1-28" class="i">+                        Some(
</a><a href="#h42-1-29" id="h42-1-29" class="i">+                            (
</a><a href="#h42-1-30" id="h42-1-30" class="i">+                                None,
</a><a href="#h42-1-31" id="h42-1-31" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-32" id="h42-1-32" class="i">+                            ),
</a><a href="#h42-1-33" id="h42-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-1-36" id="h42-1-36" class="d">-                        None,
</a><a href="#h42-1-37" id="h42-1-37" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-38" id="h42-1-38" class="i">+                        0,
</a><a href="#h42-1-39" id="h42-1-39" class="i">+                        Some(
</a><a href="#h42-1-40" id="h42-1-40" class="i">+                            (
</a><a href="#h42-1-41" id="h42-1-41" class="i">+                                None,
</a><a href="#h42-1-42" id="h42-1-42" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-43" id="h42-1-43" class="i">+                            ),
</a><a href="#h42-1-44" id="h42-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-1-47" id="h42-1-47" class="d">-                        None,
</a><a href="#h42-1-48" id="h42-1-48" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-49" id="h42-1-49" class="i">+                        0,
</a><a href="#h42-1-50" id="h42-1-50" class="i">+                        Some(
</a><a href="#h42-1-51" id="h42-1-51" class="i">+                            (
</a><a href="#h42-1-52" id="h42-1-52" class="i">+                                None,
</a><a href="#h42-1-53" id="h42-1-53" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-54" id="h42-1-54" class="i">+                            ),
</a><a href="#h42-1-55" id="h42-1-55" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-1-58" id="h42-1-58" class="d">-                        None,
</a><a href="#h42-1-59" id="h42-1-59" class="d">-                        &quot;id&quot;,
</a><a href="#h42-1-60" id="h42-1-60" class="i">+                        0,
</a><a href="#h42-1-61" id="h42-1-61" class="i">+                        Some(
</a><a href="#h42-1-62" id="h42-1-62" class="i">+                            (
</a><a href="#h42-1-63" id="h42-1-63" class="i">+                                None,
</a><a href="#h42-1-64" id="h42-1-64" class="i">+                                &quot;id&quot;,
</a><a href="#h42-1-65" id="h42-1-65" class="i">+                            ),
</a><a href="#h42-1-66" id="h42-1-66" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h42-2" id="h42-2" class="h">@@ -159,20 +189,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h42-2-3" id="h42-2-3" class="d">-            Column(
</a><a href="#h42-2-4" id="h42-2-4" class="i">+            Field(
</a>                 0,
<a href="#h42-2-6" id="h42-2-6" class="i">+                None,
</a>             ),
<a href="#h42-2-8" id="h42-2-8" class="d">-            Column(
</a><a href="#h42-2-9" id="h42-2-9" class="i">+            Field(
</a>                 1,
<a href="#h42-2-11" id="h42-2-11" class="i">+                None,
</a>             ),
<a href="#h42-2-13" id="h42-2-13" class="d">-            Column(
</a><a href="#h42-2-14" id="h42-2-14" class="i">+            Field(
</a>                 2,
<a href="#h42-2-16" id="h42-2-16" class="i">+                None,
</a>             ),
<a href="#h42-2-18" id="h42-2-18" class="d">-            Column(
</a><a href="#h42-2-19" id="h42-2-19" class="i">+            Field(
</a>                 3,
<a href="#h42-2-21" id="h42-2-21" class="i">+                None,
</a>             ),
<a href="#h42-2-23" id="h42-2-23" class="d">-            Column(
</a><a href="#h42-2-24" id="h42-2-24" class="i">+            Field(
</a>                 4,
<a href="#h42-2-26" id="h42-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h42-3" id="h42-3" class="h">@@ -184,7 +219,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h42-3-3" id="h42-3-3" class="d">-                    alias: None,
</a><a href="#h42-3-4" id="h42-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: Some(
                         Constant(
                             Boolean(
<a href="#h42-4" id="h42-4" class="h">@@ -203,28 +238,58 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h42-4-3" id="h42-4-3" class="d">-                        None,
</a><a href="#h42-4-4" id="h42-4-4" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-5" id="h42-4-5" class="i">+                        0,
</a><a href="#h42-4-6" id="h42-4-6" class="i">+                        Some(
</a><a href="#h42-4-7" id="h42-4-7" class="i">+                            (
</a><a href="#h42-4-8" id="h42-4-8" class="i">+                                None,
</a><a href="#h42-4-9" id="h42-4-9" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-10" id="h42-4-10" class="i">+                            ),
</a><a href="#h42-4-11" id="h42-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-4-14" id="h42-4-14" class="d">-                        None,
</a><a href="#h42-4-15" id="h42-4-15" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-16" id="h42-4-16" class="i">+                        0,
</a><a href="#h42-4-17" id="h42-4-17" class="i">+                        Some(
</a><a href="#h42-4-18" id="h42-4-18" class="i">+                            (
</a><a href="#h42-4-19" id="h42-4-19" class="i">+                                None,
</a><a href="#h42-4-20" id="h42-4-20" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-21" id="h42-4-21" class="i">+                            ),
</a><a href="#h42-4-22" id="h42-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-4-25" id="h42-4-25" class="d">-                        None,
</a><a href="#h42-4-26" id="h42-4-26" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-27" id="h42-4-27" class="i">+                        0,
</a><a href="#h42-4-28" id="h42-4-28" class="i">+                        Some(
</a><a href="#h42-4-29" id="h42-4-29" class="i">+                            (
</a><a href="#h42-4-30" id="h42-4-30" class="i">+                                None,
</a><a href="#h42-4-31" id="h42-4-31" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-32" id="h42-4-32" class="i">+                            ),
</a><a href="#h42-4-33" id="h42-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-4-36" id="h42-4-36" class="d">-                        None,
</a><a href="#h42-4-37" id="h42-4-37" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-38" id="h42-4-38" class="i">+                        0,
</a><a href="#h42-4-39" id="h42-4-39" class="i">+                        Some(
</a><a href="#h42-4-40" id="h42-4-40" class="i">+                            (
</a><a href="#h42-4-41" id="h42-4-41" class="i">+                                None,
</a><a href="#h42-4-42" id="h42-4-42" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-43" id="h42-4-43" class="i">+                            ),
</a><a href="#h42-4-44" id="h42-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-4-47" id="h42-4-47" class="d">-                        None,
</a><a href="#h42-4-48" id="h42-4-48" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-49" id="h42-4-49" class="i">+                        0,
</a><a href="#h42-4-50" id="h42-4-50" class="i">+                        Some(
</a><a href="#h42-4-51" id="h42-4-51" class="i">+                            (
</a><a href="#h42-4-52" id="h42-4-52" class="i">+                                None,
</a><a href="#h42-4-53" id="h42-4-53" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-54" id="h42-4-54" class="i">+                            ),
</a><a href="#h42-4-55" id="h42-4-55" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h42-4-58" id="h42-4-58" class="d">-                        None,
</a><a href="#h42-4-59" id="h42-4-59" class="d">-                        &quot;id&quot;,
</a><a href="#h42-4-60" id="h42-4-60" class="i">+                        0,
</a><a href="#h42-4-61" id="h42-4-61" class="i">+                        Some(
</a><a href="#h42-4-62" id="h42-4-62" class="i">+                            (
</a><a href="#h42-4-63" id="h42-4-63" class="i">+                                None,
</a><a href="#h42-4-64" id="h42-4-64" class="i">+                                &quot;id&quot;,
</a><a href="#h42-4-65" id="h42-4-65" class="i">+                            ),
</a><a href="#h42-4-66" id="h42-4-66" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h42-5" id="h42-5" class="h">@@ -244,20 +309,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h42-5-3" id="h42-5-3" class="d">-            Column(
</a><a href="#h42-5-4" id="h42-5-4" class="i">+            Field(
</a>                 0,
<a href="#h42-5-6" id="h42-5-6" class="i">+                None,
</a>             ),
<a href="#h42-5-8" id="h42-5-8" class="d">-            Column(
</a><a href="#h42-5-9" id="h42-5-9" class="i">+            Field(
</a>                 1,
<a href="#h42-5-11" id="h42-5-11" class="i">+                None,
</a>             ),
<a href="#h42-5-13" id="h42-5-13" class="d">-            Column(
</a><a href="#h42-5-14" id="h42-5-14" class="i">+            Field(
</a>                 2,
<a href="#h42-5-16" id="h42-5-16" class="i">+                None,
</a>             ),
<a href="#h42-5-18" id="h42-5-18" class="d">-            Column(
</a><a href="#h42-5-19" id="h42-5-19" class="i">+            Field(
</a>                 3,
<a href="#h42-5-21" id="h42-5-21" class="i">+                None,
</a>             ),
<a href="#h42-5-23" id="h42-5-23" class="d">-            Column(
</a><a href="#h42-5-24" id="h42-5-24" class="i">+            Field(
</a>                 4,
<a href="#h42-5-26" id="h42-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h43" href="../file/tests/sql/query/agg_string.html">tests/sql/query/agg_string</a> b/<a href="../file/tests/sql/query/agg_string.html">tests/sql/query/agg_string</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -97,14 +97,19 @@ Plan: Plan(
</a>                 source: Filter {
                     source: Scan {
                         table: &quot;strings&quot;,
<a href="#h43-0-3" id="h43-0-3" class="d">-                        alias: None,
</a><a href="#h43-0-4" id="h43-0-4" class="i">+                        label: &quot;strings&quot;,
</a>                         filter: None,
                     },
                     predicate: Not(
                         IsNull(
                             Field(
<a href="#h43-0-10" id="h43-0-10" class="d">-                                None,
</a><a href="#h43-0-11" id="h43-0-11" class="d">-                                &quot;s&quot;,
</a><a href="#h43-0-12" id="h43-0-12" class="i">+                                1,
</a><a href="#h43-0-13" id="h43-0-13" class="i">+                                Some(
</a><a href="#h43-0-14" id="h43-0-14" class="i">+                                    (
</a><a href="#h43-0-15" id="h43-0-15" class="i">+                                        None,
</a><a href="#h43-0-16" id="h43-0-16" class="i">+                                        &quot;s&quot;,
</a><a href="#h43-0-17" id="h43-0-17" class="i">+                                    ),
</a><a href="#h43-0-18" id="h43-0-18" class="i">+                                ),
</a>                             ),
                         ),
                     ),
<a href="#h43-1" id="h43-1" class="h">@@ -118,24 +123,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h43-1-3" id="h43-1-3" class="d">-                        None,
</a><a href="#h43-1-4" id="h43-1-4" class="d">-                        &quot;s&quot;,
</a><a href="#h43-1-5" id="h43-1-5" class="i">+                        1,
</a><a href="#h43-1-6" id="h43-1-6" class="i">+                        Some(
</a><a href="#h43-1-7" id="h43-1-7" class="i">+                            (
</a><a href="#h43-1-8" id="h43-1-8" class="i">+                                None,
</a><a href="#h43-1-9" id="h43-1-9" class="i">+                                &quot;s&quot;,
</a><a href="#h43-1-10" id="h43-1-10" class="i">+                            ),
</a><a href="#h43-1-11" id="h43-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-1-14" id="h43-1-14" class="d">-                        None,
</a><a href="#h43-1-15" id="h43-1-15" class="d">-                        &quot;s&quot;,
</a><a href="#h43-1-16" id="h43-1-16" class="i">+                        1,
</a><a href="#h43-1-17" id="h43-1-17" class="i">+                        Some(
</a><a href="#h43-1-18" id="h43-1-18" class="i">+                            (
</a><a href="#h43-1-19" id="h43-1-19" class="i">+                                None,
</a><a href="#h43-1-20" id="h43-1-20" class="i">+                                &quot;s&quot;,
</a><a href="#h43-1-21" id="h43-1-21" class="i">+                            ),
</a><a href="#h43-1-22" id="h43-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-1-25" id="h43-1-25" class="d">-                        None,
</a><a href="#h43-1-26" id="h43-1-26" class="d">-                        &quot;s&quot;,
</a><a href="#h43-1-27" id="h43-1-27" class="i">+                        1,
</a><a href="#h43-1-28" id="h43-1-28" class="i">+                        Some(
</a><a href="#h43-1-29" id="h43-1-29" class="i">+                            (
</a><a href="#h43-1-30" id="h43-1-30" class="i">+                                None,
</a><a href="#h43-1-31" id="h43-1-31" class="i">+                                &quot;s&quot;,
</a><a href="#h43-1-32" id="h43-1-32" class="i">+                            ),
</a><a href="#h43-1-33" id="h43-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-1-36" id="h43-1-36" class="d">-                        None,
</a><a href="#h43-1-37" id="h43-1-37" class="d">-                        &quot;s&quot;,
</a><a href="#h43-1-38" id="h43-1-38" class="i">+                        1,
</a><a href="#h43-1-39" id="h43-1-39" class="i">+                        Some(
</a><a href="#h43-1-40" id="h43-1-40" class="i">+                            (
</a><a href="#h43-1-41" id="h43-1-41" class="i">+                                None,
</a><a href="#h43-1-42" id="h43-1-42" class="i">+                                &quot;s&quot;,
</a><a href="#h43-1-43" id="h43-1-43" class="i">+                            ),
</a><a href="#h43-1-44" id="h43-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-1-47" id="h43-1-47" class="d">-                        None,
</a><a href="#h43-1-48" id="h43-1-48" class="d">-                        &quot;s&quot;,
</a><a href="#h43-1-49" id="h43-1-49" class="i">+                        1,
</a><a href="#h43-1-50" id="h43-1-50" class="i">+                        Some(
</a><a href="#h43-1-51" id="h43-1-51" class="i">+                            (
</a><a href="#h43-1-52" id="h43-1-52" class="i">+                                None,
</a><a href="#h43-1-53" id="h43-1-53" class="i">+                                &quot;s&quot;,
</a><a href="#h43-1-54" id="h43-1-54" class="i">+                            ),
</a><a href="#h43-1-55" id="h43-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h43-2" id="h43-2" class="h">@@ -155,20 +185,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h43-2-3" id="h43-2-3" class="d">-            Column(
</a><a href="#h43-2-4" id="h43-2-4" class="i">+            Field(
</a>                 0,
<a href="#h43-2-6" id="h43-2-6" class="i">+                None,
</a>             ),
<a href="#h43-2-8" id="h43-2-8" class="d">-            Column(
</a><a href="#h43-2-9" id="h43-2-9" class="i">+            Field(
</a>                 1,
<a href="#h43-2-11" id="h43-2-11" class="i">+                None,
</a>             ),
<a href="#h43-2-13" id="h43-2-13" class="d">-            Column(
</a><a href="#h43-2-14" id="h43-2-14" class="i">+            Field(
</a>                 2,
<a href="#h43-2-16" id="h43-2-16" class="i">+                None,
</a>             ),
<a href="#h43-2-18" id="h43-2-18" class="d">-            Column(
</a><a href="#h43-2-19" id="h43-2-19" class="i">+            Field(
</a>                 3,
<a href="#h43-2-21" id="h43-2-21" class="i">+                None,
</a>             ),
<a href="#h43-2-23" id="h43-2-23" class="d">-            Column(
</a><a href="#h43-2-24" id="h43-2-24" class="i">+            Field(
</a>                 4,
<a href="#h43-2-26" id="h43-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h43-3" id="h43-3" class="h">@@ -180,13 +215,18 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;strings&quot;,
<a href="#h43-3-3" id="h43-3-3" class="d">-                    alias: None,
</a><a href="#h43-3-4" id="h43-3-4" class="i">+                    label: &quot;strings&quot;,
</a>                     filter: Some(
                         Not(
                             IsNull(
                                 Field(
<a href="#h43-3-9" id="h43-3-9" class="d">-                                    None,
</a><a href="#h43-3-10" id="h43-3-10" class="d">-                                    &quot;s&quot;,
</a><a href="#h43-3-11" id="h43-3-11" class="i">+                                    1,
</a><a href="#h43-3-12" id="h43-3-12" class="i">+                                    Some(
</a><a href="#h43-3-13" id="h43-3-13" class="i">+                                        (
</a><a href="#h43-3-14" id="h43-3-14" class="i">+                                            None,
</a><a href="#h43-3-15" id="h43-3-15" class="i">+                                            &quot;s&quot;,
</a><a href="#h43-3-16" id="h43-3-16" class="i">+                                        ),
</a><a href="#h43-3-17" id="h43-3-17" class="i">+                                    ),
</a>                                 ),
                             ),
                         ),
<a href="#h43-4" id="h43-4" class="h">@@ -201,24 +241,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h43-4-3" id="h43-4-3" class="d">-                        None,
</a><a href="#h43-4-4" id="h43-4-4" class="d">-                        &quot;s&quot;,
</a><a href="#h43-4-5" id="h43-4-5" class="i">+                        1,
</a><a href="#h43-4-6" id="h43-4-6" class="i">+                        Some(
</a><a href="#h43-4-7" id="h43-4-7" class="i">+                            (
</a><a href="#h43-4-8" id="h43-4-8" class="i">+                                None,
</a><a href="#h43-4-9" id="h43-4-9" class="i">+                                &quot;s&quot;,
</a><a href="#h43-4-10" id="h43-4-10" class="i">+                            ),
</a><a href="#h43-4-11" id="h43-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-4-14" id="h43-4-14" class="d">-                        None,
</a><a href="#h43-4-15" id="h43-4-15" class="d">-                        &quot;s&quot;,
</a><a href="#h43-4-16" id="h43-4-16" class="i">+                        1,
</a><a href="#h43-4-17" id="h43-4-17" class="i">+                        Some(
</a><a href="#h43-4-18" id="h43-4-18" class="i">+                            (
</a><a href="#h43-4-19" id="h43-4-19" class="i">+                                None,
</a><a href="#h43-4-20" id="h43-4-20" class="i">+                                &quot;s&quot;,
</a><a href="#h43-4-21" id="h43-4-21" class="i">+                            ),
</a><a href="#h43-4-22" id="h43-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-4-25" id="h43-4-25" class="d">-                        None,
</a><a href="#h43-4-26" id="h43-4-26" class="d">-                        &quot;s&quot;,
</a><a href="#h43-4-27" id="h43-4-27" class="i">+                        1,
</a><a href="#h43-4-28" id="h43-4-28" class="i">+                        Some(
</a><a href="#h43-4-29" id="h43-4-29" class="i">+                            (
</a><a href="#h43-4-30" id="h43-4-30" class="i">+                                None,
</a><a href="#h43-4-31" id="h43-4-31" class="i">+                                &quot;s&quot;,
</a><a href="#h43-4-32" id="h43-4-32" class="i">+                            ),
</a><a href="#h43-4-33" id="h43-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-4-36" id="h43-4-36" class="d">-                        None,
</a><a href="#h43-4-37" id="h43-4-37" class="d">-                        &quot;s&quot;,
</a><a href="#h43-4-38" id="h43-4-38" class="i">+                        1,
</a><a href="#h43-4-39" id="h43-4-39" class="i">+                        Some(
</a><a href="#h43-4-40" id="h43-4-40" class="i">+                            (
</a><a href="#h43-4-41" id="h43-4-41" class="i">+                                None,
</a><a href="#h43-4-42" id="h43-4-42" class="i">+                                &quot;s&quot;,
</a><a href="#h43-4-43" id="h43-4-43" class="i">+                            ),
</a><a href="#h43-4-44" id="h43-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h43-4-47" id="h43-4-47" class="d">-                        None,
</a><a href="#h43-4-48" id="h43-4-48" class="d">-                        &quot;s&quot;,
</a><a href="#h43-4-49" id="h43-4-49" class="i">+                        1,
</a><a href="#h43-4-50" id="h43-4-50" class="i">+                        Some(
</a><a href="#h43-4-51" id="h43-4-51" class="i">+                            (
</a><a href="#h43-4-52" id="h43-4-52" class="i">+                                None,
</a><a href="#h43-4-53" id="h43-4-53" class="i">+                                &quot;s&quot;,
</a><a href="#h43-4-54" id="h43-4-54" class="i">+                            ),
</a><a href="#h43-4-55" id="h43-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h43-5" id="h43-5" class="h">@@ -238,20 +303,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h43-5-3" id="h43-5-3" class="d">-            Column(
</a><a href="#h43-5-4" id="h43-5-4" class="i">+            Field(
</a>                 0,
<a href="#h43-5-6" id="h43-5-6" class="i">+                None,
</a>             ),
<a href="#h43-5-8" id="h43-5-8" class="d">-            Column(
</a><a href="#h43-5-9" id="h43-5-9" class="i">+            Field(
</a>                 1,
<a href="#h43-5-11" id="h43-5-11" class="i">+                None,
</a>             ),
<a href="#h43-5-13" id="h43-5-13" class="d">-            Column(
</a><a href="#h43-5-14" id="h43-5-14" class="i">+            Field(
</a>                 2,
<a href="#h43-5-16" id="h43-5-16" class="i">+                None,
</a>             ),
<a href="#h43-5-18" id="h43-5-18" class="d">-            Column(
</a><a href="#h43-5-19" id="h43-5-19" class="i">+            Field(
</a>                 3,
<a href="#h43-5-21" id="h43-5-21" class="i">+                None,
</a>             ),
<a href="#h43-5-23" id="h43-5-23" class="d">-            Column(
</a><a href="#h43-5-24" id="h43-5-24" class="i">+            Field(
</a>                 4,
<a href="#h43-5-26" id="h43-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h44" href="../file/tests/sql/query/agg_string_null.html">tests/sql/query/agg_string_null</a> b/<a href="../file/tests/sql/query/agg_string_null.html">tests/sql/query/agg_string_null</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -81,7 +81,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;strings&quot;,
<a href="#h44-0-3" id="h44-0-3" class="d">-                    alias: None,
</a><a href="#h44-0-4" id="h44-0-4" class="i">+                    label: &quot;strings&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h44-1" id="h44-1" class="h">@@ -93,24 +93,49 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h44-1-3" id="h44-1-3" class="d">-                        None,
</a><a href="#h44-1-4" id="h44-1-4" class="d">-                        &quot;s&quot;,
</a><a href="#h44-1-5" id="h44-1-5" class="i">+                        1,
</a><a href="#h44-1-6" id="h44-1-6" class="i">+                        Some(
</a><a href="#h44-1-7" id="h44-1-7" class="i">+                            (
</a><a href="#h44-1-8" id="h44-1-8" class="i">+                                None,
</a><a href="#h44-1-9" id="h44-1-9" class="i">+                                &quot;s&quot;,
</a><a href="#h44-1-10" id="h44-1-10" class="i">+                            ),
</a><a href="#h44-1-11" id="h44-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-1-14" id="h44-1-14" class="d">-                        None,
</a><a href="#h44-1-15" id="h44-1-15" class="d">-                        &quot;s&quot;,
</a><a href="#h44-1-16" id="h44-1-16" class="i">+                        1,
</a><a href="#h44-1-17" id="h44-1-17" class="i">+                        Some(
</a><a href="#h44-1-18" id="h44-1-18" class="i">+                            (
</a><a href="#h44-1-19" id="h44-1-19" class="i">+                                None,
</a><a href="#h44-1-20" id="h44-1-20" class="i">+                                &quot;s&quot;,
</a><a href="#h44-1-21" id="h44-1-21" class="i">+                            ),
</a><a href="#h44-1-22" id="h44-1-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-1-25" id="h44-1-25" class="d">-                        None,
</a><a href="#h44-1-26" id="h44-1-26" class="d">-                        &quot;s&quot;,
</a><a href="#h44-1-27" id="h44-1-27" class="i">+                        1,
</a><a href="#h44-1-28" id="h44-1-28" class="i">+                        Some(
</a><a href="#h44-1-29" id="h44-1-29" class="i">+                            (
</a><a href="#h44-1-30" id="h44-1-30" class="i">+                                None,
</a><a href="#h44-1-31" id="h44-1-31" class="i">+                                &quot;s&quot;,
</a><a href="#h44-1-32" id="h44-1-32" class="i">+                            ),
</a><a href="#h44-1-33" id="h44-1-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-1-36" id="h44-1-36" class="d">-                        None,
</a><a href="#h44-1-37" id="h44-1-37" class="d">-                        &quot;s&quot;,
</a><a href="#h44-1-38" id="h44-1-38" class="i">+                        1,
</a><a href="#h44-1-39" id="h44-1-39" class="i">+                        Some(
</a><a href="#h44-1-40" id="h44-1-40" class="i">+                            (
</a><a href="#h44-1-41" id="h44-1-41" class="i">+                                None,
</a><a href="#h44-1-42" id="h44-1-42" class="i">+                                &quot;s&quot;,
</a><a href="#h44-1-43" id="h44-1-43" class="i">+                            ),
</a><a href="#h44-1-44" id="h44-1-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-1-47" id="h44-1-47" class="d">-                        None,
</a><a href="#h44-1-48" id="h44-1-48" class="d">-                        &quot;s&quot;,
</a><a href="#h44-1-49" id="h44-1-49" class="i">+                        1,
</a><a href="#h44-1-50" id="h44-1-50" class="i">+                        Some(
</a><a href="#h44-1-51" id="h44-1-51" class="i">+                            (
</a><a href="#h44-1-52" id="h44-1-52" class="i">+                                None,
</a><a href="#h44-1-53" id="h44-1-53" class="i">+                                &quot;s&quot;,
</a><a href="#h44-1-54" id="h44-1-54" class="i">+                            ),
</a><a href="#h44-1-55" id="h44-1-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h44-2" id="h44-2" class="h">@@ -130,20 +155,25 @@ Plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h44-2-3" id="h44-2-3" class="d">-            Column(
</a><a href="#h44-2-4" id="h44-2-4" class="i">+            Field(
</a>                 0,
<a href="#h44-2-6" id="h44-2-6" class="i">+                None,
</a>             ),
<a href="#h44-2-8" id="h44-2-8" class="d">-            Column(
</a><a href="#h44-2-9" id="h44-2-9" class="i">+            Field(
</a>                 1,
<a href="#h44-2-11" id="h44-2-11" class="i">+                None,
</a>             ),
<a href="#h44-2-13" id="h44-2-13" class="d">-            Column(
</a><a href="#h44-2-14" id="h44-2-14" class="i">+            Field(
</a>                 2,
<a href="#h44-2-16" id="h44-2-16" class="i">+                None,
</a>             ),
<a href="#h44-2-18" id="h44-2-18" class="d">-            Column(
</a><a href="#h44-2-19" id="h44-2-19" class="i">+            Field(
</a>                 3,
<a href="#h44-2-21" id="h44-2-21" class="i">+                None,
</a>             ),
<a href="#h44-2-23" id="h44-2-23" class="d">-            Column(
</a><a href="#h44-2-24" id="h44-2-24" class="i">+            Field(
</a>                 4,
<a href="#h44-2-26" id="h44-2-26" class="i">+                None,
</a>             ),
         ],
     },
<a href="#h44-3" id="h44-3" class="h">@@ -155,7 +185,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;strings&quot;,
<a href="#h44-3-3" id="h44-3-3" class="d">-                    alias: None,
</a><a href="#h44-3-4" id="h44-3-4" class="i">+                    label: &quot;strings&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h44-4" id="h44-4" class="h">@@ -167,24 +197,49 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h44-4-3" id="h44-4-3" class="d">-                        None,
</a><a href="#h44-4-4" id="h44-4-4" class="d">-                        &quot;s&quot;,
</a><a href="#h44-4-5" id="h44-4-5" class="i">+                        1,
</a><a href="#h44-4-6" id="h44-4-6" class="i">+                        Some(
</a><a href="#h44-4-7" id="h44-4-7" class="i">+                            (
</a><a href="#h44-4-8" id="h44-4-8" class="i">+                                None,
</a><a href="#h44-4-9" id="h44-4-9" class="i">+                                &quot;s&quot;,
</a><a href="#h44-4-10" id="h44-4-10" class="i">+                            ),
</a><a href="#h44-4-11" id="h44-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-4-14" id="h44-4-14" class="d">-                        None,
</a><a href="#h44-4-15" id="h44-4-15" class="d">-                        &quot;s&quot;,
</a><a href="#h44-4-16" id="h44-4-16" class="i">+                        1,
</a><a href="#h44-4-17" id="h44-4-17" class="i">+                        Some(
</a><a href="#h44-4-18" id="h44-4-18" class="i">+                            (
</a><a href="#h44-4-19" id="h44-4-19" class="i">+                                None,
</a><a href="#h44-4-20" id="h44-4-20" class="i">+                                &quot;s&quot;,
</a><a href="#h44-4-21" id="h44-4-21" class="i">+                            ),
</a><a href="#h44-4-22" id="h44-4-22" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-4-25" id="h44-4-25" class="d">-                        None,
</a><a href="#h44-4-26" id="h44-4-26" class="d">-                        &quot;s&quot;,
</a><a href="#h44-4-27" id="h44-4-27" class="i">+                        1,
</a><a href="#h44-4-28" id="h44-4-28" class="i">+                        Some(
</a><a href="#h44-4-29" id="h44-4-29" class="i">+                            (
</a><a href="#h44-4-30" id="h44-4-30" class="i">+                                None,
</a><a href="#h44-4-31" id="h44-4-31" class="i">+                                &quot;s&quot;,
</a><a href="#h44-4-32" id="h44-4-32" class="i">+                            ),
</a><a href="#h44-4-33" id="h44-4-33" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-4-36" id="h44-4-36" class="d">-                        None,
</a><a href="#h44-4-37" id="h44-4-37" class="d">-                        &quot;s&quot;,
</a><a href="#h44-4-38" id="h44-4-38" class="i">+                        1,
</a><a href="#h44-4-39" id="h44-4-39" class="i">+                        Some(
</a><a href="#h44-4-40" id="h44-4-40" class="i">+                            (
</a><a href="#h44-4-41" id="h44-4-41" class="i">+                                None,
</a><a href="#h44-4-42" id="h44-4-42" class="i">+                                &quot;s&quot;,
</a><a href="#h44-4-43" id="h44-4-43" class="i">+                            ),
</a><a href="#h44-4-44" id="h44-4-44" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h44-4-47" id="h44-4-47" class="d">-                        None,
</a><a href="#h44-4-48" id="h44-4-48" class="d">-                        &quot;s&quot;,
</a><a href="#h44-4-49" id="h44-4-49" class="i">+                        1,
</a><a href="#h44-4-50" id="h44-4-50" class="i">+                        Some(
</a><a href="#h44-4-51" id="h44-4-51" class="i">+                            (
</a><a href="#h44-4-52" id="h44-4-52" class="i">+                                None,
</a><a href="#h44-4-53" id="h44-4-53" class="i">+                                &quot;s&quot;,
</a><a href="#h44-4-54" id="h44-4-54" class="i">+                            ),
</a><a href="#h44-4-55" id="h44-4-55" class="i">+                        ),
</a>                     ),
                 ],
             },
<a href="#h44-5" id="h44-5" class="h">@@ -204,20 +259,25 @@ Optimized plan: Plan(
</a>             None,
         ],
         expressions: [
<a href="#h44-5-3" id="h44-5-3" class="d">-            Column(
</a><a href="#h44-5-4" id="h44-5-4" class="i">+            Field(
</a>                 0,
<a href="#h44-5-6" id="h44-5-6" class="i">+                None,
</a>             ),
<a href="#h44-5-8" id="h44-5-8" class="d">-            Column(
</a><a href="#h44-5-9" id="h44-5-9" class="i">+            Field(
</a>                 1,
<a href="#h44-5-11" id="h44-5-11" class="i">+                None,
</a>             ),
<a href="#h44-5-13" id="h44-5-13" class="d">-            Column(
</a><a href="#h44-5-14" id="h44-5-14" class="i">+            Field(
</a>                 2,
<a href="#h44-5-16" id="h44-5-16" class="i">+                None,
</a>             ),
<a href="#h44-5-18" id="h44-5-18" class="d">-            Column(
</a><a href="#h44-5-19" id="h44-5-19" class="i">+            Field(
</a>                 3,
<a href="#h44-5-21" id="h44-5-21" class="i">+                None,
</a>             ),
<a href="#h44-5-23" id="h44-5-23" class="d">-            Column(
</a><a href="#h44-5-24" id="h44-5-24" class="i">+            Field(
</a>                 4,
<a href="#h44-5-26" id="h44-5-26" class="i">+                None,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h45" href="../file/tests/sql/query/agg_ungrouped.html">tests/sql/query/agg_ungrouped</a> b/<a href="../file/tests/sql/query/agg_ungrouped.html">tests/sql/query/agg_ungrouped</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -41,86 +41,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h45-0-3" id="h45-0-3" class="d">-Plan: Plan(
</a><a href="#h45-0-4" id="h45-0-4" class="d">-    Projection {
</a><a href="#h45-0-5" id="h45-0-5" class="d">-        source: Aggregation {
</a><a href="#h45-0-6" id="h45-0-6" class="d">-            source: Projection {
</a><a href="#h45-0-7" id="h45-0-7" class="d">-                source: Scan {
</a><a href="#h45-0-8" id="h45-0-8" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h45-0-9" id="h45-0-9" class="d">-                    alias: None,
</a><a href="#h45-0-10" id="h45-0-10" class="d">-                    filter: None,
</a><a href="#h45-0-11" id="h45-0-11" class="d">-                },
</a><a href="#h45-0-12" id="h45-0-12" class="d">-                labels: [
</a><a href="#h45-0-13" id="h45-0-13" class="d">-                    None,
</a><a href="#h45-0-14" id="h45-0-14" class="d">-                ],
</a><a href="#h45-0-15" id="h45-0-15" class="d">-                expressions: [
</a><a href="#h45-0-16" id="h45-0-16" class="d">-                    Constant(
</a><a href="#h45-0-17" id="h45-0-17" class="d">-                        Boolean(
</a><a href="#h45-0-18" id="h45-0-18" class="d">-                            true,
</a><a href="#h45-0-19" id="h45-0-19" class="d">-                        ),
</a><a href="#h45-0-20" id="h45-0-20" class="d">-                    ),
</a><a href="#h45-0-21" id="h45-0-21" class="d">-                ],
</a><a href="#h45-0-22" id="h45-0-22" class="d">-            },
</a><a href="#h45-0-23" id="h45-0-23" class="d">-            aggregates: [
</a><a href="#h45-0-24" id="h45-0-24" class="d">-                Count,
</a><a href="#h45-0-25" id="h45-0-25" class="d">-            ],
</a><a href="#h45-0-26" id="h45-0-26" class="d">-        },
</a><a href="#h45-0-27" id="h45-0-27" class="d">-        labels: [
</a><a href="#h45-0-28" id="h45-0-28" class="d">-            None,
</a><a href="#h45-0-29" id="h45-0-29" class="d">-            None,
</a><a href="#h45-0-30" id="h45-0-30" class="d">-        ],
</a><a href="#h45-0-31" id="h45-0-31" class="d">-        expressions: [
</a><a href="#h45-0-32" id="h45-0-32" class="d">-            Field(
</a><a href="#h45-0-33" id="h45-0-33" class="d">-                None,
</a><a href="#h45-0-34" id="h45-0-34" class="d">-                &quot;studio_id&quot;,
</a><a href="#h45-0-35" id="h45-0-35" class="d">-            ),
</a><a href="#h45-0-36" id="h45-0-36" class="d">-            Column(
</a><a href="#h45-0-37" id="h45-0-37" class="d">-                0,
</a><a href="#h45-0-38" id="h45-0-38" class="d">-            ),
</a><a href="#h45-0-39" id="h45-0-39" class="d">-        ],
</a><a href="#h45-0-40" id="h45-0-40" class="d">-    },
</a><a href="#h45-0-41" id="h45-0-41" class="d">-)
</a><a href="#h45-0-42" id="h45-0-42" class="d">-
</a><a href="#h45-0-43" id="h45-0-43" class="d">-Optimized plan: Plan(
</a><a href="#h45-0-44" id="h45-0-44" class="d">-    Projection {
</a><a href="#h45-0-45" id="h45-0-45" class="d">-        source: Aggregation {
</a><a href="#h45-0-46" id="h45-0-46" class="d">-            source: Projection {
</a><a href="#h45-0-47" id="h45-0-47" class="d">-                source: Scan {
</a><a href="#h45-0-48" id="h45-0-48" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h45-0-49" id="h45-0-49" class="d">-                    alias: None,
</a><a href="#h45-0-50" id="h45-0-50" class="d">-                    filter: None,
</a><a href="#h45-0-51" id="h45-0-51" class="d">-                },
</a><a href="#h45-0-52" id="h45-0-52" class="d">-                labels: [
</a><a href="#h45-0-53" id="h45-0-53" class="d">-                    None,
</a><a href="#h45-0-54" id="h45-0-54" class="d">-                ],
</a><a href="#h45-0-55" id="h45-0-55" class="d">-                expressions: [
</a><a href="#h45-0-56" id="h45-0-56" class="d">-                    Constant(
</a><a href="#h45-0-57" id="h45-0-57" class="d">-                        Boolean(
</a><a href="#h45-0-58" id="h45-0-58" class="d">-                            true,
</a><a href="#h45-0-59" id="h45-0-59" class="d">-                        ),
</a><a href="#h45-0-60" id="h45-0-60" class="d">-                    ),
</a><a href="#h45-0-61" id="h45-0-61" class="d">-                ],
</a><a href="#h45-0-62" id="h45-0-62" class="d">-            },
</a><a href="#h45-0-63" id="h45-0-63" class="d">-            aggregates: [
</a><a href="#h45-0-64" id="h45-0-64" class="d">-                Count,
</a><a href="#h45-0-65" id="h45-0-65" class="d">-            ],
</a><a href="#h45-0-66" id="h45-0-66" class="d">-        },
</a><a href="#h45-0-67" id="h45-0-67" class="d">-        labels: [
</a><a href="#h45-0-68" id="h45-0-68" class="d">-            None,
</a><a href="#h45-0-69" id="h45-0-69" class="d">-            None,
</a><a href="#h45-0-70" id="h45-0-70" class="d">-        ],
</a><a href="#h45-0-71" id="h45-0-71" class="d">-        expressions: [
</a><a href="#h45-0-72" id="h45-0-72" class="d">-            Field(
</a><a href="#h45-0-73" id="h45-0-73" class="d">-                None,
</a><a href="#h45-0-74" id="h45-0-74" class="d">-                &quot;studio_id&quot;,
</a><a href="#h45-0-75" id="h45-0-75" class="d">-            ),
</a><a href="#h45-0-76" id="h45-0-76" class="d">-            Column(
</a><a href="#h45-0-77" id="h45-0-77" class="d">-                0,
</a><a href="#h45-0-78" id="h45-0-78" class="d">-            ),
</a><a href="#h45-0-79" id="h45-0-79" class="d">-        ],
</a><a href="#h45-0-80" id="h45-0-80" class="d">-    },
</a><a href="#h45-0-81" id="h45-0-81" class="d">-)
</a><a href="#h45-0-82" id="h45-0-82" class="d">-
</a><a href="#h45-0-83" id="h45-0-83" class="d">-Query: SELECT studio_id, COUNT(*) FROM movies
</a><a href="#h45-0-84" id="h45-0-84" class="d">-
</a><a href="#h45-0-85" id="h45-0-85" class="d">-Result: Value(&quot;Unknown field studio_id&quot;)
</a><a href="#h45-0-86" id="h45-0-86" class="d">-\ No newline at end of file
</a><a href="#h45-0-87" id="h45-0-87" class="i">+Plan: Value(&quot;Unknown field studio_id&quot;)
</a><a href="#h45-0-88" id="h45-0-88" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h46" href="../file/tests/sql/query/all.html">tests/sql/query/all</a> b/<a href="../file/tests/sql/query/all.html">tests/sql/query/all</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -26,7 +26,7 @@ AST: Select {
</a> Plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h46-0-3" id="h46-0-3" class="d">-        alias: None,
</a><a href="#h46-0-4" id="h46-0-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: None,
     },
 )
<a href="#h46-1" id="h46-1" class="h">@@ -34,7 +34,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h46-1-3" id="h46-1-3" class="d">-        alias: None,
</a><a href="#h46-1-4" id="h46-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: None,
     },
 )
<b>diff --git a/<a id="h47" href="../file/tests/sql/query/as_.html">tests/sql/query/as_</a> b/<a href="../file/tests/sql/query/as_.html">tests/sql/query/as_</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -66,7 +66,7 @@ Plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h47-0-3" id="h47-0-3" class="d">-            alias: None,
</a><a href="#h47-0-4" id="h47-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h47-1" id="h47-1" class="h">@@ -106,8 +106,13 @@ Plan: Plan(
</a>                 ),
             ),
             Field(
<a href="#h47-1-3" id="h47-1-3" class="d">-                None,
</a><a href="#h47-1-4" id="h47-1-4" class="d">-                &quot;id&quot;,
</a><a href="#h47-1-5" id="h47-1-5" class="i">+                0,
</a><a href="#h47-1-6" id="h47-1-6" class="i">+                Some(
</a><a href="#h47-1-7" id="h47-1-7" class="i">+                    (
</a><a href="#h47-1-8" id="h47-1-8" class="i">+                        None,
</a><a href="#h47-1-9" id="h47-1-9" class="i">+                        &quot;id&quot;,
</a><a href="#h47-1-10" id="h47-1-10" class="i">+                    ),
</a><a href="#h47-1-11" id="h47-1-11" class="i">+                ),
</a>             ),
         ],
     },
<a href="#h47-2" id="h47-2" class="h">@@ -117,7 +122,7 @@ Optimized plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h47-2-3" id="h47-2-3" class="d">-            alias: None,
</a><a href="#h47-2-4" id="h47-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h47-3" id="h47-3" class="h">@@ -157,8 +162,13 @@ Optimized plan: Plan(
</a>                 ),
             ),
             Field(
<a href="#h47-3-3" id="h47-3-3" class="d">-                None,
</a><a href="#h47-3-4" id="h47-3-4" class="d">-                &quot;id&quot;,
</a><a href="#h47-3-5" id="h47-3-5" class="i">+                0,
</a><a href="#h47-3-6" id="h47-3-6" class="i">+                Some(
</a><a href="#h47-3-7" id="h47-3-7" class="i">+                    (
</a><a href="#h47-3-8" id="h47-3-8" class="i">+                        None,
</a><a href="#h47-3-9" id="h47-3-9" class="i">+                        &quot;id&quot;,
</a><a href="#h47-3-10" id="h47-3-10" class="i">+                    ),
</a><a href="#h47-3-11" id="h47-3-11" class="i">+                ),
</a>             ),
         ],
     },
<b>diff --git a/<a id="h48" href="../file/tests/sql/query/expr_dynamic.html">tests/sql/query/expr_dynamic</a> b/<a href="../file/tests/sql/query/expr_dynamic.html">tests/sql/query/expr_dynamic</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -41,62 +41,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h48-0-3" id="h48-0-3" class="d">-Plan: Plan(
</a><a href="#h48-0-4" id="h48-0-4" class="d">-    Projection {
</a><a href="#h48-0-5" id="h48-0-5" class="d">-        source: Scan {
</a><a href="#h48-0-6" id="h48-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h48-0-7" id="h48-0-7" class="d">-            alias: None,
</a><a href="#h48-0-8" id="h48-0-8" class="d">-            filter: None,
</a><a href="#h48-0-9" id="h48-0-9" class="d">-        },
</a><a href="#h48-0-10" id="h48-0-10" class="d">-        labels: [
</a><a href="#h48-0-11" id="h48-0-11" class="d">-            Some(
</a><a href="#h48-0-12" id="h48-0-12" class="d">-                &quot;age&quot;,
</a><a href="#h48-0-13" id="h48-0-13" class="d">-            ),
</a><a href="#h48-0-14" id="h48-0-14" class="d">-        ],
</a><a href="#h48-0-15" id="h48-0-15" class="d">-        expressions: [
</a><a href="#h48-0-16" id="h48-0-16" class="d">-            Subtract(
</a><a href="#h48-0-17" id="h48-0-17" class="d">-                Constant(
</a><a href="#h48-0-18" id="h48-0-18" class="d">-                    Integer(
</a><a href="#h48-0-19" id="h48-0-19" class="d">-                        2020,
</a><a href="#h48-0-20" id="h48-0-20" class="d">-                    ),
</a><a href="#h48-0-21" id="h48-0-21" class="d">-                ),
</a><a href="#h48-0-22" id="h48-0-22" class="d">-                Field(
</a><a href="#h48-0-23" id="h48-0-23" class="d">-                    None,
</a><a href="#h48-0-24" id="h48-0-24" class="d">-                    &quot;year&quot;,
</a><a href="#h48-0-25" id="h48-0-25" class="d">-                ),
</a><a href="#h48-0-26" id="h48-0-26" class="d">-            ),
</a><a href="#h48-0-27" id="h48-0-27" class="d">-        ],
</a><a href="#h48-0-28" id="h48-0-28" class="d">-    },
</a><a href="#h48-0-29" id="h48-0-29" class="d">-)
</a><a href="#h48-0-30" id="h48-0-30" class="d">-
</a><a href="#h48-0-31" id="h48-0-31" class="d">-Optimized plan: Plan(
</a><a href="#h48-0-32" id="h48-0-32" class="d">-    Projection {
</a><a href="#h48-0-33" id="h48-0-33" class="d">-        source: Scan {
</a><a href="#h48-0-34" id="h48-0-34" class="d">-            table: &quot;movies&quot;,
</a><a href="#h48-0-35" id="h48-0-35" class="d">-            alias: None,
</a><a href="#h48-0-36" id="h48-0-36" class="d">-            filter: None,
</a><a href="#h48-0-37" id="h48-0-37" class="d">-        },
</a><a href="#h48-0-38" id="h48-0-38" class="d">-        labels: [
</a><a href="#h48-0-39" id="h48-0-39" class="d">-            Some(
</a><a href="#h48-0-40" id="h48-0-40" class="d">-                &quot;age&quot;,
</a><a href="#h48-0-41" id="h48-0-41" class="d">-            ),
</a><a href="#h48-0-42" id="h48-0-42" class="d">-        ],
</a><a href="#h48-0-43" id="h48-0-43" class="d">-        expressions: [
</a><a href="#h48-0-44" id="h48-0-44" class="d">-            Subtract(
</a><a href="#h48-0-45" id="h48-0-45" class="d">-                Constant(
</a><a href="#h48-0-46" id="h48-0-46" class="d">-                    Integer(
</a><a href="#h48-0-47" id="h48-0-47" class="d">-                        2020,
</a><a href="#h48-0-48" id="h48-0-48" class="d">-                    ),
</a><a href="#h48-0-49" id="h48-0-49" class="d">-                ),
</a><a href="#h48-0-50" id="h48-0-50" class="d">-                Field(
</a><a href="#h48-0-51" id="h48-0-51" class="d">-                    None,
</a><a href="#h48-0-52" id="h48-0-52" class="d">-                    &quot;year&quot;,
</a><a href="#h48-0-53" id="h48-0-53" class="d">-                ),
</a><a href="#h48-0-54" id="h48-0-54" class="d">-            ),
</a><a href="#h48-0-55" id="h48-0-55" class="d">-        ],
</a><a href="#h48-0-56" id="h48-0-56" class="d">-    },
</a><a href="#h48-0-57" id="h48-0-57" class="d">-)
</a><a href="#h48-0-58" id="h48-0-58" class="d">-
</a><a href="#h48-0-59" id="h48-0-59" class="d">-Query: SELECT 2020 - year AS age FROM movies
</a><a href="#h48-0-60" id="h48-0-60" class="d">-
</a><a href="#h48-0-61" id="h48-0-61" class="d">-Result: Value(&quot;Unknown field year&quot;)
</a><a href="#h48-0-62" id="h48-0-62" class="d">-\ No newline at end of file
</a><a href="#h48-0-63" id="h48-0-63" class="i">+Plan: Value(&quot;Unknown field year&quot;)
</a><a href="#h48-0-64" id="h48-0-64" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h49" href="../file/tests/sql/query/expr_mixed.html">tests/sql/query/expr_mixed</a> b/<a href="../file/tests/sql/query/expr_mixed.html">tests/sql/query/expr_mixed</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -69,7 +69,7 @@ Plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h49-0-3" id="h49-0-3" class="d">-            alias: None,
</a><a href="#h49-0-4" id="h49-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h49-1" id="h49-1" class="h">@@ -105,8 +105,13 @@ Plan: Plan(
</a>                     ),
                 ),
                 Field(
<a href="#h49-1-3" id="h49-1-3" class="d">-                    None,
</a><a href="#h49-1-4" id="h49-1-4" class="d">-                    &quot;released&quot;,
</a><a href="#h49-1-5" id="h49-1-5" class="i">+                    4,
</a><a href="#h49-1-6" id="h49-1-6" class="i">+                    Some(
</a><a href="#h49-1-7" id="h49-1-7" class="i">+                        (
</a><a href="#h49-1-8" id="h49-1-8" class="i">+                            None,
</a><a href="#h49-1-9" id="h49-1-9" class="i">+                            &quot;released&quot;,
</a><a href="#h49-1-10" id="h49-1-10" class="i">+                        ),
</a><a href="#h49-1-11" id="h49-1-11" class="i">+                    ),
</a>                 ),
             ),
         ],
<a href="#h49-2" id="h49-2" class="h">@@ -117,7 +122,7 @@ Optimized plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h49-2-3" id="h49-2-3" class="d">-            alias: None,
</a><a href="#h49-2-4" id="h49-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h49-3" id="h49-3" class="h">@@ -139,8 +144,13 @@ Optimized plan: Plan(
</a>                     ),
                 ),
                 Field(
<a href="#h49-3-3" id="h49-3-3" class="d">-                    None,
</a><a href="#h49-3-4" id="h49-3-4" class="d">-                    &quot;released&quot;,
</a><a href="#h49-3-5" id="h49-3-5" class="i">+                    4,
</a><a href="#h49-3-6" id="h49-3-6" class="i">+                    Some(
</a><a href="#h49-3-7" id="h49-3-7" class="i">+                        (
</a><a href="#h49-3-8" id="h49-3-8" class="i">+                            None,
</a><a href="#h49-3-9" id="h49-3-9" class="i">+                            &quot;released&quot;,
</a><a href="#h49-3-10" id="h49-3-10" class="i">+                        ),
</a><a href="#h49-3-11" id="h49-3-11" class="i">+                    ),
</a>                 ),
             ),
         ],
<b>diff --git a/<a id="h50" href="../file/tests/sql/query/field_aliased.html">tests/sql/query/field_aliased</a> b/<a href="../file/tests/sql/query/field_aliased.html">tests/sql/query/field_aliased</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -52,16 +52,12 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h50-0-3" id="h50-0-3" class="d">-                alias: Some(
</a><a href="#h50-0-4" id="h50-0-4" class="d">-                    &quot;m&quot;,
</a><a href="#h50-0-5" id="h50-0-5" class="d">-                ),
</a><a href="#h50-0-6" id="h50-0-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h50-0-11" id="h50-0-11" class="d">-                alias: Some(
</a><a href="#h50-0-12" id="h50-0-12" class="d">-                    &quot;g&quot;,
</a><a href="#h50-0-13" id="h50-0-13" class="d">-                ),
</a><a href="#h50-0-14" id="h50-0-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h50-1" id="h50-1" class="h">@@ -74,16 +70,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h50-1-3" id="h50-1-3" class="i">+                0,
</a>                 Some(
<a href="#h50-1-5" id="h50-1-5" class="d">-                    &quot;m&quot;,
</a><a href="#h50-1-6" id="h50-1-6" class="i">+                    (
</a><a href="#h50-1-7" id="h50-1-7" class="i">+                        Some(
</a><a href="#h50-1-8" id="h50-1-8" class="i">+                            &quot;m&quot;,
</a><a href="#h50-1-9" id="h50-1-9" class="i">+                        ),
</a><a href="#h50-1-10" id="h50-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h50-1-11" id="h50-1-11" class="i">+                    ),
</a>                 ),
<a href="#h50-1-13" id="h50-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h50-1-16" id="h50-1-16" class="i">+                7,
</a>                 Some(
<a href="#h50-1-18" id="h50-1-18" class="d">-                    &quot;g&quot;,
</a><a href="#h50-1-19" id="h50-1-19" class="i">+                    (
</a><a href="#h50-1-20" id="h50-1-20" class="i">+                        Some(
</a><a href="#h50-1-21" id="h50-1-21" class="i">+                            &quot;g&quot;,
</a><a href="#h50-1-22" id="h50-1-22" class="i">+                        ),
</a><a href="#h50-1-23" id="h50-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h50-1-24" id="h50-1-24" class="i">+                    ),
</a>                 ),
<a href="#h50-1-26" id="h50-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h50-2" id="h50-2" class="h">@@ -94,16 +100,12 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h50-2-3" id="h50-2-3" class="d">-                alias: Some(
</a><a href="#h50-2-4" id="h50-2-4" class="d">-                    &quot;m&quot;,
</a><a href="#h50-2-5" id="h50-2-5" class="d">-                ),
</a><a href="#h50-2-6" id="h50-2-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h50-2-11" id="h50-2-11" class="d">-                alias: Some(
</a><a href="#h50-2-12" id="h50-2-12" class="d">-                    &quot;g&quot;,
</a><a href="#h50-2-13" id="h50-2-13" class="d">-                ),
</a><a href="#h50-2-14" id="h50-2-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h50-3" id="h50-3" class="h">@@ -116,16 +118,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h50-3-3" id="h50-3-3" class="i">+                0,
</a>                 Some(
<a href="#h50-3-5" id="h50-3-5" class="d">-                    &quot;m&quot;,
</a><a href="#h50-3-6" id="h50-3-6" class="i">+                    (
</a><a href="#h50-3-7" id="h50-3-7" class="i">+                        Some(
</a><a href="#h50-3-8" id="h50-3-8" class="i">+                            &quot;m&quot;,
</a><a href="#h50-3-9" id="h50-3-9" class="i">+                        ),
</a><a href="#h50-3-10" id="h50-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h50-3-11" id="h50-3-11" class="i">+                    ),
</a>                 ),
<a href="#h50-3-13" id="h50-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h50-3-16" id="h50-3-16" class="i">+                7,
</a>                 Some(
<a href="#h50-3-18" id="h50-3-18" class="d">-                    &quot;g&quot;,
</a><a href="#h50-3-19" id="h50-3-19" class="i">+                    (
</a><a href="#h50-3-20" id="h50-3-20" class="i">+                        Some(
</a><a href="#h50-3-21" id="h50-3-21" class="i">+                            &quot;g&quot;,
</a><a href="#h50-3-22" id="h50-3-22" class="i">+                        ),
</a><a href="#h50-3-23" id="h50-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h50-3-24" id="h50-3-24" class="i">+                    ),
</a>                 ),
<a href="#h50-3-26" id="h50-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h51" href="../file/tests/sql/query/field_ambiguous.html">tests/sql/query/field_ambiguous</a> b/<a href="../file/tests/sql/query/field_ambiguous.html">tests/sql/query/field_ambiguous</a></b>
<a href="#h51-0" id="h51-0" class="h">@@ -34,64 +34,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h51-0-3" id="h51-0-3" class="d">-Plan: Plan(
</a><a href="#h51-0-4" id="h51-0-4" class="d">-    Projection {
</a><a href="#h51-0-5" id="h51-0-5" class="d">-        source: NestedLoopJoin {
</a><a href="#h51-0-6" id="h51-0-6" class="d">-            outer: Scan {
</a><a href="#h51-0-7" id="h51-0-7" class="d">-                table: &quot;movies&quot;,
</a><a href="#h51-0-8" id="h51-0-8" class="d">-                alias: None,
</a><a href="#h51-0-9" id="h51-0-9" class="d">-                filter: None,
</a><a href="#h51-0-10" id="h51-0-10" class="d">-            },
</a><a href="#h51-0-11" id="h51-0-11" class="d">-            inner: Scan {
</a><a href="#h51-0-12" id="h51-0-12" class="d">-                table: &quot;genres&quot;,
</a><a href="#h51-0-13" id="h51-0-13" class="d">-                alias: None,
</a><a href="#h51-0-14" id="h51-0-14" class="d">-                filter: None,
</a><a href="#h51-0-15" id="h51-0-15" class="d">-            },
</a><a href="#h51-0-16" id="h51-0-16" class="d">-            predicate: None,
</a><a href="#h51-0-17" id="h51-0-17" class="d">-            pad: false,
</a><a href="#h51-0-18" id="h51-0-18" class="d">-            flip: false,
</a><a href="#h51-0-19" id="h51-0-19" class="d">-        },
</a><a href="#h51-0-20" id="h51-0-20" class="d">-        labels: [
</a><a href="#h51-0-21" id="h51-0-21" class="d">-            None,
</a><a href="#h51-0-22" id="h51-0-22" class="d">-        ],
</a><a href="#h51-0-23" id="h51-0-23" class="d">-        expressions: [
</a><a href="#h51-0-24" id="h51-0-24" class="d">-            Field(
</a><a href="#h51-0-25" id="h51-0-25" class="d">-                None,
</a><a href="#h51-0-26" id="h51-0-26" class="d">-                &quot;id&quot;,
</a><a href="#h51-0-27" id="h51-0-27" class="d">-            ),
</a><a href="#h51-0-28" id="h51-0-28" class="d">-        ],
</a><a href="#h51-0-29" id="h51-0-29" class="d">-    },
</a><a href="#h51-0-30" id="h51-0-30" class="d">-)
</a><a href="#h51-0-31" id="h51-0-31" class="d">-
</a><a href="#h51-0-32" id="h51-0-32" class="d">-Optimized plan: Plan(
</a><a href="#h51-0-33" id="h51-0-33" class="d">-    Projection {
</a><a href="#h51-0-34" id="h51-0-34" class="d">-        source: NestedLoopJoin {
</a><a href="#h51-0-35" id="h51-0-35" class="d">-            outer: Scan {
</a><a href="#h51-0-36" id="h51-0-36" class="d">-                table: &quot;movies&quot;,
</a><a href="#h51-0-37" id="h51-0-37" class="d">-                alias: None,
</a><a href="#h51-0-38" id="h51-0-38" class="d">-                filter: None,
</a><a href="#h51-0-39" id="h51-0-39" class="d">-            },
</a><a href="#h51-0-40" id="h51-0-40" class="d">-            inner: Scan {
</a><a href="#h51-0-41" id="h51-0-41" class="d">-                table: &quot;genres&quot;,
</a><a href="#h51-0-42" id="h51-0-42" class="d">-                alias: None,
</a><a href="#h51-0-43" id="h51-0-43" class="d">-                filter: None,
</a><a href="#h51-0-44" id="h51-0-44" class="d">-            },
</a><a href="#h51-0-45" id="h51-0-45" class="d">-            predicate: None,
</a><a href="#h51-0-46" id="h51-0-46" class="d">-            pad: false,
</a><a href="#h51-0-47" id="h51-0-47" class="d">-            flip: false,
</a><a href="#h51-0-48" id="h51-0-48" class="d">-        },
</a><a href="#h51-0-49" id="h51-0-49" class="d">-        labels: [
</a><a href="#h51-0-50" id="h51-0-50" class="d">-            None,
</a><a href="#h51-0-51" id="h51-0-51" class="d">-        ],
</a><a href="#h51-0-52" id="h51-0-52" class="d">-        expressions: [
</a><a href="#h51-0-53" id="h51-0-53" class="d">-            Field(
</a><a href="#h51-0-54" id="h51-0-54" class="d">-                None,
</a><a href="#h51-0-55" id="h51-0-55" class="d">-                &quot;id&quot;,
</a><a href="#h51-0-56" id="h51-0-56" class="d">-            ),
</a><a href="#h51-0-57" id="h51-0-57" class="d">-        ],
</a><a href="#h51-0-58" id="h51-0-58" class="d">-    },
</a><a href="#h51-0-59" id="h51-0-59" class="d">-)
</a><a href="#h51-0-60" id="h51-0-60" class="d">-
</a><a href="#h51-0-61" id="h51-0-61" class="d">-Query: SELECT id FROM movies, genres
</a><a href="#h51-0-62" id="h51-0-62" class="d">-
</a><a href="#h51-0-63" id="h51-0-63" class="d">-Result: Value(&quot;Field reference id is ambiguous&quot;)
</a><a href="#h51-0-64" id="h51-0-64" class="d">-\ No newline at end of file
</a><a href="#h51-0-65" id="h51-0-65" class="i">+Plan: Value(&quot;Ambiguous field id&quot;)
</a><a href="#h51-0-66" id="h51-0-66" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h52" href="../file/tests/sql/query/field_multi.html">tests/sql/query/field_multi</a> b/<a href="../file/tests/sql/query/field_multi.html">tests/sql/query/field_multi</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -39,7 +39,7 @@ Plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h52-0-3" id="h52-0-3" class="d">-            alias: None,
</a><a href="#h52-0-4" id="h52-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h52-1" id="h52-1" class="h">@@ -48,12 +48,22 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h52-1-3" id="h52-1-3" class="d">-                None,
</a><a href="#h52-1-4" id="h52-1-4" class="d">-                &quot;id&quot;,
</a><a href="#h52-1-5" id="h52-1-5" class="i">+                0,
</a><a href="#h52-1-6" id="h52-1-6" class="i">+                Some(
</a><a href="#h52-1-7" id="h52-1-7" class="i">+                    (
</a><a href="#h52-1-8" id="h52-1-8" class="i">+                        None,
</a><a href="#h52-1-9" id="h52-1-9" class="i">+                        &quot;id&quot;,
</a><a href="#h52-1-10" id="h52-1-10" class="i">+                    ),
</a><a href="#h52-1-11" id="h52-1-11" class="i">+                ),
</a>             ),
             Field(
<a href="#h52-1-14" id="h52-1-14" class="d">-                None,
</a><a href="#h52-1-15" id="h52-1-15" class="d">-                &quot;title&quot;,
</a><a href="#h52-1-16" id="h52-1-16" class="i">+                1,
</a><a href="#h52-1-17" id="h52-1-17" class="i">+                Some(
</a><a href="#h52-1-18" id="h52-1-18" class="i">+                    (
</a><a href="#h52-1-19" id="h52-1-19" class="i">+                        None,
</a><a href="#h52-1-20" id="h52-1-20" class="i">+                        &quot;title&quot;,
</a><a href="#h52-1-21" id="h52-1-21" class="i">+                    ),
</a><a href="#h52-1-22" id="h52-1-22" class="i">+                ),
</a>             ),
         ],
     },
<a href="#h52-2" id="h52-2" class="h">@@ -63,7 +73,7 @@ Optimized plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h52-2-3" id="h52-2-3" class="d">-            alias: None,
</a><a href="#h52-2-4" id="h52-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h52-3" id="h52-3" class="h">@@ -72,12 +82,22 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h52-3-3" id="h52-3-3" class="d">-                None,
</a><a href="#h52-3-4" id="h52-3-4" class="d">-                &quot;id&quot;,
</a><a href="#h52-3-5" id="h52-3-5" class="i">+                0,
</a><a href="#h52-3-6" id="h52-3-6" class="i">+                Some(
</a><a href="#h52-3-7" id="h52-3-7" class="i">+                    (
</a><a href="#h52-3-8" id="h52-3-8" class="i">+                        None,
</a><a href="#h52-3-9" id="h52-3-9" class="i">+                        &quot;id&quot;,
</a><a href="#h52-3-10" id="h52-3-10" class="i">+                    ),
</a><a href="#h52-3-11" id="h52-3-11" class="i">+                ),
</a>             ),
             Field(
<a href="#h52-3-14" id="h52-3-14" class="d">-                None,
</a><a href="#h52-3-15" id="h52-3-15" class="d">-                &quot;title&quot;,
</a><a href="#h52-3-16" id="h52-3-16" class="i">+                1,
</a><a href="#h52-3-17" id="h52-3-17" class="i">+                Some(
</a><a href="#h52-3-18" id="h52-3-18" class="i">+                    (
</a><a href="#h52-3-19" id="h52-3-19" class="i">+                        None,
</a><a href="#h52-3-20" id="h52-3-20" class="i">+                        &quot;title&quot;,
</a><a href="#h52-3-21" id="h52-3-21" class="i">+                    ),
</a><a href="#h52-3-22" id="h52-3-22" class="i">+                ),
</a>             ),
         ],
     },
<b>diff --git a/<a id="h53" href="../file/tests/sql/query/field_qualified.html">tests/sql/query/field_qualified</a> b/<a href="../file/tests/sql/query/field_qualified.html">tests/sql/query/field_qualified</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -36,7 +36,7 @@ Plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h53-0-3" id="h53-0-3" class="d">-            alias: None,
</a><a href="#h53-0-4" id="h53-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h53-1" id="h53-1" class="h">@@ -44,10 +44,15 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h53-1-3" id="h53-1-3" class="i">+                0,
</a>                 Some(
<a href="#h53-1-5" id="h53-1-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h53-1-6" id="h53-1-6" class="i">+                    (
</a><a href="#h53-1-7" id="h53-1-7" class="i">+                        Some(
</a><a href="#h53-1-8" id="h53-1-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h53-1-9" id="h53-1-9" class="i">+                        ),
</a><a href="#h53-1-10" id="h53-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h53-1-11" id="h53-1-11" class="i">+                    ),
</a>                 ),
<a href="#h53-1-13" id="h53-1-13" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h53-2" id="h53-2" class="h">@@ -57,7 +62,7 @@ Optimized plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h53-2-3" id="h53-2-3" class="d">-            alias: None,
</a><a href="#h53-2-4" id="h53-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h53-3" id="h53-3" class="h">@@ -65,10 +70,15 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h53-3-3" id="h53-3-3" class="i">+                0,
</a>                 Some(
<a href="#h53-3-5" id="h53-3-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h53-3-6" id="h53-3-6" class="i">+                    (
</a><a href="#h53-3-7" id="h53-3-7" class="i">+                        Some(
</a><a href="#h53-3-8" id="h53-3-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h53-3-9" id="h53-3-9" class="i">+                        ),
</a><a href="#h53-3-10" id="h53-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h53-3-11" id="h53-3-11" class="i">+                    ),
</a>                 ),
<a href="#h53-3-13" id="h53-3-13" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h54" href="../file/tests/sql/query/field_qualified_multi.html">tests/sql/query/field_qualified_multi</a> b/<a href="../file/tests/sql/query/field_qualified_multi.html">tests/sql/query/field_qualified_multi</a></b>
<a href="#h54-0" id="h54-0" class="h">@@ -48,12 +48,12 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h54-0-3" id="h54-0-3" class="d">-                alias: None,
</a><a href="#h54-0-4" id="h54-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h54-0-9" id="h54-0-9" class="d">-                alias: None,
</a><a href="#h54-0-10" id="h54-0-10" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h54-1" id="h54-1" class="h">@@ -66,16 +66,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h54-1-3" id="h54-1-3" class="i">+                0,
</a>                 Some(
<a href="#h54-1-5" id="h54-1-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h54-1-6" id="h54-1-6" class="i">+                    (
</a><a href="#h54-1-7" id="h54-1-7" class="i">+                        Some(
</a><a href="#h54-1-8" id="h54-1-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h54-1-9" id="h54-1-9" class="i">+                        ),
</a><a href="#h54-1-10" id="h54-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h54-1-11" id="h54-1-11" class="i">+                    ),
</a>                 ),
<a href="#h54-1-13" id="h54-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h54-1-16" id="h54-1-16" class="i">+                7,
</a>                 Some(
<a href="#h54-1-18" id="h54-1-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h54-1-19" id="h54-1-19" class="i">+                    (
</a><a href="#h54-1-20" id="h54-1-20" class="i">+                        Some(
</a><a href="#h54-1-21" id="h54-1-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h54-1-22" id="h54-1-22" class="i">+                        ),
</a><a href="#h54-1-23" id="h54-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h54-1-24" id="h54-1-24" class="i">+                    ),
</a>                 ),
<a href="#h54-1-26" id="h54-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h54-2" id="h54-2" class="h">@@ -86,12 +96,12 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h54-2-3" id="h54-2-3" class="d">-                alias: None,
</a><a href="#h54-2-4" id="h54-2-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h54-2-9" id="h54-2-9" class="d">-                alias: None,
</a><a href="#h54-2-10" id="h54-2-10" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h54-3" id="h54-3" class="h">@@ -104,16 +114,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h54-3-3" id="h54-3-3" class="i">+                0,
</a>                 Some(
<a href="#h54-3-5" id="h54-3-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h54-3-6" id="h54-3-6" class="i">+                    (
</a><a href="#h54-3-7" id="h54-3-7" class="i">+                        Some(
</a><a href="#h54-3-8" id="h54-3-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h54-3-9" id="h54-3-9" class="i">+                        ),
</a><a href="#h54-3-10" id="h54-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h54-3-11" id="h54-3-11" class="i">+                    ),
</a>                 ),
<a href="#h54-3-13" id="h54-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h54-3-16" id="h54-3-16" class="i">+                7,
</a>                 Some(
<a href="#h54-3-18" id="h54-3-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h54-3-19" id="h54-3-19" class="i">+                    (
</a><a href="#h54-3-20" id="h54-3-20" class="i">+                        Some(
</a><a href="#h54-3-21" id="h54-3-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h54-3-22" id="h54-3-22" class="i">+                        ),
</a><a href="#h54-3-23" id="h54-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h54-3-24" id="h54-3-24" class="i">+                    ),
</a>                 ),
<a href="#h54-3-26" id="h54-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h55" href="../file/tests/sql/query/field_single.html">tests/sql/query/field_single</a> b/<a href="../file/tests/sql/query/field_single.html">tests/sql/query/field_single</a></b>
<a href="#h55-0" id="h55-0" class="h">@@ -34,7 +34,7 @@ Plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h55-0-3" id="h55-0-3" class="d">-            alias: None,
</a><a href="#h55-0-4" id="h55-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h55-1" id="h55-1" class="h">@@ -42,8 +42,13 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h55-1-3" id="h55-1-3" class="d">-                None,
</a><a href="#h55-1-4" id="h55-1-4" class="d">-                &quot;id&quot;,
</a><a href="#h55-1-5" id="h55-1-5" class="i">+                0,
</a><a href="#h55-1-6" id="h55-1-6" class="i">+                Some(
</a><a href="#h55-1-7" id="h55-1-7" class="i">+                    (
</a><a href="#h55-1-8" id="h55-1-8" class="i">+                        None,
</a><a href="#h55-1-9" id="h55-1-9" class="i">+                        &quot;id&quot;,
</a><a href="#h55-1-10" id="h55-1-10" class="i">+                    ),
</a><a href="#h55-1-11" id="h55-1-11" class="i">+                ),
</a>             ),
         ],
     },
<a href="#h55-2" id="h55-2" class="h">@@ -53,7 +58,7 @@ Optimized plan: Plan(
</a>     Projection {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h55-2-3" id="h55-2-3" class="d">-            alias: None,
</a><a href="#h55-2-4" id="h55-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         labels: [
<a href="#h55-3" id="h55-3" class="h">@@ -61,8 +66,13 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h55-3-3" id="h55-3-3" class="d">-                None,
</a><a href="#h55-3-4" id="h55-3-4" class="d">-                &quot;id&quot;,
</a><a href="#h55-3-5" id="h55-3-5" class="i">+                0,
</a><a href="#h55-3-6" id="h55-3-6" class="i">+                Some(
</a><a href="#h55-3-7" id="h55-3-7" class="i">+                    (
</a><a href="#h55-3-8" id="h55-3-8" class="i">+                        None,
</a><a href="#h55-3-9" id="h55-3-9" class="i">+                        &quot;id&quot;,
</a><a href="#h55-3-10" id="h55-3-10" class="i">+                    ),
</a><a href="#h55-3-11" id="h55-3-11" class="i">+                ),
</a>             ),
         ],
     },
<b>diff --git a/<a id="h56" href="../file/tests/sql/query/field_unknown.html">tests/sql/query/field_unknown</a> b/<a href="../file/tests/sql/query/field_unknown.html">tests/sql/query/field_unknown</a></b>
<a href="#h56-0" id="h56-0" class="h">@@ -30,44 +30,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h56-0-3" id="h56-0-3" class="d">-Plan: Plan(
</a><a href="#h56-0-4" id="h56-0-4" class="d">-    Projection {
</a><a href="#h56-0-5" id="h56-0-5" class="d">-        source: Scan {
</a><a href="#h56-0-6" id="h56-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h56-0-7" id="h56-0-7" class="d">-            alias: None,
</a><a href="#h56-0-8" id="h56-0-8" class="d">-            filter: None,
</a><a href="#h56-0-9" id="h56-0-9" class="d">-        },
</a><a href="#h56-0-10" id="h56-0-10" class="d">-        labels: [
</a><a href="#h56-0-11" id="h56-0-11" class="d">-            None,
</a><a href="#h56-0-12" id="h56-0-12" class="d">-        ],
</a><a href="#h56-0-13" id="h56-0-13" class="d">-        expressions: [
</a><a href="#h56-0-14" id="h56-0-14" class="d">-            Field(
</a><a href="#h56-0-15" id="h56-0-15" class="d">-                None,
</a><a href="#h56-0-16" id="h56-0-16" class="d">-                &quot;unknown&quot;,
</a><a href="#h56-0-17" id="h56-0-17" class="d">-            ),
</a><a href="#h56-0-18" id="h56-0-18" class="d">-        ],
</a><a href="#h56-0-19" id="h56-0-19" class="d">-    },
</a><a href="#h56-0-20" id="h56-0-20" class="d">-)
</a><a href="#h56-0-21" id="h56-0-21" class="d">-
</a><a href="#h56-0-22" id="h56-0-22" class="d">-Optimized plan: Plan(
</a><a href="#h56-0-23" id="h56-0-23" class="d">-    Projection {
</a><a href="#h56-0-24" id="h56-0-24" class="d">-        source: Scan {
</a><a href="#h56-0-25" id="h56-0-25" class="d">-            table: &quot;movies&quot;,
</a><a href="#h56-0-26" id="h56-0-26" class="d">-            alias: None,
</a><a href="#h56-0-27" id="h56-0-27" class="d">-            filter: None,
</a><a href="#h56-0-28" id="h56-0-28" class="d">-        },
</a><a href="#h56-0-29" id="h56-0-29" class="d">-        labels: [
</a><a href="#h56-0-30" id="h56-0-30" class="d">-            None,
</a><a href="#h56-0-31" id="h56-0-31" class="d">-        ],
</a><a href="#h56-0-32" id="h56-0-32" class="d">-        expressions: [
</a><a href="#h56-0-33" id="h56-0-33" class="d">-            Field(
</a><a href="#h56-0-34" id="h56-0-34" class="d">-                None,
</a><a href="#h56-0-35" id="h56-0-35" class="d">-                &quot;unknown&quot;,
</a><a href="#h56-0-36" id="h56-0-36" class="d">-            ),
</a><a href="#h56-0-37" id="h56-0-37" class="d">-        ],
</a><a href="#h56-0-38" id="h56-0-38" class="d">-    },
</a><a href="#h56-0-39" id="h56-0-39" class="d">-)
</a><a href="#h56-0-40" id="h56-0-40" class="d">-
</a><a href="#h56-0-41" id="h56-0-41" class="d">-Query: SELECT unknown FROM movies
</a><a href="#h56-0-42" id="h56-0-42" class="d">-
</a><a href="#h56-0-43" id="h56-0-43" class="d">-Result: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h56-0-44" id="h56-0-44" class="d">-\ No newline at end of file
</a><a href="#h56-0-45" id="h56-0-45" class="i">+Plan: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h56-0-46" id="h56-0-46" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h57" href="../file/tests/sql/query/field_unknown_aliased.html">tests/sql/query/field_unknown_aliased</a> b/<a href="../file/tests/sql/query/field_unknown_aliased.html">tests/sql/query/field_unknown_aliased</a></b>
<a href="#h57-0" id="h57-0" class="h">@@ -34,52 +34,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h57-0-3" id="h57-0-3" class="d">-Plan: Plan(
</a><a href="#h57-0-4" id="h57-0-4" class="d">-    Projection {
</a><a href="#h57-0-5" id="h57-0-5" class="d">-        source: Scan {
</a><a href="#h57-0-6" id="h57-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h57-0-7" id="h57-0-7" class="d">-            alias: Some(
</a><a href="#h57-0-8" id="h57-0-8" class="d">-                &quot;m&quot;,
</a><a href="#h57-0-9" id="h57-0-9" class="d">-            ),
</a><a href="#h57-0-10" id="h57-0-10" class="d">-            filter: None,
</a><a href="#h57-0-11" id="h57-0-11" class="d">-        },
</a><a href="#h57-0-12" id="h57-0-12" class="d">-        labels: [
</a><a href="#h57-0-13" id="h57-0-13" class="d">-            None,
</a><a href="#h57-0-14" id="h57-0-14" class="d">-        ],
</a><a href="#h57-0-15" id="h57-0-15" class="d">-        expressions: [
</a><a href="#h57-0-16" id="h57-0-16" class="d">-            Field(
</a><a href="#h57-0-17" id="h57-0-17" class="d">-                Some(
</a><a href="#h57-0-18" id="h57-0-18" class="d">-                    &quot;movies&quot;,
</a><a href="#h57-0-19" id="h57-0-19" class="d">-                ),
</a><a href="#h57-0-20" id="h57-0-20" class="d">-                &quot;id&quot;,
</a><a href="#h57-0-21" id="h57-0-21" class="d">-            ),
</a><a href="#h57-0-22" id="h57-0-22" class="d">-        ],
</a><a href="#h57-0-23" id="h57-0-23" class="d">-    },
</a><a href="#h57-0-24" id="h57-0-24" class="d">-)
</a><a href="#h57-0-25" id="h57-0-25" class="d">-
</a><a href="#h57-0-26" id="h57-0-26" class="d">-Optimized plan: Plan(
</a><a href="#h57-0-27" id="h57-0-27" class="d">-    Projection {
</a><a href="#h57-0-28" id="h57-0-28" class="d">-        source: Scan {
</a><a href="#h57-0-29" id="h57-0-29" class="d">-            table: &quot;movies&quot;,
</a><a href="#h57-0-30" id="h57-0-30" class="d">-            alias: Some(
</a><a href="#h57-0-31" id="h57-0-31" class="d">-                &quot;m&quot;,
</a><a href="#h57-0-32" id="h57-0-32" class="d">-            ),
</a><a href="#h57-0-33" id="h57-0-33" class="d">-            filter: None,
</a><a href="#h57-0-34" id="h57-0-34" class="d">-        },
</a><a href="#h57-0-35" id="h57-0-35" class="d">-        labels: [
</a><a href="#h57-0-36" id="h57-0-36" class="d">-            None,
</a><a href="#h57-0-37" id="h57-0-37" class="d">-        ],
</a><a href="#h57-0-38" id="h57-0-38" class="d">-        expressions: [
</a><a href="#h57-0-39" id="h57-0-39" class="d">-            Field(
</a><a href="#h57-0-40" id="h57-0-40" class="d">-                Some(
</a><a href="#h57-0-41" id="h57-0-41" class="d">-                    &quot;movies&quot;,
</a><a href="#h57-0-42" id="h57-0-42" class="d">-                ),
</a><a href="#h57-0-43" id="h57-0-43" class="d">-                &quot;id&quot;,
</a><a href="#h57-0-44" id="h57-0-44" class="d">-            ),
</a><a href="#h57-0-45" id="h57-0-45" class="d">-        ],
</a><a href="#h57-0-46" id="h57-0-46" class="d">-    },
</a><a href="#h57-0-47" id="h57-0-47" class="d">-)
</a><a href="#h57-0-48" id="h57-0-48" class="d">-
</a><a href="#h57-0-49" id="h57-0-49" class="d">-Query: SELECT movies.id FROM movies AS m
</a><a href="#h57-0-50" id="h57-0-50" class="d">-
</a><a href="#h57-0-51" id="h57-0-51" class="d">-Result: Value(&quot;Unknown field movies.id&quot;)
</a><a href="#h57-0-52" id="h57-0-52" class="d">-\ No newline at end of file
</a><a href="#h57-0-53" id="h57-0-53" class="i">+Plan: Value(&quot;Unknown table movies&quot;)
</a><a href="#h57-0-54" id="h57-0-54" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h58" href="../file/tests/sql/query/field_unknown_qualified.html">tests/sql/query/field_unknown_qualified</a> b/<a href="../file/tests/sql/query/field_unknown_qualified.html">tests/sql/query/field_unknown_qualified</a></b>
<a href="#h58-0" id="h58-0" class="h">@@ -32,48 +32,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h58-0-3" id="h58-0-3" class="d">-Plan: Plan(
</a><a href="#h58-0-4" id="h58-0-4" class="d">-    Projection {
</a><a href="#h58-0-5" id="h58-0-5" class="d">-        source: Scan {
</a><a href="#h58-0-6" id="h58-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h58-0-7" id="h58-0-7" class="d">-            alias: None,
</a><a href="#h58-0-8" id="h58-0-8" class="d">-            filter: None,
</a><a href="#h58-0-9" id="h58-0-9" class="d">-        },
</a><a href="#h58-0-10" id="h58-0-10" class="d">-        labels: [
</a><a href="#h58-0-11" id="h58-0-11" class="d">-            None,
</a><a href="#h58-0-12" id="h58-0-12" class="d">-        ],
</a><a href="#h58-0-13" id="h58-0-13" class="d">-        expressions: [
</a><a href="#h58-0-14" id="h58-0-14" class="d">-            Field(
</a><a href="#h58-0-15" id="h58-0-15" class="d">-                Some(
</a><a href="#h58-0-16" id="h58-0-16" class="d">-                    &quot;movies&quot;,
</a><a href="#h58-0-17" id="h58-0-17" class="d">-                ),
</a><a href="#h58-0-18" id="h58-0-18" class="d">-                &quot;unknown&quot;,
</a><a href="#h58-0-19" id="h58-0-19" class="d">-            ),
</a><a href="#h58-0-20" id="h58-0-20" class="d">-        ],
</a><a href="#h58-0-21" id="h58-0-21" class="d">-    },
</a><a href="#h58-0-22" id="h58-0-22" class="d">-)
</a><a href="#h58-0-23" id="h58-0-23" class="d">-
</a><a href="#h58-0-24" id="h58-0-24" class="d">-Optimized plan: Plan(
</a><a href="#h58-0-25" id="h58-0-25" class="d">-    Projection {
</a><a href="#h58-0-26" id="h58-0-26" class="d">-        source: Scan {
</a><a href="#h58-0-27" id="h58-0-27" class="d">-            table: &quot;movies&quot;,
</a><a href="#h58-0-28" id="h58-0-28" class="d">-            alias: None,
</a><a href="#h58-0-29" id="h58-0-29" class="d">-            filter: None,
</a><a href="#h58-0-30" id="h58-0-30" class="d">-        },
</a><a href="#h58-0-31" id="h58-0-31" class="d">-        labels: [
</a><a href="#h58-0-32" id="h58-0-32" class="d">-            None,
</a><a href="#h58-0-33" id="h58-0-33" class="d">-        ],
</a><a href="#h58-0-34" id="h58-0-34" class="d">-        expressions: [
</a><a href="#h58-0-35" id="h58-0-35" class="d">-            Field(
</a><a href="#h58-0-36" id="h58-0-36" class="d">-                Some(
</a><a href="#h58-0-37" id="h58-0-37" class="d">-                    &quot;movies&quot;,
</a><a href="#h58-0-38" id="h58-0-38" class="d">-                ),
</a><a href="#h58-0-39" id="h58-0-39" class="d">-                &quot;unknown&quot;,
</a><a href="#h58-0-40" id="h58-0-40" class="d">-            ),
</a><a href="#h58-0-41" id="h58-0-41" class="d">-        ],
</a><a href="#h58-0-42" id="h58-0-42" class="d">-    },
</a><a href="#h58-0-43" id="h58-0-43" class="d">-)
</a><a href="#h58-0-44" id="h58-0-44" class="d">-
</a><a href="#h58-0-45" id="h58-0-45" class="d">-Query: SELECT movies.unknown FROM movies
</a><a href="#h58-0-46" id="h58-0-46" class="d">-
</a><a href="#h58-0-47" id="h58-0-47" class="d">-Result: Value(&quot;Unknown field movies.unknown&quot;)
</a><a href="#h58-0-48" id="h58-0-48" class="d">-\ No newline at end of file
</a><a href="#h58-0-49" id="h58-0-49" class="i">+Plan: Value(&quot;Unknown field movies.unknown&quot;)
</a><a href="#h58-0-50" id="h58-0-50" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h59" href="../file/tests/sql/query/field_unknown_table.html">tests/sql/query/field_unknown_table</a> b/<a href="../file/tests/sql/query/field_unknown_table.html">tests/sql/query/field_unknown_table</a></b>
<a href="#h59-0" id="h59-0" class="h">@@ -32,48 +32,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h59-0-3" id="h59-0-3" class="d">-Plan: Plan(
</a><a href="#h59-0-4" id="h59-0-4" class="d">-    Projection {
</a><a href="#h59-0-5" id="h59-0-5" class="d">-        source: Scan {
</a><a href="#h59-0-6" id="h59-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h59-0-7" id="h59-0-7" class="d">-            alias: None,
</a><a href="#h59-0-8" id="h59-0-8" class="d">-            filter: None,
</a><a href="#h59-0-9" id="h59-0-9" class="d">-        },
</a><a href="#h59-0-10" id="h59-0-10" class="d">-        labels: [
</a><a href="#h59-0-11" id="h59-0-11" class="d">-            None,
</a><a href="#h59-0-12" id="h59-0-12" class="d">-        ],
</a><a href="#h59-0-13" id="h59-0-13" class="d">-        expressions: [
</a><a href="#h59-0-14" id="h59-0-14" class="d">-            Field(
</a><a href="#h59-0-15" id="h59-0-15" class="d">-                Some(
</a><a href="#h59-0-16" id="h59-0-16" class="d">-                    &quot;unknown&quot;,
</a><a href="#h59-0-17" id="h59-0-17" class="d">-                ),
</a><a href="#h59-0-18" id="h59-0-18" class="d">-                &quot;id&quot;,
</a><a href="#h59-0-19" id="h59-0-19" class="d">-            ),
</a><a href="#h59-0-20" id="h59-0-20" class="d">-        ],
</a><a href="#h59-0-21" id="h59-0-21" class="d">-    },
</a><a href="#h59-0-22" id="h59-0-22" class="d">-)
</a><a href="#h59-0-23" id="h59-0-23" class="d">-
</a><a href="#h59-0-24" id="h59-0-24" class="d">-Optimized plan: Plan(
</a><a href="#h59-0-25" id="h59-0-25" class="d">-    Projection {
</a><a href="#h59-0-26" id="h59-0-26" class="d">-        source: Scan {
</a><a href="#h59-0-27" id="h59-0-27" class="d">-            table: &quot;movies&quot;,
</a><a href="#h59-0-28" id="h59-0-28" class="d">-            alias: None,
</a><a href="#h59-0-29" id="h59-0-29" class="d">-            filter: None,
</a><a href="#h59-0-30" id="h59-0-30" class="d">-        },
</a><a href="#h59-0-31" id="h59-0-31" class="d">-        labels: [
</a><a href="#h59-0-32" id="h59-0-32" class="d">-            None,
</a><a href="#h59-0-33" id="h59-0-33" class="d">-        ],
</a><a href="#h59-0-34" id="h59-0-34" class="d">-        expressions: [
</a><a href="#h59-0-35" id="h59-0-35" class="d">-            Field(
</a><a href="#h59-0-36" id="h59-0-36" class="d">-                Some(
</a><a href="#h59-0-37" id="h59-0-37" class="d">-                    &quot;unknown&quot;,
</a><a href="#h59-0-38" id="h59-0-38" class="d">-                ),
</a><a href="#h59-0-39" id="h59-0-39" class="d">-                &quot;id&quot;,
</a><a href="#h59-0-40" id="h59-0-40" class="d">-            ),
</a><a href="#h59-0-41" id="h59-0-41" class="d">-        ],
</a><a href="#h59-0-42" id="h59-0-42" class="d">-    },
</a><a href="#h59-0-43" id="h59-0-43" class="d">-)
</a><a href="#h59-0-44" id="h59-0-44" class="d">-
</a><a href="#h59-0-45" id="h59-0-45" class="d">-Query: SELECT unknown.id FROM movies
</a><a href="#h59-0-46" id="h59-0-46" class="d">-
</a><a href="#h59-0-47" id="h59-0-47" class="d">-Result: Value(&quot;Unknown field unknown.id&quot;)
</a><a href="#h59-0-48" id="h59-0-48" class="d">-\ No newline at end of file
</a><a href="#h59-0-49" id="h59-0-49" class="i">+Plan: Value(&quot;Unknown table unknown&quot;)
</a><a href="#h59-0-50" id="h59-0-50" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h60" href="../file/tests/sql/query/from_alias_duplicate.html">tests/sql/query/from_alias_duplicate</a> b/<a href="../file/tests/sql/query/from_alias_duplicate.html">tests/sql/query/from_alias_duplicate</a></b>
<a href="#h60-0" id="h60-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h60-0-0" id="h60-0-0" class="i">+Query: SELECT * FROM movies a, genres a
</a><a href="#h60-0-1" id="h60-0-1" class="i">+
</a><a href="#h60-0-2" id="h60-0-2" class="i">+AST: Select {
</a><a href="#h60-0-3" id="h60-0-3" class="i">+    select: SelectClause {
</a><a href="#h60-0-4" id="h60-0-4" class="i">+        expressions: [],
</a><a href="#h60-0-5" id="h60-0-5" class="i">+        labels: [],
</a><a href="#h60-0-6" id="h60-0-6" class="i">+    },
</a><a href="#h60-0-7" id="h60-0-7" class="i">+    from: Some(
</a><a href="#h60-0-8" id="h60-0-8" class="i">+        FromClause {
</a><a href="#h60-0-9" id="h60-0-9" class="i">+            items: [
</a><a href="#h60-0-10" id="h60-0-10" class="i">+                Table {
</a><a href="#h60-0-11" id="h60-0-11" class="i">+                    name: &quot;movies&quot;,
</a><a href="#h60-0-12" id="h60-0-12" class="i">+                    alias: Some(
</a><a href="#h60-0-13" id="h60-0-13" class="i">+                        &quot;a&quot;,
</a><a href="#h60-0-14" id="h60-0-14" class="i">+                    ),
</a><a href="#h60-0-15" id="h60-0-15" class="i">+                },
</a><a href="#h60-0-16" id="h60-0-16" class="i">+                Table {
</a><a href="#h60-0-17" id="h60-0-17" class="i">+                    name: &quot;genres&quot;,
</a><a href="#h60-0-18" id="h60-0-18" class="i">+                    alias: Some(
</a><a href="#h60-0-19" id="h60-0-19" class="i">+                        &quot;a&quot;,
</a><a href="#h60-0-20" id="h60-0-20" class="i">+                    ),
</a><a href="#h60-0-21" id="h60-0-21" class="i">+                },
</a><a href="#h60-0-22" id="h60-0-22" class="i">+            ],
</a><a href="#h60-0-23" id="h60-0-23" class="i">+        },
</a><a href="#h60-0-24" id="h60-0-24" class="i">+    ),
</a><a href="#h60-0-25" id="h60-0-25" class="i">+    where: None,
</a><a href="#h60-0-26" id="h60-0-26" class="i">+    group_by: None,
</a><a href="#h60-0-27" id="h60-0-27" class="i">+    having: None,
</a><a href="#h60-0-28" id="h60-0-28" class="i">+    order: [],
</a><a href="#h60-0-29" id="h60-0-29" class="i">+    limit: None,
</a><a href="#h60-0-30" id="h60-0-30" class="i">+    offset: None,
</a><a href="#h60-0-31" id="h60-0-31" class="i">+}
</a><a href="#h60-0-32" id="h60-0-32" class="i">+
</a><a href="#h60-0-33" id="h60-0-33" class="i">+Plan: Value(&quot;Duplicate table name a&quot;)
</a><a href="#h60-0-34" id="h60-0-34" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h61" href="../file/tests/sql/query/from_alias_duplicate_join.html">tests/sql/query/from_alias_duplicate_join</a> b/<a href="../file/tests/sql/query/from_alias_duplicate_join.html">tests/sql/query/from_alias_duplicate_join</a></b>
<a href="#h61-0" id="h61-0" class="h">@@ -0,0 +1,44 @@
</a><a href="#h61-0-0" id="h61-0-0" class="i">+Query: SELECT * FROM movies a JOIN genres a ON TRUE
</a><a href="#h61-0-1" id="h61-0-1" class="i">+
</a><a href="#h61-0-2" id="h61-0-2" class="i">+AST: Select {
</a><a href="#h61-0-3" id="h61-0-3" class="i">+    select: SelectClause {
</a><a href="#h61-0-4" id="h61-0-4" class="i">+        expressions: [],
</a><a href="#h61-0-5" id="h61-0-5" class="i">+        labels: [],
</a><a href="#h61-0-6" id="h61-0-6" class="i">+    },
</a><a href="#h61-0-7" id="h61-0-7" class="i">+    from: Some(
</a><a href="#h61-0-8" id="h61-0-8" class="i">+        FromClause {
</a><a href="#h61-0-9" id="h61-0-9" class="i">+            items: [
</a><a href="#h61-0-10" id="h61-0-10" class="i">+                Join {
</a><a href="#h61-0-11" id="h61-0-11" class="i">+                    left: Table {
</a><a href="#h61-0-12" id="h61-0-12" class="i">+                        name: &quot;movies&quot;,
</a><a href="#h61-0-13" id="h61-0-13" class="i">+                        alias: Some(
</a><a href="#h61-0-14" id="h61-0-14" class="i">+                            &quot;a&quot;,
</a><a href="#h61-0-15" id="h61-0-15" class="i">+                        ),
</a><a href="#h61-0-16" id="h61-0-16" class="i">+                    },
</a><a href="#h61-0-17" id="h61-0-17" class="i">+                    right: Table {
</a><a href="#h61-0-18" id="h61-0-18" class="i">+                        name: &quot;genres&quot;,
</a><a href="#h61-0-19" id="h61-0-19" class="i">+                        alias: Some(
</a><a href="#h61-0-20" id="h61-0-20" class="i">+                            &quot;a&quot;,
</a><a href="#h61-0-21" id="h61-0-21" class="i">+                        ),
</a><a href="#h61-0-22" id="h61-0-22" class="i">+                    },
</a><a href="#h61-0-23" id="h61-0-23" class="i">+                    type: Inner,
</a><a href="#h61-0-24" id="h61-0-24" class="i">+                    predicate: Some(
</a><a href="#h61-0-25" id="h61-0-25" class="i">+                        Literal(
</a><a href="#h61-0-26" id="h61-0-26" class="i">+                            Boolean(
</a><a href="#h61-0-27" id="h61-0-27" class="i">+                                true,
</a><a href="#h61-0-28" id="h61-0-28" class="i">+                            ),
</a><a href="#h61-0-29" id="h61-0-29" class="i">+                        ),
</a><a href="#h61-0-30" id="h61-0-30" class="i">+                    ),
</a><a href="#h61-0-31" id="h61-0-31" class="i">+                },
</a><a href="#h61-0-32" id="h61-0-32" class="i">+            ],
</a><a href="#h61-0-33" id="h61-0-33" class="i">+        },
</a><a href="#h61-0-34" id="h61-0-34" class="i">+    ),
</a><a href="#h61-0-35" id="h61-0-35" class="i">+    where: None,
</a><a href="#h61-0-36" id="h61-0-36" class="i">+    group_by: None,
</a><a href="#h61-0-37" id="h61-0-37" class="i">+    having: None,
</a><a href="#h61-0-38" id="h61-0-38" class="i">+    order: [],
</a><a href="#h61-0-39" id="h61-0-39" class="i">+    limit: None,
</a><a href="#h61-0-40" id="h61-0-40" class="i">+    offset: None,
</a><a href="#h61-0-41" id="h61-0-41" class="i">+}
</a><a href="#h61-0-42" id="h61-0-42" class="i">+
</a><a href="#h61-0-43" id="h61-0-43" class="i">+Plan: Value(&quot;Duplicate table name a&quot;)
</a><a href="#h61-0-44" id="h61-0-44" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h62" href="../file/tests/sql/query/from_duplicate.html">tests/sql/query/from_duplicate</a> b/<a href="../file/tests/sql/query/from_duplicate.html">tests/sql/query/from_duplicate</a></b>
<a href="#h62-0" id="h62-0" class="h">@@ -0,0 +1,30 @@
</a><a href="#h62-0-0" id="h62-0-0" class="i">+Query: SELECT * FROM movies, movies
</a><a href="#h62-0-1" id="h62-0-1" class="i">+
</a><a href="#h62-0-2" id="h62-0-2" class="i">+AST: Select {
</a><a href="#h62-0-3" id="h62-0-3" class="i">+    select: SelectClause {
</a><a href="#h62-0-4" id="h62-0-4" class="i">+        expressions: [],
</a><a href="#h62-0-5" id="h62-0-5" class="i">+        labels: [],
</a><a href="#h62-0-6" id="h62-0-6" class="i">+    },
</a><a href="#h62-0-7" id="h62-0-7" class="i">+    from: Some(
</a><a href="#h62-0-8" id="h62-0-8" class="i">+        FromClause {
</a><a href="#h62-0-9" id="h62-0-9" class="i">+            items: [
</a><a href="#h62-0-10" id="h62-0-10" class="i">+                Table {
</a><a href="#h62-0-11" id="h62-0-11" class="i">+                    name: &quot;movies&quot;,
</a><a href="#h62-0-12" id="h62-0-12" class="i">+                    alias: None,
</a><a href="#h62-0-13" id="h62-0-13" class="i">+                },
</a><a href="#h62-0-14" id="h62-0-14" class="i">+                Table {
</a><a href="#h62-0-15" id="h62-0-15" class="i">+                    name: &quot;movies&quot;,
</a><a href="#h62-0-16" id="h62-0-16" class="i">+                    alias: None,
</a><a href="#h62-0-17" id="h62-0-17" class="i">+                },
</a><a href="#h62-0-18" id="h62-0-18" class="i">+            ],
</a><a href="#h62-0-19" id="h62-0-19" class="i">+        },
</a><a href="#h62-0-20" id="h62-0-20" class="i">+    ),
</a><a href="#h62-0-21" id="h62-0-21" class="i">+    where: None,
</a><a href="#h62-0-22" id="h62-0-22" class="i">+    group_by: None,
</a><a href="#h62-0-23" id="h62-0-23" class="i">+    having: None,
</a><a href="#h62-0-24" id="h62-0-24" class="i">+    order: [],
</a><a href="#h62-0-25" id="h62-0-25" class="i">+    limit: None,
</a><a href="#h62-0-26" id="h62-0-26" class="i">+    offset: None,
</a><a href="#h62-0-27" id="h62-0-27" class="i">+}
</a><a href="#h62-0-28" id="h62-0-28" class="i">+
</a><a href="#h62-0-29" id="h62-0-29" class="i">+Plan: Value(&quot;Duplicate table name movies&quot;)
</a><a href="#h62-0-30" id="h62-0-30" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h63" href="../file/tests/sql/query/from_multiple.html">tests/sql/query/from_multiple</a> b/<a href="../file/tests/sql/query/from_multiple.html">tests/sql/query/from_multiple</a></b>
<a href="#h63-0" id="h63-0" class="h">@@ -33,26 +33,26 @@ AST: Select {
</a> 
 Plan: Plan(
     NestedLoopJoin {
<a href="#h63-0-3" id="h63-0-3" class="d">-        outer: Scan {
</a><a href="#h63-0-4" id="h63-0-4" class="d">-            table: &quot;movies&quot;,
</a><a href="#h63-0-5" id="h63-0-5" class="d">-            alias: None,
</a><a href="#h63-0-6" id="h63-0-6" class="d">-            filter: None,
</a><a href="#h63-0-7" id="h63-0-7" class="d">-        },
</a><a href="#h63-0-8" id="h63-0-8" class="d">-        inner: NestedLoopJoin {
</a><a href="#h63-0-9" id="h63-0-9" class="i">+        outer: NestedLoopJoin {
</a>             outer: Scan {
<a href="#h63-0-11" id="h63-0-11" class="d">-                table: &quot;genres&quot;,
</a><a href="#h63-0-12" id="h63-0-12" class="d">-                alias: None,
</a><a href="#h63-0-13" id="h63-0-13" class="i">+                table: &quot;movies&quot;,
</a><a href="#h63-0-14" id="h63-0-14" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
<a href="#h63-0-18" id="h63-0-18" class="d">-                table: &quot;countries&quot;,
</a><a href="#h63-0-19" id="h63-0-19" class="d">-                alias: None,
</a><a href="#h63-0-20" id="h63-0-20" class="i">+                table: &quot;genres&quot;,
</a><a href="#h63-0-21" id="h63-0-21" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: None,
             pad: false,
             flip: false,
         },
<a href="#h63-0-28" id="h63-0-28" class="i">+        inner: Scan {
</a><a href="#h63-0-29" id="h63-0-29" class="i">+            table: &quot;countries&quot;,
</a><a href="#h63-0-30" id="h63-0-30" class="i">+            label: &quot;countries&quot;,
</a><a href="#h63-0-31" id="h63-0-31" class="i">+            filter: None,
</a><a href="#h63-0-32" id="h63-0-32" class="i">+        },
</a>         predicate: None,
         pad: false,
         flip: false,
<a href="#h63-1" id="h63-1" class="h">@@ -61,26 +61,26 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     NestedLoopJoin {
<a href="#h63-1-3" id="h63-1-3" class="d">-        outer: Scan {
</a><a href="#h63-1-4" id="h63-1-4" class="d">-            table: &quot;movies&quot;,
</a><a href="#h63-1-5" id="h63-1-5" class="d">-            alias: None,
</a><a href="#h63-1-6" id="h63-1-6" class="d">-            filter: None,
</a><a href="#h63-1-7" id="h63-1-7" class="d">-        },
</a><a href="#h63-1-8" id="h63-1-8" class="d">-        inner: NestedLoopJoin {
</a><a href="#h63-1-9" id="h63-1-9" class="i">+        outer: NestedLoopJoin {
</a>             outer: Scan {
<a href="#h63-1-11" id="h63-1-11" class="d">-                table: &quot;genres&quot;,
</a><a href="#h63-1-12" id="h63-1-12" class="d">-                alias: None,
</a><a href="#h63-1-13" id="h63-1-13" class="i">+                table: &quot;movies&quot;,
</a><a href="#h63-1-14" id="h63-1-14" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
<a href="#h63-1-18" id="h63-1-18" class="d">-                table: &quot;countries&quot;,
</a><a href="#h63-1-19" id="h63-1-19" class="d">-                alias: None,
</a><a href="#h63-1-20" id="h63-1-20" class="i">+                table: &quot;genres&quot;,
</a><a href="#h63-1-21" id="h63-1-21" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: None,
             pad: false,
             flip: false,
         },
<a href="#h63-1-28" id="h63-1-28" class="i">+        inner: Scan {
</a><a href="#h63-1-29" id="h63-1-29" class="i">+            table: &quot;countries&quot;,
</a><a href="#h63-1-30" id="h63-1-30" class="i">+            label: &quot;countries&quot;,
</a><a href="#h63-1-31" id="h63-1-31" class="i">+            filter: None,
</a><a href="#h63-1-32" id="h63-1-32" class="i">+        },
</a>         predicate: None,
         pad: false,
         flip: false,
<b>diff --git a/<a id="h64" href="../file/tests/sql/query/from_unknown.html">tests/sql/query/from_unknown</a> b/<a href="../file/tests/sql/query/from_unknown.html">tests/sql/query/from_unknown</a></b>
<a href="#h64-0" id="h64-0" class="h">@@ -23,22 +23,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h64-0-3" id="h64-0-3" class="d">-Plan: Plan(
</a><a href="#h64-0-4" id="h64-0-4" class="d">-    Scan {
</a><a href="#h64-0-5" id="h64-0-5" class="d">-        table: &quot;unknown&quot;,
</a><a href="#h64-0-6" id="h64-0-6" class="d">-        alias: None,
</a><a href="#h64-0-7" id="h64-0-7" class="d">-        filter: None,
</a><a href="#h64-0-8" id="h64-0-8" class="d">-    },
</a><a href="#h64-0-9" id="h64-0-9" class="d">-)
</a><a href="#h64-0-10" id="h64-0-10" class="d">-
</a><a href="#h64-0-11" id="h64-0-11" class="d">-Optimized plan: Plan(
</a><a href="#h64-0-12" id="h64-0-12" class="d">-    Scan {
</a><a href="#h64-0-13" id="h64-0-13" class="d">-        table: &quot;unknown&quot;,
</a><a href="#h64-0-14" id="h64-0-14" class="d">-        alias: None,
</a><a href="#h64-0-15" id="h64-0-15" class="d">-        filter: None,
</a><a href="#h64-0-16" id="h64-0-16" class="d">-    },
</a><a href="#h64-0-17" id="h64-0-17" class="d">-)
</a><a href="#h64-0-18" id="h64-0-18" class="d">-
</a><a href="#h64-0-19" id="h64-0-19" class="d">-Query: SELECT * FROM unknown
</a><a href="#h64-0-20" id="h64-0-20" class="d">-
</a><a href="#h64-0-21" id="h64-0-21" class="d">-Result: Value(&quot;Table unknown does not exist&quot;)
</a><a href="#h64-0-22" id="h64-0-22" class="d">-\ No newline at end of file
</a><a href="#h64-0-23" id="h64-0-23" class="i">+Plan: Value(&quot;Table unknown does not exist&quot;)
</a><a href="#h64-0-24" id="h64-0-24" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h65" href="../file/tests/sql/query/group_expr.html">tests/sql/query/group_expr</a> b/<a href="../file/tests/sql/query/group_expr.html">tests/sql/query/group_expr</a></b>
<a href="#h65-0" id="h65-0" class="h">@@ -70,7 +70,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h65-0-3" id="h65-0-3" class="d">-                        alias: None,
</a><a href="#h65-0-4" id="h65-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h65-1" id="h65-1" class="h">@@ -79,13 +79,23 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h65-1-3" id="h65-1-3" class="d">-                            None,
</a><a href="#h65-1-4" id="h65-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h65-1-5" id="h65-1-5" class="i">+                            5,
</a><a href="#h65-1-6" id="h65-1-6" class="i">+                            Some(
</a><a href="#h65-1-7" id="h65-1-7" class="i">+                                (
</a><a href="#h65-1-8" id="h65-1-8" class="i">+                                    None,
</a><a href="#h65-1-9" id="h65-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h65-1-10" id="h65-1-10" class="i">+                                ),
</a><a href="#h65-1-11" id="h65-1-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h65-1-15" id="h65-1-15" class="d">-                                None,
</a><a href="#h65-1-16" id="h65-1-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h65-1-17" id="h65-1-17" class="i">+                                2,
</a><a href="#h65-1-18" id="h65-1-18" class="i">+                                Some(
</a><a href="#h65-1-19" id="h65-1-19" class="i">+                                    (
</a><a href="#h65-1-20" id="h65-1-20" class="i">+                                        None,
</a><a href="#h65-1-21" id="h65-1-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h65-1-22" id="h65-1-22" class="i">+                                    ),
</a><a href="#h65-1-23" id="h65-1-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h65-2" id="h65-2" class="h">@@ -105,16 +115,22 @@ Plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h65-2-3" id="h65-2-3" class="d">-                Column(
</a><a href="#h65-2-4" id="h65-2-4" class="i">+                Field(
</a>                     0,
<a href="#h65-2-6" id="h65-2-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h65-2-13" id="h65-2-13" class="d">-                    None,
</a><a href="#h65-2-14" id="h65-2-14" class="d">-                    &quot;rating&quot;,
</a><a href="#h65-2-15" id="h65-2-15" class="i">+                    0,
</a><a href="#h65-2-16" id="h65-2-16" class="i">+                    Some(
</a><a href="#h65-2-17" id="h65-2-17" class="i">+                        (
</a><a href="#h65-2-18" id="h65-2-18" class="i">+                            None,
</a><a href="#h65-2-19" id="h65-2-19" class="i">+                            &quot;rating&quot;,
</a><a href="#h65-2-20" id="h65-2-20" class="i">+                        ),
</a><a href="#h65-2-21" id="h65-2-21" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h65-3" id="h65-3" class="h">@@ -129,7 +145,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h65-3-3" id="h65-3-3" class="d">-                        alias: None,
</a><a href="#h65-3-4" id="h65-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h65-4" id="h65-4" class="h">@@ -138,13 +154,23 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h65-4-3" id="h65-4-3" class="d">-                            None,
</a><a href="#h65-4-4" id="h65-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h65-4-5" id="h65-4-5" class="i">+                            5,
</a><a href="#h65-4-6" id="h65-4-6" class="i">+                            Some(
</a><a href="#h65-4-7" id="h65-4-7" class="i">+                                (
</a><a href="#h65-4-8" id="h65-4-8" class="i">+                                    None,
</a><a href="#h65-4-9" id="h65-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h65-4-10" id="h65-4-10" class="i">+                                ),
</a><a href="#h65-4-11" id="h65-4-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h65-4-15" id="h65-4-15" class="d">-                                None,
</a><a href="#h65-4-16" id="h65-4-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h65-4-17" id="h65-4-17" class="i">+                                2,
</a><a href="#h65-4-18" id="h65-4-18" class="i">+                                Some(
</a><a href="#h65-4-19" id="h65-4-19" class="i">+                                    (
</a><a href="#h65-4-20" id="h65-4-20" class="i">+                                        None,
</a><a href="#h65-4-21" id="h65-4-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h65-4-22" id="h65-4-22" class="i">+                                    ),
</a><a href="#h65-4-23" id="h65-4-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h65-5" id="h65-5" class="h">@@ -164,16 +190,22 @@ Optimized plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h65-5-3" id="h65-5-3" class="d">-                Column(
</a><a href="#h65-5-4" id="h65-5-4" class="i">+                Field(
</a>                     0,
<a href="#h65-5-6" id="h65-5-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h65-5-13" id="h65-5-13" class="d">-                    None,
</a><a href="#h65-5-14" id="h65-5-14" class="d">-                    &quot;rating&quot;,
</a><a href="#h65-5-15" id="h65-5-15" class="i">+                    0,
</a><a href="#h65-5-16" id="h65-5-16" class="i">+                    Some(
</a><a href="#h65-5-17" id="h65-5-17" class="i">+                        (
</a><a href="#h65-5-18" id="h65-5-18" class="i">+                            None,
</a><a href="#h65-5-19" id="h65-5-19" class="i">+                            &quot;rating&quot;,
</a><a href="#h65-5-20" id="h65-5-20" class="i">+                        ),
</a><a href="#h65-5-21" id="h65-5-21" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h66" href="../file/tests/sql/query/group_expr_aggr.html">tests/sql/query/group_expr_aggr</a> b/<a href="../file/tests/sql/query/group_expr_aggr.html">tests/sql/query/group_expr_aggr</a></b>
<a href="#h66-0" id="h66-0" class="h">@@ -87,7 +87,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h66-0-3" id="h66-0-3" class="d">-                        alias: None,
</a><a href="#h66-0-4" id="h66-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h66-1" id="h66-1" class="h">@@ -98,8 +98,13 @@ Plan: Plan(
</a>                     expressions: [
                         Multiply(
                             Field(
<a href="#h66-1-3" id="h66-1-3" class="d">-                                None,
</a><a href="#h66-1-4" id="h66-1-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h66-1-5" id="h66-1-5" class="i">+                                5,
</a><a href="#h66-1-6" id="h66-1-6" class="i">+                                Some(
</a><a href="#h66-1-7" id="h66-1-7" class="i">+                                    (
</a><a href="#h66-1-8" id="h66-1-8" class="i">+                                        None,
</a><a href="#h66-1-9" id="h66-1-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h66-1-10" id="h66-1-10" class="i">+                                    ),
</a><a href="#h66-1-11" id="h66-1-11" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h66-2" id="h66-2" class="h">@@ -113,8 +118,13 @@ Plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h66-2-3" id="h66-2-3" class="d">-                            None,
</a><a href="#h66-2-4" id="h66-2-4" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h66-2-5" id="h66-2-5" class="i">+                            2,
</a><a href="#h66-2-6" id="h66-2-6" class="i">+                            Some(
</a><a href="#h66-2-7" id="h66-2-7" class="i">+                                (
</a><a href="#h66-2-8" id="h66-2-8" class="i">+                                    None,
</a><a href="#h66-2-9" id="h66-2-9" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h66-2-10" id="h66-2-10" class="i">+                                ),
</a><a href="#h66-2-11" id="h66-2-11" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h66-3" id="h66-3" class="h">@@ -129,15 +139,17 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h66-3-3" id="h66-3-3" class="i">+                    2,
</a>                     None,
<a href="#h66-3-5" id="h66-3-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
                 Divide(
<a href="#h66-3-8" id="h66-3-8" class="d">-                    Column(
</a><a href="#h66-3-9" id="h66-3-9" class="i">+                    Field(
</a>                         0,
<a href="#h66-3-11" id="h66-3-11" class="i">+                        None,
</a>                     ),
<a href="#h66-3-13" id="h66-3-13" class="d">-                    Column(
</a><a href="#h66-3-14" id="h66-3-14" class="i">+                    Field(
</a>                         1,
<a href="#h66-3-16" id="h66-3-16" class="i">+                        None,
</a>                     ),
                 ),
             ],
<a href="#h66-4" id="h66-4" class="h">@@ -145,8 +157,13 @@ Plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h66-4-3" id="h66-4-3" class="d">-                    None,
</a><a href="#h66-4-4" id="h66-4-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h66-4-5" id="h66-4-5" class="i">+                    0,
</a><a href="#h66-4-6" id="h66-4-6" class="i">+                    Some(
</a><a href="#h66-4-7" id="h66-4-7" class="i">+                        (
</a><a href="#h66-4-8" id="h66-4-8" class="i">+                            None,
</a><a href="#h66-4-9" id="h66-4-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h66-4-10" id="h66-4-10" class="i">+                        ),
</a><a href="#h66-4-11" id="h66-4-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h66-5" id="h66-5" class="h">@@ -161,7 +178,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h66-5-3" id="h66-5-3" class="d">-                        alias: None,
</a><a href="#h66-5-4" id="h66-5-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h66-6" id="h66-6" class="h">@@ -172,8 +189,13 @@ Optimized plan: Plan(
</a>                     expressions: [
                         Multiply(
                             Field(
<a href="#h66-6-3" id="h66-6-3" class="d">-                                None,
</a><a href="#h66-6-4" id="h66-6-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h66-6-5" id="h66-6-5" class="i">+                                5,
</a><a href="#h66-6-6" id="h66-6-6" class="i">+                                Some(
</a><a href="#h66-6-7" id="h66-6-7" class="i">+                                    (
</a><a href="#h66-6-8" id="h66-6-8" class="i">+                                        None,
</a><a href="#h66-6-9" id="h66-6-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h66-6-10" id="h66-6-10" class="i">+                                    ),
</a><a href="#h66-6-11" id="h66-6-11" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h66-7" id="h66-7" class="h">@@ -187,8 +209,13 @@ Optimized plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h66-7-3" id="h66-7-3" class="d">-                            None,
</a><a href="#h66-7-4" id="h66-7-4" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h66-7-5" id="h66-7-5" class="i">+                            2,
</a><a href="#h66-7-6" id="h66-7-6" class="i">+                            Some(
</a><a href="#h66-7-7" id="h66-7-7" class="i">+                                (
</a><a href="#h66-7-8" id="h66-7-8" class="i">+                                    None,
</a><a href="#h66-7-9" id="h66-7-9" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h66-7-10" id="h66-7-10" class="i">+                                ),
</a><a href="#h66-7-11" id="h66-7-11" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h66-8" id="h66-8" class="h">@@ -203,15 +230,17 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h66-8-3" id="h66-8-3" class="i">+                    2,
</a>                     None,
<a href="#h66-8-5" id="h66-8-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
                 Divide(
<a href="#h66-8-8" id="h66-8-8" class="d">-                    Column(
</a><a href="#h66-8-9" id="h66-8-9" class="i">+                    Field(
</a>                         0,
<a href="#h66-8-11" id="h66-8-11" class="i">+                        None,
</a>                     ),
<a href="#h66-8-13" id="h66-8-13" class="d">-                    Column(
</a><a href="#h66-8-14" id="h66-8-14" class="i">+                    Field(
</a>                         1,
<a href="#h66-8-16" id="h66-8-16" class="i">+                        None,
</a>                     ),
                 ),
             ],
<a href="#h66-9" id="h66-9" class="h">@@ -219,8 +248,13 @@ Optimized plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h66-9-3" id="h66-9-3" class="d">-                    None,
</a><a href="#h66-9-4" id="h66-9-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h66-9-5" id="h66-9-5" class="i">+                    0,
</a><a href="#h66-9-6" id="h66-9-6" class="i">+                    Some(
</a><a href="#h66-9-7" id="h66-9-7" class="i">+                        (
</a><a href="#h66-9-8" id="h66-9-8" class="i">+                            None,
</a><a href="#h66-9-9" id="h66-9-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h66-9-10" id="h66-9-10" class="i">+                        ),
</a><a href="#h66-9-11" id="h66-9-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h67" href="../file/tests/sql/query/group_expr_aggr_nogroupref.html">tests/sql/query/group_expr_aggr_nogroupref</a> b/<a href="../file/tests/sql/query/group_expr_aggr_nogroupref.html">tests/sql/query/group_expr_aggr_nogroupref</a></b>
<a href="#h67-0" id="h67-0" class="h">@@ -88,166 +88,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h67-0-3" id="h67-0-3" class="d">-Plan: Plan(
</a><a href="#h67-0-4" id="h67-0-4" class="d">-    Order {
</a><a href="#h67-0-5" id="h67-0-5" class="d">-        source: Projection {
</a><a href="#h67-0-6" id="h67-0-6" class="d">-            source: Aggregation {
</a><a href="#h67-0-7" id="h67-0-7" class="d">-                source: Projection {
</a><a href="#h67-0-8" id="h67-0-8" class="d">-                    source: Scan {
</a><a href="#h67-0-9" id="h67-0-9" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h67-0-10" id="h67-0-10" class="d">-                        alias: None,
</a><a href="#h67-0-11" id="h67-0-11" class="d">-                        filter: None,
</a><a href="#h67-0-12" id="h67-0-12" class="d">-                    },
</a><a href="#h67-0-13" id="h67-0-13" class="d">-                    labels: [
</a><a href="#h67-0-14" id="h67-0-14" class="d">-                        None,
</a><a href="#h67-0-15" id="h67-0-15" class="d">-                        None,
</a><a href="#h67-0-16" id="h67-0-16" class="d">-                        None,
</a><a href="#h67-0-17" id="h67-0-17" class="d">-                    ],
</a><a href="#h67-0-18" id="h67-0-18" class="d">-                    expressions: [
</a><a href="#h67-0-19" id="h67-0-19" class="d">-                        Multiply(
</a><a href="#h67-0-20" id="h67-0-20" class="d">-                            Field(
</a><a href="#h67-0-21" id="h67-0-21" class="d">-                                None,
</a><a href="#h67-0-22" id="h67-0-22" class="d">-                                &quot;rating&quot;,
</a><a href="#h67-0-23" id="h67-0-23" class="d">-                            ),
</a><a href="#h67-0-24" id="h67-0-24" class="d">-                            Constant(
</a><a href="#h67-0-25" id="h67-0-25" class="d">-                                Integer(
</a><a href="#h67-0-26" id="h67-0-26" class="d">-                                    10,
</a><a href="#h67-0-27" id="h67-0-27" class="d">-                                ),
</a><a href="#h67-0-28" id="h67-0-28" class="d">-                            ),
</a><a href="#h67-0-29" id="h67-0-29" class="d">-                        ),
</a><a href="#h67-0-30" id="h67-0-30" class="d">-                        Constant(
</a><a href="#h67-0-31" id="h67-0-31" class="d">-                            Boolean(
</a><a href="#h67-0-32" id="h67-0-32" class="d">-                                true,
</a><a href="#h67-0-33" id="h67-0-33" class="d">-                            ),
</a><a href="#h67-0-34" id="h67-0-34" class="d">-                        ),
</a><a href="#h67-0-35" id="h67-0-35" class="d">-                        Field(
</a><a href="#h67-0-36" id="h67-0-36" class="d">-                            None,
</a><a href="#h67-0-37" id="h67-0-37" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h67-0-38" id="h67-0-38" class="d">-                        ),
</a><a href="#h67-0-39" id="h67-0-39" class="d">-                    ],
</a><a href="#h67-0-40" id="h67-0-40" class="d">-                },
</a><a href="#h67-0-41" id="h67-0-41" class="d">-                aggregates: [
</a><a href="#h67-0-42" id="h67-0-42" class="d">-                    Sum,
</a><a href="#h67-0-43" id="h67-0-43" class="d">-                    Count,
</a><a href="#h67-0-44" id="h67-0-44" class="d">-                ],
</a><a href="#h67-0-45" id="h67-0-45" class="d">-            },
</a><a href="#h67-0-46" id="h67-0-46" class="d">-            labels: [
</a><a href="#h67-0-47" id="h67-0-47" class="d">-                None,
</a><a href="#h67-0-48" id="h67-0-48" class="d">-                None,
</a><a href="#h67-0-49" id="h67-0-49" class="d">-            ],
</a><a href="#h67-0-50" id="h67-0-50" class="d">-            expressions: [
</a><a href="#h67-0-51" id="h67-0-51" class="d">-                Field(
</a><a href="#h67-0-52" id="h67-0-52" class="d">-                    None,
</a><a href="#h67-0-53" id="h67-0-53" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h67-0-54" id="h67-0-54" class="d">-                ),
</a><a href="#h67-0-55" id="h67-0-55" class="d">-                Add(
</a><a href="#h67-0-56" id="h67-0-56" class="d">-                    Divide(
</a><a href="#h67-0-57" id="h67-0-57" class="d">-                        Column(
</a><a href="#h67-0-58" id="h67-0-58" class="d">-                            0,
</a><a href="#h67-0-59" id="h67-0-59" class="d">-                        ),
</a><a href="#h67-0-60" id="h67-0-60" class="d">-                        Column(
</a><a href="#h67-0-61" id="h67-0-61" class="d">-                            1,
</a><a href="#h67-0-62" id="h67-0-62" class="d">-                        ),
</a><a href="#h67-0-63" id="h67-0-63" class="d">-                    ),
</a><a href="#h67-0-64" id="h67-0-64" class="d">-                    Field(
</a><a href="#h67-0-65" id="h67-0-65" class="d">-                        None,
</a><a href="#h67-0-66" id="h67-0-66" class="d">-                        &quot;id&quot;,
</a><a href="#h67-0-67" id="h67-0-67" class="d">-                    ),
</a><a href="#h67-0-68" id="h67-0-68" class="d">-                ),
</a><a href="#h67-0-69" id="h67-0-69" class="d">-            ],
</a><a href="#h67-0-70" id="h67-0-70" class="d">-        },
</a><a href="#h67-0-71" id="h67-0-71" class="d">-        orders: [
</a><a href="#h67-0-72" id="h67-0-72" class="d">-            (
</a><a href="#h67-0-73" id="h67-0-73" class="d">-                Field(
</a><a href="#h67-0-74" id="h67-0-74" class="d">-                    None,
</a><a href="#h67-0-75" id="h67-0-75" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h67-0-76" id="h67-0-76" class="d">-                ),
</a><a href="#h67-0-77" id="h67-0-77" class="d">-                Ascending,
</a><a href="#h67-0-78" id="h67-0-78" class="d">-            ),
</a><a href="#h67-0-79" id="h67-0-79" class="d">-        ],
</a><a href="#h67-0-80" id="h67-0-80" class="d">-    },
</a><a href="#h67-0-81" id="h67-0-81" class="d">-)
</a><a href="#h67-0-82" id="h67-0-82" class="d">-
</a><a href="#h67-0-83" id="h67-0-83" class="d">-Optimized plan: Plan(
</a><a href="#h67-0-84" id="h67-0-84" class="d">-    Order {
</a><a href="#h67-0-85" id="h67-0-85" class="d">-        source: Projection {
</a><a href="#h67-0-86" id="h67-0-86" class="d">-            source: Aggregation {
</a><a href="#h67-0-87" id="h67-0-87" class="d">-                source: Projection {
</a><a href="#h67-0-88" id="h67-0-88" class="d">-                    source: Scan {
</a><a href="#h67-0-89" id="h67-0-89" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h67-0-90" id="h67-0-90" class="d">-                        alias: None,
</a><a href="#h67-0-91" id="h67-0-91" class="d">-                        filter: None,
</a><a href="#h67-0-92" id="h67-0-92" class="d">-                    },
</a><a href="#h67-0-93" id="h67-0-93" class="d">-                    labels: [
</a><a href="#h67-0-94" id="h67-0-94" class="d">-                        None,
</a><a href="#h67-0-95" id="h67-0-95" class="d">-                        None,
</a><a href="#h67-0-96" id="h67-0-96" class="d">-                        None,
</a><a href="#h67-0-97" id="h67-0-97" class="d">-                    ],
</a><a href="#h67-0-98" id="h67-0-98" class="d">-                    expressions: [
</a><a href="#h67-0-99" id="h67-0-99" class="d">-                        Multiply(
</a><a href="#h67-0-100" id="h67-0-100" class="d">-                            Field(
</a><a href="#h67-0-101" id="h67-0-101" class="d">-                                None,
</a><a href="#h67-0-102" id="h67-0-102" class="d">-                                &quot;rating&quot;,
</a><a href="#h67-0-103" id="h67-0-103" class="d">-                            ),
</a><a href="#h67-0-104" id="h67-0-104" class="d">-                            Constant(
</a><a href="#h67-0-105" id="h67-0-105" class="d">-                                Integer(
</a><a href="#h67-0-106" id="h67-0-106" class="d">-                                    10,
</a><a href="#h67-0-107" id="h67-0-107" class="d">-                                ),
</a><a href="#h67-0-108" id="h67-0-108" class="d">-                            ),
</a><a href="#h67-0-109" id="h67-0-109" class="d">-                        ),
</a><a href="#h67-0-110" id="h67-0-110" class="d">-                        Constant(
</a><a href="#h67-0-111" id="h67-0-111" class="d">-                            Boolean(
</a><a href="#h67-0-112" id="h67-0-112" class="d">-                                true,
</a><a href="#h67-0-113" id="h67-0-113" class="d">-                            ),
</a><a href="#h67-0-114" id="h67-0-114" class="d">-                        ),
</a><a href="#h67-0-115" id="h67-0-115" class="d">-                        Field(
</a><a href="#h67-0-116" id="h67-0-116" class="d">-                            None,
</a><a href="#h67-0-117" id="h67-0-117" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h67-0-118" id="h67-0-118" class="d">-                        ),
</a><a href="#h67-0-119" id="h67-0-119" class="d">-                    ],
</a><a href="#h67-0-120" id="h67-0-120" class="d">-                },
</a><a href="#h67-0-121" id="h67-0-121" class="d">-                aggregates: [
</a><a href="#h67-0-122" id="h67-0-122" class="d">-                    Sum,
</a><a href="#h67-0-123" id="h67-0-123" class="d">-                    Count,
</a><a href="#h67-0-124" id="h67-0-124" class="d">-                ],
</a><a href="#h67-0-125" id="h67-0-125" class="d">-            },
</a><a href="#h67-0-126" id="h67-0-126" class="d">-            labels: [
</a><a href="#h67-0-127" id="h67-0-127" class="d">-                None,
</a><a href="#h67-0-128" id="h67-0-128" class="d">-                None,
</a><a href="#h67-0-129" id="h67-0-129" class="d">-            ],
</a><a href="#h67-0-130" id="h67-0-130" class="d">-            expressions: [
</a><a href="#h67-0-131" id="h67-0-131" class="d">-                Field(
</a><a href="#h67-0-132" id="h67-0-132" class="d">-                    None,
</a><a href="#h67-0-133" id="h67-0-133" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h67-0-134" id="h67-0-134" class="d">-                ),
</a><a href="#h67-0-135" id="h67-0-135" class="d">-                Add(
</a><a href="#h67-0-136" id="h67-0-136" class="d">-                    Divide(
</a><a href="#h67-0-137" id="h67-0-137" class="d">-                        Column(
</a><a href="#h67-0-138" id="h67-0-138" class="d">-                            0,
</a><a href="#h67-0-139" id="h67-0-139" class="d">-                        ),
</a><a href="#h67-0-140" id="h67-0-140" class="d">-                        Column(
</a><a href="#h67-0-141" id="h67-0-141" class="d">-                            1,
</a><a href="#h67-0-142" id="h67-0-142" class="d">-                        ),
</a><a href="#h67-0-143" id="h67-0-143" class="d">-                    ),
</a><a href="#h67-0-144" id="h67-0-144" class="d">-                    Field(
</a><a href="#h67-0-145" id="h67-0-145" class="d">-                        None,
</a><a href="#h67-0-146" id="h67-0-146" class="d">-                        &quot;id&quot;,
</a><a href="#h67-0-147" id="h67-0-147" class="d">-                    ),
</a><a href="#h67-0-148" id="h67-0-148" class="d">-                ),
</a><a href="#h67-0-149" id="h67-0-149" class="d">-            ],
</a><a href="#h67-0-150" id="h67-0-150" class="d">-        },
</a><a href="#h67-0-151" id="h67-0-151" class="d">-        orders: [
</a><a href="#h67-0-152" id="h67-0-152" class="d">-            (
</a><a href="#h67-0-153" id="h67-0-153" class="d">-                Field(
</a><a href="#h67-0-154" id="h67-0-154" class="d">-                    None,
</a><a href="#h67-0-155" id="h67-0-155" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h67-0-156" id="h67-0-156" class="d">-                ),
</a><a href="#h67-0-157" id="h67-0-157" class="d">-                Ascending,
</a><a href="#h67-0-158" id="h67-0-158" class="d">-            ),
</a><a href="#h67-0-159" id="h67-0-159" class="d">-        ],
</a><a href="#h67-0-160" id="h67-0-160" class="d">-    },
</a><a href="#h67-0-161" id="h67-0-161" class="d">-)
</a><a href="#h67-0-162" id="h67-0-162" class="d">-
</a><a href="#h67-0-163" id="h67-0-163" class="d">-Query: SELECT studio_id, SUM(rating * 10) / COUNT(*) + id FROM movies GROUP BY studio_id ORDER BY studio_id
</a><a href="#h67-0-164" id="h67-0-164" class="d">-
</a><a href="#h67-0-165" id="h67-0-165" class="d">-Result: Value(&quot;Unknown field id&quot;)
</a><a href="#h67-0-166" id="h67-0-166" class="d">-\ No newline at end of file
</a><a href="#h67-0-167" id="h67-0-167" class="i">+Plan: Value(&quot;Unknown field id&quot;)
</a><a href="#h67-0-168" id="h67-0-168" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h68" href="../file/tests/sql/query/group_expr_aggr_selfref.html">tests/sql/query/group_expr_aggr_selfref</a> b/<a href="../file/tests/sql/query/group_expr_aggr_selfref.html">tests/sql/query/group_expr_aggr_selfref</a></b>
<a href="#h68-0" id="h68-0" class="h">@@ -95,7 +95,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h68-0-3" id="h68-0-3" class="d">-                        alias: None,
</a><a href="#h68-0-4" id="h68-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h68-1" id="h68-1" class="h">@@ -106,8 +106,13 @@ Plan: Plan(
</a>                     expressions: [
                         Multiply(
                             Field(
<a href="#h68-1-3" id="h68-1-3" class="d">-                                None,
</a><a href="#h68-1-4" id="h68-1-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h68-1-5" id="h68-1-5" class="i">+                                5,
</a><a href="#h68-1-6" id="h68-1-6" class="i">+                                Some(
</a><a href="#h68-1-7" id="h68-1-7" class="i">+                                    (
</a><a href="#h68-1-8" id="h68-1-8" class="i">+                                        None,
</a><a href="#h68-1-9" id="h68-1-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h68-1-10" id="h68-1-10" class="i">+                                    ),
</a><a href="#h68-1-11" id="h68-1-11" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h68-2" id="h68-2" class="h">@@ -121,8 +126,13 @@ Plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h68-2-3" id="h68-2-3" class="d">-                            None,
</a><a href="#h68-2-4" id="h68-2-4" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h68-2-5" id="h68-2-5" class="i">+                            2,
</a><a href="#h68-2-6" id="h68-2-6" class="i">+                            Some(
</a><a href="#h68-2-7" id="h68-2-7" class="i">+                                (
</a><a href="#h68-2-8" id="h68-2-8" class="i">+                                    None,
</a><a href="#h68-2-9" id="h68-2-9" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h68-2-10" id="h68-2-10" class="i">+                                ),
</a><a href="#h68-2-11" id="h68-2-11" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h68-3" id="h68-3" class="h">@@ -137,21 +147,28 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h68-3-3" id="h68-3-3" class="i">+                    2,
</a>                     None,
<a href="#h68-3-5" id="h68-3-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
                 Add(
                     Divide(
<a href="#h68-3-9" id="h68-3-9" class="d">-                        Column(
</a><a href="#h68-3-10" id="h68-3-10" class="i">+                        Field(
</a>                             0,
<a href="#h68-3-12" id="h68-3-12" class="i">+                            None,
</a>                         ),
<a href="#h68-3-14" id="h68-3-14" class="d">-                        Column(
</a><a href="#h68-3-15" id="h68-3-15" class="i">+                        Field(
</a>                             1,
<a href="#h68-3-17" id="h68-3-17" class="i">+                            None,
</a>                         ),
                     ),
                     Field(
<a href="#h68-3-21" id="h68-3-21" class="d">-                        None,
</a><a href="#h68-3-22" id="h68-3-22" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h68-3-23" id="h68-3-23" class="i">+                        2,
</a><a href="#h68-3-24" id="h68-3-24" class="i">+                        Some(
</a><a href="#h68-3-25" id="h68-3-25" class="i">+                            (
</a><a href="#h68-3-26" id="h68-3-26" class="i">+                                None,
</a><a href="#h68-3-27" id="h68-3-27" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h68-3-28" id="h68-3-28" class="i">+                            ),
</a><a href="#h68-3-29" id="h68-3-29" class="i">+                        ),
</a>                     ),
                 ),
             ],
<a href="#h68-4" id="h68-4" class="h">@@ -159,8 +176,13 @@ Plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h68-4-3" id="h68-4-3" class="d">-                    None,
</a><a href="#h68-4-4" id="h68-4-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h68-4-5" id="h68-4-5" class="i">+                    0,
</a><a href="#h68-4-6" id="h68-4-6" class="i">+                    Some(
</a><a href="#h68-4-7" id="h68-4-7" class="i">+                        (
</a><a href="#h68-4-8" id="h68-4-8" class="i">+                            None,
</a><a href="#h68-4-9" id="h68-4-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h68-4-10" id="h68-4-10" class="i">+                        ),
</a><a href="#h68-4-11" id="h68-4-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h68-5" id="h68-5" class="h">@@ -175,7 +197,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h68-5-3" id="h68-5-3" class="d">-                        alias: None,
</a><a href="#h68-5-4" id="h68-5-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h68-6" id="h68-6" class="h">@@ -186,8 +208,13 @@ Optimized plan: Plan(
</a>                     expressions: [
                         Multiply(
                             Field(
<a href="#h68-6-3" id="h68-6-3" class="d">-                                None,
</a><a href="#h68-6-4" id="h68-6-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h68-6-5" id="h68-6-5" class="i">+                                5,
</a><a href="#h68-6-6" id="h68-6-6" class="i">+                                Some(
</a><a href="#h68-6-7" id="h68-6-7" class="i">+                                    (
</a><a href="#h68-6-8" id="h68-6-8" class="i">+                                        None,
</a><a href="#h68-6-9" id="h68-6-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h68-6-10" id="h68-6-10" class="i">+                                    ),
</a><a href="#h68-6-11" id="h68-6-11" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h68-7" id="h68-7" class="h">@@ -201,8 +228,13 @@ Optimized plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h68-7-3" id="h68-7-3" class="d">-                            None,
</a><a href="#h68-7-4" id="h68-7-4" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h68-7-5" id="h68-7-5" class="i">+                            2,
</a><a href="#h68-7-6" id="h68-7-6" class="i">+                            Some(
</a><a href="#h68-7-7" id="h68-7-7" class="i">+                                (
</a><a href="#h68-7-8" id="h68-7-8" class="i">+                                    None,
</a><a href="#h68-7-9" id="h68-7-9" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h68-7-10" id="h68-7-10" class="i">+                                ),
</a><a href="#h68-7-11" id="h68-7-11" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h68-8" id="h68-8" class="h">@@ -217,21 +249,28 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h68-8-3" id="h68-8-3" class="i">+                    2,
</a>                     None,
<a href="#h68-8-5" id="h68-8-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
                 Add(
                     Divide(
<a href="#h68-8-9" id="h68-8-9" class="d">-                        Column(
</a><a href="#h68-8-10" id="h68-8-10" class="i">+                        Field(
</a>                             0,
<a href="#h68-8-12" id="h68-8-12" class="i">+                            None,
</a>                         ),
<a href="#h68-8-14" id="h68-8-14" class="d">-                        Column(
</a><a href="#h68-8-15" id="h68-8-15" class="i">+                        Field(
</a>                             1,
<a href="#h68-8-17" id="h68-8-17" class="i">+                            None,
</a>                         ),
                     ),
                     Field(
<a href="#h68-8-21" id="h68-8-21" class="d">-                        None,
</a><a href="#h68-8-22" id="h68-8-22" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h68-8-23" id="h68-8-23" class="i">+                        2,
</a><a href="#h68-8-24" id="h68-8-24" class="i">+                        Some(
</a><a href="#h68-8-25" id="h68-8-25" class="i">+                            (
</a><a href="#h68-8-26" id="h68-8-26" class="i">+                                None,
</a><a href="#h68-8-27" id="h68-8-27" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h68-8-28" id="h68-8-28" class="i">+                            ),
</a><a href="#h68-8-29" id="h68-8-29" class="i">+                        ),
</a>                     ),
                 ),
             ],
<a href="#h68-9" id="h68-9" class="h">@@ -239,8 +278,13 @@ Optimized plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h68-9-3" id="h68-9-3" class="d">-                    None,
</a><a href="#h68-9-4" id="h68-9-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h68-9-5" id="h68-9-5" class="i">+                    0,
</a><a href="#h68-9-6" id="h68-9-6" class="i">+                    Some(
</a><a href="#h68-9-7" id="h68-9-7" class="i">+                        (
</a><a href="#h68-9-8" id="h68-9-8" class="i">+                            None,
</a><a href="#h68-9-9" id="h68-9-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h68-9-10" id="h68-9-10" class="i">+                        ),
</a><a href="#h68-9-11" id="h68-9-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h69" href="../file/tests/sql/query/group_expr_aliased.html">tests/sql/query/group_expr_aliased</a> b/<a href="../file/tests/sql/query/group_expr_aliased.html">tests/sql/query/group_expr_aliased</a></b>
<a href="#h69-0" id="h69-0" class="h">@@ -75,7 +75,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h69-0-3" id="h69-0-3" class="d">-                        alias: None,
</a><a href="#h69-0-4" id="h69-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h69-1" id="h69-1" class="h">@@ -86,13 +86,23 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h69-1-3" id="h69-1-3" class="d">-                            None,
</a><a href="#h69-1-4" id="h69-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h69-1-5" id="h69-1-5" class="i">+                            5,
</a><a href="#h69-1-6" id="h69-1-6" class="i">+                            Some(
</a><a href="#h69-1-7" id="h69-1-7" class="i">+                                (
</a><a href="#h69-1-8" id="h69-1-8" class="i">+                                    None,
</a><a href="#h69-1-9" id="h69-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h69-1-10" id="h69-1-10" class="i">+                                ),
</a><a href="#h69-1-11" id="h69-1-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h69-1-15" id="h69-1-15" class="d">-                                None,
</a><a href="#h69-1-16" id="h69-1-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h69-1-17" id="h69-1-17" class="i">+                                2,
</a><a href="#h69-1-18" id="h69-1-18" class="i">+                                Some(
</a><a href="#h69-1-19" id="h69-1-19" class="i">+                                    (
</a><a href="#h69-1-20" id="h69-1-20" class="i">+                                        None,
</a><a href="#h69-1-21" id="h69-1-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h69-1-22" id="h69-1-22" class="i">+                                    ),
</a><a href="#h69-1-23" id="h69-1-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h69-2" id="h69-2" class="h">@@ -113,19 +123,26 @@ Plan: Plan(
</a>                 None,
             ],
             expressions: [
<a href="#h69-2-3" id="h69-2-3" class="d">-                Column(
</a><a href="#h69-2-4" id="h69-2-4" class="i">+                Field(
</a>                     1,
<a href="#h69-2-6" id="h69-2-6" class="i">+                    None,
</a>                 ),
<a href="#h69-2-8" id="h69-2-8" class="d">-                Column(
</a><a href="#h69-2-9" id="h69-2-9" class="i">+                Field(
</a>                     0,
<a href="#h69-2-11" id="h69-2-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h69-2-18" id="h69-2-18" class="d">-                    None,
</a><a href="#h69-2-19" id="h69-2-19" class="d">-                    &quot;twice&quot;,
</a><a href="#h69-2-20" id="h69-2-20" class="i">+                    0,
</a><a href="#h69-2-21" id="h69-2-21" class="i">+                    Some(
</a><a href="#h69-2-22" id="h69-2-22" class="i">+                        (
</a><a href="#h69-2-23" id="h69-2-23" class="i">+                            None,
</a><a href="#h69-2-24" id="h69-2-24" class="i">+                            &quot;twice&quot;,
</a><a href="#h69-2-25" id="h69-2-25" class="i">+                        ),
</a><a href="#h69-2-26" id="h69-2-26" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h69-3" id="h69-3" class="h">@@ -140,7 +157,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h69-3-3" id="h69-3-3" class="d">-                        alias: None,
</a><a href="#h69-3-4" id="h69-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h69-4" id="h69-4" class="h">@@ -151,13 +168,23 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h69-4-3" id="h69-4-3" class="d">-                            None,
</a><a href="#h69-4-4" id="h69-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h69-4-5" id="h69-4-5" class="i">+                            5,
</a><a href="#h69-4-6" id="h69-4-6" class="i">+                            Some(
</a><a href="#h69-4-7" id="h69-4-7" class="i">+                                (
</a><a href="#h69-4-8" id="h69-4-8" class="i">+                                    None,
</a><a href="#h69-4-9" id="h69-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h69-4-10" id="h69-4-10" class="i">+                                ),
</a><a href="#h69-4-11" id="h69-4-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h69-4-15" id="h69-4-15" class="d">-                                None,
</a><a href="#h69-4-16" id="h69-4-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h69-4-17" id="h69-4-17" class="i">+                                2,
</a><a href="#h69-4-18" id="h69-4-18" class="i">+                                Some(
</a><a href="#h69-4-19" id="h69-4-19" class="i">+                                    (
</a><a href="#h69-4-20" id="h69-4-20" class="i">+                                        None,
</a><a href="#h69-4-21" id="h69-4-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h69-4-22" id="h69-4-22" class="i">+                                    ),
</a><a href="#h69-4-23" id="h69-4-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h69-5" id="h69-5" class="h">@@ -178,19 +205,26 @@ Optimized plan: Plan(
</a>                 None,
             ],
             expressions: [
<a href="#h69-5-3" id="h69-5-3" class="d">-                Column(
</a><a href="#h69-5-4" id="h69-5-4" class="i">+                Field(
</a>                     1,
<a href="#h69-5-6" id="h69-5-6" class="i">+                    None,
</a>                 ),
<a href="#h69-5-8" id="h69-5-8" class="d">-                Column(
</a><a href="#h69-5-9" id="h69-5-9" class="i">+                Field(
</a>                     0,
<a href="#h69-5-11" id="h69-5-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h69-5-18" id="h69-5-18" class="d">-                    None,
</a><a href="#h69-5-19" id="h69-5-19" class="d">-                    &quot;twice&quot;,
</a><a href="#h69-5-20" id="h69-5-20" class="i">+                    0,
</a><a href="#h69-5-21" id="h69-5-21" class="i">+                    Some(
</a><a href="#h69-5-22" id="h69-5-22" class="i">+                        (
</a><a href="#h69-5-23" id="h69-5-23" class="i">+                            None,
</a><a href="#h69-5-24" id="h69-5-24" class="i">+                            &quot;twice&quot;,
</a><a href="#h69-5-25" id="h69-5-25" class="i">+                        ),
</a><a href="#h69-5-26" id="h69-5-26" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h70" href="../file/tests/sql/query/group_expr_both.html">tests/sql/query/group_expr_both</a> b/<a href="../file/tests/sql/query/group_expr_both.html">tests/sql/query/group_expr_both</a></b>
<a href="#h70-0" id="h70-0" class="h">@@ -84,7 +84,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h70-0-3" id="h70-0-3" class="d">-                        alias: None,
</a><a href="#h70-0-4" id="h70-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h70-1" id="h70-1" class="h">@@ -93,13 +93,23 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h70-1-3" id="h70-1-3" class="d">-                            None,
</a><a href="#h70-1-4" id="h70-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h70-1-5" id="h70-1-5" class="i">+                            5,
</a><a href="#h70-1-6" id="h70-1-6" class="i">+                            Some(
</a><a href="#h70-1-7" id="h70-1-7" class="i">+                                (
</a><a href="#h70-1-8" id="h70-1-8" class="i">+                                    None,
</a><a href="#h70-1-9" id="h70-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h70-1-10" id="h70-1-10" class="i">+                                ),
</a><a href="#h70-1-11" id="h70-1-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h70-1-15" id="h70-1-15" class="d">-                                None,
</a><a href="#h70-1-16" id="h70-1-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h70-1-17" id="h70-1-17" class="i">+                                2,
</a><a href="#h70-1-18" id="h70-1-18" class="i">+                                Some(
</a><a href="#h70-1-19" id="h70-1-19" class="i">+                                    (
</a><a href="#h70-1-20" id="h70-1-20" class="i">+                                        None,
</a><a href="#h70-1-21" id="h70-1-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h70-1-22" id="h70-1-22" class="i">+                                    ),
</a><a href="#h70-1-23" id="h70-1-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h70-2" id="h70-2" class="h">@@ -120,19 +130,26 @@ Plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h70-2-3" id="h70-2-3" class="d">-                Column(
</a><a href="#h70-2-4" id="h70-2-4" class="i">+                Field(
</a>                     1,
<a href="#h70-2-6" id="h70-2-6" class="i">+                    None,
</a>                 ),
<a href="#h70-2-8" id="h70-2-8" class="d">-                Column(
</a><a href="#h70-2-9" id="h70-2-9" class="i">+                Field(
</a>                     0,
<a href="#h70-2-11" id="h70-2-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h70-2-18" id="h70-2-18" class="d">-                    None,
</a><a href="#h70-2-19" id="h70-2-19" class="d">-                    &quot;rating&quot;,
</a><a href="#h70-2-20" id="h70-2-20" class="i">+                    1,
</a><a href="#h70-2-21" id="h70-2-21" class="i">+                    Some(
</a><a href="#h70-2-22" id="h70-2-22" class="i">+                        (
</a><a href="#h70-2-23" id="h70-2-23" class="i">+                            None,
</a><a href="#h70-2-24" id="h70-2-24" class="i">+                            &quot;rating&quot;,
</a><a href="#h70-2-25" id="h70-2-25" class="i">+                        ),
</a><a href="#h70-2-26" id="h70-2-26" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h70-3" id="h70-3" class="h">@@ -147,7 +164,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h70-3-3" id="h70-3-3" class="d">-                        alias: None,
</a><a href="#h70-3-4" id="h70-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h70-4" id="h70-4" class="h">@@ -156,13 +173,23 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h70-4-3" id="h70-4-3" class="d">-                            None,
</a><a href="#h70-4-4" id="h70-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h70-4-5" id="h70-4-5" class="i">+                            5,
</a><a href="#h70-4-6" id="h70-4-6" class="i">+                            Some(
</a><a href="#h70-4-7" id="h70-4-7" class="i">+                                (
</a><a href="#h70-4-8" id="h70-4-8" class="i">+                                    None,
</a><a href="#h70-4-9" id="h70-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h70-4-10" id="h70-4-10" class="i">+                                ),
</a><a href="#h70-4-11" id="h70-4-11" class="i">+                            ),
</a>                         ),
                         Multiply(
                             Field(
<a href="#h70-4-15" id="h70-4-15" class="d">-                                None,
</a><a href="#h70-4-16" id="h70-4-16" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h70-4-17" id="h70-4-17" class="i">+                                2,
</a><a href="#h70-4-18" id="h70-4-18" class="i">+                                Some(
</a><a href="#h70-4-19" id="h70-4-19" class="i">+                                    (
</a><a href="#h70-4-20" id="h70-4-20" class="i">+                                        None,
</a><a href="#h70-4-21" id="h70-4-21" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h70-4-22" id="h70-4-22" class="i">+                                    ),
</a><a href="#h70-4-23" id="h70-4-23" class="i">+                                ),
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h70-5" id="h70-5" class="h">@@ -183,19 +210,26 @@ Optimized plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h70-5-3" id="h70-5-3" class="d">-                Column(
</a><a href="#h70-5-4" id="h70-5-4" class="i">+                Field(
</a>                     1,
<a href="#h70-5-6" id="h70-5-6" class="i">+                    None,
</a>                 ),
<a href="#h70-5-8" id="h70-5-8" class="d">-                Column(
</a><a href="#h70-5-9" id="h70-5-9" class="i">+                Field(
</a>                     0,
<a href="#h70-5-11" id="h70-5-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h70-5-18" id="h70-5-18" class="d">-                    None,
</a><a href="#h70-5-19" id="h70-5-19" class="d">-                    &quot;rating&quot;,
</a><a href="#h70-5-20" id="h70-5-20" class="i">+                    1,
</a><a href="#h70-5-21" id="h70-5-21" class="i">+                    Some(
</a><a href="#h70-5-22" id="h70-5-22" class="i">+                        (
</a><a href="#h70-5-23" id="h70-5-23" class="i">+                            None,
</a><a href="#h70-5-24" id="h70-5-24" class="i">+                            &quot;rating&quot;,
</a><a href="#h70-5-25" id="h70-5-25" class="i">+                        ),
</a><a href="#h70-5-26" id="h70-5-26" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h71" href="../file/tests/sql/query/group_expr_extended.html">tests/sql/query/group_expr_extended</a> b/<a href="../file/tests/sql/query/group_expr_extended.html">tests/sql/query/group_expr_extended</a></b>
<a href="#h71-0" id="h71-0" class="h">@@ -86,162 +86,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h71-0-3" id="h71-0-3" class="d">-Plan: Plan(
</a><a href="#h71-0-4" id="h71-0-4" class="d">-    Order {
</a><a href="#h71-0-5" id="h71-0-5" class="d">-        source: Projection {
</a><a href="#h71-0-6" id="h71-0-6" class="d">-            source: Aggregation {
</a><a href="#h71-0-7" id="h71-0-7" class="d">-                source: Projection {
</a><a href="#h71-0-8" id="h71-0-8" class="d">-                    source: Scan {
</a><a href="#h71-0-9" id="h71-0-9" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h71-0-10" id="h71-0-10" class="d">-                        alias: None,
</a><a href="#h71-0-11" id="h71-0-11" class="d">-                        filter: None,
</a><a href="#h71-0-12" id="h71-0-12" class="d">-                    },
</a><a href="#h71-0-13" id="h71-0-13" class="d">-                    labels: [
</a><a href="#h71-0-14" id="h71-0-14" class="d">-                        None,
</a><a href="#h71-0-15" id="h71-0-15" class="d">-                        None,
</a><a href="#h71-0-16" id="h71-0-16" class="d">-                    ],
</a><a href="#h71-0-17" id="h71-0-17" class="d">-                    expressions: [
</a><a href="#h71-0-18" id="h71-0-18" class="d">-                        Field(
</a><a href="#h71-0-19" id="h71-0-19" class="d">-                            None,
</a><a href="#h71-0-20" id="h71-0-20" class="d">-                            &quot;rating&quot;,
</a><a href="#h71-0-21" id="h71-0-21" class="d">-                        ),
</a><a href="#h71-0-22" id="h71-0-22" class="d">-                        Multiply(
</a><a href="#h71-0-23" id="h71-0-23" class="d">-                            Field(
</a><a href="#h71-0-24" id="h71-0-24" class="d">-                                None,
</a><a href="#h71-0-25" id="h71-0-25" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h71-0-26" id="h71-0-26" class="d">-                            ),
</a><a href="#h71-0-27" id="h71-0-27" class="d">-                            Constant(
</a><a href="#h71-0-28" id="h71-0-28" class="d">-                                Integer(
</a><a href="#h71-0-29" id="h71-0-29" class="d">-                                    2,
</a><a href="#h71-0-30" id="h71-0-30" class="d">-                                ),
</a><a href="#h71-0-31" id="h71-0-31" class="d">-                            ),
</a><a href="#h71-0-32" id="h71-0-32" class="d">-                        ),
</a><a href="#h71-0-33" id="h71-0-33" class="d">-                    ],
</a><a href="#h71-0-34" id="h71-0-34" class="d">-                },
</a><a href="#h71-0-35" id="h71-0-35" class="d">-                aggregates: [
</a><a href="#h71-0-36" id="h71-0-36" class="d">-                    Max,
</a><a href="#h71-0-37" id="h71-0-37" class="d">-                ],
</a><a href="#h71-0-38" id="h71-0-38" class="d">-            },
</a><a href="#h71-0-39" id="h71-0-39" class="d">-            labels: [
</a><a href="#h71-0-40" id="h71-0-40" class="d">-                None,
</a><a href="#h71-0-41" id="h71-0-41" class="d">-                Some(
</a><a href="#h71-0-42" id="h71-0-42" class="d">-                    &quot;rating&quot;,
</a><a href="#h71-0-43" id="h71-0-43" class="d">-                ),
</a><a href="#h71-0-44" id="h71-0-44" class="d">-            ],
</a><a href="#h71-0-45" id="h71-0-45" class="d">-            expressions: [
</a><a href="#h71-0-46" id="h71-0-46" class="d">-                Add(
</a><a href="#h71-0-47" id="h71-0-47" class="d">-                    Multiply(
</a><a href="#h71-0-48" id="h71-0-48" class="d">-                        Field(
</a><a href="#h71-0-49" id="h71-0-49" class="d">-                            None,
</a><a href="#h71-0-50" id="h71-0-50" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h71-0-51" id="h71-0-51" class="d">-                        ),
</a><a href="#h71-0-52" id="h71-0-52" class="d">-                        Constant(
</a><a href="#h71-0-53" id="h71-0-53" class="d">-                            Integer(
</a><a href="#h71-0-54" id="h71-0-54" class="d">-                                2,
</a><a href="#h71-0-55" id="h71-0-55" class="d">-                            ),
</a><a href="#h71-0-56" id="h71-0-56" class="d">-                        ),
</a><a href="#h71-0-57" id="h71-0-57" class="d">-                    ),
</a><a href="#h71-0-58" id="h71-0-58" class="d">-                    Constant(
</a><a href="#h71-0-59" id="h71-0-59" class="d">-                        Integer(
</a><a href="#h71-0-60" id="h71-0-60" class="d">-                            1,
</a><a href="#h71-0-61" id="h71-0-61" class="d">-                        ),
</a><a href="#h71-0-62" id="h71-0-62" class="d">-                    ),
</a><a href="#h71-0-63" id="h71-0-63" class="d">-                ),
</a><a href="#h71-0-64" id="h71-0-64" class="d">-                Column(
</a><a href="#h71-0-65" id="h71-0-65" class="d">-                    0,
</a><a href="#h71-0-66" id="h71-0-66" class="d">-                ),
</a><a href="#h71-0-67" id="h71-0-67" class="d">-            ],
</a><a href="#h71-0-68" id="h71-0-68" class="d">-        },
</a><a href="#h71-0-69" id="h71-0-69" class="d">-        orders: [
</a><a href="#h71-0-70" id="h71-0-70" class="d">-            (
</a><a href="#h71-0-71" id="h71-0-71" class="d">-                Field(
</a><a href="#h71-0-72" id="h71-0-72" class="d">-                    None,
</a><a href="#h71-0-73" id="h71-0-73" class="d">-                    &quot;rating&quot;,
</a><a href="#h71-0-74" id="h71-0-74" class="d">-                ),
</a><a href="#h71-0-75" id="h71-0-75" class="d">-                Ascending,
</a><a href="#h71-0-76" id="h71-0-76" class="d">-            ),
</a><a href="#h71-0-77" id="h71-0-77" class="d">-        ],
</a><a href="#h71-0-78" id="h71-0-78" class="d">-    },
</a><a href="#h71-0-79" id="h71-0-79" class="d">-)
</a><a href="#h71-0-80" id="h71-0-80" class="d">-
</a><a href="#h71-0-81" id="h71-0-81" class="d">-Optimized plan: Plan(
</a><a href="#h71-0-82" id="h71-0-82" class="d">-    Order {
</a><a href="#h71-0-83" id="h71-0-83" class="d">-        source: Projection {
</a><a href="#h71-0-84" id="h71-0-84" class="d">-            source: Aggregation {
</a><a href="#h71-0-85" id="h71-0-85" class="d">-                source: Projection {
</a><a href="#h71-0-86" id="h71-0-86" class="d">-                    source: Scan {
</a><a href="#h71-0-87" id="h71-0-87" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h71-0-88" id="h71-0-88" class="d">-                        alias: None,
</a><a href="#h71-0-89" id="h71-0-89" class="d">-                        filter: None,
</a><a href="#h71-0-90" id="h71-0-90" class="d">-                    },
</a><a href="#h71-0-91" id="h71-0-91" class="d">-                    labels: [
</a><a href="#h71-0-92" id="h71-0-92" class="d">-                        None,
</a><a href="#h71-0-93" id="h71-0-93" class="d">-                        None,
</a><a href="#h71-0-94" id="h71-0-94" class="d">-                    ],
</a><a href="#h71-0-95" id="h71-0-95" class="d">-                    expressions: [
</a><a href="#h71-0-96" id="h71-0-96" class="d">-                        Field(
</a><a href="#h71-0-97" id="h71-0-97" class="d">-                            None,
</a><a href="#h71-0-98" id="h71-0-98" class="d">-                            &quot;rating&quot;,
</a><a href="#h71-0-99" id="h71-0-99" class="d">-                        ),
</a><a href="#h71-0-100" id="h71-0-100" class="d">-                        Multiply(
</a><a href="#h71-0-101" id="h71-0-101" class="d">-                            Field(
</a><a href="#h71-0-102" id="h71-0-102" class="d">-                                None,
</a><a href="#h71-0-103" id="h71-0-103" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h71-0-104" id="h71-0-104" class="d">-                            ),
</a><a href="#h71-0-105" id="h71-0-105" class="d">-                            Constant(
</a><a href="#h71-0-106" id="h71-0-106" class="d">-                                Integer(
</a><a href="#h71-0-107" id="h71-0-107" class="d">-                                    2,
</a><a href="#h71-0-108" id="h71-0-108" class="d">-                                ),
</a><a href="#h71-0-109" id="h71-0-109" class="d">-                            ),
</a><a href="#h71-0-110" id="h71-0-110" class="d">-                        ),
</a><a href="#h71-0-111" id="h71-0-111" class="d">-                    ],
</a><a href="#h71-0-112" id="h71-0-112" class="d">-                },
</a><a href="#h71-0-113" id="h71-0-113" class="d">-                aggregates: [
</a><a href="#h71-0-114" id="h71-0-114" class="d">-                    Max,
</a><a href="#h71-0-115" id="h71-0-115" class="d">-                ],
</a><a href="#h71-0-116" id="h71-0-116" class="d">-            },
</a><a href="#h71-0-117" id="h71-0-117" class="d">-            labels: [
</a><a href="#h71-0-118" id="h71-0-118" class="d">-                None,
</a><a href="#h71-0-119" id="h71-0-119" class="d">-                Some(
</a><a href="#h71-0-120" id="h71-0-120" class="d">-                    &quot;rating&quot;,
</a><a href="#h71-0-121" id="h71-0-121" class="d">-                ),
</a><a href="#h71-0-122" id="h71-0-122" class="d">-            ],
</a><a href="#h71-0-123" id="h71-0-123" class="d">-            expressions: [
</a><a href="#h71-0-124" id="h71-0-124" class="d">-                Add(
</a><a href="#h71-0-125" id="h71-0-125" class="d">-                    Multiply(
</a><a href="#h71-0-126" id="h71-0-126" class="d">-                        Field(
</a><a href="#h71-0-127" id="h71-0-127" class="d">-                            None,
</a><a href="#h71-0-128" id="h71-0-128" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h71-0-129" id="h71-0-129" class="d">-                        ),
</a><a href="#h71-0-130" id="h71-0-130" class="d">-                        Constant(
</a><a href="#h71-0-131" id="h71-0-131" class="d">-                            Integer(
</a><a href="#h71-0-132" id="h71-0-132" class="d">-                                2,
</a><a href="#h71-0-133" id="h71-0-133" class="d">-                            ),
</a><a href="#h71-0-134" id="h71-0-134" class="d">-                        ),
</a><a href="#h71-0-135" id="h71-0-135" class="d">-                    ),
</a><a href="#h71-0-136" id="h71-0-136" class="d">-                    Constant(
</a><a href="#h71-0-137" id="h71-0-137" class="d">-                        Integer(
</a><a href="#h71-0-138" id="h71-0-138" class="d">-                            1,
</a><a href="#h71-0-139" id="h71-0-139" class="d">-                        ),
</a><a href="#h71-0-140" id="h71-0-140" class="d">-                    ),
</a><a href="#h71-0-141" id="h71-0-141" class="d">-                ),
</a><a href="#h71-0-142" id="h71-0-142" class="d">-                Column(
</a><a href="#h71-0-143" id="h71-0-143" class="d">-                    0,
</a><a href="#h71-0-144" id="h71-0-144" class="d">-                ),
</a><a href="#h71-0-145" id="h71-0-145" class="d">-            ],
</a><a href="#h71-0-146" id="h71-0-146" class="d">-        },
</a><a href="#h71-0-147" id="h71-0-147" class="d">-        orders: [
</a><a href="#h71-0-148" id="h71-0-148" class="d">-            (
</a><a href="#h71-0-149" id="h71-0-149" class="d">-                Field(
</a><a href="#h71-0-150" id="h71-0-150" class="d">-                    None,
</a><a href="#h71-0-151" id="h71-0-151" class="d">-                    &quot;rating&quot;,
</a><a href="#h71-0-152" id="h71-0-152" class="d">-                ),
</a><a href="#h71-0-153" id="h71-0-153" class="d">-                Ascending,
</a><a href="#h71-0-154" id="h71-0-154" class="d">-            ),
</a><a href="#h71-0-155" id="h71-0-155" class="d">-        ],
</a><a href="#h71-0-156" id="h71-0-156" class="d">-    },
</a><a href="#h71-0-157" id="h71-0-157" class="d">-)
</a><a href="#h71-0-158" id="h71-0-158" class="d">-
</a><a href="#h71-0-159" id="h71-0-159" class="d">-Query: SELECT studio_id * 2 + 1, MAX(rating) AS rating FROM movies GROUP BY studio_id * 2 ORDER BY rating
</a><a href="#h71-0-160" id="h71-0-160" class="d">-
</a><a href="#h71-0-161" id="h71-0-161" class="d">-Result: Value(&quot;Unknown field studio_id&quot;)
</a><a href="#h71-0-162" id="h71-0-162" class="d">-\ No newline at end of file
</a><a href="#h71-0-163" id="h71-0-163" class="i">+Plan: Value(&quot;Unknown field studio_id&quot;)
</a><a href="#h71-0-164" id="h71-0-164" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h72" href="../file/tests/sql/query/group_expr_multigroup.html">tests/sql/query/group_expr_multigroup</a> b/<a href="../file/tests/sql/query/group_expr_multigroup.html">tests/sql/query/group_expr_multigroup</a></b>
<a href="#h72-0" id="h72-0" class="h">@@ -87,7 +87,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h72-0-3" id="h72-0-3" class="d">-                        alias: None,
</a><a href="#h72-0-4" id="h72-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h72-1" id="h72-1" class="h">@@ -97,16 +97,31 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h72-1-3" id="h72-1-3" class="d">-                            None,
</a><a href="#h72-1-4" id="h72-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h72-1-5" id="h72-1-5" class="i">+                            5,
</a><a href="#h72-1-6" id="h72-1-6" class="i">+                            Some(
</a><a href="#h72-1-7" id="h72-1-7" class="i">+                                (
</a><a href="#h72-1-8" id="h72-1-8" class="i">+                                    None,
</a><a href="#h72-1-9" id="h72-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h72-1-10" id="h72-1-10" class="i">+                                ),
</a><a href="#h72-1-11" id="h72-1-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h72-1-14" id="h72-1-14" class="d">-                            None,
</a><a href="#h72-1-15" id="h72-1-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h72-1-16" id="h72-1-16" class="i">+                            2,
</a><a href="#h72-1-17" id="h72-1-17" class="i">+                            Some(
</a><a href="#h72-1-18" id="h72-1-18" class="i">+                                (
</a><a href="#h72-1-19" id="h72-1-19" class="i">+                                    None,
</a><a href="#h72-1-20" id="h72-1-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h72-1-21" id="h72-1-21" class="i">+                                ),
</a><a href="#h72-1-22" id="h72-1-22" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h72-1-25" id="h72-1-25" class="d">-                            None,
</a><a href="#h72-1-26" id="h72-1-26" class="d">-                            &quot;genre_id&quot;,
</a><a href="#h72-1-27" id="h72-1-27" class="i">+                            3,
</a><a href="#h72-1-28" id="h72-1-28" class="i">+                            Some(
</a><a href="#h72-1-29" id="h72-1-29" class="i">+                                (
</a><a href="#h72-1-30" id="h72-1-30" class="i">+                                    None,
</a><a href="#h72-1-31" id="h72-1-31" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h72-1-32" id="h72-1-32" class="i">+                                ),
</a><a href="#h72-1-33" id="h72-1-33" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h72-2" id="h72-2" class="h">@@ -125,31 +140,52 @@ Plan: Plan(
</a>             expressions: [
                 Add(
                     Field(
<a href="#h72-2-3" id="h72-2-3" class="d">-                        None,
</a><a href="#h72-2-4" id="h72-2-4" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h72-2-5" id="h72-2-5" class="i">+                        1,
</a><a href="#h72-2-6" id="h72-2-6" class="i">+                        Some(
</a><a href="#h72-2-7" id="h72-2-7" class="i">+                            (
</a><a href="#h72-2-8" id="h72-2-8" class="i">+                                None,
</a><a href="#h72-2-9" id="h72-2-9" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h72-2-10" id="h72-2-10" class="i">+                            ),
</a><a href="#h72-2-11" id="h72-2-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h72-2-14" id="h72-2-14" class="d">-                        None,
</a><a href="#h72-2-15" id="h72-2-15" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h72-2-16" id="h72-2-16" class="i">+                        2,
</a><a href="#h72-2-17" id="h72-2-17" class="i">+                        Some(
</a><a href="#h72-2-18" id="h72-2-18" class="i">+                            (
</a><a href="#h72-2-19" id="h72-2-19" class="i">+                                None,
</a><a href="#h72-2-20" id="h72-2-20" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h72-2-21" id="h72-2-21" class="i">+                            ),
</a><a href="#h72-2-22" id="h72-2-22" class="i">+                        ),
</a>                     ),
                 ),
<a href="#h72-2-25" id="h72-2-25" class="d">-                Column(
</a><a href="#h72-2-26" id="h72-2-26" class="i">+                Field(
</a>                     0,
<a href="#h72-2-28" id="h72-2-28" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h72-2-35" id="h72-2-35" class="d">-                    None,
</a><a href="#h72-2-36" id="h72-2-36" class="d">-                    &quot;rating&quot;,
</a><a href="#h72-2-37" id="h72-2-37" class="i">+                    1,
</a><a href="#h72-2-38" id="h72-2-38" class="i">+                    Some(
</a><a href="#h72-2-39" id="h72-2-39" class="i">+                        (
</a><a href="#h72-2-40" id="h72-2-40" class="i">+                            None,
</a><a href="#h72-2-41" id="h72-2-41" class="i">+                            &quot;rating&quot;,
</a><a href="#h72-2-42" id="h72-2-42" class="i">+                        ),
</a><a href="#h72-2-43" id="h72-2-43" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h72-2-49" id="h72-2-49" class="d">-                    None,
</a><a href="#h72-2-50" id="h72-2-50" class="d">-                    &quot;multi&quot;,
</a><a href="#h72-2-51" id="h72-2-51" class="i">+                    0,
</a><a href="#h72-2-52" id="h72-2-52" class="i">+                    Some(
</a><a href="#h72-2-53" id="h72-2-53" class="i">+                        (
</a><a href="#h72-2-54" id="h72-2-54" class="i">+                            None,
</a><a href="#h72-2-55" id="h72-2-55" class="i">+                            &quot;multi&quot;,
</a><a href="#h72-2-56" id="h72-2-56" class="i">+                        ),
</a><a href="#h72-2-57" id="h72-2-57" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h72-3" id="h72-3" class="h">@@ -164,7 +200,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h72-3-3" id="h72-3-3" class="d">-                        alias: None,
</a><a href="#h72-3-4" id="h72-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h72-4" id="h72-4" class="h">@@ -174,16 +210,31 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h72-4-3" id="h72-4-3" class="d">-                            None,
</a><a href="#h72-4-4" id="h72-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h72-4-5" id="h72-4-5" class="i">+                            5,
</a><a href="#h72-4-6" id="h72-4-6" class="i">+                            Some(
</a><a href="#h72-4-7" id="h72-4-7" class="i">+                                (
</a><a href="#h72-4-8" id="h72-4-8" class="i">+                                    None,
</a><a href="#h72-4-9" id="h72-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h72-4-10" id="h72-4-10" class="i">+                                ),
</a><a href="#h72-4-11" id="h72-4-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h72-4-14" id="h72-4-14" class="d">-                            None,
</a><a href="#h72-4-15" id="h72-4-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h72-4-16" id="h72-4-16" class="i">+                            2,
</a><a href="#h72-4-17" id="h72-4-17" class="i">+                            Some(
</a><a href="#h72-4-18" id="h72-4-18" class="i">+                                (
</a><a href="#h72-4-19" id="h72-4-19" class="i">+                                    None,
</a><a href="#h72-4-20" id="h72-4-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h72-4-21" id="h72-4-21" class="i">+                                ),
</a><a href="#h72-4-22" id="h72-4-22" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h72-4-25" id="h72-4-25" class="d">-                            None,
</a><a href="#h72-4-26" id="h72-4-26" class="d">-                            &quot;genre_id&quot;,
</a><a href="#h72-4-27" id="h72-4-27" class="i">+                            3,
</a><a href="#h72-4-28" id="h72-4-28" class="i">+                            Some(
</a><a href="#h72-4-29" id="h72-4-29" class="i">+                                (
</a><a href="#h72-4-30" id="h72-4-30" class="i">+                                    None,
</a><a href="#h72-4-31" id="h72-4-31" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h72-4-32" id="h72-4-32" class="i">+                                ),
</a><a href="#h72-4-33" id="h72-4-33" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h72-5" id="h72-5" class="h">@@ -202,31 +253,52 @@ Optimized plan: Plan(
</a>             expressions: [
                 Add(
                     Field(
<a href="#h72-5-3" id="h72-5-3" class="d">-                        None,
</a><a href="#h72-5-4" id="h72-5-4" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h72-5-5" id="h72-5-5" class="i">+                        1,
</a><a href="#h72-5-6" id="h72-5-6" class="i">+                        Some(
</a><a href="#h72-5-7" id="h72-5-7" class="i">+                            (
</a><a href="#h72-5-8" id="h72-5-8" class="i">+                                None,
</a><a href="#h72-5-9" id="h72-5-9" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h72-5-10" id="h72-5-10" class="i">+                            ),
</a><a href="#h72-5-11" id="h72-5-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h72-5-14" id="h72-5-14" class="d">-                        None,
</a><a href="#h72-5-15" id="h72-5-15" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h72-5-16" id="h72-5-16" class="i">+                        2,
</a><a href="#h72-5-17" id="h72-5-17" class="i">+                        Some(
</a><a href="#h72-5-18" id="h72-5-18" class="i">+                            (
</a><a href="#h72-5-19" id="h72-5-19" class="i">+                                None,
</a><a href="#h72-5-20" id="h72-5-20" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h72-5-21" id="h72-5-21" class="i">+                            ),
</a><a href="#h72-5-22" id="h72-5-22" class="i">+                        ),
</a>                     ),
                 ),
<a href="#h72-5-25" id="h72-5-25" class="d">-                Column(
</a><a href="#h72-5-26" id="h72-5-26" class="i">+                Field(
</a>                     0,
<a href="#h72-5-28" id="h72-5-28" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h72-5-35" id="h72-5-35" class="d">-                    None,
</a><a href="#h72-5-36" id="h72-5-36" class="d">-                    &quot;rating&quot;,
</a><a href="#h72-5-37" id="h72-5-37" class="i">+                    1,
</a><a href="#h72-5-38" id="h72-5-38" class="i">+                    Some(
</a><a href="#h72-5-39" id="h72-5-39" class="i">+                        (
</a><a href="#h72-5-40" id="h72-5-40" class="i">+                            None,
</a><a href="#h72-5-41" id="h72-5-41" class="i">+                            &quot;rating&quot;,
</a><a href="#h72-5-42" id="h72-5-42" class="i">+                        ),
</a><a href="#h72-5-43" id="h72-5-43" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h72-5-49" id="h72-5-49" class="d">-                    None,
</a><a href="#h72-5-50" id="h72-5-50" class="d">-                    &quot;multi&quot;,
</a><a href="#h72-5-51" id="h72-5-51" class="i">+                    0,
</a><a href="#h72-5-52" id="h72-5-52" class="i">+                    Some(
</a><a href="#h72-5-53" id="h72-5-53" class="i">+                        (
</a><a href="#h72-5-54" id="h72-5-54" class="i">+                            None,
</a><a href="#h72-5-55" id="h72-5-55" class="i">+                            &quot;multi&quot;,
</a><a href="#h72-5-56" id="h72-5-56" class="i">+                        ),
</a><a href="#h72-5-57" id="h72-5-57" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h73" href="../file/tests/sql/query/group_expr_select.html">tests/sql/query/group_expr_select</a> b/<a href="../file/tests/sql/query/group_expr_select.html">tests/sql/query/group_expr_select</a></b>
<a href="#h73-0" id="h73-0" class="h">@@ -75,7 +75,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h73-0-3" id="h73-0-3" class="d">-                        alias: None,
</a><a href="#h73-0-4" id="h73-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h73-1" id="h73-1" class="h">@@ -84,12 +84,22 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h73-1-3" id="h73-1-3" class="d">-                            None,
</a><a href="#h73-1-4" id="h73-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h73-1-5" id="h73-1-5" class="i">+                            5,
</a><a href="#h73-1-6" id="h73-1-6" class="i">+                            Some(
</a><a href="#h73-1-7" id="h73-1-7" class="i">+                                (
</a><a href="#h73-1-8" id="h73-1-8" class="i">+                                    None,
</a><a href="#h73-1-9" id="h73-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h73-1-10" id="h73-1-10" class="i">+                                ),
</a><a href="#h73-1-11" id="h73-1-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h73-1-14" id="h73-1-14" class="d">-                            None,
</a><a href="#h73-1-15" id="h73-1-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h73-1-16" id="h73-1-16" class="i">+                            2,
</a><a href="#h73-1-17" id="h73-1-17" class="i">+                            Some(
</a><a href="#h73-1-18" id="h73-1-18" class="i">+                                (
</a><a href="#h73-1-19" id="h73-1-19" class="i">+                                    None,
</a><a href="#h73-1-20" id="h73-1-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h73-1-21" id="h73-1-21" class="i">+                                ),
</a><a href="#h73-1-22" id="h73-1-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h73-2" id="h73-2" class="h">@@ -106,8 +116,13 @@ Plan: Plan(
</a>             expressions: [
                 Multiply(
                     Field(
<a href="#h73-2-3" id="h73-2-3" class="d">-                        None,
</a><a href="#h73-2-4" id="h73-2-4" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h73-2-5" id="h73-2-5" class="i">+                        1,
</a><a href="#h73-2-6" id="h73-2-6" class="i">+                        Some(
</a><a href="#h73-2-7" id="h73-2-7" class="i">+                            (
</a><a href="#h73-2-8" id="h73-2-8" class="i">+                                None,
</a><a href="#h73-2-9" id="h73-2-9" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h73-2-10" id="h73-2-10" class="i">+                            ),
</a><a href="#h73-2-11" id="h73-2-11" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h73-3" id="h73-3" class="h">@@ -115,16 +130,22 @@ Plan: Plan(
</a>                         ),
                     ),
                 ),
<a href="#h73-3-3" id="h73-3-3" class="d">-                Column(
</a><a href="#h73-3-4" id="h73-3-4" class="i">+                Field(
</a>                     0,
<a href="#h73-3-6" id="h73-3-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h73-3-13" id="h73-3-13" class="d">-                    None,
</a><a href="#h73-3-14" id="h73-3-14" class="d">-                    &quot;rating&quot;,
</a><a href="#h73-3-15" id="h73-3-15" class="i">+                    1,
</a><a href="#h73-3-16" id="h73-3-16" class="i">+                    Some(
</a><a href="#h73-3-17" id="h73-3-17" class="i">+                        (
</a><a href="#h73-3-18" id="h73-3-18" class="i">+                            None,
</a><a href="#h73-3-19" id="h73-3-19" class="i">+                            &quot;rating&quot;,
</a><a href="#h73-3-20" id="h73-3-20" class="i">+                        ),
</a><a href="#h73-3-21" id="h73-3-21" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h73-4" id="h73-4" class="h">@@ -139,7 +160,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h73-4-3" id="h73-4-3" class="d">-                        alias: None,
</a><a href="#h73-4-4" id="h73-4-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h73-5" id="h73-5" class="h">@@ -148,12 +169,22 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h73-5-3" id="h73-5-3" class="d">-                            None,
</a><a href="#h73-5-4" id="h73-5-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h73-5-5" id="h73-5-5" class="i">+                            5,
</a><a href="#h73-5-6" id="h73-5-6" class="i">+                            Some(
</a><a href="#h73-5-7" id="h73-5-7" class="i">+                                (
</a><a href="#h73-5-8" id="h73-5-8" class="i">+                                    None,
</a><a href="#h73-5-9" id="h73-5-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h73-5-10" id="h73-5-10" class="i">+                                ),
</a><a href="#h73-5-11" id="h73-5-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h73-5-14" id="h73-5-14" class="d">-                            None,
</a><a href="#h73-5-15" id="h73-5-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h73-5-16" id="h73-5-16" class="i">+                            2,
</a><a href="#h73-5-17" id="h73-5-17" class="i">+                            Some(
</a><a href="#h73-5-18" id="h73-5-18" class="i">+                                (
</a><a href="#h73-5-19" id="h73-5-19" class="i">+                                    None,
</a><a href="#h73-5-20" id="h73-5-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h73-5-21" id="h73-5-21" class="i">+                                ),
</a><a href="#h73-5-22" id="h73-5-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h73-6" id="h73-6" class="h">@@ -170,8 +201,13 @@ Optimized plan: Plan(
</a>             expressions: [
                 Multiply(
                     Field(
<a href="#h73-6-3" id="h73-6-3" class="d">-                        None,
</a><a href="#h73-6-4" id="h73-6-4" class="d">-                        &quot;studio_id&quot;,
</a><a href="#h73-6-5" id="h73-6-5" class="i">+                        1,
</a><a href="#h73-6-6" id="h73-6-6" class="i">+                        Some(
</a><a href="#h73-6-7" id="h73-6-7" class="i">+                            (
</a><a href="#h73-6-8" id="h73-6-8" class="i">+                                None,
</a><a href="#h73-6-9" id="h73-6-9" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h73-6-10" id="h73-6-10" class="i">+                            ),
</a><a href="#h73-6-11" id="h73-6-11" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h73-7" id="h73-7" class="h">@@ -179,16 +215,22 @@ Optimized plan: Plan(
</a>                         ),
                     ),
                 ),
<a href="#h73-7-3" id="h73-7-3" class="d">-                Column(
</a><a href="#h73-7-4" id="h73-7-4" class="i">+                Field(
</a>                     0,
<a href="#h73-7-6" id="h73-7-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h73-7-13" id="h73-7-13" class="d">-                    None,
</a><a href="#h73-7-14" id="h73-7-14" class="d">-                    &quot;rating&quot;,
</a><a href="#h73-7-15" id="h73-7-15" class="i">+                    1,
</a><a href="#h73-7-16" id="h73-7-16" class="i">+                    Some(
</a><a href="#h73-7-17" id="h73-7-17" class="i">+                        (
</a><a href="#h73-7-18" id="h73-7-18" class="i">+                            None,
</a><a href="#h73-7-19" id="h73-7-19" class="i">+                            &quot;rating&quot;,
</a><a href="#h73-7-20" id="h73-7-20" class="i">+                        ),
</a><a href="#h73-7-21" id="h73-7-21" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h74" href="../file/tests/sql/query/group_join.html">tests/sql/query/group_join</a> b/<a href="../file/tests/sql/query/group_join.html">tests/sql/query/group_join</a></b>
<a href="#h74-0" id="h74-0" class="h">@@ -101,31 +101,37 @@ Plan: Plan(
</a>                     source: NestedLoopJoin {
                         outer: Scan {
                             table: &quot;movies&quot;,
<a href="#h74-0-3" id="h74-0-3" class="d">-                            alias: Some(
</a><a href="#h74-0-4" id="h74-0-4" class="d">-                                &quot;m&quot;,
</a><a href="#h74-0-5" id="h74-0-5" class="d">-                            ),
</a><a href="#h74-0-6" id="h74-0-6" class="i">+                            label: &quot;m&quot;,
</a>                             filter: None,
                         },
                         inner: Scan {
                             table: &quot;studios&quot;,
<a href="#h74-0-11" id="h74-0-11" class="d">-                            alias: Some(
</a><a href="#h74-0-12" id="h74-0-12" class="d">-                                &quot;s&quot;,
</a><a href="#h74-0-13" id="h74-0-13" class="d">-                            ),
</a><a href="#h74-0-14" id="h74-0-14" class="i">+                            label: &quot;s&quot;,
</a>                             filter: None,
                         },
                         predicate: Some(
                             Equal(
                                 Field(
<a href="#h74-0-20" id="h74-0-20" class="i">+                                    2,
</a>                                     Some(
<a href="#h74-0-22" id="h74-0-22" class="d">-                                        &quot;m&quot;,
</a><a href="#h74-0-23" id="h74-0-23" class="i">+                                        (
</a><a href="#h74-0-24" id="h74-0-24" class="i">+                                            Some(
</a><a href="#h74-0-25" id="h74-0-25" class="i">+                                                &quot;m&quot;,
</a><a href="#h74-0-26" id="h74-0-26" class="i">+                                            ),
</a><a href="#h74-0-27" id="h74-0-27" class="i">+                                            &quot;studio_id&quot;,
</a><a href="#h74-0-28" id="h74-0-28" class="i">+                                        ),
</a>                                     ),
<a href="#h74-0-30" id="h74-0-30" class="d">-                                    &quot;studio_id&quot;,
</a>                                 ),
                                 Field(
<a href="#h74-0-33" id="h74-0-33" class="i">+                                    7,
</a>                                     Some(
<a href="#h74-0-35" id="h74-0-35" class="d">-                                        &quot;s&quot;,
</a><a href="#h74-0-36" id="h74-0-36" class="i">+                                        (
</a><a href="#h74-0-37" id="h74-0-37" class="i">+                                            Some(
</a><a href="#h74-0-38" id="h74-0-38" class="i">+                                                &quot;s&quot;,
</a><a href="#h74-0-39" id="h74-0-39" class="i">+                                            ),
</a><a href="#h74-0-40" id="h74-0-40" class="i">+                                            &quot;id&quot;,
</a><a href="#h74-0-41" id="h74-0-41" class="i">+                                        ),
</a>                                     ),
<a href="#h74-0-43" id="h74-0-43" class="d">-                                    &quot;id&quot;,
</a>                                 ),
                             ),
                         ),
<a href="#h74-1" id="h74-1" class="h">@@ -143,10 +149,15 @@ Plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h74-1-3" id="h74-1-3" class="i">+                            8,
</a>                             Some(
<a href="#h74-1-5" id="h74-1-5" class="d">-                                &quot;s&quot;,
</a><a href="#h74-1-6" id="h74-1-6" class="i">+                                (
</a><a href="#h74-1-7" id="h74-1-7" class="i">+                                    Some(
</a><a href="#h74-1-8" id="h74-1-8" class="i">+                                        &quot;s&quot;,
</a><a href="#h74-1-9" id="h74-1-9" class="i">+                                    ),
</a><a href="#h74-1-10" id="h74-1-10" class="i">+                                    &quot;name&quot;,
</a><a href="#h74-1-11" id="h74-1-11" class="i">+                                ),
</a>                             ),
<a href="#h74-1-13" id="h74-1-13" class="d">-                            &quot;name&quot;,
</a>                         ),
                     ],
                 },
<a href="#h74-2" id="h74-2" class="h">@@ -159,21 +170,28 @@ Plan: Plan(
</a>                 None,
             ],
             expressions: [
<a href="#h74-2-3" id="h74-2-3" class="d">-                Column(
</a><a href="#h74-2-4" id="h74-2-4" class="i">+                Field(
</a>                     1,
<a href="#h74-2-6" id="h74-2-6" class="i">+                    None,
</a>                 ),
<a href="#h74-2-8" id="h74-2-8" class="d">-                Column(
</a><a href="#h74-2-9" id="h74-2-9" class="i">+                Field(
</a>                     0,
<a href="#h74-2-11" id="h74-2-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h74-2-18" id="h74-2-18" class="i">+                    0,
</a>                     Some(
<a href="#h74-2-20" id="h74-2-20" class="d">-                        &quot;s&quot;,
</a><a href="#h74-2-21" id="h74-2-21" class="i">+                        (
</a><a href="#h74-2-22" id="h74-2-22" class="i">+                            Some(
</a><a href="#h74-2-23" id="h74-2-23" class="i">+                                &quot;s&quot;,
</a><a href="#h74-2-24" id="h74-2-24" class="i">+                            ),
</a><a href="#h74-2-25" id="h74-2-25" class="i">+                            &quot;name&quot;,
</a><a href="#h74-2-26" id="h74-2-26" class="i">+                        ),
</a>                     ),
<a href="#h74-2-28" id="h74-2-28" class="d">-                    &quot;name&quot;,
</a>                 ),
                 Ascending,
             ),
<a href="#h74-3" id="h74-3" class="h">@@ -189,31 +207,37 @@ Optimized plan: Plan(
</a>                     source: NestedLoopJoin {
                         outer: Scan {
                             table: &quot;movies&quot;,
<a href="#h74-3-3" id="h74-3-3" class="d">-                            alias: Some(
</a><a href="#h74-3-4" id="h74-3-4" class="d">-                                &quot;m&quot;,
</a><a href="#h74-3-5" id="h74-3-5" class="d">-                            ),
</a><a href="#h74-3-6" id="h74-3-6" class="i">+                            label: &quot;m&quot;,
</a>                             filter: None,
                         },
                         inner: Scan {
                             table: &quot;studios&quot;,
<a href="#h74-3-11" id="h74-3-11" class="d">-                            alias: Some(
</a><a href="#h74-3-12" id="h74-3-12" class="d">-                                &quot;s&quot;,
</a><a href="#h74-3-13" id="h74-3-13" class="d">-                            ),
</a><a href="#h74-3-14" id="h74-3-14" class="i">+                            label: &quot;s&quot;,
</a>                             filter: None,
                         },
                         predicate: Some(
                             Equal(
                                 Field(
<a href="#h74-3-20" id="h74-3-20" class="i">+                                    2,
</a>                                     Some(
<a href="#h74-3-22" id="h74-3-22" class="d">-                                        &quot;m&quot;,
</a><a href="#h74-3-23" id="h74-3-23" class="i">+                                        (
</a><a href="#h74-3-24" id="h74-3-24" class="i">+                                            Some(
</a><a href="#h74-3-25" id="h74-3-25" class="i">+                                                &quot;m&quot;,
</a><a href="#h74-3-26" id="h74-3-26" class="i">+                                            ),
</a><a href="#h74-3-27" id="h74-3-27" class="i">+                                            &quot;studio_id&quot;,
</a><a href="#h74-3-28" id="h74-3-28" class="i">+                                        ),
</a>                                     ),
<a href="#h74-3-30" id="h74-3-30" class="d">-                                    &quot;studio_id&quot;,
</a>                                 ),
                                 Field(
<a href="#h74-3-33" id="h74-3-33" class="i">+                                    7,
</a>                                     Some(
<a href="#h74-3-35" id="h74-3-35" class="d">-                                        &quot;s&quot;,
</a><a href="#h74-3-36" id="h74-3-36" class="i">+                                        (
</a><a href="#h74-3-37" id="h74-3-37" class="i">+                                            Some(
</a><a href="#h74-3-38" id="h74-3-38" class="i">+                                                &quot;s&quot;,
</a><a href="#h74-3-39" id="h74-3-39" class="i">+                                            ),
</a><a href="#h74-3-40" id="h74-3-40" class="i">+                                            &quot;id&quot;,
</a><a href="#h74-3-41" id="h74-3-41" class="i">+                                        ),
</a>                                     ),
<a href="#h74-3-43" id="h74-3-43" class="d">-                                    &quot;id&quot;,
</a>                                 ),
                             ),
                         ),
<a href="#h74-4" id="h74-4" class="h">@@ -231,10 +255,15 @@ Optimized plan: Plan(
</a>                             ),
                         ),
                         Field(
<a href="#h74-4-3" id="h74-4-3" class="i">+                            8,
</a>                             Some(
<a href="#h74-4-5" id="h74-4-5" class="d">-                                &quot;s&quot;,
</a><a href="#h74-4-6" id="h74-4-6" class="i">+                                (
</a><a href="#h74-4-7" id="h74-4-7" class="i">+                                    Some(
</a><a href="#h74-4-8" id="h74-4-8" class="i">+                                        &quot;s&quot;,
</a><a href="#h74-4-9" id="h74-4-9" class="i">+                                    ),
</a><a href="#h74-4-10" id="h74-4-10" class="i">+                                    &quot;name&quot;,
</a><a href="#h74-4-11" id="h74-4-11" class="i">+                                ),
</a>                             ),
<a href="#h74-4-13" id="h74-4-13" class="d">-                            &quot;name&quot;,
</a>                         ),
                     ],
                 },
<a href="#h74-5" id="h74-5" class="h">@@ -247,21 +276,28 @@ Optimized plan: Plan(
</a>                 None,
             ],
             expressions: [
<a href="#h74-5-3" id="h74-5-3" class="d">-                Column(
</a><a href="#h74-5-4" id="h74-5-4" class="i">+                Field(
</a>                     1,
<a href="#h74-5-6" id="h74-5-6" class="i">+                    None,
</a>                 ),
<a href="#h74-5-8" id="h74-5-8" class="d">-                Column(
</a><a href="#h74-5-9" id="h74-5-9" class="i">+                Field(
</a>                     0,
<a href="#h74-5-11" id="h74-5-11" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h74-5-18" id="h74-5-18" class="i">+                    0,
</a>                     Some(
<a href="#h74-5-20" id="h74-5-20" class="d">-                        &quot;s&quot;,
</a><a href="#h74-5-21" id="h74-5-21" class="i">+                        (
</a><a href="#h74-5-22" id="h74-5-22" class="i">+                            Some(
</a><a href="#h74-5-23" id="h74-5-23" class="i">+                                &quot;s&quot;,
</a><a href="#h74-5-24" id="h74-5-24" class="i">+                            ),
</a><a href="#h74-5-25" id="h74-5-25" class="i">+                            &quot;name&quot;,
</a><a href="#h74-5-26" id="h74-5-26" class="i">+                        ),
</a>                     ),
<a href="#h74-5-28" id="h74-5-28" class="d">-                    &quot;name&quot;,
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h75" href="../file/tests/sql/query/group_noaggregate.html">tests/sql/query/group_noaggregate</a> b/<a href="../file/tests/sql/query/group_noaggregate.html">tests/sql/query/group_noaggregate</a></b>
<a href="#h75-0" id="h75-0" class="h">@@ -50,37 +50,50 @@ AST: Select {
</a> Plan: Plan(
     Order {
         source: Projection {
<a href="#h75-0-3" id="h75-0-3" class="d">-            source: Projection {
</a><a href="#h75-0-4" id="h75-0-4" class="d">-                source: Scan {
</a><a href="#h75-0-5" id="h75-0-5" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h75-0-6" id="h75-0-6" class="d">-                    alias: None,
</a><a href="#h75-0-7" id="h75-0-7" class="d">-                    filter: None,
</a><a href="#h75-0-8" id="h75-0-8" class="d">-                },
</a><a href="#h75-0-9" id="h75-0-9" class="d">-                labels: [
</a><a href="#h75-0-10" id="h75-0-10" class="d">-                    None,
</a><a href="#h75-0-11" id="h75-0-11" class="d">-                ],
</a><a href="#h75-0-12" id="h75-0-12" class="d">-                expressions: [
</a><a href="#h75-0-13" id="h75-0-13" class="d">-                    Field(
</a><a href="#h75-0-14" id="h75-0-14" class="i">+            source: Aggregation {
</a><a href="#h75-0-15" id="h75-0-15" class="i">+                source: Projection {
</a><a href="#h75-0-16" id="h75-0-16" class="i">+                    source: Scan {
</a><a href="#h75-0-17" id="h75-0-17" class="i">+                        table: &quot;movies&quot;,
</a><a href="#h75-0-18" id="h75-0-18" class="i">+                        label: &quot;movies&quot;,
</a><a href="#h75-0-19" id="h75-0-19" class="i">+                        filter: None,
</a><a href="#h75-0-20" id="h75-0-20" class="i">+                    },
</a><a href="#h75-0-21" id="h75-0-21" class="i">+                    labels: [
</a>                         None,
<a href="#h75-0-23" id="h75-0-23" class="d">-                        &quot;title&quot;,
</a><a href="#h75-0-24" id="h75-0-24" class="d">-                    ),
</a><a href="#h75-0-25" id="h75-0-25" class="d">-                ],
</a><a href="#h75-0-26" id="h75-0-26" class="i">+                    ],
</a><a href="#h75-0-27" id="h75-0-27" class="i">+                    expressions: [
</a><a href="#h75-0-28" id="h75-0-28" class="i">+                        Field(
</a><a href="#h75-0-29" id="h75-0-29" class="i">+                            1,
</a><a href="#h75-0-30" id="h75-0-30" class="i">+                            Some(
</a><a href="#h75-0-31" id="h75-0-31" class="i">+                                (
</a><a href="#h75-0-32" id="h75-0-32" class="i">+                                    None,
</a><a href="#h75-0-33" id="h75-0-33" class="i">+                                    &quot;title&quot;,
</a><a href="#h75-0-34" id="h75-0-34" class="i">+                                ),
</a><a href="#h75-0-35" id="h75-0-35" class="i">+                            ),
</a><a href="#h75-0-36" id="h75-0-36" class="i">+                        ),
</a><a href="#h75-0-37" id="h75-0-37" class="i">+                    ],
</a><a href="#h75-0-38" id="h75-0-38" class="i">+                },
</a><a href="#h75-0-39" id="h75-0-39" class="i">+                aggregates: [],
</a>             },
             labels: [
                 None,
             ],
             expressions: [
                 Field(
<a href="#h75-0-46" id="h75-0-46" class="i">+                    0,
</a>                     None,
<a href="#h75-0-48" id="h75-0-48" class="d">-                    &quot;title&quot;,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h75-0-55" id="h75-0-55" class="d">-                    None,
</a><a href="#h75-0-56" id="h75-0-56" class="d">-                    &quot;title&quot;,
</a><a href="#h75-0-57" id="h75-0-57" class="i">+                    0,
</a><a href="#h75-0-58" id="h75-0-58" class="i">+                    Some(
</a><a href="#h75-0-59" id="h75-0-59" class="i">+                        (
</a><a href="#h75-0-60" id="h75-0-60" class="i">+                            None,
</a><a href="#h75-0-61" id="h75-0-61" class="i">+                            &quot;title&quot;,
</a><a href="#h75-0-62" id="h75-0-62" class="i">+                        ),
</a><a href="#h75-0-63" id="h75-0-63" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h75-1" id="h75-1" class="h">@@ -91,37 +104,50 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Order {
         source: Projection {
<a href="#h75-1-3" id="h75-1-3" class="d">-            source: Projection {
</a><a href="#h75-1-4" id="h75-1-4" class="d">-                source: Scan {
</a><a href="#h75-1-5" id="h75-1-5" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h75-1-6" id="h75-1-6" class="d">-                    alias: None,
</a><a href="#h75-1-7" id="h75-1-7" class="d">-                    filter: None,
</a><a href="#h75-1-8" id="h75-1-8" class="d">-                },
</a><a href="#h75-1-9" id="h75-1-9" class="d">-                labels: [
</a><a href="#h75-1-10" id="h75-1-10" class="d">-                    None,
</a><a href="#h75-1-11" id="h75-1-11" class="d">-                ],
</a><a href="#h75-1-12" id="h75-1-12" class="d">-                expressions: [
</a><a href="#h75-1-13" id="h75-1-13" class="d">-                    Field(
</a><a href="#h75-1-14" id="h75-1-14" class="i">+            source: Aggregation {
</a><a href="#h75-1-15" id="h75-1-15" class="i">+                source: Projection {
</a><a href="#h75-1-16" id="h75-1-16" class="i">+                    source: Scan {
</a><a href="#h75-1-17" id="h75-1-17" class="i">+                        table: &quot;movies&quot;,
</a><a href="#h75-1-18" id="h75-1-18" class="i">+                        label: &quot;movies&quot;,
</a><a href="#h75-1-19" id="h75-1-19" class="i">+                        filter: None,
</a><a href="#h75-1-20" id="h75-1-20" class="i">+                    },
</a><a href="#h75-1-21" id="h75-1-21" class="i">+                    labels: [
</a>                         None,
<a href="#h75-1-23" id="h75-1-23" class="d">-                        &quot;title&quot;,
</a><a href="#h75-1-24" id="h75-1-24" class="d">-                    ),
</a><a href="#h75-1-25" id="h75-1-25" class="d">-                ],
</a><a href="#h75-1-26" id="h75-1-26" class="i">+                    ],
</a><a href="#h75-1-27" id="h75-1-27" class="i">+                    expressions: [
</a><a href="#h75-1-28" id="h75-1-28" class="i">+                        Field(
</a><a href="#h75-1-29" id="h75-1-29" class="i">+                            1,
</a><a href="#h75-1-30" id="h75-1-30" class="i">+                            Some(
</a><a href="#h75-1-31" id="h75-1-31" class="i">+                                (
</a><a href="#h75-1-32" id="h75-1-32" class="i">+                                    None,
</a><a href="#h75-1-33" id="h75-1-33" class="i">+                                    &quot;title&quot;,
</a><a href="#h75-1-34" id="h75-1-34" class="i">+                                ),
</a><a href="#h75-1-35" id="h75-1-35" class="i">+                            ),
</a><a href="#h75-1-36" id="h75-1-36" class="i">+                        ),
</a><a href="#h75-1-37" id="h75-1-37" class="i">+                    ],
</a><a href="#h75-1-38" id="h75-1-38" class="i">+                },
</a><a href="#h75-1-39" id="h75-1-39" class="i">+                aggregates: [],
</a>             },
             labels: [
                 None,
             ],
             expressions: [
                 Field(
<a href="#h75-1-46" id="h75-1-46" class="i">+                    0,
</a>                     None,
<a href="#h75-1-48" id="h75-1-48" class="d">-                    &quot;title&quot;,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h75-1-55" id="h75-1-55" class="d">-                    None,
</a><a href="#h75-1-56" id="h75-1-56" class="d">-                    &quot;title&quot;,
</a><a href="#h75-1-57" id="h75-1-57" class="i">+                    0,
</a><a href="#h75-1-58" id="h75-1-58" class="i">+                    Some(
</a><a href="#h75-1-59" id="h75-1-59" class="i">+                        (
</a><a href="#h75-1-60" id="h75-1-60" class="i">+                            None,
</a><a href="#h75-1-61" id="h75-1-61" class="i">+                            &quot;title&quot;,
</a><a href="#h75-1-62" id="h75-1-62" class="i">+                        ),
</a><a href="#h75-1-63" id="h75-1-63" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h76" href="../file/tests/sql/query/group_noselect.html">tests/sql/query/group_noselect</a> b/<a href="../file/tests/sql/query/group_noselect.html">tests/sql/query/group_noselect</a></b>
<a href="#h76-0" id="h76-0" class="h">@@ -61,7 +61,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h76-0-3" id="h76-0-3" class="d">-                        alias: None,
</a><a href="#h76-0-4" id="h76-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h76-1" id="h76-1" class="h">@@ -70,12 +70,22 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h76-1-3" id="h76-1-3" class="d">-                            None,
</a><a href="#h76-1-4" id="h76-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h76-1-5" id="h76-1-5" class="i">+                            5,
</a><a href="#h76-1-6" id="h76-1-6" class="i">+                            Some(
</a><a href="#h76-1-7" id="h76-1-7" class="i">+                                (
</a><a href="#h76-1-8" id="h76-1-8" class="i">+                                    None,
</a><a href="#h76-1-9" id="h76-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h76-1-10" id="h76-1-10" class="i">+                                ),
</a><a href="#h76-1-11" id="h76-1-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h76-1-14" id="h76-1-14" class="d">-                            None,
</a><a href="#h76-1-15" id="h76-1-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h76-1-16" id="h76-1-16" class="i">+                            2,
</a><a href="#h76-1-17" id="h76-1-17" class="i">+                            Some(
</a><a href="#h76-1-18" id="h76-1-18" class="i">+                                (
</a><a href="#h76-1-19" id="h76-1-19" class="i">+                                    None,
</a><a href="#h76-1-20" id="h76-1-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h76-1-21" id="h76-1-21" class="i">+                                ),
</a><a href="#h76-1-22" id="h76-1-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h76-2" id="h76-2" class="h">@@ -89,16 +99,22 @@ Plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h76-2-3" id="h76-2-3" class="d">-                Column(
</a><a href="#h76-2-4" id="h76-2-4" class="i">+                Field(
</a>                     0,
<a href="#h76-2-6" id="h76-2-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h76-2-13" id="h76-2-13" class="d">-                    None,
</a><a href="#h76-2-14" id="h76-2-14" class="d">-                    &quot;best&quot;,
</a><a href="#h76-2-15" id="h76-2-15" class="i">+                    0,
</a><a href="#h76-2-16" id="h76-2-16" class="i">+                    Some(
</a><a href="#h76-2-17" id="h76-2-17" class="i">+                        (
</a><a href="#h76-2-18" id="h76-2-18" class="i">+                            None,
</a><a href="#h76-2-19" id="h76-2-19" class="i">+                            &quot;best&quot;,
</a><a href="#h76-2-20" id="h76-2-20" class="i">+                        ),
</a><a href="#h76-2-21" id="h76-2-21" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h76-3" id="h76-3" class="h">@@ -113,7 +129,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h76-3-3" id="h76-3-3" class="d">-                        alias: None,
</a><a href="#h76-3-4" id="h76-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h76-4" id="h76-4" class="h">@@ -122,12 +138,22 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h76-4-3" id="h76-4-3" class="d">-                            None,
</a><a href="#h76-4-4" id="h76-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h76-4-5" id="h76-4-5" class="i">+                            5,
</a><a href="#h76-4-6" id="h76-4-6" class="i">+                            Some(
</a><a href="#h76-4-7" id="h76-4-7" class="i">+                                (
</a><a href="#h76-4-8" id="h76-4-8" class="i">+                                    None,
</a><a href="#h76-4-9" id="h76-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h76-4-10" id="h76-4-10" class="i">+                                ),
</a><a href="#h76-4-11" id="h76-4-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h76-4-14" id="h76-4-14" class="d">-                            None,
</a><a href="#h76-4-15" id="h76-4-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h76-4-16" id="h76-4-16" class="i">+                            2,
</a><a href="#h76-4-17" id="h76-4-17" class="i">+                            Some(
</a><a href="#h76-4-18" id="h76-4-18" class="i">+                                (
</a><a href="#h76-4-19" id="h76-4-19" class="i">+                                    None,
</a><a href="#h76-4-20" id="h76-4-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h76-4-21" id="h76-4-21" class="i">+                                ),
</a><a href="#h76-4-22" id="h76-4-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h76-5" id="h76-5" class="h">@@ -141,16 +167,22 @@ Optimized plan: Plan(
</a>                 ),
             ],
             expressions: [
<a href="#h76-5-3" id="h76-5-3" class="d">-                Column(
</a><a href="#h76-5-4" id="h76-5-4" class="i">+                Field(
</a>                     0,
<a href="#h76-5-6" id="h76-5-6" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h76-5-13" id="h76-5-13" class="d">-                    None,
</a><a href="#h76-5-14" id="h76-5-14" class="d">-                    &quot;best&quot;,
</a><a href="#h76-5-15" id="h76-5-15" class="i">+                    0,
</a><a href="#h76-5-16" id="h76-5-16" class="i">+                    Some(
</a><a href="#h76-5-17" id="h76-5-17" class="i">+                        (
</a><a href="#h76-5-18" id="h76-5-18" class="i">+                            None,
</a><a href="#h76-5-19" id="h76-5-19" class="i">+                            &quot;best&quot;,
</a><a href="#h76-5-20" id="h76-5-20" class="i">+                        ),
</a><a href="#h76-5-21" id="h76-5-21" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h77" href="../file/tests/sql/query/group_order_agg.html">tests/sql/query/group_order_agg</a> b/<a href="../file/tests/sql/query/group_order_agg.html">tests/sql/query/group_order_agg</a></b>
<a href="#h77-0" id="h77-0" class="h">@@ -62,4 +62,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h77-0-3" id="h77-0-3" class="d">-Plan: Value(&quot;Aggregate function MAX() not allowed here&quot;)
</a><a href="#h77-0-4" id="h77-0-4" class="d">-\ No newline at end of file
</a><a href="#h77-0-5" id="h77-0-5" class="i">+Plan: Value(&quot;Aggregate function not allowed here&quot;)
</a><a href="#h77-0-6" id="h77-0-6" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h78" href="../file/tests/sql/query/group_simple.html">tests/sql/query/group_simple</a> b/<a href="../file/tests/sql/query/group_simple.html">tests/sql/query/group_simple</a></b>
<a href="#h78-0" id="h78-0" class="h">@@ -64,7 +64,7 @@ Plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h78-0-3" id="h78-0-3" class="d">-                        alias: None,
</a><a href="#h78-0-4" id="h78-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h78-1" id="h78-1" class="h">@@ -73,12 +73,22 @@ Plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h78-1-3" id="h78-1-3" class="d">-                            None,
</a><a href="#h78-1-4" id="h78-1-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h78-1-5" id="h78-1-5" class="i">+                            5,
</a><a href="#h78-1-6" id="h78-1-6" class="i">+                            Some(
</a><a href="#h78-1-7" id="h78-1-7" class="i">+                                (
</a><a href="#h78-1-8" id="h78-1-8" class="i">+                                    None,
</a><a href="#h78-1-9" id="h78-1-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h78-1-10" id="h78-1-10" class="i">+                                ),
</a><a href="#h78-1-11" id="h78-1-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h78-1-14" id="h78-1-14" class="d">-                            None,
</a><a href="#h78-1-15" id="h78-1-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h78-1-16" id="h78-1-16" class="i">+                            2,
</a><a href="#h78-1-17" id="h78-1-17" class="i">+                            Some(
</a><a href="#h78-1-18" id="h78-1-18" class="i">+                                (
</a><a href="#h78-1-19" id="h78-1-19" class="i">+                                    None,
</a><a href="#h78-1-20" id="h78-1-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h78-1-21" id="h78-1-21" class="i">+                                ),
</a><a href="#h78-1-22" id="h78-1-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h78-2" id="h78-2" class="h">@@ -92,19 +102,25 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h78-2-3" id="h78-2-3" class="i">+                    1,
</a>                     None,
<a href="#h78-2-5" id="h78-2-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
<a href="#h78-2-7" id="h78-2-7" class="d">-                Column(
</a><a href="#h78-2-8" id="h78-2-8" class="i">+                Field(
</a>                     0,
<a href="#h78-2-10" id="h78-2-10" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h78-2-17" id="h78-2-17" class="d">-                    None,
</a><a href="#h78-2-18" id="h78-2-18" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h78-2-19" id="h78-2-19" class="i">+                    0,
</a><a href="#h78-2-20" id="h78-2-20" class="i">+                    Some(
</a><a href="#h78-2-21" id="h78-2-21" class="i">+                        (
</a><a href="#h78-2-22" id="h78-2-22" class="i">+                            None,
</a><a href="#h78-2-23" id="h78-2-23" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h78-2-24" id="h78-2-24" class="i">+                        ),
</a><a href="#h78-2-25" id="h78-2-25" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h78-3" id="h78-3" class="h">@@ -119,7 +135,7 @@ Optimized plan: Plan(
</a>                 source: Projection {
                     source: Scan {
                         table: &quot;movies&quot;,
<a href="#h78-3-3" id="h78-3-3" class="d">-                        alias: None,
</a><a href="#h78-3-4" id="h78-3-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     labels: [
<a href="#h78-4" id="h78-4" class="h">@@ -128,12 +144,22 @@ Optimized plan: Plan(
</a>                     ],
                     expressions: [
                         Field(
<a href="#h78-4-3" id="h78-4-3" class="d">-                            None,
</a><a href="#h78-4-4" id="h78-4-4" class="d">-                            &quot;rating&quot;,
</a><a href="#h78-4-5" id="h78-4-5" class="i">+                            5,
</a><a href="#h78-4-6" id="h78-4-6" class="i">+                            Some(
</a><a href="#h78-4-7" id="h78-4-7" class="i">+                                (
</a><a href="#h78-4-8" id="h78-4-8" class="i">+                                    None,
</a><a href="#h78-4-9" id="h78-4-9" class="i">+                                    &quot;rating&quot;,
</a><a href="#h78-4-10" id="h78-4-10" class="i">+                                ),
</a><a href="#h78-4-11" id="h78-4-11" class="i">+                            ),
</a>                         ),
                         Field(
<a href="#h78-4-14" id="h78-4-14" class="d">-                            None,
</a><a href="#h78-4-15" id="h78-4-15" class="d">-                            &quot;studio_id&quot;,
</a><a href="#h78-4-16" id="h78-4-16" class="i">+                            2,
</a><a href="#h78-4-17" id="h78-4-17" class="i">+                            Some(
</a><a href="#h78-4-18" id="h78-4-18" class="i">+                                (
</a><a href="#h78-4-19" id="h78-4-19" class="i">+                                    None,
</a><a href="#h78-4-20" id="h78-4-20" class="i">+                                    &quot;studio_id&quot;,
</a><a href="#h78-4-21" id="h78-4-21" class="i">+                                ),
</a><a href="#h78-4-22" id="h78-4-22" class="i">+                            ),
</a>                         ),
                     ],
                 },
<a href="#h78-5" id="h78-5" class="h">@@ -147,19 +173,25 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h78-5-3" id="h78-5-3" class="i">+                    1,
</a>                     None,
<a href="#h78-5-5" id="h78-5-5" class="d">-                    &quot;studio_id&quot;,
</a>                 ),
<a href="#h78-5-7" id="h78-5-7" class="d">-                Column(
</a><a href="#h78-5-8" id="h78-5-8" class="i">+                Field(
</a>                     0,
<a href="#h78-5-10" id="h78-5-10" class="i">+                    None,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h78-5-17" id="h78-5-17" class="d">-                    None,
</a><a href="#h78-5-18" id="h78-5-18" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h78-5-19" id="h78-5-19" class="i">+                    0,
</a><a href="#h78-5-20" id="h78-5-20" class="i">+                    Some(
</a><a href="#h78-5-21" id="h78-5-21" class="i">+                        (
</a><a href="#h78-5-22" id="h78-5-22" class="i">+                            None,
</a><a href="#h78-5-23" id="h78-5-23" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h78-5-24" id="h78-5-24" class="i">+                        ),
</a><a href="#h78-5-25" id="h78-5-25" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h79" href="../file/tests/sql/query/group_unknown.html">tests/sql/query/group_unknown</a> b/<a href="../file/tests/sql/query/group_unknown.html">tests/sql/query/group_unknown</a></b>
<a href="#h79-0" id="h79-0" class="h">@@ -45,86 +45,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h79-0-3" id="h79-0-3" class="d">-Plan: Plan(
</a><a href="#h79-0-4" id="h79-0-4" class="d">-    Projection {
</a><a href="#h79-0-5" id="h79-0-5" class="d">-        source: Aggregation {
</a><a href="#h79-0-6" id="h79-0-6" class="d">-            source: Projection {
</a><a href="#h79-0-7" id="h79-0-7" class="d">-                source: Scan {
</a><a href="#h79-0-8" id="h79-0-8" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h79-0-9" id="h79-0-9" class="d">-                    alias: None,
</a><a href="#h79-0-10" id="h79-0-10" class="d">-                    filter: None,
</a><a href="#h79-0-11" id="h79-0-11" class="d">-                },
</a><a href="#h79-0-12" id="h79-0-12" class="d">-                labels: [
</a><a href="#h79-0-13" id="h79-0-13" class="d">-                    None,
</a><a href="#h79-0-14" id="h79-0-14" class="d">-                    None,
</a><a href="#h79-0-15" id="h79-0-15" class="d">-                ],
</a><a href="#h79-0-16" id="h79-0-16" class="d">-                expressions: [
</a><a href="#h79-0-17" id="h79-0-17" class="d">-                    Constant(
</a><a href="#h79-0-18" id="h79-0-18" class="d">-                        Boolean(
</a><a href="#h79-0-19" id="h79-0-19" class="d">-                            true,
</a><a href="#h79-0-20" id="h79-0-20" class="d">-                        ),
</a><a href="#h79-0-21" id="h79-0-21" class="d">-                    ),
</a><a href="#h79-0-22" id="h79-0-22" class="d">-                    Field(
</a><a href="#h79-0-23" id="h79-0-23" class="d">-                        None,
</a><a href="#h79-0-24" id="h79-0-24" class="d">-                        &quot;unknown&quot;,
</a><a href="#h79-0-25" id="h79-0-25" class="d">-                    ),
</a><a href="#h79-0-26" id="h79-0-26" class="d">-                ],
</a><a href="#h79-0-27" id="h79-0-27" class="d">-            },
</a><a href="#h79-0-28" id="h79-0-28" class="d">-            aggregates: [
</a><a href="#h79-0-29" id="h79-0-29" class="d">-                Count,
</a><a href="#h79-0-30" id="h79-0-30" class="d">-            ],
</a><a href="#h79-0-31" id="h79-0-31" class="d">-        },
</a><a href="#h79-0-32" id="h79-0-32" class="d">-        labels: [
</a><a href="#h79-0-33" id="h79-0-33" class="d">-            None,
</a><a href="#h79-0-34" id="h79-0-34" class="d">-        ],
</a><a href="#h79-0-35" id="h79-0-35" class="d">-        expressions: [
</a><a href="#h79-0-36" id="h79-0-36" class="d">-            Column(
</a><a href="#h79-0-37" id="h79-0-37" class="d">-                0,
</a><a href="#h79-0-38" id="h79-0-38" class="d">-            ),
</a><a href="#h79-0-39" id="h79-0-39" class="d">-        ],
</a><a href="#h79-0-40" id="h79-0-40" class="d">-    },
</a><a href="#h79-0-41" id="h79-0-41" class="d">-)
</a><a href="#h79-0-42" id="h79-0-42" class="d">-
</a><a href="#h79-0-43" id="h79-0-43" class="d">-Optimized plan: Plan(
</a><a href="#h79-0-44" id="h79-0-44" class="d">-    Projection {
</a><a href="#h79-0-45" id="h79-0-45" class="d">-        source: Aggregation {
</a><a href="#h79-0-46" id="h79-0-46" class="d">-            source: Projection {
</a><a href="#h79-0-47" id="h79-0-47" class="d">-                source: Scan {
</a><a href="#h79-0-48" id="h79-0-48" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h79-0-49" id="h79-0-49" class="d">-                    alias: None,
</a><a href="#h79-0-50" id="h79-0-50" class="d">-                    filter: None,
</a><a href="#h79-0-51" id="h79-0-51" class="d">-                },
</a><a href="#h79-0-52" id="h79-0-52" class="d">-                labels: [
</a><a href="#h79-0-53" id="h79-0-53" class="d">-                    None,
</a><a href="#h79-0-54" id="h79-0-54" class="d">-                    None,
</a><a href="#h79-0-55" id="h79-0-55" class="d">-                ],
</a><a href="#h79-0-56" id="h79-0-56" class="d">-                expressions: [
</a><a href="#h79-0-57" id="h79-0-57" class="d">-                    Constant(
</a><a href="#h79-0-58" id="h79-0-58" class="d">-                        Boolean(
</a><a href="#h79-0-59" id="h79-0-59" class="d">-                            true,
</a><a href="#h79-0-60" id="h79-0-60" class="d">-                        ),
</a><a href="#h79-0-61" id="h79-0-61" class="d">-                    ),
</a><a href="#h79-0-62" id="h79-0-62" class="d">-                    Field(
</a><a href="#h79-0-63" id="h79-0-63" class="d">-                        None,
</a><a href="#h79-0-64" id="h79-0-64" class="d">-                        &quot;unknown&quot;,
</a><a href="#h79-0-65" id="h79-0-65" class="d">-                    ),
</a><a href="#h79-0-66" id="h79-0-66" class="d">-                ],
</a><a href="#h79-0-67" id="h79-0-67" class="d">-            },
</a><a href="#h79-0-68" id="h79-0-68" class="d">-            aggregates: [
</a><a href="#h79-0-69" id="h79-0-69" class="d">-                Count,
</a><a href="#h79-0-70" id="h79-0-70" class="d">-            ],
</a><a href="#h79-0-71" id="h79-0-71" class="d">-        },
</a><a href="#h79-0-72" id="h79-0-72" class="d">-        labels: [
</a><a href="#h79-0-73" id="h79-0-73" class="d">-            None,
</a><a href="#h79-0-74" id="h79-0-74" class="d">-        ],
</a><a href="#h79-0-75" id="h79-0-75" class="d">-        expressions: [
</a><a href="#h79-0-76" id="h79-0-76" class="d">-            Column(
</a><a href="#h79-0-77" id="h79-0-77" class="d">-                0,
</a><a href="#h79-0-78" id="h79-0-78" class="d">-            ),
</a><a href="#h79-0-79" id="h79-0-79" class="d">-        ],
</a><a href="#h79-0-80" id="h79-0-80" class="d">-    },
</a><a href="#h79-0-81" id="h79-0-81" class="d">-)
</a><a href="#h79-0-82" id="h79-0-82" class="d">-
</a><a href="#h79-0-83" id="h79-0-83" class="d">-Query: SELECT COUNT(*) FROM movies GROUP BY unknown
</a><a href="#h79-0-84" id="h79-0-84" class="d">-
</a><a href="#h79-0-85" id="h79-0-85" class="d">-Result: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h79-0-86" id="h79-0-86" class="d">-\ No newline at end of file
</a><a href="#h79-0-87" id="h79-0-87" class="i">+Plan: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h79-0-88" id="h79-0-88" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h80" href="../file/tests/sql/query/having.html">tests/sql/query/having</a> b/<a href="../file/tests/sql/query/having.html">tests/sql/query/having</a></b>
<a href="#h80-0" id="h80-0" class="h">@@ -83,7 +83,7 @@ Plan: Plan(
</a>                     source: Projection {
                         source: Scan {
                             table: &quot;movies&quot;,
<a href="#h80-0-3" id="h80-0-3" class="d">-                            alias: None,
</a><a href="#h80-0-4" id="h80-0-4" class="i">+                            label: &quot;movies&quot;,
</a>                             filter: None,
                         },
                         labels: [
<a href="#h80-1" id="h80-1" class="h">@@ -92,12 +92,22 @@ Plan: Plan(
</a>                         ],
                         expressions: [
                             Field(
<a href="#h80-1-3" id="h80-1-3" class="d">-                                None,
</a><a href="#h80-1-4" id="h80-1-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h80-1-5" id="h80-1-5" class="i">+                                5,
</a><a href="#h80-1-6" id="h80-1-6" class="i">+                                Some(
</a><a href="#h80-1-7" id="h80-1-7" class="i">+                                    (
</a><a href="#h80-1-8" id="h80-1-8" class="i">+                                        None,
</a><a href="#h80-1-9" id="h80-1-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h80-1-10" id="h80-1-10" class="i">+                                    ),
</a><a href="#h80-1-11" id="h80-1-11" class="i">+                                ),
</a>                             ),
                             Field(
<a href="#h80-1-14" id="h80-1-14" class="d">-                                None,
</a><a href="#h80-1-15" id="h80-1-15" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h80-1-16" id="h80-1-16" class="i">+                                2,
</a><a href="#h80-1-17" id="h80-1-17" class="i">+                                Some(
</a><a href="#h80-1-18" id="h80-1-18" class="i">+                                    (
</a><a href="#h80-1-19" id="h80-1-19" class="i">+                                        None,
</a><a href="#h80-1-20" id="h80-1-20" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h80-1-21" id="h80-1-21" class="i">+                                    ),
</a><a href="#h80-1-22" id="h80-1-22" class="i">+                                ),
</a>                             ),
                         ],
                     },
<a href="#h80-2" id="h80-2" class="h">@@ -113,18 +123,24 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h80-2-3" id="h80-2-3" class="i">+                        1,
</a>                         None,
<a href="#h80-2-5" id="h80-2-5" class="d">-                        &quot;studio_id&quot;,
</a>                     ),
<a href="#h80-2-7" id="h80-2-7" class="d">-                    Column(
</a><a href="#h80-2-8" id="h80-2-8" class="i">+                    Field(
</a>                         0,
<a href="#h80-2-10" id="h80-2-10" class="i">+                        None,
</a>                     ),
                 ],
             },
             predicate: GreaterThan(
                 Field(
<a href="#h80-2-16" id="h80-2-16" class="d">-                    None,
</a><a href="#h80-2-17" id="h80-2-17" class="d">-                    &quot;rating&quot;,
</a><a href="#h80-2-18" id="h80-2-18" class="i">+                    1,
</a><a href="#h80-2-19" id="h80-2-19" class="i">+                    Some(
</a><a href="#h80-2-20" id="h80-2-20" class="i">+                        (
</a><a href="#h80-2-21" id="h80-2-21" class="i">+                            None,
</a><a href="#h80-2-22" id="h80-2-22" class="i">+                            &quot;rating&quot;,
</a><a href="#h80-2-23" id="h80-2-23" class="i">+                        ),
</a><a href="#h80-2-24" id="h80-2-24" class="i">+                    ),
</a>                 ),
                 Constant(
                     Integer(
<a href="#h80-3" id="h80-3" class="h">@@ -136,8 +152,13 @@ Plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h80-3-3" id="h80-3-3" class="d">-                    None,
</a><a href="#h80-3-4" id="h80-3-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h80-3-5" id="h80-3-5" class="i">+                    0,
</a><a href="#h80-3-6" id="h80-3-6" class="i">+                    Some(
</a><a href="#h80-3-7" id="h80-3-7" class="i">+                        (
</a><a href="#h80-3-8" id="h80-3-8" class="i">+                            None,
</a><a href="#h80-3-9" id="h80-3-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h80-3-10" id="h80-3-10" class="i">+                        ),
</a><a href="#h80-3-11" id="h80-3-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h80-4" id="h80-4" class="h">@@ -153,7 +174,7 @@ Optimized plan: Plan(
</a>                     source: Projection {
                         source: Scan {
                             table: &quot;movies&quot;,
<a href="#h80-4-3" id="h80-4-3" class="d">-                            alias: None,
</a><a href="#h80-4-4" id="h80-4-4" class="i">+                            label: &quot;movies&quot;,
</a>                             filter: None,
                         },
                         labels: [
<a href="#h80-5" id="h80-5" class="h">@@ -162,12 +183,22 @@ Optimized plan: Plan(
</a>                         ],
                         expressions: [
                             Field(
<a href="#h80-5-3" id="h80-5-3" class="d">-                                None,
</a><a href="#h80-5-4" id="h80-5-4" class="d">-                                &quot;rating&quot;,
</a><a href="#h80-5-5" id="h80-5-5" class="i">+                                5,
</a><a href="#h80-5-6" id="h80-5-6" class="i">+                                Some(
</a><a href="#h80-5-7" id="h80-5-7" class="i">+                                    (
</a><a href="#h80-5-8" id="h80-5-8" class="i">+                                        None,
</a><a href="#h80-5-9" id="h80-5-9" class="i">+                                        &quot;rating&quot;,
</a><a href="#h80-5-10" id="h80-5-10" class="i">+                                    ),
</a><a href="#h80-5-11" id="h80-5-11" class="i">+                                ),
</a>                             ),
                             Field(
<a href="#h80-5-14" id="h80-5-14" class="d">-                                None,
</a><a href="#h80-5-15" id="h80-5-15" class="d">-                                &quot;studio_id&quot;,
</a><a href="#h80-5-16" id="h80-5-16" class="i">+                                2,
</a><a href="#h80-5-17" id="h80-5-17" class="i">+                                Some(
</a><a href="#h80-5-18" id="h80-5-18" class="i">+                                    (
</a><a href="#h80-5-19" id="h80-5-19" class="i">+                                        None,
</a><a href="#h80-5-20" id="h80-5-20" class="i">+                                        &quot;studio_id&quot;,
</a><a href="#h80-5-21" id="h80-5-21" class="i">+                                    ),
</a><a href="#h80-5-22" id="h80-5-22" class="i">+                                ),
</a>                             ),
                         ],
                     },
<a href="#h80-6" id="h80-6" class="h">@@ -183,18 +214,24 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h80-6-3" id="h80-6-3" class="i">+                        1,
</a>                         None,
<a href="#h80-6-5" id="h80-6-5" class="d">-                        &quot;studio_id&quot;,
</a>                     ),
<a href="#h80-6-7" id="h80-6-7" class="d">-                    Column(
</a><a href="#h80-6-8" id="h80-6-8" class="i">+                    Field(
</a>                         0,
<a href="#h80-6-10" id="h80-6-10" class="i">+                        None,
</a>                     ),
                 ],
             },
             predicate: GreaterThan(
                 Field(
<a href="#h80-6-16" id="h80-6-16" class="d">-                    None,
</a><a href="#h80-6-17" id="h80-6-17" class="d">-                    &quot;rating&quot;,
</a><a href="#h80-6-18" id="h80-6-18" class="i">+                    1,
</a><a href="#h80-6-19" id="h80-6-19" class="i">+                    Some(
</a><a href="#h80-6-20" id="h80-6-20" class="i">+                        (
</a><a href="#h80-6-21" id="h80-6-21" class="i">+                            None,
</a><a href="#h80-6-22" id="h80-6-22" class="i">+                            &quot;rating&quot;,
</a><a href="#h80-6-23" id="h80-6-23" class="i">+                        ),
</a><a href="#h80-6-24" id="h80-6-24" class="i">+                    ),
</a>                 ),
                 Constant(
                     Integer(
<a href="#h80-7" id="h80-7" class="h">@@ -206,8 +243,13 @@ Optimized plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h80-7-3" id="h80-7-3" class="d">-                    None,
</a><a href="#h80-7-4" id="h80-7-4" class="d">-                    &quot;studio_id&quot;,
</a><a href="#h80-7-5" id="h80-7-5" class="i">+                    0,
</a><a href="#h80-7-6" id="h80-7-6" class="i">+                    Some(
</a><a href="#h80-7-7" id="h80-7-7" class="i">+                        (
</a><a href="#h80-7-8" id="h80-7-8" class="i">+                            None,
</a><a href="#h80-7-9" id="h80-7-9" class="i">+                            &quot;studio_id&quot;,
</a><a href="#h80-7-10" id="h80-7-10" class="i">+                        ),
</a><a href="#h80-7-11" id="h80-7-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h81" href="../file/tests/sql/query/having_nogroup.html">tests/sql/query/having_nogroup</a> b/<a href="../file/tests/sql/query/having_nogroup.html">tests/sql/query/having_nogroup</a></b>
<a href="#h81-0" id="h81-0" class="h">@@ -65,7 +65,7 @@ Plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h81-0-3" id="h81-0-3" class="d">-                    alias: None,
</a><a href="#h81-0-4" id="h81-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h81-1" id="h81-1" class="h">@@ -74,19 +74,34 @@ Plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h81-1-3" id="h81-1-3" class="d">-                        None,
</a><a href="#h81-1-4" id="h81-1-4" class="d">-                        &quot;id&quot;,
</a><a href="#h81-1-5" id="h81-1-5" class="i">+                        0,
</a><a href="#h81-1-6" id="h81-1-6" class="i">+                        Some(
</a><a href="#h81-1-7" id="h81-1-7" class="i">+                            (
</a><a href="#h81-1-8" id="h81-1-8" class="i">+                                None,
</a><a href="#h81-1-9" id="h81-1-9" class="i">+                                &quot;id&quot;,
</a><a href="#h81-1-10" id="h81-1-10" class="i">+                            ),
</a><a href="#h81-1-11" id="h81-1-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h81-1-14" id="h81-1-14" class="d">-                        None,
</a><a href="#h81-1-15" id="h81-1-15" class="d">-                        &quot;rating&quot;,
</a><a href="#h81-1-16" id="h81-1-16" class="i">+                        5,
</a><a href="#h81-1-17" id="h81-1-17" class="i">+                        Some(
</a><a href="#h81-1-18" id="h81-1-18" class="i">+                            (
</a><a href="#h81-1-19" id="h81-1-19" class="i">+                                None,
</a><a href="#h81-1-20" id="h81-1-20" class="i">+                                &quot;rating&quot;,
</a><a href="#h81-1-21" id="h81-1-21" class="i">+                            ),
</a><a href="#h81-1-22" id="h81-1-22" class="i">+                        ),
</a>                     ),
                 ],
             },
             predicate: GreaterThan(
                 Field(
<a href="#h81-1-28" id="h81-1-28" class="d">-                    None,
</a><a href="#h81-1-29" id="h81-1-29" class="d">-                    &quot;rating&quot;,
</a><a href="#h81-1-30" id="h81-1-30" class="i">+                    1,
</a><a href="#h81-1-31" id="h81-1-31" class="i">+                    Some(
</a><a href="#h81-1-32" id="h81-1-32" class="i">+                        (
</a><a href="#h81-1-33" id="h81-1-33" class="i">+                            None,
</a><a href="#h81-1-34" id="h81-1-34" class="i">+                            &quot;rating&quot;,
</a><a href="#h81-1-35" id="h81-1-35" class="i">+                        ),
</a><a href="#h81-1-36" id="h81-1-36" class="i">+                    ),
</a>                 ),
                 Constant(
                     Integer(
<a href="#h81-2" id="h81-2" class="h">@@ -98,8 +113,13 @@ Plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h81-2-3" id="h81-2-3" class="d">-                    None,
</a><a href="#h81-2-4" id="h81-2-4" class="d">-                    &quot;id&quot;,
</a><a href="#h81-2-5" id="h81-2-5" class="i">+                    0,
</a><a href="#h81-2-6" id="h81-2-6" class="i">+                    Some(
</a><a href="#h81-2-7" id="h81-2-7" class="i">+                        (
</a><a href="#h81-2-8" id="h81-2-8" class="i">+                            None,
</a><a href="#h81-2-9" id="h81-2-9" class="i">+                            &quot;id&quot;,
</a><a href="#h81-2-10" id="h81-2-10" class="i">+                        ),
</a><a href="#h81-2-11" id="h81-2-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h81-3" id="h81-3" class="h">@@ -113,7 +133,7 @@ Optimized plan: Plan(
</a>             source: Projection {
                 source: Scan {
                     table: &quot;movies&quot;,
<a href="#h81-3-3" id="h81-3-3" class="d">-                    alias: None,
</a><a href="#h81-3-4" id="h81-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 labels: [
<a href="#h81-4" id="h81-4" class="h">@@ -122,19 +142,34 @@ Optimized plan: Plan(
</a>                 ],
                 expressions: [
                     Field(
<a href="#h81-4-3" id="h81-4-3" class="d">-                        None,
</a><a href="#h81-4-4" id="h81-4-4" class="d">-                        &quot;id&quot;,
</a><a href="#h81-4-5" id="h81-4-5" class="i">+                        0,
</a><a href="#h81-4-6" id="h81-4-6" class="i">+                        Some(
</a><a href="#h81-4-7" id="h81-4-7" class="i">+                            (
</a><a href="#h81-4-8" id="h81-4-8" class="i">+                                None,
</a><a href="#h81-4-9" id="h81-4-9" class="i">+                                &quot;id&quot;,
</a><a href="#h81-4-10" id="h81-4-10" class="i">+                            ),
</a><a href="#h81-4-11" id="h81-4-11" class="i">+                        ),
</a>                     ),
                     Field(
<a href="#h81-4-14" id="h81-4-14" class="d">-                        None,
</a><a href="#h81-4-15" id="h81-4-15" class="d">-                        &quot;rating&quot;,
</a><a href="#h81-4-16" id="h81-4-16" class="i">+                        5,
</a><a href="#h81-4-17" id="h81-4-17" class="i">+                        Some(
</a><a href="#h81-4-18" id="h81-4-18" class="i">+                            (
</a><a href="#h81-4-19" id="h81-4-19" class="i">+                                None,
</a><a href="#h81-4-20" id="h81-4-20" class="i">+                                &quot;rating&quot;,
</a><a href="#h81-4-21" id="h81-4-21" class="i">+                            ),
</a><a href="#h81-4-22" id="h81-4-22" class="i">+                        ),
</a>                     ),
                 ],
             },
             predicate: GreaterThan(
                 Field(
<a href="#h81-4-28" id="h81-4-28" class="d">-                    None,
</a><a href="#h81-4-29" id="h81-4-29" class="d">-                    &quot;rating&quot;,
</a><a href="#h81-4-30" id="h81-4-30" class="i">+                    1,
</a><a href="#h81-4-31" id="h81-4-31" class="i">+                    Some(
</a><a href="#h81-4-32" id="h81-4-32" class="i">+                        (
</a><a href="#h81-4-33" id="h81-4-33" class="i">+                            None,
</a><a href="#h81-4-34" id="h81-4-34" class="i">+                            &quot;rating&quot;,
</a><a href="#h81-4-35" id="h81-4-35" class="i">+                        ),
</a><a href="#h81-4-36" id="h81-4-36" class="i">+                    ),
</a>                 ),
                 Constant(
                     Integer(
<a href="#h81-5" id="h81-5" class="h">@@ -146,8 +181,13 @@ Optimized plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h81-5-3" id="h81-5-3" class="d">-                    None,
</a><a href="#h81-5-4" id="h81-5-4" class="d">-                    &quot;id&quot;,
</a><a href="#h81-5-5" id="h81-5-5" class="i">+                    0,
</a><a href="#h81-5-6" id="h81-5-6" class="i">+                    Some(
</a><a href="#h81-5-7" id="h81-5-7" class="i">+                        (
</a><a href="#h81-5-8" id="h81-5-8" class="i">+                            None,
</a><a href="#h81-5-9" id="h81-5-9" class="i">+                            &quot;id&quot;,
</a><a href="#h81-5-10" id="h81-5-10" class="i">+                        ),
</a><a href="#h81-5-11" id="h81-5-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h82" href="../file/tests/sql/query/join_cross.html">tests/sql/query/join_cross</a> b/<a href="../file/tests/sql/query/join_cross.html">tests/sql/query/join_cross</a></b>
<a href="#h82-0" id="h82-0" class="h">@@ -35,12 +35,12 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h82-0-3" id="h82-0-3" class="d">-            alias: None,
</a><a href="#h82-0-4" id="h82-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h82-0-9" id="h82-0-9" class="d">-            alias: None,
</a><a href="#h82-0-10" id="h82-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: None,
<a href="#h82-1" id="h82-1" class="h">@@ -53,12 +53,12 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h82-1-3" id="h82-1-3" class="d">-            alias: None,
</a><a href="#h82-1-4" id="h82-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h82-1-9" id="h82-1-9" class="d">-            alias: None,
</a><a href="#h82-1-10" id="h82-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: None,
<b>diff --git a/<a id="h83" href="../file/tests/sql/query/join_cross_alias.html">tests/sql/query/join_cross_alias</a> b/<a href="../file/tests/sql/query/join_cross_alias.html">tests/sql/query/join_cross_alias</a></b>
<a href="#h83-0" id="h83-0" class="h">@@ -156,16 +156,12 @@ Plan: Plan(
</a>                 outer: NestedLoopJoin {
                     outer: Scan {
                         table: &quot;movies&quot;,
<a href="#h83-0-3" id="h83-0-3" class="d">-                        alias: Some(
</a><a href="#h83-0-4" id="h83-0-4" class="d">-                            &quot;m&quot;,
</a><a href="#h83-0-5" id="h83-0-5" class="d">-                        ),
</a><a href="#h83-0-6" id="h83-0-6" class="i">+                        label: &quot;m&quot;,
</a>                         filter: None,
                     },
                     inner: Scan {
                         table: &quot;genres&quot;,
<a href="#h83-0-11" id="h83-0-11" class="d">-                        alias: Some(
</a><a href="#h83-0-12" id="h83-0-12" class="d">-                            &quot;g&quot;,
</a><a href="#h83-0-13" id="h83-0-13" class="d">-                        ),
</a><a href="#h83-0-14" id="h83-0-14" class="i">+                        label: &quot;g&quot;,
</a>                         filter: None,
                     },
                     predicate: None,
<a href="#h83-1" id="h83-1" class="h">@@ -174,9 +170,7 @@ Plan: Plan(
</a>                 },
                 inner: Scan {
                     table: &quot;countries&quot;,
<a href="#h83-1-3" id="h83-1-3" class="d">-                    alias: Some(
</a><a href="#h83-1-4" id="h83-1-4" class="d">-                        &quot;c&quot;,
</a><a href="#h83-1-5" id="h83-1-5" class="d">-                    ),
</a><a href="#h83-1-6" id="h83-1-6" class="i">+                    label: &quot;c&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h83-2" id="h83-2" class="h">@@ -188,10 +182,15 @@ Plan: Plan(
</a>                     Or(
                         GreaterThan(
                             Field(
<a href="#h83-2-3" id="h83-2-3" class="i">+                                0,
</a>                                 Some(
<a href="#h83-2-5" id="h83-2-5" class="d">-                                    &quot;m&quot;,
</a><a href="#h83-2-6" id="h83-2-6" class="i">+                                    (
</a><a href="#h83-2-7" id="h83-2-7" class="i">+                                        Some(
</a><a href="#h83-2-8" id="h83-2-8" class="i">+                                            &quot;m&quot;,
</a><a href="#h83-2-9" id="h83-2-9" class="i">+                                        ),
</a><a href="#h83-2-10" id="h83-2-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h83-2-11" id="h83-2-11" class="i">+                                    ),
</a>                                 ),
<a href="#h83-2-13" id="h83-2-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h83-3" id="h83-3" class="h">@@ -201,10 +200,15 @@ Plan: Plan(
</a>                         ),
                         Equal(
                             Field(
<a href="#h83-3-3" id="h83-3-3" class="i">+                                0,
</a>                                 Some(
<a href="#h83-3-5" id="h83-3-5" class="d">-                                    &quot;m&quot;,
</a><a href="#h83-3-6" id="h83-3-6" class="i">+                                    (
</a><a href="#h83-3-7" id="h83-3-7" class="i">+                                        Some(
</a><a href="#h83-3-8" id="h83-3-8" class="i">+                                            &quot;m&quot;,
</a><a href="#h83-3-9" id="h83-3-9" class="i">+                                        ),
</a><a href="#h83-3-10" id="h83-3-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h83-3-11" id="h83-3-11" class="i">+                                    ),
</a>                                 ),
<a href="#h83-3-13" id="h83-3-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h83-4" id="h83-4" class="h">@@ -215,10 +219,15 @@ Plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h83-4-3" id="h83-4-3" class="i">+                            7,
</a>                             Some(
<a href="#h83-4-5" id="h83-4-5" class="d">-                                &quot;g&quot;,
</a><a href="#h83-4-6" id="h83-4-6" class="i">+                                (
</a><a href="#h83-4-7" id="h83-4-7" class="i">+                                    Some(
</a><a href="#h83-4-8" id="h83-4-8" class="i">+                                        &quot;g&quot;,
</a><a href="#h83-4-9" id="h83-4-9" class="i">+                                    ),
</a><a href="#h83-4-10" id="h83-4-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h83-4-11" id="h83-4-11" class="i">+                                ),
</a>                             ),
<a href="#h83-4-13" id="h83-4-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h83-5" id="h83-5" class="h">@@ -230,10 +239,15 @@ Plan: Plan(
</a>                 Not(
                     Equal(
                         Field(
<a href="#h83-5-3" id="h83-5-3" class="i">+                            9,
</a>                             Some(
<a href="#h83-5-5" id="h83-5-5" class="d">-                                &quot;c&quot;,
</a><a href="#h83-5-6" id="h83-5-6" class="i">+                                (
</a><a href="#h83-5-7" id="h83-5-7" class="i">+                                    Some(
</a><a href="#h83-5-8" id="h83-5-8" class="i">+                                        &quot;c&quot;,
</a><a href="#h83-5-9" id="h83-5-9" class="i">+                                    ),
</a><a href="#h83-5-10" id="h83-5-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h83-5-11" id="h83-5-11" class="i">+                                ),
</a>                             ),
<a href="#h83-5-13" id="h83-5-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             String(
<a href="#h83-6" id="h83-6" class="h">@@ -254,40 +268,70 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h83-6-3" id="h83-6-3" class="i">+                0,
</a>                 Some(
<a href="#h83-6-5" id="h83-6-5" class="d">-                    &quot;m&quot;,
</a><a href="#h83-6-6" id="h83-6-6" class="i">+                    (
</a><a href="#h83-6-7" id="h83-6-7" class="i">+                        Some(
</a><a href="#h83-6-8" id="h83-6-8" class="i">+                            &quot;m&quot;,
</a><a href="#h83-6-9" id="h83-6-9" class="i">+                        ),
</a><a href="#h83-6-10" id="h83-6-10" class="i">+                        &quot;id&quot;,
</a><a href="#h83-6-11" id="h83-6-11" class="i">+                    ),
</a>                 ),
<a href="#h83-6-13" id="h83-6-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-6-16" id="h83-6-16" class="i">+                1,
</a>                 Some(
<a href="#h83-6-18" id="h83-6-18" class="d">-                    &quot;m&quot;,
</a><a href="#h83-6-19" id="h83-6-19" class="i">+                    (
</a><a href="#h83-6-20" id="h83-6-20" class="i">+                        Some(
</a><a href="#h83-6-21" id="h83-6-21" class="i">+                            &quot;m&quot;,
</a><a href="#h83-6-22" id="h83-6-22" class="i">+                        ),
</a><a href="#h83-6-23" id="h83-6-23" class="i">+                        &quot;title&quot;,
</a><a href="#h83-6-24" id="h83-6-24" class="i">+                    ),
</a>                 ),
<a href="#h83-6-26" id="h83-6-26" class="d">-                &quot;title&quot;,
</a>             ),
             Field(
<a href="#h83-6-29" id="h83-6-29" class="i">+                7,
</a>                 Some(
<a href="#h83-6-31" id="h83-6-31" class="d">-                    &quot;g&quot;,
</a><a href="#h83-6-32" id="h83-6-32" class="i">+                    (
</a><a href="#h83-6-33" id="h83-6-33" class="i">+                        Some(
</a><a href="#h83-6-34" id="h83-6-34" class="i">+                            &quot;g&quot;,
</a><a href="#h83-6-35" id="h83-6-35" class="i">+                        ),
</a><a href="#h83-6-36" id="h83-6-36" class="i">+                        &quot;id&quot;,
</a><a href="#h83-6-37" id="h83-6-37" class="i">+                    ),
</a>                 ),
<a href="#h83-6-39" id="h83-6-39" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-6-42" id="h83-6-42" class="i">+                8,
</a>                 Some(
<a href="#h83-6-44" id="h83-6-44" class="d">-                    &quot;g&quot;,
</a><a href="#h83-6-45" id="h83-6-45" class="i">+                    (
</a><a href="#h83-6-46" id="h83-6-46" class="i">+                        Some(
</a><a href="#h83-6-47" id="h83-6-47" class="i">+                            &quot;g&quot;,
</a><a href="#h83-6-48" id="h83-6-48" class="i">+                        ),
</a><a href="#h83-6-49" id="h83-6-49" class="i">+                        &quot;name&quot;,
</a><a href="#h83-6-50" id="h83-6-50" class="i">+                    ),
</a>                 ),
<a href="#h83-6-52" id="h83-6-52" class="d">-                &quot;name&quot;,
</a>             ),
             Field(
<a href="#h83-6-55" id="h83-6-55" class="i">+                9,
</a>                 Some(
<a href="#h83-6-57" id="h83-6-57" class="d">-                    &quot;c&quot;,
</a><a href="#h83-6-58" id="h83-6-58" class="i">+                    (
</a><a href="#h83-6-59" id="h83-6-59" class="i">+                        Some(
</a><a href="#h83-6-60" id="h83-6-60" class="i">+                            &quot;c&quot;,
</a><a href="#h83-6-61" id="h83-6-61" class="i">+                        ),
</a><a href="#h83-6-62" id="h83-6-62" class="i">+                        &quot;id&quot;,
</a><a href="#h83-6-63" id="h83-6-63" class="i">+                    ),
</a>                 ),
<a href="#h83-6-65" id="h83-6-65" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-6-68" id="h83-6-68" class="i">+                10,
</a>                 Some(
<a href="#h83-6-70" id="h83-6-70" class="d">-                    &quot;c&quot;,
</a><a href="#h83-6-71" id="h83-6-71" class="i">+                    (
</a><a href="#h83-6-72" id="h83-6-72" class="i">+                        Some(
</a><a href="#h83-6-73" id="h83-6-73" class="i">+                            &quot;c&quot;,
</a><a href="#h83-6-74" id="h83-6-74" class="i">+                        ),
</a><a href="#h83-6-75" id="h83-6-75" class="i">+                        &quot;name&quot;,
</a><a href="#h83-6-76" id="h83-6-76" class="i">+                    ),
</a>                 ),
<a href="#h83-6-78" id="h83-6-78" class="d">-                &quot;name&quot;,
</a>             ),
         ],
     },
<a href="#h83-7" id="h83-7" class="h">@@ -299,16 +343,12 @@ Optimized plan: Plan(
</a>             outer: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h83-7-3" id="h83-7-3" class="d">-                    alias: Some(
</a><a href="#h83-7-4" id="h83-7-4" class="d">-                        &quot;m&quot;,
</a><a href="#h83-7-5" id="h83-7-5" class="d">-                    ),
</a><a href="#h83-7-6" id="h83-7-6" class="i">+                    label: &quot;m&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h83-7-11" id="h83-7-11" class="d">-                    alias: Some(
</a><a href="#h83-7-12" id="h83-7-12" class="d">-                        &quot;g&quot;,
</a><a href="#h83-7-13" id="h83-7-13" class="d">-                    ),
</a><a href="#h83-7-14" id="h83-7-14" class="i">+                    label: &quot;g&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h83-8" id="h83-8" class="h">@@ -317,9 +357,7 @@ Optimized plan: Plan(
</a>             },
             inner: Scan {
                 table: &quot;countries&quot;,
<a href="#h83-8-3" id="h83-8-3" class="d">-                alias: Some(
</a><a href="#h83-8-4" id="h83-8-4" class="d">-                    &quot;c&quot;,
</a><a href="#h83-8-5" id="h83-8-5" class="d">-                ),
</a><a href="#h83-8-6" id="h83-8-6" class="i">+                label: &quot;c&quot;,
</a>                 filter: None,
             },
             predicate: Some(
<a href="#h83-9" id="h83-9" class="h">@@ -328,10 +366,15 @@ Optimized plan: Plan(
</a>                         Or(
                             GreaterThan(
                                 Field(
<a href="#h83-9-3" id="h83-9-3" class="i">+                                    0,
</a>                                     Some(
<a href="#h83-9-5" id="h83-9-5" class="d">-                                        &quot;m&quot;,
</a><a href="#h83-9-6" id="h83-9-6" class="i">+                                        (
</a><a href="#h83-9-7" id="h83-9-7" class="i">+                                            Some(
</a><a href="#h83-9-8" id="h83-9-8" class="i">+                                                &quot;m&quot;,
</a><a href="#h83-9-9" id="h83-9-9" class="i">+                                            ),
</a><a href="#h83-9-10" id="h83-9-10" class="i">+                                            &quot;id&quot;,
</a><a href="#h83-9-11" id="h83-9-11" class="i">+                                        ),
</a>                                     ),
<a href="#h83-9-13" id="h83-9-13" class="d">-                                    &quot;id&quot;,
</a>                                 ),
                                 Constant(
                                     Integer(
<a href="#h83-10" id="h83-10" class="h">@@ -341,10 +384,15 @@ Optimized plan: Plan(
</a>                             ),
                             Equal(
                                 Field(
<a href="#h83-10-3" id="h83-10-3" class="i">+                                    0,
</a>                                     Some(
<a href="#h83-10-5" id="h83-10-5" class="d">-                                        &quot;m&quot;,
</a><a href="#h83-10-6" id="h83-10-6" class="i">+                                        (
</a><a href="#h83-10-7" id="h83-10-7" class="i">+                                            Some(
</a><a href="#h83-10-8" id="h83-10-8" class="i">+                                                &quot;m&quot;,
</a><a href="#h83-10-9" id="h83-10-9" class="i">+                                            ),
</a><a href="#h83-10-10" id="h83-10-10" class="i">+                                            &quot;id&quot;,
</a><a href="#h83-10-11" id="h83-10-11" class="i">+                                        ),
</a>                                     ),
<a href="#h83-10-13" id="h83-10-13" class="d">-                                    &quot;id&quot;,
</a>                                 ),
                                 Constant(
                                     Integer(
<a href="#h83-11" id="h83-11" class="h">@@ -355,10 +403,15 @@ Optimized plan: Plan(
</a>                         ),
                         Equal(
                             Field(
<a href="#h83-11-3" id="h83-11-3" class="i">+                                7,
</a>                                 Some(
<a href="#h83-11-5" id="h83-11-5" class="d">-                                    &quot;g&quot;,
</a><a href="#h83-11-6" id="h83-11-6" class="i">+                                    (
</a><a href="#h83-11-7" id="h83-11-7" class="i">+                                        Some(
</a><a href="#h83-11-8" id="h83-11-8" class="i">+                                            &quot;g&quot;,
</a><a href="#h83-11-9" id="h83-11-9" class="i">+                                        ),
</a><a href="#h83-11-10" id="h83-11-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h83-11-11" id="h83-11-11" class="i">+                                    ),
</a>                                 ),
<a href="#h83-11-13" id="h83-11-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h83-12" id="h83-12" class="h">@@ -370,10 +423,15 @@ Optimized plan: Plan(
</a>                     Not(
                         Equal(
                             Field(
<a href="#h83-12-3" id="h83-12-3" class="i">+                                9,
</a>                                 Some(
<a href="#h83-12-5" id="h83-12-5" class="d">-                                    &quot;c&quot;,
</a><a href="#h83-12-6" id="h83-12-6" class="i">+                                    (
</a><a href="#h83-12-7" id="h83-12-7" class="i">+                                        Some(
</a><a href="#h83-12-8" id="h83-12-8" class="i">+                                            &quot;c&quot;,
</a><a href="#h83-12-9" id="h83-12-9" class="i">+                                        ),
</a><a href="#h83-12-10" id="h83-12-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h83-12-11" id="h83-12-11" class="i">+                                    ),
</a>                                 ),
<a href="#h83-12-13" id="h83-12-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 String(
<a href="#h83-13" id="h83-13" class="h">@@ -397,40 +455,70 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h83-13-3" id="h83-13-3" class="i">+                0,
</a>                 Some(
<a href="#h83-13-5" id="h83-13-5" class="d">-                    &quot;m&quot;,
</a><a href="#h83-13-6" id="h83-13-6" class="i">+                    (
</a><a href="#h83-13-7" id="h83-13-7" class="i">+                        Some(
</a><a href="#h83-13-8" id="h83-13-8" class="i">+                            &quot;m&quot;,
</a><a href="#h83-13-9" id="h83-13-9" class="i">+                        ),
</a><a href="#h83-13-10" id="h83-13-10" class="i">+                        &quot;id&quot;,
</a><a href="#h83-13-11" id="h83-13-11" class="i">+                    ),
</a>                 ),
<a href="#h83-13-13" id="h83-13-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-13-16" id="h83-13-16" class="i">+                1,
</a>                 Some(
<a href="#h83-13-18" id="h83-13-18" class="d">-                    &quot;m&quot;,
</a><a href="#h83-13-19" id="h83-13-19" class="i">+                    (
</a><a href="#h83-13-20" id="h83-13-20" class="i">+                        Some(
</a><a href="#h83-13-21" id="h83-13-21" class="i">+                            &quot;m&quot;,
</a><a href="#h83-13-22" id="h83-13-22" class="i">+                        ),
</a><a href="#h83-13-23" id="h83-13-23" class="i">+                        &quot;title&quot;,
</a><a href="#h83-13-24" id="h83-13-24" class="i">+                    ),
</a>                 ),
<a href="#h83-13-26" id="h83-13-26" class="d">-                &quot;title&quot;,
</a>             ),
             Field(
<a href="#h83-13-29" id="h83-13-29" class="i">+                7,
</a>                 Some(
<a href="#h83-13-31" id="h83-13-31" class="d">-                    &quot;g&quot;,
</a><a href="#h83-13-32" id="h83-13-32" class="i">+                    (
</a><a href="#h83-13-33" id="h83-13-33" class="i">+                        Some(
</a><a href="#h83-13-34" id="h83-13-34" class="i">+                            &quot;g&quot;,
</a><a href="#h83-13-35" id="h83-13-35" class="i">+                        ),
</a><a href="#h83-13-36" id="h83-13-36" class="i">+                        &quot;id&quot;,
</a><a href="#h83-13-37" id="h83-13-37" class="i">+                    ),
</a>                 ),
<a href="#h83-13-39" id="h83-13-39" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-13-42" id="h83-13-42" class="i">+                8,
</a>                 Some(
<a href="#h83-13-44" id="h83-13-44" class="d">-                    &quot;g&quot;,
</a><a href="#h83-13-45" id="h83-13-45" class="i">+                    (
</a><a href="#h83-13-46" id="h83-13-46" class="i">+                        Some(
</a><a href="#h83-13-47" id="h83-13-47" class="i">+                            &quot;g&quot;,
</a><a href="#h83-13-48" id="h83-13-48" class="i">+                        ),
</a><a href="#h83-13-49" id="h83-13-49" class="i">+                        &quot;name&quot;,
</a><a href="#h83-13-50" id="h83-13-50" class="i">+                    ),
</a>                 ),
<a href="#h83-13-52" id="h83-13-52" class="d">-                &quot;name&quot;,
</a>             ),
             Field(
<a href="#h83-13-55" id="h83-13-55" class="i">+                9,
</a>                 Some(
<a href="#h83-13-57" id="h83-13-57" class="d">-                    &quot;c&quot;,
</a><a href="#h83-13-58" id="h83-13-58" class="i">+                    (
</a><a href="#h83-13-59" id="h83-13-59" class="i">+                        Some(
</a><a href="#h83-13-60" id="h83-13-60" class="i">+                            &quot;c&quot;,
</a><a href="#h83-13-61" id="h83-13-61" class="i">+                        ),
</a><a href="#h83-13-62" id="h83-13-62" class="i">+                        &quot;id&quot;,
</a><a href="#h83-13-63" id="h83-13-63" class="i">+                    ),
</a>                 ),
<a href="#h83-13-65" id="h83-13-65" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h83-13-68" id="h83-13-68" class="i">+                10,
</a>                 Some(
<a href="#h83-13-70" id="h83-13-70" class="d">-                    &quot;c&quot;,
</a><a href="#h83-13-71" id="h83-13-71" class="i">+                    (
</a><a href="#h83-13-72" id="h83-13-72" class="i">+                        Some(
</a><a href="#h83-13-73" id="h83-13-73" class="i">+                            &quot;c&quot;,
</a><a href="#h83-13-74" id="h83-13-74" class="i">+                        ),
</a><a href="#h83-13-75" id="h83-13-75" class="i">+                        &quot;name&quot;,
</a><a href="#h83-13-76" id="h83-13-76" class="i">+                    ),
</a>                 ),
<a href="#h83-13-78" id="h83-13-78" class="d">-                &quot;name&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h84" href="../file/tests/sql/query/join_cross_multi.html">tests/sql/query/join_cross_multi</a> b/<a href="../file/tests/sql/query/join_cross_multi.html">tests/sql/query/join_cross_multi</a></b>
<a href="#h84-0" id="h84-0" class="h">@@ -53,12 +53,12 @@ Plan: Plan(
</a>             outer: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h84-0-3" id="h84-0-3" class="d">-                    alias: None,
</a><a href="#h84-0-4" id="h84-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h84-0-9" id="h84-0-9" class="d">-                    alias: None,
</a><a href="#h84-0-10" id="h84-0-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h84-1" id="h84-1" class="h">@@ -67,7 +67,7 @@ Plan: Plan(
</a>             },
             inner: Scan {
                 table: &quot;countries&quot;,
<a href="#h84-1-3" id="h84-1-3" class="d">-                alias: None,
</a><a href="#h84-1-4" id="h84-1-4" class="i">+                label: &quot;countries&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h84-2" id="h84-2" class="h">@@ -76,7 +76,7 @@ Plan: Plan(
</a>         },
         inner: Scan {
             table: &quot;studios&quot;,
<a href="#h84-2-3" id="h84-2-3" class="d">-            alias: None,
</a><a href="#h84-2-4" id="h84-2-4" class="i">+            label: &quot;studios&quot;,
</a>             filter: None,
         },
         predicate: None,
<a href="#h84-3" id="h84-3" class="h">@@ -91,12 +91,12 @@ Optimized plan: Plan(
</a>             outer: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h84-3-3" id="h84-3-3" class="d">-                    alias: None,
</a><a href="#h84-3-4" id="h84-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h84-3-9" id="h84-3-9" class="d">-                    alias: None,
</a><a href="#h84-3-10" id="h84-3-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h84-4" id="h84-4" class="h">@@ -105,7 +105,7 @@ Optimized plan: Plan(
</a>             },
             inner: Scan {
                 table: &quot;countries&quot;,
<a href="#h84-4-3" id="h84-4-3" class="d">-                alias: None,
</a><a href="#h84-4-4" id="h84-4-4" class="i">+                label: &quot;countries&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h84-5" id="h84-5" class="h">@@ -114,7 +114,7 @@ Optimized plan: Plan(
</a>         },
         inner: Scan {
             table: &quot;studios&quot;,
<a href="#h84-5-3" id="h84-5-3" class="d">-            alias: None,
</a><a href="#h84-5-4" id="h84-5-4" class="i">+            label: &quot;studios&quot;,
</a>             filter: None,
         },
         predicate: None,
<b>diff --git a/<a id="h85" href="../file/tests/sql/query/join_inner.html">tests/sql/query/join_inner</a> b/<a href="../file/tests/sql/query/join_inner.html">tests/sql/query/join_inner</a></b>
<a href="#h85-0" id="h85-0" class="h">@@ -52,27 +52,37 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h85-0-3" id="h85-0-3" class="d">-            alias: None,
</a><a href="#h85-0-4" id="h85-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h85-0-9" id="h85-0-9" class="d">-            alias: None,
</a><a href="#h85-0-10" id="h85-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h85-0-16" id="h85-0-16" class="i">+                    3,
</a>                     Some(
<a href="#h85-0-18" id="h85-0-18" class="d">-                        &quot;movies&quot;,
</a><a href="#h85-0-19" id="h85-0-19" class="i">+                        (
</a><a href="#h85-0-20" id="h85-0-20" class="i">+                            Some(
</a><a href="#h85-0-21" id="h85-0-21" class="i">+                                &quot;movies&quot;,
</a><a href="#h85-0-22" id="h85-0-22" class="i">+                            ),
</a><a href="#h85-0-23" id="h85-0-23" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h85-0-24" id="h85-0-24" class="i">+                        ),
</a>                     ),
<a href="#h85-0-26" id="h85-0-26" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h85-0-29" id="h85-0-29" class="i">+                    7,
</a>                     Some(
<a href="#h85-0-31" id="h85-0-31" class="d">-                        &quot;genres&quot;,
</a><a href="#h85-0-32" id="h85-0-32" class="i">+                        (
</a><a href="#h85-0-33" id="h85-0-33" class="i">+                            Some(
</a><a href="#h85-0-34" id="h85-0-34" class="i">+                                &quot;genres&quot;,
</a><a href="#h85-0-35" id="h85-0-35" class="i">+                            ),
</a><a href="#h85-0-36" id="h85-0-36" class="i">+                            &quot;id&quot;,
</a><a href="#h85-0-37" id="h85-0-37" class="i">+                        ),
</a>                     ),
<a href="#h85-0-39" id="h85-0-39" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<a href="#h85-1" id="h85-1" class="h">@@ -85,27 +95,37 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h85-1-3" id="h85-1-3" class="d">-            alias: None,
</a><a href="#h85-1-4" id="h85-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h85-1-9" id="h85-1-9" class="d">-            alias: None,
</a><a href="#h85-1-10" id="h85-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h85-1-16" id="h85-1-16" class="i">+                    3,
</a>                     Some(
<a href="#h85-1-18" id="h85-1-18" class="d">-                        &quot;movies&quot;,
</a><a href="#h85-1-19" id="h85-1-19" class="i">+                        (
</a><a href="#h85-1-20" id="h85-1-20" class="i">+                            Some(
</a><a href="#h85-1-21" id="h85-1-21" class="i">+                                &quot;movies&quot;,
</a><a href="#h85-1-22" id="h85-1-22" class="i">+                            ),
</a><a href="#h85-1-23" id="h85-1-23" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h85-1-24" id="h85-1-24" class="i">+                        ),
</a>                     ),
<a href="#h85-1-26" id="h85-1-26" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h85-1-29" id="h85-1-29" class="i">+                    7,
</a>                     Some(
<a href="#h85-1-31" id="h85-1-31" class="d">-                        &quot;genres&quot;,
</a><a href="#h85-1-32" id="h85-1-32" class="i">+                        (
</a><a href="#h85-1-33" id="h85-1-33" class="i">+                            Some(
</a><a href="#h85-1-34" id="h85-1-34" class="i">+                                &quot;genres&quot;,
</a><a href="#h85-1-35" id="h85-1-35" class="i">+                            ),
</a><a href="#h85-1-36" id="h85-1-36" class="i">+                            &quot;id&quot;,
</a><a href="#h85-1-37" id="h85-1-37" class="i">+                        ),
</a>                     ),
<a href="#h85-1-39" id="h85-1-39" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<b>diff --git a/<a id="h86" href="../file/tests/sql/query/join_inner_implicit.html">tests/sql/query/join_inner_implicit</a> b/<a href="../file/tests/sql/query/join_inner_implicit.html">tests/sql/query/join_inner_implicit</a></b>
<a href="#h86-0" id="h86-0" class="h">@@ -52,27 +52,37 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h86-0-3" id="h86-0-3" class="d">-            alias: None,
</a><a href="#h86-0-4" id="h86-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h86-0-9" id="h86-0-9" class="d">-            alias: None,
</a><a href="#h86-0-10" id="h86-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h86-0-16" id="h86-0-16" class="i">+                    3,
</a>                     Some(
<a href="#h86-0-18" id="h86-0-18" class="d">-                        &quot;movies&quot;,
</a><a href="#h86-0-19" id="h86-0-19" class="i">+                        (
</a><a href="#h86-0-20" id="h86-0-20" class="i">+                            Some(
</a><a href="#h86-0-21" id="h86-0-21" class="i">+                                &quot;movies&quot;,
</a><a href="#h86-0-22" id="h86-0-22" class="i">+                            ),
</a><a href="#h86-0-23" id="h86-0-23" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h86-0-24" id="h86-0-24" class="i">+                        ),
</a>                     ),
<a href="#h86-0-26" id="h86-0-26" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h86-0-29" id="h86-0-29" class="i">+                    7,
</a>                     Some(
<a href="#h86-0-31" id="h86-0-31" class="d">-                        &quot;genres&quot;,
</a><a href="#h86-0-32" id="h86-0-32" class="i">+                        (
</a><a href="#h86-0-33" id="h86-0-33" class="i">+                            Some(
</a><a href="#h86-0-34" id="h86-0-34" class="i">+                                &quot;genres&quot;,
</a><a href="#h86-0-35" id="h86-0-35" class="i">+                            ),
</a><a href="#h86-0-36" id="h86-0-36" class="i">+                            &quot;id&quot;,
</a><a href="#h86-0-37" id="h86-0-37" class="i">+                        ),
</a>                     ),
<a href="#h86-0-39" id="h86-0-39" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<a href="#h86-1" id="h86-1" class="h">@@ -85,27 +95,37 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h86-1-3" id="h86-1-3" class="d">-            alias: None,
</a><a href="#h86-1-4" id="h86-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h86-1-9" id="h86-1-9" class="d">-            alias: None,
</a><a href="#h86-1-10" id="h86-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h86-1-16" id="h86-1-16" class="i">+                    3,
</a>                     Some(
<a href="#h86-1-18" id="h86-1-18" class="d">-                        &quot;movies&quot;,
</a><a href="#h86-1-19" id="h86-1-19" class="i">+                        (
</a><a href="#h86-1-20" id="h86-1-20" class="i">+                            Some(
</a><a href="#h86-1-21" id="h86-1-21" class="i">+                                &quot;movies&quot;,
</a><a href="#h86-1-22" id="h86-1-22" class="i">+                            ),
</a><a href="#h86-1-23" id="h86-1-23" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h86-1-24" id="h86-1-24" class="i">+                        ),
</a>                     ),
<a href="#h86-1-26" id="h86-1-26" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h86-1-29" id="h86-1-29" class="i">+                    7,
</a>                     Some(
<a href="#h86-1-31" id="h86-1-31" class="d">-                        &quot;genres&quot;,
</a><a href="#h86-1-32" id="h86-1-32" class="i">+                        (
</a><a href="#h86-1-33" id="h86-1-33" class="i">+                            Some(
</a><a href="#h86-1-34" id="h86-1-34" class="i">+                                &quot;genres&quot;,
</a><a href="#h86-1-35" id="h86-1-35" class="i">+                            ),
</a><a href="#h86-1-36" id="h86-1-36" class="i">+                            &quot;id&quot;,
</a><a href="#h86-1-37" id="h86-1-37" class="i">+                        ),
</a>                     ),
<a href="#h86-1-39" id="h86-1-39" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<b>diff --git a/<a id="h87" href="../file/tests/sql/query/join_inner_multi.html">tests/sql/query/join_inner_multi</a> b/<a href="../file/tests/sql/query/join_inner_multi.html">tests/sql/query/join_inner_multi</a></b>
<a href="#h87-0" id="h87-0" class="h">@@ -110,27 +110,37 @@ Plan: Plan(
</a>             outer: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h87-0-3" id="h87-0-3" class="d">-                    alias: None,
</a><a href="#h87-0-4" id="h87-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h87-0-9" id="h87-0-9" class="d">-                    alias: None,
</a><a href="#h87-0-10" id="h87-0-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: Some(
                     Equal(
                         Field(
<a href="#h87-0-16" id="h87-0-16" class="i">+                            3,
</a>                             Some(
<a href="#h87-0-18" id="h87-0-18" class="d">-                                &quot;movies&quot;,
</a><a href="#h87-0-19" id="h87-0-19" class="i">+                                (
</a><a href="#h87-0-20" id="h87-0-20" class="i">+                                    Some(
</a><a href="#h87-0-21" id="h87-0-21" class="i">+                                        &quot;movies&quot;,
</a><a href="#h87-0-22" id="h87-0-22" class="i">+                                    ),
</a><a href="#h87-0-23" id="h87-0-23" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h87-0-24" id="h87-0-24" class="i">+                                ),
</a>                             ),
<a href="#h87-0-26" id="h87-0-26" class="d">-                            &quot;genre_id&quot;,
</a>                         ),
                         Field(
<a href="#h87-0-29" id="h87-0-29" class="i">+                            7,
</a>                             Some(
<a href="#h87-0-31" id="h87-0-31" class="d">-                                &quot;genres&quot;,
</a><a href="#h87-0-32" id="h87-0-32" class="i">+                                (
</a><a href="#h87-0-33" id="h87-0-33" class="i">+                                    Some(
</a><a href="#h87-0-34" id="h87-0-34" class="i">+                                        &quot;genres&quot;,
</a><a href="#h87-0-35" id="h87-0-35" class="i">+                                    ),
</a><a href="#h87-0-36" id="h87-0-36" class="i">+                                    &quot;id&quot;,
</a><a href="#h87-0-37" id="h87-0-37" class="i">+                                ),
</a>                             ),
<a href="#h87-0-39" id="h87-0-39" class="d">-                            &quot;id&quot;,
</a>                         ),
                     ),
                 ),
<a href="#h87-1" id="h87-1" class="h">@@ -139,22 +149,32 @@ Plan: Plan(
</a>             },
             inner: Scan {
                 table: &quot;studios&quot;,
<a href="#h87-1-3" id="h87-1-3" class="d">-                alias: None,
</a><a href="#h87-1-4" id="h87-1-4" class="i">+                label: &quot;studios&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h87-1-10" id="h87-1-10" class="i">+                        2,
</a>                         Some(
<a href="#h87-1-12" id="h87-1-12" class="d">-                            &quot;movies&quot;,
</a><a href="#h87-1-13" id="h87-1-13" class="i">+                            (
</a><a href="#h87-1-14" id="h87-1-14" class="i">+                                Some(
</a><a href="#h87-1-15" id="h87-1-15" class="i">+                                    &quot;movies&quot;,
</a><a href="#h87-1-16" id="h87-1-16" class="i">+                                ),
</a><a href="#h87-1-17" id="h87-1-17" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h87-1-18" id="h87-1-18" class="i">+                            ),
</a>                         ),
<a href="#h87-1-20" id="h87-1-20" class="d">-                        &quot;studio_id&quot;,
</a>                     ),
                     Field(
<a href="#h87-1-23" id="h87-1-23" class="i">+                        9,
</a>                         Some(
<a href="#h87-1-25" id="h87-1-25" class="d">-                            &quot;studios&quot;,
</a><a href="#h87-1-26" id="h87-1-26" class="i">+                            (
</a><a href="#h87-1-27" id="h87-1-27" class="i">+                                Some(
</a><a href="#h87-1-28" id="h87-1-28" class="i">+                                    &quot;studios&quot;,
</a><a href="#h87-1-29" id="h87-1-29" class="i">+                                ),
</a><a href="#h87-1-30" id="h87-1-30" class="i">+                                &quot;id&quot;,
</a><a href="#h87-1-31" id="h87-1-31" class="i">+                            ),
</a>                         ),
<a href="#h87-1-33" id="h87-1-33" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h87-2" id="h87-2" class="h">@@ -172,22 +192,37 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h87-2-3" id="h87-2-3" class="i">+                1,
</a>                 Some(
<a href="#h87-2-5" id="h87-2-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h87-2-6" id="h87-2-6" class="i">+                    (
</a><a href="#h87-2-7" id="h87-2-7" class="i">+                        Some(
</a><a href="#h87-2-8" id="h87-2-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h87-2-9" id="h87-2-9" class="i">+                        ),
</a><a href="#h87-2-10" id="h87-2-10" class="i">+                        &quot;title&quot;,
</a><a href="#h87-2-11" id="h87-2-11" class="i">+                    ),
</a>                 ),
<a href="#h87-2-13" id="h87-2-13" class="d">-                &quot;title&quot;,
</a>             ),
             Field(
<a href="#h87-2-16" id="h87-2-16" class="i">+                8,
</a>                 Some(
<a href="#h87-2-18" id="h87-2-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h87-2-19" id="h87-2-19" class="i">+                    (
</a><a href="#h87-2-20" id="h87-2-20" class="i">+                        Some(
</a><a href="#h87-2-21" id="h87-2-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h87-2-22" id="h87-2-22" class="i">+                        ),
</a><a href="#h87-2-23" id="h87-2-23" class="i">+                        &quot;name&quot;,
</a><a href="#h87-2-24" id="h87-2-24" class="i">+                    ),
</a>                 ),
<a href="#h87-2-26" id="h87-2-26" class="d">-                &quot;name&quot;,
</a>             ),
             Field(
<a href="#h87-2-29" id="h87-2-29" class="i">+                10,
</a>                 Some(
<a href="#h87-2-31" id="h87-2-31" class="d">-                    &quot;studios&quot;,
</a><a href="#h87-2-32" id="h87-2-32" class="i">+                    (
</a><a href="#h87-2-33" id="h87-2-33" class="i">+                        Some(
</a><a href="#h87-2-34" id="h87-2-34" class="i">+                            &quot;studios&quot;,
</a><a href="#h87-2-35" id="h87-2-35" class="i">+                        ),
</a><a href="#h87-2-36" id="h87-2-36" class="i">+                        &quot;name&quot;,
</a><a href="#h87-2-37" id="h87-2-37" class="i">+                    ),
</a>                 ),
<a href="#h87-2-39" id="h87-2-39" class="d">-                &quot;name&quot;,
</a>             ),
         ],
     },
<a href="#h87-3" id="h87-3" class="h">@@ -199,27 +234,37 @@ Optimized plan: Plan(
</a>             outer: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h87-3-3" id="h87-3-3" class="d">-                    alias: None,
</a><a href="#h87-3-4" id="h87-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h87-3-9" id="h87-3-9" class="d">-                    alias: None,
</a><a href="#h87-3-10" id="h87-3-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: Some(
                     Equal(
                         Field(
<a href="#h87-3-16" id="h87-3-16" class="i">+                            3,
</a>                             Some(
<a href="#h87-3-18" id="h87-3-18" class="d">-                                &quot;movies&quot;,
</a><a href="#h87-3-19" id="h87-3-19" class="i">+                                (
</a><a href="#h87-3-20" id="h87-3-20" class="i">+                                    Some(
</a><a href="#h87-3-21" id="h87-3-21" class="i">+                                        &quot;movies&quot;,
</a><a href="#h87-3-22" id="h87-3-22" class="i">+                                    ),
</a><a href="#h87-3-23" id="h87-3-23" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h87-3-24" id="h87-3-24" class="i">+                                ),
</a>                             ),
<a href="#h87-3-26" id="h87-3-26" class="d">-                            &quot;genre_id&quot;,
</a>                         ),
                         Field(
<a href="#h87-3-29" id="h87-3-29" class="i">+                            7,
</a>                             Some(
<a href="#h87-3-31" id="h87-3-31" class="d">-                                &quot;genres&quot;,
</a><a href="#h87-3-32" id="h87-3-32" class="i">+                                (
</a><a href="#h87-3-33" id="h87-3-33" class="i">+                                    Some(
</a><a href="#h87-3-34" id="h87-3-34" class="i">+                                        &quot;genres&quot;,
</a><a href="#h87-3-35" id="h87-3-35" class="i">+                                    ),
</a><a href="#h87-3-36" id="h87-3-36" class="i">+                                    &quot;id&quot;,
</a><a href="#h87-3-37" id="h87-3-37" class="i">+                                ),
</a>                             ),
<a href="#h87-3-39" id="h87-3-39" class="d">-                            &quot;id&quot;,
</a>                         ),
                     ),
                 ),
<a href="#h87-4" id="h87-4" class="h">@@ -228,22 +273,32 @@ Optimized plan: Plan(
</a>             },
             inner: Scan {
                 table: &quot;studios&quot;,
<a href="#h87-4-3" id="h87-4-3" class="d">-                alias: None,
</a><a href="#h87-4-4" id="h87-4-4" class="i">+                label: &quot;studios&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h87-4-10" id="h87-4-10" class="i">+                        2,
</a>                         Some(
<a href="#h87-4-12" id="h87-4-12" class="d">-                            &quot;movies&quot;,
</a><a href="#h87-4-13" id="h87-4-13" class="i">+                            (
</a><a href="#h87-4-14" id="h87-4-14" class="i">+                                Some(
</a><a href="#h87-4-15" id="h87-4-15" class="i">+                                    &quot;movies&quot;,
</a><a href="#h87-4-16" id="h87-4-16" class="i">+                                ),
</a><a href="#h87-4-17" id="h87-4-17" class="i">+                                &quot;studio_id&quot;,
</a><a href="#h87-4-18" id="h87-4-18" class="i">+                            ),
</a>                         ),
<a href="#h87-4-20" id="h87-4-20" class="d">-                        &quot;studio_id&quot;,
</a>                     ),
                     Field(
<a href="#h87-4-23" id="h87-4-23" class="i">+                        9,
</a>                         Some(
<a href="#h87-4-25" id="h87-4-25" class="d">-                            &quot;studios&quot;,
</a><a href="#h87-4-26" id="h87-4-26" class="i">+                            (
</a><a href="#h87-4-27" id="h87-4-27" class="i">+                                Some(
</a><a href="#h87-4-28" id="h87-4-28" class="i">+                                    &quot;studios&quot;,
</a><a href="#h87-4-29" id="h87-4-29" class="i">+                                ),
</a><a href="#h87-4-30" id="h87-4-30" class="i">+                                &quot;id&quot;,
</a><a href="#h87-4-31" id="h87-4-31" class="i">+                            ),
</a>                         ),
<a href="#h87-4-33" id="h87-4-33" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h87-5" id="h87-5" class="h">@@ -261,22 +316,37 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h87-5-3" id="h87-5-3" class="i">+                1,
</a>                 Some(
<a href="#h87-5-5" id="h87-5-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h87-5-6" id="h87-5-6" class="i">+                    (
</a><a href="#h87-5-7" id="h87-5-7" class="i">+                        Some(
</a><a href="#h87-5-8" id="h87-5-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h87-5-9" id="h87-5-9" class="i">+                        ),
</a><a href="#h87-5-10" id="h87-5-10" class="i">+                        &quot;title&quot;,
</a><a href="#h87-5-11" id="h87-5-11" class="i">+                    ),
</a>                 ),
<a href="#h87-5-13" id="h87-5-13" class="d">-                &quot;title&quot;,
</a>             ),
             Field(
<a href="#h87-5-16" id="h87-5-16" class="i">+                8,
</a>                 Some(
<a href="#h87-5-18" id="h87-5-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h87-5-19" id="h87-5-19" class="i">+                    (
</a><a href="#h87-5-20" id="h87-5-20" class="i">+                        Some(
</a><a href="#h87-5-21" id="h87-5-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h87-5-22" id="h87-5-22" class="i">+                        ),
</a><a href="#h87-5-23" id="h87-5-23" class="i">+                        &quot;name&quot;,
</a><a href="#h87-5-24" id="h87-5-24" class="i">+                    ),
</a>                 ),
<a href="#h87-5-26" id="h87-5-26" class="d">-                &quot;name&quot;,
</a>             ),
             Field(
<a href="#h87-5-29" id="h87-5-29" class="i">+                10,
</a>                 Some(
<a href="#h87-5-31" id="h87-5-31" class="d">-                    &quot;studios&quot;,
</a><a href="#h87-5-32" id="h87-5-32" class="i">+                    (
</a><a href="#h87-5-33" id="h87-5-33" class="i">+                        Some(
</a><a href="#h87-5-34" id="h87-5-34" class="i">+                            &quot;studios&quot;,
</a><a href="#h87-5-35" id="h87-5-35" class="i">+                        ),
</a><a href="#h87-5-36" id="h87-5-36" class="i">+                        &quot;name&quot;,
</a><a href="#h87-5-37" id="h87-5-37" class="i">+                    ),
</a>                 ),
<a href="#h87-5-39" id="h87-5-39" class="d">-                &quot;name&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h88" href="../file/tests/sql/query/join_inner_on_aliased.html">tests/sql/query/join_inner_on_aliased</a> b/<a href="../file/tests/sql/query/join_inner_on_aliased.html">tests/sql/query/join_inner_on_aliased</a></b>
<a href="#h88-0" id="h88-0" class="h">@@ -56,31 +56,37 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h88-0-3" id="h88-0-3" class="d">-            alias: Some(
</a><a href="#h88-0-4" id="h88-0-4" class="d">-                &quot;m&quot;,
</a><a href="#h88-0-5" id="h88-0-5" class="d">-            ),
</a><a href="#h88-0-6" id="h88-0-6" class="i">+            label: &quot;m&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h88-0-11" id="h88-0-11" class="d">-            alias: Some(
</a><a href="#h88-0-12" id="h88-0-12" class="d">-                &quot;g&quot;,
</a><a href="#h88-0-13" id="h88-0-13" class="d">-            ),
</a><a href="#h88-0-14" id="h88-0-14" class="i">+            label: &quot;g&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h88-0-20" id="h88-0-20" class="i">+                    3,
</a>                     Some(
<a href="#h88-0-22" id="h88-0-22" class="d">-                        &quot;m&quot;,
</a><a href="#h88-0-23" id="h88-0-23" class="i">+                        (
</a><a href="#h88-0-24" id="h88-0-24" class="i">+                            Some(
</a><a href="#h88-0-25" id="h88-0-25" class="i">+                                &quot;m&quot;,
</a><a href="#h88-0-26" id="h88-0-26" class="i">+                            ),
</a><a href="#h88-0-27" id="h88-0-27" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h88-0-28" id="h88-0-28" class="i">+                        ),
</a>                     ),
<a href="#h88-0-30" id="h88-0-30" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h88-0-33" id="h88-0-33" class="i">+                    7,
</a>                     Some(
<a href="#h88-0-35" id="h88-0-35" class="d">-                        &quot;g&quot;,
</a><a href="#h88-0-36" id="h88-0-36" class="i">+                        (
</a><a href="#h88-0-37" id="h88-0-37" class="i">+                            Some(
</a><a href="#h88-0-38" id="h88-0-38" class="i">+                                &quot;g&quot;,
</a><a href="#h88-0-39" id="h88-0-39" class="i">+                            ),
</a><a href="#h88-0-40" id="h88-0-40" class="i">+                            &quot;id&quot;,
</a><a href="#h88-0-41" id="h88-0-41" class="i">+                        ),
</a>                     ),
<a href="#h88-0-43" id="h88-0-43" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<a href="#h88-1" id="h88-1" class="h">@@ -93,31 +99,37 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h88-1-3" id="h88-1-3" class="d">-            alias: Some(
</a><a href="#h88-1-4" id="h88-1-4" class="d">-                &quot;m&quot;,
</a><a href="#h88-1-5" id="h88-1-5" class="d">-            ),
</a><a href="#h88-1-6" id="h88-1-6" class="i">+            label: &quot;m&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h88-1-11" id="h88-1-11" class="d">-            alias: Some(
</a><a href="#h88-1-12" id="h88-1-12" class="d">-                &quot;g&quot;,
</a><a href="#h88-1-13" id="h88-1-13" class="d">-            ),
</a><a href="#h88-1-14" id="h88-1-14" class="i">+            label: &quot;g&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h88-1-20" id="h88-1-20" class="i">+                    3,
</a>                     Some(
<a href="#h88-1-22" id="h88-1-22" class="d">-                        &quot;m&quot;,
</a><a href="#h88-1-23" id="h88-1-23" class="i">+                        (
</a><a href="#h88-1-24" id="h88-1-24" class="i">+                            Some(
</a><a href="#h88-1-25" id="h88-1-25" class="i">+                                &quot;m&quot;,
</a><a href="#h88-1-26" id="h88-1-26" class="i">+                            ),
</a><a href="#h88-1-27" id="h88-1-27" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h88-1-28" id="h88-1-28" class="i">+                        ),
</a>                     ),
<a href="#h88-1-30" id="h88-1-30" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h88-1-33" id="h88-1-33" class="i">+                    7,
</a>                     Some(
<a href="#h88-1-35" id="h88-1-35" class="d">-                        &quot;g&quot;,
</a><a href="#h88-1-36" id="h88-1-36" class="i">+                        (
</a><a href="#h88-1-37" id="h88-1-37" class="i">+                            Some(
</a><a href="#h88-1-38" id="h88-1-38" class="i">+                                &quot;g&quot;,
</a><a href="#h88-1-39" id="h88-1-39" class="i">+                            ),
</a><a href="#h88-1-40" id="h88-1-40" class="i">+                            &quot;id&quot;,
</a><a href="#h88-1-41" id="h88-1-41" class="i">+                        ),
</a>                     ),
<a href="#h88-1-43" id="h88-1-43" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<b>diff --git a/<a id="h89" href="../file/tests/sql/query/join_inner_on_false.html">tests/sql/query/join_inner_on_false</a> b/<a href="../file/tests/sql/query/join_inner_on_false.html">tests/sql/query/join_inner_on_false</a></b>
<a href="#h89-0" id="h89-0" class="h">@@ -41,12 +41,12 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h89-0-3" id="h89-0-3" class="d">-            alias: None,
</a><a href="#h89-0-4" id="h89-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h89-0-9" id="h89-0-9" class="d">-            alias: None,
</a><a href="#h89-0-10" id="h89-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
<a href="#h89-1" id="h89-1" class="h">@@ -65,12 +65,12 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h89-1-3" id="h89-1-3" class="d">-            alias: None,
</a><a href="#h89-1-4" id="h89-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h89-1-9" id="h89-1-9" class="d">-            alias: None,
</a><a href="#h89-1-10" id="h89-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
<b>diff --git a/<a id="h90" href="../file/tests/sql/query/join_inner_on_multi.html">tests/sql/query/join_inner_on_multi</a> b/<a href="../file/tests/sql/query/join_inner_on_multi.html">tests/sql/query/join_inner_on_multi</a></b>
<a href="#h90-0" id="h90-0" class="h">@@ -72,42 +72,62 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h90-0-3" id="h90-0-3" class="d">-            alias: None,
</a><a href="#h90-0-4" id="h90-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h90-0-9" id="h90-0-9" class="d">-            alias: None,
</a><a href="#h90-0-10" id="h90-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             And(
                 Equal(
                     Field(
<a href="#h90-0-17" id="h90-0-17" class="i">+                        3,
</a>                         Some(
<a href="#h90-0-19" id="h90-0-19" class="d">-                            &quot;movies&quot;,
</a><a href="#h90-0-20" id="h90-0-20" class="i">+                            (
</a><a href="#h90-0-21" id="h90-0-21" class="i">+                                Some(
</a><a href="#h90-0-22" id="h90-0-22" class="i">+                                    &quot;movies&quot;,
</a><a href="#h90-0-23" id="h90-0-23" class="i">+                                ),
</a><a href="#h90-0-24" id="h90-0-24" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h90-0-25" id="h90-0-25" class="i">+                            ),
</a>                         ),
<a href="#h90-0-27" id="h90-0-27" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h90-0-30" id="h90-0-30" class="i">+                        7,
</a>                         Some(
<a href="#h90-0-32" id="h90-0-32" class="d">-                            &quot;genres&quot;,
</a><a href="#h90-0-33" id="h90-0-33" class="i">+                            (
</a><a href="#h90-0-34" id="h90-0-34" class="i">+                                Some(
</a><a href="#h90-0-35" id="h90-0-35" class="i">+                                    &quot;genres&quot;,
</a><a href="#h90-0-36" id="h90-0-36" class="i">+                                ),
</a><a href="#h90-0-37" id="h90-0-37" class="i">+                                &quot;id&quot;,
</a><a href="#h90-0-38" id="h90-0-38" class="i">+                            ),
</a>                         ),
<a href="#h90-0-40" id="h90-0-40" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
                 Equal(
                     Field(
<a href="#h90-0-45" id="h90-0-45" class="i">+                        0,
</a>                         Some(
<a href="#h90-0-47" id="h90-0-47" class="d">-                            &quot;movies&quot;,
</a><a href="#h90-0-48" id="h90-0-48" class="i">+                            (
</a><a href="#h90-0-49" id="h90-0-49" class="i">+                                Some(
</a><a href="#h90-0-50" id="h90-0-50" class="i">+                                    &quot;movies&quot;,
</a><a href="#h90-0-51" id="h90-0-51" class="i">+                                ),
</a><a href="#h90-0-52" id="h90-0-52" class="i">+                                &quot;id&quot;,
</a><a href="#h90-0-53" id="h90-0-53" class="i">+                            ),
</a>                         ),
<a href="#h90-0-55" id="h90-0-55" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h90-0-58" id="h90-0-58" class="i">+                        7,
</a>                         Some(
<a href="#h90-0-60" id="h90-0-60" class="d">-                            &quot;genres&quot;,
</a><a href="#h90-0-61" id="h90-0-61" class="i">+                            (
</a><a href="#h90-0-62" id="h90-0-62" class="i">+                                Some(
</a><a href="#h90-0-63" id="h90-0-63" class="i">+                                    &quot;genres&quot;,
</a><a href="#h90-0-64" id="h90-0-64" class="i">+                                ),
</a><a href="#h90-0-65" id="h90-0-65" class="i">+                                &quot;id&quot;,
</a><a href="#h90-0-66" id="h90-0-66" class="i">+                            ),
</a>                         ),
<a href="#h90-0-68" id="h90-0-68" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h90-1" id="h90-1" class="h">@@ -121,42 +141,62 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h90-1-3" id="h90-1-3" class="d">-            alias: None,
</a><a href="#h90-1-4" id="h90-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h90-1-9" id="h90-1-9" class="d">-            alias: None,
</a><a href="#h90-1-10" id="h90-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             And(
                 Equal(
                     Field(
<a href="#h90-1-17" id="h90-1-17" class="i">+                        3,
</a>                         Some(
<a href="#h90-1-19" id="h90-1-19" class="d">-                            &quot;movies&quot;,
</a><a href="#h90-1-20" id="h90-1-20" class="i">+                            (
</a><a href="#h90-1-21" id="h90-1-21" class="i">+                                Some(
</a><a href="#h90-1-22" id="h90-1-22" class="i">+                                    &quot;movies&quot;,
</a><a href="#h90-1-23" id="h90-1-23" class="i">+                                ),
</a><a href="#h90-1-24" id="h90-1-24" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h90-1-25" id="h90-1-25" class="i">+                            ),
</a>                         ),
<a href="#h90-1-27" id="h90-1-27" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h90-1-30" id="h90-1-30" class="i">+                        7,
</a>                         Some(
<a href="#h90-1-32" id="h90-1-32" class="d">-                            &quot;genres&quot;,
</a><a href="#h90-1-33" id="h90-1-33" class="i">+                            (
</a><a href="#h90-1-34" id="h90-1-34" class="i">+                                Some(
</a><a href="#h90-1-35" id="h90-1-35" class="i">+                                    &quot;genres&quot;,
</a><a href="#h90-1-36" id="h90-1-36" class="i">+                                ),
</a><a href="#h90-1-37" id="h90-1-37" class="i">+                                &quot;id&quot;,
</a><a href="#h90-1-38" id="h90-1-38" class="i">+                            ),
</a>                         ),
<a href="#h90-1-40" id="h90-1-40" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
                 Equal(
                     Field(
<a href="#h90-1-45" id="h90-1-45" class="i">+                        0,
</a>                         Some(
<a href="#h90-1-47" id="h90-1-47" class="d">-                            &quot;movies&quot;,
</a><a href="#h90-1-48" id="h90-1-48" class="i">+                            (
</a><a href="#h90-1-49" id="h90-1-49" class="i">+                                Some(
</a><a href="#h90-1-50" id="h90-1-50" class="i">+                                    &quot;movies&quot;,
</a><a href="#h90-1-51" id="h90-1-51" class="i">+                                ),
</a><a href="#h90-1-52" id="h90-1-52" class="i">+                                &quot;id&quot;,
</a><a href="#h90-1-53" id="h90-1-53" class="i">+                            ),
</a>                         ),
<a href="#h90-1-55" id="h90-1-55" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h90-1-58" id="h90-1-58" class="i">+                        7,
</a>                         Some(
<a href="#h90-1-60" id="h90-1-60" class="d">-                            &quot;genres&quot;,
</a><a href="#h90-1-61" id="h90-1-61" class="i">+                            (
</a><a href="#h90-1-62" id="h90-1-62" class="i">+                                Some(
</a><a href="#h90-1-63" id="h90-1-63" class="i">+                                    &quot;genres&quot;,
</a><a href="#h90-1-64" id="h90-1-64" class="i">+                                ),
</a><a href="#h90-1-65" id="h90-1-65" class="i">+                                &quot;id&quot;,
</a><a href="#h90-1-66" id="h90-1-66" class="i">+                            ),
</a>                         ),
<a href="#h90-1-68" id="h90-1-68" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<b>diff --git a/<a id="h91" href="../file/tests/sql/query/join_inner_on_true.html">tests/sql/query/join_inner_on_true</a> b/<a href="../file/tests/sql/query/join_inner_on_true.html">tests/sql/query/join_inner_on_true</a></b>
<a href="#h91-0" id="h91-0" class="h">@@ -41,12 +41,12 @@ Plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h91-0-3" id="h91-0-3" class="d">-            alias: None,
</a><a href="#h91-0-4" id="h91-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h91-0-9" id="h91-0-9" class="d">-            alias: None,
</a><a href="#h91-0-10" id="h91-0-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
<a href="#h91-1" id="h91-1" class="h">@@ -65,12 +65,12 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h91-1-3" id="h91-1-3" class="d">-            alias: None,
</a><a href="#h91-1-4" id="h91-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h91-1-9" id="h91-1-9" class="d">-            alias: None,
</a><a href="#h91-1-10" id="h91-1-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
<b>diff --git a/<a id="h92" href="../file/tests/sql/query/join_inner_on_where.html">tests/sql/query/join_inner_on_where</a> b/<a href="../file/tests/sql/query/join_inner_on_where.html">tests/sql/query/join_inner_on_where</a></b>
<a href="#h92-0" id="h92-0" class="h">@@ -71,27 +71,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h92-0-3" id="h92-0-3" class="d">-                alias: None,
</a><a href="#h92-0-4" id="h92-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h92-0-9" id="h92-0-9" class="d">-                alias: None,
</a><a href="#h92-0-10" id="h92-0-10" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h92-0-16" id="h92-0-16" class="i">+                        3,
</a>                         Some(
<a href="#h92-0-18" id="h92-0-18" class="d">-                            &quot;movies&quot;,
</a><a href="#h92-0-19" id="h92-0-19" class="i">+                            (
</a><a href="#h92-0-20" id="h92-0-20" class="i">+                                Some(
</a><a href="#h92-0-21" id="h92-0-21" class="i">+                                    &quot;movies&quot;,
</a><a href="#h92-0-22" id="h92-0-22" class="i">+                                ),
</a><a href="#h92-0-23" id="h92-0-23" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h92-0-24" id="h92-0-24" class="i">+                            ),
</a>                         ),
<a href="#h92-0-26" id="h92-0-26" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h92-0-29" id="h92-0-29" class="i">+                        7,
</a>                         Some(
<a href="#h92-0-31" id="h92-0-31" class="d">-                            &quot;genres&quot;,
</a><a href="#h92-0-32" id="h92-0-32" class="i">+                            (
</a><a href="#h92-0-33" id="h92-0-33" class="i">+                                Some(
</a><a href="#h92-0-34" id="h92-0-34" class="i">+                                    &quot;genres&quot;,
</a><a href="#h92-0-35" id="h92-0-35" class="i">+                                ),
</a><a href="#h92-0-36" id="h92-0-36" class="i">+                                &quot;id&quot;,
</a><a href="#h92-0-37" id="h92-0-37" class="i">+                            ),
</a>                         ),
<a href="#h92-0-39" id="h92-0-39" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h92-1" id="h92-1" class="h">@@ -101,10 +111,15 @@ Plan: Plan(
</a>         predicate: Or(
             GreaterThan(
                 Field(
<a href="#h92-1-3" id="h92-1-3" class="i">+                    0,
</a>                     Some(
<a href="#h92-1-5" id="h92-1-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h92-1-6" id="h92-1-6" class="i">+                        (
</a><a href="#h92-1-7" id="h92-1-7" class="i">+                            Some(
</a><a href="#h92-1-8" id="h92-1-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h92-1-9" id="h92-1-9" class="i">+                            ),
</a><a href="#h92-1-10" id="h92-1-10" class="i">+                            &quot;id&quot;,
</a><a href="#h92-1-11" id="h92-1-11" class="i">+                        ),
</a>                     ),
<a href="#h92-1-13" id="h92-1-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Constant(
                     Integer(
<a href="#h92-2" id="h92-2" class="h">@@ -114,10 +129,15 @@ Plan: Plan(
</a>             ),
             Equal(
                 Field(
<a href="#h92-2-3" id="h92-2-3" class="i">+                    0,
</a>                     Some(
<a href="#h92-2-5" id="h92-2-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h92-2-6" id="h92-2-6" class="i">+                        (
</a><a href="#h92-2-7" id="h92-2-7" class="i">+                            Some(
</a><a href="#h92-2-8" id="h92-2-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h92-2-9" id="h92-2-9" class="i">+                            ),
</a><a href="#h92-2-10" id="h92-2-10" class="i">+                            &quot;id&quot;,
</a><a href="#h92-2-11" id="h92-2-11" class="i">+                        ),
</a>                     ),
<a href="#h92-2-13" id="h92-2-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Constant(
                     Integer(
<a href="#h92-3" id="h92-3" class="h">@@ -133,12 +153,12 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h92-3-3" id="h92-3-3" class="d">-            alias: None,
</a><a href="#h92-3-4" id="h92-3-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h92-3-9" id="h92-3-9" class="d">-            alias: None,
</a><a href="#h92-3-10" id="h92-3-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
<a href="#h92-4" id="h92-4" class="h">@@ -146,10 +166,15 @@ Optimized plan: Plan(
</a>                 Or(
                     GreaterThan(
                         Field(
<a href="#h92-4-3" id="h92-4-3" class="i">+                            0,
</a>                             Some(
<a href="#h92-4-5" id="h92-4-5" class="d">-                                &quot;movies&quot;,
</a><a href="#h92-4-6" id="h92-4-6" class="i">+                                (
</a><a href="#h92-4-7" id="h92-4-7" class="i">+                                    Some(
</a><a href="#h92-4-8" id="h92-4-8" class="i">+                                        &quot;movies&quot;,
</a><a href="#h92-4-9" id="h92-4-9" class="i">+                                    ),
</a><a href="#h92-4-10" id="h92-4-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h92-4-11" id="h92-4-11" class="i">+                                ),
</a>                             ),
<a href="#h92-4-13" id="h92-4-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h92-5" id="h92-5" class="h">@@ -159,10 +184,15 @@ Optimized plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h92-5-3" id="h92-5-3" class="i">+                            0,
</a>                             Some(
<a href="#h92-5-5" id="h92-5-5" class="d">-                                &quot;movies&quot;,
</a><a href="#h92-5-6" id="h92-5-6" class="i">+                                (
</a><a href="#h92-5-7" id="h92-5-7" class="i">+                                    Some(
</a><a href="#h92-5-8" id="h92-5-8" class="i">+                                        &quot;movies&quot;,
</a><a href="#h92-5-9" id="h92-5-9" class="i">+                                    ),
</a><a href="#h92-5-10" id="h92-5-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h92-5-11" id="h92-5-11" class="i">+                                ),
</a>                             ),
<a href="#h92-5-13" id="h92-5-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h92-6" id="h92-6" class="h">@@ -173,16 +203,26 @@ Optimized plan: Plan(
</a>                 ),
                 Equal(
                     Field(
<a href="#h92-6-3" id="h92-6-3" class="i">+                        3,
</a>                         Some(
<a href="#h92-6-5" id="h92-6-5" class="d">-                            &quot;movies&quot;,
</a><a href="#h92-6-6" id="h92-6-6" class="i">+                            (
</a><a href="#h92-6-7" id="h92-6-7" class="i">+                                Some(
</a><a href="#h92-6-8" id="h92-6-8" class="i">+                                    &quot;movies&quot;,
</a><a href="#h92-6-9" id="h92-6-9" class="i">+                                ),
</a><a href="#h92-6-10" id="h92-6-10" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h92-6-11" id="h92-6-11" class="i">+                            ),
</a>                         ),
<a href="#h92-6-13" id="h92-6-13" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h92-6-16" id="h92-6-16" class="i">+                        7,
</a>                         Some(
<a href="#h92-6-18" id="h92-6-18" class="d">-                            &quot;genres&quot;,
</a><a href="#h92-6-19" id="h92-6-19" class="i">+                            (
</a><a href="#h92-6-20" id="h92-6-20" class="i">+                                Some(
</a><a href="#h92-6-21" id="h92-6-21" class="i">+                                    &quot;genres&quot;,
</a><a href="#h92-6-22" id="h92-6-22" class="i">+                                ),
</a><a href="#h92-6-23" id="h92-6-23" class="i">+                                &quot;id&quot;,
</a><a href="#h92-6-24" id="h92-6-24" class="i">+                            ),
</a>                         ),
<a href="#h92-6-26" id="h92-6-26" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<b>diff --git a/<a id="h93" href="../file/tests/sql/query/join_left.html">tests/sql/query/join_left</a> b/<a href="../file/tests/sql/query/join_left.html">tests/sql/query/join_left</a></b>
<a href="#h93-0" id="h93-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h93-0-3" id="h93-0-3" class="d">-                alias: Some(
</a><a href="#h93-0-4" id="h93-0-4" class="d">-                    &quot;m&quot;,
</a><a href="#h93-0-5" id="h93-0-5" class="d">-                ),
</a><a href="#h93-0-6" id="h93-0-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h93-0-11" id="h93-0-11" class="d">-                alias: Some(
</a><a href="#h93-0-12" id="h93-0-12" class="d">-                    &quot;g&quot;,
</a><a href="#h93-0-13" id="h93-0-13" class="d">-                ),
</a><a href="#h93-0-14" id="h93-0-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h93-0-20" id="h93-0-20" class="i">+                        0,
</a>                         Some(
<a href="#h93-0-22" id="h93-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h93-0-23" id="h93-0-23" class="i">+                            (
</a><a href="#h93-0-24" id="h93-0-24" class="i">+                                Some(
</a><a href="#h93-0-25" id="h93-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h93-0-26" id="h93-0-26" class="i">+                                ),
</a><a href="#h93-0-27" id="h93-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h93-0-28" id="h93-0-28" class="i">+                            ),
</a>                         ),
<a href="#h93-0-30" id="h93-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h93-0-33" id="h93-0-33" class="i">+                        7,
</a>                         Some(
<a href="#h93-0-35" id="h93-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h93-0-36" id="h93-0-36" class="i">+                            (
</a><a href="#h93-0-37" id="h93-0-37" class="i">+                                Some(
</a><a href="#h93-0-38" id="h93-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h93-0-39" id="h93-0-39" class="i">+                                ),
</a><a href="#h93-0-40" id="h93-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h93-0-41" id="h93-0-41" class="i">+                            ),
</a>                         ),
<a href="#h93-0-43" id="h93-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h93-1" id="h93-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h93-1-3" id="h93-1-3" class="i">+                0,
</a>                 Some(
<a href="#h93-1-5" id="h93-1-5" class="d">-                    &quot;m&quot;,
</a><a href="#h93-1-6" id="h93-1-6" class="i">+                    (
</a><a href="#h93-1-7" id="h93-1-7" class="i">+                        Some(
</a><a href="#h93-1-8" id="h93-1-8" class="i">+                            &quot;m&quot;,
</a><a href="#h93-1-9" id="h93-1-9" class="i">+                        ),
</a><a href="#h93-1-10" id="h93-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h93-1-11" id="h93-1-11" class="i">+                    ),
</a>                 ),
<a href="#h93-1-13" id="h93-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h93-1-16" id="h93-1-16" class="i">+                7,
</a>                 Some(
<a href="#h93-1-18" id="h93-1-18" class="d">-                    &quot;g&quot;,
</a><a href="#h93-1-19" id="h93-1-19" class="i">+                    (
</a><a href="#h93-1-20" id="h93-1-20" class="i">+                        Some(
</a><a href="#h93-1-21" id="h93-1-21" class="i">+                            &quot;g&quot;,
</a><a href="#h93-1-22" id="h93-1-22" class="i">+                        ),
</a><a href="#h93-1-23" id="h93-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h93-1-24" id="h93-1-24" class="i">+                    ),
</a>                 ),
<a href="#h93-1-26" id="h93-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h93-2" id="h93-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h93-2-3" id="h93-2-3" class="d">-                alias: Some(
</a><a href="#h93-2-4" id="h93-2-4" class="d">-                    &quot;m&quot;,
</a><a href="#h93-2-5" id="h93-2-5" class="d">-                ),
</a><a href="#h93-2-6" id="h93-2-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h93-2-11" id="h93-2-11" class="d">-                alias: Some(
</a><a href="#h93-2-12" id="h93-2-12" class="d">-                    &quot;g&quot;,
</a><a href="#h93-2-13" id="h93-2-13" class="d">-                ),
</a><a href="#h93-2-14" id="h93-2-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h93-2-20" id="h93-2-20" class="i">+                        0,
</a>                         Some(
<a href="#h93-2-22" id="h93-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h93-2-23" id="h93-2-23" class="i">+                            (
</a><a href="#h93-2-24" id="h93-2-24" class="i">+                                Some(
</a><a href="#h93-2-25" id="h93-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h93-2-26" id="h93-2-26" class="i">+                                ),
</a><a href="#h93-2-27" id="h93-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h93-2-28" id="h93-2-28" class="i">+                            ),
</a>                         ),
<a href="#h93-2-30" id="h93-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h93-2-33" id="h93-2-33" class="i">+                        7,
</a>                         Some(
<a href="#h93-2-35" id="h93-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h93-2-36" id="h93-2-36" class="i">+                            (
</a><a href="#h93-2-37" id="h93-2-37" class="i">+                                Some(
</a><a href="#h93-2-38" id="h93-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h93-2-39" id="h93-2-39" class="i">+                                ),
</a><a href="#h93-2-40" id="h93-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h93-2-41" id="h93-2-41" class="i">+                            ),
</a>                         ),
<a href="#h93-2-43" id="h93-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h93-3" id="h93-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h93-3-3" id="h93-3-3" class="i">+                0,
</a>                 Some(
<a href="#h93-3-5" id="h93-3-5" class="d">-                    &quot;m&quot;,
</a><a href="#h93-3-6" id="h93-3-6" class="i">+                    (
</a><a href="#h93-3-7" id="h93-3-7" class="i">+                        Some(
</a><a href="#h93-3-8" id="h93-3-8" class="i">+                            &quot;m&quot;,
</a><a href="#h93-3-9" id="h93-3-9" class="i">+                        ),
</a><a href="#h93-3-10" id="h93-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h93-3-11" id="h93-3-11" class="i">+                    ),
</a>                 ),
<a href="#h93-3-13" id="h93-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h93-3-16" id="h93-3-16" class="i">+                7,
</a>                 Some(
<a href="#h93-3-18" id="h93-3-18" class="d">-                    &quot;g&quot;,
</a><a href="#h93-3-19" id="h93-3-19" class="i">+                    (
</a><a href="#h93-3-20" id="h93-3-20" class="i">+                        Some(
</a><a href="#h93-3-21" id="h93-3-21" class="i">+                            &quot;g&quot;,
</a><a href="#h93-3-22" id="h93-3-22" class="i">+                        ),
</a><a href="#h93-3-23" id="h93-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h93-3-24" id="h93-3-24" class="i">+                    ),
</a>                 ),
<a href="#h93-3-26" id="h93-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h94" href="../file/tests/sql/query/join_left_outer.html">tests/sql/query/join_left_outer</a> b/<a href="../file/tests/sql/query/join_left_outer.html">tests/sql/query/join_left_outer</a></b>
<a href="#h94-0" id="h94-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h94-0-3" id="h94-0-3" class="d">-                alias: Some(
</a><a href="#h94-0-4" id="h94-0-4" class="d">-                    &quot;m&quot;,
</a><a href="#h94-0-5" id="h94-0-5" class="d">-                ),
</a><a href="#h94-0-6" id="h94-0-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h94-0-11" id="h94-0-11" class="d">-                alias: Some(
</a><a href="#h94-0-12" id="h94-0-12" class="d">-                    &quot;g&quot;,
</a><a href="#h94-0-13" id="h94-0-13" class="d">-                ),
</a><a href="#h94-0-14" id="h94-0-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h94-0-20" id="h94-0-20" class="i">+                        0,
</a>                         Some(
<a href="#h94-0-22" id="h94-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h94-0-23" id="h94-0-23" class="i">+                            (
</a><a href="#h94-0-24" id="h94-0-24" class="i">+                                Some(
</a><a href="#h94-0-25" id="h94-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h94-0-26" id="h94-0-26" class="i">+                                ),
</a><a href="#h94-0-27" id="h94-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h94-0-28" id="h94-0-28" class="i">+                            ),
</a>                         ),
<a href="#h94-0-30" id="h94-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h94-0-33" id="h94-0-33" class="i">+                        7,
</a>                         Some(
<a href="#h94-0-35" id="h94-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h94-0-36" id="h94-0-36" class="i">+                            (
</a><a href="#h94-0-37" id="h94-0-37" class="i">+                                Some(
</a><a href="#h94-0-38" id="h94-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h94-0-39" id="h94-0-39" class="i">+                                ),
</a><a href="#h94-0-40" id="h94-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h94-0-41" id="h94-0-41" class="i">+                            ),
</a>                         ),
<a href="#h94-0-43" id="h94-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h94-1" id="h94-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h94-1-3" id="h94-1-3" class="i">+                0,
</a>                 Some(
<a href="#h94-1-5" id="h94-1-5" class="d">-                    &quot;m&quot;,
</a><a href="#h94-1-6" id="h94-1-6" class="i">+                    (
</a><a href="#h94-1-7" id="h94-1-7" class="i">+                        Some(
</a><a href="#h94-1-8" id="h94-1-8" class="i">+                            &quot;m&quot;,
</a><a href="#h94-1-9" id="h94-1-9" class="i">+                        ),
</a><a href="#h94-1-10" id="h94-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h94-1-11" id="h94-1-11" class="i">+                    ),
</a>                 ),
<a href="#h94-1-13" id="h94-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h94-1-16" id="h94-1-16" class="i">+                7,
</a>                 Some(
<a href="#h94-1-18" id="h94-1-18" class="d">-                    &quot;g&quot;,
</a><a href="#h94-1-19" id="h94-1-19" class="i">+                    (
</a><a href="#h94-1-20" id="h94-1-20" class="i">+                        Some(
</a><a href="#h94-1-21" id="h94-1-21" class="i">+                            &quot;g&quot;,
</a><a href="#h94-1-22" id="h94-1-22" class="i">+                        ),
</a><a href="#h94-1-23" id="h94-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h94-1-24" id="h94-1-24" class="i">+                    ),
</a>                 ),
<a href="#h94-1-26" id="h94-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h94-2" id="h94-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h94-2-3" id="h94-2-3" class="d">-                alias: Some(
</a><a href="#h94-2-4" id="h94-2-4" class="d">-                    &quot;m&quot;,
</a><a href="#h94-2-5" id="h94-2-5" class="d">-                ),
</a><a href="#h94-2-6" id="h94-2-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h94-2-11" id="h94-2-11" class="d">-                alias: Some(
</a><a href="#h94-2-12" id="h94-2-12" class="d">-                    &quot;g&quot;,
</a><a href="#h94-2-13" id="h94-2-13" class="d">-                ),
</a><a href="#h94-2-14" id="h94-2-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h94-2-20" id="h94-2-20" class="i">+                        0,
</a>                         Some(
<a href="#h94-2-22" id="h94-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h94-2-23" id="h94-2-23" class="i">+                            (
</a><a href="#h94-2-24" id="h94-2-24" class="i">+                                Some(
</a><a href="#h94-2-25" id="h94-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h94-2-26" id="h94-2-26" class="i">+                                ),
</a><a href="#h94-2-27" id="h94-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h94-2-28" id="h94-2-28" class="i">+                            ),
</a>                         ),
<a href="#h94-2-30" id="h94-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h94-2-33" id="h94-2-33" class="i">+                        7,
</a>                         Some(
<a href="#h94-2-35" id="h94-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h94-2-36" id="h94-2-36" class="i">+                            (
</a><a href="#h94-2-37" id="h94-2-37" class="i">+                                Some(
</a><a href="#h94-2-38" id="h94-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h94-2-39" id="h94-2-39" class="i">+                                ),
</a><a href="#h94-2-40" id="h94-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h94-2-41" id="h94-2-41" class="i">+                            ),
</a>                         ),
<a href="#h94-2-43" id="h94-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h94-3" id="h94-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h94-3-3" id="h94-3-3" class="i">+                0,
</a>                 Some(
<a href="#h94-3-5" id="h94-3-5" class="d">-                    &quot;m&quot;,
</a><a href="#h94-3-6" id="h94-3-6" class="i">+                    (
</a><a href="#h94-3-7" id="h94-3-7" class="i">+                        Some(
</a><a href="#h94-3-8" id="h94-3-8" class="i">+                            &quot;m&quot;,
</a><a href="#h94-3-9" id="h94-3-9" class="i">+                        ),
</a><a href="#h94-3-10" id="h94-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h94-3-11" id="h94-3-11" class="i">+                    ),
</a>                 ),
<a href="#h94-3-13" id="h94-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h94-3-16" id="h94-3-16" class="i">+                7,
</a>                 Some(
<a href="#h94-3-18" id="h94-3-18" class="d">-                    &quot;g&quot;,
</a><a href="#h94-3-19" id="h94-3-19" class="i">+                    (
</a><a href="#h94-3-20" id="h94-3-20" class="i">+                        Some(
</a><a href="#h94-3-21" id="h94-3-21" class="i">+                            &quot;g&quot;,
</a><a href="#h94-3-22" id="h94-3-22" class="i">+                        ),
</a><a href="#h94-3-23" id="h94-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h94-3-24" id="h94-3-24" class="i">+                    ),
</a>                 ),
<a href="#h94-3-26" id="h94-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h95" href="../file/tests/sql/query/join_left_truncate.html">tests/sql/query/join_left_truncate</a> b/<a href="../file/tests/sql/query/join_left_truncate.html">tests/sql/query/join_left_truncate</a></b>
<a href="#h95-0" id="h95-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h95-0-3" id="h95-0-3" class="d">-                alias: Some(
</a><a href="#h95-0-4" id="h95-0-4" class="d">-                    &quot;g&quot;,
</a><a href="#h95-0-5" id="h95-0-5" class="d">-                ),
</a><a href="#h95-0-6" id="h95-0-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h95-0-11" id="h95-0-11" class="d">-                alias: Some(
</a><a href="#h95-0-12" id="h95-0-12" class="d">-                    &quot;m&quot;,
</a><a href="#h95-0-13" id="h95-0-13" class="d">-                ),
</a><a href="#h95-0-14" id="h95-0-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h95-0-20" id="h95-0-20" class="i">+                        2,
</a>                         Some(
<a href="#h95-0-22" id="h95-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h95-0-23" id="h95-0-23" class="i">+                            (
</a><a href="#h95-0-24" id="h95-0-24" class="i">+                                Some(
</a><a href="#h95-0-25" id="h95-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h95-0-26" id="h95-0-26" class="i">+                                ),
</a><a href="#h95-0-27" id="h95-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h95-0-28" id="h95-0-28" class="i">+                            ),
</a>                         ),
<a href="#h95-0-30" id="h95-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h95-0-33" id="h95-0-33" class="i">+                        0,
</a>                         Some(
<a href="#h95-0-35" id="h95-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h95-0-36" id="h95-0-36" class="i">+                            (
</a><a href="#h95-0-37" id="h95-0-37" class="i">+                                Some(
</a><a href="#h95-0-38" id="h95-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h95-0-39" id="h95-0-39" class="i">+                                ),
</a><a href="#h95-0-40" id="h95-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h95-0-41" id="h95-0-41" class="i">+                            ),
</a>                         ),
<a href="#h95-0-43" id="h95-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h95-1" id="h95-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h95-1-3" id="h95-1-3" class="i">+                0,
</a>                 Some(
<a href="#h95-1-5" id="h95-1-5" class="d">-                    &quot;g&quot;,
</a><a href="#h95-1-6" id="h95-1-6" class="i">+                    (
</a><a href="#h95-1-7" id="h95-1-7" class="i">+                        Some(
</a><a href="#h95-1-8" id="h95-1-8" class="i">+                            &quot;g&quot;,
</a><a href="#h95-1-9" id="h95-1-9" class="i">+                        ),
</a><a href="#h95-1-10" id="h95-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h95-1-11" id="h95-1-11" class="i">+                    ),
</a>                 ),
<a href="#h95-1-13" id="h95-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h95-1-16" id="h95-1-16" class="i">+                2,
</a>                 Some(
<a href="#h95-1-18" id="h95-1-18" class="d">-                    &quot;m&quot;,
</a><a href="#h95-1-19" id="h95-1-19" class="i">+                    (
</a><a href="#h95-1-20" id="h95-1-20" class="i">+                        Some(
</a><a href="#h95-1-21" id="h95-1-21" class="i">+                            &quot;m&quot;,
</a><a href="#h95-1-22" id="h95-1-22" class="i">+                        ),
</a><a href="#h95-1-23" id="h95-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h95-1-24" id="h95-1-24" class="i">+                    ),
</a>                 ),
<a href="#h95-1-26" id="h95-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h95-2" id="h95-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h95-2-3" id="h95-2-3" class="d">-                alias: Some(
</a><a href="#h95-2-4" id="h95-2-4" class="d">-                    &quot;g&quot;,
</a><a href="#h95-2-5" id="h95-2-5" class="d">-                ),
</a><a href="#h95-2-6" id="h95-2-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h95-2-11" id="h95-2-11" class="d">-                alias: Some(
</a><a href="#h95-2-12" id="h95-2-12" class="d">-                    &quot;m&quot;,
</a><a href="#h95-2-13" id="h95-2-13" class="d">-                ),
</a><a href="#h95-2-14" id="h95-2-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h95-2-20" id="h95-2-20" class="i">+                        2,
</a>                         Some(
<a href="#h95-2-22" id="h95-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h95-2-23" id="h95-2-23" class="i">+                            (
</a><a href="#h95-2-24" id="h95-2-24" class="i">+                                Some(
</a><a href="#h95-2-25" id="h95-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h95-2-26" id="h95-2-26" class="i">+                                ),
</a><a href="#h95-2-27" id="h95-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h95-2-28" id="h95-2-28" class="i">+                            ),
</a>                         ),
<a href="#h95-2-30" id="h95-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h95-2-33" id="h95-2-33" class="i">+                        0,
</a>                         Some(
<a href="#h95-2-35" id="h95-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h95-2-36" id="h95-2-36" class="i">+                            (
</a><a href="#h95-2-37" id="h95-2-37" class="i">+                                Some(
</a><a href="#h95-2-38" id="h95-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h95-2-39" id="h95-2-39" class="i">+                                ),
</a><a href="#h95-2-40" id="h95-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h95-2-41" id="h95-2-41" class="i">+                            ),
</a>                         ),
<a href="#h95-2-43" id="h95-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h95-3" id="h95-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h95-3-3" id="h95-3-3" class="i">+                0,
</a>                 Some(
<a href="#h95-3-5" id="h95-3-5" class="d">-                    &quot;g&quot;,
</a><a href="#h95-3-6" id="h95-3-6" class="i">+                    (
</a><a href="#h95-3-7" id="h95-3-7" class="i">+                        Some(
</a><a href="#h95-3-8" id="h95-3-8" class="i">+                            &quot;g&quot;,
</a><a href="#h95-3-9" id="h95-3-9" class="i">+                        ),
</a><a href="#h95-3-10" id="h95-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h95-3-11" id="h95-3-11" class="i">+                    ),
</a>                 ),
<a href="#h95-3-13" id="h95-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h95-3-16" id="h95-3-16" class="i">+                2,
</a>                 Some(
<a href="#h95-3-18" id="h95-3-18" class="d">-                    &quot;m&quot;,
</a><a href="#h95-3-19" id="h95-3-19" class="i">+                    (
</a><a href="#h95-3-20" id="h95-3-20" class="i">+                        Some(
</a><a href="#h95-3-21" id="h95-3-21" class="i">+                            &quot;m&quot;,
</a><a href="#h95-3-22" id="h95-3-22" class="i">+                        ),
</a><a href="#h95-3-23" id="h95-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h95-3-24" id="h95-3-24" class="i">+                    ),
</a>                 ),
<a href="#h95-3-26" id="h95-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h96" href="../file/tests/sql/query/join_right.html">tests/sql/query/join_right</a> b/<a href="../file/tests/sql/query/join_right.html">tests/sql/query/join_right</a></b>
<a href="#h96-0" id="h96-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h96-0-3" id="h96-0-3" class="d">-                alias: Some(
</a><a href="#h96-0-4" id="h96-0-4" class="d">-                    &quot;g&quot;,
</a><a href="#h96-0-5" id="h96-0-5" class="d">-                ),
</a><a href="#h96-0-6" id="h96-0-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h96-0-11" id="h96-0-11" class="d">-                alias: Some(
</a><a href="#h96-0-12" id="h96-0-12" class="d">-                    &quot;m&quot;,
</a><a href="#h96-0-13" id="h96-0-13" class="d">-                ),
</a><a href="#h96-0-14" id="h96-0-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h96-0-20" id="h96-0-20" class="i">+                        2,
</a>                         Some(
<a href="#h96-0-22" id="h96-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h96-0-23" id="h96-0-23" class="i">+                            (
</a><a href="#h96-0-24" id="h96-0-24" class="i">+                                Some(
</a><a href="#h96-0-25" id="h96-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h96-0-26" id="h96-0-26" class="i">+                                ),
</a><a href="#h96-0-27" id="h96-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h96-0-28" id="h96-0-28" class="i">+                            ),
</a>                         ),
<a href="#h96-0-30" id="h96-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h96-0-33" id="h96-0-33" class="i">+                        0,
</a>                         Some(
<a href="#h96-0-35" id="h96-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h96-0-36" id="h96-0-36" class="i">+                            (
</a><a href="#h96-0-37" id="h96-0-37" class="i">+                                Some(
</a><a href="#h96-0-38" id="h96-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h96-0-39" id="h96-0-39" class="i">+                                ),
</a><a href="#h96-0-40" id="h96-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h96-0-41" id="h96-0-41" class="i">+                            ),
</a>                         ),
<a href="#h96-0-43" id="h96-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h96-1" id="h96-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h96-1-3" id="h96-1-3" class="i">+                0,
</a>                 Some(
<a href="#h96-1-5" id="h96-1-5" class="d">-                    &quot;g&quot;,
</a><a href="#h96-1-6" id="h96-1-6" class="i">+                    (
</a><a href="#h96-1-7" id="h96-1-7" class="i">+                        Some(
</a><a href="#h96-1-8" id="h96-1-8" class="i">+                            &quot;g&quot;,
</a><a href="#h96-1-9" id="h96-1-9" class="i">+                        ),
</a><a href="#h96-1-10" id="h96-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h96-1-11" id="h96-1-11" class="i">+                    ),
</a>                 ),
<a href="#h96-1-13" id="h96-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h96-1-16" id="h96-1-16" class="i">+                2,
</a>                 Some(
<a href="#h96-1-18" id="h96-1-18" class="d">-                    &quot;m&quot;,
</a><a href="#h96-1-19" id="h96-1-19" class="i">+                    (
</a><a href="#h96-1-20" id="h96-1-20" class="i">+                        Some(
</a><a href="#h96-1-21" id="h96-1-21" class="i">+                            &quot;m&quot;,
</a><a href="#h96-1-22" id="h96-1-22" class="i">+                        ),
</a><a href="#h96-1-23" id="h96-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h96-1-24" id="h96-1-24" class="i">+                    ),
</a>                 ),
<a href="#h96-1-26" id="h96-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h96-2" id="h96-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h96-2-3" id="h96-2-3" class="d">-                alias: Some(
</a><a href="#h96-2-4" id="h96-2-4" class="d">-                    &quot;g&quot;,
</a><a href="#h96-2-5" id="h96-2-5" class="d">-                ),
</a><a href="#h96-2-6" id="h96-2-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h96-2-11" id="h96-2-11" class="d">-                alias: Some(
</a><a href="#h96-2-12" id="h96-2-12" class="d">-                    &quot;m&quot;,
</a><a href="#h96-2-13" id="h96-2-13" class="d">-                ),
</a><a href="#h96-2-14" id="h96-2-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h96-2-20" id="h96-2-20" class="i">+                        2,
</a>                         Some(
<a href="#h96-2-22" id="h96-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h96-2-23" id="h96-2-23" class="i">+                            (
</a><a href="#h96-2-24" id="h96-2-24" class="i">+                                Some(
</a><a href="#h96-2-25" id="h96-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h96-2-26" id="h96-2-26" class="i">+                                ),
</a><a href="#h96-2-27" id="h96-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h96-2-28" id="h96-2-28" class="i">+                            ),
</a>                         ),
<a href="#h96-2-30" id="h96-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h96-2-33" id="h96-2-33" class="i">+                        0,
</a>                         Some(
<a href="#h96-2-35" id="h96-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h96-2-36" id="h96-2-36" class="i">+                            (
</a><a href="#h96-2-37" id="h96-2-37" class="i">+                                Some(
</a><a href="#h96-2-38" id="h96-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h96-2-39" id="h96-2-39" class="i">+                                ),
</a><a href="#h96-2-40" id="h96-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h96-2-41" id="h96-2-41" class="i">+                            ),
</a>                         ),
<a href="#h96-2-43" id="h96-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h96-3" id="h96-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h96-3-3" id="h96-3-3" class="i">+                0,
</a>                 Some(
<a href="#h96-3-5" id="h96-3-5" class="d">-                    &quot;g&quot;,
</a><a href="#h96-3-6" id="h96-3-6" class="i">+                    (
</a><a href="#h96-3-7" id="h96-3-7" class="i">+                        Some(
</a><a href="#h96-3-8" id="h96-3-8" class="i">+                            &quot;g&quot;,
</a><a href="#h96-3-9" id="h96-3-9" class="i">+                        ),
</a><a href="#h96-3-10" id="h96-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h96-3-11" id="h96-3-11" class="i">+                    ),
</a>                 ),
<a href="#h96-3-13" id="h96-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h96-3-16" id="h96-3-16" class="i">+                2,
</a>                 Some(
<a href="#h96-3-18" id="h96-3-18" class="d">-                    &quot;m&quot;,
</a><a href="#h96-3-19" id="h96-3-19" class="i">+                    (
</a><a href="#h96-3-20" id="h96-3-20" class="i">+                        Some(
</a><a href="#h96-3-21" id="h96-3-21" class="i">+                            &quot;m&quot;,
</a><a href="#h96-3-22" id="h96-3-22" class="i">+                        ),
</a><a href="#h96-3-23" id="h96-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h96-3-24" id="h96-3-24" class="i">+                    ),
</a>                 ),
<a href="#h96-3-26" id="h96-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h97" href="../file/tests/sql/query/join_right_outer.html">tests/sql/query/join_right_outer</a> b/<a href="../file/tests/sql/query/join_right_outer.html">tests/sql/query/join_right_outer</a></b>
<a href="#h97-0" id="h97-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h97-0-3" id="h97-0-3" class="d">-                alias: Some(
</a><a href="#h97-0-4" id="h97-0-4" class="d">-                    &quot;g&quot;,
</a><a href="#h97-0-5" id="h97-0-5" class="d">-                ),
</a><a href="#h97-0-6" id="h97-0-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h97-0-11" id="h97-0-11" class="d">-                alias: Some(
</a><a href="#h97-0-12" id="h97-0-12" class="d">-                    &quot;m&quot;,
</a><a href="#h97-0-13" id="h97-0-13" class="d">-                ),
</a><a href="#h97-0-14" id="h97-0-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h97-0-20" id="h97-0-20" class="i">+                        2,
</a>                         Some(
<a href="#h97-0-22" id="h97-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h97-0-23" id="h97-0-23" class="i">+                            (
</a><a href="#h97-0-24" id="h97-0-24" class="i">+                                Some(
</a><a href="#h97-0-25" id="h97-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h97-0-26" id="h97-0-26" class="i">+                                ),
</a><a href="#h97-0-27" id="h97-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h97-0-28" id="h97-0-28" class="i">+                            ),
</a>                         ),
<a href="#h97-0-30" id="h97-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h97-0-33" id="h97-0-33" class="i">+                        0,
</a>                         Some(
<a href="#h97-0-35" id="h97-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h97-0-36" id="h97-0-36" class="i">+                            (
</a><a href="#h97-0-37" id="h97-0-37" class="i">+                                Some(
</a><a href="#h97-0-38" id="h97-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h97-0-39" id="h97-0-39" class="i">+                                ),
</a><a href="#h97-0-40" id="h97-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h97-0-41" id="h97-0-41" class="i">+                            ),
</a>                         ),
<a href="#h97-0-43" id="h97-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h97-1" id="h97-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h97-1-3" id="h97-1-3" class="i">+                0,
</a>                 Some(
<a href="#h97-1-5" id="h97-1-5" class="d">-                    &quot;g&quot;,
</a><a href="#h97-1-6" id="h97-1-6" class="i">+                    (
</a><a href="#h97-1-7" id="h97-1-7" class="i">+                        Some(
</a><a href="#h97-1-8" id="h97-1-8" class="i">+                            &quot;g&quot;,
</a><a href="#h97-1-9" id="h97-1-9" class="i">+                        ),
</a><a href="#h97-1-10" id="h97-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h97-1-11" id="h97-1-11" class="i">+                    ),
</a>                 ),
<a href="#h97-1-13" id="h97-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h97-1-16" id="h97-1-16" class="i">+                2,
</a>                 Some(
<a href="#h97-1-18" id="h97-1-18" class="d">-                    &quot;m&quot;,
</a><a href="#h97-1-19" id="h97-1-19" class="i">+                    (
</a><a href="#h97-1-20" id="h97-1-20" class="i">+                        Some(
</a><a href="#h97-1-21" id="h97-1-21" class="i">+                            &quot;m&quot;,
</a><a href="#h97-1-22" id="h97-1-22" class="i">+                        ),
</a><a href="#h97-1-23" id="h97-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h97-1-24" id="h97-1-24" class="i">+                    ),
</a>                 ),
<a href="#h97-1-26" id="h97-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h97-2" id="h97-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;genres&quot;,
<a href="#h97-2-3" id="h97-2-3" class="d">-                alias: Some(
</a><a href="#h97-2-4" id="h97-2-4" class="d">-                    &quot;g&quot;,
</a><a href="#h97-2-5" id="h97-2-5" class="d">-                ),
</a><a href="#h97-2-6" id="h97-2-6" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;movies&quot;,
<a href="#h97-2-11" id="h97-2-11" class="d">-                alias: Some(
</a><a href="#h97-2-12" id="h97-2-12" class="d">-                    &quot;m&quot;,
</a><a href="#h97-2-13" id="h97-2-13" class="d">-                ),
</a><a href="#h97-2-14" id="h97-2-14" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h97-2-20" id="h97-2-20" class="i">+                        2,
</a>                         Some(
<a href="#h97-2-22" id="h97-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h97-2-23" id="h97-2-23" class="i">+                            (
</a><a href="#h97-2-24" id="h97-2-24" class="i">+                                Some(
</a><a href="#h97-2-25" id="h97-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h97-2-26" id="h97-2-26" class="i">+                                ),
</a><a href="#h97-2-27" id="h97-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h97-2-28" id="h97-2-28" class="i">+                            ),
</a>                         ),
<a href="#h97-2-30" id="h97-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h97-2-33" id="h97-2-33" class="i">+                        0,
</a>                         Some(
<a href="#h97-2-35" id="h97-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h97-2-36" id="h97-2-36" class="i">+                            (
</a><a href="#h97-2-37" id="h97-2-37" class="i">+                                Some(
</a><a href="#h97-2-38" id="h97-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h97-2-39" id="h97-2-39" class="i">+                                ),
</a><a href="#h97-2-40" id="h97-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h97-2-41" id="h97-2-41" class="i">+                            ),
</a>                         ),
<a href="#h97-2-43" id="h97-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h97-3" id="h97-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h97-3-3" id="h97-3-3" class="i">+                0,
</a>                 Some(
<a href="#h97-3-5" id="h97-3-5" class="d">-                    &quot;g&quot;,
</a><a href="#h97-3-6" id="h97-3-6" class="i">+                    (
</a><a href="#h97-3-7" id="h97-3-7" class="i">+                        Some(
</a><a href="#h97-3-8" id="h97-3-8" class="i">+                            &quot;g&quot;,
</a><a href="#h97-3-9" id="h97-3-9" class="i">+                        ),
</a><a href="#h97-3-10" id="h97-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h97-3-11" id="h97-3-11" class="i">+                    ),
</a>                 ),
<a href="#h97-3-13" id="h97-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h97-3-16" id="h97-3-16" class="i">+                2,
</a>                 Some(
<a href="#h97-3-18" id="h97-3-18" class="d">-                    &quot;m&quot;,
</a><a href="#h97-3-19" id="h97-3-19" class="i">+                    (
</a><a href="#h97-3-20" id="h97-3-20" class="i">+                        Some(
</a><a href="#h97-3-21" id="h97-3-21" class="i">+                            &quot;m&quot;,
</a><a href="#h97-3-22" id="h97-3-22" class="i">+                        ),
</a><a href="#h97-3-23" id="h97-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h97-3-24" id="h97-3-24" class="i">+                    ),
</a>                 ),
<a href="#h97-3-26" id="h97-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h98" href="../file/tests/sql/query/join_right_truncate.html">tests/sql/query/join_right_truncate</a> b/<a href="../file/tests/sql/query/join_right_truncate.html">tests/sql/query/join_right_truncate</a></b>
<a href="#h98-0" id="h98-0" class="h">@@ -77,31 +77,37 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h98-0-3" id="h98-0-3" class="d">-                alias: Some(
</a><a href="#h98-0-4" id="h98-0-4" class="d">-                    &quot;m&quot;,
</a><a href="#h98-0-5" id="h98-0-5" class="d">-                ),
</a><a href="#h98-0-6" id="h98-0-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h98-0-11" id="h98-0-11" class="d">-                alias: Some(
</a><a href="#h98-0-12" id="h98-0-12" class="d">-                    &quot;g&quot;,
</a><a href="#h98-0-13" id="h98-0-13" class="d">-                ),
</a><a href="#h98-0-14" id="h98-0-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h98-0-20" id="h98-0-20" class="i">+                        0,
</a>                         Some(
<a href="#h98-0-22" id="h98-0-22" class="d">-                            &quot;m&quot;,
</a><a href="#h98-0-23" id="h98-0-23" class="i">+                            (
</a><a href="#h98-0-24" id="h98-0-24" class="i">+                                Some(
</a><a href="#h98-0-25" id="h98-0-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h98-0-26" id="h98-0-26" class="i">+                                ),
</a><a href="#h98-0-27" id="h98-0-27" class="i">+                                &quot;id&quot;,
</a><a href="#h98-0-28" id="h98-0-28" class="i">+                            ),
</a>                         ),
<a href="#h98-0-30" id="h98-0-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h98-0-33" id="h98-0-33" class="i">+                        7,
</a>                         Some(
<a href="#h98-0-35" id="h98-0-35" class="d">-                            &quot;g&quot;,
</a><a href="#h98-0-36" id="h98-0-36" class="i">+                            (
</a><a href="#h98-0-37" id="h98-0-37" class="i">+                                Some(
</a><a href="#h98-0-38" id="h98-0-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h98-0-39" id="h98-0-39" class="i">+                                ),
</a><a href="#h98-0-40" id="h98-0-40" class="i">+                                &quot;id&quot;,
</a><a href="#h98-0-41" id="h98-0-41" class="i">+                            ),
</a>                         ),
<a href="#h98-0-43" id="h98-0-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h98-1" id="h98-1" class="h">@@ -118,16 +124,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h98-1-3" id="h98-1-3" class="i">+                0,
</a>                 Some(
<a href="#h98-1-5" id="h98-1-5" class="d">-                    &quot;m&quot;,
</a><a href="#h98-1-6" id="h98-1-6" class="i">+                    (
</a><a href="#h98-1-7" id="h98-1-7" class="i">+                        Some(
</a><a href="#h98-1-8" id="h98-1-8" class="i">+                            &quot;m&quot;,
</a><a href="#h98-1-9" id="h98-1-9" class="i">+                        ),
</a><a href="#h98-1-10" id="h98-1-10" class="i">+                        &quot;id&quot;,
</a><a href="#h98-1-11" id="h98-1-11" class="i">+                    ),
</a>                 ),
<a href="#h98-1-13" id="h98-1-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h98-1-16" id="h98-1-16" class="i">+                7,
</a>                 Some(
<a href="#h98-1-18" id="h98-1-18" class="d">-                    &quot;g&quot;,
</a><a href="#h98-1-19" id="h98-1-19" class="i">+                    (
</a><a href="#h98-1-20" id="h98-1-20" class="i">+                        Some(
</a><a href="#h98-1-21" id="h98-1-21" class="i">+                            &quot;g&quot;,
</a><a href="#h98-1-22" id="h98-1-22" class="i">+                        ),
</a><a href="#h98-1-23" id="h98-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h98-1-24" id="h98-1-24" class="i">+                    ),
</a>                 ),
<a href="#h98-1-26" id="h98-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h98-2" id="h98-2" class="h">@@ -138,31 +154,37 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h98-2-3" id="h98-2-3" class="d">-                alias: Some(
</a><a href="#h98-2-4" id="h98-2-4" class="d">-                    &quot;m&quot;,
</a><a href="#h98-2-5" id="h98-2-5" class="d">-                ),
</a><a href="#h98-2-6" id="h98-2-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h98-2-11" id="h98-2-11" class="d">-                alias: Some(
</a><a href="#h98-2-12" id="h98-2-12" class="d">-                    &quot;g&quot;,
</a><a href="#h98-2-13" id="h98-2-13" class="d">-                ),
</a><a href="#h98-2-14" id="h98-2-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
                 Equal(
                     Field(
<a href="#h98-2-20" id="h98-2-20" class="i">+                        0,
</a>                         Some(
<a href="#h98-2-22" id="h98-2-22" class="d">-                            &quot;m&quot;,
</a><a href="#h98-2-23" id="h98-2-23" class="i">+                            (
</a><a href="#h98-2-24" id="h98-2-24" class="i">+                                Some(
</a><a href="#h98-2-25" id="h98-2-25" class="i">+                                    &quot;m&quot;,
</a><a href="#h98-2-26" id="h98-2-26" class="i">+                                ),
</a><a href="#h98-2-27" id="h98-2-27" class="i">+                                &quot;id&quot;,
</a><a href="#h98-2-28" id="h98-2-28" class="i">+                            ),
</a>                         ),
<a href="#h98-2-30" id="h98-2-30" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Field(
<a href="#h98-2-33" id="h98-2-33" class="i">+                        7,
</a>                         Some(
<a href="#h98-2-35" id="h98-2-35" class="d">-                            &quot;g&quot;,
</a><a href="#h98-2-36" id="h98-2-36" class="i">+                            (
</a><a href="#h98-2-37" id="h98-2-37" class="i">+                                Some(
</a><a href="#h98-2-38" id="h98-2-38" class="i">+                                    &quot;g&quot;,
</a><a href="#h98-2-39" id="h98-2-39" class="i">+                                ),
</a><a href="#h98-2-40" id="h98-2-40" class="i">+                                &quot;id&quot;,
</a><a href="#h98-2-41" id="h98-2-41" class="i">+                            ),
</a>                         ),
<a href="#h98-2-43" id="h98-2-43" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             ),
<a href="#h98-3" id="h98-3" class="h">@@ -179,16 +201,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h98-3-3" id="h98-3-3" class="i">+                0,
</a>                 Some(
<a href="#h98-3-5" id="h98-3-5" class="d">-                    &quot;m&quot;,
</a><a href="#h98-3-6" id="h98-3-6" class="i">+                    (
</a><a href="#h98-3-7" id="h98-3-7" class="i">+                        Some(
</a><a href="#h98-3-8" id="h98-3-8" class="i">+                            &quot;m&quot;,
</a><a href="#h98-3-9" id="h98-3-9" class="i">+                        ),
</a><a href="#h98-3-10" id="h98-3-10" class="i">+                        &quot;id&quot;,
</a><a href="#h98-3-11" id="h98-3-11" class="i">+                    ),
</a>                 ),
<a href="#h98-3-13" id="h98-3-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h98-3-16" id="h98-3-16" class="i">+                7,
</a>                 Some(
<a href="#h98-3-18" id="h98-3-18" class="d">-                    &quot;g&quot;,
</a><a href="#h98-3-19" id="h98-3-19" class="i">+                    (
</a><a href="#h98-3-20" id="h98-3-20" class="i">+                        Some(
</a><a href="#h98-3-21" id="h98-3-21" class="i">+                            &quot;g&quot;,
</a><a href="#h98-3-22" id="h98-3-22" class="i">+                        ),
</a><a href="#h98-3-23" id="h98-3-23" class="i">+                        &quot;id&quot;,
</a><a href="#h98-3-24" id="h98-3-24" class="i">+                    ),
</a>                 ),
<a href="#h98-3-26" id="h98-3-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h99" href="../file/tests/sql/query/limit.html">tests/sql/query/limit</a> b/<a href="../file/tests/sql/query/limit.html">tests/sql/query/limit</a></b>
<a href="#h99-0" id="h99-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h99-0-3" id="h99-0-3" class="d">-            alias: None,
</a><a href="#h99-0-4" id="h99-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 3,
<a href="#h99-1" id="h99-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h99-1-3" id="h99-1-3" class="d">-            alias: None,
</a><a href="#h99-1-4" id="h99-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 3,
<b>diff --git a/<a id="h100" href="../file/tests/sql/query/limit_dynamic.html">tests/sql/query/limit_dynamic</a> b/<a href="../file/tests/sql/query/limit_dynamic.html">tests/sql/query/limit_dynamic</a></b>
<a href="#h100-0" id="h100-0" class="h">@@ -37,4 +37,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h100-0-3" id="h100-0-3" class="d">-Plan: Value(&quot;Limit must be constant value&quot;)
</a><a href="#h100-0-4" id="h100-0-4" class="d">-\ No newline at end of file
</a><a href="#h100-0-5" id="h100-0-5" class="i">+Plan: Value(&quot;Expression must be constant, found field released&quot;)
</a><a href="#h100-0-6" id="h100-0-6" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h101" href="../file/tests/sql/query/limit_expr.html">tests/sql/query/limit_expr</a> b/<a href="../file/tests/sql/query/limit_expr.html">tests/sql/query/limit_expr</a></b>
<a href="#h101-0" id="h101-0" class="h">@@ -42,7 +42,7 @@ Plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h101-0-3" id="h101-0-3" class="d">-            alias: None,
</a><a href="#h101-0-4" id="h101-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 3,
<a href="#h101-1" id="h101-1" class="h">@@ -53,7 +53,7 @@ Optimized plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h101-1-3" id="h101-1-3" class="d">-            alias: None,
</a><a href="#h101-1-4" id="h101-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 3,
<b>diff --git a/<a id="h102" href="../file/tests/sql/query/limit_large.html">tests/sql/query/limit_large</a> b/<a href="../file/tests/sql/query/limit_large.html">tests/sql/query/limit_large</a></b>
<a href="#h102-0" id="h102-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h102-0-3" id="h102-0-3" class="d">-            alias: None,
</a><a href="#h102-0-4" id="h102-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 9223372036854775807,
<a href="#h102-1" id="h102-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h102-1-3" id="h102-1-3" class="d">-            alias: None,
</a><a href="#h102-1-4" id="h102-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 9223372036854775807,
<b>diff --git a/<a id="h103" href="../file/tests/sql/query/limit_offset.html">tests/sql/query/limit_offset</a> b/<a href="../file/tests/sql/query/limit_offset.html">tests/sql/query/limit_offset</a></b>
<a href="#h103-0" id="h103-0" class="h">@@ -40,7 +40,7 @@ Plan: Plan(
</a>         source: Offset {
             source: Scan {
                 table: &quot;movies&quot;,
<a href="#h103-0-3" id="h103-0-3" class="d">-                alias: None,
</a><a href="#h103-0-4" id="h103-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             offset: 1,
<a href="#h103-1" id="h103-1" class="h">@@ -54,7 +54,7 @@ Optimized plan: Plan(
</a>         source: Offset {
             source: Scan {
                 table: &quot;movies&quot;,
<a href="#h103-1-3" id="h103-1-3" class="d">-                alias: None,
</a><a href="#h103-1-4" id="h103-1-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             offset: 1,
<b>diff --git a/<a id="h104" href="../file/tests/sql/query/limit_zero.html">tests/sql/query/limit_zero</a> b/<a href="../file/tests/sql/query/limit_zero.html">tests/sql/query/limit_zero</a></b>
<a href="#h104-0" id="h104-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h104-0-3" id="h104-0-3" class="d">-            alias: None,
</a><a href="#h104-0-4" id="h104-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 0,
<a href="#h104-1" id="h104-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Limit {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h104-1-3" id="h104-1-3" class="d">-            alias: None,
</a><a href="#h104-1-4" id="h104-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         limit: 0,
<b>diff --git a/<a id="h105" href="../file/tests/sql/query/offset.html">tests/sql/query/offset</a> b/<a href="../file/tests/sql/query/offset.html">tests/sql/query/offset</a></b>
<a href="#h105-0" id="h105-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h105-0-3" id="h105-0-3" class="d">-            alias: None,
</a><a href="#h105-0-4" id="h105-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 3,
<a href="#h105-1" id="h105-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h105-1-3" id="h105-1-3" class="d">-            alias: None,
</a><a href="#h105-1-4" id="h105-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 3,
<b>diff --git a/<a id="h106" href="../file/tests/sql/query/offset_dynamic.html">tests/sql/query/offset_dynamic</a> b/<a href="../file/tests/sql/query/offset_dynamic.html">tests/sql/query/offset_dynamic</a></b>
<a href="#h106-0" id="h106-0" class="h">@@ -37,4 +37,4 @@ AST: Select {
</a>     ),
 }
 
<a href="#h106-0-3" id="h106-0-3" class="d">-Plan: Value(&quot;Offset must be constant value&quot;)
</a><a href="#h106-0-4" id="h106-0-4" class="d">-\ No newline at end of file
</a><a href="#h106-0-5" id="h106-0-5" class="i">+Plan: Value(&quot;Expression must be constant, found field released&quot;)
</a><a href="#h106-0-6" id="h106-0-6" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h107" href="../file/tests/sql/query/offset_expr.html">tests/sql/query/offset_expr</a> b/<a href="../file/tests/sql/query/offset_expr.html">tests/sql/query/offset_expr</a></b>
<a href="#h107-0" id="h107-0" class="h">@@ -42,7 +42,7 @@ Plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h107-0-3" id="h107-0-3" class="d">-            alias: None,
</a><a href="#h107-0-4" id="h107-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 3,
<a href="#h107-1" id="h107-1" class="h">@@ -53,7 +53,7 @@ Optimized plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h107-1-3" id="h107-1-3" class="d">-            alias: None,
</a><a href="#h107-1-4" id="h107-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 3,
<b>diff --git a/<a id="h108" href="../file/tests/sql/query/offset_large.html">tests/sql/query/offset_large</a> b/<a href="../file/tests/sql/query/offset_large.html">tests/sql/query/offset_large</a></b>
<a href="#h108-0" id="h108-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h108-0-3" id="h108-0-3" class="d">-            alias: None,
</a><a href="#h108-0-4" id="h108-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 9223372036854775807,
<a href="#h108-1" id="h108-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h108-1-3" id="h108-1-3" class="d">-            alias: None,
</a><a href="#h108-1-4" id="h108-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 9223372036854775807,
<b>diff --git a/<a id="h109" href="../file/tests/sql/query/offset_zero.html">tests/sql/query/offset_zero</a> b/<a href="../file/tests/sql/query/offset_zero.html">tests/sql/query/offset_zero</a></b>
<a href="#h109-0" id="h109-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h109-0-3" id="h109-0-3" class="d">-            alias: None,
</a><a href="#h109-0-4" id="h109-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 0,
<a href="#h109-1" id="h109-1" class="h">@@ -44,7 +44,7 @@ Optimized plan: Plan(
</a>     Offset {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h109-1-3" id="h109-1-3" class="d">-            alias: None,
</a><a href="#h109-1-4" id="h109-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         offset: 0,
<b>diff --git a/<a id="h110" href="../file/tests/sql/query/order.html">tests/sql/query/order</a> b/<a href="../file/tests/sql/query/order.html">tests/sql/query/order</a></b>
<a href="#h110-0" id="h110-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h110-0-3" id="h110-0-3" class="d">-            alias: None,
</a><a href="#h110-0-4" id="h110-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h110-0-10" id="h110-0-10" class="d">-                    None,
</a><a href="#h110-0-11" id="h110-0-11" class="d">-                    &quot;released&quot;,
</a><a href="#h110-0-12" id="h110-0-12" class="i">+                    4,
</a><a href="#h110-0-13" id="h110-0-13" class="i">+                    Some(
</a><a href="#h110-0-14" id="h110-0-14" class="i">+                        (
</a><a href="#h110-0-15" id="h110-0-15" class="i">+                            None,
</a><a href="#h110-0-16" id="h110-0-16" class="i">+                            &quot;released&quot;,
</a><a href="#h110-0-17" id="h110-0-17" class="i">+                        ),
</a><a href="#h110-0-18" id="h110-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h110-1" id="h110-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h110-1-3" id="h110-1-3" class="d">-            alias: None,
</a><a href="#h110-1-4" id="h110-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h110-1-10" id="h110-1-10" class="d">-                    None,
</a><a href="#h110-1-11" id="h110-1-11" class="d">-                    &quot;released&quot;,
</a><a href="#h110-1-12" id="h110-1-12" class="i">+                    4,
</a><a href="#h110-1-13" id="h110-1-13" class="i">+                    Some(
</a><a href="#h110-1-14" id="h110-1-14" class="i">+                        (
</a><a href="#h110-1-15" id="h110-1-15" class="i">+                            None,
</a><a href="#h110-1-16" id="h110-1-16" class="i">+                            &quot;released&quot;,
</a><a href="#h110-1-17" id="h110-1-17" class="i">+                        ),
</a><a href="#h110-1-18" id="h110-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h111" href="../file/tests/sql/query/order_asc.html">tests/sql/query/order_asc</a> b/<a href="../file/tests/sql/query/order_asc.html">tests/sql/query/order_asc</a></b>
<a href="#h111-0" id="h111-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h111-0-3" id="h111-0-3" class="d">-            alias: None,
</a><a href="#h111-0-4" id="h111-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h111-0-10" id="h111-0-10" class="d">-                    None,
</a><a href="#h111-0-11" id="h111-0-11" class="d">-                    &quot;released&quot;,
</a><a href="#h111-0-12" id="h111-0-12" class="i">+                    4,
</a><a href="#h111-0-13" id="h111-0-13" class="i">+                    Some(
</a><a href="#h111-0-14" id="h111-0-14" class="i">+                        (
</a><a href="#h111-0-15" id="h111-0-15" class="i">+                            None,
</a><a href="#h111-0-16" id="h111-0-16" class="i">+                            &quot;released&quot;,
</a><a href="#h111-0-17" id="h111-0-17" class="i">+                        ),
</a><a href="#h111-0-18" id="h111-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h111-1" id="h111-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h111-1-3" id="h111-1-3" class="d">-            alias: None,
</a><a href="#h111-1-4" id="h111-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h111-1-10" id="h111-1-10" class="d">-                    None,
</a><a href="#h111-1-11" id="h111-1-11" class="d">-                    &quot;released&quot;,
</a><a href="#h111-1-12" id="h111-1-12" class="i">+                    4,
</a><a href="#h111-1-13" id="h111-1-13" class="i">+                    Some(
</a><a href="#h111-1-14" id="h111-1-14" class="i">+                        (
</a><a href="#h111-1-15" id="h111-1-15" class="i">+                            None,
</a><a href="#h111-1-16" id="h111-1-16" class="i">+                            &quot;released&quot;,
</a><a href="#h111-1-17" id="h111-1-17" class="i">+                        ),
</a><a href="#h111-1-18" id="h111-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h112" href="../file/tests/sql/query/order_asc_lowercase.html">tests/sql/query/order_asc_lowercase</a> b/<a href="../file/tests/sql/query/order_asc_lowercase.html">tests/sql/query/order_asc_lowercase</a></b>
<a href="#h112-0" id="h112-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h112-0-3" id="h112-0-3" class="d">-            alias: None,
</a><a href="#h112-0-4" id="h112-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h112-0-10" id="h112-0-10" class="d">-                    None,
</a><a href="#h112-0-11" id="h112-0-11" class="d">-                    &quot;released&quot;,
</a><a href="#h112-0-12" id="h112-0-12" class="i">+                    4,
</a><a href="#h112-0-13" id="h112-0-13" class="i">+                    Some(
</a><a href="#h112-0-14" id="h112-0-14" class="i">+                        (
</a><a href="#h112-0-15" id="h112-0-15" class="i">+                            None,
</a><a href="#h112-0-16" id="h112-0-16" class="i">+                            &quot;released&quot;,
</a><a href="#h112-0-17" id="h112-0-17" class="i">+                        ),
</a><a href="#h112-0-18" id="h112-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h112-1" id="h112-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h112-1-3" id="h112-1-3" class="d">-            alias: None,
</a><a href="#h112-1-4" id="h112-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h112-1-10" id="h112-1-10" class="d">-                    None,
</a><a href="#h112-1-11" id="h112-1-11" class="d">-                    &quot;released&quot;,
</a><a href="#h112-1-12" id="h112-1-12" class="i">+                    4,
</a><a href="#h112-1-13" id="h112-1-13" class="i">+                    Some(
</a><a href="#h112-1-14" id="h112-1-14" class="i">+                        (
</a><a href="#h112-1-15" id="h112-1-15" class="i">+                            None,
</a><a href="#h112-1-16" id="h112-1-16" class="i">+                            &quot;released&quot;,
</a><a href="#h112-1-17" id="h112-1-17" class="i">+                        ),
</a><a href="#h112-1-18" id="h112-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h113" href="../file/tests/sql/query/order_boolean_asc.html">tests/sql/query/order_boolean_asc</a> b/<a href="../file/tests/sql/query/order_boolean_asc.html">tests/sql/query/order_boolean_asc</a></b>
<a href="#h113-0" id="h113-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;booleans&quot;,
<a href="#h113-0-3" id="h113-0-3" class="d">-            alias: None,
</a><a href="#h113-0-4" id="h113-0-4" class="i">+            label: &quot;booleans&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h113-0-10" id="h113-0-10" class="d">-                    None,
</a><a href="#h113-0-11" id="h113-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h113-0-12" id="h113-0-12" class="i">+                    1,
</a><a href="#h113-0-13" id="h113-0-13" class="i">+                    Some(
</a><a href="#h113-0-14" id="h113-0-14" class="i">+                        (
</a><a href="#h113-0-15" id="h113-0-15" class="i">+                            None,
</a><a href="#h113-0-16" id="h113-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h113-0-17" id="h113-0-17" class="i">+                        ),
</a><a href="#h113-0-18" id="h113-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h113-1" id="h113-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;booleans&quot;,
<a href="#h113-1-3" id="h113-1-3" class="d">-            alias: None,
</a><a href="#h113-1-4" id="h113-1-4" class="i">+            label: &quot;booleans&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h113-1-10" id="h113-1-10" class="d">-                    None,
</a><a href="#h113-1-11" id="h113-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h113-1-12" id="h113-1-12" class="i">+                    1,
</a><a href="#h113-1-13" id="h113-1-13" class="i">+                    Some(
</a><a href="#h113-1-14" id="h113-1-14" class="i">+                        (
</a><a href="#h113-1-15" id="h113-1-15" class="i">+                            None,
</a><a href="#h113-1-16" id="h113-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h113-1-17" id="h113-1-17" class="i">+                        ),
</a><a href="#h113-1-18" id="h113-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h114" href="../file/tests/sql/query/order_boolean_desc.html">tests/sql/query/order_boolean_desc</a> b/<a href="../file/tests/sql/query/order_boolean_desc.html">tests/sql/query/order_boolean_desc</a></b>
<a href="#h114-0" id="h114-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;booleans&quot;,
<a href="#h114-0-3" id="h114-0-3" class="d">-            alias: None,
</a><a href="#h114-0-4" id="h114-0-4" class="i">+            label: &quot;booleans&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h114-0-10" id="h114-0-10" class="d">-                    None,
</a><a href="#h114-0-11" id="h114-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h114-0-12" id="h114-0-12" class="i">+                    1,
</a><a href="#h114-0-13" id="h114-0-13" class="i">+                    Some(
</a><a href="#h114-0-14" id="h114-0-14" class="i">+                        (
</a><a href="#h114-0-15" id="h114-0-15" class="i">+                            None,
</a><a href="#h114-0-16" id="h114-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h114-0-17" id="h114-0-17" class="i">+                        ),
</a><a href="#h114-0-18" id="h114-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h114-1" id="h114-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;booleans&quot;,
<a href="#h114-1-3" id="h114-1-3" class="d">-            alias: None,
</a><a href="#h114-1-4" id="h114-1-4" class="i">+            label: &quot;booleans&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h114-1-10" id="h114-1-10" class="d">-                    None,
</a><a href="#h114-1-11" id="h114-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h114-1-12" id="h114-1-12" class="i">+                    1,
</a><a href="#h114-1-13" id="h114-1-13" class="i">+                    Some(
</a><a href="#h114-1-14" id="h114-1-14" class="i">+                        (
</a><a href="#h114-1-15" id="h114-1-15" class="i">+                            None,
</a><a href="#h114-1-16" id="h114-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h114-1-17" id="h114-1-17" class="i">+                        ),
</a><a href="#h114-1-18" id="h114-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h115" href="../file/tests/sql/query/order_desc.html">tests/sql/query/order_desc</a> b/<a href="../file/tests/sql/query/order_desc.html">tests/sql/query/order_desc</a></b>
<a href="#h115-0" id="h115-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h115-0-3" id="h115-0-3" class="d">-            alias: None,
</a><a href="#h115-0-4" id="h115-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h115-0-10" id="h115-0-10" class="d">-                    None,
</a><a href="#h115-0-11" id="h115-0-11" class="d">-                    &quot;released&quot;,
</a><a href="#h115-0-12" id="h115-0-12" class="i">+                    4,
</a><a href="#h115-0-13" id="h115-0-13" class="i">+                    Some(
</a><a href="#h115-0-14" id="h115-0-14" class="i">+                        (
</a><a href="#h115-0-15" id="h115-0-15" class="i">+                            None,
</a><a href="#h115-0-16" id="h115-0-16" class="i">+                            &quot;released&quot;,
</a><a href="#h115-0-17" id="h115-0-17" class="i">+                        ),
</a><a href="#h115-0-18" id="h115-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h115-1" id="h115-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h115-1-3" id="h115-1-3" class="d">-            alias: None,
</a><a href="#h115-1-4" id="h115-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h115-1-10" id="h115-1-10" class="d">-                    None,
</a><a href="#h115-1-11" id="h115-1-11" class="d">-                    &quot;released&quot;,
</a><a href="#h115-1-12" id="h115-1-12" class="i">+                    4,
</a><a href="#h115-1-13" id="h115-1-13" class="i">+                    Some(
</a><a href="#h115-1-14" id="h115-1-14" class="i">+                        (
</a><a href="#h115-1-15" id="h115-1-15" class="i">+                            None,
</a><a href="#h115-1-16" id="h115-1-16" class="i">+                            &quot;released&quot;,
</a><a href="#h115-1-17" id="h115-1-17" class="i">+                        ),
</a><a href="#h115-1-18" id="h115-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h116" href="../file/tests/sql/query/order_desc_lowercase.html">tests/sql/query/order_desc_lowercase</a> b/<a href="../file/tests/sql/query/order_desc_lowercase.html">tests/sql/query/order_desc_lowercase</a></b>
<a href="#h116-0" id="h116-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h116-0-3" id="h116-0-3" class="d">-            alias: None,
</a><a href="#h116-0-4" id="h116-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h116-0-10" id="h116-0-10" class="d">-                    None,
</a><a href="#h116-0-11" id="h116-0-11" class="d">-                    &quot;released&quot;,
</a><a href="#h116-0-12" id="h116-0-12" class="i">+                    4,
</a><a href="#h116-0-13" id="h116-0-13" class="i">+                    Some(
</a><a href="#h116-0-14" id="h116-0-14" class="i">+                        (
</a><a href="#h116-0-15" id="h116-0-15" class="i">+                            None,
</a><a href="#h116-0-16" id="h116-0-16" class="i">+                            &quot;released&quot;,
</a><a href="#h116-0-17" id="h116-0-17" class="i">+                        ),
</a><a href="#h116-0-18" id="h116-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h116-1" id="h116-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h116-1-3" id="h116-1-3" class="d">-            alias: None,
</a><a href="#h116-1-4" id="h116-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h116-1-10" id="h116-1-10" class="d">-                    None,
</a><a href="#h116-1-11" id="h116-1-11" class="d">-                    &quot;released&quot;,
</a><a href="#h116-1-12" id="h116-1-12" class="i">+                    4,
</a><a href="#h116-1-13" id="h116-1-13" class="i">+                    Some(
</a><a href="#h116-1-14" id="h116-1-14" class="i">+                        (
</a><a href="#h116-1-15" id="h116-1-15" class="i">+                            None,
</a><a href="#h116-1-16" id="h116-1-16" class="i">+                            &quot;released&quot;,
</a><a href="#h116-1-17" id="h116-1-17" class="i">+                        ),
</a><a href="#h116-1-18" id="h116-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h117" href="../file/tests/sql/query/order_expr.html">tests/sql/query/order_expr</a> b/<a href="../file/tests/sql/query/order_expr.html">tests/sql/query/order_expr</a></b>
<a href="#h117-0" id="h117-0" class="h">@@ -78,7 +78,7 @@ Plan: Plan(
</a>         source: Projection {
             source: Scan {
                 table: &quot;movies&quot;,
<a href="#h117-0-3" id="h117-0-3" class="d">-                alias: None,
</a><a href="#h117-0-4" id="h117-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             labels: [
<a href="#h117-1" id="h117-1" class="h">@@ -91,21 +91,41 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h117-1-3" id="h117-1-3" class="d">-                    None,
</a><a href="#h117-1-4" id="h117-1-4" class="d">-                    &quot;id&quot;,
</a><a href="#h117-1-5" id="h117-1-5" class="i">+                    0,
</a><a href="#h117-1-6" id="h117-1-6" class="i">+                    Some(
</a><a href="#h117-1-7" id="h117-1-7" class="i">+                        (
</a><a href="#h117-1-8" id="h117-1-8" class="i">+                            None,
</a><a href="#h117-1-9" id="h117-1-9" class="i">+                            &quot;id&quot;,
</a><a href="#h117-1-10" id="h117-1-10" class="i">+                        ),
</a><a href="#h117-1-11" id="h117-1-11" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h117-1-14" id="h117-1-14" class="d">-                    None,
</a><a href="#h117-1-15" id="h117-1-15" class="d">-                    &quot;title&quot;,
</a><a href="#h117-1-16" id="h117-1-16" class="i">+                    1,
</a><a href="#h117-1-17" id="h117-1-17" class="i">+                    Some(
</a><a href="#h117-1-18" id="h117-1-18" class="i">+                        (
</a><a href="#h117-1-19" id="h117-1-19" class="i">+                            None,
</a><a href="#h117-1-20" id="h117-1-20" class="i">+                            &quot;title&quot;,
</a><a href="#h117-1-21" id="h117-1-21" class="i">+                        ),
</a><a href="#h117-1-22" id="h117-1-22" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h117-1-25" id="h117-1-25" class="d">-                    None,
</a><a href="#h117-1-26" id="h117-1-26" class="d">-                    &quot;released&quot;,
</a><a href="#h117-1-27" id="h117-1-27" class="i">+                    4,
</a><a href="#h117-1-28" id="h117-1-28" class="i">+                    Some(
</a><a href="#h117-1-29" id="h117-1-29" class="i">+                        (
</a><a href="#h117-1-30" id="h117-1-30" class="i">+                            None,
</a><a href="#h117-1-31" id="h117-1-31" class="i">+                            &quot;released&quot;,
</a><a href="#h117-1-32" id="h117-1-32" class="i">+                        ),
</a><a href="#h117-1-33" id="h117-1-33" class="i">+                    ),
</a>                 ),
                 Modulo(
                     Field(
<a href="#h117-1-37" id="h117-1-37" class="d">-                        None,
</a><a href="#h117-1-38" id="h117-1-38" class="d">-                        &quot;released&quot;,
</a><a href="#h117-1-39" id="h117-1-39" class="i">+                        4,
</a><a href="#h117-1-40" id="h117-1-40" class="i">+                        Some(
</a><a href="#h117-1-41" id="h117-1-41" class="i">+                            (
</a><a href="#h117-1-42" id="h117-1-42" class="i">+                                None,
</a><a href="#h117-1-43" id="h117-1-43" class="i">+                                &quot;released&quot;,
</a><a href="#h117-1-44" id="h117-1-44" class="i">+                            ),
</a><a href="#h117-1-45" id="h117-1-45" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h117-2" id="h117-2" class="h">@@ -119,8 +139,13 @@ Plan: Plan(
</a>             (
                 Modulo(
                     Field(
<a href="#h117-2-3" id="h117-2-3" class="d">-                        None,
</a><a href="#h117-2-4" id="h117-2-4" class="d">-                        &quot;released&quot;,
</a><a href="#h117-2-5" id="h117-2-5" class="i">+                        2,
</a><a href="#h117-2-6" id="h117-2-6" class="i">+                        Some(
</a><a href="#h117-2-7" id="h117-2-7" class="i">+                            (
</a><a href="#h117-2-8" id="h117-2-8" class="i">+                                None,
</a><a href="#h117-2-9" id="h117-2-9" class="i">+                                &quot;released&quot;,
</a><a href="#h117-2-10" id="h117-2-10" class="i">+                            ),
</a><a href="#h117-2-11" id="h117-2-11" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h117-3" id="h117-3" class="h">@@ -139,7 +164,7 @@ Optimized plan: Plan(
</a>         source: Projection {
             source: Scan {
                 table: &quot;movies&quot;,
<a href="#h117-3-3" id="h117-3-3" class="d">-                alias: None,
</a><a href="#h117-3-4" id="h117-3-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             labels: [
<a href="#h117-4" id="h117-4" class="h">@@ -152,21 +177,41 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h117-4-3" id="h117-4-3" class="d">-                    None,
</a><a href="#h117-4-4" id="h117-4-4" class="d">-                    &quot;id&quot;,
</a><a href="#h117-4-5" id="h117-4-5" class="i">+                    0,
</a><a href="#h117-4-6" id="h117-4-6" class="i">+                    Some(
</a><a href="#h117-4-7" id="h117-4-7" class="i">+                        (
</a><a href="#h117-4-8" id="h117-4-8" class="i">+                            None,
</a><a href="#h117-4-9" id="h117-4-9" class="i">+                            &quot;id&quot;,
</a><a href="#h117-4-10" id="h117-4-10" class="i">+                        ),
</a><a href="#h117-4-11" id="h117-4-11" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h117-4-14" id="h117-4-14" class="d">-                    None,
</a><a href="#h117-4-15" id="h117-4-15" class="d">-                    &quot;title&quot;,
</a><a href="#h117-4-16" id="h117-4-16" class="i">+                    1,
</a><a href="#h117-4-17" id="h117-4-17" class="i">+                    Some(
</a><a href="#h117-4-18" id="h117-4-18" class="i">+                        (
</a><a href="#h117-4-19" id="h117-4-19" class="i">+                            None,
</a><a href="#h117-4-20" id="h117-4-20" class="i">+                            &quot;title&quot;,
</a><a href="#h117-4-21" id="h117-4-21" class="i">+                        ),
</a><a href="#h117-4-22" id="h117-4-22" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h117-4-25" id="h117-4-25" class="d">-                    None,
</a><a href="#h117-4-26" id="h117-4-26" class="d">-                    &quot;released&quot;,
</a><a href="#h117-4-27" id="h117-4-27" class="i">+                    4,
</a><a href="#h117-4-28" id="h117-4-28" class="i">+                    Some(
</a><a href="#h117-4-29" id="h117-4-29" class="i">+                        (
</a><a href="#h117-4-30" id="h117-4-30" class="i">+                            None,
</a><a href="#h117-4-31" id="h117-4-31" class="i">+                            &quot;released&quot;,
</a><a href="#h117-4-32" id="h117-4-32" class="i">+                        ),
</a><a href="#h117-4-33" id="h117-4-33" class="i">+                    ),
</a>                 ),
                 Modulo(
                     Field(
<a href="#h117-4-37" id="h117-4-37" class="d">-                        None,
</a><a href="#h117-4-38" id="h117-4-38" class="d">-                        &quot;released&quot;,
</a><a href="#h117-4-39" id="h117-4-39" class="i">+                        4,
</a><a href="#h117-4-40" id="h117-4-40" class="i">+                        Some(
</a><a href="#h117-4-41" id="h117-4-41" class="i">+                            (
</a><a href="#h117-4-42" id="h117-4-42" class="i">+                                None,
</a><a href="#h117-4-43" id="h117-4-43" class="i">+                                &quot;released&quot;,
</a><a href="#h117-4-44" id="h117-4-44" class="i">+                            ),
</a><a href="#h117-4-45" id="h117-4-45" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h117-5" id="h117-5" class="h">@@ -180,8 +225,13 @@ Optimized plan: Plan(
</a>             (
                 Modulo(
                     Field(
<a href="#h117-5-3" id="h117-5-3" class="d">-                        None,
</a><a href="#h117-5-4" id="h117-5-4" class="d">-                        &quot;released&quot;,
</a><a href="#h117-5-5" id="h117-5-5" class="i">+                        2,
</a><a href="#h117-5-6" id="h117-5-6" class="i">+                        Some(
</a><a href="#h117-5-7" id="h117-5-7" class="i">+                            (
</a><a href="#h117-5-8" id="h117-5-8" class="i">+                                None,
</a><a href="#h117-5-9" id="h117-5-9" class="i">+                                &quot;released&quot;,
</a><a href="#h117-5-10" id="h117-5-10" class="i">+                            ),
</a><a href="#h117-5-11" id="h117-5-11" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<b>diff --git a/<a id="h118" href="../file/tests/sql/query/order_field_aliased.html">tests/sql/query/order_field_aliased</a> b/<a href="../file/tests/sql/query/order_field_aliased.html">tests/sql/query/order_field_aliased</a></b>
<a href="#h118-0" id="h118-0" class="h">@@ -91,12 +91,12 @@ Plan: Plan(
</a>                 source: NestedLoopJoin {
                     outer: Scan {
                         table: &quot;movies&quot;,
<a href="#h118-0-3" id="h118-0-3" class="d">-                        alias: None,
</a><a href="#h118-0-4" id="h118-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     inner: Scan {
                         table: &quot;genres&quot;,
<a href="#h118-0-9" id="h118-0-9" class="d">-                        alias: None,
</a><a href="#h118-0-10" id="h118-0-10" class="i">+                        label: &quot;genres&quot;,
</a>                         filter: None,
                     },
                     predicate: None,
<a href="#h118-1" id="h118-1" class="h">@@ -105,16 +105,26 @@ Plan: Plan(
</a>                 },
                 predicate: Equal(
                     Field(
<a href="#h118-1-3" id="h118-1-3" class="i">+                        3,
</a>                         Some(
<a href="#h118-1-5" id="h118-1-5" class="d">-                            &quot;movies&quot;,
</a><a href="#h118-1-6" id="h118-1-6" class="i">+                            (
</a><a href="#h118-1-7" id="h118-1-7" class="i">+                                Some(
</a><a href="#h118-1-8" id="h118-1-8" class="i">+                                    &quot;movies&quot;,
</a><a href="#h118-1-9" id="h118-1-9" class="i">+                                ),
</a><a href="#h118-1-10" id="h118-1-10" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h118-1-11" id="h118-1-11" class="i">+                            ),
</a>                         ),
<a href="#h118-1-13" id="h118-1-13" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h118-1-16" id="h118-1-16" class="i">+                        7,
</a>                         Some(
<a href="#h118-1-18" id="h118-1-18" class="d">-                            &quot;genres&quot;,
</a><a href="#h118-1-19" id="h118-1-19" class="i">+                            (
</a><a href="#h118-1-20" id="h118-1-20" class="i">+                                Some(
</a><a href="#h118-1-21" id="h118-1-21" class="i">+                                    &quot;genres&quot;,
</a><a href="#h118-1-22" id="h118-1-22" class="i">+                                ),
</a><a href="#h118-1-23" id="h118-1-23" class="i">+                                &quot;id&quot;,
</a><a href="#h118-1-24" id="h118-1-24" class="i">+                            ),
</a>                         ),
<a href="#h118-1-26" id="h118-1-26" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             },
<a href="#h118-2" id="h118-2" class="h">@@ -127,35 +137,60 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h118-2-3" id="h118-2-3" class="i">+                    0,
</a>                     Some(
<a href="#h118-2-5" id="h118-2-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h118-2-6" id="h118-2-6" class="i">+                        (
</a><a href="#h118-2-7" id="h118-2-7" class="i">+                            Some(
</a><a href="#h118-2-8" id="h118-2-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h118-2-9" id="h118-2-9" class="i">+                            ),
</a><a href="#h118-2-10" id="h118-2-10" class="i">+                            &quot;id&quot;,
</a><a href="#h118-2-11" id="h118-2-11" class="i">+                        ),
</a>                     ),
<a href="#h118-2-13" id="h118-2-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Field(
<a href="#h118-2-16" id="h118-2-16" class="d">-                    None,
</a><a href="#h118-2-17" id="h118-2-17" class="d">-                    &quot;title&quot;,
</a><a href="#h118-2-18" id="h118-2-18" class="i">+                    1,
</a><a href="#h118-2-19" id="h118-2-19" class="i">+                    Some(
</a><a href="#h118-2-20" id="h118-2-20" class="i">+                        (
</a><a href="#h118-2-21" id="h118-2-21" class="i">+                            None,
</a><a href="#h118-2-22" id="h118-2-22" class="i">+                            &quot;title&quot;,
</a><a href="#h118-2-23" id="h118-2-23" class="i">+                        ),
</a><a href="#h118-2-24" id="h118-2-24" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h118-2-27" id="h118-2-27" class="i">+                    8,
</a>                     Some(
<a href="#h118-2-29" id="h118-2-29" class="d">-                        &quot;genres&quot;,
</a><a href="#h118-2-30" id="h118-2-30" class="i">+                        (
</a><a href="#h118-2-31" id="h118-2-31" class="i">+                            Some(
</a><a href="#h118-2-32" id="h118-2-32" class="i">+                                &quot;genres&quot;,
</a><a href="#h118-2-33" id="h118-2-33" class="i">+                            ),
</a><a href="#h118-2-34" id="h118-2-34" class="i">+                            &quot;name&quot;,
</a><a href="#h118-2-35" id="h118-2-35" class="i">+                        ),
</a>                     ),
<a href="#h118-2-37" id="h118-2-37" class="d">-                    &quot;name&quot;,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h118-2-44" id="h118-2-44" class="d">-                    None,
</a><a href="#h118-2-45" id="h118-2-45" class="d">-                    &quot;genre&quot;,
</a><a href="#h118-2-46" id="h118-2-46" class="i">+                    2,
</a><a href="#h118-2-47" id="h118-2-47" class="i">+                    Some(
</a><a href="#h118-2-48" id="h118-2-48" class="i">+                        (
</a><a href="#h118-2-49" id="h118-2-49" class="i">+                            None,
</a><a href="#h118-2-50" id="h118-2-50" class="i">+                            &quot;genre&quot;,
</a><a href="#h118-2-51" id="h118-2-51" class="i">+                        ),
</a><a href="#h118-2-52" id="h118-2-52" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h118-2-58" id="h118-2-58" class="d">-                    None,
</a><a href="#h118-2-59" id="h118-2-59" class="d">-                    &quot;title&quot;,
</a><a href="#h118-2-60" id="h118-2-60" class="i">+                    1,
</a><a href="#h118-2-61" id="h118-2-61" class="i">+                    Some(
</a><a href="#h118-2-62" id="h118-2-62" class="i">+                        (
</a><a href="#h118-2-63" id="h118-2-63" class="i">+                            None,
</a><a href="#h118-2-64" id="h118-2-64" class="i">+                            &quot;title&quot;,
</a><a href="#h118-2-65" id="h118-2-65" class="i">+                        ),
</a><a href="#h118-2-66" id="h118-2-66" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h118-3" id="h118-3" class="h">@@ -169,27 +204,37 @@ Optimized plan: Plan(
</a>             source: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h118-3-3" id="h118-3-3" class="d">-                    alias: None,
</a><a href="#h118-3-4" id="h118-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h118-3-9" id="h118-3-9" class="d">-                    alias: None,
</a><a href="#h118-3-10" id="h118-3-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: Some(
                     Equal(
                         Field(
<a href="#h118-3-16" id="h118-3-16" class="i">+                            3,
</a>                             Some(
<a href="#h118-3-18" id="h118-3-18" class="d">-                                &quot;movies&quot;,
</a><a href="#h118-3-19" id="h118-3-19" class="i">+                                (
</a><a href="#h118-3-20" id="h118-3-20" class="i">+                                    Some(
</a><a href="#h118-3-21" id="h118-3-21" class="i">+                                        &quot;movies&quot;,
</a><a href="#h118-3-22" id="h118-3-22" class="i">+                                    ),
</a><a href="#h118-3-23" id="h118-3-23" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h118-3-24" id="h118-3-24" class="i">+                                ),
</a>                             ),
<a href="#h118-3-26" id="h118-3-26" class="d">-                            &quot;genre_id&quot;,
</a>                         ),
                         Field(
<a href="#h118-3-29" id="h118-3-29" class="i">+                            7,
</a>                             Some(
<a href="#h118-3-31" id="h118-3-31" class="d">-                                &quot;genres&quot;,
</a><a href="#h118-3-32" id="h118-3-32" class="i">+                                (
</a><a href="#h118-3-33" id="h118-3-33" class="i">+                                    Some(
</a><a href="#h118-3-34" id="h118-3-34" class="i">+                                        &quot;genres&quot;,
</a><a href="#h118-3-35" id="h118-3-35" class="i">+                                    ),
</a><a href="#h118-3-36" id="h118-3-36" class="i">+                                    &quot;id&quot;,
</a><a href="#h118-3-37" id="h118-3-37" class="i">+                                ),
</a>                             ),
<a href="#h118-3-39" id="h118-3-39" class="d">-                            &quot;id&quot;,
</a>                         ),
                     ),
                 ),
<a href="#h118-4" id="h118-4" class="h">@@ -205,35 +250,60 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h118-4-3" id="h118-4-3" class="i">+                    0,
</a>                     Some(
<a href="#h118-4-5" id="h118-4-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h118-4-6" id="h118-4-6" class="i">+                        (
</a><a href="#h118-4-7" id="h118-4-7" class="i">+                            Some(
</a><a href="#h118-4-8" id="h118-4-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h118-4-9" id="h118-4-9" class="i">+                            ),
</a><a href="#h118-4-10" id="h118-4-10" class="i">+                            &quot;id&quot;,
</a><a href="#h118-4-11" id="h118-4-11" class="i">+                        ),
</a>                     ),
<a href="#h118-4-13" id="h118-4-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Field(
<a href="#h118-4-16" id="h118-4-16" class="d">-                    None,
</a><a href="#h118-4-17" id="h118-4-17" class="d">-                    &quot;title&quot;,
</a><a href="#h118-4-18" id="h118-4-18" class="i">+                    1,
</a><a href="#h118-4-19" id="h118-4-19" class="i">+                    Some(
</a><a href="#h118-4-20" id="h118-4-20" class="i">+                        (
</a><a href="#h118-4-21" id="h118-4-21" class="i">+                            None,
</a><a href="#h118-4-22" id="h118-4-22" class="i">+                            &quot;title&quot;,
</a><a href="#h118-4-23" id="h118-4-23" class="i">+                        ),
</a><a href="#h118-4-24" id="h118-4-24" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h118-4-27" id="h118-4-27" class="i">+                    8,
</a>                     Some(
<a href="#h118-4-29" id="h118-4-29" class="d">-                        &quot;genres&quot;,
</a><a href="#h118-4-30" id="h118-4-30" class="i">+                        (
</a><a href="#h118-4-31" id="h118-4-31" class="i">+                            Some(
</a><a href="#h118-4-32" id="h118-4-32" class="i">+                                &quot;genres&quot;,
</a><a href="#h118-4-33" id="h118-4-33" class="i">+                            ),
</a><a href="#h118-4-34" id="h118-4-34" class="i">+                            &quot;name&quot;,
</a><a href="#h118-4-35" id="h118-4-35" class="i">+                        ),
</a>                     ),
<a href="#h118-4-37" id="h118-4-37" class="d">-                    &quot;name&quot;,
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h118-4-44" id="h118-4-44" class="d">-                    None,
</a><a href="#h118-4-45" id="h118-4-45" class="d">-                    &quot;genre&quot;,
</a><a href="#h118-4-46" id="h118-4-46" class="i">+                    2,
</a><a href="#h118-4-47" id="h118-4-47" class="i">+                    Some(
</a><a href="#h118-4-48" id="h118-4-48" class="i">+                        (
</a><a href="#h118-4-49" id="h118-4-49" class="i">+                            None,
</a><a href="#h118-4-50" id="h118-4-50" class="i">+                            &quot;genre&quot;,
</a><a href="#h118-4-51" id="h118-4-51" class="i">+                        ),
</a><a href="#h118-4-52" id="h118-4-52" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h118-4-58" id="h118-4-58" class="d">-                    None,
</a><a href="#h118-4-59" id="h118-4-59" class="d">-                    &quot;title&quot;,
</a><a href="#h118-4-60" id="h118-4-60" class="i">+                    1,
</a><a href="#h118-4-61" id="h118-4-61" class="i">+                    Some(
</a><a href="#h118-4-62" id="h118-4-62" class="i">+                        (
</a><a href="#h118-4-63" id="h118-4-63" class="i">+                            None,
</a><a href="#h118-4-64" id="h118-4-64" class="i">+                            &quot;title&quot;,
</a><a href="#h118-4-65" id="h118-4-65" class="i">+                        ),
</a><a href="#h118-4-66" id="h118-4-66" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h119" href="../file/tests/sql/query/order_field_ambiguous.html">tests/sql/query/order_field_ambiguous</a> b/<a href="../file/tests/sql/query/order_field_ambiguous.html">tests/sql/query/order_field_ambiguous</a></b>
<a href="#h119-0" id="h119-0" class="h">@@ -54,95 +54,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h119-0-3" id="h119-0-3" class="d">-Plan: Plan(
</a><a href="#h119-0-4" id="h119-0-4" class="d">-    Order {
</a><a href="#h119-0-5" id="h119-0-5" class="d">-        source: Filter {
</a><a href="#h119-0-6" id="h119-0-6" class="d">-            source: NestedLoopJoin {
</a><a href="#h119-0-7" id="h119-0-7" class="d">-                outer: Scan {
</a><a href="#h119-0-8" id="h119-0-8" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h119-0-9" id="h119-0-9" class="d">-                    alias: None,
</a><a href="#h119-0-10" id="h119-0-10" class="d">-                    filter: None,
</a><a href="#h119-0-11" id="h119-0-11" class="d">-                },
</a><a href="#h119-0-12" id="h119-0-12" class="d">-                inner: Scan {
</a><a href="#h119-0-13" id="h119-0-13" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h119-0-14" id="h119-0-14" class="d">-                    alias: None,
</a><a href="#h119-0-15" id="h119-0-15" class="d">-                    filter: None,
</a><a href="#h119-0-16" id="h119-0-16" class="d">-                },
</a><a href="#h119-0-17" id="h119-0-17" class="d">-                predicate: None,
</a><a href="#h119-0-18" id="h119-0-18" class="d">-                pad: false,
</a><a href="#h119-0-19" id="h119-0-19" class="d">-                flip: false,
</a><a href="#h119-0-20" id="h119-0-20" class="d">-            },
</a><a href="#h119-0-21" id="h119-0-21" class="d">-            predicate: Equal(
</a><a href="#h119-0-22" id="h119-0-22" class="d">-                Field(
</a><a href="#h119-0-23" id="h119-0-23" class="d">-                    Some(
</a><a href="#h119-0-24" id="h119-0-24" class="d">-                        &quot;movies&quot;,
</a><a href="#h119-0-25" id="h119-0-25" class="d">-                    ),
</a><a href="#h119-0-26" id="h119-0-26" class="d">-                    &quot;genre_id&quot;,
</a><a href="#h119-0-27" id="h119-0-27" class="d">-                ),
</a><a href="#h119-0-28" id="h119-0-28" class="d">-                Field(
</a><a href="#h119-0-29" id="h119-0-29" class="d">-                    Some(
</a><a href="#h119-0-30" id="h119-0-30" class="d">-                        &quot;genres&quot;,
</a><a href="#h119-0-31" id="h119-0-31" class="d">-                    ),
</a><a href="#h119-0-32" id="h119-0-32" class="d">-                    &quot;id&quot;,
</a><a href="#h119-0-33" id="h119-0-33" class="d">-                ),
</a><a href="#h119-0-34" id="h119-0-34" class="d">-            ),
</a><a href="#h119-0-35" id="h119-0-35" class="d">-        },
</a><a href="#h119-0-36" id="h119-0-36" class="d">-        orders: [
</a><a href="#h119-0-37" id="h119-0-37" class="d">-            (
</a><a href="#h119-0-38" id="h119-0-38" class="d">-                Field(
</a><a href="#h119-0-39" id="h119-0-39" class="d">-                    None,
</a><a href="#h119-0-40" id="h119-0-40" class="d">-                    &quot;id&quot;,
</a><a href="#h119-0-41" id="h119-0-41" class="d">-                ),
</a><a href="#h119-0-42" id="h119-0-42" class="d">-                Ascending,
</a><a href="#h119-0-43" id="h119-0-43" class="d">-            ),
</a><a href="#h119-0-44" id="h119-0-44" class="d">-        ],
</a><a href="#h119-0-45" id="h119-0-45" class="d">-    },
</a><a href="#h119-0-46" id="h119-0-46" class="d">-)
</a><a href="#h119-0-47" id="h119-0-47" class="d">-
</a><a href="#h119-0-48" id="h119-0-48" class="d">-Optimized plan: Plan(
</a><a href="#h119-0-49" id="h119-0-49" class="d">-    Order {
</a><a href="#h119-0-50" id="h119-0-50" class="d">-        source: NestedLoopJoin {
</a><a href="#h119-0-51" id="h119-0-51" class="d">-            outer: Scan {
</a><a href="#h119-0-52" id="h119-0-52" class="d">-                table: &quot;movies&quot;,
</a><a href="#h119-0-53" id="h119-0-53" class="d">-                alias: None,
</a><a href="#h119-0-54" id="h119-0-54" class="d">-                filter: None,
</a><a href="#h119-0-55" id="h119-0-55" class="d">-            },
</a><a href="#h119-0-56" id="h119-0-56" class="d">-            inner: Scan {
</a><a href="#h119-0-57" id="h119-0-57" class="d">-                table: &quot;genres&quot;,
</a><a href="#h119-0-58" id="h119-0-58" class="d">-                alias: None,
</a><a href="#h119-0-59" id="h119-0-59" class="d">-                filter: None,
</a><a href="#h119-0-60" id="h119-0-60" class="d">-            },
</a><a href="#h119-0-61" id="h119-0-61" class="d">-            predicate: Some(
</a><a href="#h119-0-62" id="h119-0-62" class="d">-                Equal(
</a><a href="#h119-0-63" id="h119-0-63" class="d">-                    Field(
</a><a href="#h119-0-64" id="h119-0-64" class="d">-                        Some(
</a><a href="#h119-0-65" id="h119-0-65" class="d">-                            &quot;movies&quot;,
</a><a href="#h119-0-66" id="h119-0-66" class="d">-                        ),
</a><a href="#h119-0-67" id="h119-0-67" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h119-0-68" id="h119-0-68" class="d">-                    ),
</a><a href="#h119-0-69" id="h119-0-69" class="d">-                    Field(
</a><a href="#h119-0-70" id="h119-0-70" class="d">-                        Some(
</a><a href="#h119-0-71" id="h119-0-71" class="d">-                            &quot;genres&quot;,
</a><a href="#h119-0-72" id="h119-0-72" class="d">-                        ),
</a><a href="#h119-0-73" id="h119-0-73" class="d">-                        &quot;id&quot;,
</a><a href="#h119-0-74" id="h119-0-74" class="d">-                    ),
</a><a href="#h119-0-75" id="h119-0-75" class="d">-                ),
</a><a href="#h119-0-76" id="h119-0-76" class="d">-            ),
</a><a href="#h119-0-77" id="h119-0-77" class="d">-            pad: false,
</a><a href="#h119-0-78" id="h119-0-78" class="d">-            flip: false,
</a><a href="#h119-0-79" id="h119-0-79" class="d">-        },
</a><a href="#h119-0-80" id="h119-0-80" class="d">-        orders: [
</a><a href="#h119-0-81" id="h119-0-81" class="d">-            (
</a><a href="#h119-0-82" id="h119-0-82" class="d">-                Field(
</a><a href="#h119-0-83" id="h119-0-83" class="d">-                    None,
</a><a href="#h119-0-84" id="h119-0-84" class="d">-                    &quot;id&quot;,
</a><a href="#h119-0-85" id="h119-0-85" class="d">-                ),
</a><a href="#h119-0-86" id="h119-0-86" class="d">-                Ascending,
</a><a href="#h119-0-87" id="h119-0-87" class="d">-            ),
</a><a href="#h119-0-88" id="h119-0-88" class="d">-        ],
</a><a href="#h119-0-89" id="h119-0-89" class="d">-    },
</a><a href="#h119-0-90" id="h119-0-90" class="d">-)
</a><a href="#h119-0-91" id="h119-0-91" class="d">-
</a><a href="#h119-0-92" id="h119-0-92" class="d">-Query: SELECT * FROM movies, genres WHERE movies.genre_id = genres.id ORDER BY id
</a><a href="#h119-0-93" id="h119-0-93" class="d">-
</a><a href="#h119-0-94" id="h119-0-94" class="d">-Result: Value(&quot;Ambiguous field id&quot;)
</a><a href="#h119-0-95" id="h119-0-95" class="d">-\ No newline at end of file
</a><a href="#h119-0-96" id="h119-0-96" class="i">+Plan: Value(&quot;Ambiguous field id&quot;)
</a><a href="#h119-0-97" id="h119-0-97" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h120" href="../file/tests/sql/query/order_field_qualified.html">tests/sql/query/order_field_qualified</a> b/<a href="../file/tests/sql/query/order_field_qualified.html">tests/sql/query/order_field_qualified</a></b>
<a href="#h120-0" id="h120-0" class="h">@@ -91,12 +91,12 @@ Plan: Plan(
</a>                 source: NestedLoopJoin {
                     outer: Scan {
                         table: &quot;movies&quot;,
<a href="#h120-0-3" id="h120-0-3" class="d">-                        alias: None,
</a><a href="#h120-0-4" id="h120-0-4" class="i">+                        label: &quot;movies&quot;,
</a>                         filter: None,
                     },
                     inner: Scan {
                         table: &quot;genres&quot;,
<a href="#h120-0-9" id="h120-0-9" class="d">-                        alias: None,
</a><a href="#h120-0-10" id="h120-0-10" class="i">+                        label: &quot;genres&quot;,
</a>                         filter: None,
                     },
                     predicate: None,
<a href="#h120-1" id="h120-1" class="h">@@ -105,16 +105,26 @@ Plan: Plan(
</a>                 },
                 predicate: Equal(
                     Field(
<a href="#h120-1-3" id="h120-1-3" class="i">+                        3,
</a>                         Some(
<a href="#h120-1-5" id="h120-1-5" class="d">-                            &quot;movies&quot;,
</a><a href="#h120-1-6" id="h120-1-6" class="i">+                            (
</a><a href="#h120-1-7" id="h120-1-7" class="i">+                                Some(
</a><a href="#h120-1-8" id="h120-1-8" class="i">+                                    &quot;movies&quot;,
</a><a href="#h120-1-9" id="h120-1-9" class="i">+                                ),
</a><a href="#h120-1-10" id="h120-1-10" class="i">+                                &quot;genre_id&quot;,
</a><a href="#h120-1-11" id="h120-1-11" class="i">+                            ),
</a>                         ),
<a href="#h120-1-13" id="h120-1-13" class="d">-                        &quot;genre_id&quot;,
</a>                     ),
                     Field(
<a href="#h120-1-16" id="h120-1-16" class="i">+                        7,
</a>                         Some(
<a href="#h120-1-18" id="h120-1-18" class="d">-                            &quot;genres&quot;,
</a><a href="#h120-1-19" id="h120-1-19" class="i">+                            (
</a><a href="#h120-1-20" id="h120-1-20" class="i">+                                Some(
</a><a href="#h120-1-21" id="h120-1-21" class="i">+                                    &quot;genres&quot;,
</a><a href="#h120-1-22" id="h120-1-22" class="i">+                                ),
</a><a href="#h120-1-23" id="h120-1-23" class="i">+                                &quot;id&quot;,
</a><a href="#h120-1-24" id="h120-1-24" class="i">+                            ),
</a>                         ),
<a href="#h120-1-26" id="h120-1-26" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
             },
<a href="#h120-2" id="h120-2" class="h">@@ -125,37 +135,62 @@ Plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h120-2-3" id="h120-2-3" class="i">+                    0,
</a>                     Some(
<a href="#h120-2-5" id="h120-2-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h120-2-6" id="h120-2-6" class="i">+                        (
</a><a href="#h120-2-7" id="h120-2-7" class="i">+                            Some(
</a><a href="#h120-2-8" id="h120-2-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h120-2-9" id="h120-2-9" class="i">+                            ),
</a><a href="#h120-2-10" id="h120-2-10" class="i">+                            &quot;id&quot;,
</a><a href="#h120-2-11" id="h120-2-11" class="i">+                        ),
</a>                     ),
<a href="#h120-2-13" id="h120-2-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Field(
<a href="#h120-2-16" id="h120-2-16" class="d">-                    None,
</a><a href="#h120-2-17" id="h120-2-17" class="d">-                    &quot;title&quot;,
</a><a href="#h120-2-18" id="h120-2-18" class="i">+                    1,
</a><a href="#h120-2-19" id="h120-2-19" class="i">+                    Some(
</a><a href="#h120-2-20" id="h120-2-20" class="i">+                        (
</a><a href="#h120-2-21" id="h120-2-21" class="i">+                            None,
</a><a href="#h120-2-22" id="h120-2-22" class="i">+                            &quot;title&quot;,
</a><a href="#h120-2-23" id="h120-2-23" class="i">+                        ),
</a><a href="#h120-2-24" id="h120-2-24" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h120-2-27" id="h120-2-27" class="d">-                    None,
</a><a href="#h120-2-28" id="h120-2-28" class="d">-                    &quot;name&quot;,
</a><a href="#h120-2-29" id="h120-2-29" class="i">+                    8,
</a><a href="#h120-2-30" id="h120-2-30" class="i">+                    Some(
</a><a href="#h120-2-31" id="h120-2-31" class="i">+                        (
</a><a href="#h120-2-32" id="h120-2-32" class="i">+                            None,
</a><a href="#h120-2-33" id="h120-2-33" class="i">+                            &quot;name&quot;,
</a><a href="#h120-2-34" id="h120-2-34" class="i">+                        ),
</a><a href="#h120-2-35" id="h120-2-35" class="i">+                    ),
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h120-2-42" id="h120-2-42" class="i">+                    2,
</a>                     Some(
<a href="#h120-2-44" id="h120-2-44" class="d">-                        &quot;genres&quot;,
</a><a href="#h120-2-45" id="h120-2-45" class="i">+                        (
</a><a href="#h120-2-46" id="h120-2-46" class="i">+                            Some(
</a><a href="#h120-2-47" id="h120-2-47" class="i">+                                &quot;genres&quot;,
</a><a href="#h120-2-48" id="h120-2-48" class="i">+                            ),
</a><a href="#h120-2-49" id="h120-2-49" class="i">+                            &quot;name&quot;,
</a><a href="#h120-2-50" id="h120-2-50" class="i">+                        ),
</a>                     ),
<a href="#h120-2-52" id="h120-2-52" class="d">-                    &quot;name&quot;,
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h120-2-58" id="h120-2-58" class="i">+                    1,
</a>                     Some(
<a href="#h120-2-60" id="h120-2-60" class="d">-                        &quot;movies&quot;,
</a><a href="#h120-2-61" id="h120-2-61" class="i">+                        (
</a><a href="#h120-2-62" id="h120-2-62" class="i">+                            Some(
</a><a href="#h120-2-63" id="h120-2-63" class="i">+                                &quot;movies&quot;,
</a><a href="#h120-2-64" id="h120-2-64" class="i">+                            ),
</a><a href="#h120-2-65" id="h120-2-65" class="i">+                            &quot;title&quot;,
</a><a href="#h120-2-66" id="h120-2-66" class="i">+                        ),
</a>                     ),
<a href="#h120-2-68" id="h120-2-68" class="d">-                    &quot;title&quot;,
</a>                 ),
                 Ascending,
             ),
<a href="#h120-3" id="h120-3" class="h">@@ -169,27 +204,37 @@ Optimized plan: Plan(
</a>             source: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h120-3-3" id="h120-3-3" class="d">-                    alias: None,
</a><a href="#h120-3-4" id="h120-3-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h120-3-9" id="h120-3-9" class="d">-                    alias: None,
</a><a href="#h120-3-10" id="h120-3-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: Some(
                     Equal(
                         Field(
<a href="#h120-3-16" id="h120-3-16" class="i">+                            3,
</a>                             Some(
<a href="#h120-3-18" id="h120-3-18" class="d">-                                &quot;movies&quot;,
</a><a href="#h120-3-19" id="h120-3-19" class="i">+                                (
</a><a href="#h120-3-20" id="h120-3-20" class="i">+                                    Some(
</a><a href="#h120-3-21" id="h120-3-21" class="i">+                                        &quot;movies&quot;,
</a><a href="#h120-3-22" id="h120-3-22" class="i">+                                    ),
</a><a href="#h120-3-23" id="h120-3-23" class="i">+                                    &quot;genre_id&quot;,
</a><a href="#h120-3-24" id="h120-3-24" class="i">+                                ),
</a>                             ),
<a href="#h120-3-26" id="h120-3-26" class="d">-                            &quot;genre_id&quot;,
</a>                         ),
                         Field(
<a href="#h120-3-29" id="h120-3-29" class="i">+                            7,
</a>                             Some(
<a href="#h120-3-31" id="h120-3-31" class="d">-                                &quot;genres&quot;,
</a><a href="#h120-3-32" id="h120-3-32" class="i">+                                (
</a><a href="#h120-3-33" id="h120-3-33" class="i">+                                    Some(
</a><a href="#h120-3-34" id="h120-3-34" class="i">+                                        &quot;genres&quot;,
</a><a href="#h120-3-35" id="h120-3-35" class="i">+                                    ),
</a><a href="#h120-3-36" id="h120-3-36" class="i">+                                    &quot;id&quot;,
</a><a href="#h120-3-37" id="h120-3-37" class="i">+                                ),
</a>                             ),
<a href="#h120-3-39" id="h120-3-39" class="d">-                            &quot;id&quot;,
</a>                         ),
                     ),
                 ),
<a href="#h120-4" id="h120-4" class="h">@@ -203,37 +248,62 @@ Optimized plan: Plan(
</a>             ],
             expressions: [
                 Field(
<a href="#h120-4-3" id="h120-4-3" class="i">+                    0,
</a>                     Some(
<a href="#h120-4-5" id="h120-4-5" class="d">-                        &quot;movies&quot;,
</a><a href="#h120-4-6" id="h120-4-6" class="i">+                        (
</a><a href="#h120-4-7" id="h120-4-7" class="i">+                            Some(
</a><a href="#h120-4-8" id="h120-4-8" class="i">+                                &quot;movies&quot;,
</a><a href="#h120-4-9" id="h120-4-9" class="i">+                            ),
</a><a href="#h120-4-10" id="h120-4-10" class="i">+                            &quot;id&quot;,
</a><a href="#h120-4-11" id="h120-4-11" class="i">+                        ),
</a>                     ),
<a href="#h120-4-13" id="h120-4-13" class="d">-                    &quot;id&quot;,
</a>                 ),
                 Field(
<a href="#h120-4-16" id="h120-4-16" class="d">-                    None,
</a><a href="#h120-4-17" id="h120-4-17" class="d">-                    &quot;title&quot;,
</a><a href="#h120-4-18" id="h120-4-18" class="i">+                    1,
</a><a href="#h120-4-19" id="h120-4-19" class="i">+                    Some(
</a><a href="#h120-4-20" id="h120-4-20" class="i">+                        (
</a><a href="#h120-4-21" id="h120-4-21" class="i">+                            None,
</a><a href="#h120-4-22" id="h120-4-22" class="i">+                            &quot;title&quot;,
</a><a href="#h120-4-23" id="h120-4-23" class="i">+                        ),
</a><a href="#h120-4-24" id="h120-4-24" class="i">+                    ),
</a>                 ),
                 Field(
<a href="#h120-4-27" id="h120-4-27" class="d">-                    None,
</a><a href="#h120-4-28" id="h120-4-28" class="d">-                    &quot;name&quot;,
</a><a href="#h120-4-29" id="h120-4-29" class="i">+                    8,
</a><a href="#h120-4-30" id="h120-4-30" class="i">+                    Some(
</a><a href="#h120-4-31" id="h120-4-31" class="i">+                        (
</a><a href="#h120-4-32" id="h120-4-32" class="i">+                            None,
</a><a href="#h120-4-33" id="h120-4-33" class="i">+                            &quot;name&quot;,
</a><a href="#h120-4-34" id="h120-4-34" class="i">+                        ),
</a><a href="#h120-4-35" id="h120-4-35" class="i">+                    ),
</a>                 ),
             ],
         },
         orders: [
             (
                 Field(
<a href="#h120-4-42" id="h120-4-42" class="i">+                    2,
</a>                     Some(
<a href="#h120-4-44" id="h120-4-44" class="d">-                        &quot;genres&quot;,
</a><a href="#h120-4-45" id="h120-4-45" class="i">+                        (
</a><a href="#h120-4-46" id="h120-4-46" class="i">+                            Some(
</a><a href="#h120-4-47" id="h120-4-47" class="i">+                                &quot;genres&quot;,
</a><a href="#h120-4-48" id="h120-4-48" class="i">+                            ),
</a><a href="#h120-4-49" id="h120-4-49" class="i">+                            &quot;name&quot;,
</a><a href="#h120-4-50" id="h120-4-50" class="i">+                        ),
</a>                     ),
<a href="#h120-4-52" id="h120-4-52" class="d">-                    &quot;name&quot;,
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h120-4-58" id="h120-4-58" class="i">+                    1,
</a>                     Some(
<a href="#h120-4-60" id="h120-4-60" class="d">-                        &quot;movies&quot;,
</a><a href="#h120-4-61" id="h120-4-61" class="i">+                        (
</a><a href="#h120-4-62" id="h120-4-62" class="i">+                            Some(
</a><a href="#h120-4-63" id="h120-4-63" class="i">+                                &quot;movies&quot;,
</a><a href="#h120-4-64" id="h120-4-64" class="i">+                            ),
</a><a href="#h120-4-65" id="h120-4-65" class="i">+                            &quot;title&quot;,
</a><a href="#h120-4-66" id="h120-4-66" class="i">+                        ),
</a>                     ),
<a href="#h120-4-68" id="h120-4-68" class="d">-                    &quot;title&quot;,
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h121" href="../file/tests/sql/query/order_field_unknown.html">tests/sql/query/order_field_unknown</a> b/<a href="../file/tests/sql/query/order_field_unknown.html">tests/sql/query/order_field_unknown</a></b>
<a href="#h121-0" id="h121-0" class="h">@@ -31,44 +31,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h121-0-3" id="h121-0-3" class="d">-Plan: Plan(
</a><a href="#h121-0-4" id="h121-0-4" class="d">-    Order {
</a><a href="#h121-0-5" id="h121-0-5" class="d">-        source: Scan {
</a><a href="#h121-0-6" id="h121-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h121-0-7" id="h121-0-7" class="d">-            alias: None,
</a><a href="#h121-0-8" id="h121-0-8" class="d">-            filter: None,
</a><a href="#h121-0-9" id="h121-0-9" class="d">-        },
</a><a href="#h121-0-10" id="h121-0-10" class="d">-        orders: [
</a><a href="#h121-0-11" id="h121-0-11" class="d">-            (
</a><a href="#h121-0-12" id="h121-0-12" class="d">-                Field(
</a><a href="#h121-0-13" id="h121-0-13" class="d">-                    None,
</a><a href="#h121-0-14" id="h121-0-14" class="d">-                    &quot;unknown&quot;,
</a><a href="#h121-0-15" id="h121-0-15" class="d">-                ),
</a><a href="#h121-0-16" id="h121-0-16" class="d">-                Ascending,
</a><a href="#h121-0-17" id="h121-0-17" class="d">-            ),
</a><a href="#h121-0-18" id="h121-0-18" class="d">-        ],
</a><a href="#h121-0-19" id="h121-0-19" class="d">-    },
</a><a href="#h121-0-20" id="h121-0-20" class="d">-)
</a><a href="#h121-0-21" id="h121-0-21" class="d">-
</a><a href="#h121-0-22" id="h121-0-22" class="d">-Optimized plan: Plan(
</a><a href="#h121-0-23" id="h121-0-23" class="d">-    Order {
</a><a href="#h121-0-24" id="h121-0-24" class="d">-        source: Scan {
</a><a href="#h121-0-25" id="h121-0-25" class="d">-            table: &quot;movies&quot;,
</a><a href="#h121-0-26" id="h121-0-26" class="d">-            alias: None,
</a><a href="#h121-0-27" id="h121-0-27" class="d">-            filter: None,
</a><a href="#h121-0-28" id="h121-0-28" class="d">-        },
</a><a href="#h121-0-29" id="h121-0-29" class="d">-        orders: [
</a><a href="#h121-0-30" id="h121-0-30" class="d">-            (
</a><a href="#h121-0-31" id="h121-0-31" class="d">-                Field(
</a><a href="#h121-0-32" id="h121-0-32" class="d">-                    None,
</a><a href="#h121-0-33" id="h121-0-33" class="d">-                    &quot;unknown&quot;,
</a><a href="#h121-0-34" id="h121-0-34" class="d">-                ),
</a><a href="#h121-0-35" id="h121-0-35" class="d">-                Ascending,
</a><a href="#h121-0-36" id="h121-0-36" class="d">-            ),
</a><a href="#h121-0-37" id="h121-0-37" class="d">-        ],
</a><a href="#h121-0-38" id="h121-0-38" class="d">-    },
</a><a href="#h121-0-39" id="h121-0-39" class="d">-)
</a><a href="#h121-0-40" id="h121-0-40" class="d">-
</a><a href="#h121-0-41" id="h121-0-41" class="d">-Query: SELECT * FROM movies ORDER BY unknown
</a><a href="#h121-0-42" id="h121-0-42" class="d">-
</a><a href="#h121-0-43" id="h121-0-43" class="d">-Result: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h121-0-44" id="h121-0-44" class="d">-\ No newline at end of file
</a><a href="#h121-0-45" id="h121-0-45" class="i">+Plan: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h121-0-46" id="h121-0-46" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h122" href="../file/tests/sql/query/order_float_asc.html">tests/sql/query/order_float_asc</a> b/<a href="../file/tests/sql/query/order_float_asc.html">tests/sql/query/order_float_asc</a></b>
<a href="#h122-0" id="h122-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;floats&quot;,
<a href="#h122-0-3" id="h122-0-3" class="d">-            alias: None,
</a><a href="#h122-0-4" id="h122-0-4" class="i">+            label: &quot;floats&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h122-0-10" id="h122-0-10" class="d">-                    None,
</a><a href="#h122-0-11" id="h122-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h122-0-12" id="h122-0-12" class="i">+                    1,
</a><a href="#h122-0-13" id="h122-0-13" class="i">+                    Some(
</a><a href="#h122-0-14" id="h122-0-14" class="i">+                        (
</a><a href="#h122-0-15" id="h122-0-15" class="i">+                            None,
</a><a href="#h122-0-16" id="h122-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h122-0-17" id="h122-0-17" class="i">+                        ),
</a><a href="#h122-0-18" id="h122-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h122-1" id="h122-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;floats&quot;,
<a href="#h122-1-3" id="h122-1-3" class="d">-            alias: None,
</a><a href="#h122-1-4" id="h122-1-4" class="i">+            label: &quot;floats&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h122-1-10" id="h122-1-10" class="d">-                    None,
</a><a href="#h122-1-11" id="h122-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h122-1-12" id="h122-1-12" class="i">+                    1,
</a><a href="#h122-1-13" id="h122-1-13" class="i">+                    Some(
</a><a href="#h122-1-14" id="h122-1-14" class="i">+                        (
</a><a href="#h122-1-15" id="h122-1-15" class="i">+                            None,
</a><a href="#h122-1-16" id="h122-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h122-1-17" id="h122-1-17" class="i">+                        ),
</a><a href="#h122-1-18" id="h122-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h123" href="../file/tests/sql/query/order_float_desc.html">tests/sql/query/order_float_desc</a> b/<a href="../file/tests/sql/query/order_float_desc.html">tests/sql/query/order_float_desc</a></b>
<a href="#h123-0" id="h123-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;floats&quot;,
<a href="#h123-0-3" id="h123-0-3" class="d">-            alias: None,
</a><a href="#h123-0-4" id="h123-0-4" class="i">+            label: &quot;floats&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h123-0-10" id="h123-0-10" class="d">-                    None,
</a><a href="#h123-0-11" id="h123-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h123-0-12" id="h123-0-12" class="i">+                    1,
</a><a href="#h123-0-13" id="h123-0-13" class="i">+                    Some(
</a><a href="#h123-0-14" id="h123-0-14" class="i">+                        (
</a><a href="#h123-0-15" id="h123-0-15" class="i">+                            None,
</a><a href="#h123-0-16" id="h123-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h123-0-17" id="h123-0-17" class="i">+                        ),
</a><a href="#h123-0-18" id="h123-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h123-1" id="h123-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;floats&quot;,
<a href="#h123-1-3" id="h123-1-3" class="d">-            alias: None,
</a><a href="#h123-1-4" id="h123-1-4" class="i">+            label: &quot;floats&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h123-1-10" id="h123-1-10" class="d">-                    None,
</a><a href="#h123-1-11" id="h123-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h123-1-12" id="h123-1-12" class="i">+                    1,
</a><a href="#h123-1-13" id="h123-1-13" class="i">+                    Some(
</a><a href="#h123-1-14" id="h123-1-14" class="i">+                        (
</a><a href="#h123-1-15" id="h123-1-15" class="i">+                            None,
</a><a href="#h123-1-16" id="h123-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h123-1-17" id="h123-1-17" class="i">+                        ),
</a><a href="#h123-1-18" id="h123-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h124" href="../file/tests/sql/query/order_integer_asc.html">tests/sql/query/order_integer_asc</a> b/<a href="../file/tests/sql/query/order_integer_asc.html">tests/sql/query/order_integer_asc</a></b>
<a href="#h124-0" id="h124-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;integers&quot;,
<a href="#h124-0-3" id="h124-0-3" class="d">-            alias: None,
</a><a href="#h124-0-4" id="h124-0-4" class="i">+            label: &quot;integers&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h124-0-10" id="h124-0-10" class="d">-                    None,
</a><a href="#h124-0-11" id="h124-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h124-0-12" id="h124-0-12" class="i">+                    1,
</a><a href="#h124-0-13" id="h124-0-13" class="i">+                    Some(
</a><a href="#h124-0-14" id="h124-0-14" class="i">+                        (
</a><a href="#h124-0-15" id="h124-0-15" class="i">+                            None,
</a><a href="#h124-0-16" id="h124-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h124-0-17" id="h124-0-17" class="i">+                        ),
</a><a href="#h124-0-18" id="h124-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h124-1" id="h124-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;integers&quot;,
<a href="#h124-1-3" id="h124-1-3" class="d">-            alias: None,
</a><a href="#h124-1-4" id="h124-1-4" class="i">+            label: &quot;integers&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h124-1-10" id="h124-1-10" class="d">-                    None,
</a><a href="#h124-1-11" id="h124-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h124-1-12" id="h124-1-12" class="i">+                    1,
</a><a href="#h124-1-13" id="h124-1-13" class="i">+                    Some(
</a><a href="#h124-1-14" id="h124-1-14" class="i">+                        (
</a><a href="#h124-1-15" id="h124-1-15" class="i">+                            None,
</a><a href="#h124-1-16" id="h124-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h124-1-17" id="h124-1-17" class="i">+                        ),
</a><a href="#h124-1-18" id="h124-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h125" href="../file/tests/sql/query/order_integer_desc.html">tests/sql/query/order_integer_desc</a> b/<a href="../file/tests/sql/query/order_integer_desc.html">tests/sql/query/order_integer_desc</a></b>
<a href="#h125-0" id="h125-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;integers&quot;,
<a href="#h125-0-3" id="h125-0-3" class="d">-            alias: None,
</a><a href="#h125-0-4" id="h125-0-4" class="i">+            label: &quot;integers&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h125-0-10" id="h125-0-10" class="d">-                    None,
</a><a href="#h125-0-11" id="h125-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h125-0-12" id="h125-0-12" class="i">+                    1,
</a><a href="#h125-0-13" id="h125-0-13" class="i">+                    Some(
</a><a href="#h125-0-14" id="h125-0-14" class="i">+                        (
</a><a href="#h125-0-15" id="h125-0-15" class="i">+                            None,
</a><a href="#h125-0-16" id="h125-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h125-0-17" id="h125-0-17" class="i">+                        ),
</a><a href="#h125-0-18" id="h125-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h125-1" id="h125-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;integers&quot;,
<a href="#h125-1-3" id="h125-1-3" class="d">-            alias: None,
</a><a href="#h125-1-4" id="h125-1-4" class="i">+            label: &quot;integers&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h125-1-10" id="h125-1-10" class="d">-                    None,
</a><a href="#h125-1-11" id="h125-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h125-1-12" id="h125-1-12" class="i">+                    1,
</a><a href="#h125-1-13" id="h125-1-13" class="i">+                    Some(
</a><a href="#h125-1-14" id="h125-1-14" class="i">+                        (
</a><a href="#h125-1-15" id="h125-1-15" class="i">+                            None,
</a><a href="#h125-1-16" id="h125-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h125-1-17" id="h125-1-17" class="i">+                        ),
</a><a href="#h125-1-18" id="h125-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h126" href="../file/tests/sql/query/order_multi.html">tests/sql/query/order_multi</a> b/<a href="../file/tests/sql/query/order_multi.html">tests/sql/query/order_multi</a></b>
<a href="#h126-0" id="h126-0" class="h">@@ -42,21 +42,31 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h126-0-3" id="h126-0-3" class="d">-            alias: None,
</a><a href="#h126-0-4" id="h126-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h126-0-10" id="h126-0-10" class="d">-                    None,
</a><a href="#h126-0-11" id="h126-0-11" class="d">-                    &quot;ultrahd&quot;,
</a><a href="#h126-0-12" id="h126-0-12" class="i">+                    6,
</a><a href="#h126-0-13" id="h126-0-13" class="i">+                    Some(
</a><a href="#h126-0-14" id="h126-0-14" class="i">+                        (
</a><a href="#h126-0-15" id="h126-0-15" class="i">+                            None,
</a><a href="#h126-0-16" id="h126-0-16" class="i">+                            &quot;ultrahd&quot;,
</a><a href="#h126-0-17" id="h126-0-17" class="i">+                        ),
</a><a href="#h126-0-18" id="h126-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h126-0-24" id="h126-0-24" class="d">-                    None,
</a><a href="#h126-0-25" id="h126-0-25" class="d">-                    &quot;id&quot;,
</a><a href="#h126-0-26" id="h126-0-26" class="i">+                    0,
</a><a href="#h126-0-27" id="h126-0-27" class="i">+                    Some(
</a><a href="#h126-0-28" id="h126-0-28" class="i">+                        (
</a><a href="#h126-0-29" id="h126-0-29" class="i">+                            None,
</a><a href="#h126-0-30" id="h126-0-30" class="i">+                            &quot;id&quot;,
</a><a href="#h126-0-31" id="h126-0-31" class="i">+                        ),
</a><a href="#h126-0-32" id="h126-0-32" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h126-1" id="h126-1" class="h">@@ -68,21 +78,31 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h126-1-3" id="h126-1-3" class="d">-            alias: None,
</a><a href="#h126-1-4" id="h126-1-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h126-1-10" id="h126-1-10" class="d">-                    None,
</a><a href="#h126-1-11" id="h126-1-11" class="d">-                    &quot;ultrahd&quot;,
</a><a href="#h126-1-12" id="h126-1-12" class="i">+                    6,
</a><a href="#h126-1-13" id="h126-1-13" class="i">+                    Some(
</a><a href="#h126-1-14" id="h126-1-14" class="i">+                        (
</a><a href="#h126-1-15" id="h126-1-15" class="i">+                            None,
</a><a href="#h126-1-16" id="h126-1-16" class="i">+                            &quot;ultrahd&quot;,
</a><a href="#h126-1-17" id="h126-1-17" class="i">+                        ),
</a><a href="#h126-1-18" id="h126-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
             (
                 Field(
<a href="#h126-1-24" id="h126-1-24" class="d">-                    None,
</a><a href="#h126-1-25" id="h126-1-25" class="d">-                    &quot;id&quot;,
</a><a href="#h126-1-26" id="h126-1-26" class="i">+                    0,
</a><a href="#h126-1-27" id="h126-1-27" class="i">+                    Some(
</a><a href="#h126-1-28" id="h126-1-28" class="i">+                        (
</a><a href="#h126-1-29" id="h126-1-29" class="i">+                            None,
</a><a href="#h126-1-30" id="h126-1-30" class="i">+                            &quot;id&quot;,
</a><a href="#h126-1-31" id="h126-1-31" class="i">+                        ),
</a><a href="#h126-1-32" id="h126-1-32" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h127" href="../file/tests/sql/query/order_string_asc.html">tests/sql/query/order_string_asc</a> b/<a href="../file/tests/sql/query/order_string_asc.html">tests/sql/query/order_string_asc</a></b>
<a href="#h127-0" id="h127-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;strings&quot;,
<a href="#h127-0-3" id="h127-0-3" class="d">-            alias: None,
</a><a href="#h127-0-4" id="h127-0-4" class="i">+            label: &quot;strings&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h127-0-10" id="h127-0-10" class="d">-                    None,
</a><a href="#h127-0-11" id="h127-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h127-0-12" id="h127-0-12" class="i">+                    1,
</a><a href="#h127-0-13" id="h127-0-13" class="i">+                    Some(
</a><a href="#h127-0-14" id="h127-0-14" class="i">+                        (
</a><a href="#h127-0-15" id="h127-0-15" class="i">+                            None,
</a><a href="#h127-0-16" id="h127-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h127-0-17" id="h127-0-17" class="i">+                        ),
</a><a href="#h127-0-18" id="h127-0-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h127-1" id="h127-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;strings&quot;,
<a href="#h127-1-3" id="h127-1-3" class="d">-            alias: None,
</a><a href="#h127-1-4" id="h127-1-4" class="i">+            label: &quot;strings&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h127-1-10" id="h127-1-10" class="d">-                    None,
</a><a href="#h127-1-11" id="h127-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h127-1-12" id="h127-1-12" class="i">+                    1,
</a><a href="#h127-1-13" id="h127-1-13" class="i">+                    Some(
</a><a href="#h127-1-14" id="h127-1-14" class="i">+                        (
</a><a href="#h127-1-15" id="h127-1-15" class="i">+                            None,
</a><a href="#h127-1-16" id="h127-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h127-1-17" id="h127-1-17" class="i">+                        ),
</a><a href="#h127-1-18" id="h127-1-18" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h128" href="../file/tests/sql/query/order_string_desc.html">tests/sql/query/order_string_desc</a> b/<a href="../file/tests/sql/query/order_string_desc.html">tests/sql/query/order_string_desc</a></b>
<a href="#h128-0" id="h128-0" class="h">@@ -35,14 +35,19 @@ Plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;strings&quot;,
<a href="#h128-0-3" id="h128-0-3" class="d">-            alias: None,
</a><a href="#h128-0-4" id="h128-0-4" class="i">+            label: &quot;strings&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h128-0-10" id="h128-0-10" class="d">-                    None,
</a><a href="#h128-0-11" id="h128-0-11" class="d">-                    &quot;value&quot;,
</a><a href="#h128-0-12" id="h128-0-12" class="i">+                    1,
</a><a href="#h128-0-13" id="h128-0-13" class="i">+                    Some(
</a><a href="#h128-0-14" id="h128-0-14" class="i">+                        (
</a><a href="#h128-0-15" id="h128-0-15" class="i">+                            None,
</a><a href="#h128-0-16" id="h128-0-16" class="i">+                            &quot;value&quot;,
</a><a href="#h128-0-17" id="h128-0-17" class="i">+                        ),
</a><a href="#h128-0-18" id="h128-0-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<a href="#h128-1" id="h128-1" class="h">@@ -54,14 +59,19 @@ Optimized plan: Plan(
</a>     Order {
         source: Scan {
             table: &quot;strings&quot;,
<a href="#h128-1-3" id="h128-1-3" class="d">-            alias: None,
</a><a href="#h128-1-4" id="h128-1-4" class="i">+            label: &quot;strings&quot;,
</a>             filter: None,
         },
         orders: [
             (
                 Field(
<a href="#h128-1-10" id="h128-1-10" class="d">-                    None,
</a><a href="#h128-1-11" id="h128-1-11" class="d">-                    &quot;value&quot;,
</a><a href="#h128-1-12" id="h128-1-12" class="i">+                    1,
</a><a href="#h128-1-13" id="h128-1-13" class="i">+                    Some(
</a><a href="#h128-1-14" id="h128-1-14" class="i">+                        (
</a><a href="#h128-1-15" id="h128-1-15" class="i">+                            None,
</a><a href="#h128-1-16" id="h128-1-16" class="i">+                            &quot;value&quot;,
</a><a href="#h128-1-17" id="h128-1-17" class="i">+                        ),
</a><a href="#h128-1-18" id="h128-1-18" class="i">+                    ),
</a>                 ),
                 Descending,
             ),
<b>diff --git a/<a id="h129" href="../file/tests/sql/query/where_expr.html">tests/sql/query/where_expr</a> b/<a href="../file/tests/sql/query/where_expr.html">tests/sql/query/where_expr</a></b>
<a href="#h129-0" id="h129-0" class="h">@@ -51,15 +51,20 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h129-0-3" id="h129-0-3" class="d">-            alias: None,
</a><a href="#h129-0-4" id="h129-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: And(
             Or(
                 GreaterThan(
                     Field(
<a href="#h129-0-11" id="h129-0-11" class="d">-                        None,
</a><a href="#h129-0-12" id="h129-0-12" class="d">-                        &quot;released&quot;,
</a><a href="#h129-0-13" id="h129-0-13" class="i">+                        4,
</a><a href="#h129-0-14" id="h129-0-14" class="i">+                        Some(
</a><a href="#h129-0-15" id="h129-0-15" class="i">+                            (
</a><a href="#h129-0-16" id="h129-0-16" class="i">+                                None,
</a><a href="#h129-0-17" id="h129-0-17" class="i">+                                &quot;released&quot;,
</a><a href="#h129-0-18" id="h129-0-18" class="i">+                            ),
</a><a href="#h129-0-19" id="h129-0-19" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h129-1" id="h129-1" class="h">@@ -69,8 +74,13 @@ Plan: Plan(
</a>                 ),
                 Equal(
                     Field(
<a href="#h129-1-3" id="h129-1-3" class="d">-                        None,
</a><a href="#h129-1-4" id="h129-1-4" class="d">-                        &quot;released&quot;,
</a><a href="#h129-1-5" id="h129-1-5" class="i">+                        4,
</a><a href="#h129-1-6" id="h129-1-6" class="i">+                        Some(
</a><a href="#h129-1-7" id="h129-1-7" class="i">+                            (
</a><a href="#h129-1-8" id="h129-1-8" class="i">+                                None,
</a><a href="#h129-1-9" id="h129-1-9" class="i">+                                &quot;released&quot;,
</a><a href="#h129-1-10" id="h129-1-10" class="i">+                            ),
</a><a href="#h129-1-11" id="h129-1-11" class="i">+                        ),
</a>                     ),
                     Constant(
                         Integer(
<a href="#h129-2" id="h129-2" class="h">@@ -80,8 +90,13 @@ Plan: Plan(
</a>                 ),
             ),
             Field(
<a href="#h129-2-3" id="h129-2-3" class="d">-                None,
</a><a href="#h129-2-4" id="h129-2-4" class="d">-                &quot;ultrahd&quot;,
</a><a href="#h129-2-5" id="h129-2-5" class="i">+                6,
</a><a href="#h129-2-6" id="h129-2-6" class="i">+                Some(
</a><a href="#h129-2-7" id="h129-2-7" class="i">+                    (
</a><a href="#h129-2-8" id="h129-2-8" class="i">+                        None,
</a><a href="#h129-2-9" id="h129-2-9" class="i">+                        &quot;ultrahd&quot;,
</a><a href="#h129-2-10" id="h129-2-10" class="i">+                    ),
</a><a href="#h129-2-11" id="h129-2-11" class="i">+                ),
</a>             ),
         ),
     },
<a href="#h129-3" id="h129-3" class="h">@@ -90,14 +105,19 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h129-3-3" id="h129-3-3" class="d">-        alias: None,
</a><a href="#h129-3-4" id="h129-3-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             And(
                 Or(
                     GreaterThan(
                         Field(
<a href="#h129-3-10" id="h129-3-10" class="d">-                            None,
</a><a href="#h129-3-11" id="h129-3-11" class="d">-                            &quot;released&quot;,
</a><a href="#h129-3-12" id="h129-3-12" class="i">+                            4,
</a><a href="#h129-3-13" id="h129-3-13" class="i">+                            Some(
</a><a href="#h129-3-14" id="h129-3-14" class="i">+                                (
</a><a href="#h129-3-15" id="h129-3-15" class="i">+                                    None,
</a><a href="#h129-3-16" id="h129-3-16" class="i">+                                    &quot;released&quot;,
</a><a href="#h129-3-17" id="h129-3-17" class="i">+                                ),
</a><a href="#h129-3-18" id="h129-3-18" class="i">+                            ),
</a>                         ),
                         Constant(
                             Integer(
<a href="#h129-4" id="h129-4" class="h">@@ -107,8 +127,13 @@ Optimized plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h129-4-3" id="h129-4-3" class="d">-                            None,
</a><a href="#h129-4-4" id="h129-4-4" class="d">-                            &quot;released&quot;,
</a><a href="#h129-4-5" id="h129-4-5" class="i">+                            4,
</a><a href="#h129-4-6" id="h129-4-6" class="i">+                            Some(
</a><a href="#h129-4-7" id="h129-4-7" class="i">+                                (
</a><a href="#h129-4-8" id="h129-4-8" class="i">+                                    None,
</a><a href="#h129-4-9" id="h129-4-9" class="i">+                                    &quot;released&quot;,
</a><a href="#h129-4-10" id="h129-4-10" class="i">+                                ),
</a><a href="#h129-4-11" id="h129-4-11" class="i">+                            ),
</a>                         ),
                         Constant(
                             Integer(
<a href="#h129-5" id="h129-5" class="h">@@ -118,8 +143,13 @@ Optimized plan: Plan(
</a>                     ),
                 ),
                 Field(
<a href="#h129-5-3" id="h129-5-3" class="d">-                    None,
</a><a href="#h129-5-4" id="h129-5-4" class="d">-                    &quot;ultrahd&quot;,
</a><a href="#h129-5-5" id="h129-5-5" class="i">+                    6,
</a><a href="#h129-5-6" id="h129-5-6" class="i">+                    Some(
</a><a href="#h129-5-7" id="h129-5-7" class="i">+                        (
</a><a href="#h129-5-8" id="h129-5-8" class="i">+                            None,
</a><a href="#h129-5-9" id="h129-5-9" class="i">+                            &quot;ultrahd&quot;,
</a><a href="#h129-5-10" id="h129-5-10" class="i">+                        ),
</a><a href="#h129-5-11" id="h129-5-11" class="i">+                    ),
</a>                 ),
             ),
         ),
<b>diff --git a/<a id="h130" href="../file/tests/sql/query/where_false.html">tests/sql/query/where_false</a> b/<a href="../file/tests/sql/query/where_false.html">tests/sql/query/where_false</a></b>
<a href="#h130-0" id="h130-0" class="h">@@ -35,7 +35,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h130-0-3" id="h130-0-3" class="d">-            alias: None,
</a><a href="#h130-0-4" id="h130-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h130-1" id="h130-1" class="h">@@ -49,7 +49,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h130-1-3" id="h130-1-3" class="d">-        alias: None,
</a><a href="#h130-1-4" id="h130-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 Boolean(
<b>diff --git a/<a id="h131" href="../file/tests/sql/query/where_field_aliased_select.html">tests/sql/query/where_field_aliased_select</a> b/<a href="../file/tests/sql/query/where_field_aliased_select.html">tests/sql/query/where_field_aliased_select</a></b>
<a href="#h131-0" id="h131-0" class="h">@@ -84,175 +84,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h131-0-3" id="h131-0-3" class="d">-Plan: Plan(
</a><a href="#h131-0-4" id="h131-0-4" class="d">-    Projection {
</a><a href="#h131-0-5" id="h131-0-5" class="d">-        source: Filter {
</a><a href="#h131-0-6" id="h131-0-6" class="d">-            source: NestedLoopJoin {
</a><a href="#h131-0-7" id="h131-0-7" class="d">-                outer: Scan {
</a><a href="#h131-0-8" id="h131-0-8" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h131-0-9" id="h131-0-9" class="d">-                    alias: Some(
</a><a href="#h131-0-10" id="h131-0-10" class="d">-                        &quot;m&quot;,
</a><a href="#h131-0-11" id="h131-0-11" class="d">-                    ),
</a><a href="#h131-0-12" id="h131-0-12" class="d">-                    filter: None,
</a><a href="#h131-0-13" id="h131-0-13" class="d">-                },
</a><a href="#h131-0-14" id="h131-0-14" class="d">-                inner: Scan {
</a><a href="#h131-0-15" id="h131-0-15" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h131-0-16" id="h131-0-16" class="d">-                    alias: Some(
</a><a href="#h131-0-17" id="h131-0-17" class="d">-                        &quot;g&quot;,
</a><a href="#h131-0-18" id="h131-0-18" class="d">-                    ),
</a><a href="#h131-0-19" id="h131-0-19" class="d">-                    filter: None,
</a><a href="#h131-0-20" id="h131-0-20" class="d">-                },
</a><a href="#h131-0-21" id="h131-0-21" class="d">-                predicate: None,
</a><a href="#h131-0-22" id="h131-0-22" class="d">-                pad: false,
</a><a href="#h131-0-23" id="h131-0-23" class="d">-                flip: false,
</a><a href="#h131-0-24" id="h131-0-24" class="d">-            },
</a><a href="#h131-0-25" id="h131-0-25" class="d">-            predicate: And(
</a><a href="#h131-0-26" id="h131-0-26" class="d">-                Or(
</a><a href="#h131-0-27" id="h131-0-27" class="d">-                    GreaterThan(
</a><a href="#h131-0-28" id="h131-0-28" class="d">-                        Field(
</a><a href="#h131-0-29" id="h131-0-29" class="d">-                            None,
</a><a href="#h131-0-30" id="h131-0-30" class="d">-                            &quot;movie_id&quot;,
</a><a href="#h131-0-31" id="h131-0-31" class="d">-                        ),
</a><a href="#h131-0-32" id="h131-0-32" class="d">-                        Constant(
</a><a href="#h131-0-33" id="h131-0-33" class="d">-                            Integer(
</a><a href="#h131-0-34" id="h131-0-34" class="d">-                                3,
</a><a href="#h131-0-35" id="h131-0-35" class="d">-                            ),
</a><a href="#h131-0-36" id="h131-0-36" class="d">-                        ),
</a><a href="#h131-0-37" id="h131-0-37" class="d">-                    ),
</a><a href="#h131-0-38" id="h131-0-38" class="d">-                    Equal(
</a><a href="#h131-0-39" id="h131-0-39" class="d">-                        Field(
</a><a href="#h131-0-40" id="h131-0-40" class="d">-                            None,
</a><a href="#h131-0-41" id="h131-0-41" class="d">-                            &quot;movie_id&quot;,
</a><a href="#h131-0-42" id="h131-0-42" class="d">-                        ),
</a><a href="#h131-0-43" id="h131-0-43" class="d">-                        Constant(
</a><a href="#h131-0-44" id="h131-0-44" class="d">-                            Integer(
</a><a href="#h131-0-45" id="h131-0-45" class="d">-                                3,
</a><a href="#h131-0-46" id="h131-0-46" class="d">-                            ),
</a><a href="#h131-0-47" id="h131-0-47" class="d">-                        ),
</a><a href="#h131-0-48" id="h131-0-48" class="d">-                    ),
</a><a href="#h131-0-49" id="h131-0-49" class="d">-                ),
</a><a href="#h131-0-50" id="h131-0-50" class="d">-                Equal(
</a><a href="#h131-0-51" id="h131-0-51" class="d">-                    Field(
</a><a href="#h131-0-52" id="h131-0-52" class="d">-                        None,
</a><a href="#h131-0-53" id="h131-0-53" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h131-0-54" id="h131-0-54" class="d">-                    ),
</a><a href="#h131-0-55" id="h131-0-55" class="d">-                    Constant(
</a><a href="#h131-0-56" id="h131-0-56" class="d">-                        Integer(
</a><a href="#h131-0-57" id="h131-0-57" class="d">-                            1,
</a><a href="#h131-0-58" id="h131-0-58" class="d">-                        ),
</a><a href="#h131-0-59" id="h131-0-59" class="d">-                    ),
</a><a href="#h131-0-60" id="h131-0-60" class="d">-                ),
</a><a href="#h131-0-61" id="h131-0-61" class="d">-            ),
</a><a href="#h131-0-62" id="h131-0-62" class="d">-        },
</a><a href="#h131-0-63" id="h131-0-63" class="d">-        labels: [
</a><a href="#h131-0-64" id="h131-0-64" class="d">-            Some(
</a><a href="#h131-0-65" id="h131-0-65" class="d">-                &quot;movie_id&quot;,
</a><a href="#h131-0-66" id="h131-0-66" class="d">-            ),
</a><a href="#h131-0-67" id="h131-0-67" class="d">-            Some(
</a><a href="#h131-0-68" id="h131-0-68" class="d">-                &quot;genre_id&quot;,
</a><a href="#h131-0-69" id="h131-0-69" class="d">-            ),
</a><a href="#h131-0-70" id="h131-0-70" class="d">-        ],
</a><a href="#h131-0-71" id="h131-0-71" class="d">-        expressions: [
</a><a href="#h131-0-72" id="h131-0-72" class="d">-            Field(
</a><a href="#h131-0-73" id="h131-0-73" class="d">-                Some(
</a><a href="#h131-0-74" id="h131-0-74" class="d">-                    &quot;m&quot;,
</a><a href="#h131-0-75" id="h131-0-75" class="d">-                ),
</a><a href="#h131-0-76" id="h131-0-76" class="d">-                &quot;id&quot;,
</a><a href="#h131-0-77" id="h131-0-77" class="d">-            ),
</a><a href="#h131-0-78" id="h131-0-78" class="d">-            Field(
</a><a href="#h131-0-79" id="h131-0-79" class="d">-                Some(
</a><a href="#h131-0-80" id="h131-0-80" class="d">-                    &quot;g&quot;,
</a><a href="#h131-0-81" id="h131-0-81" class="d">-                ),
</a><a href="#h131-0-82" id="h131-0-82" class="d">-                &quot;id&quot;,
</a><a href="#h131-0-83" id="h131-0-83" class="d">-            ),
</a><a href="#h131-0-84" id="h131-0-84" class="d">-        ],
</a><a href="#h131-0-85" id="h131-0-85" class="d">-    },
</a><a href="#h131-0-86" id="h131-0-86" class="d">-)
</a><a href="#h131-0-87" id="h131-0-87" class="d">-
</a><a href="#h131-0-88" id="h131-0-88" class="d">-Optimized plan: Plan(
</a><a href="#h131-0-89" id="h131-0-89" class="d">-    Projection {
</a><a href="#h131-0-90" id="h131-0-90" class="d">-        source: NestedLoopJoin {
</a><a href="#h131-0-91" id="h131-0-91" class="d">-            outer: Scan {
</a><a href="#h131-0-92" id="h131-0-92" class="d">-                table: &quot;movies&quot;,
</a><a href="#h131-0-93" id="h131-0-93" class="d">-                alias: Some(
</a><a href="#h131-0-94" id="h131-0-94" class="d">-                    &quot;m&quot;,
</a><a href="#h131-0-95" id="h131-0-95" class="d">-                ),
</a><a href="#h131-0-96" id="h131-0-96" class="d">-                filter: None,
</a><a href="#h131-0-97" id="h131-0-97" class="d">-            },
</a><a href="#h131-0-98" id="h131-0-98" class="d">-            inner: Scan {
</a><a href="#h131-0-99" id="h131-0-99" class="d">-                table: &quot;genres&quot;,
</a><a href="#h131-0-100" id="h131-0-100" class="d">-                alias: Some(
</a><a href="#h131-0-101" id="h131-0-101" class="d">-                    &quot;g&quot;,
</a><a href="#h131-0-102" id="h131-0-102" class="d">-                ),
</a><a href="#h131-0-103" id="h131-0-103" class="d">-                filter: None,
</a><a href="#h131-0-104" id="h131-0-104" class="d">-            },
</a><a href="#h131-0-105" id="h131-0-105" class="d">-            predicate: Some(
</a><a href="#h131-0-106" id="h131-0-106" class="d">-                And(
</a><a href="#h131-0-107" id="h131-0-107" class="d">-                    Or(
</a><a href="#h131-0-108" id="h131-0-108" class="d">-                        GreaterThan(
</a><a href="#h131-0-109" id="h131-0-109" class="d">-                            Field(
</a><a href="#h131-0-110" id="h131-0-110" class="d">-                                None,
</a><a href="#h131-0-111" id="h131-0-111" class="d">-                                &quot;movie_id&quot;,
</a><a href="#h131-0-112" id="h131-0-112" class="d">-                            ),
</a><a href="#h131-0-113" id="h131-0-113" class="d">-                            Constant(
</a><a href="#h131-0-114" id="h131-0-114" class="d">-                                Integer(
</a><a href="#h131-0-115" id="h131-0-115" class="d">-                                    3,
</a><a href="#h131-0-116" id="h131-0-116" class="d">-                                ),
</a><a href="#h131-0-117" id="h131-0-117" class="d">-                            ),
</a><a href="#h131-0-118" id="h131-0-118" class="d">-                        ),
</a><a href="#h131-0-119" id="h131-0-119" class="d">-                        Equal(
</a><a href="#h131-0-120" id="h131-0-120" class="d">-                            Field(
</a><a href="#h131-0-121" id="h131-0-121" class="d">-                                None,
</a><a href="#h131-0-122" id="h131-0-122" class="d">-                                &quot;movie_id&quot;,
</a><a href="#h131-0-123" id="h131-0-123" class="d">-                            ),
</a><a href="#h131-0-124" id="h131-0-124" class="d">-                            Constant(
</a><a href="#h131-0-125" id="h131-0-125" class="d">-                                Integer(
</a><a href="#h131-0-126" id="h131-0-126" class="d">-                                    3,
</a><a href="#h131-0-127" id="h131-0-127" class="d">-                                ),
</a><a href="#h131-0-128" id="h131-0-128" class="d">-                            ),
</a><a href="#h131-0-129" id="h131-0-129" class="d">-                        ),
</a><a href="#h131-0-130" id="h131-0-130" class="d">-                    ),
</a><a href="#h131-0-131" id="h131-0-131" class="d">-                    Equal(
</a><a href="#h131-0-132" id="h131-0-132" class="d">-                        Field(
</a><a href="#h131-0-133" id="h131-0-133" class="d">-                            None,
</a><a href="#h131-0-134" id="h131-0-134" class="d">-                            &quot;genre_id&quot;,
</a><a href="#h131-0-135" id="h131-0-135" class="d">-                        ),
</a><a href="#h131-0-136" id="h131-0-136" class="d">-                        Constant(
</a><a href="#h131-0-137" id="h131-0-137" class="d">-                            Integer(
</a><a href="#h131-0-138" id="h131-0-138" class="d">-                                1,
</a><a href="#h131-0-139" id="h131-0-139" class="d">-                            ),
</a><a href="#h131-0-140" id="h131-0-140" class="d">-                        ),
</a><a href="#h131-0-141" id="h131-0-141" class="d">-                    ),
</a><a href="#h131-0-142" id="h131-0-142" class="d">-                ),
</a><a href="#h131-0-143" id="h131-0-143" class="d">-            ),
</a><a href="#h131-0-144" id="h131-0-144" class="d">-            pad: false,
</a><a href="#h131-0-145" id="h131-0-145" class="d">-            flip: false,
</a><a href="#h131-0-146" id="h131-0-146" class="d">-        },
</a><a href="#h131-0-147" id="h131-0-147" class="d">-        labels: [
</a><a href="#h131-0-148" id="h131-0-148" class="d">-            Some(
</a><a href="#h131-0-149" id="h131-0-149" class="d">-                &quot;movie_id&quot;,
</a><a href="#h131-0-150" id="h131-0-150" class="d">-            ),
</a><a href="#h131-0-151" id="h131-0-151" class="d">-            Some(
</a><a href="#h131-0-152" id="h131-0-152" class="d">-                &quot;genre_id&quot;,
</a><a href="#h131-0-153" id="h131-0-153" class="d">-            ),
</a><a href="#h131-0-154" id="h131-0-154" class="d">-        ],
</a><a href="#h131-0-155" id="h131-0-155" class="d">-        expressions: [
</a><a href="#h131-0-156" id="h131-0-156" class="d">-            Field(
</a><a href="#h131-0-157" id="h131-0-157" class="d">-                Some(
</a><a href="#h131-0-158" id="h131-0-158" class="d">-                    &quot;m&quot;,
</a><a href="#h131-0-159" id="h131-0-159" class="d">-                ),
</a><a href="#h131-0-160" id="h131-0-160" class="d">-                &quot;id&quot;,
</a><a href="#h131-0-161" id="h131-0-161" class="d">-            ),
</a><a href="#h131-0-162" id="h131-0-162" class="d">-            Field(
</a><a href="#h131-0-163" id="h131-0-163" class="d">-                Some(
</a><a href="#h131-0-164" id="h131-0-164" class="d">-                    &quot;g&quot;,
</a><a href="#h131-0-165" id="h131-0-165" class="d">-                ),
</a><a href="#h131-0-166" id="h131-0-166" class="d">-                &quot;id&quot;,
</a><a href="#h131-0-167" id="h131-0-167" class="d">-            ),
</a><a href="#h131-0-168" id="h131-0-168" class="d">-        ],
</a><a href="#h131-0-169" id="h131-0-169" class="d">-    },
</a><a href="#h131-0-170" id="h131-0-170" class="d">-)
</a><a href="#h131-0-171" id="h131-0-171" class="d">-
</a><a href="#h131-0-172" id="h131-0-172" class="d">-Query: SELECT m.id AS movie_id, g.id AS genre_id FROM movies m, genres g WHERE movie_id &gt;= 3 AND genre_id = 1
</a><a href="#h131-0-173" id="h131-0-173" class="d">-
</a><a href="#h131-0-174" id="h131-0-174" class="d">-Result: Value(&quot;Unknown field movie_id&quot;)
</a><a href="#h131-0-175" id="h131-0-175" class="d">-\ No newline at end of file
</a><a href="#h131-0-176" id="h131-0-176" class="i">+Plan: Value(&quot;Unknown field movie_id&quot;)
</a><a href="#h131-0-177" id="h131-0-177" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h132" href="../file/tests/sql/query/where_field_aliased_table.html">tests/sql/query/where_field_aliased_table</a> b/<a href="../file/tests/sql/query/where_field_aliased_table.html">tests/sql/query/where_field_aliased_table</a></b>
<a href="#h132-0" id="h132-0" class="h">@@ -90,16 +90,12 @@ Plan: Plan(
</a>             source: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h132-0-3" id="h132-0-3" class="d">-                    alias: Some(
</a><a href="#h132-0-4" id="h132-0-4" class="d">-                        &quot;m&quot;,
</a><a href="#h132-0-5" id="h132-0-5" class="d">-                    ),
</a><a href="#h132-0-6" id="h132-0-6" class="i">+                    label: &quot;m&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h132-0-11" id="h132-0-11" class="d">-                    alias: Some(
</a><a href="#h132-0-12" id="h132-0-12" class="d">-                        &quot;g&quot;,
</a><a href="#h132-0-13" id="h132-0-13" class="d">-                    ),
</a><a href="#h132-0-14" id="h132-0-14" class="i">+                    label: &quot;g&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h132-1" id="h132-1" class="h">@@ -110,10 +106,15 @@ Plan: Plan(
</a>                 Or(
                     GreaterThan(
                         Field(
<a href="#h132-1-3" id="h132-1-3" class="i">+                            0,
</a>                             Some(
<a href="#h132-1-5" id="h132-1-5" class="d">-                                &quot;m&quot;,
</a><a href="#h132-1-6" id="h132-1-6" class="i">+                                (
</a><a href="#h132-1-7" id="h132-1-7" class="i">+                                    Some(
</a><a href="#h132-1-8" id="h132-1-8" class="i">+                                        &quot;m&quot;,
</a><a href="#h132-1-9" id="h132-1-9" class="i">+                                    ),
</a><a href="#h132-1-10" id="h132-1-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h132-1-11" id="h132-1-11" class="i">+                                ),
</a>                             ),
<a href="#h132-1-13" id="h132-1-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h132-2" id="h132-2" class="h">@@ -123,10 +124,15 @@ Plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h132-2-3" id="h132-2-3" class="i">+                            0,
</a>                             Some(
<a href="#h132-2-5" id="h132-2-5" class="d">-                                &quot;m&quot;,
</a><a href="#h132-2-6" id="h132-2-6" class="i">+                                (
</a><a href="#h132-2-7" id="h132-2-7" class="i">+                                    Some(
</a><a href="#h132-2-8" id="h132-2-8" class="i">+                                        &quot;m&quot;,
</a><a href="#h132-2-9" id="h132-2-9" class="i">+                                    ),
</a><a href="#h132-2-10" id="h132-2-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h132-2-11" id="h132-2-11" class="i">+                                ),
</a>                             ),
<a href="#h132-2-13" id="h132-2-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h132-3" id="h132-3" class="h">@@ -137,10 +143,15 @@ Plan: Plan(
</a>                 ),
                 Equal(
                     Field(
<a href="#h132-3-3" id="h132-3-3" class="i">+                        7,
</a>                         Some(
<a href="#h132-3-5" id="h132-3-5" class="d">-                            &quot;g&quot;,
</a><a href="#h132-3-6" id="h132-3-6" class="i">+                            (
</a><a href="#h132-3-7" id="h132-3-7" class="i">+                                Some(
</a><a href="#h132-3-8" id="h132-3-8" class="i">+                                    &quot;g&quot;,
</a><a href="#h132-3-9" id="h132-3-9" class="i">+                                ),
</a><a href="#h132-3-10" id="h132-3-10" class="i">+                                &quot;id&quot;,
</a><a href="#h132-3-11" id="h132-3-11" class="i">+                            ),
</a>                         ),
<a href="#h132-3-13" id="h132-3-13" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Constant(
                         Integer(
<a href="#h132-4" id="h132-4" class="h">@@ -156,16 +167,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h132-4-3" id="h132-4-3" class="i">+                0,
</a>                 Some(
<a href="#h132-4-5" id="h132-4-5" class="d">-                    &quot;m&quot;,
</a><a href="#h132-4-6" id="h132-4-6" class="i">+                    (
</a><a href="#h132-4-7" id="h132-4-7" class="i">+                        Some(
</a><a href="#h132-4-8" id="h132-4-8" class="i">+                            &quot;m&quot;,
</a><a href="#h132-4-9" id="h132-4-9" class="i">+                        ),
</a><a href="#h132-4-10" id="h132-4-10" class="i">+                        &quot;id&quot;,
</a><a href="#h132-4-11" id="h132-4-11" class="i">+                    ),
</a>                 ),
<a href="#h132-4-13" id="h132-4-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h132-4-16" id="h132-4-16" class="i">+                7,
</a>                 Some(
<a href="#h132-4-18" id="h132-4-18" class="d">-                    &quot;g&quot;,
</a><a href="#h132-4-19" id="h132-4-19" class="i">+                    (
</a><a href="#h132-4-20" id="h132-4-20" class="i">+                        Some(
</a><a href="#h132-4-21" id="h132-4-21" class="i">+                            &quot;g&quot;,
</a><a href="#h132-4-22" id="h132-4-22" class="i">+                        ),
</a><a href="#h132-4-23" id="h132-4-23" class="i">+                        &quot;id&quot;,
</a><a href="#h132-4-24" id="h132-4-24" class="i">+                    ),
</a>                 ),
<a href="#h132-4-26" id="h132-4-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h132-5" id="h132-5" class="h">@@ -176,16 +197,12 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h132-5-3" id="h132-5-3" class="d">-                alias: Some(
</a><a href="#h132-5-4" id="h132-5-4" class="d">-                    &quot;m&quot;,
</a><a href="#h132-5-5" id="h132-5-5" class="d">-                ),
</a><a href="#h132-5-6" id="h132-5-6" class="i">+                label: &quot;m&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h132-5-11" id="h132-5-11" class="d">-                alias: Some(
</a><a href="#h132-5-12" id="h132-5-12" class="d">-                    &quot;g&quot;,
</a><a href="#h132-5-13" id="h132-5-13" class="d">-                ),
</a><a href="#h132-5-14" id="h132-5-14" class="i">+                label: &quot;g&quot;,
</a>                 filter: None,
             },
             predicate: Some(
<a href="#h132-6" id="h132-6" class="h">@@ -193,10 +210,15 @@ Optimized plan: Plan(
</a>                     Or(
                         GreaterThan(
                             Field(
<a href="#h132-6-3" id="h132-6-3" class="i">+                                0,
</a>                                 Some(
<a href="#h132-6-5" id="h132-6-5" class="d">-                                    &quot;m&quot;,
</a><a href="#h132-6-6" id="h132-6-6" class="i">+                                    (
</a><a href="#h132-6-7" id="h132-6-7" class="i">+                                        Some(
</a><a href="#h132-6-8" id="h132-6-8" class="i">+                                            &quot;m&quot;,
</a><a href="#h132-6-9" id="h132-6-9" class="i">+                                        ),
</a><a href="#h132-6-10" id="h132-6-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h132-6-11" id="h132-6-11" class="i">+                                    ),
</a>                                 ),
<a href="#h132-6-13" id="h132-6-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h132-7" id="h132-7" class="h">@@ -206,10 +228,15 @@ Optimized plan: Plan(
</a>                         ),
                         Equal(
                             Field(
<a href="#h132-7-3" id="h132-7-3" class="i">+                                0,
</a>                                 Some(
<a href="#h132-7-5" id="h132-7-5" class="d">-                                    &quot;m&quot;,
</a><a href="#h132-7-6" id="h132-7-6" class="i">+                                    (
</a><a href="#h132-7-7" id="h132-7-7" class="i">+                                        Some(
</a><a href="#h132-7-8" id="h132-7-8" class="i">+                                            &quot;m&quot;,
</a><a href="#h132-7-9" id="h132-7-9" class="i">+                                        ),
</a><a href="#h132-7-10" id="h132-7-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h132-7-11" id="h132-7-11" class="i">+                                    ),
</a>                                 ),
<a href="#h132-7-13" id="h132-7-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h132-8" id="h132-8" class="h">@@ -220,10 +247,15 @@ Optimized plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h132-8-3" id="h132-8-3" class="i">+                            7,
</a>                             Some(
<a href="#h132-8-5" id="h132-8-5" class="d">-                                &quot;g&quot;,
</a><a href="#h132-8-6" id="h132-8-6" class="i">+                                (
</a><a href="#h132-8-7" id="h132-8-7" class="i">+                                    Some(
</a><a href="#h132-8-8" id="h132-8-8" class="i">+                                        &quot;g&quot;,
</a><a href="#h132-8-9" id="h132-8-9" class="i">+                                    ),
</a><a href="#h132-8-10" id="h132-8-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h132-8-11" id="h132-8-11" class="i">+                                ),
</a>                             ),
<a href="#h132-8-13" id="h132-8-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h132-9" id="h132-9" class="h">@@ -242,16 +274,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h132-9-3" id="h132-9-3" class="i">+                0,
</a>                 Some(
<a href="#h132-9-5" id="h132-9-5" class="d">-                    &quot;m&quot;,
</a><a href="#h132-9-6" id="h132-9-6" class="i">+                    (
</a><a href="#h132-9-7" id="h132-9-7" class="i">+                        Some(
</a><a href="#h132-9-8" id="h132-9-8" class="i">+                            &quot;m&quot;,
</a><a href="#h132-9-9" id="h132-9-9" class="i">+                        ),
</a><a href="#h132-9-10" id="h132-9-10" class="i">+                        &quot;id&quot;,
</a><a href="#h132-9-11" id="h132-9-11" class="i">+                    ),
</a>                 ),
<a href="#h132-9-13" id="h132-9-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h132-9-16" id="h132-9-16" class="i">+                7,
</a>                 Some(
<a href="#h132-9-18" id="h132-9-18" class="d">-                    &quot;g&quot;,
</a><a href="#h132-9-19" id="h132-9-19" class="i">+                    (
</a><a href="#h132-9-20" id="h132-9-20" class="i">+                        Some(
</a><a href="#h132-9-21" id="h132-9-21" class="i">+                            &quot;g&quot;,
</a><a href="#h132-9-22" id="h132-9-22" class="i">+                        ),
</a><a href="#h132-9-23" id="h132-9-23" class="i">+                        &quot;id&quot;,
</a><a href="#h132-9-24" id="h132-9-24" class="i">+                    ),
</a>                 ),
<a href="#h132-9-26" id="h132-9-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h133" href="../file/tests/sql/query/where_field_ambiguous.html">tests/sql/query/where_field_ambiguous</a> b/<a href="../file/tests/sql/query/where_field_ambiguous.html">tests/sql/query/where_field_ambiguous</a></b>
<a href="#h133-0" id="h133-0" class="h">@@ -59,133 +59,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h133-0-3" id="h133-0-3" class="d">-Plan: Plan(
</a><a href="#h133-0-4" id="h133-0-4" class="d">-    Projection {
</a><a href="#h133-0-5" id="h133-0-5" class="d">-        source: Filter {
</a><a href="#h133-0-6" id="h133-0-6" class="d">-            source: NestedLoopJoin {
</a><a href="#h133-0-7" id="h133-0-7" class="d">-                outer: Scan {
</a><a href="#h133-0-8" id="h133-0-8" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h133-0-9" id="h133-0-9" class="d">-                    alias: None,
</a><a href="#h133-0-10" id="h133-0-10" class="d">-                    filter: None,
</a><a href="#h133-0-11" id="h133-0-11" class="d">-                },
</a><a href="#h133-0-12" id="h133-0-12" class="d">-                inner: Scan {
</a><a href="#h133-0-13" id="h133-0-13" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h133-0-14" id="h133-0-14" class="d">-                    alias: None,
</a><a href="#h133-0-15" id="h133-0-15" class="d">-                    filter: None,
</a><a href="#h133-0-16" id="h133-0-16" class="d">-                },
</a><a href="#h133-0-17" id="h133-0-17" class="d">-                predicate: None,
</a><a href="#h133-0-18" id="h133-0-18" class="d">-                pad: false,
</a><a href="#h133-0-19" id="h133-0-19" class="d">-                flip: false,
</a><a href="#h133-0-20" id="h133-0-20" class="d">-            },
</a><a href="#h133-0-21" id="h133-0-21" class="d">-            predicate: Or(
</a><a href="#h133-0-22" id="h133-0-22" class="d">-                GreaterThan(
</a><a href="#h133-0-23" id="h133-0-23" class="d">-                    Field(
</a><a href="#h133-0-24" id="h133-0-24" class="d">-                        None,
</a><a href="#h133-0-25" id="h133-0-25" class="d">-                        &quot;id&quot;,
</a><a href="#h133-0-26" id="h133-0-26" class="d">-                    ),
</a><a href="#h133-0-27" id="h133-0-27" class="d">-                    Constant(
</a><a href="#h133-0-28" id="h133-0-28" class="d">-                        Integer(
</a><a href="#h133-0-29" id="h133-0-29" class="d">-                            3,
</a><a href="#h133-0-30" id="h133-0-30" class="d">-                        ),
</a><a href="#h133-0-31" id="h133-0-31" class="d">-                    ),
</a><a href="#h133-0-32" id="h133-0-32" class="d">-                ),
</a><a href="#h133-0-33" id="h133-0-33" class="d">-                Equal(
</a><a href="#h133-0-34" id="h133-0-34" class="d">-                    Field(
</a><a href="#h133-0-35" id="h133-0-35" class="d">-                        None,
</a><a href="#h133-0-36" id="h133-0-36" class="d">-                        &quot;id&quot;,
</a><a href="#h133-0-37" id="h133-0-37" class="d">-                    ),
</a><a href="#h133-0-38" id="h133-0-38" class="d">-                    Constant(
</a><a href="#h133-0-39" id="h133-0-39" class="d">-                        Integer(
</a><a href="#h133-0-40" id="h133-0-40" class="d">-                            3,
</a><a href="#h133-0-41" id="h133-0-41" class="d">-                        ),
</a><a href="#h133-0-42" id="h133-0-42" class="d">-                    ),
</a><a href="#h133-0-43" id="h133-0-43" class="d">-                ),
</a><a href="#h133-0-44" id="h133-0-44" class="d">-            ),
</a><a href="#h133-0-45" id="h133-0-45" class="d">-        },
</a><a href="#h133-0-46" id="h133-0-46" class="d">-        labels: [
</a><a href="#h133-0-47" id="h133-0-47" class="d">-            None,
</a><a href="#h133-0-48" id="h133-0-48" class="d">-            None,
</a><a href="#h133-0-49" id="h133-0-49" class="d">-        ],
</a><a href="#h133-0-50" id="h133-0-50" class="d">-        expressions: [
</a><a href="#h133-0-51" id="h133-0-51" class="d">-            Field(
</a><a href="#h133-0-52" id="h133-0-52" class="d">-                Some(
</a><a href="#h133-0-53" id="h133-0-53" class="d">-                    &quot;movies&quot;,
</a><a href="#h133-0-54" id="h133-0-54" class="d">-                ),
</a><a href="#h133-0-55" id="h133-0-55" class="d">-                &quot;id&quot;,
</a><a href="#h133-0-56" id="h133-0-56" class="d">-            ),
</a><a href="#h133-0-57" id="h133-0-57" class="d">-            Field(
</a><a href="#h133-0-58" id="h133-0-58" class="d">-                Some(
</a><a href="#h133-0-59" id="h133-0-59" class="d">-                    &quot;genres&quot;,
</a><a href="#h133-0-60" id="h133-0-60" class="d">-                ),
</a><a href="#h133-0-61" id="h133-0-61" class="d">-                &quot;id&quot;,
</a><a href="#h133-0-62" id="h133-0-62" class="d">-            ),
</a><a href="#h133-0-63" id="h133-0-63" class="d">-        ],
</a><a href="#h133-0-64" id="h133-0-64" class="d">-    },
</a><a href="#h133-0-65" id="h133-0-65" class="d">-)
</a><a href="#h133-0-66" id="h133-0-66" class="d">-
</a><a href="#h133-0-67" id="h133-0-67" class="d">-Optimized plan: Plan(
</a><a href="#h133-0-68" id="h133-0-68" class="d">-    Projection {
</a><a href="#h133-0-69" id="h133-0-69" class="d">-        source: NestedLoopJoin {
</a><a href="#h133-0-70" id="h133-0-70" class="d">-            outer: Scan {
</a><a href="#h133-0-71" id="h133-0-71" class="d">-                table: &quot;movies&quot;,
</a><a href="#h133-0-72" id="h133-0-72" class="d">-                alias: None,
</a><a href="#h133-0-73" id="h133-0-73" class="d">-                filter: None,
</a><a href="#h133-0-74" id="h133-0-74" class="d">-            },
</a><a href="#h133-0-75" id="h133-0-75" class="d">-            inner: Scan {
</a><a href="#h133-0-76" id="h133-0-76" class="d">-                table: &quot;genres&quot;,
</a><a href="#h133-0-77" id="h133-0-77" class="d">-                alias: None,
</a><a href="#h133-0-78" id="h133-0-78" class="d">-                filter: None,
</a><a href="#h133-0-79" id="h133-0-79" class="d">-            },
</a><a href="#h133-0-80" id="h133-0-80" class="d">-            predicate: Some(
</a><a href="#h133-0-81" id="h133-0-81" class="d">-                Or(
</a><a href="#h133-0-82" id="h133-0-82" class="d">-                    GreaterThan(
</a><a href="#h133-0-83" id="h133-0-83" class="d">-                        Field(
</a><a href="#h133-0-84" id="h133-0-84" class="d">-                            None,
</a><a href="#h133-0-85" id="h133-0-85" class="d">-                            &quot;id&quot;,
</a><a href="#h133-0-86" id="h133-0-86" class="d">-                        ),
</a><a href="#h133-0-87" id="h133-0-87" class="d">-                        Constant(
</a><a href="#h133-0-88" id="h133-0-88" class="d">-                            Integer(
</a><a href="#h133-0-89" id="h133-0-89" class="d">-                                3,
</a><a href="#h133-0-90" id="h133-0-90" class="d">-                            ),
</a><a href="#h133-0-91" id="h133-0-91" class="d">-                        ),
</a><a href="#h133-0-92" id="h133-0-92" class="d">-                    ),
</a><a href="#h133-0-93" id="h133-0-93" class="d">-                    Equal(
</a><a href="#h133-0-94" id="h133-0-94" class="d">-                        Field(
</a><a href="#h133-0-95" id="h133-0-95" class="d">-                            None,
</a><a href="#h133-0-96" id="h133-0-96" class="d">-                            &quot;id&quot;,
</a><a href="#h133-0-97" id="h133-0-97" class="d">-                        ),
</a><a href="#h133-0-98" id="h133-0-98" class="d">-                        Constant(
</a><a href="#h133-0-99" id="h133-0-99" class="d">-                            Integer(
</a><a href="#h133-0-100" id="h133-0-100" class="d">-                                3,
</a><a href="#h133-0-101" id="h133-0-101" class="d">-                            ),
</a><a href="#h133-0-102" id="h133-0-102" class="d">-                        ),
</a><a href="#h133-0-103" id="h133-0-103" class="d">-                    ),
</a><a href="#h133-0-104" id="h133-0-104" class="d">-                ),
</a><a href="#h133-0-105" id="h133-0-105" class="d">-            ),
</a><a href="#h133-0-106" id="h133-0-106" class="d">-            pad: false,
</a><a href="#h133-0-107" id="h133-0-107" class="d">-            flip: false,
</a><a href="#h133-0-108" id="h133-0-108" class="d">-        },
</a><a href="#h133-0-109" id="h133-0-109" class="d">-        labels: [
</a><a href="#h133-0-110" id="h133-0-110" class="d">-            None,
</a><a href="#h133-0-111" id="h133-0-111" class="d">-            None,
</a><a href="#h133-0-112" id="h133-0-112" class="d">-        ],
</a><a href="#h133-0-113" id="h133-0-113" class="d">-        expressions: [
</a><a href="#h133-0-114" id="h133-0-114" class="d">-            Field(
</a><a href="#h133-0-115" id="h133-0-115" class="d">-                Some(
</a><a href="#h133-0-116" id="h133-0-116" class="d">-                    &quot;movies&quot;,
</a><a href="#h133-0-117" id="h133-0-117" class="d">-                ),
</a><a href="#h133-0-118" id="h133-0-118" class="d">-                &quot;id&quot;,
</a><a href="#h133-0-119" id="h133-0-119" class="d">-            ),
</a><a href="#h133-0-120" id="h133-0-120" class="d">-            Field(
</a><a href="#h133-0-121" id="h133-0-121" class="d">-                Some(
</a><a href="#h133-0-122" id="h133-0-122" class="d">-                    &quot;genres&quot;,
</a><a href="#h133-0-123" id="h133-0-123" class="d">-                ),
</a><a href="#h133-0-124" id="h133-0-124" class="d">-                &quot;id&quot;,
</a><a href="#h133-0-125" id="h133-0-125" class="d">-            ),
</a><a href="#h133-0-126" id="h133-0-126" class="d">-        ],
</a><a href="#h133-0-127" id="h133-0-127" class="d">-    },
</a><a href="#h133-0-128" id="h133-0-128" class="d">-)
</a><a href="#h133-0-129" id="h133-0-129" class="d">-
</a><a href="#h133-0-130" id="h133-0-130" class="d">-Query: SELECT movies.id, genres.id FROM movies, genres WHERE id &gt;= 3
</a><a href="#h133-0-131" id="h133-0-131" class="d">-
</a><a href="#h133-0-132" id="h133-0-132" class="d">-Result: Value(&quot;Ambiguous field id&quot;)
</a><a href="#h133-0-133" id="h133-0-133" class="d">-\ No newline at end of file
</a><a href="#h133-0-134" id="h133-0-134" class="i">+Plan: Value(&quot;Ambiguous field id&quot;)
</a><a href="#h133-0-135" id="h133-0-135" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h134" href="../file/tests/sql/query/where_field_qualified.html">tests/sql/query/where_field_qualified</a> b/<a href="../file/tests/sql/query/where_field_qualified.html">tests/sql/query/where_field_qualified</a></b>
<a href="#h134-0" id="h134-0" class="h">@@ -86,12 +86,12 @@ Plan: Plan(
</a>             source: NestedLoopJoin {
                 outer: Scan {
                     table: &quot;movies&quot;,
<a href="#h134-0-3" id="h134-0-3" class="d">-                    alias: None,
</a><a href="#h134-0-4" id="h134-0-4" class="i">+                    label: &quot;movies&quot;,
</a>                     filter: None,
                 },
                 inner: Scan {
                     table: &quot;genres&quot;,
<a href="#h134-0-9" id="h134-0-9" class="d">-                    alias: None,
</a><a href="#h134-0-10" id="h134-0-10" class="i">+                    label: &quot;genres&quot;,
</a>                     filter: None,
                 },
                 predicate: None,
<a href="#h134-1" id="h134-1" class="h">@@ -102,10 +102,15 @@ Plan: Plan(
</a>                 Or(
                     GreaterThan(
                         Field(
<a href="#h134-1-3" id="h134-1-3" class="i">+                            0,
</a>                             Some(
<a href="#h134-1-5" id="h134-1-5" class="d">-                                &quot;movies&quot;,
</a><a href="#h134-1-6" id="h134-1-6" class="i">+                                (
</a><a href="#h134-1-7" id="h134-1-7" class="i">+                                    Some(
</a><a href="#h134-1-8" id="h134-1-8" class="i">+                                        &quot;movies&quot;,
</a><a href="#h134-1-9" id="h134-1-9" class="i">+                                    ),
</a><a href="#h134-1-10" id="h134-1-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h134-1-11" id="h134-1-11" class="i">+                                ),
</a>                             ),
<a href="#h134-1-13" id="h134-1-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h134-2" id="h134-2" class="h">@@ -115,10 +120,15 @@ Plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h134-2-3" id="h134-2-3" class="i">+                            0,
</a>                             Some(
<a href="#h134-2-5" id="h134-2-5" class="d">-                                &quot;movies&quot;,
</a><a href="#h134-2-6" id="h134-2-6" class="i">+                                (
</a><a href="#h134-2-7" id="h134-2-7" class="i">+                                    Some(
</a><a href="#h134-2-8" id="h134-2-8" class="i">+                                        &quot;movies&quot;,
</a><a href="#h134-2-9" id="h134-2-9" class="i">+                                    ),
</a><a href="#h134-2-10" id="h134-2-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h134-2-11" id="h134-2-11" class="i">+                                ),
</a>                             ),
<a href="#h134-2-13" id="h134-2-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h134-3" id="h134-3" class="h">@@ -129,10 +139,15 @@ Plan: Plan(
</a>                 ),
                 Equal(
                     Field(
<a href="#h134-3-3" id="h134-3-3" class="i">+                        7,
</a>                         Some(
<a href="#h134-3-5" id="h134-3-5" class="d">-                            &quot;genres&quot;,
</a><a href="#h134-3-6" id="h134-3-6" class="i">+                            (
</a><a href="#h134-3-7" id="h134-3-7" class="i">+                                Some(
</a><a href="#h134-3-8" id="h134-3-8" class="i">+                                    &quot;genres&quot;,
</a><a href="#h134-3-9" id="h134-3-9" class="i">+                                ),
</a><a href="#h134-3-10" id="h134-3-10" class="i">+                                &quot;id&quot;,
</a><a href="#h134-3-11" id="h134-3-11" class="i">+                            ),
</a>                         ),
<a href="#h134-3-13" id="h134-3-13" class="d">-                        &quot;id&quot;,
</a>                     ),
                     Constant(
                         Integer(
<a href="#h134-4" id="h134-4" class="h">@@ -148,16 +163,26 @@ Plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h134-4-3" id="h134-4-3" class="i">+                0,
</a>                 Some(
<a href="#h134-4-5" id="h134-4-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h134-4-6" id="h134-4-6" class="i">+                    (
</a><a href="#h134-4-7" id="h134-4-7" class="i">+                        Some(
</a><a href="#h134-4-8" id="h134-4-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h134-4-9" id="h134-4-9" class="i">+                        ),
</a><a href="#h134-4-10" id="h134-4-10" class="i">+                        &quot;id&quot;,
</a><a href="#h134-4-11" id="h134-4-11" class="i">+                    ),
</a>                 ),
<a href="#h134-4-13" id="h134-4-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h134-4-16" id="h134-4-16" class="i">+                7,
</a>                 Some(
<a href="#h134-4-18" id="h134-4-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h134-4-19" id="h134-4-19" class="i">+                    (
</a><a href="#h134-4-20" id="h134-4-20" class="i">+                        Some(
</a><a href="#h134-4-21" id="h134-4-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h134-4-22" id="h134-4-22" class="i">+                        ),
</a><a href="#h134-4-23" id="h134-4-23" class="i">+                        &quot;id&quot;,
</a><a href="#h134-4-24" id="h134-4-24" class="i">+                    ),
</a>                 ),
<a href="#h134-4-26" id="h134-4-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<a href="#h134-5" id="h134-5" class="h">@@ -168,12 +193,12 @@ Optimized plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h134-5-3" id="h134-5-3" class="d">-                alias: None,
</a><a href="#h134-5-4" id="h134-5-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h134-5-9" id="h134-5-9" class="d">-                alias: None,
</a><a href="#h134-5-10" id="h134-5-10" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: Some(
<a href="#h134-6" id="h134-6" class="h">@@ -181,10 +206,15 @@ Optimized plan: Plan(
</a>                     Or(
                         GreaterThan(
                             Field(
<a href="#h134-6-3" id="h134-6-3" class="i">+                                0,
</a>                                 Some(
<a href="#h134-6-5" id="h134-6-5" class="d">-                                    &quot;movies&quot;,
</a><a href="#h134-6-6" id="h134-6-6" class="i">+                                    (
</a><a href="#h134-6-7" id="h134-6-7" class="i">+                                        Some(
</a><a href="#h134-6-8" id="h134-6-8" class="i">+                                            &quot;movies&quot;,
</a><a href="#h134-6-9" id="h134-6-9" class="i">+                                        ),
</a><a href="#h134-6-10" id="h134-6-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h134-6-11" id="h134-6-11" class="i">+                                    ),
</a>                                 ),
<a href="#h134-6-13" id="h134-6-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h134-7" id="h134-7" class="h">@@ -194,10 +224,15 @@ Optimized plan: Plan(
</a>                         ),
                         Equal(
                             Field(
<a href="#h134-7-3" id="h134-7-3" class="i">+                                0,
</a>                                 Some(
<a href="#h134-7-5" id="h134-7-5" class="d">-                                    &quot;movies&quot;,
</a><a href="#h134-7-6" id="h134-7-6" class="i">+                                    (
</a><a href="#h134-7-7" id="h134-7-7" class="i">+                                        Some(
</a><a href="#h134-7-8" id="h134-7-8" class="i">+                                            &quot;movies&quot;,
</a><a href="#h134-7-9" id="h134-7-9" class="i">+                                        ),
</a><a href="#h134-7-10" id="h134-7-10" class="i">+                                        &quot;id&quot;,
</a><a href="#h134-7-11" id="h134-7-11" class="i">+                                    ),
</a>                                 ),
<a href="#h134-7-13" id="h134-7-13" class="d">-                                &quot;id&quot;,
</a>                             ),
                             Constant(
                                 Integer(
<a href="#h134-8" id="h134-8" class="h">@@ -208,10 +243,15 @@ Optimized plan: Plan(
</a>                     ),
                     Equal(
                         Field(
<a href="#h134-8-3" id="h134-8-3" class="i">+                            7,
</a>                             Some(
<a href="#h134-8-5" id="h134-8-5" class="d">-                                &quot;genres&quot;,
</a><a href="#h134-8-6" id="h134-8-6" class="i">+                                (
</a><a href="#h134-8-7" id="h134-8-7" class="i">+                                    Some(
</a><a href="#h134-8-8" id="h134-8-8" class="i">+                                        &quot;genres&quot;,
</a><a href="#h134-8-9" id="h134-8-9" class="i">+                                    ),
</a><a href="#h134-8-10" id="h134-8-10" class="i">+                                    &quot;id&quot;,
</a><a href="#h134-8-11" id="h134-8-11" class="i">+                                ),
</a>                             ),
<a href="#h134-8-13" id="h134-8-13" class="d">-                            &quot;id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h134-9" id="h134-9" class="h">@@ -230,16 +270,26 @@ Optimized plan: Plan(
</a>         ],
         expressions: [
             Field(
<a href="#h134-9-3" id="h134-9-3" class="i">+                0,
</a>                 Some(
<a href="#h134-9-5" id="h134-9-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h134-9-6" id="h134-9-6" class="i">+                    (
</a><a href="#h134-9-7" id="h134-9-7" class="i">+                        Some(
</a><a href="#h134-9-8" id="h134-9-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h134-9-9" id="h134-9-9" class="i">+                        ),
</a><a href="#h134-9-10" id="h134-9-10" class="i">+                        &quot;id&quot;,
</a><a href="#h134-9-11" id="h134-9-11" class="i">+                    ),
</a>                 ),
<a href="#h134-9-13" id="h134-9-13" class="d">-                &quot;id&quot;,
</a>             ),
             Field(
<a href="#h134-9-16" id="h134-9-16" class="i">+                7,
</a>                 Some(
<a href="#h134-9-18" id="h134-9-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h134-9-19" id="h134-9-19" class="i">+                    (
</a><a href="#h134-9-20" id="h134-9-20" class="i">+                        Some(
</a><a href="#h134-9-21" id="h134-9-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h134-9-22" id="h134-9-22" class="i">+                        ),
</a><a href="#h134-9-23" id="h134-9-23" class="i">+                        &quot;id&quot;,
</a><a href="#h134-9-24" id="h134-9-24" class="i">+                    ),
</a>                 ),
<a href="#h134-9-26" id="h134-9-26" class="d">-                &quot;id&quot;,
</a>             ),
         ],
     },
<b>diff --git a/<a id="h135" href="../file/tests/sql/query/where_field_unknown.html">tests/sql/query/where_field_unknown</a> b/<a href="../file/tests/sql/query/where_field_unknown.html">tests/sql/query/where_field_unknown</a></b>
<a href="#h135-0" id="h135-0" class="h">@@ -30,33 +30,4 @@ AST: Select {
</a>     offset: None,
 }
 
<a href="#h135-0-3" id="h135-0-3" class="d">-Plan: Plan(
</a><a href="#h135-0-4" id="h135-0-4" class="d">-    Filter {
</a><a href="#h135-0-5" id="h135-0-5" class="d">-        source: Scan {
</a><a href="#h135-0-6" id="h135-0-6" class="d">-            table: &quot;movies&quot;,
</a><a href="#h135-0-7" id="h135-0-7" class="d">-            alias: None,
</a><a href="#h135-0-8" id="h135-0-8" class="d">-            filter: None,
</a><a href="#h135-0-9" id="h135-0-9" class="d">-        },
</a><a href="#h135-0-10" id="h135-0-10" class="d">-        predicate: Field(
</a><a href="#h135-0-11" id="h135-0-11" class="d">-            None,
</a><a href="#h135-0-12" id="h135-0-12" class="d">-            &quot;unknown&quot;,
</a><a href="#h135-0-13" id="h135-0-13" class="d">-        ),
</a><a href="#h135-0-14" id="h135-0-14" class="d">-    },
</a><a href="#h135-0-15" id="h135-0-15" class="d">-)
</a><a href="#h135-0-16" id="h135-0-16" class="d">-
</a><a href="#h135-0-17" id="h135-0-17" class="d">-Optimized plan: Plan(
</a><a href="#h135-0-18" id="h135-0-18" class="d">-    Scan {
</a><a href="#h135-0-19" id="h135-0-19" class="d">-        table: &quot;movies&quot;,
</a><a href="#h135-0-20" id="h135-0-20" class="d">-        alias: None,
</a><a href="#h135-0-21" id="h135-0-21" class="d">-        filter: Some(
</a><a href="#h135-0-22" id="h135-0-22" class="d">-            Field(
</a><a href="#h135-0-23" id="h135-0-23" class="d">-                None,
</a><a href="#h135-0-24" id="h135-0-24" class="d">-                &quot;unknown&quot;,
</a><a href="#h135-0-25" id="h135-0-25" class="d">-            ),
</a><a href="#h135-0-26" id="h135-0-26" class="d">-        ),
</a><a href="#h135-0-27" id="h135-0-27" class="d">-    },
</a><a href="#h135-0-28" id="h135-0-28" class="d">-)
</a><a href="#h135-0-29" id="h135-0-29" class="d">-
</a><a href="#h135-0-30" id="h135-0-30" class="d">-Query: SELECT * FROM movies WHERE unknown
</a><a href="#h135-0-31" id="h135-0-31" class="d">-
</a><a href="#h135-0-32" id="h135-0-32" class="d">-Result: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h135-0-33" id="h135-0-33" class="d">-\ No newline at end of file
</a><a href="#h135-0-34" id="h135-0-34" class="i">+Plan: Value(&quot;Unknown field unknown&quot;)
</a><a href="#h135-0-35" id="h135-0-35" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h136" href="../file/tests/sql/query/where_float.html">tests/sql/query/where_float</a> b/<a href="../file/tests/sql/query/where_float.html">tests/sql/query/where_float</a></b>
<a href="#h136-0" id="h136-0" class="h">@@ -35,7 +35,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h136-0-3" id="h136-0-3" class="d">-            alias: None,
</a><a href="#h136-0-4" id="h136-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h136-1" id="h136-1" class="h">@@ -49,7 +49,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h136-1-3" id="h136-1-3" class="d">-        alias: None,
</a><a href="#h136-1-4" id="h136-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 Float(
<b>diff --git a/<a id="h137" href="../file/tests/sql/query/where_index_lookup.html">tests/sql/query/where_index_lookup</a> b/<a href="../file/tests/sql/query/where_index_lookup.html">tests/sql/query/where_index_lookup</a></b>
<a href="#h137-0" id="h137-0" class="h">@@ -52,13 +52,18 @@ Plan: Plan(
</a>         source: Filter {
             source: Scan {
                 table: &quot;movies&quot;,
<a href="#h137-0-3" id="h137-0-3" class="d">-                alias: None,
</a><a href="#h137-0-4" id="h137-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             predicate: Equal(
                 Field(
<a href="#h137-0-9" id="h137-0-9" class="d">-                    None,
</a><a href="#h137-0-10" id="h137-0-10" class="d">-                    &quot;genre_id&quot;,
</a><a href="#h137-0-11" id="h137-0-11" class="i">+                    3,
</a><a href="#h137-0-12" id="h137-0-12" class="i">+                    Some(
</a><a href="#h137-0-13" id="h137-0-13" class="i">+                        (
</a><a href="#h137-0-14" id="h137-0-14" class="i">+                            None,
</a><a href="#h137-0-15" id="h137-0-15" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h137-0-16" id="h137-0-16" class="i">+                        ),
</a><a href="#h137-0-17" id="h137-0-17" class="i">+                    ),
</a>                 ),
                 Constant(
                     Integer(
<a href="#h137-1" id="h137-1" class="h">@@ -70,8 +75,13 @@ Plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h137-1-3" id="h137-1-3" class="d">-                    None,
</a><a href="#h137-1-4" id="h137-1-4" class="d">-                    &quot;id&quot;,
</a><a href="#h137-1-5" id="h137-1-5" class="i">+                    0,
</a><a href="#h137-1-6" id="h137-1-6" class="i">+                    Some(
</a><a href="#h137-1-7" id="h137-1-7" class="i">+                        (
</a><a href="#h137-1-8" id="h137-1-8" class="i">+                            None,
</a><a href="#h137-1-9" id="h137-1-9" class="i">+                            &quot;id&quot;,
</a><a href="#h137-1-10" id="h137-1-10" class="i">+                        ),
</a><a href="#h137-1-11" id="h137-1-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<a href="#h137-2" id="h137-2" class="h">@@ -94,8 +104,13 @@ Optimized plan: Plan(
</a>         orders: [
             (
                 Field(
<a href="#h137-2-3" id="h137-2-3" class="d">-                    None,
</a><a href="#h137-2-4" id="h137-2-4" class="d">-                    &quot;id&quot;,
</a><a href="#h137-2-5" id="h137-2-5" class="i">+                    0,
</a><a href="#h137-2-6" id="h137-2-6" class="i">+                    Some(
</a><a href="#h137-2-7" id="h137-2-7" class="i">+                        (
</a><a href="#h137-2-8" id="h137-2-8" class="i">+                            None,
</a><a href="#h137-2-9" id="h137-2-9" class="i">+                            &quot;id&quot;,
</a><a href="#h137-2-10" id="h137-2-10" class="i">+                        ),
</a><a href="#h137-2-11" id="h137-2-11" class="i">+                    ),
</a>                 ),
                 Ascending,
             ),
<b>diff --git a/<a id="h138" href="../file/tests/sql/query/where_integer.html">tests/sql/query/where_integer</a> b/<a href="../file/tests/sql/query/where_integer.html">tests/sql/query/where_integer</a></b>
<a href="#h138-0" id="h138-0" class="h">@@ -35,7 +35,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h138-0-3" id="h138-0-3" class="d">-            alias: None,
</a><a href="#h138-0-4" id="h138-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h138-1" id="h138-1" class="h">@@ -49,7 +49,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h138-1-3" id="h138-1-3" class="d">-        alias: None,
</a><a href="#h138-1-4" id="h138-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 Integer(
<b>diff --git a/<a id="h139" href="../file/tests/sql/query/where_join_inner.html">tests/sql/query/where_join_inner</a> b/<a href="../file/tests/sql/query/where_join_inner.html">tests/sql/query/where_join_inner</a></b>
<a href="#h139-0" id="h139-0" class="h">@@ -51,12 +51,12 @@ Plan: Plan(
</a>         source: NestedLoopJoin {
             outer: Scan {
                 table: &quot;movies&quot;,
<a href="#h139-0-3" id="h139-0-3" class="d">-                alias: None,
</a><a href="#h139-0-4" id="h139-0-4" class="i">+                label: &quot;movies&quot;,
</a>                 filter: None,
             },
             inner: Scan {
                 table: &quot;genres&quot;,
<a href="#h139-0-9" id="h139-0-9" class="d">-                alias: None,
</a><a href="#h139-0-10" id="h139-0-10" class="i">+                label: &quot;genres&quot;,
</a>                 filter: None,
             },
             predicate: None,
<a href="#h139-1" id="h139-1" class="h">@@ -65,16 +65,26 @@ Plan: Plan(
</a>         },
         predicate: Equal(
             Field(
<a href="#h139-1-3" id="h139-1-3" class="i">+                3,
</a>                 Some(
<a href="#h139-1-5" id="h139-1-5" class="d">-                    &quot;movies&quot;,
</a><a href="#h139-1-6" id="h139-1-6" class="i">+                    (
</a><a href="#h139-1-7" id="h139-1-7" class="i">+                        Some(
</a><a href="#h139-1-8" id="h139-1-8" class="i">+                            &quot;movies&quot;,
</a><a href="#h139-1-9" id="h139-1-9" class="i">+                        ),
</a><a href="#h139-1-10" id="h139-1-10" class="i">+                        &quot;genre_id&quot;,
</a><a href="#h139-1-11" id="h139-1-11" class="i">+                    ),
</a>                 ),
<a href="#h139-1-13" id="h139-1-13" class="d">-                &quot;genre_id&quot;,
</a>             ),
             Field(
<a href="#h139-1-16" id="h139-1-16" class="i">+                7,
</a>                 Some(
<a href="#h139-1-18" id="h139-1-18" class="d">-                    &quot;genres&quot;,
</a><a href="#h139-1-19" id="h139-1-19" class="i">+                    (
</a><a href="#h139-1-20" id="h139-1-20" class="i">+                        Some(
</a><a href="#h139-1-21" id="h139-1-21" class="i">+                            &quot;genres&quot;,
</a><a href="#h139-1-22" id="h139-1-22" class="i">+                        ),
</a><a href="#h139-1-23" id="h139-1-23" class="i">+                        &quot;id&quot;,
</a><a href="#h139-1-24" id="h139-1-24" class="i">+                    ),
</a>                 ),
<a href="#h139-1-26" id="h139-1-26" class="d">-                &quot;id&quot;,
</a>             ),
         ),
     },
<a href="#h139-2" id="h139-2" class="h">@@ -84,27 +94,37 @@ Optimized plan: Plan(
</a>     NestedLoopJoin {
         outer: Scan {
             table: &quot;movies&quot;,
<a href="#h139-2-3" id="h139-2-3" class="d">-            alias: None,
</a><a href="#h139-2-4" id="h139-2-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         inner: Scan {
             table: &quot;genres&quot;,
<a href="#h139-2-9" id="h139-2-9" class="d">-            alias: None,
</a><a href="#h139-2-10" id="h139-2-10" class="i">+            label: &quot;genres&quot;,
</a>             filter: None,
         },
         predicate: Some(
             Equal(
                 Field(
<a href="#h139-2-16" id="h139-2-16" class="i">+                    3,
</a>                     Some(
<a href="#h139-2-18" id="h139-2-18" class="d">-                        &quot;movies&quot;,
</a><a href="#h139-2-19" id="h139-2-19" class="i">+                        (
</a><a href="#h139-2-20" id="h139-2-20" class="i">+                            Some(
</a><a href="#h139-2-21" id="h139-2-21" class="i">+                                &quot;movies&quot;,
</a><a href="#h139-2-22" id="h139-2-22" class="i">+                            ),
</a><a href="#h139-2-23" id="h139-2-23" class="i">+                            &quot;genre_id&quot;,
</a><a href="#h139-2-24" id="h139-2-24" class="i">+                        ),
</a>                     ),
<a href="#h139-2-26" id="h139-2-26" class="d">-                    &quot;genre_id&quot;,
</a>                 ),
                 Field(
<a href="#h139-2-29" id="h139-2-29" class="i">+                    7,
</a>                     Some(
<a href="#h139-2-31" id="h139-2-31" class="d">-                        &quot;genres&quot;,
</a><a href="#h139-2-32" id="h139-2-32" class="i">+                        (
</a><a href="#h139-2-33" id="h139-2-33" class="i">+                            Some(
</a><a href="#h139-2-34" id="h139-2-34" class="i">+                                &quot;genres&quot;,
</a><a href="#h139-2-35" id="h139-2-35" class="i">+                            ),
</a><a href="#h139-2-36" id="h139-2-36" class="i">+                            &quot;id&quot;,
</a><a href="#h139-2-37" id="h139-2-37" class="i">+                        ),
</a>                     ),
<a href="#h139-2-39" id="h139-2-39" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
         ),
<b>diff --git a/<a id="h140" href="../file/tests/sql/query/where_null.html">tests/sql/query/where_null</a> b/<a href="../file/tests/sql/query/where_null.html">tests/sql/query/where_null</a></b>
<a href="#h140-0" id="h140-0" class="h">@@ -33,7 +33,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h140-0-3" id="h140-0-3" class="d">-            alias: None,
</a><a href="#h140-0-4" id="h140-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h140-1" id="h140-1" class="h">@@ -45,7 +45,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h140-1-3" id="h140-1-3" class="d">-        alias: None,
</a><a href="#h140-1-4" id="h140-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 Null,
<b>diff --git a/<a id="h141" href="../file/tests/sql/query/where_primary_key.html">tests/sql/query/where_primary_key</a> b/<a href="../file/tests/sql/query/where_primary_key.html">tests/sql/query/where_primary_key</a></b>
<a href="#h141-0" id="h141-0" class="h">@@ -43,13 +43,18 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h141-0-3" id="h141-0-3" class="d">-            alias: None,
</a><a href="#h141-0-4" id="h141-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Equal(
             Field(
<a href="#h141-0-9" id="h141-0-9" class="d">-                None,
</a><a href="#h141-0-10" id="h141-0-10" class="d">-                &quot;id&quot;,
</a><a href="#h141-0-11" id="h141-0-11" class="i">+                0,
</a><a href="#h141-0-12" id="h141-0-12" class="i">+                Some(
</a><a href="#h141-0-13" id="h141-0-13" class="i">+                    (
</a><a href="#h141-0-14" id="h141-0-14" class="i">+                        None,
</a><a href="#h141-0-15" id="h141-0-15" class="i">+                        &quot;id&quot;,
</a><a href="#h141-0-16" id="h141-0-16" class="i">+                    ),
</a><a href="#h141-0-17" id="h141-0-17" class="i">+                ),
</a>             ),
             Constant(
                 Integer(
<b>diff --git a/<a id="h142" href="../file/tests/sql/query/where_string.html">tests/sql/query/where_string</a> b/<a href="../file/tests/sql/query/where_string.html">tests/sql/query/where_string</a></b>
<a href="#h142-0" id="h142-0" class="h">@@ -35,7 +35,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h142-0-3" id="h142-0-3" class="d">-            alias: None,
</a><a href="#h142-0-4" id="h142-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h142-1" id="h142-1" class="h">@@ -49,7 +49,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h142-1-3" id="h142-1-3" class="d">-        alias: None,
</a><a href="#h142-1-4" id="h142-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 String(
<b>diff --git a/<a id="h143" href="../file/tests/sql/query/where_true.html">tests/sql/query/where_true</a> b/<a href="../file/tests/sql/query/where_true.html">tests/sql/query/where_true</a></b>
<a href="#h143-0" id="h143-0" class="h">@@ -35,7 +35,7 @@ Plan: Plan(
</a>     Filter {
         source: Scan {
             table: &quot;movies&quot;,
<a href="#h143-0-3" id="h143-0-3" class="d">-            alias: None,
</a><a href="#h143-0-4" id="h143-0-4" class="i">+            label: &quot;movies&quot;,
</a>             filter: None,
         },
         predicate: Constant(
<a href="#h143-1" id="h143-1" class="h">@@ -49,7 +49,7 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Scan {
         table: &quot;movies&quot;,
<a href="#h143-1-3" id="h143-1-3" class="d">-        alias: None,
</a><a href="#h143-1-4" id="h143-1-4" class="i">+        label: &quot;movies&quot;,
</a>         filter: Some(
             Constant(
                 Boolean(
<b>diff --git a/<a id="h144" href="../file/tests/tests.rs.html">tests/tests.rs</a> b/<a href="../file/tests/tests.rs.html">tests/tests.rs</a></b>
<a href="#h144-0" id="h144-0" class="h">@@ -6,14 +6,14 @@ mod setup;
</a> mod sql;
 
 use toydb::sql::execution::ResultSet;
<a href="#h144-0-3" id="h144-0-3" class="d">-use toydb::sql::types::{Relation, Row};
</a><a href="#h144-0-4" id="h144-0-4" class="i">+use toydb::sql::types::Row;
</a> 
 use pretty_assertions::assert_eq;
 
 /// Asserts that a resultset contains the expected rows.
 pub fn assert_rows(result: ResultSet, expect: Vec&lt;Row&gt;) {
     match result {
<a href="#h144-0-11" id="h144-0-11" class="d">-        ResultSet::Query { relation: Relation { rows: Some(rows), .. } } =&gt; {
</a><a href="#h144-0-12" id="h144-0-12" class="i">+        ResultSet::Query { rows, .. } =&gt; {
</a>             assert_eq!(rows.collect::&lt;Result&lt;Vec&lt;_&gt;, _&gt;&gt;().unwrap(), expect)
         }
         r =&gt; panic!(&quot;Unexpected result {:?}&quot;, r),
</pre>
</div>
</body>
</html>
