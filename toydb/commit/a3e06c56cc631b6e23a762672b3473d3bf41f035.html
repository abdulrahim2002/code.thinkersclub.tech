<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: use resolved column names when displaying plans - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a3e06c56cc631b6e23a762672b3473d3bf41f035.html">a3e06c56cc631b6e23a762672b3473d3bf41f035</a>
<b>parent</b> <a href="../commit/b123bf0386bd50b666f91706ef44f18114eaf28f.html">b123bf0386bd50b666f91706ef44f18114eaf28f</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Tue, 16 Jul 2024 18:36:35 +0200

sql: use resolved column names when displaying plans

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/sql/planner/planner.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/sql/testscripts/optimizer/fold_constants</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/testscripts/optimizer/index_lookup</a></td><td> | </td><td class="num">82</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/testscripts/optimizer/short_circuit</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/testscripts/queries/aggregate</a></td><td> | </td><td class="num">26</td><td><span class="i">+++++++++++++</span><span class="d">-------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/testscripts/queries/group_by</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/testscripts/queries/having</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/testscripts/queries/order</a></td><td> | </td><td class="num">38</td><td><span class="i">+++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/testscripts/queries/select</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/sql/testscripts/queries/where_</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/sql/testscripts/queries/where_index</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">src/sql/testscripts/queries/where_primary_key</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">src/sql/testscripts/writes/delete_where</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">src/sql/testscripts/writes/update_where</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>14 files changed, 135 insertions(+), 136 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/sql/planner/planner.rs.html">src/sql/planner/planner.rs</a> b/<a href="../file/src/sql/planner/planner.rs.html">src/sql/planner/planner.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -458,9 +458,8 @@ impl&lt;&#39;a, C: Catalog&gt; Planner&lt;&#39;a, C&gt; {
</a>                     return true;
                 };
                 // Add the hidden column to the projection.
<a href="#h0-0-3" id="h0-0-3" class="d">-                let label = Label::maybe_qualified(table.clone(), column.clone());
</a>                 child_scope.add_passthrough(scope, index, true);
<a href="#h0-0-5" id="h0-0-5" class="d">-                hidden.push(Expression::Field(index, label));
</a><a href="#h0-0-6" id="h0-0-6" class="i">+                hidden.push(Expression::Field(index, scope.get_label(index)));
</a>                 true
             });
         }
<a href="#h0-1" id="h0-1" class="h">@@ -490,10 +489,10 @@ impl&lt;&#39;a, C: Catalog&gt; Planner&lt;&#39;a, C&gt; {
</a>                 ast::Literal::Float(f) =&gt; Value::Float(f),
                 ast::Literal::String(s) =&gt; Value::String(s),
             }),
<a href="#h0-1-3" id="h0-1-3" class="d">-            ast::Expression::Field(table, name) =&gt; Field(
</a><a href="#h0-1-4" id="h0-1-4" class="d">-                scope.lookup_column(table.as_deref(), &amp;name)?,
</a><a href="#h0-1-5" id="h0-1-5" class="d">-                Label::maybe_qualified(table, name),
</a><a href="#h0-1-6" id="h0-1-6" class="d">-            ),
</a><a href="#h0-1-7" id="h0-1-7" class="i">+            ast::Expression::Field(table, name) =&gt; {
</a><a href="#h0-1-8" id="h0-1-8" class="i">+                let index = scope.lookup_column(table.as_deref(), &amp;name)?;
</a><a href="#h0-1-9" id="h0-1-9" class="i">+                Field(index, scope.get_label(index))
</a><a href="#h0-1-10" id="h0-1-10" class="i">+            }
</a>             // Currently, all functions are aggregates, and processed above.
             // TODO: consider adding some basic functions for fun.
             ast::Expression::Function(name, _) =&gt; return errinput!(&quot;unknown function {name}&quot;),
<b>diff --git a/<a id="h1" href="../file/src/sql/testscripts/optimizer/fold_constants.html">src/sql/testscripts/optimizer/fold_constants</a> b/<a href="../file/src/sql/testscripts/optimizer/fold_constants.html">src/sql/testscripts/optimizer/fold_constants</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -104,10 +104,10 @@ Initial:
</a> [opt]&gt; SELECT 2*2 + id - 3 * 2 FROM test
 ---
 Initial:
<a href="#h1-0-3" id="h1-0-3" class="d">-   Projection: 2 * 2 + id - 3 * 2
</a><a href="#h1-0-4" id="h1-0-4" class="i">+   Projection: 2 * 2 + test.id - 3 * 2
</a>    └─ Scan: test
 Constant folding:
<a href="#h1-0-7" id="h1-0-7" class="d">-   Projection: 4 + id - 6
</a><a href="#h1-0-8" id="h1-0-8" class="i">+   Projection: 4 + test.id - 6
</a>    └─ Scan: test
 -1
 0
<a href="#h1-1" id="h1-1" class="h">@@ -117,7 +117,7 @@ Constant folding:
</a> [opt]&gt; SELECT * FROM test WHERE 1+1 &gt; 1 OR id &gt; 1
 ---
 Initial:
<a href="#h1-1-3" id="h1-1-3" class="d">-   Filter: 1 + 1 &gt; 1 OR id &gt; 1
</a><a href="#h1-1-4" id="h1-1-4" class="i">+   Filter: 1 + 1 &gt; 1 OR test.id &gt; 1
</a>    └─ Scan: test
 Constant folding:
    Filter: TRUE
<a href="#h1-2" id="h1-2" class="h">@@ -133,33 +133,33 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM test WHERE 1+1 &lt; 1 OR id &gt; 1
 ---
 Initial:
<a href="#h1-2-3" id="h1-2-3" class="d">-   Filter: 1 + 1 &lt; 1 OR id &gt; 1
</a><a href="#h1-2-4" id="h1-2-4" class="i">+   Filter: 1 + 1 &lt; 1 OR test.id &gt; 1
</a>    └─ Scan: test
 Constant folding:
<a href="#h1-2-7" id="h1-2-7" class="d">-   Filter: id &gt; 1
</a><a href="#h1-2-8" id="h1-2-8" class="i">+   Filter: test.id &gt; 1
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h1-2-11" id="h1-2-11" class="d">-   Scan: test (id &gt; 1)
</a><a href="#h1-2-12" id="h1-2-12" class="i">+   Scan: test (test.id &gt; 1)
</a> 2, b
 3, c
 
 [opt]&gt; SELECT * FROM test WHERE 1+1 &gt; 1 AND id &gt; 1
 ---
 Initial:
<a href="#h1-2-19" id="h1-2-19" class="d">-   Filter: 1 + 1 &gt; 1 AND id &gt; 1
</a><a href="#h1-2-20" id="h1-2-20" class="i">+   Filter: 1 + 1 &gt; 1 AND test.id &gt; 1
</a>    └─ Scan: test
 Constant folding:
<a href="#h1-2-23" id="h1-2-23" class="d">-   Filter: id &gt; 1
</a><a href="#h1-2-24" id="h1-2-24" class="i">+   Filter: test.id &gt; 1
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h1-2-27" id="h1-2-27" class="d">-   Scan: test (id &gt; 1)
</a><a href="#h1-2-28" id="h1-2-28" class="i">+   Scan: test (test.id &gt; 1)
</a> 2, b
 3, c
 
 [opt]&gt; SELECT * FROM test WHERE 1+1 &lt; 1 AND id &gt; 1
 ---
 Initial:
<a href="#h1-2-35" id="h1-2-35" class="d">-   Filter: 1 + 1 &lt; 1 AND id &gt; 1
</a><a href="#h1-2-36" id="h1-2-36" class="i">+   Filter: 1 + 1 &lt; 1 AND test.id &gt; 1
</a>    └─ Scan: test
 Constant folding:
    Filter: FALSE
<b>diff --git a/<a id="h2" href="../file/src/sql/testscripts/optimizer/index_lookup.html">src/sql/testscripts/optimizer/index_lookup</a> b/<a href="../file/src/sql/testscripts/optimizer/index_lookup.html">src/sql/testscripts/optimizer/index_lookup</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -12,10 +12,10 @@ ok
</a> [opt]&gt; SELECT * FROM test WHERE id = 2
 ---
 Initial:
<a href="#h2-0-3" id="h2-0-3" class="d">-   Filter: id = 2
</a><a href="#h2-0-4" id="h2-0-4" class="i">+   Filter: test.id = 2
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-0-7" id="h2-0-7" class="d">-   Scan: test (id = 2)
</a><a href="#h2-0-8" id="h2-0-8" class="i">+   Scan: test (test.id = 2)
</a> Index lookup:
    KeyLookup: test (2)
 2, b, NaN
<a href="#h2-1" id="h2-1" class="h">@@ -23,10 +23,10 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE id = 1 OR id = 3
 ---
 Initial:
<a href="#h2-1-3" id="h2-1-3" class="d">-   Filter: id = 1 OR id = 3
</a><a href="#h2-1-4" id="h2-1-4" class="i">+   Filter: test.id = 1 OR test.id = 3
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-1-7" id="h2-1-7" class="d">-   Scan: test (id = 1 OR id = 3)
</a><a href="#h2-1-8" id="h2-1-8" class="i">+   Scan: test (test.id = 1 OR test.id = 3)
</a> Index lookup:
    KeyLookup: test (1, 3)
 1, a, 3.14
<a href="#h2-2" id="h2-2" class="h">@@ -36,22 +36,22 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE (id = 1 OR id = 3) AND value &gt; &#39;a&#39;
 ---
 Initial:
<a href="#h2-2-3" id="h2-2-3" class="d">-   Filter: id = 1 OR id = 3 AND value &gt; a
</a><a href="#h2-2-4" id="h2-2-4" class="i">+   Filter: test.id = 1 OR test.id = 3 AND test.value &gt; a
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-2-7" id="h2-2-7" class="d">-   Scan: test (id = 1 OR id = 3 AND value &gt; a)
</a><a href="#h2-2-8" id="h2-2-8" class="i">+   Scan: test (test.id = 1 OR test.id = 3 AND test.value &gt; a)
</a> Index lookup:
<a href="#h2-2-10" id="h2-2-10" class="d">-   Filter: value &gt; a
</a><a href="#h2-2-11" id="h2-2-11" class="i">+   Filter: test.value &gt; a
</a>    └─ KeyLookup: test (1, 3)
 3, c, 0
 
 [opt]&gt; SELECT * FROM test WHERE id = 1 OR id = 3 OR value &gt; &#39;a&#39;
 ---
 Initial:
<a href="#h2-2-18" id="h2-2-18" class="d">-   Filter: id = 1 OR id = 3 OR value &gt; a
</a><a href="#h2-2-19" id="h2-2-19" class="i">+   Filter: test.id = 1 OR test.id = 3 OR test.value &gt; a
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-2-22" id="h2-2-22" class="d">-   Scan: test (id = 1 OR id = 3 OR value &gt; a)
</a><a href="#h2-2-23" id="h2-2-23" class="i">+   Scan: test (test.id = 1 OR test.id = 3 OR test.value &gt; a)
</a> 1, a, 3.14
 2, b, NaN
 3, c, 0
<a href="#h2-3" id="h2-3" class="h">@@ -60,10 +60,10 @@ Filter pushdown:
</a> [opt]&gt; SELECT * FROM test WHERE value = &#39;b&#39;
 ---
 Initial:
<a href="#h2-3-3" id="h2-3-3" class="d">-   Filter: value = b
</a><a href="#h2-3-4" id="h2-3-4" class="i">+   Filter: test.value = b
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-3-7" id="h2-3-7" class="d">-   Scan: test (value = b)
</a><a href="#h2-3-8" id="h2-3-8" class="i">+   Scan: test (test.value = b)
</a> Index lookup:
    IndexLookup: test.value (b)
 2, b, NaN
<a href="#h2-4" id="h2-4" class="h">@@ -71,10 +71,10 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE value = &#39;a&#39; OR value = &#39;c&#39;
 ---
 Initial:
<a href="#h2-4-3" id="h2-4-3" class="d">-   Filter: value = a OR value = c
</a><a href="#h2-4-4" id="h2-4-4" class="i">+   Filter: test.value = a OR test.value = c
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-4-7" id="h2-4-7" class="d">-   Scan: test (value = a OR value = c)
</a><a href="#h2-4-8" id="h2-4-8" class="i">+   Scan: test (test.value = a OR test.value = c)
</a> Index lookup:
    IndexLookup: test.value (a, c)
 1, a, 3.14
<a href="#h2-5" id="h2-5" class="h">@@ -83,22 +83,22 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE (value = &#39;a&#39; OR value = &#39;c&#39;) AND id &gt; 1
 ---
 Initial:
<a href="#h2-5-3" id="h2-5-3" class="d">-   Filter: value = a OR value = c AND id &gt; 1
</a><a href="#h2-5-4" id="h2-5-4" class="i">+   Filter: test.value = a OR test.value = c AND test.id &gt; 1
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-5-7" id="h2-5-7" class="d">-   Scan: test (value = a OR value = c AND id &gt; 1)
</a><a href="#h2-5-8" id="h2-5-8" class="i">+   Scan: test (test.value = a OR test.value = c AND test.id &gt; 1)
</a> Index lookup:
<a href="#h2-5-10" id="h2-5-10" class="d">-   Filter: id &gt; 1
</a><a href="#h2-5-11" id="h2-5-11" class="i">+   Filter: test.id &gt; 1
</a>    └─ IndexLookup: test.value (a, c)
 3, c, 0
 
 [opt]&gt; SELECT * FROM test WHERE value = &#39;a&#39; OR value = &#39;c&#39; OR id &gt; 1
 ---
 Initial:
<a href="#h2-5-18" id="h2-5-18" class="d">-   Filter: value = a OR value = c OR id &gt; 1
</a><a href="#h2-5-19" id="h2-5-19" class="i">+   Filter: test.value = a OR test.value = c OR test.id &gt; 1
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-5-22" id="h2-5-22" class="d">-   Scan: test (value = a OR value = c OR id &gt; 1)
</a><a href="#h2-5-23" id="h2-5-23" class="i">+   Scan: test (test.value = a OR test.value = c OR test.id &gt; 1)
</a> 1, a, 3.14
 2, b, NaN
 3, c, 0
<a href="#h2-6" id="h2-6" class="h">@@ -108,10 +108,10 @@ Filter pushdown:
</a> [opt]&gt; SELECT * FROM test WHERE value IS NULL
 ---
 Initial:
<a href="#h2-6-3" id="h2-6-3" class="d">-   Filter: value IS NULL
</a><a href="#h2-6-4" id="h2-6-4" class="i">+   Filter: test.value IS NULL
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-6-7" id="h2-6-7" class="d">-   Scan: test (value IS NULL)
</a><a href="#h2-6-8" id="h2-6-8" class="i">+   Scan: test (test.value IS NULL)
</a> Index lookup:
    IndexLookup: test.value (NULL)
 0, NULL, NULL
<a href="#h2-7" id="h2-7" class="h">@@ -119,10 +119,10 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE value = NULL
 ---
 Initial:
<a href="#h2-7-3" id="h2-7-3" class="d">-   Filter: value = NULL
</a><a href="#h2-7-4" id="h2-7-4" class="i">+   Filter: test.value = NULL
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-7-7" id="h2-7-7" class="d">-   Scan: test (value = NULL)
</a><a href="#h2-7-8" id="h2-7-8" class="i">+   Scan: test (test.value = NULL)
</a> Index lookup:
    IndexLookup: test.value (0 values)
 Short circuit:
<a href="#h2-8" id="h2-8" class="h">@@ -131,18 +131,18 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM test WHERE value != NULL
 ---
 Initial:
<a href="#h2-8-3" id="h2-8-3" class="d">-   Filter: NOT value = NULL
</a><a href="#h2-8-4" id="h2-8-4" class="i">+   Filter: NOT test.value = NULL
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-8-7" id="h2-8-7" class="d">-   Scan: test (NOT value = NULL)
</a><a href="#h2-8-8" id="h2-8-8" class="i">+   Scan: test (NOT test.value = NULL)
</a> 
 [opt]&gt; SELECT * FROM test WHERE value IS NOT NULL
 ---
 Initial:
<a href="#h2-8-13" id="h2-8-13" class="d">-   Filter: NOT value IS NULL
</a><a href="#h2-8-14" id="h2-8-14" class="i">+   Filter: NOT test.value IS NULL
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-8-17" id="h2-8-17" class="d">-   Scan: test (NOT value IS NULL)
</a><a href="#h2-8-18" id="h2-8-18" class="i">+   Scan: test (NOT test.value IS NULL)
</a> 1, a, 3.14
 2, b, NaN
 3, c, 0
<a href="#h2-9" id="h2-9" class="h">@@ -151,10 +151,10 @@ Filter pushdown:
</a> [opt]&gt; SELECT * FROM test WHERE &quot;float&quot; IS NAN
 ---
 Initial:
<a href="#h2-9-3" id="h2-9-3" class="d">-   Filter: float IS NAN
</a><a href="#h2-9-4" id="h2-9-4" class="i">+   Filter: test.float IS NAN
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-9-7" id="h2-9-7" class="d">-   Scan: test (float IS NAN)
</a><a href="#h2-9-8" id="h2-9-8" class="i">+   Scan: test (test.float IS NAN)
</a> Index lookup:
    IndexLookup: test.float (NaN)
 2, b, NaN
<a href="#h2-10" id="h2-10" class="h">@@ -162,10 +162,10 @@ Index lookup:
</a> [opt]&gt; SELECT * FROM test WHERE &quot;float&quot; = NAN
 ---
 Initial:
<a href="#h2-10-3" id="h2-10-3" class="d">-   Filter: float = NaN
</a><a href="#h2-10-4" id="h2-10-4" class="i">+   Filter: test.float = NaN
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-10-7" id="h2-10-7" class="d">-   Scan: test (float = NaN)
</a><a href="#h2-10-8" id="h2-10-8" class="i">+   Scan: test (test.float = NaN)
</a> Index lookup:
    IndexLookup: test.float (0 values)
 Short circuit:
<a href="#h2-11" id="h2-11" class="h">@@ -174,13 +174,13 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM test WHERE &quot;float&quot; = -NAN
 ---
 Initial:
<a href="#h2-11-3" id="h2-11-3" class="d">-   Filter: float = -NaN
</a><a href="#h2-11-4" id="h2-11-4" class="i">+   Filter: test.float = -NaN
</a>    └─ Scan: test
 Constant folding:
<a href="#h2-11-7" id="h2-11-7" class="d">-   Filter: float = NaN
</a><a href="#h2-11-8" id="h2-11-8" class="i">+   Filter: test.float = NaN
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-11-11" id="h2-11-11" class="d">-   Scan: test (float = NaN)
</a><a href="#h2-11-12" id="h2-11-12" class="i">+   Scan: test (test.float = NaN)
</a> Index lookup:
    IndexLookup: test.float (0 values)
 Short circuit:
<a href="#h2-12" id="h2-12" class="h">@@ -191,10 +191,10 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM test WHERE &quot;float&quot; != NAN
 ---
 Initial:
<a href="#h2-12-3" id="h2-12-3" class="d">-   Filter: NOT float = NaN
</a><a href="#h2-12-4" id="h2-12-4" class="i">+   Filter: NOT test.float = NaN
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-12-7" id="h2-12-7" class="d">-   Scan: test (NOT float = NaN)
</a><a href="#h2-12-8" id="h2-12-8" class="i">+   Scan: test (NOT test.float = NaN)
</a> 1, a, 3.14
 2, b, NaN
 3, c, 0
<a href="#h2-13" id="h2-13" class="h">@@ -202,10 +202,10 @@ Filter pushdown:
</a> [opt]&gt; SELECT * FROM test WHERE &quot;float&quot; IS NOT NAN
 ---
 Initial:
<a href="#h2-13-3" id="h2-13-3" class="d">-   Filter: NOT float IS NAN
</a><a href="#h2-13-4" id="h2-13-4" class="i">+   Filter: NOT test.float IS NAN
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h2-13-7" id="h2-13-7" class="d">-   Scan: test (NOT float IS NAN)
</a><a href="#h2-13-8" id="h2-13-8" class="i">+   Scan: test (NOT test.float IS NAN)
</a> 1, a, 3.14
 3, c, 0
 
<a href="#h2-14" id="h2-14" class="h">@@ -213,14 +213,14 @@ Filter pushdown:
</a> [opt]&gt; SELECT * FROM test JOIN other ON other.test_id = test.id WHERE test_id = 1 OR test_id = 3
 ---
 Initial:
<a href="#h2-14-3" id="h2-14-3" class="d">-   Filter: test_id = 1 OR test_id = 3
</a><a href="#h2-14-4" id="h2-14-4" class="i">+   Filter: other.test_id = 1 OR other.test_id = 3
</a>    └─ NestedLoopJoin: inner on other.test_id = test.id
       ├─ Scan: test
       └─ Scan: other
 Filter pushdown:
    NestedLoopJoin: inner on other.test_id = test.id
    ├─ Scan: test (test.id = 1 OR test.id = 3)
<a href="#h2-14-11" id="h2-14-11" class="d">-   └─ Scan: other (test_id = 1 OR test_id = 3)
</a><a href="#h2-14-12" id="h2-14-12" class="i">+   └─ Scan: other (other.test_id = 1 OR other.test_id = 3)
</a> Index lookup:
    NestedLoopJoin: inner on other.test_id = test.id
    ├─ KeyLookup: test (1, 3)
<a href="#h2-15" id="h2-15" class="h">@@ -236,13 +236,13 @@ Join type:
</a> [opt]&gt; SELECT * FROM test JOIN other ON other.test_id = test.id AND (test_id = 1 OR test_id = 3)
 ---
 Initial:
<a href="#h2-15-3" id="h2-15-3" class="d">-   NestedLoopJoin: inner on other.test_id = test.id AND test_id = 1 OR test_id = 3
</a><a href="#h2-15-4" id="h2-15-4" class="i">+   NestedLoopJoin: inner on other.test_id = test.id AND other.test_id = 1 OR other.test_id = 3
</a>    ├─ Scan: test
    └─ Scan: other
 Filter pushdown:
    NestedLoopJoin: inner on other.test_id = test.id
    ├─ Scan: test (test.id = 1 OR test.id = 3)
<a href="#h2-15-10" id="h2-15-10" class="d">-   └─ Scan: other (test_id = 1 OR test_id = 3)
</a><a href="#h2-15-11" id="h2-15-11" class="i">+   └─ Scan: other (other.test_id = 1 OR other.test_id = 3)
</a> Index lookup:
    NestedLoopJoin: inner on other.test_id = test.id
    ├─ KeyLookup: test (1, 3)
<b>diff --git a/<a id="h3" href="../file/src/sql/testscripts/optimizer/short_circuit.html">src/sql/testscripts/optimizer/short_circuit</a> b/<a href="../file/src/sql/testscripts/optimizer/short_circuit.html">src/sql/testscripts/optimizer/short_circuit</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -134,10 +134,10 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM test WHERE id = NULL
 ---
 Initial:
<a href="#h3-0-3" id="h3-0-3" class="d">-   Filter: id = NULL
</a><a href="#h3-0-4" id="h3-0-4" class="i">+   Filter: test.id = NULL
</a>    └─ Scan: test
 Filter pushdown:
<a href="#h3-0-7" id="h3-0-7" class="d">-   Scan: test (id = NULL)
</a><a href="#h3-0-8" id="h3-0-8" class="i">+   Scan: test (test.id = NULL)
</a> Index lookup:
    KeyLookup: test (0 keys)
 Short circuit:
<a href="#h3-1" id="h3-1" class="h">@@ -146,10 +146,10 @@ Short circuit:
</a> [opt]&gt; SELECT * FROM ref WHERE test_id = NULL
 ---
 Initial:
<a href="#h3-1-3" id="h3-1-3" class="d">-   Filter: test_id = NULL
</a><a href="#h3-1-4" id="h3-1-4" class="i">+   Filter: ref.test_id = NULL
</a>    └─ Scan: ref
 Filter pushdown:
<a href="#h3-1-7" id="h3-1-7" class="d">-   Scan: ref (test_id = NULL)
</a><a href="#h3-1-8" id="h3-1-8" class="i">+   Scan: ref (ref.test_id = NULL)
</a> Index lookup:
    IndexLookup: ref.test_id (0 values)
 Short circuit:
<a href="#h3-2" id="h3-2" class="h">@@ -169,7 +169,7 @@ Short circuit:
</a> [opt]&gt; SELECT id, value FROM test
 ---
 Initial:
<a href="#h3-2-3" id="h3-2-3" class="d">-   Projection: id, value
</a><a href="#h3-2-4" id="h3-2-4" class="i">+   Projection: test.id, test.value
</a>    └─ Scan: test
 Short circuit:
    Scan: test
<a href="#h3-3" id="h3-3" class="h">@@ -180,7 +180,7 @@ Short circuit:
</a> [opt,header]&gt; SELECT id AS foo, value AS bar FROM test
 ---
 Initial:
<a href="#h3-3-3" id="h3-3-3" class="d">-   Projection: id as foo, value as bar
</a><a href="#h3-3-4" id="h3-3-4" class="i">+   Projection: test.id as foo, test.value as bar
</a>    └─ Scan: test
 Short circuit:
    Scan: test
<a href="#h3-4" id="h3-4" class="h">@@ -193,10 +193,10 @@ foo, bar
</a> ---
 Initial:
    Projection: test.id, #1, #2
<a href="#h3-4-3" id="h3-4-3" class="d">-   └─ Aggregate: group(id), min(id), max(id)
</a><a href="#h3-4-4" id="h3-4-4" class="i">+   └─ Aggregate: group(test.id), min(test.id), max(test.id)
</a>       └─ Scan: test
 Short circuit:
<a href="#h3-4-7" id="h3-4-7" class="d">-   Aggregate: group(id), min(id), max(id)
</a><a href="#h3-4-8" id="h3-4-8" class="i">+   Aggregate: group(test.id), min(test.id), max(test.id)
</a>    └─ Scan: test
 1, 1, 1
 2, 2, 2
<b>diff --git a/<a id="h4" href="../file/src/sql/testscripts/queries/aggregate.html">src/sql/testscripts/queries/aggregate</a> b/<a href="../file/src/sql/testscripts/queries/aggregate.html">src/sql/testscripts/queries/aggregate</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -34,14 +34,14 @@ Aggregate: count(NULL), count(TRUE), count(1), count(3.14), count(NaN), count()
</a> # COUNT works on no rows.
 [plan]&gt; SELECT COUNT(id), COUNT(&quot;bool&quot;), COUNT(&quot;float&quot;), COUNT(&quot;string&quot;) FROM test WHERE false
 ---
<a href="#h4-0-3" id="h4-0-3" class="d">-Aggregate: count(id), count(bool), count(float), count(string)
</a><a href="#h4-0-4" id="h4-0-4" class="i">+Aggregate: count(test.id), count(test.bool), count(test.float), count(test.string)
</a> └─ Nothing
 0, 0, 0, 0
 
 # COUNT returns number of non-NULL values.
 [plan,header]&gt; SELECT COUNT(id), COUNT(&quot;bool&quot;), COUNT(&quot;float&quot;), COUNT(&quot;string&quot;) FROM test
 ---
<a href="#h4-0-11" id="h4-0-11" class="d">-Aggregate: count(id), count(bool), count(float), count(string)
</a><a href="#h4-0-12" id="h4-0-12" class="i">+Aggregate: count(test.id), count(test.bool), count(test.float), count(test.string)
</a> └─ Scan: test
 , , , 
 6, 3, 5, 4
<a href="#h4-1" id="h4-1" class="h">@@ -56,14 +56,14 @@ NULL, TRUE, 1, 3.14, NaN, foo
</a> # MAX works on no rows.
 [plan]&gt; SELECT MAX(id), MAX(&quot;bool&quot;), MAX(&quot;float&quot;), MAX(&quot;string&quot;) FROM test WHERE false
 ---
<a href="#h4-1-3" id="h4-1-3" class="d">-Aggregate: max(id), max(bool), max(float), max(string)
</a><a href="#h4-1-4" id="h4-1-4" class="i">+Aggregate: max(test.id), max(test.bool), max(test.float), max(test.string)
</a> └─ Nothing
 NULL, NULL, NULL, NULL
 
 # MAX returns the max value, or NULL if any value is NULL.
 [plan]&gt; SELECT MAX(id) FROM test
 ---
<a href="#h4-1-11" id="h4-1-11" class="d">-Aggregate: max(id)
</a><a href="#h4-1-12" id="h4-1-12" class="i">+Aggregate: max(test.id)
</a> └─ Scan: test
 5
 
<a href="#h4-2" id="h4-2" class="h">@@ -95,14 +95,14 @@ NULL, TRUE, 1, 3.14, NaN, foo
</a> # MIN works on no rows.
 [plan]&gt; SELECT MIN(id), MIN(&quot;bool&quot;), MIN(&quot;float&quot;), MIN(&quot;string&quot;) FROM test WHERE false
 ---
<a href="#h4-2-3" id="h4-2-3" class="d">-Aggregate: min(id), min(bool), min(float), min(string)
</a><a href="#h4-2-4" id="h4-2-4" class="i">+Aggregate: min(test.id), min(test.bool), min(test.float), min(test.string)
</a> └─ Nothing
 NULL, NULL, NULL, NULL
 
 # MIN returns the min value, or NULL if any value is NULL.
 [plan]&gt; SELECT MIN(id) FROM test
 ---
<a href="#h4-2-11" id="h4-2-11" class="d">-Aggregate: min(id)
</a><a href="#h4-2-12" id="h4-2-12" class="i">+Aggregate: min(test.id)
</a> └─ Scan: test
 0
 
<a href="#h4-3" id="h4-3" class="h">@@ -138,7 +138,7 @@ Error: invalid input: can&#39;t add 0 and foo
</a> # SUM works on no rows.
 [plan]&gt; SELECT SUM(id), SUM(&quot;bool&quot;), SUM(&quot;float&quot;), SUM(&quot;string&quot;) FROM test WHERE false
 ---
<a href="#h4-3-3" id="h4-3-3" class="d">-Aggregate: sum(id), sum(bool), sum(float), sum(string)
</a><a href="#h4-3-4" id="h4-3-4" class="i">+Aggregate: sum(test.id), sum(test.bool), sum(test.float), sum(test.string)
</a> └─ Nothing
 NULL, NULL, NULL, NULL
 
<a href="#h4-4" id="h4-4" class="h">@@ -146,7 +146,7 @@ NULL, NULL, NULL, NULL
</a> # on booleans or strings.
 [plan]&gt; SELECT SUM(id) FROM test
 ---
<a href="#h4-4-3" id="h4-4-3" class="d">-Aggregate: sum(id)
</a><a href="#h4-4-4" id="h4-4-4" class="i">+Aggregate: sum(test.id)
</a> └─ Scan: test
 15
 
<a href="#h4-5" id="h4-5" class="h">@@ -184,7 +184,7 @@ Error: invalid input: can&#39;t add 0 and foo
</a> # AVG works on no rows.
 [plan]&gt; SELECT AVG(id), AVG(&quot;bool&quot;), AVG(&quot;float&quot;), AVG(&quot;string&quot;) FROM test WHERE false
 ---
<a href="#h4-5-3" id="h4-5-3" class="d">-Aggregate: avg(id), avg(bool), avg(float), avg(string)
</a><a href="#h4-5-4" id="h4-5-4" class="i">+Aggregate: avg(test.id), avg(test.bool), avg(test.float), avg(test.string)
</a> └─ Nothing
 NULL, NULL, NULL, NULL
 
<a href="#h4-6" id="h4-6" class="h">@@ -192,7 +192,7 @@ NULL, NULL, NULL, NULL
</a> # on booleans or strings.
 [plan]&gt; SELECT AVG(id) FROM test
 ---
<a href="#h4-6-3" id="h4-6-3" class="d">-Aggregate: avg(id)
</a><a href="#h4-6-4" id="h4-6-4" class="i">+Aggregate: avg(test.id)
</a> └─ Scan: test
 2
 
<a href="#h4-7" id="h4-7" class="h">@@ -232,7 +232,7 @@ Error: invalid input: field id must be used in an aggregate or GROUP BY expressi
</a> [plan]&gt; SELECT MAX(&quot;int&quot;), MAX(&quot;int&quot;), MAX(&quot;int&quot;) FROM test
 ---
 Projection: #0, #0, #0
<a href="#h4-7-3" id="h4-7-3" class="d">-└─ Aggregate: max(int)
</a><a href="#h4-7-4" id="h4-7-4" class="i">+└─ Aggregate: max(test.int)
</a>    └─ Scan: test
 42, 42, 42
 
<a href="#h4-8" id="h4-8" class="h">@@ -240,8 +240,8 @@ Projection: #0, #0, #0
</a> [plan]&gt; SELECT SUM(&quot;int&quot; * 10) / COUNT(&quot;int&quot;) + 7 FROM test WHERE &quot;int&quot; IS NOT NULL
 ---
 Projection: #0 / #1 + 7
<a href="#h4-8-3" id="h4-8-3" class="d">-└─ Aggregate: sum(int * 10), count(int)
</a><a href="#h4-8-4" id="h4-8-4" class="d">-   └─ Scan: test (NOT int IS NULL)
</a><a href="#h4-8-5" id="h4-8-5" class="i">+└─ Aggregate: sum(test.int * 10), count(test.int)
</a><a href="#h4-8-6" id="h4-8-6" class="i">+   └─ Scan: test (NOT test.int IS NULL)
</a> 117
 
 # Aggregate functions can&#39;t be nested.
<b>diff --git a/<a id="h5" href="../file/src/sql/testscripts/queries/group_by.html">src/sql/testscripts/queries/group_by</a> b/<a href="../file/src/sql/testscripts/queries/group_by.html">src/sql/testscripts/queries/group_by</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -25,13 +25,13 @@ ok
</a> [plan]&gt; SELECT COUNT(id), MIN(id), MAX(id), SUM(id), AVG(id) FROM test WHERE FALSE GROUP BY id
 ---
 Projection: #1, #2, #3, #4, #5
<a href="#h5-0-3" id="h5-0-3" class="d">-└─ Aggregate: group(id), count(id), min(id), max(id), sum(id), avg(id)
</a><a href="#h5-0-4" id="h5-0-4" class="i">+└─ Aggregate: group(test.id), count(test.id), min(test.id), max(test.id), sum(test.id), avg(test.id)
</a>    └─ Nothing
 
 # Simple GROUP BY, including NULL group.
 [plan]&gt; SELECT &quot;group&quot;, COUNT(*) FROM test GROUP BY &quot;group&quot;
 ---
<a href="#h5-0-10" id="h5-0-10" class="d">-Aggregate: group(group), count(TRUE)
</a><a href="#h5-0-11" id="h5-0-11" class="i">+Aggregate: group(test.group), count(TRUE)
</a> └─ Scan: test
 NULL, 1
 a, 3
<a href="#h5-1" id="h5-1" class="h">@@ -40,7 +40,7 @@ b, 3
</a> [plan]&gt; SELECT &quot;group&quot;, COUNT(*), MIN(&quot;bool&quot;), MAX(&quot;string&quot;), SUM(&quot;int&quot;), AVG(&quot;float&quot;) \
     FROM test GROUP BY &quot;group&quot;
 ---
<a href="#h5-1-3" id="h5-1-3" class="d">-Aggregate: group(group), count(TRUE), min(bool), max(string), sum(int), avg(float)
</a><a href="#h5-1-4" id="h5-1-4" class="i">+Aggregate: group(test.group), count(TRUE), min(test.bool), max(test.string), sum(test.int), avg(test.float)
</a> └─ Scan: test
 NULL, 1, NULL, NULL, NULL, NULL
 a, 3, FALSE, AB, 9, NaN
<a href="#h5-2" id="h5-2" class="h">@@ -49,7 +49,7 @@ b, 3, FALSE, 👋, 41, NaN
</a> # GROUP BY works on booleans.
 [plan]&gt; SELECT &quot;bool&quot;, COUNT(*) FROM test GROUP BY &quot;bool&quot;
 ---
<a href="#h5-2-3" id="h5-2-3" class="d">-Aggregate: group(bool), count(TRUE)
</a><a href="#h5-2-4" id="h5-2-4" class="i">+Aggregate: group(test.bool), count(TRUE)
</a> └─ Scan: test
 NULL, 1
 FALSE, 3
<a href="#h5-3" id="h5-3" class="h">@@ -58,7 +58,7 @@ TRUE, 3
</a> # GROUP BY works on integers.
 [plan]&gt; SELECT &quot;int&quot;, COUNT(*) FROM test GROUP BY &quot;int&quot;
 ---
<a href="#h5-3-3" id="h5-3-3" class="d">-Aggregate: group(int), count(TRUE)
</a><a href="#h5-3-4" id="h5-3-4" class="i">+Aggregate: group(test.int), count(TRUE)
</a> └─ Scan: test
 NULL, 1
 -1, 2
<a href="#h5-4" id="h5-4" class="h">@@ -70,7 +70,7 @@ NULL, 1
</a> # GROUP BY works with floats, including a NAN group and -0.0 and 0.0 being equal.
 [plan]&gt; SELECT &quot;float&quot;, COUNT(*) FROM test GROUP BY &quot;float&quot;
 ---
<a href="#h5-4-3" id="h5-4-3" class="d">-Aggregate: group(float), count(TRUE)
</a><a href="#h5-4-4" id="h5-4-4" class="i">+Aggregate: group(test.float), count(TRUE)
</a> └─ Scan: test
 NULL, 1
 0, 2
<a href="#h5-5" id="h5-5" class="h">@@ -81,7 +81,7 @@ NaN, 2
</a> # GROUP BY works on strings.
 [plan]&gt; SELECT &quot;string&quot;, COUNT(*) FROM test GROUP BY &quot;string&quot;
 ---
<a href="#h5-5-3" id="h5-5-3" class="d">-Aggregate: group(string), count(TRUE)
</a><a href="#h5-5-4" id="h5-5-4" class="i">+Aggregate: group(test.string), count(TRUE)
</a> └─ Scan: test
 NULL, 1
 , 2
<a href="#h5-6" id="h5-6" class="h">@@ -93,7 +93,7 @@ abc, 2
</a> [plan]&gt; SELECT COUNT(*) FROM test GROUP BY &quot;group&quot;
 ---
 Projection: #1
<a href="#h5-6-3" id="h5-6-3" class="d">-└─ Aggregate: group(group), count(TRUE)
</a><a href="#h5-6-4" id="h5-6-4" class="i">+└─ Aggregate: group(test.group), count(TRUE)
</a>    └─ Scan: test
 1
 3
<a href="#h5-7" id="h5-7" class="h">@@ -102,7 +102,7 @@ Projection: #1
</a> # GROUP BY works when there is no aggregate function.
 [plan]&gt; SELECT &quot;group&quot; FROM test GROUP BY &quot;group&quot;
 ---
<a href="#h5-7-3" id="h5-7-3" class="d">-Aggregate: group(group)
</a><a href="#h5-7-4" id="h5-7-4" class="i">+Aggregate: group(test.group)
</a> └─ Scan: test
 NULL
 a
<a href="#h5-8" id="h5-8" class="h">@@ -148,7 +148,7 @@ Projection: #1
</a> [plan]&gt; SELECT COUNT(*) FROM test GROUP BY id % 2
 ---
 Projection: #1
<a href="#h5-8-3" id="h5-8-3" class="d">-└─ Aggregate: group(id % 2), count(TRUE)
</a><a href="#h5-8-4" id="h5-8-4" class="i">+└─ Aggregate: group(test.id % 2), count(TRUE)
</a>    └─ Scan: test
 4
 3
<a href="#h5-9" id="h5-9" class="h">@@ -156,7 +156,7 @@ Projection: #1
</a> # GROUP BY can use an expression also used in the SELECT.
 [plan]&gt; SELECT id % 2, COUNT(*) FROM test GROUP BY id % 2
 ---
<a href="#h5-9-3" id="h5-9-3" class="d">-Aggregate: group(id % 2), count(TRUE)
</a><a href="#h5-9-4" id="h5-9-4" class="i">+Aggregate: group(test.id % 2), count(TRUE)
</a> └─ Scan: test
 0, 4
 1, 3
<a href="#h5-10" id="h5-10" class="h">@@ -165,7 +165,7 @@ Aggregate: group(id % 2), count(TRUE)
</a> [plan]&gt; SELECT MAX(&quot;int&quot;) + id % 2 FROM test GROUP BY id
 ---
 Projection: #1 + test.id % 2
<a href="#h5-10-3" id="h5-10-3" class="d">-└─ Aggregate: group(id), max(int)
</a><a href="#h5-10-4" id="h5-10-4" class="i">+└─ Aggregate: group(test.id), max(test.int)
</a>    └─ Scan: test
 NULL
 0
<a href="#h5-11" id="h5-11" class="h">@@ -188,7 +188,7 @@ Error: invalid input: unknown function min
</a> # GROUP BY works with multiple groups.
 [plan]&gt; SELECT &quot;group&quot;, &quot;bool&quot;, COUNT(*) FROM test GROUP BY &quot;group&quot;, &quot;bool&quot;
 ---
<a href="#h5-11-3" id="h5-11-3" class="d">-Aggregate: group(group), group(bool), count(TRUE)
</a><a href="#h5-11-4" id="h5-11-4" class="i">+Aggregate: group(test.group), group(test.bool), count(TRUE)
</a> └─ Scan: test
 NULL, NULL, 1
 a, FALSE, 1
<a href="#h5-12" id="h5-12" class="h">@@ -200,7 +200,7 @@ b, TRUE, 1
</a> [plan]&gt; SELECT &quot;group&quot;, &quot;group&quot;, &quot;group&quot;, COUNT(*) FROM test GROUP BY &quot;group&quot;, &quot;group&quot;
 ---
 Projection: test.group, test.group, test.group, #1
<a href="#h5-12-3" id="h5-12-3" class="d">-└─ Aggregate: group(group), count(TRUE)
</a><a href="#h5-12-4" id="h5-12-4" class="i">+└─ Aggregate: group(test.group), count(TRUE)
</a>    └─ Scan: test
 NULL, NULL, NULL, 1
 a, a, a, 3
<a href="#h5-13" id="h5-13" class="h">@@ -222,7 +222,7 @@ Error: invalid input: field test.group must be used in an aggregate or GROUP BY 
</a> 
 [plan]&gt; SELECT * FROM test GROUP BY id, &quot;group&quot;, &quot;bool&quot;, &quot;int&quot;, &quot;float&quot;, &quot;string&quot;
 ---
<a href="#h5-13-3" id="h5-13-3" class="d">-Aggregate: group(id), group(group), group(bool), group(int), group(float), group(string)
</a><a href="#h5-13-4" id="h5-13-4" class="i">+Aggregate: group(test.id), group(test.group), group(test.bool), group(test.int), group(test.float), group(test.string)
</a> └─ Scan: test
 0, NULL, NULL, NULL, NULL, NULL
 1, a, TRUE, -1, 3.14, 
<a href="#h5-14" id="h5-14" class="h">@@ -235,7 +235,7 @@ Aggregate: group(id), group(group), group(bool), group(int), group(float), group
</a> [plan]&gt; SELECT * FROM test GROUP BY &quot;bool&quot;, &quot;int&quot;, &quot;float&quot;, &quot;string&quot;, &quot;group&quot;, id
 ---
 Projection: test.id, test.group, test.bool, test.int, test.float, test.string
<a href="#h5-14-3" id="h5-14-3" class="d">-└─ Aggregate: group(bool), group(int), group(float), group(string), group(group), group(id)
</a><a href="#h5-14-4" id="h5-14-4" class="i">+└─ Aggregate: group(test.bool), group(test.int), group(test.float), group(test.string), group(test.group), group(test.id)
</a>    └─ Scan: test
 0, NULL, NULL, NULL, NULL, NULL
 6, b, FALSE, -1, 0, abc
<b>diff --git a/<a id="h6" href="../file/src/sql/testscripts/queries/having.html">src/sql/testscripts/queries/having</a> b/<a href="../file/src/sql/testscripts/queries/having.html">src/sql/testscripts/queries/having</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -40,7 +40,7 @@ TRUE
</a> [plan]&gt; SELECT &quot;group&quot;, MAX(&quot;int&quot;) FROM test GROUP BY &quot;group&quot; HAVING MAX(&quot;int&quot;) &gt; 10
 ---
 Filter: #1 &gt; 10
<a href="#h6-0-3" id="h6-0-3" class="d">-└─ Aggregate: group(group), max(int)
</a><a href="#h6-0-4" id="h6-0-4" class="i">+└─ Aggregate: group(test.group), max(test.int)
</a>    └─ Scan: test
 b, 42
 
<a href="#h6-1" id="h6-1" class="h">@@ -48,7 +48,7 @@ b, 42
</a> ---
 Remap: #0 (dropped: #1)
 └─ Filter: #1 &gt; 10
<a href="#h6-1-3" id="h6-1-3" class="d">-   └─ Aggregate: group(group), max(int)
</a><a href="#h6-1-4" id="h6-1-4" class="i">+   └─ Aggregate: group(test.group), max(test.int)
</a>       └─ Scan: test
 b
 
<a href="#h6-2" id="h6-2" class="h">@@ -56,7 +56,7 @@ b
</a> ---
 Remap: #0, #1 (dropped: #2)
 └─ Filter: #1 - #2 &gt; 10
<a href="#h6-2-3" id="h6-2-3" class="d">-   └─ Aggregate: group(group), max(int), min(int)
</a><a href="#h6-2-4" id="h6-2-4" class="i">+   └─ Aggregate: group(test.group), max(test.int), min(test.int)
</a>       └─ Scan: test
 b, 42
 
<a href="#h6-3" id="h6-3" class="h">@@ -64,7 +64,7 @@ b, 42
</a> [plan]&gt; SELECT &quot;group&quot;, MAX(&quot;int&quot;) AS m FROM test GROUP BY &quot;group&quot; HAVING m &gt; 10
 ---
 Filter: m &gt; 10
<a href="#h6-3-3" id="h6-3-3" class="d">-└─ Aggregate: group(group), max(int)
</a><a href="#h6-3-4" id="h6-3-4" class="i">+└─ Aggregate: group(test.group), max(test.int)
</a>    └─ Scan: test
 b, 42
 
<a href="#h6-4" id="h6-4" class="h">@@ -73,7 +73,7 @@ b, 42
</a> ---
 Remap: #0, #1 (dropped: #2)
 └─ Filter: #2 &gt; 10
<a href="#h6-4-3" id="h6-4-3" class="d">-   └─ Aggregate: group(group), count(TRUE), max(int)
</a><a href="#h6-4-4" id="h6-4-4" class="i">+   └─ Aggregate: group(test.group), count(TRUE), max(test.int)
</a>       └─ Scan: test
 b, 3
 
<a href="#h6-5" id="h6-5" class="h">@@ -82,7 +82,7 @@ b, 3
</a> ---
 Remap: #0, #1 (dropped: #2)
 └─ Filter: #2 / #1 &gt; 3
<a href="#h6-5-3" id="h6-5-3" class="d">-   └─ Aggregate: group(group), count(TRUE), max(int)
</a><a href="#h6-5-4" id="h6-5-4" class="i">+   └─ Aggregate: group(test.group), count(TRUE), max(test.int)
</a>       └─ Scan: test
 b, 3
 
<a href="#h6-6" id="h6-6" class="h">@@ -93,7 +93,7 @@ b, 3
</a> Remap: #0 (dropped: #1)
 └─ Filter: 2 - #1 + 1 &gt; 1
    └─ Projection: #1, #0
<a href="#h6-6-3" id="h6-6-3" class="d">-      └─ Aggregate: group(id % 2), count(TRUE)
</a><a href="#h6-6-4" id="h6-6-4" class="i">+      └─ Aggregate: group(test.id % 2), count(TRUE)
</a>          └─ Scan: test
 4
 3
<a href="#h6-7" id="h6-7" class="h">@@ -104,15 +104,15 @@ Remap: #0 (dropped: #1)
</a> Remap: #0 (dropped: #1)
 └─ Filter: test.group = a
    └─ Projection: #1, test.group
<a href="#h6-7-3" id="h6-7-3" class="d">-      └─ Aggregate: group(group), count(TRUE)
</a><a href="#h6-7-4" id="h6-7-4" class="i">+      └─ Aggregate: group(test.group), count(TRUE)
</a>          └─ Scan: test
 3
 
 [plan]&gt; SELECT COUNT(*) FROM test GROUP BY test.&quot;group&quot; HAVING &quot;group&quot; = &#39;a&#39;
 ---
 Remap: #0 (dropped: #1)
<a href="#h6-7-11" id="h6-7-11" class="d">-└─ Filter: group = a
</a><a href="#h6-7-12" id="h6-7-12" class="d">-   └─ Projection: #1, group
</a><a href="#h6-7-13" id="h6-7-13" class="i">+└─ Filter: test.group = a
</a><a href="#h6-7-14" id="h6-7-14" class="i">+   └─ Projection: #1, test.group
</a>       └─ Aggregate: group(test.group), count(TRUE)
          └─ Scan: test
 3
<b>diff --git a/<a id="h7" href="../file/src/sql/testscripts/queries/order.html">src/sql/testscripts/queries/order</a> b/<a href="../file/src/sql/testscripts/queries/order.html">src/sql/testscripts/queries/order</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -43,7 +43,7 @@ Order: value desc
</a> # Order by primary key.
 [plan]&gt; SELECT * FROM test ORDER BY id ASC
 ---
<a href="#h7-0-3" id="h7-0-3" class="d">-Order: id asc
</a><a href="#h7-0-4" id="h7-0-4" class="i">+Order: test.id asc
</a> └─ Scan: test
 0, NULL, NULL, NULL, NULL, 1
 1, TRUE, 0, 3.14, a, 1
<a href="#h7-1" id="h7-1" class="h">@@ -58,7 +58,7 @@ Order: id asc
</a> 
 [plan]&gt; SELECT * FROM test ORDER BY id DESC
 ---
<a href="#h7-1-3" id="h7-1-3" class="d">-Order: id desc
</a><a href="#h7-1-4" id="h7-1-4" class="i">+Order: test.id desc
</a> └─ Scan: test
 9, NULL, NULL, NULL, 👍, 1
 8, NULL, NULL, NULL, B, 1
<a href="#h7-2" id="h7-2" class="h">@@ -240,8 +240,8 @@ Order: id desc
</a> # Can order by expressions.
 [plan]&gt; SELECT id, &quot;float&quot; FROM test ORDER BY &quot;float&quot; ^ 2
 ---
<a href="#h7-2-3" id="h7-2-3" class="d">-Order: float ^ 2 asc
</a><a href="#h7-2-4" id="h7-2-4" class="d">-└─ Projection: id, float
</a><a href="#h7-2-5" id="h7-2-5" class="i">+Order: test.float ^ 2 asc
</a><a href="#h7-2-6" id="h7-2-6" class="i">+└─ Projection: test.id, test.float
</a>    └─ Scan: test
 0, NULL
 8, NULL
<a href="#h7-3" id="h7-3" class="h">@@ -259,8 +259,8 @@ Order: float ^ 2 asc
</a> [plan]&gt; SELECT id, &quot;int&quot; FROM test ORDER BY &quot;bool&quot; DESC
 ---
 Remap: #0, #1 (dropped: #2)
<a href="#h7-3-3" id="h7-3-3" class="d">-└─ Order: bool desc
</a><a href="#h7-3-4" id="h7-3-4" class="d">-   └─ Projection: id, int, bool
</a><a href="#h7-3-5" id="h7-3-5" class="i">+└─ Order: test.bool desc
</a><a href="#h7-3-6" id="h7-3-6" class="i">+   └─ Projection: test.id, test.int, test.bool
</a>       └─ Scan: test
 1, 0
 2, -1
<a href="#h7-4" id="h7-4" class="h">@@ -276,8 +276,8 @@ Remap: #0, #1 (dropped: #2)
</a> [plan]&gt; SELECT id, &quot;int&quot; FROM test ORDER BY &quot;bool&quot; DESC, &quot;bool&quot; ASC
 ---
 Remap: #0, #1 (dropped: #2)
<a href="#h7-4-3" id="h7-4-3" class="d">-└─ Order: bool desc, bool asc
</a><a href="#h7-4-4" id="h7-4-4" class="d">-   └─ Projection: id, int, bool
</a><a href="#h7-4-5" id="h7-4-5" class="i">+└─ Order: test.bool desc, test.bool asc
</a><a href="#h7-4-6" id="h7-4-6" class="i">+   └─ Projection: test.id, test.int, test.bool
</a>       └─ Scan: test
 1, 0
 2, -1
<a href="#h7-5" id="h7-5" class="h">@@ -294,8 +294,8 @@ Remap: #0, #1 (dropped: #2)
</a> [plan]&gt; SELECT id FROM test ORDER BY &quot;float&quot; ^ 2 - &quot;int&quot; ^ 2 DESC
 ---
 Remap: #0 (dropped: #1, #2)
<a href="#h7-5-3" id="h7-5-3" class="d">-└─ Order: float ^ 2 - int ^ 2 desc
</a><a href="#h7-5-4" id="h7-5-4" class="d">-   └─ Projection: id, float, int
</a><a href="#h7-5-5" id="h7-5-5" class="i">+└─ Order: test.float ^ 2 - test.int ^ 2 desc
</a><a href="#h7-5-6" id="h7-5-6" class="i">+   └─ Projection: test.id, test.float, test.int
</a>       └─ Scan: test
 7
 5
<a href="#h7-6" id="h7-6" class="h">@@ -358,7 +358,7 @@ Error: invalid input: ambiguous field foo
</a> [plan]&gt; SELECT id AS &quot;int&quot; FROM test ORDER BY &quot;int&quot; DESC
 ---
 Order: int desc
<a href="#h7-6-3" id="h7-6-3" class="d">-└─ Projection: id as int
</a><a href="#h7-6-4" id="h7-6-4" class="i">+└─ Projection: test.id as int
</a>    └─ Scan: test
 9
 8
<a href="#h7-7" id="h7-7" class="h">@@ -375,7 +375,7 @@ Order: int desc
</a> ---
 Remap: #0 (dropped: #1)
 └─ Order: test.int desc
<a href="#h7-7-3" id="h7-7-3" class="d">-   └─ Projection: id as int, test.int
</a><a href="#h7-7-4" id="h7-7-4" class="i">+   └─ Projection: test.id as int, test.int
</a>       └─ Scan: test
 4
 6
<a href="#h7-8" id="h7-8" class="h">@@ -473,7 +473,7 @@ Order: o.id desc, t.id asc
</a> [plan]&gt; SELECT &quot;bool&quot;, MAX(&quot;int&quot;) FROM test GROUP BY &quot;bool&quot; ORDER BY MAX(&quot;int&quot;) DESC
 ---
 Order: #1 desc
<a href="#h7-8-3" id="h7-8-3" class="d">-└─ Aggregate: group(bool), max(int)
</a><a href="#h7-8-4" id="h7-8-4" class="i">+└─ Aggregate: group(test.bool), max(test.int)
</a>    └─ Scan: test
 NULL, 1000
 TRUE, 0
<a href="#h7-9" id="h7-9" class="h">@@ -483,7 +483,7 @@ FALSE, -1
</a> ---
 Remap: #0 (dropped: #1)
 └─ Order: #1 desc
<a href="#h7-9-3" id="h7-9-3" class="d">-   └─ Aggregate: group(bool), max(int)
</a><a href="#h7-9-4" id="h7-9-4" class="i">+   └─ Aggregate: group(test.bool), max(test.int)
</a>       └─ Scan: test
 NULL
 TRUE
<a href="#h7-10" id="h7-10" class="h">@@ -493,7 +493,7 @@ FALSE
</a> ---
 Remap: #0, #1 (dropped: #2)
 └─ Order: #1 - #2 desc
<a href="#h7-10-3" id="h7-10-3" class="d">-   └─ Aggregate: group(bool), max(int), min(int)
</a><a href="#h7-10-4" id="h7-10-4" class="i">+   └─ Aggregate: group(test.bool), max(test.int), min(test.int)
</a>       └─ Scan: test
 NULL, 1000
 FALSE, -1
<a href="#h7-11" id="h7-11" class="h">@@ -506,7 +506,7 @@ TRUE, 0
</a> Remap: #0 (dropped: #1)
 └─ Order: 2 - #1 + 1 &gt; 1 asc
    └─ Projection: #1, #0
<a href="#h7-11-3" id="h7-11-3" class="d">-      └─ Aggregate: group(id % 2), count(TRUE)
</a><a href="#h7-11-4" id="h7-11-4" class="i">+      └─ Aggregate: group(test.id % 2), count(TRUE)
</a>          └─ Scan: test
 5
 5
<a href="#h7-12" id="h7-12" class="h">@@ -517,7 +517,7 @@ Remap: #0 (dropped: #1)
</a> Remap: #0 (dropped: #1)
 └─ Order: test.bool asc
    └─ Projection: #1, test.bool
<a href="#h7-12-3" id="h7-12-3" class="d">-      └─ Aggregate: group(bool), count(TRUE)
</a><a href="#h7-12-4" id="h7-12-4" class="i">+      └─ Aggregate: group(test.bool), count(TRUE)
</a>          └─ Scan: test
 8
 1
<a href="#h7-13" id="h7-13" class="h">@@ -526,8 +526,8 @@ Remap: #0 (dropped: #1)
</a> [plan]&gt; SELECT COUNT(*) FROM test GROUP BY test.&quot;bool&quot; ORDER BY &quot;bool&quot;
 ---
 Remap: #0 (dropped: #1)
<a href="#h7-13-3" id="h7-13-3" class="d">-└─ Order: bool asc
</a><a href="#h7-13-4" id="h7-13-4" class="d">-   └─ Projection: #1, bool
</a><a href="#h7-13-5" id="h7-13-5" class="i">+└─ Order: test.bool asc
</a><a href="#h7-13-6" id="h7-13-6" class="i">+   └─ Projection: #1, test.bool
</a>       └─ Aggregate: group(test.bool), count(TRUE)
          └─ Scan: test
 8
<b>diff --git a/<a id="h8" href="../file/src/sql/testscripts/queries/select.html">src/sql/testscripts/queries/select</a> b/<a href="../file/src/sql/testscripts/queries/select.html">src/sql/testscripts/queries/select</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -50,7 +50,7 @@ test.id, test.bool, test.float, test.int, test.string
</a> 
 [plan,header]&gt; SELECT &quot;bool&quot; FROM test
 ---
<a href="#h8-0-3" id="h8-0-3" class="d">-Projection: bool
</a><a href="#h8-0-4" id="h8-0-4" class="i">+Projection: test.bool
</a> └─ Scan: test
 test.bool
 TRUE
<a href="#h8-1" id="h8-1" class="h">@@ -67,7 +67,7 @@ Error: invalid input: unexpected end of input
</a> # Mix fields, field expressions, and constant expressions.
 [plan,header]&gt; SELECT id, 7-4, &quot;float&quot;^2 FROM test
 ---
<a href="#h8-1-3" id="h8-1-3" class="d">-Projection: id, 3, float ^ 2
</a><a href="#h8-1-4" id="h8-1-4" class="i">+Projection: test.id, 3, test.float ^ 2
</a> └─ Scan: test
 test.id, , 
 1, 3, 9.8596
<a href="#h8-2" id="h8-2" class="h">@@ -86,7 +86,7 @@ test.id, test.bool
</a> # is optional.
 [header,plan]&gt; SELECT id, t.&quot;bool&quot; FROM test AS t
 ---
<a href="#h8-2-3" id="h8-2-3" class="d">-Projection: id, t.bool
</a><a href="#h8-2-4" id="h8-2-4" class="i">+Projection: t.id, t.bool
</a> └─ Scan: test as t
 t.id, t.bool
 1, TRUE
<b>diff --git a/<a id="h9" href="../file/src/sql/testscripts/queries/where_.html">src/sql/testscripts/queries/where_</a> b/<a href="../file/src/sql/testscripts/queries/where_.html">src/sql/testscripts/queries/where_</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -28,13 +28,13 @@ Nothing
</a> # Field predicate expressions work as expected.
 [plan]&gt; SELECT * FROM test WHERE id &gt; 1
 ---
<a href="#h9-0-3" id="h9-0-3" class="d">-Scan: test (id &gt; 1)
</a><a href="#h9-0-4" id="h9-0-4" class="i">+Scan: test (test.id &gt; 1)
</a> 2, b
 3, c
 
 [plan]&gt; SELECT * FROM test WHERE id &gt; 1 AND value &lt; &#39;c&#39;
 ---
<a href="#h9-0-10" id="h9-0-10" class="d">-Scan: test (id &gt; 1 AND value &lt; c)
</a><a href="#h9-0-11" id="h9-0-11" class="i">+Scan: test (test.id &gt; 1 AND test.value &lt; c)
</a> 2, b
 
 # Errors on non-boolean type.
<b>diff --git a/<a id="h10" href="../file/src/sql/testscripts/queries/where_index.html">src/sql/testscripts/queries/where_index</a> b/<a href="../file/src/sql/testscripts/queries/where_index.html">src/sql/testscripts/queries/where_index</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -122,7 +122,7 @@ IndexLookup: test.string ()
</a> # LIKE does not use an index.
 [plan]&gt; SELECT * FROM test WHERE &quot;string&quot; LIKE &#39;a%&#39;
 ---
<a href="#h10-0-3" id="h10-0-3" class="d">-Scan: test (string LIKE a%)
</a><a href="#h10-0-4" id="h10-0-4" class="i">+Scan: test (test.string LIKE a%)
</a> 1, TRUE, 0, 3.14, abc
 2, FALSE, -1, -2.718, a
 
<a href="#h10-1" id="h10-1" class="h">@@ -150,13 +150,13 @@ IndexLookup: test.int (-1, 0, 1, 7)
</a> # &gt; or &lt; predicates don&#39;t use an index.
 [plan]&gt; SELECT * FROM test WHERE &quot;int&quot; &lt; 1
 ---
<a href="#h10-1-3" id="h10-1-3" class="d">-Scan: test (int &lt; 1)
</a><a href="#h10-1-4" id="h10-1-4" class="i">+Scan: test (test.int &lt; 1)
</a> 1, TRUE, 0, 3.14, abc
 2, FALSE, -1, -2.718, a
 
 [plan]&gt; SELECT * FROM test WHERE &quot;int&quot; &gt; -1
 ---
<a href="#h10-1-10" id="h10-1-10" class="d">-Scan: test (int &gt; -1)
</a><a href="#h10-1-11" id="h10-1-11" class="i">+Scan: test (test.int &gt; -1)
</a> 1, TRUE, 0, 3.14, abc
 3, TRUE, 1, 0, ABC
 4, NULL, 1, 0, 👍
<b>diff --git a/<a id="h11" href="../file/src/sql/testscripts/queries/where_primary_key.html">src/sql/testscripts/queries/where_primary_key</a> b/<a href="../file/src/sql/testscripts/queries/where_primary_key.html">src/sql/testscripts/queries/where_primary_key</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -111,7 +111,7 @@ KeyLookup: string (👍)
</a> # LIKE does not use an index.
 [plan]&gt; SELECT * FROM &quot;string&quot; WHERE id LIKE &#39;a%&#39;
 ---
<a href="#h11-0-3" id="h11-0-3" class="d">-Scan: string (id LIKE a%)
</a><a href="#h11-0-4" id="h11-0-4" class="i">+Scan: string (string.id LIKE a%)
</a> a
 abc
 
<a href="#h11-1" id="h11-1" class="h">@@ -135,12 +135,12 @@ KeyLookup: int (-1, 0, 1, 7)
</a> # &gt; or &lt; predicates don&#39;t use an index.
 [plan]&gt; SELECT * FROM &quot;int&quot; WHERE id &lt; 1
 ---
<a href="#h11-1-3" id="h11-1-3" class="d">-Scan: int (id &lt; 1)
</a><a href="#h11-1-4" id="h11-1-4" class="i">+Scan: int (int.id &lt; 1)
</a> -1
 0
 
 [plan]&gt; SELECT * FROM &quot;int&quot; WHERE id &gt; -1
 ---
<a href="#h11-1-10" id="h11-1-10" class="d">-Scan: int (id &gt; -1)
</a><a href="#h11-1-11" id="h11-1-11" class="i">+Scan: int (int.id &gt; -1)
</a> 0
 1
<b>diff --git a/<a id="h12" href="../file/src/sql/testscripts/writes/delete_where.html">src/sql/testscripts/writes/delete_where</a> b/<a href="../file/src/sql/testscripts/writes/delete_where.html">src/sql/testscripts/writes/delete_where</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -67,7 +67,7 @@ Delete: name
</a> &gt; ROLLBACK
 ---
 Delete: name
<a href="#h12-0-3" id="h12-0-3" class="d">-└─ Scan: name (id &gt; 3 OR id = 3 OR value LIKE a IS NULL)
</a><a href="#h12-0-4" id="h12-0-4" class="i">+└─ Scan: name (name.id &gt; 3 OR name.id = 3 OR name.value LIKE a IS NULL)
</a> 1, a, 1
 2, b, 2
 
<b>diff --git a/<a id="h13" href="../file/src/sql/testscripts/writes/update_where.html">src/sql/testscripts/writes/update_where</a> b/<a href="../file/src/sql/testscripts/writes/update_where.html">src/sql/testscripts/writes/update_where</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -70,7 +70,7 @@ Update: name (value=foo)
</a> &gt; ROLLBACK
 ---
 Update: name (value=foo)
<a href="#h13-0-3" id="h13-0-3" class="d">-└─ Scan: name (id &gt; 3 OR id = 3 OR value LIKE a IS NULL)
</a><a href="#h13-0-4" id="h13-0-4" class="i">+└─ Scan: name (name.id &gt; 3 OR name.id = 3 OR name.value LIKE a IS NULL)
</a> 1, a, 1
 2, b, 2
 3, foo, NULL
</pre>
</div>
</body>
</html>
