<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>raft: remove `Message::Heartbeat.commit_term` - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8f00b7c88398007dbc120c6040cb46d57b459d59.html">8f00b7c88398007dbc120c6040cb46d57b459d59</a>
<b>parent</b> <a href="../commit/f592416872d75930b2ad7e2d1bdd8620172bc744.html">f592416872d75930b2ad7e2d1bdd8620172bc744</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Fri,  7 Jun 2024 15:34:42 +0200

raft: remove `Message::Heartbeat.commit_term`

If `last_index` matches, then `commit_index` does as well.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/raft/log.rs</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/raft/message.rs</a></td><td> | </td><td class="num">12</td><td><span class="i">+++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/raft/node.rs</a></td><td> | </td><td class="num">28</td><td><span class="i">+++++++++++++++</span><span class="d">-------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/raft/testscripts/log/commit</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/raft/testscripts/log/splice</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/raft/testscripts/log/status</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/raft/testscripts/node/append_initial</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/raft/testscripts/node/append_max_entries</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/raft/testscripts/node/election</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/raft/testscripts/node/election_candidate_behind_leader</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/raft/testscripts/node/election_contested</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">src/raft/testscripts/node/election_tie</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">src/raft/testscripts/node/election_tie_even</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">src/raft/testscripts/node/heartbeat_commits_follower</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">src/raft/testscripts/node/heartbeat_converts_candidate</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">src/raft/testscripts/node/heartbeat_converts_follower</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">src/raft/testscripts/node/heartbeat_converts_follower_leaderless</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">src/raft/testscripts/node/heartbeat_converts_leader</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">src/raft/testscripts/node/heartbeat_lost_append_duplicate</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">src/raft/testscripts/node/heartbeat_lost_append_multiple</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">src/raft/testscripts/node/heartbeat_lost_append_single</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">src/raft/testscripts/node/heartbeat_match_commits</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">src/raft/testscripts/node/heartbeat_probe_divergent</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">src/raft/testscripts/node/old_campaign_rejected</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">src/raft/testscripts/node/old_campaign_response_ignored</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">src/raft/testscripts/node/old_heartbeat_ignored</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">src/raft/testscripts/node/request_follower</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">src/raft/testscripts/node/request_follower_disconnect_stall</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">src/raft/testscripts/node/request_leader</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">src/raft/testscripts/node/request_leader_campaign_abort</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">src/raft/testscripts/node/request_leader_change_linearizability</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">src/raft/testscripts/node/request_leader_disconnect</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">src/raft/testscripts/node/request_leader_read_quorum</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">src/raft/testscripts/node/request_leader_read_quorum_sequence</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">src/raft/testscripts/node/tick_follower</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">src/raft/testscripts/node/tick_leader</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
</table></pre><pre>36 files changed, 145 insertions(+), 161 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/raft/log.rs.html">src/raft/log.rs</a> b/<a href="../file/src/raft/log.rs.html">src/raft/log.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -182,15 +182,14 @@ impl Log {
</a>     }
 
     /// Commits entries up to and including the given index. The index must
<a href="#h0-0-3" id="h0-0-3" class="d">-    /// exist, be at or after the current commit index, and have the given term.
</a><a href="#h0-0-4" id="h0-0-4" class="d">-    pub fn commit(&amp;mut self, index: Index, term: Term) -&gt; Result&lt;Index&gt; {
</a><a href="#h0-0-5" id="h0-0-5" class="d">-        match self.get(index)? {
</a><a href="#h0-0-6" id="h0-0-6" class="i">+    /// exist and be at or after the current commit index.
</a><a href="#h0-0-7" id="h0-0-7" class="i">+    pub fn commit(&amp;mut self, index: Index) -&gt; Result&lt;Index&gt; {
</a><a href="#h0-0-8" id="h0-0-8" class="i">+        let term = match self.get(index)? {
</a>             Some(e) if e.index &lt; self.commit_index =&gt; {
                 return errassert!(&quot;commit index regression {} → {}&quot;, self.commit_index, e.index);
             }
<a href="#h0-0-12" id="h0-0-12" class="d">-            Some(e) if e.term != term =&gt; return errassert!(&quot;commit term {term} != {}&quot;, e.term),
</a>             Some(e) if e.index == self.commit_index =&gt; return Ok(index),
<a href="#h0-0-14" id="h0-0-14" class="d">-            Some(_) =&gt; {}
</a><a href="#h0-0-15" id="h0-0-15" class="i">+            Some(e) =&gt; e.term,
</a>             None =&gt; return errassert!(&quot;commit index {index} does not exist&quot;),
         };
         self.engine.set(&amp;Key::CommitIndex.encode()?, bincode::serialize(&amp;(index, term))?)?;
<a href="#h0-1" id="h0-1" class="h">@@ -352,15 +351,13 @@ mod tests {
</a>                     output.push_str(&amp;format!(&quot;append → {}\n&quot;, Self::format_entry(&amp;entry)));
                 }
 
<a href="#h0-1-3" id="h0-1-3" class="d">-                // commit INDEX@TERM [oplog=BOOL]
</a><a href="#h0-1-4" id="h0-1-4" class="i">+                // commit INDEX [oplog=BOOL]
</a>                 &quot;commit&quot; =&gt; {
                     let mut args = command.consume_args();
<a href="#h0-1-7" id="h0-1-7" class="d">-                    let (index, term) = Self::parse_index_term(
</a><a href="#h0-1-8" id="h0-1-8" class="d">-                        &amp;args.next_pos().ok_or(&quot;index/term not given&quot;)?.value,
</a><a href="#h0-1-9" id="h0-1-9" class="d">-                    )?;
</a><a href="#h0-1-10" id="h0-1-10" class="i">+                    let index = args.next_pos().ok_or(&quot;index not given&quot;)?.parse()?;
</a>                     let oplog = args.lookup_parse(&quot;oplog&quot;)?.unwrap_or(false);
                     args.reject_rest()?;
<a href="#h0-1-13" id="h0-1-13" class="d">-                    let index = self.log.commit(index, term)?;
</a><a href="#h0-1-14" id="h0-1-14" class="i">+                    let index = self.log.commit(index)?;
</a>                     let entry = self.log.get(index)?.expect(&quot;entry not found&quot;);
                     self.maybe_oplog(oplog, &amp;mut output);
                     output.push_str(&amp;format!(&quot;commit → {}\n&quot;, Self::format_entry(&amp;entry)));
<b>diff --git a/<a id="h1" href="../file/src/raft/message.rs.html">src/raft/message.rs</a> b/<a href="../file/src/raft/message.rs.html">src/raft/message.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -43,16 +43,10 @@ pub enum Message {
</a>         /// The index of the leader&#39;s last log entry. The term is the leader&#39;s
         /// current term, since it appends a noop entry on election win.
         last_index: Index,
<a href="#h1-0-3" id="h1-0-3" class="d">-        /// The index of the leader&#39;s last committed log entry.
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        /// The index of the leader&#39;s last committed log entry. It&#39;s only safe
</a><a href="#h1-0-5" id="h1-0-5" class="i">+        /// to commit this if the local log matches last_index, such that the
</a><a href="#h1-0-6" id="h1-0-6" class="i">+        /// follower&#39;s log is identical to the leader at the commit index.
</a>         commit_index: Index,
<a href="#h1-0-8" id="h1-0-8" class="d">-        /// The term of the leader&#39;s last committed log entry.
</a><a href="#h1-0-9" id="h1-0-9" class="d">-        ///
</a><a href="#h1-0-10" id="h1-0-10" class="d">-        /// The Raft paper does not propagate this, because it uses the
</a><a href="#h1-0-11" id="h1-0-11" class="d">-        /// AppendEntries RPC for heartbeats and commit index propagation, which
</a><a href="#h1-0-12" id="h1-0-12" class="d">-        /// includes a base index/term check guaranteeing that the commit index
</a><a href="#h1-0-13" id="h1-0-13" class="d">-        /// is consistent with the leader. We need it to ensure a divergent
</a><a href="#h1-0-14" id="h1-0-14" class="d">-        /// follower doesn&#39;t commit a stale entry from a different term.
</a><a href="#h1-0-15" id="h1-0-15" class="d">-        commit_term: Term,
</a>         /// The leader&#39;s latest read sequence number in this term. Read requests
         /// are served once the sequence number has been confirmed by a quorum.
         read_seq: ReadSequence,
<b>diff --git a/<a id="h2" href="../file/src/raft/node.rs.html">src/raft/node.rs</a> b/<a href="../file/src/raft/node.rs.html">src/raft/node.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -552,7 +552,9 @@ impl RawNode&lt;Follower&gt; {
</a>             // The leader will send periodic heartbeats. If we don&#39;t have a
             // leader in this term yet, follow it. If the commit_index advances,
             // apply state transitions.
<a href="#h2-0-3" id="h2-0-3" class="d">-            Message::Heartbeat { last_index, commit_index, commit_term, read_seq } =&gt; {
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            Message::Heartbeat { last_index, commit_index, read_seq } =&gt; {
</a><a href="#h2-0-5" id="h2-0-5" class="i">+                assert!(commit_index &lt;= last_index, &quot;commit_index after last_index&quot;);
</a><a href="#h2-0-6" id="h2-0-6" class="i">+
</a>                 // Check that the heartbeat is from our leader.
                 match self.role.leader {
                     Some(leader) =&gt; assert_eq!(msg.from, leader, &quot;multiple leaders in term&quot;),
<a href="#h2-1" id="h2-1" class="h">@@ -564,11 +566,12 @@ impl RawNode&lt;Follower&gt; {
</a>                 let match_index = if self.log.has(last_index, msg.term)? { last_index } else { 0 };
                 self.send(msg.from, Message::HeartbeatResponse { match_index, read_seq })?;
 
<a href="#h2-1-3" id="h2-1-3" class="d">-                // Advance commit index and apply entries.
</a><a href="#h2-1-4" id="h2-1-4" class="d">-                if commit_index &gt; self.log.get_commit_index().0
</a><a href="#h2-1-5" id="h2-1-5" class="d">-                    &amp;&amp; self.log.has(commit_index, commit_term)?
</a><a href="#h2-1-6" id="h2-1-6" class="d">-                {
</a><a href="#h2-1-7" id="h2-1-7" class="d">-                    self.log.commit(commit_index, commit_term)?;
</a><a href="#h2-1-8" id="h2-1-8" class="i">+                // Advance commit index and apply entries. We can only do this
</a><a href="#h2-1-9" id="h2-1-9" class="i">+                // if the last_index matches the leader, which implies that
</a><a href="#h2-1-10" id="h2-1-10" class="i">+                // the logs are identical up to match_index. This also implies
</a><a href="#h2-1-11" id="h2-1-11" class="i">+                // that the commit_index is present in our log.
</a><a href="#h2-1-12" id="h2-1-12" class="i">+                if match_index != 0 &amp;&amp; commit_index &gt; self.log.get_commit_index().0 {
</a><a href="#h2-1-13" id="h2-1-13" class="i">+                    self.log.commit(commit_index)?;
</a>                     self.maybe_apply()?;
                 }
             }
<a href="#h2-2" id="h2-2" class="h">@@ -1030,13 +1033,12 @@ impl RawNode&lt;Leader&gt; {
</a>     /// Broadcasts a heartbeat to all peers.
     fn heartbeat(&amp;mut self) -&gt; Result&lt;()&gt; {
         let (last_index, last_term) = self.log.get_last_index();
<a href="#h2-2-3" id="h2-2-3" class="d">-        let (commit_index, commit_term) = self.log.get_commit_index();
</a><a href="#h2-2-4" id="h2-2-4" class="i">+        let (commit_index, _) = self.log.get_commit_index();
</a>         let read_seq = self.role.read_seq;
 
         assert_eq!(last_term, self.term, &quot;leader has stale last_term&quot;);
 
<a href="#h2-2-9" id="h2-2-9" class="d">-        let msg = Message::Heartbeat { last_index, commit_index, commit_term, read_seq };
</a><a href="#h2-2-10" id="h2-2-10" class="d">-        self.broadcast(msg)?;
</a><a href="#h2-2-11" id="h2-2-11" class="i">+        self.broadcast(Message::Heartbeat { last_index, commit_index, read_seq })?;
</a>         // NB: We don&#39;t reset self.since_heartbeat here, because we want to send
         // periodic heartbeats regardless of any on-demand heartbeats.
         Ok(())
<a href="#h2-3" id="h2-3" class="h">@@ -1090,11 +1092,11 @@ impl RawNode&lt;Leader&gt; {
</a>         commit_index = match self.log.get(quorum_index)? {
             Some(entry) if entry.term == self.term =&gt; quorum_index,
             Some(_) =&gt; return Ok(commit_index),
<a href="#h2-3-3" id="h2-3-3" class="d">-            None =&gt; panic!(&quot;Commit index {} missing&quot;, quorum_index),
</a><a href="#h2-3-4" id="h2-3-4" class="i">+            None =&gt; panic!(&quot;missing commit index {quorum_index} missing&quot;),
</a>         };
 
         // Commit the new entries.
<a href="#h2-3-8" id="h2-3-8" class="d">-        self.log.commit(commit_index, self.term)?;
</a><a href="#h2-3-9" id="h2-3-9" class="i">+        self.log.commit(commit_index)?;
</a> 
         // Apply entries and respond to client writers.
         Self::maybe_apply_with(&amp;mut self.log, &amp;mut self.state, |index, result| -&gt; Result&lt;()&gt; {
<a href="#h2-4" id="h2-4" class="h">@@ -1981,8 +1983,8 @@ mod tests {
</a>                 Message::CampaignResponse { vote } =&gt; {
                     format!(&quot;CampaignResponse vote={vote}&quot;)
                 }
<a href="#h2-4-3" id="h2-4-3" class="d">-                Message::Heartbeat { last_index, commit_index, commit_term, read_seq } =&gt; {
</a><a href="#h2-4-4" id="h2-4-4" class="d">-                    format!(&quot;Heartbeat last_index={last_index} commit={commit_index}@{commit_term} read_seq={read_seq}&quot;)
</a><a href="#h2-4-5" id="h2-4-5" class="i">+                Message::Heartbeat { last_index, commit_index, read_seq } =&gt; {
</a><a href="#h2-4-6" id="h2-4-6" class="i">+                    format!(&quot;Heartbeat last_index={last_index} commit_index={commit_index} read_seq={read_seq}&quot;)
</a>                 }
                 Message::HeartbeatResponse { match_index, read_seq } =&gt; {
                     format!(&quot;HeartbeatResponse match_index={match_index} read_seq={read_seq}&quot;)
<b>diff --git a/<a id="h3" href="../file/src/raft/testscripts/log/commit.html">src/raft/testscripts/log/commit</a> b/<a href="../file/src/raft/testscripts/log/commit.html">src/raft/testscripts/log/commit</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,5 +1,5 @@
</a> # Committing fails on an empty engine.
<a href="#h3-0-1" id="h3-0-1" class="d">-!commit 1@1
</a><a href="#h3-0-2" id="h3-0-2" class="i">+!commit 1
</a> ---
 Error: assertion failed: commit index 1 does not exist
 
<a href="#h3-1" id="h3-1" class="h">@@ -9,7 +9,7 @@ splice 1@1= 2@1=foo 3@2=bar
</a> splice → 3@2 bar
 
 # Committing entry 0 fails.
<a href="#h3-1-3" id="h3-1-3" class="d">-!commit 0@0
</a><a href="#h3-1-4" id="h3-1-4" class="i">+!commit 0
</a> ---
 Error: assertion failed: commit index 0 does not exist
 
<a href="#h3-2" id="h3-2" class="h">@@ -17,7 +17,7 @@ Error: assertion failed: commit index 0 does not exist
</a> #
 # Show the engine operations too, and notice that the commit index isn&#39;t flushed
 # to durable storage (it can be recovered from the durable quorum logs).
<a href="#h3-2-3" id="h3-2-3" class="d">-commit 1@1 oplog=true
</a><a href="#h3-2-4" id="h3-2-4" class="i">+commit 1 oplog=true
</a> status
 ---
 engine: set CommitIndex 0x02 = 0x0101
<a href="#h3-3" id="h3-3" class="h">@@ -33,37 +33,28 @@ Entry(3) 0x000000000000000003 = 0x03020103626172
</a> CommitIndex 0x02 = 0x0101
 
 # Commits are idempotent, which doesn&#39;t incur an engine set.
<a href="#h3-3-3" id="h3-3-3" class="d">-commit 1@1 oplog=true
</a><a href="#h3-3-4" id="h3-3-4" class="i">+commit 1 oplog=true
</a> status
 ---
 commit → 1@1 None
 last=3@2 commit=1@1
 
<a href="#h3-3-10" id="h3-3-10" class="d">-# Commit term conflicts error, both for the current and next index.
</a><a href="#h3-3-11" id="h3-3-11" class="d">-!commit 1@2
</a><a href="#h3-3-12" id="h3-3-12" class="d">-!commit 2@2
</a><a href="#h3-3-13" id="h3-3-13" class="d">-status
</a><a href="#h3-3-14" id="h3-3-14" class="d">----
</a><a href="#h3-3-15" id="h3-3-15" class="d">-Error: assertion failed: commit term 2 != 1
</a><a href="#h3-3-16" id="h3-3-16" class="d">-Error: assertion failed: commit term 2 != 1
</a><a href="#h3-3-17" id="h3-3-17" class="d">-last=3@2 commit=1@1
</a><a href="#h3-3-18" id="h3-3-18" class="d">-
</a> # Commits can skip an entry.
<a href="#h3-3-20" id="h3-3-20" class="d">-commit 3@2
</a><a href="#h3-3-21" id="h3-3-21" class="i">+commit 3
</a> status
 ---
 commit → 3@2 bar
 last=3@2 commit=3@2
 
 # Commit regressions error.
<a href="#h3-3-28" id="h3-3-28" class="d">-!commit 2@1
</a><a href="#h3-3-29" id="h3-3-29" class="i">+!commit 2
</a> status
 ---
 Error: assertion failed: commit index regression 3 → 2
 last=3@2 commit=3@2
 
 # Committing non-existant indexes error.
<a href="#h3-3-36" id="h3-3-36" class="d">-!commit 4@2
</a><a href="#h3-3-37" id="h3-3-37" class="i">+!commit 4
</a> status
 ---
 Error: assertion failed: commit index 4 does not exist
<b>diff --git a/<a id="h4" href="../file/src/raft/testscripts/log/splice.html">src/raft/testscripts/log/splice</a> b/<a href="../file/src/raft/testscripts/log/splice.html">src/raft/testscripts/log/splice</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -151,7 +151,7 @@ last=3@5 commit=0@0
</a> 3@5 bar
 
 # Splicing across the commit index should work, as long as the entries match.
<a href="#h4-0-3" id="h4-0-3" class="d">-commit 2@5
</a><a href="#h4-0-4" id="h4-0-4" class="i">+commit 2
</a> splice 1@5= 2@5=foo 3@5=bar 4@5=
 status
 scan
<b>diff --git a/<a id="h5" href="../file/src/raft/testscripts/log/status.html">src/raft/testscripts/log/status</a> b/<a href="../file/src/raft/testscripts/log/status.html">src/raft/testscripts/log/status</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -15,7 +15,7 @@ set_term 2 1
</a> append 1
 append 1 foo
 append 2 bar
<a href="#h5-0-3" id="h5-0-3" class="d">-commit 2@1
</a><a href="#h5-0-4" id="h5-0-4" class="i">+commit 2
</a> ---
 append → 1@1 None
 append → 2@1 foo
<b>diff --git a/<a id="h6" href="../file/src/raft/testscripts/node/append_initial.html">src/raft/testscripts/node/append_initial</a> b/<a href="../file/src/raft/testscripts/node/append_initial.html">src/raft/testscripts/node/append_initial</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -28,8 +28,8 @@ n1@1 candidate ⇨ n1@1 leader
</a> n1@1 append 1@1 None
 n1@1 → n2 Append base=0@0 [1@1]
 n1@1 ⇥ n3 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶0̶@̶0̶ ̶[̶1̶@̶1̶]̶
<a href="#h6-0-3" id="h6-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h6-0-4" id="h6-0-4" class="d">-n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶c̶o̶m̶m̶i̶t̶=̶0̶@̶0̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a><a href="#h6-0-5" id="h6-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h6-0-6" id="h6-0-6" class="i">+n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶0̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a> n2@1 follower() ⇨ n2@1 follower(n1)
 n2@1 append 1@1 None
 n2@1 → n1 AppendResponse match_index=1
<b>diff --git a/<a id="h7" href="../file/src/raft/testscripts/node/append_max_entries.html">src/raft/testscripts/node/append_max_entries</a> b/<a href="../file/src/raft/testscripts/node/append_max_entries.html">src/raft/testscripts/node/append_max_entries</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -38,8 +38,8 @@ deliver
</a> deliver
 deliver
 ---
<a href="#h7-0-3" id="h7-0-3" class="d">-n1@1 → n2 Heartbeat last_index=8 commit=8@1 read_seq=0
</a><a href="#h7-0-4" id="h7-0-4" class="d">-n1@1 → n3 Heartbeat last_index=8 commit=8@1 read_seq=0
</a><a href="#h7-0-5" id="h7-0-5" class="i">+n1@1 → n2 Heartbeat last_index=8 commit_index=8 read_seq=0
</a><a href="#h7-0-6" id="h7-0-6" class="i">+n1@1 → n3 Heartbeat last_index=8 commit_index=8 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=8 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 n1@1 → n3 Append base=7@1 []
<b>diff --git a/<a id="h8" href="../file/src/raft/testscripts/node/election.html">src/raft/testscripts/node/election</a> b/<a href="../file/src/raft/testscripts/node/election.html">src/raft/testscripts/node/election</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -33,8 +33,8 @@ n1@1 candidate ⇨ n1@1 leader
</a> n1@1 append 1@1 None
 n1@1 → n2 Append base=0@0 [1@1]
 n1@1 → n3 Append base=0@0 [1@1]
<a href="#h8-0-3" id="h8-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h8-0-4" id="h8-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h8-0-5" id="h8-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h8-0-6" id="h8-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 # All nodes become n1 followers.
 stabilize
<a href="#h8-1" id="h8-1" class="h">@@ -53,8 +53,8 @@ n1@1 apply 1@1 None
</a> # n1&#39;s heartbeats are accepted by followers, who commit and apply the entry.
 tick 1
 ---
<a href="#h8-1-3" id="h8-1-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h8-1-4" id="h8-1-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h8-1-5" id="h8-1-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h8-1-6" id="h8-1-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> 
 stabilize
 ---
<b>diff --git a/<a id="h9" href="../file/src/raft/testscripts/node/election_candidate_behind_leader.html">src/raft/testscripts/node/election_candidate_behind_leader</a> b/<a href="../file/src/raft/testscripts/node/election_candidate_behind_leader.html">src/raft/testscripts/node/election_candidate_behind_leader</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -73,10 +73,10 @@ n5@2 → n1 Append base=1@1 [2@2]
</a> n5@2 → n2 Append base=1@1 [2@2]
 n5@2 → n3 Append base=1@1 [2@2]
 n5@2 → n4 Append base=1@1 [2@2]
<a href="#h9-0-3" id="h9-0-3" class="d">-n5@2 → n1 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h9-0-4" id="h9-0-4" class="d">-n5@2 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h9-0-5" id="h9-0-5" class="d">-n5@2 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h9-0-6" id="h9-0-6" class="d">-n5@2 → n4 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h9-0-7" id="h9-0-7" class="i">+n5@2 → n1 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h9-0-8" id="h9-0-8" class="i">+n5@2 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h9-0-9" id="h9-0-9" class="i">+n5@2 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h9-0-10" id="h9-0-10" class="i">+n5@2 → n4 Heartbeat last_index=2 commit_index=1 read_seq=0
</a> n1@2 follower() ⇨ n1@2 follower(n5)
 n1@2 → n5 AppendResponse match_index=2
 n1@2 → n5 HeartbeatResponse match_index=2 read_seq=0
<a href="#h9-1" id="h9-1" class="h">@@ -93,10 +93,10 @@ n4@2 → n5 AppendResponse match_index=2
</a> n4@2 → n5 HeartbeatResponse match_index=2 read_seq=0
 n5@2 commit 2@2
 n5@2 apply 2@2 None
<a href="#h9-1-3" id="h9-1-3" class="d">-n5@2 → n1 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h9-1-4" id="h9-1-4" class="d">-n5@2 → n2 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h9-1-5" id="h9-1-5" class="d">-n5@2 → n3 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h9-1-6" id="h9-1-6" class="d">-n5@2 → n4 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h9-1-7" id="h9-1-7" class="i">+n5@2 → n1 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h9-1-8" id="h9-1-8" class="i">+n5@2 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h9-1-9" id="h9-1-9" class="i">+n5@2 → n3 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h9-1-10" id="h9-1-10" class="i">+n5@2 → n4 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n1@2 commit 2@2
 n1@2 apply 2@2 None
 n1@2 → n5 HeartbeatResponse match_index=2 read_seq=0
<b>diff --git a/<a id="h10" href="../file/src/raft/testscripts/node/election_contested.html">src/raft/testscripts/node/election_contested</a> b/<a href="../file/src/raft/testscripts/node/election_contested.html">src/raft/testscripts/node/election_contested</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -53,10 +53,10 @@ n1@1 → n2 Append base=0@0 [1@1]
</a> n1@1 → n3 Append base=0@0 [1@1]
 n1@1 → n4 Append base=0@0 [1@1]
 n1@1 → n5 Append base=0@0 [1@1]
<a href="#h10-0-3" id="h10-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h10-0-4" id="h10-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h10-0-5" id="h10-0-5" class="d">-n1@1 → n4 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h10-0-6" id="h10-0-6" class="d">-n1@1 → n5 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h10-0-7" id="h10-0-7" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h10-0-8" id="h10-0-8" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h10-0-9" id="h10-0-9" class="i">+n1@1 → n4 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h10-0-10" id="h10-0-10" class="i">+n1@1 → n5 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 # All nodes accept n1 as leader in term 1 and become followers.
 stabilize
<b>diff --git a/<a id="h11" href="../file/src/raft/testscripts/node/election_tie.html">src/raft/testscripts/node/election_tie</a> b/<a href="../file/src/raft/testscripts/node/election_tie.html">src/raft/testscripts/node/election_tie</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -57,8 +57,8 @@ n2@2 candidate ⇨ n2@2 leader
</a> n2@2 append 1@2 None
 n2@2 → n1 Append base=0@0 [1@2]
 n2@2 → n3 Append base=0@0 [1@2]
<a href="#h11-0-3" id="h11-0-3" class="d">-n2@2 → n1 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h11-0-4" id="h11-0-4" class="d">-n2@2 → n3 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h11-0-5" id="h11-0-5" class="i">+n2@2 → n1 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h11-0-6" id="h11-0-6" class="i">+n2@2 → n3 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 stabilize
 ---
<b>diff --git a/<a id="h12" href="../file/src/raft/testscripts/node/election_tie_even.html">src/raft/testscripts/node/election_tie_even</a> b/<a href="../file/src/raft/testscripts/node/election_tie_even.html">src/raft/testscripts/node/election_tie_even</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -70,9 +70,9 @@ n3@2 append 1@2 None
</a> n3@2 → n1 Append base=0@0 [1@2]
 n3@2 → n2 Append base=0@0 [1@2]
 n3@2 → n4 Append base=0@0 [1@2]
<a href="#h12-0-3" id="h12-0-3" class="d">-n3@2 → n1 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h12-0-4" id="h12-0-4" class="d">-n3@2 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h12-0-5" id="h12-0-5" class="d">-n3@2 → n4 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h12-0-6" id="h12-0-6" class="i">+n3@2 → n1 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h12-0-7" id="h12-0-7" class="i">+n3@2 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h12-0-8" id="h12-0-8" class="i">+n3@2 → n4 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 stabilize
 ---
<b>diff --git a/<a id="h13" href="../file/src/raft/testscripts/node/heartbeat_commits_follower.html">src/raft/testscripts/node/heartbeat_commits_follower</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_commits_follower.html">src/raft/testscripts/node/heartbeat_commits_follower</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -34,8 +34,8 @@ n3@1 follower(n1) last=2@1 commit=1@1 apply=1
</a> heartbeat 1
 stabilize
 ---
<a href="#h13-0-3" id="h13-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=0
</a><a href="#h13-0-4" id="h13-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=0
</a><a href="#h13-0-5" id="h13-0-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h13-0-6" id="h13-0-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n2@1 commit 2@1
 n2@1 apply 2@1 put foo=bar
 n2@1 → n1 HeartbeatResponse match_index=2 read_seq=0
<b>diff --git a/<a id="h14" href="../file/src/raft/testscripts/node/heartbeat_converts_candidate.html">src/raft/testscripts/node/heartbeat_converts_candidate</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_converts_candidate.html">src/raft/testscripts/node/heartbeat_converts_candidate</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -42,8 +42,8 @@ n1 n2 n3 fully connected
</a> heartbeat 1
 stabilize
 ---
<a href="#h14-0-3" id="h14-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h14-0-4" id="h14-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h14-0-5" id="h14-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h14-0-6" id="h14-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=0
 n3@1 candidate ⇨ n3@1 follower(n1)
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=0
<b>diff --git a/<a id="h15" href="../file/src/raft/testscripts/node/heartbeat_converts_follower.html">src/raft/testscripts/node/heartbeat_converts_follower</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_converts_follower.html">src/raft/testscripts/node/heartbeat_converts_follower</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -30,8 +30,8 @@ n1 n2 n3 fully connected
</a> heartbeat 3
 stabilize heartbeat=true
 ---
<a href="#h15-0-3" id="h15-0-3" class="d">-n3@2 → n1 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h15-0-4" id="h15-0-4" class="d">-n3@2 → n2 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h15-0-5" id="h15-0-5" class="i">+n3@2 → n1 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h15-0-6" id="h15-0-6" class="i">+n3@2 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n1@2 → n3 HeartbeatResponse match_index=2 read_seq=0
 n2@1 follower(n1) ⇨ n2@2 follower(n3)
 n2@2 → n3 HeartbeatResponse match_index=0 read_seq=0
<a href="#h15-1" id="h15-1" class="h">@@ -40,8 +40,8 @@ n2@2 → n3 AppendResponse match_index=1
</a> n3@2 → n2 Append base=1@1 [2@2]
 n2@2 append 2@2 None
 n2@2 → n3 AppendResponse match_index=2
<a href="#h15-1-3" id="h15-1-3" class="d">-n3@2 → n1 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h15-1-4" id="h15-1-4" class="d">-n3@2 → n2 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h15-1-5" id="h15-1-5" class="i">+n3@2 → n1 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h15-1-6" id="h15-1-6" class="i">+n3@2 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n1@2 → n3 HeartbeatResponse match_index=2 read_seq=0
 n2@2 commit 2@2
 n2@2 apply 2@2 None
<b>diff --git a/<a id="h16" href="../file/src/raft/testscripts/node/heartbeat_converts_follower_leaderless.html">src/raft/testscripts/node/heartbeat_converts_follower_leaderless</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_converts_follower_leaderless.html">src/raft/testscripts/node/heartbeat_converts_follower_leaderless</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -29,8 +29,8 @@ n1 n2 n3 fully connected
</a> heartbeat 1
 stabilize
 ---
<a href="#h16-0-3" id="h16-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h16-0-4" id="h16-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h16-0-5" id="h16-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h16-0-6" id="h16-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=0
 n3@0 follower() ⇨ n3@1 follower(n1)
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=0
<b>diff --git a/<a id="h17" href="../file/src/raft/testscripts/node/heartbeat_converts_leader.html">src/raft/testscripts/node/heartbeat_converts_leader</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_converts_leader.html">src/raft/testscripts/node/heartbeat_converts_leader</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -30,8 +30,8 @@ n1 n2 n3 fully connected
</a> heartbeat 1
 stabilize heartbeat=true
 ---
<a href="#h17-0-3" id="h17-0-3" class="d">-n1@2 → n2 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h17-0-4" id="h17-0-4" class="d">-n1@2 → n3 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h17-0-5" id="h17-0-5" class="i">+n1@2 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h17-0-6" id="h17-0-6" class="i">+n1@2 → n3 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n2@2 → n1 HeartbeatResponse match_index=2 read_seq=0
 n3@1 leader ⇨ n3@2 follower(n1)
 n3@2 → n1 HeartbeatResponse match_index=0 read_seq=0
<a href="#h17-1" id="h17-1" class="h">@@ -40,8 +40,8 @@ n3@2 → n1 AppendResponse match_index=1
</a> n1@2 → n3 Append base=1@1 [2@2]
 n3@2 append 2@2 None
 n3@2 → n1 AppendResponse match_index=2
<a href="#h17-1-3" id="h17-1-3" class="d">-n1@2 → n2 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h17-1-4" id="h17-1-4" class="d">-n1@2 → n3 Heartbeat last_index=2 commit=2@2 read_seq=0
</a><a href="#h17-1-5" id="h17-1-5" class="i">+n1@2 → n2 Heartbeat last_index=2 commit_index=2 read_seq=0
</a><a href="#h17-1-6" id="h17-1-6" class="i">+n1@2 → n3 Heartbeat last_index=2 commit_index=2 read_seq=0
</a> n2@2 → n1 HeartbeatResponse match_index=2 read_seq=0
 n3@2 commit 2@2
 n3@2 apply 2@2 None
<b>diff --git a/<a id="h18" href="../file/src/raft/testscripts/node/heartbeat_lost_append_duplicate.html">src/raft/testscripts/node/heartbeat_lost_append_duplicate</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_lost_append_duplicate.html">src/raft/testscripts/node/heartbeat_lost_append_duplicate</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -31,12 +31,12 @@ heartbeat 1
</a> heartbeat 1
 deliver
 ---
<a href="#h18-0-3" id="h18-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-4" id="h18-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-5" id="h18-0-5" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-6" id="h18-0-6" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-7" id="h18-0-7" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-8" id="h18-0-8" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h18-0-9" id="h18-0-9" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h18-0-10" id="h18-0-10" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h18-0-11" id="h18-0-11" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h18-0-12" id="h18-0-12" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h18-0-13" id="h18-0-13" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h18-0-14" id="h18-0-14" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 n2@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 n2@1 → n1 HeartbeatResponse match_index=0 read_seq=0
<b>diff --git a/<a id="h19" href="../file/src/raft/testscripts/node/heartbeat_lost_append_multiple.html">src/raft/testscripts/node/heartbeat_lost_append_multiple</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_lost_append_multiple.html">src/raft/testscripts/node/heartbeat_lost_append_multiple</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -42,8 +42,8 @@ n3@1 follower(n1) last=1@1 commit=1@1 apply=1
</a> heartbeat 1
 deliver
 ---
<a href="#h19-0-3" id="h19-0-3" class="d">-n1@1 → n2 Heartbeat last_index=4 commit=1@1 read_seq=0
</a><a href="#h19-0-4" id="h19-0-4" class="d">-n1@1 → n3 Heartbeat last_index=4 commit=1@1 read_seq=0
</a><a href="#h19-0-5" id="h19-0-5" class="i">+n1@1 → n2 Heartbeat last_index=4 commit_index=1 read_seq=0
</a><a href="#h19-0-6" id="h19-0-6" class="i">+n1@1 → n3 Heartbeat last_index=4 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 
<b>diff --git a/<a id="h20" href="../file/src/raft/testscripts/node/heartbeat_lost_append_single.html">src/raft/testscripts/node/heartbeat_lost_append_single</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_lost_append_single.html">src/raft/testscripts/node/heartbeat_lost_append_single</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -28,8 +28,8 @@ n1 n2 n3 fully connected
</a> heartbeat 1
 deliver
 ---
<a href="#h20-0-3" id="h20-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h20-0-4" id="h20-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h20-0-5" id="h20-0-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h20-0-6" id="h20-0-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=0
 
<b>diff --git a/<a id="h21" href="../file/src/raft/testscripts/node/heartbeat_match_commits.html">src/raft/testscripts/node/heartbeat_match_commits</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_match_commits.html">src/raft/testscripts/node/heartbeat_match_commits</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -42,8 +42,8 @@ n3@1 follower(n1) last=2@1 commit=1@1 apply=1
</a> heartbeat 1
 deliver
 ---
<a href="#h21-0-3" id="h21-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h21-0-4" id="h21-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=0
</a><a href="#h21-0-5" id="h21-0-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=0
</a><a href="#h21-0-6" id="h21-0-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=2 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=2 read_seq=0
 
<b>diff --git a/<a id="h22" href="../file/src/raft/testscripts/node/heartbeat_probe_divergent.html">src/raft/testscripts/node/heartbeat_probe_divergent</a> b/<a href="../file/src/raft/testscripts/node/heartbeat_probe_divergent.html">src/raft/testscripts/node/heartbeat_probe_divergent</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -104,8 +104,8 @@ deliver 1
</a> status 3
 ---
 n3@3 → n1 Append base=8@3 []
<a href="#h22-0-3" id="h22-0-3" class="d">-n3@3 → n1 Heartbeat last_index=10 commit=9@3 read_seq=0
</a><a href="#h22-0-4" id="h22-0-4" class="d">-n3@3 → n2 Heartbeat last_index=10 commit=9@3 read_seq=0
</a><a href="#h22-0-5" id="h22-0-5" class="i">+n3@3 → n1 Heartbeat last_index=10 commit_index=9 read_seq=0
</a><a href="#h22-0-6" id="h22-0-6" class="i">+n3@3 → n2 Heartbeat last_index=10 commit_index=9 read_seq=0
</a> n1@3 → n3 AppendResponse reject_index=8
 n1@3 → n3 HeartbeatResponse match_index=0 read_seq=0
 n3@3 leader last=10@3 commit=9@3 apply=9 progress={1:0→9 2:9→11}
<a href="#h22-1" id="h22-1" class="h">@@ -140,8 +140,8 @@ n1@3 → n3 AppendResponse reject_index=6
</a> heartbeat 3
 deliver 3
 ---
<a href="#h22-1-3" id="h22-1-3" class="d">-n3@3 → n1 Heartbeat last_index=10 commit=9@3 read_seq=0
</a><a href="#h22-1-4" id="h22-1-4" class="d">-n3@3 → n2 Heartbeat last_index=10 commit=9@3 read_seq=0
</a><a href="#h22-1-5" id="h22-1-5" class="i">+n3@3 → n1 Heartbeat last_index=10 commit_index=9 read_seq=0
</a><a href="#h22-1-6" id="h22-1-6" class="i">+n3@3 → n2 Heartbeat last_index=10 commit_index=9 read_seq=0
</a> n3@3 → n1 Append base=5@2 []
 
 deliver 1
<b>diff --git a/<a id="h23" href="../file/src/raft/testscripts/node/old_campaign_rejected.html">src/raft/testscripts/node/old_campaign_rejected</a> b/<a href="../file/src/raft/testscripts/node/old_campaign_rejected.html">src/raft/testscripts/node/old_campaign_rejected</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -30,8 +30,8 @@ n1@1 candidate ⇨ n1@1 leader
</a> n1@1 append 1@1 None
 n1@1 → n2 Append base=0@0 [1@1]
 n1@1 → n3 Append base=0@0 [1@1]
<a href="#h23-0-3" id="h23-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h23-0-4" id="h23-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h23-0-5" id="h23-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h23-0-6" id="h23-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 # n3 receives n1&#39;s heartbeat and becomes follower.
 deliver 3 from=1
<b>diff --git a/<a id="h24" href="../file/src/raft/testscripts/node/old_campaign_response_ignored.html">src/raft/testscripts/node/old_campaign_response_ignored</a> b/<a href="../file/src/raft/testscripts/node/old_campaign_response_ignored.html">src/raft/testscripts/node/old_campaign_response_ignored</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -57,12 +57,12 @@ n1@1 → n4 Append base=0@0 [1@1]
</a> n1@1 → n5 Append base=0@0 [1@1]
 n1@1 → n6 Append base=0@0 [1@1]
 n1@1 → n7 Append base=0@0 [1@1]
<a href="#h24-0-3" id="h24-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-4" id="h24-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-5" id="h24-0-5" class="d">-n1@1 → n4 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-6" id="h24-0-6" class="d">-n1@1 → n5 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-7" id="h24-0-7" class="d">-n1@1 → n6 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-8" id="h24-0-8" class="d">-n1@1 → n7 Heartbeat last_index=1 commit=0@0 read_seq=0
</a><a href="#h24-0-9" id="h24-0-9" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h24-0-10" id="h24-0-10" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h24-0-11" id="h24-0-11" class="i">+n1@1 → n4 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h24-0-12" id="h24-0-12" class="i">+n1@1 → n5 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h24-0-13" id="h24-0-13" class="i">+n1@1 → n6 Heartbeat last_index=1 commit_index=0 read_seq=0
</a><a href="#h24-0-14" id="h24-0-14" class="i">+n1@1 → n7 Heartbeat last_index=1 commit_index=0 read_seq=0
</a> 
 # n2 receives n1&#39;s heartbeats and becomes follower.
 deliver 2 from=1
<b>diff --git a/<a id="h25" href="../file/src/raft/testscripts/node/old_heartbeat_ignored.html">src/raft/testscripts/node/old_heartbeat_ignored</a> b/<a href="../file/src/raft/testscripts/node/old_heartbeat_ignored.html">src/raft/testscripts/node/old_heartbeat_ignored</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -30,8 +30,8 @@ n1 n2 n3 fully connected
</a> heartbeat 3
 stabilize
 ---
<a href="#h25-0-3" id="h25-0-3" class="d">-n3@1 → n1 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h25-0-4" id="h25-0-4" class="d">-n3@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h25-0-5" id="h25-0-5" class="i">+n3@1 → n1 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h25-0-6" id="h25-0-6" class="i">+n3@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> 
 status
 ---
<b>diff --git a/<a id="h26" href="../file/src/raft/testscripts/node/request_follower.html">src/raft/testscripts/node/request_follower</a> b/<a href="../file/src/raft/testscripts/node/request_follower.html">src/raft/testscripts/node/request_follower</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -12,8 +12,8 @@ stabilize
</a> ---
 c2@1 → n2 ClientRequest id=0x01 read 0x0003666f6f
 n2@1 → n1 ClientRequest id=0x01 read 0x0003666f6f
<a href="#h26-0-3" id="h26-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=1
</a><a href="#h26-0-4" id="h26-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=1
</a><a href="#h26-0-5" id="h26-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h26-0-6" id="h26-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=1
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=1
 n3@1 → n1 HeartbeatResponse match_index=1 read_seq=1
 n1@1 → n2 ClientResponse id=0x01 read 0x0000
<a href="#h26-1" id="h26-1" class="h">@@ -46,8 +46,8 @@ stabilize
</a> ---
 c2@1 → n2 ClientRequest id=0x03 read 0x0003666f6f
 n2@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h26-1-3" id="h26-1-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h26-1-4" id="h26-1-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h26-1-5" id="h26-1-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h26-1-6" id="h26-1-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a> n2@1 → n1 HeartbeatResponse match_index=2 read_seq=2
 n3@1 → n1 HeartbeatResponse match_index=2 read_seq=2
 n1@1 → n2 ClientResponse id=0x03 read 0x000103626172
<b>diff --git a/<a id="h27" href="../file/src/raft/testscripts/node/request_follower_disconnect_stall.html">src/raft/testscripts/node/request_follower_disconnect_stall</a> b/<a href="../file/src/raft/testscripts/node/request_follower_disconnect_stall.html">src/raft/testscripts/node/request_follower_disconnect_stall</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -29,7 +29,7 @@ n1 n2 n3 fully connected
</a> 
 stabilize heartbeat=true
 ---
<a href="#h27-0-3" id="h27-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h27-0-4" id="h27-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h27-0-5" id="h27-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h27-0-6" id="h27-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=1 read_seq=0
<b>diff --git a/<a id="h28" href="../file/src/raft/testscripts/node/request_leader.html">src/raft/testscripts/node/request_leader</a> b/<a href="../file/src/raft/testscripts/node/request_leader.html">src/raft/testscripts/node/request_leader</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -11,8 +11,8 @@ get 1 foo
</a> stabilize
 ---
 c1@1 → n1 ClientRequest id=0x01 read 0x0003666f6f
<a href="#h28-0-3" id="h28-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=1
</a><a href="#h28-0-4" id="h28-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=1
</a><a href="#h28-0-5" id="h28-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=1
</a><a href="#h28-0-6" id="h28-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=1
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=1
 n3@1 → n1 HeartbeatResponse match_index=1 read_seq=1
 n1@1 → c1 ClientResponse id=0x01 read 0x0000
<a href="#h28-1" id="h28-1" class="h">@@ -41,8 +41,8 @@ get 1 foo
</a> stabilize
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h28-1-3" id="h28-1-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h28-1-4" id="h28-1-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h28-1-5" id="h28-1-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h28-1-6" id="h28-1-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a> n2@1 → n1 HeartbeatResponse match_index=2 read_seq=2
 n3@1 → n1 HeartbeatResponse match_index=2 read_seq=2
 n1@1 → c1 ClientResponse id=0x03 read 0x000103626172
<b>diff --git a/<a id="h29" href="../file/src/raft/testscripts/node/request_leader_campaign_abort.html">src/raft/testscripts/node/request_leader_campaign_abort</a> b/<a href="../file/src/raft/testscripts/node/request_leader_campaign_abort.html">src/raft/testscripts/node/request_leader_campaign_abort</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -15,8 +15,8 @@ n1@1 append 2@1 put foo=bar
</a> n1@1 → n2 Append base=1@1 [2@1]
 n1@1 → n3 Append base=1@1 [2@1]
 c1@1 → n1 ClientRequest id=0x02 read 0x0003666f6f
<a href="#h29-0-3" id="h29-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=1
</a><a href="#h29-0-4" id="h29-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=1
</a><a href="#h29-0-5" id="h29-0-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=1
</a><a href="#h29-0-6" id="h29-0-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=1
</a> 
 # n2 campaigns before n1&#39;s requests achieve quorum.
 campaign 2
<b>diff --git a/<a id="h30" href="../file/src/raft/testscripts/node/request_leader_change_linearizability.html">src/raft/testscripts/node/request_leader_change_linearizability</a> b/<a href="../file/src/raft/testscripts/node/request_leader_change_linearizability.html">src/raft/testscripts/node/request_leader_change_linearizability</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -46,8 +46,8 @@ n2@2 candidate ⇨ n2@2 leader
</a> n2@2 append 4@2 None
 n2@2 ⇥ n1 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶3̶@̶1̶ ̶[̶4̶@̶2̶]̶
 n2@2 ⇥ n3 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶3̶@̶1̶ ̶[̶4̶@̶2̶]̶
<a href="#h30-0-3" id="h30-0-3" class="d">-n2@2 ⇥ n1 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶4̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a><a href="#h30-0-4" id="h30-0-4" class="d">-n2@2 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶4̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a><a href="#h30-0-5" id="h30-0-5" class="i">+n2@2 ⇥ n1 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶4̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a><a href="#h30-0-6" id="h30-0-6" class="i">+n2@2 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶4̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶0̶
</a> 
 heal
 status
<a href="#h30-1" id="h30-1" class="h">@@ -65,8 +65,8 @@ get 2 b
</a> stabilize
 ---
 c2@2 → n2 ClientRequest id=0x03 read 0x000162
<a href="#h30-1-3" id="h30-1-3" class="d">-n2@2 → n1 Heartbeat last_index=4 commit=2@1 read_seq=1
</a><a href="#h30-1-4" id="h30-1-4" class="d">-n2@2 → n3 Heartbeat last_index=4 commit=2@1 read_seq=1
</a><a href="#h30-1-5" id="h30-1-5" class="i">+n2@2 → n1 Heartbeat last_index=4 commit_index=2 read_seq=1
</a><a href="#h30-1-6" id="h30-1-6" class="i">+n2@2 → n3 Heartbeat last_index=4 commit_index=2 read_seq=1
</a> n1@2 follower() ⇨ n1@2 follower(n2)
 n1@2 → n2 HeartbeatResponse match_index=0 read_seq=1
 n3@2 follower() ⇨ n3@2 follower(n2)
<b>diff --git a/<a id="h31" href="../file/src/raft/testscripts/node/request_leader_disconnect.html">src/raft/testscripts/node/request_leader_disconnect</a> b/<a href="../file/src/raft/testscripts/node/request_leader_disconnect.html">src/raft/testscripts/node/request_leader_disconnect</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -22,8 +22,8 @@ n1@1 append 2@1 put foo=bar
</a> n1@1 ⇥ n2 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶1̶@̶1̶ ̶[̶2̶@̶1̶]̶
 n1@1 ⇥ n3 A̶p̶p̶e̶n̶d̶ ̶b̶a̶s̶e̶=̶1̶@̶1̶ ̶[̶2̶@̶1̶]̶
 c1@1 → n1 ClientRequest id=0x02 read 0x0003666f6f
<a href="#h31-0-3" id="h31-0-3" class="d">-n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶1̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a><a href="#h31-0-4" id="h31-0-4" class="d">-n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶1̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a><a href="#h31-0-5" id="h31-0-5" class="i">+n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a><a href="#h31-0-6" id="h31-0-6" class="i">+n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶1̶
</a> 
 # Heal the partition and heartbeat. The requests eventually return results.
 heal
<a href="#h31-1" id="h31-1" class="h">@@ -32,8 +32,8 @@ n1 n2 n3 fully connected
</a> 
 stabilize heartbeat=true
 ---
<a href="#h31-1-3" id="h31-1-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=1@1 read_seq=1
</a><a href="#h31-1-4" id="h31-1-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=1@1 read_seq=1
</a><a href="#h31-1-5" id="h31-1-5" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=1 read_seq=1
</a><a href="#h31-1-6" id="h31-1-6" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=1 read_seq=1
</a> n2@1 → n1 HeartbeatResponse match_index=0 read_seq=1
 n3@1 → n1 HeartbeatResponse match_index=0 read_seq=1
 n1@1 → c1 ClientResponse id=0x02 read 0x0000
<b>diff --git a/<a id="h32" href="../file/src/raft/testscripts/node/request_leader_read_quorum.html">src/raft/testscripts/node/request_leader_read_quorum</a> b/<a href="../file/src/raft/testscripts/node/request_leader_read_quorum.html">src/raft/testscripts/node/request_leader_read_quorum</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -25,10 +25,10 @@ ok
</a> get 1 foo
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h32-0-3" id="h32-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h32-0-4" id="h32-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h32-0-5" id="h32-0-5" class="d">-n1@1 → n4 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h32-0-6" id="h32-0-6" class="d">-n1@1 → n5 Heartbeat last_index=2 commit=2@1 read_seq=2
</a><a href="#h32-0-7" id="h32-0-7" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h32-0-8" id="h32-0-8" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h32-0-9" id="h32-0-9" class="i">+n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=2
</a><a href="#h32-0-10" id="h32-0-10" class="i">+n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=2
</a> 
 deliver 2
 deliver 1
<b>diff --git a/<a id="h33" href="../file/src/raft/testscripts/node/request_leader_read_quorum_sequence.html">src/raft/testscripts/node/request_leader_read_quorum_sequence</a> b/<a href="../file/src/raft/testscripts/node/request_leader_read_quorum_sequence.html">src/raft/testscripts/node/request_leader_read_quorum_sequence</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -21,10 +21,10 @@ ok
</a> heartbeat 1
 deliver
 ---
<a href="#h33-0-3" id="h33-0-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=1
</a><a href="#h33-0-4" id="h33-0-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=1
</a><a href="#h33-0-5" id="h33-0-5" class="d">-n1@1 → n4 Heartbeat last_index=2 commit=2@1 read_seq=1
</a><a href="#h33-0-6" id="h33-0-6" class="d">-n1@1 → n5 Heartbeat last_index=2 commit=2@1 read_seq=1
</a><a href="#h33-0-7" id="h33-0-7" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h33-0-8" id="h33-0-8" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h33-0-9" id="h33-0-9" class="i">+n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=1
</a><a href="#h33-0-10" id="h33-0-10" class="i">+n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=1
</a> n2@1 → n1 HeartbeatResponse match_index=2 read_seq=1
 n3@1 → n1 HeartbeatResponse match_index=2 read_seq=1
 n4@1 → n1 HeartbeatResponse match_index=2 read_seq=1
<a href="#h33-1" id="h33-1" class="h">@@ -39,10 +39,10 @@ n1 ⇹ n2 n3 n4 n5
</a> get 1 foo
 ---
 c1@1 → n1 ClientRequest id=0x03 read 0x0003666f6f
<a href="#h33-1-3" id="h33-1-3" class="d">-n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-4" id="h33-1-4" class="d">-n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-5" id="h33-1-5" class="d">-n1@1 ⇥ n4 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-6" id="h33-1-6" class="d">-n1@1 ⇥ n5 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶=̶2̶@̶1̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-7" id="h33-1-7" class="i">+n1@1 ⇥ n2 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-8" id="h33-1-8" class="i">+n1@1 ⇥ n3 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-9" id="h33-1-9" class="i">+n1@1 ⇥ n4 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a><a href="#h33-1-10" id="h33-1-10" class="i">+n1@1 ⇥ n5 H̶e̶a̶r̶t̶b̶e̶a̶t̶ ̶l̶a̶s̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶c̶o̶m̶m̶i̶t̶_̶i̶n̶d̶e̶x̶=̶2̶ ̶r̶e̶a̶d̶_̶s̶e̶q̶=̶2̶
</a> 
 # Deliver the heartbeat responses at sequence number 1. These should not satisfy
 # the read at sequence number 2.
<a href="#h33-2" id="h33-2" class="h">@@ -57,10 +57,10 @@ get 1 foo
</a> ---
 n1 n2 n3 n4 n5 fully connected
 c1@1 → n1 ClientRequest id=0x04 read 0x0003666f6f
<a href="#h33-2-3" id="h33-2-3" class="d">-n1@1 → n2 Heartbeat last_index=2 commit=2@1 read_seq=3
</a><a href="#h33-2-4" id="h33-2-4" class="d">-n1@1 → n3 Heartbeat last_index=2 commit=2@1 read_seq=3
</a><a href="#h33-2-5" id="h33-2-5" class="d">-n1@1 → n4 Heartbeat last_index=2 commit=2@1 read_seq=3
</a><a href="#h33-2-6" id="h33-2-6" class="d">-n1@1 → n5 Heartbeat last_index=2 commit=2@1 read_seq=3
</a><a href="#h33-2-7" id="h33-2-7" class="i">+n1@1 → n2 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h33-2-8" id="h33-2-8" class="i">+n1@1 → n3 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h33-2-9" id="h33-2-9" class="i">+n1@1 → n4 Heartbeat last_index=2 commit_index=2 read_seq=3
</a><a href="#h33-2-10" id="h33-2-10" class="i">+n1@1 → n5 Heartbeat last_index=2 commit_index=2 read_seq=3
</a> 
 deliver
 ---
<b>diff --git a/<a id="h34" href="../file/src/raft/testscripts/node/tick_follower.html">src/raft/testscripts/node/tick_follower</a> b/<a href="../file/src/raft/testscripts/node/tick_follower.html">src/raft/testscripts/node/tick_follower</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -16,8 +16,8 @@ ok
</a> heartbeat 1
 stabilize
 ---
<a href="#h34-0-3" id="h34-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h34-0-4" id="h34-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h34-0-5" id="h34-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h34-0-6" id="h34-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> n2@1 → n1 HeartbeatResponse match_index=1 read_seq=0
 n3@1 → n1 HeartbeatResponse match_index=1 read_seq=0
 
<b>diff --git a/<a id="h35" href="../file/src/raft/testscripts/node/tick_leader.html">src/raft/testscripts/node/tick_leader</a> b/<a href="../file/src/raft/testscripts/node/tick_leader.html">src/raft/testscripts/node/tick_leader</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -10,8 +10,8 @@ n3@1 follower(n1) last=1@1 commit=1@1 apply=1
</a> # Ticking n1 will emit a heartbeat.
 tick 1
 ---
<a href="#h35-0-3" id="h35-0-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-0-4" id="h35-0-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-0-5" id="h35-0-5" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-0-6" id="h35-0-6" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a> 
 # Ticking n1 again will emit further heartbeats, even when it hasn&#39;t heard from
 # any followers.
<a href="#h35-1" id="h35-1" class="h">@@ -19,9 +19,9 @@ tick 1
</a> tick 1
 tick 1
 ---
<a href="#h35-1-3" id="h35-1-3" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-4" id="h35-1-4" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-5" id="h35-1-5" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-6" id="h35-1-6" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-7" id="h35-1-7" class="d">-n1@1 → n2 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-8" id="h35-1-8" class="d">-n1@1 → n3 Heartbeat last_index=1 commit=1@1 read_seq=0
</a><a href="#h35-1-9" id="h35-1-9" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-1-10" id="h35-1-10" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-1-11" id="h35-1-11" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-1-12" id="h35-1-12" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-1-13" id="h35-1-13" class="i">+n1@1 → n2 Heartbeat last_index=1 commit_index=1 read_seq=0
</a><a href="#h35-1-14" id="h35-1-14" class="i">+n1@1 → n3 Heartbeat last_index=1 commit_index=1 read_seq=0
</a></pre>
</div>
</body>
</html>
