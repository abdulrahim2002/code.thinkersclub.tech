<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>README.md: add some benchmark results and other tweaks - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/cee2c7df2ba5f3061c2c555c5c782a22d9a9b795.html">cee2c7df2ba5f3061c2c555c5c782a22d9a9b795</a>
<b>parent</b> <a href="../commit/c73d0f14b06026d55901087eea855b1585de92f9.html">c73d0f14b06026d55901087eea855b1585de92f9</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Tue, 23 Jul 2024 23:22:17 +0200

README.md: add some benchmark results and other tweaks

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README.md</a></td><td> | </td><td class="num">55</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">cluster/run.sh</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
</table></pre><pre>2 files changed, 46 insertions(+), 13 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -19,17 +19,15 @@ Originally written to teach myself more about database iternals, toyDB is intend
</a> the basic architecture and concepts of distributed SQL databases. It should be functional and 
 correct, but focuses on simplicity and understandability. In particular, performance, scalability, 
 and availability are explicit non-goals -- these are major sources of complexity in 
<a href="#h0-0-3" id="h0-0-3" class="d">-production-grade databases, which obscur the basic underlying concepts. Shortcuts have been taken 
</a><a href="#h0-0-4" id="h0-0-4" class="i">+production-grade databases, which obscure the basic underlying concepts. Shortcuts have been taken 
</a> wherever possible.
 
<a href="#h0-0-7" id="h0-0-7" class="d">-toyDB is not suitable for real-world use.
</a><a href="#h0-0-8" id="h0-0-8" class="d">-
</a> [raft]: https://github.com/erikgrinaker/toydb/blob/master/src/raft/mod.rs
 [txn]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/mvcc.rs
 [storage]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/engine.rs
 [bitcask]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/bitcask.rs
 [memory]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/memory.rs
<a href="#h0-0-14" id="h0-0-14" class="d">-[query]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/planner/plan.rs
</a><a href="#h0-0-15" id="h0-0-15" class="i">+[query]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/execution/execute.rs
</a> [optimizer]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/planner/optimizer.rs
 [sql]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/mod.rs
 
<a href="#h0-1" id="h0-1" class="h">@@ -50,6 +48,17 @@ cluster can be started on `localhost` ports `9601` to `9605`, with data under `c
</a> 
 ```
 $ ./cluster/run.sh
<a href="#h0-1-3" id="h0-1-3" class="i">+Starting 5 nodes on ports 9601-9605 with data under cluster/*/data/.
</a><a href="#h0-1-4" id="h0-1-4" class="i">+To connect to node 5, run: cargo run --release --bin toysql
</a><a href="#h0-1-5" id="h0-1-5" class="i">+
</a><a href="#h0-1-6" id="h0-1-6" class="i">+toydb4 21:03:55 [INFO] Listening on [::1]:9604 (SQL) and [::1]:9704 (Raft)
</a><a href="#h0-1-7" id="h0-1-7" class="i">+toydb1 21:03:55 [INFO] Listening on [::1]:9601 (SQL) and [::1]:9701 (Raft)
</a><a href="#h0-1-8" id="h0-1-8" class="i">+toydb2 21:03:55 [INFO] Listening on [::1]:9602 (SQL) and [::1]:9702 (Raft)
</a><a href="#h0-1-9" id="h0-1-9" class="i">+toydb3 21:03:55 [INFO] Listening on [::1]:9603 (SQL) and [::1]:9703 (Raft)
</a><a href="#h0-1-10" id="h0-1-10" class="i">+toydb5 21:03:55 [INFO] Listening on [::1]:9605 (SQL) and [::1]:9705 (Raft)
</a><a href="#h0-1-11" id="h0-1-11" class="i">+toydb2 21:03:56 [INFO] Starting new election for term 1
</a><a href="#h0-1-12" id="h0-1-12" class="i">+[...]
</a><a href="#h0-1-13" id="h0-1-13" class="i">+toydb2 21:03:56 [INFO] Won election for term 1, becoming leader
</a> ```
 
 A command-line client can be built and used with node 5 on `localhost:9605`:
<a href="#h0-2" id="h0-2" class="h">@@ -66,6 +75,29 @@ toydb&gt; SELECT * FROM movies;
</a> ```
 
 toyDB supports most common SQL features, including joins, aggregates, and ACID transactions.
<a href="#h0-2-3" id="h0-2-3" class="i">+Here is an `EXPLAIN` query plan of a more complex query, fetching movies from studios that
</a><a href="#h0-2-4" id="h0-2-4" class="i">+have released movies with an IMDb rating of 8 or more:
</a><a href="#h0-2-5" id="h0-2-5" class="i">+
</a><a href="#h0-2-6" id="h0-2-6" class="i">+```
</a><a href="#h0-2-7" id="h0-2-7" class="i">+toydb&gt; EXPLAIN SELECT m.id, m.title, g.name AS genre, s.name AS studio, m.rating
</a><a href="#h0-2-8" id="h0-2-8" class="i">+  FROM movies m JOIN genres g ON m.genre_id = g.id,
</a><a href="#h0-2-9" id="h0-2-9" class="i">+    studios s JOIN movies good ON good.studio_id = s.id AND good.rating &gt;= 8
</a><a href="#h0-2-10" id="h0-2-10" class="i">+  WHERE m.studio_id = s.id
</a><a href="#h0-2-11" id="h0-2-11" class="i">+  GROUP BY m.id, m.title, g.name, s.name, m.rating, m.released
</a><a href="#h0-2-12" id="h0-2-12" class="i">+  ORDER BY m.rating DESC, m.released ASC, m.id ASC;
</a><a href="#h0-2-13" id="h0-2-13" class="i">+
</a><a href="#h0-2-14" id="h0-2-14" class="i">+Remap: m.id, m.title, genre, studio, m.rating (dropped: m.released)
</a><a href="#h0-2-15" id="h0-2-15" class="i">+└─ Order: m.rating desc, m.released asc, m.id asc
</a><a href="#h0-2-16" id="h0-2-16" class="i">+   └─ Projection: m.id, m.title, g.name as genre, s.name as studio, m.rating, m.released
</a><a href="#h0-2-17" id="h0-2-17" class="i">+      └─ Aggregate: m.id, m.title, g.name, s.name, m.rating, m.released
</a><a href="#h0-2-18" id="h0-2-18" class="i">+         └─ HashJoin: inner on m.studio_id = s.id
</a><a href="#h0-2-19" id="h0-2-19" class="i">+            ├─ HashJoin: inner on m.genre_id = g.id
</a><a href="#h0-2-20" id="h0-2-20" class="i">+            │  ├─ Scan: movies as m
</a><a href="#h0-2-21" id="h0-2-21" class="i">+            │  └─ Scan: genres as g
</a><a href="#h0-2-22" id="h0-2-22" class="i">+            └─ HashJoin: inner on s.id = good.studio_id
</a><a href="#h0-2-23" id="h0-2-23" class="i">+               ├─ Scan: studios as s
</a><a href="#h0-2-24" id="h0-2-24" class="i">+               └─ Scan: movies as good (good.rating &gt; 8 OR good.rating = 8)
</a><a href="#h0-2-25" id="h0-2-25" class="i">+```
</a> 
 ## Architecture
 
<a href="#h0-3" id="h0-3" class="h">@@ -127,14 +159,15 @@ The available workloads are:
</a> 
 For more information about workloads and parameters, run `cargo run --bin workload -- --help`.
 
<a href="#h0-3-3" id="h0-3-3" class="d">-Example workload results:
</a><a href="#h0-3-4" id="h0-3-4" class="i">+Example workload results are listed below. Write performance is pretty atrocious, due to fsyncs 
</a><a href="#h0-3-5" id="h0-3-5" class="i">+and a lack of write batching at the Raft level. Disabling fsyncs, or using the in-memory engine, 
</a><a href="#h0-3-6" id="h0-3-6" class="i">+significantly improves write performance.
</a> 
<a href="#h0-3-8" id="h0-3-8" class="d">-```
</a><a href="#h0-3-9" id="h0-3-9" class="d">-Workload   Time       Txns      Rate       p50       p90       p99      pMax
</a><a href="#h0-3-10" id="h0-3-10" class="d">-read       7.1s     100000   14163/s     1.2ms     1.4ms     1.7ms     8.4ms
</a><a href="#h0-3-11" id="h0-3-11" class="d">-write      22.2s    100000    4502/s     3.9ms     4.5ms     4.9ms    15.7ms
</a><a href="#h0-3-12" id="h0-3-12" class="d">-bank       155.0s   100000     645/s    16.9ms    41.7ms    95.0ms  1044.4ms
</a><a href="#h0-3-13" id="h0-3-13" class="d">-```
</a><a href="#h0-3-14" id="h0-3-14" class="i">+| Workload | BitCask     | BitCask w/o fsync | Memory      |
</a><a href="#h0-3-15" id="h0-3-15" class="i">+|----------|-------------|-------------------|-------------|
</a><a href="#h0-3-16" id="h0-3-16" class="i">+| `read`   | 14163 txn/s | 13941 txn/s       | 13949 txn/s |
</a><a href="#h0-3-17" id="h0-3-17" class="i">+| `write`  | 35 txn/s    | 4719 txn/s        | 7781 txn/s  |
</a><a href="#h0-3-18" id="h0-3-18" class="i">+| `bank`   | 21 txn/s    | 1120 txn/s        | 1346 txn/s  |
</a> 
 ## Debugging
 
<b>diff --git a/<a id="h1" href="../file/cluster/run.sh.html">cluster/run.sh</a> b/<a href="../file/cluster/run.sh.html">cluster/run.sh</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -15,8 +15,8 @@ cd &quot;$(dirname $0)&quot;
</a> cargo build --release --bin toydb
 
 # Start nodes 1-5 in the background, prefixing their output with the node ID.
<a href="#h1-0-3" id="h1-0-3" class="d">-echo &quot;Starting 5 nodes on ports 9601-9605. To connect to node 5, run:&quot;
</a><a href="#h1-0-4" id="h1-0-4" class="d">-echo &quot;cargo run --release --bin toysql&quot;
</a><a href="#h1-0-5" id="h1-0-5" class="i">+echo &quot;Starting 5 nodes on ports 9601-9605 with data under cluster/*/data/.&quot;
</a><a href="#h1-0-6" id="h1-0-6" class="i">+echo &quot;To connect to node 5, run: cargo run --release --bin toysql&quot;
</a> echo &quot;&quot;
 
 for ID in 1 2 3 4 5; do
</pre>
</div>
</body>
</html>
