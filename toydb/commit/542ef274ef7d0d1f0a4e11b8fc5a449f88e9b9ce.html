<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Remove async for Raft server processing - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/542ef274ef7d0d1f0a4e11b8fc5a449f88e9b9ce.html">542ef274ef7d0d1f0a4e11b8fc5a449f88e9b9ce</a>
<b>parent</b> <a href="../commit/56c808417171251e6ff0667070fbf42f4a9a0ef8.html">56c808417171251e6ff0667070fbf42f4a9a0ef8</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Tue,  9 Apr 2024 22:22:56 +0200

Remove async for Raft server processing

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Cargo.lock</a></td><td> | </td><td class="num">282</td><td><span class="i">++++</span><span class="d">---------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Cargo.toml</a></td><td> | </td><td class="num">14</td><td><span class="i"></span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/bin/toydb.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">+++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/error.rs</a></td><td> | </td><td class="num">30</td><td><span class="i"></span><span class="d">------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/raft/node/candidate.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/raft/node/follower.rs</a></td><td> | </td><td class="num">10</td><td><span class="i">++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/raft/node/leader.rs</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/raft/node/mod.rs</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/raft/server.rs</a></td><td> | </td><td class="num">198</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/server.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/sql/engine/raft.rs</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++</span><span class="d">----------</span></td></tr>
</table></pre><pre>11 files changed, 134 insertions(+), 472 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Cargo.lock.html">Cargo.lock</a> b/<a href="../file/Cargo.lock.html">Cargo.lock</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3,15 +3,6 @@
</a> version = 3
 
 [[package]]
<a href="#h0-0-3" id="h0-0-3" class="d">-name = &quot;addr2line&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="d">-version = &quot;0.21.0&quot;
</a><a href="#h0-0-5" id="h0-0-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-6" id="h0-0-6" class="d">-checksum = &quot;8a30b2e23b9e17a9f90641c7ab1549cd9b44f296d3ccbf309d2863cfe398a0cb&quot;
</a><a href="#h0-0-7" id="h0-0-7" class="d">-dependencies = [
</a><a href="#h0-0-8" id="h0-0-8" class="d">- &quot;gimli&quot;,
</a><a href="#h0-0-9" id="h0-0-9" class="d">-]
</a><a href="#h0-0-10" id="h0-0-10" class="d">-
</a><a href="#h0-0-11" id="h0-0-11" class="d">-[[package]]
</a> name = &quot;adler&quot;
 version = &quot;1.0.2&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-1" id="h0-1" class="h">@@ -61,7 +52,7 @@ version = &quot;1.0.2&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;e28923312444cdd728e4738b3f9c9cac739500909bb3d3c94b43551b16517648&quot;
 dependencies = [
<a href="#h0-1-3" id="h0-1-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-1-4" id="h0-1-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-2" id="h0-2" class="h">@@ -71,7 +62,7 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;1cd54b81ec8d6180e24654d0b371ad22fc3dd083b6ff8ba325b72e00c87660a7&quot;
 dependencies = [
  &quot;anstyle&quot;,
<a href="#h0-2-3" id="h0-2-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-2-4" id="h0-2-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-3" id="h0-3" class="h">@@ -91,7 +82,7 @@ version = &quot;0.2.14&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;d9b39be18770d11421cdb1b9947a45dd3f37e93092cbf377614828a319d5fee8&quot;
 dependencies = [
<a href="#h0-3-3" id="h0-3-3" class="d">- &quot;hermit-abi 0.1.19&quot;,
</a><a href="#h0-3-4" id="h0-3-4" class="i">+ &quot;hermit-abi&quot;,
</a>  &quot;libc&quot;,
  &quot;winapi&quot;,
 ]
<a href="#h0-4" id="h0-4" class="h">@@ -103,21 +94,6 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;f1fdabc7756949593fe60f30ec81974b613357de856987752631dea1e3394c80&quot;
 
 [[package]]
<a href="#h0-4-3" id="h0-4-3" class="d">-name = &quot;backtrace&quot;
</a><a href="#h0-4-4" id="h0-4-4" class="d">-version = &quot;0.3.71&quot;
</a><a href="#h0-4-5" id="h0-4-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-4-6" id="h0-4-6" class="d">-checksum = &quot;26b05800d2e817c8b3b4b54abd461726265fa9789ae34330622f2db9ee696f9d&quot;
</a><a href="#h0-4-7" id="h0-4-7" class="d">-dependencies = [
</a><a href="#h0-4-8" id="h0-4-8" class="d">- &quot;addr2line&quot;,
</a><a href="#h0-4-9" id="h0-4-9" class="d">- &quot;cc&quot;,
</a><a href="#h0-4-10" id="h0-4-10" class="d">- &quot;cfg-if&quot;,
</a><a href="#h0-4-11" id="h0-4-11" class="d">- &quot;libc&quot;,
</a><a href="#h0-4-12" id="h0-4-12" class="d">- &quot;miniz_oxide&quot;,
</a><a href="#h0-4-13" id="h0-4-13" class="d">- &quot;object&quot;,
</a><a href="#h0-4-14" id="h0-4-14" class="d">- &quot;rustc-demangle&quot;,
</a><a href="#h0-4-15" id="h0-4-15" class="d">-]
</a><a href="#h0-4-16" id="h0-4-16" class="d">-
</a><a href="#h0-4-17" id="h0-4-17" class="d">-[[package]]
</a> name = &quot;base64&quot;
 version = &quot;0.21.7&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-5" id="h0-5" class="h">@@ -174,18 +150,6 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;1fd0f2584146f6f2ef48085050886acf353beff7305ebd1ae69500e27c67f64b&quot;
 
 [[package]]
<a href="#h0-5-3" id="h0-5-3" class="d">-name = &quot;bytes&quot;
</a><a href="#h0-5-4" id="h0-5-4" class="d">-version = &quot;1.6.0&quot;
</a><a href="#h0-5-5" id="h0-5-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-5-6" id="h0-5-6" class="d">-checksum = &quot;514de17de45fdb8dc022b1a7975556c53c86f9f0aa5f534b98977b171857c2c9&quot;
</a><a href="#h0-5-7" id="h0-5-7" class="d">-
</a><a href="#h0-5-8" id="h0-5-8" class="d">-[[package]]
</a><a href="#h0-5-9" id="h0-5-9" class="d">-name = &quot;cc&quot;
</a><a href="#h0-5-10" id="h0-5-10" class="d">-version = &quot;1.0.90&quot;
</a><a href="#h0-5-11" id="h0-5-11" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-5-12" id="h0-5-12" class="d">-checksum = &quot;8cd6604a82acf3039f1144f54b8eb34e91ffba622051189e71b781822d5ee1f5&quot;
</a><a href="#h0-5-13" id="h0-5-13" class="d">-
</a><a href="#h0-5-14" id="h0-5-14" class="d">-[[package]]
</a> name = &quot;cfg-if&quot;
 version = &quot;1.0.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-6" id="h0-6" class="h">@@ -320,7 +284,7 @@ dependencies = [
</a>  &quot;encode_unicode&quot;,
  &quot;lazy_static&quot;,
  &quot;libc&quot;,
<a href="#h0-6-3" id="h0-6-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-6-4" id="h0-6-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-7" id="h0-7" class="h">@@ -501,18 +465,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-7-3" id="h0-7-3" class="d">-name = &quot;educe&quot;
</a><a href="#h0-7-4" id="h0-7-4" class="d">-version = &quot;0.5.11&quot;
</a><a href="#h0-7-5" id="h0-7-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-7-6" id="h0-7-6" class="d">-checksum = &quot;e4bd92664bf78c4d3dba9b7cdafce6fa15b13ed3ed16175218196942e99168a8&quot;
</a><a href="#h0-7-7" id="h0-7-7" class="d">-dependencies = [
</a><a href="#h0-7-8" id="h0-7-8" class="d">- &quot;enum-ordinalize&quot;,
</a><a href="#h0-7-9" id="h0-7-9" class="d">- &quot;proc-macro2&quot;,
</a><a href="#h0-7-10" id="h0-7-10" class="d">- &quot;quote&quot;,
</a><a href="#h0-7-11" id="h0-7-11" class="d">- &quot;syn 2.0.58&quot;,
</a><a href="#h0-7-12" id="h0-7-12" class="d">-]
</a><a href="#h0-7-13" id="h0-7-13" class="d">-
</a><a href="#h0-7-14" id="h0-7-14" class="d">-[[package]]
</a> name = &quot;either&quot;
 version = &quot;1.10.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-8" id="h0-8" class="h">@@ -531,26 +483,6 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;c34f04666d835ff5d62e058c3995147c06f42fe86ff053337632bca83e42702d&quot;
 
 [[package]]
<a href="#h0-8-3" id="h0-8-3" class="d">-name = &quot;enum-ordinalize&quot;
</a><a href="#h0-8-4" id="h0-8-4" class="d">-version = &quot;4.3.0&quot;
</a><a href="#h0-8-5" id="h0-8-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-8-6" id="h0-8-6" class="d">-checksum = &quot;fea0dcfa4e54eeb516fe454635a95753ddd39acda650ce703031c6973e315dd5&quot;
</a><a href="#h0-8-7" id="h0-8-7" class="d">-dependencies = [
</a><a href="#h0-8-8" id="h0-8-8" class="d">- &quot;enum-ordinalize-derive&quot;,
</a><a href="#h0-8-9" id="h0-8-9" class="d">-]
</a><a href="#h0-8-10" id="h0-8-10" class="d">-
</a><a href="#h0-8-11" id="h0-8-11" class="d">-[[package]]
</a><a href="#h0-8-12" id="h0-8-12" class="d">-name = &quot;enum-ordinalize-derive&quot;
</a><a href="#h0-8-13" id="h0-8-13" class="d">-version = &quot;4.3.1&quot;
</a><a href="#h0-8-14" id="h0-8-14" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-8-15" id="h0-8-15" class="d">-checksum = &quot;0d28318a75d4aead5c4db25382e8ef717932d0346600cacae6357eb5941bc5ff&quot;
</a><a href="#h0-8-16" id="h0-8-16" class="d">-dependencies = [
</a><a href="#h0-8-17" id="h0-8-17" class="d">- &quot;proc-macro2&quot;,
</a><a href="#h0-8-18" id="h0-8-18" class="d">- &quot;quote&quot;,
</a><a href="#h0-8-19" id="h0-8-19" class="d">- &quot;syn 2.0.58&quot;,
</a><a href="#h0-8-20" id="h0-8-20" class="d">-]
</a><a href="#h0-8-21" id="h0-8-21" class="d">-
</a><a href="#h0-8-22" id="h0-8-22" class="d">-[[package]]
</a> name = &quot;equivalent&quot;
 version = &quot;1.0.1&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-9" id="h0-9" class="h">@@ -563,7 +495,7 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;a258e46cdc063eb8519c00b9fc845fc47bcfca4130e2f08e88665ceda8474245&quot;
 dependencies = [
  &quot;libc&quot;,
<a href="#h0-9-3" id="h0-9-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-9-4" id="h0-9-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-10" id="h0-10" class="h">@@ -598,7 +530,7 @@ checksum = &quot;7e5768da2206272c81ef0b5e951a41862938a6070da63bcea197899942d3b947&quot;
</a> dependencies = [
  &quot;cfg-if&quot;,
  &quot;rustix&quot;,
<a href="#h0-10-3" id="h0-10-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-10-4" id="h0-10-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-11" id="h0-11" class="h">@@ -618,7 +550,7 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;21dabded2e32cd57ded879041205c60a4a4c4bab47bd0fd2fa8b01f30849f02b&quot;
 dependencies = [
  &quot;rustix&quot;,
<a href="#h0-11-3" id="h0-11-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-11-4" id="h0-11-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-12" id="h0-12" class="h">@@ -676,17 +608,6 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;a44623e20b9681a318efdd71c299b6b222ed6f231972bfe2f224ebad6311f0c1&quot;
 
 [[package]]
<a href="#h0-12-3" id="h0-12-3" class="d">-name = &quot;futures-macro&quot;
</a><a href="#h0-12-4" id="h0-12-4" class="d">-version = &quot;0.3.30&quot;
</a><a href="#h0-12-5" id="h0-12-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-12-6" id="h0-12-6" class="d">-checksum = &quot;87750cf4b7a4c0625b1529e4c543c2182106e4dedc60a2a6455e00d212c489ac&quot;
</a><a href="#h0-12-7" id="h0-12-7" class="d">-dependencies = [
</a><a href="#h0-12-8" id="h0-12-8" class="d">- &quot;proc-macro2&quot;,
</a><a href="#h0-12-9" id="h0-12-9" class="d">- &quot;quote&quot;,
</a><a href="#h0-12-10" id="h0-12-10" class="d">- &quot;syn 2.0.58&quot;,
</a><a href="#h0-12-11" id="h0-12-11" class="d">-]
</a><a href="#h0-12-12" id="h0-12-12" class="d">-
</a><a href="#h0-12-13" id="h0-12-13" class="d">-[[package]]
</a> name = &quot;futures-sink&quot;
 version = &quot;0.3.30&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-13" id="h0-13" class="h">@@ -707,7 +628,6 @@ dependencies = [
</a>  &quot;futures-channel&quot;,
  &quot;futures-core&quot;,
  &quot;futures-io&quot;,
<a href="#h0-13-3" id="h0-13-3" class="d">- &quot;futures-macro&quot;,
</a>  &quot;futures-sink&quot;,
  &quot;futures-task&quot;,
  &quot;memchr&quot;,
<a href="#h0-14" id="h0-14" class="h">@@ -738,12 +658,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-14-3" id="h0-14-3" class="d">-name = &quot;gimli&quot;
</a><a href="#h0-14-4" id="h0-14-4" class="d">-version = &quot;0.28.1&quot;
</a><a href="#h0-14-5" id="h0-14-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-14-6" id="h0-14-6" class="d">-checksum = &quot;4271d37baee1b8c7e4b708028c57d816cf9d2434acb33a549475f78c181f6253&quot;
</a><a href="#h0-14-7" id="h0-14-7" class="d">-
</a><a href="#h0-14-8" id="h0-14-8" class="d">-[[package]]
</a> name = &quot;goldenfile&quot;
 version = &quot;1.6.1&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-15" id="h0-15" class="h">@@ -809,12 +723,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-15-3" id="h0-15-3" class="d">-name = &quot;hermit-abi&quot;
</a><a href="#h0-15-4" id="h0-15-4" class="d">-version = &quot;0.3.9&quot;
</a><a href="#h0-15-5" id="h0-15-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-15-6" id="h0-15-6" class="d">-checksum = &quot;d231dfb89cfffdbc30e7fc41579ed6066ad03abda9e567ccafae602b97ec5024&quot;
</a><a href="#h0-15-7" id="h0-15-7" class="d">-
</a><a href="#h0-15-8" id="h0-15-8" class="d">-[[package]]
</a> name = &quot;hex&quot;
 version = &quot;0.4.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-16" id="h0-16" class="h">@@ -826,7 +734,7 @@ version = &quot;0.5.9&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;e3d1354bf6b7235cb4a0576c2619fd4ed18183f689b12b006a0ee7329eeff9a5&quot;
 dependencies = [
<a href="#h0-16-3" id="h0-16-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-16-4" id="h0-16-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-17" id="h0-17" class="h">@@ -946,17 +854,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-17-3" id="h0-17-3" class="d">-name = &quot;mio&quot;
</a><a href="#h0-17-4" id="h0-17-4" class="d">-version = &quot;0.8.11&quot;
</a><a href="#h0-17-5" id="h0-17-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-17-6" id="h0-17-6" class="d">-checksum = &quot;a4a650543ca06a924e8b371db273b2756685faae30f8487da1b56505a8f78b0c&quot;
</a><a href="#h0-17-7" id="h0-17-7" class="d">-dependencies = [
</a><a href="#h0-17-8" id="h0-17-8" class="d">- &quot;libc&quot;,
</a><a href="#h0-17-9" id="h0-17-9" class="d">- &quot;wasi&quot;,
</a><a href="#h0-17-10" id="h0-17-10" class="d">- &quot;windows-sys 0.48.0&quot;,
</a><a href="#h0-17-11" id="h0-17-11" class="d">-]
</a><a href="#h0-17-12" id="h0-17-12" class="d">-
</a><a href="#h0-17-13" id="h0-17-13" class="d">-[[package]]
</a> name = &quot;nibble_vec&quot;
 version = &quot;0.1.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-18" id="h0-18" class="h">@@ -1003,16 +900,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-18-3" id="h0-18-3" class="d">-name = &quot;num_cpus&quot;
</a><a href="#h0-18-4" id="h0-18-4" class="d">-version = &quot;1.16.0&quot;
</a><a href="#h0-18-5" id="h0-18-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-18-6" id="h0-18-6" class="d">-checksum = &quot;4161fcb6d602d4d2081af7c3a45852d875a03dd337a6bfdd6e06407b61342a43&quot;
</a><a href="#h0-18-7" id="h0-18-7" class="d">-dependencies = [
</a><a href="#h0-18-8" id="h0-18-8" class="d">- &quot;hermit-abi 0.3.9&quot;,
</a><a href="#h0-18-9" id="h0-18-9" class="d">- &quot;libc&quot;,
</a><a href="#h0-18-10" id="h0-18-10" class="d">-]
</a><a href="#h0-18-11" id="h0-18-11" class="d">-
</a><a href="#h0-18-12" id="h0-18-12" class="d">-[[package]]
</a> name = &quot;num_threads&quot;
 version = &quot;0.1.7&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-19" id="h0-19" class="h">@@ -1022,15 +909,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-19-3" id="h0-19-3" class="d">-name = &quot;object&quot;
</a><a href="#h0-19-4" id="h0-19-4" class="d">-version = &quot;0.32.2&quot;
</a><a href="#h0-19-5" id="h0-19-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-19-6" id="h0-19-6" class="d">-checksum = &quot;a6a622008b6e321afc04970976f62ee297fdbaa6f95318ca343e3eebb9648441&quot;
</a><a href="#h0-19-7" id="h0-19-7" class="d">-dependencies = [
</a><a href="#h0-19-8" id="h0-19-8" class="d">- &quot;memchr&quot;,
</a><a href="#h0-19-9" id="h0-19-9" class="d">-]
</a><a href="#h0-19-10" id="h0-19-10" class="d">-
</a><a href="#h0-19-11" id="h0-19-11" class="d">-[[package]]
</a> name = &quot;once_cell&quot;
 version = &quot;1.19.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-20" id="h0-20" class="h">@@ -1144,26 +1022,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-20-3" id="h0-20-3" class="d">-name = &quot;pin-project&quot;
</a><a href="#h0-20-4" id="h0-20-4" class="d">-version = &quot;1.1.5&quot;
</a><a href="#h0-20-5" id="h0-20-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-20-6" id="h0-20-6" class="d">-checksum = &quot;b6bf43b791c5b9e34c3d182969b4abb522f9343702850a2e57f460d00d09b4b3&quot;
</a><a href="#h0-20-7" id="h0-20-7" class="d">-dependencies = [
</a><a href="#h0-20-8" id="h0-20-8" class="d">- &quot;pin-project-internal&quot;,
</a><a href="#h0-20-9" id="h0-20-9" class="d">-]
</a><a href="#h0-20-10" id="h0-20-10" class="d">-
</a><a href="#h0-20-11" id="h0-20-11" class="d">-[[package]]
</a><a href="#h0-20-12" id="h0-20-12" class="d">-name = &quot;pin-project-internal&quot;
</a><a href="#h0-20-13" id="h0-20-13" class="d">-version = &quot;1.1.5&quot;
</a><a href="#h0-20-14" id="h0-20-14" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-20-15" id="h0-20-15" class="d">-checksum = &quot;2f38a4412a78282e09a2cf38d195ea5420d15ba0602cb375210efbc877243965&quot;
</a><a href="#h0-20-16" id="h0-20-16" class="d">-dependencies = [
</a><a href="#h0-20-17" id="h0-20-17" class="d">- &quot;proc-macro2&quot;,
</a><a href="#h0-20-18" id="h0-20-18" class="d">- &quot;quote&quot;,
</a><a href="#h0-20-19" id="h0-20-19" class="d">- &quot;syn 2.0.58&quot;,
</a><a href="#h0-20-20" id="h0-20-20" class="d">-]
</a><a href="#h0-20-21" id="h0-20-21" class="d">-
</a><a href="#h0-20-22" id="h0-20-22" class="d">-[[package]]
</a> name = &quot;pin-project-lite&quot;
 version = &quot;0.2.14&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-21" id="h0-21" class="h">@@ -1392,12 +1250,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-21-3" id="h0-21-3" class="d">-name = &quot;rustc-demangle&quot;
</a><a href="#h0-21-4" id="h0-21-4" class="d">-version = &quot;0.1.23&quot;
</a><a href="#h0-21-5" id="h0-21-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-21-6" id="h0-21-6" class="d">-checksum = &quot;d626bb9dae77e28219937af045c257c28bfd3f69333c512553507f5f9798cb76&quot;
</a><a href="#h0-21-7" id="h0-21-7" class="d">-
</a><a href="#h0-21-8" id="h0-21-8" class="d">-[[package]]
</a> name = &quot;rustix&quot;
 version = &quot;0.38.32&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-22" id="h0-22" class="h">@@ -1407,7 +1259,7 @@ dependencies = [
</a>  &quot;errno&quot;,
  &quot;libc&quot;,
  &quot;linux-raw-sys&quot;,
<a href="#h0-22-3" id="h0-22-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-22-4" id="h0-22-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-23" id="h0-23" class="h">@@ -1429,7 +1281,7 @@ dependencies = [
</a>  &quot;unicode-segmentation&quot;,
  &quot;unicode-width&quot;,
  &quot;utf8parse&quot;,
<a href="#h0-23-3" id="h0-23-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-23-4" id="h0-23-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-24" id="h0-24" class="h">@@ -1587,16 +1439,6 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> checksum = &quot;3c5e1a9a646d36c3599cd173a41282daf47c44583ad367b8e6837255952e5c67&quot;
 
 [[package]]
<a href="#h0-24-3" id="h0-24-3" class="d">-name = &quot;socket2&quot;
</a><a href="#h0-24-4" id="h0-24-4" class="d">-version = &quot;0.5.6&quot;
</a><a href="#h0-24-5" id="h0-24-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-24-6" id="h0-24-6" class="d">-checksum = &quot;05ffd9c0a93b7543e062e759284fcf5f5e3b098501104bfbdde4d404db792871&quot;
</a><a href="#h0-24-7" id="h0-24-7" class="d">-dependencies = [
</a><a href="#h0-24-8" id="h0-24-8" class="d">- &quot;libc&quot;,
</a><a href="#h0-24-9" id="h0-24-9" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-24-10" id="h0-24-10" class="d">-]
</a><a href="#h0-24-11" id="h0-24-11" class="d">-
</a><a href="#h0-24-12" id="h0-24-12" class="d">-[[package]]
</a> name = &quot;strsim&quot;
 version = &quot;0.10.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-25" id="h0-25" class="h">@@ -1649,7 +1491,7 @@ dependencies = [
</a>  &quot;cfg-if&quot;,
  &quot;fastrand&quot;,
  &quot;rustix&quot;,
<a href="#h0-25-3" id="h0-25-3" class="d">- &quot;windows-sys 0.52.0&quot;,
</a><a href="#h0-25-4" id="h0-25-4" class="i">+ &quot;windows-sys&quot;,
</a> ]
 
 [[package]]
<a href="#h0-26" id="h0-26" class="h">@@ -1730,74 +1572,6 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-26-3" id="h0-26-3" class="d">-name = &quot;tokio&quot;
</a><a href="#h0-26-4" id="h0-26-4" class="d">-version = &quot;1.37.0&quot;
</a><a href="#h0-26-5" id="h0-26-5" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-26-6" id="h0-26-6" class="d">-checksum = &quot;1adbebffeca75fcfd058afa480fb6c0b81e165a0323f9c9d39c9697e37c46787&quot;
</a><a href="#h0-26-7" id="h0-26-7" class="d">-dependencies = [
</a><a href="#h0-26-8" id="h0-26-8" class="d">- &quot;backtrace&quot;,
</a><a href="#h0-26-9" id="h0-26-9" class="d">- &quot;bytes&quot;,
</a><a href="#h0-26-10" id="h0-26-10" class="d">- &quot;libc&quot;,
</a><a href="#h0-26-11" id="h0-26-11" class="d">- &quot;mio&quot;,
</a><a href="#h0-26-12" id="h0-26-12" class="d">- &quot;num_cpus&quot;,
</a><a href="#h0-26-13" id="h0-26-13" class="d">- &quot;pin-project-lite&quot;,
</a><a href="#h0-26-14" id="h0-26-14" class="d">- &quot;socket2&quot;,
</a><a href="#h0-26-15" id="h0-26-15" class="d">- &quot;tokio-macros&quot;,
</a><a href="#h0-26-16" id="h0-26-16" class="d">- &quot;windows-sys 0.48.0&quot;,
</a><a href="#h0-26-17" id="h0-26-17" class="d">-]
</a><a href="#h0-26-18" id="h0-26-18" class="d">-
</a><a href="#h0-26-19" id="h0-26-19" class="d">-[[package]]
</a><a href="#h0-26-20" id="h0-26-20" class="d">-name = &quot;tokio-macros&quot;
</a><a href="#h0-26-21" id="h0-26-21" class="d">-version = &quot;2.2.0&quot;
</a><a href="#h0-26-22" id="h0-26-22" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-26-23" id="h0-26-23" class="d">-checksum = &quot;5b8a1e28f2deaa14e508979454cb3a223b10b938b45af148bc0986de36f1923b&quot;
</a><a href="#h0-26-24" id="h0-26-24" class="d">-dependencies = [
</a><a href="#h0-26-25" id="h0-26-25" class="d">- &quot;proc-macro2&quot;,
</a><a href="#h0-26-26" id="h0-26-26" class="d">- &quot;quote&quot;,
</a><a href="#h0-26-27" id="h0-26-27" class="d">- &quot;syn 2.0.58&quot;,
</a><a href="#h0-26-28" id="h0-26-28" class="d">-]
</a><a href="#h0-26-29" id="h0-26-29" class="d">-
</a><a href="#h0-26-30" id="h0-26-30" class="d">-[[package]]
</a><a href="#h0-26-31" id="h0-26-31" class="d">-name = &quot;tokio-serde&quot;
</a><a href="#h0-26-32" id="h0-26-32" class="d">-version = &quot;0.9.0&quot;
</a><a href="#h0-26-33" id="h0-26-33" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-26-34" id="h0-26-34" class="d">-checksum = &quot;caf600e7036b17782571dd44fa0a5cea3c82f60db5137f774a325a76a0d6852b&quot;
</a><a href="#h0-26-35" id="h0-26-35" class="d">-dependencies = [
</a><a href="#h0-26-36" id="h0-26-36" class="d">- &quot;bincode&quot;,
</a><a href="#h0-26-37" id="h0-26-37" class="d">- &quot;bytes&quot;,
</a><a href="#h0-26-38" id="h0-26-38" class="d">- &quot;educe&quot;,
</a><a href="#h0-26-39" id="h0-26-39" class="d">- &quot;futures-core&quot;,
</a><a href="#h0-26-40" id="h0-26-40" class="d">- &quot;futures-sink&quot;,
</a><a href="#h0-26-41" id="h0-26-41" class="d">- &quot;pin-project&quot;,
</a><a href="#h0-26-42" id="h0-26-42" class="d">- &quot;serde&quot;,
</a><a href="#h0-26-43" id="h0-26-43" class="d">-]
</a><a href="#h0-26-44" id="h0-26-44" class="d">-
</a><a href="#h0-26-45" id="h0-26-45" class="d">-[[package]]
</a><a href="#h0-26-46" id="h0-26-46" class="d">-name = &quot;tokio-stream&quot;
</a><a href="#h0-26-47" id="h0-26-47" class="d">-version = &quot;0.1.15&quot;
</a><a href="#h0-26-48" id="h0-26-48" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-26-49" id="h0-26-49" class="d">-checksum = &quot;267ac89e0bec6e691e5813911606935d77c476ff49024f98abcea3e7b15e37af&quot;
</a><a href="#h0-26-50" id="h0-26-50" class="d">-dependencies = [
</a><a href="#h0-26-51" id="h0-26-51" class="d">- &quot;futures-core&quot;,
</a><a href="#h0-26-52" id="h0-26-52" class="d">- &quot;pin-project-lite&quot;,
</a><a href="#h0-26-53" id="h0-26-53" class="d">- &quot;tokio&quot;,
</a><a href="#h0-26-54" id="h0-26-54" class="d">-]
</a><a href="#h0-26-55" id="h0-26-55" class="d">-
</a><a href="#h0-26-56" id="h0-26-56" class="d">-[[package]]
</a><a href="#h0-26-57" id="h0-26-57" class="d">-name = &quot;tokio-util&quot;
</a><a href="#h0-26-58" id="h0-26-58" class="d">-version = &quot;0.7.10&quot;
</a><a href="#h0-26-59" id="h0-26-59" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-26-60" id="h0-26-60" class="d">-checksum = &quot;5419f34732d9eb6ee4c3578b7989078579b7f039cbbb9ca2c4da015749371e15&quot;
</a><a href="#h0-26-61" id="h0-26-61" class="d">-dependencies = [
</a><a href="#h0-26-62" id="h0-26-62" class="d">- &quot;bytes&quot;,
</a><a href="#h0-26-63" id="h0-26-63" class="d">- &quot;futures-core&quot;,
</a><a href="#h0-26-64" id="h0-26-64" class="d">- &quot;futures-sink&quot;,
</a><a href="#h0-26-65" id="h0-26-65" class="d">- &quot;pin-project-lite&quot;,
</a><a href="#h0-26-66" id="h0-26-66" class="d">- &quot;tokio&quot;,
</a><a href="#h0-26-67" id="h0-26-67" class="d">- &quot;tracing&quot;,
</a><a href="#h0-26-68" id="h0-26-68" class="d">-]
</a><a href="#h0-26-69" id="h0-26-69" class="d">-
</a><a href="#h0-26-70" id="h0-26-70" class="d">-[[package]]
</a> name = &quot;toml&quot;
 version = &quot;0.8.12&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-27" id="h0-27" class="h">@@ -1842,8 +1616,6 @@ dependencies = [
</a>  &quot;derivative&quot;,
  &quot;escargot&quot;,
  &quot;fs4&quot;,
<a href="#h0-27-3" id="h0-27-3" class="d">- &quot;futures&quot;,
</a><a href="#h0-27-4" id="h0-27-4" class="d">- &quot;futures-util&quot;,
</a>  &quot;goldenfile&quot;,
  &quot;hdrhistogram&quot;,
  &quot;hex&quot;,
<a href="#h0-28" id="h0-28" class="h">@@ -1863,33 +1635,10 @@ dependencies = [
</a>  &quot;simplelog&quot;,
  &quot;tempdir&quot;,
  &quot;tempfile&quot;,
<a href="#h0-28-3" id="h0-28-3" class="d">- &quot;tokio&quot;,
</a><a href="#h0-28-4" id="h0-28-4" class="d">- &quot;tokio-serde&quot;,
</a><a href="#h0-28-5" id="h0-28-5" class="d">- &quot;tokio-stream&quot;,
</a><a href="#h0-28-6" id="h0-28-6" class="d">- &quot;tokio-util&quot;,
</a>  &quot;uuid&quot;,
 ]
 
 [[package]]
<a href="#h0-28-11" id="h0-28-11" class="d">-name = &quot;tracing&quot;
</a><a href="#h0-28-12" id="h0-28-12" class="d">-version = &quot;0.1.40&quot;
</a><a href="#h0-28-13" id="h0-28-13" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-28-14" id="h0-28-14" class="d">-checksum = &quot;c3523ab5a71916ccf420eebdf5521fcef02141234bbc0b8a49f2fdc4544364ef&quot;
</a><a href="#h0-28-15" id="h0-28-15" class="d">-dependencies = [
</a><a href="#h0-28-16" id="h0-28-16" class="d">- &quot;pin-project-lite&quot;,
</a><a href="#h0-28-17" id="h0-28-17" class="d">- &quot;tracing-core&quot;,
</a><a href="#h0-28-18" id="h0-28-18" class="d">-]
</a><a href="#h0-28-19" id="h0-28-19" class="d">-
</a><a href="#h0-28-20" id="h0-28-20" class="d">-[[package]]
</a><a href="#h0-28-21" id="h0-28-21" class="d">-name = &quot;tracing-core&quot;
</a><a href="#h0-28-22" id="h0-28-22" class="d">-version = &quot;0.1.32&quot;
</a><a href="#h0-28-23" id="h0-28-23" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-28-24" id="h0-28-24" class="d">-checksum = &quot;c06d3da6113f116aaee68e4d601191614c9053067f9ab7f6edbcb161237daa54&quot;
</a><a href="#h0-28-25" id="h0-28-25" class="d">-dependencies = [
</a><a href="#h0-28-26" id="h0-28-26" class="d">- &quot;once_cell&quot;,
</a><a href="#h0-28-27" id="h0-28-27" class="d">-]
</a><a href="#h0-28-28" id="h0-28-28" class="d">-
</a><a href="#h0-28-29" id="h0-28-29" class="d">-[[package]]
</a> name = &quot;typenum&quot;
 version = &quot;1.17.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-29" id="h0-29" class="h">@@ -1979,15 +1728,6 @@ checksum = &quot;712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f&quot;
</a> 
 [[package]]
 name = &quot;windows-sys&quot;
<a href="#h0-29-3" id="h0-29-3" class="d">-version = &quot;0.48.0&quot;
</a><a href="#h0-29-4" id="h0-29-4" class="d">-source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-29-5" id="h0-29-5" class="d">-checksum = &quot;677d2418bec65e3338edb076e806bc1ec15693c5d0104683f2efe857f61056a9&quot;
</a><a href="#h0-29-6" id="h0-29-6" class="d">-dependencies = [
</a><a href="#h0-29-7" id="h0-29-7" class="d">- &quot;windows-targets 0.48.5&quot;,
</a><a href="#h0-29-8" id="h0-29-8" class="d">-]
</a><a href="#h0-29-9" id="h0-29-9" class="d">-
</a><a href="#h0-29-10" id="h0-29-10" class="d">-[[package]]
</a><a href="#h0-29-11" id="h0-29-11" class="d">-name = &quot;windows-sys&quot;
</a> version = &quot;0.52.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 checksum = &quot;282be5f36a8ce781fad8c8ae18fa3f9beff57ec1b52cb3de0789201425d9a33d&quot;
<b>diff --git a/<a id="h1" href="../file/Cargo.toml.html">Cargo.toml</a> b/<a href="../file/Cargo.toml.html">Cargo.toml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -16,8 +16,6 @@ config = &quot;~0.14.0&quot;
</a> crossbeam = { version = &quot;0.8.4&quot;, features = [&quot;crossbeam-channel&quot;] }
 derivative = &quot;~2.2.0&quot;
 fs4 = &quot;~0.8.1&quot;
<a href="#h1-0-3" id="h1-0-3" class="d">-futures = &quot;~0.3.15&quot;
</a><a href="#h1-0-4" id="h1-0-4" class="d">-futures-util = &quot;~0.3.15&quot;
</a> hdrhistogram = &quot;~7.5.4&quot;
 hex = &quot;~0.4.3&quot;
 itertools = &quot;0.12.1&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -31,18 +29,6 @@ serde = &quot;~1.0.126&quot;
</a> serde_bytes = &quot;~0.11.12&quot;
 serde_derive = &quot;~1.0.126&quot;
 simplelog = &quot;~0.12.1&quot;
<a href="#h1-1-3" id="h1-1-3" class="d">-tokio = { version = &quot;~1.37.0&quot;, features = [
</a><a href="#h1-1-4" id="h1-1-4" class="d">-    &quot;macros&quot;,
</a><a href="#h1-1-5" id="h1-1-5" class="d">-    &quot;rt&quot;,
</a><a href="#h1-1-6" id="h1-1-6" class="d">-    &quot;rt-multi-thread&quot;,
</a><a href="#h1-1-7" id="h1-1-7" class="d">-    &quot;net&quot;,
</a><a href="#h1-1-8" id="h1-1-8" class="d">-    &quot;io-util&quot;,
</a><a href="#h1-1-9" id="h1-1-9" class="d">-    &quot;time&quot;,
</a><a href="#h1-1-10" id="h1-1-10" class="d">-    &quot;sync&quot;,
</a><a href="#h1-1-11" id="h1-1-11" class="d">-] }
</a><a href="#h1-1-12" id="h1-1-12" class="d">-tokio-serde = { version = &quot;~0.9.0&quot;, features = [&quot;bincode&quot;] }
</a><a href="#h1-1-13" id="h1-1-13" class="d">-tokio-stream = { version = &quot;~0.1.6&quot;, features = [&quot;net&quot;] }
</a><a href="#h1-1-14" id="h1-1-14" class="d">-tokio-util = { version = &quot;~0.7.8&quot;, features = [&quot;codec&quot;] }
</a> uuid = { version = &quot;~1.8.0&quot;, features = [&quot;v4&quot;] }
 
 [dev-dependencies]
<b>diff --git a/<a id="h2" href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a> b/<a href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -8,7 +8,6 @@
</a> 
 use serde_derive::Deserialize;
 use std::collections::HashMap;
<a href="#h2-0-3" id="h2-0-3" class="d">-use tokio::net::TcpListener;
</a> use toydb::error::{Error, Result};
 use toydb::raft;
 use toydb::sql;
<a href="#h2-1" id="h2-1" class="h">@@ -17,8 +16,7 @@ use toydb::Server;
</a> 
 const COMPACT_MIN_BYTES: u64 = 1024 * 1024;
 
<a href="#h2-1-3" id="h2-1-3" class="d">-#[tokio::main]
</a><a href="#h2-1-4" id="h2-1-4" class="d">-async fn main() -&gt; Result&lt;()&gt; {
</a><a href="#h2-1-5" id="h2-1-5" class="i">+fn main() -&gt; Result&lt;()&gt; {
</a>     let args = clap::command!()
         .arg(
             clap::Arg::new(&quot;config&quot;)
<a href="#h2-2" id="h2-2" class="h">@@ -68,10 +66,10 @@ async fn main() -&gt; Result&lt;()&gt; {
</a> 
     let srv = Server::new(cfg.id, cfg.peers, raft_log, raft_state)?;
 
<a href="#h2-2-3" id="h2-2-3" class="d">-    let raft_listener = TcpListener::bind(&amp;cfg.listen_raft).await?;
</a><a href="#h2-2-4" id="h2-2-4" class="i">+    let raft_listener = std::net::TcpListener::bind(&amp;cfg.listen_raft)?;
</a>     let sql_listener = std::net::TcpListener::bind(&amp;cfg.listen_sql)?;
 
<a href="#h2-2-7" id="h2-2-7" class="d">-    srv.serve(raft_listener, sql_listener).await
</a><a href="#h2-2-8" id="h2-2-8" class="i">+    srv.serve(raft_listener, sql_listener)
</a> }
 
 #[derive(Debug, Deserialize)]
<b>diff --git a/<a id="h3" href="../file/src/error.rs.html">src/error.rs</a> b/<a href="../file/src/error.rs.html">src/error.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -168,33 +168,3 @@ impl&lt;T&gt; From&lt;std::sync::PoisonError&lt;T&gt;&gt; for Error {
</a>         Error::Internal(err.to_string())
     }
 }
<a href="#h3-0-3" id="h3-0-3" class="d">-
</a><a href="#h3-0-4" id="h3-0-4" class="d">-impl From&lt;tokio::task::JoinError&gt; for Error {
</a><a href="#h3-0-5" id="h3-0-5" class="d">-    fn from(err: tokio::task::JoinError) -&gt; Self {
</a><a href="#h3-0-6" id="h3-0-6" class="d">-        Error::Internal(err.to_string())
</a><a href="#h3-0-7" id="h3-0-7" class="d">-    }
</a><a href="#h3-0-8" id="h3-0-8" class="d">-}
</a><a href="#h3-0-9" id="h3-0-9" class="d">-
</a><a href="#h3-0-10" id="h3-0-10" class="d">-impl From&lt;tokio::sync::mpsc::error::TryRecvError&gt; for Error {
</a><a href="#h3-0-11" id="h3-0-11" class="d">-    fn from(err: tokio::sync::mpsc::error::TryRecvError) -&gt; Self {
</a><a href="#h3-0-12" id="h3-0-12" class="d">-        Error::Internal(err.to_string())
</a><a href="#h3-0-13" id="h3-0-13" class="d">-    }
</a><a href="#h3-0-14" id="h3-0-14" class="d">-}
</a><a href="#h3-0-15" id="h3-0-15" class="d">-
</a><a href="#h3-0-16" id="h3-0-16" class="d">-impl&lt;T&gt; From&lt;tokio::sync::mpsc::error::SendError&lt;T&gt;&gt; for Error {
</a><a href="#h3-0-17" id="h3-0-17" class="d">-    fn from(err: tokio::sync::mpsc::error::SendError&lt;T&gt;) -&gt; Self {
</a><a href="#h3-0-18" id="h3-0-18" class="d">-        Error::Internal(err.to_string())
</a><a href="#h3-0-19" id="h3-0-19" class="d">-    }
</a><a href="#h3-0-20" id="h3-0-20" class="d">-}
</a><a href="#h3-0-21" id="h3-0-21" class="d">-
</a><a href="#h3-0-22" id="h3-0-22" class="d">-impl&lt;T&gt; From&lt;tokio::sync::mpsc::error::TrySendError&lt;T&gt;&gt; for Error {
</a><a href="#h3-0-23" id="h3-0-23" class="d">-    fn from(err: tokio::sync::mpsc::error::TrySendError&lt;T&gt;) -&gt; Self {
</a><a href="#h3-0-24" id="h3-0-24" class="d">-        Error::Internal(err.to_string())
</a><a href="#h3-0-25" id="h3-0-25" class="d">-    }
</a><a href="#h3-0-26" id="h3-0-26" class="d">-}
</a><a href="#h3-0-27" id="h3-0-27" class="d">-
</a><a href="#h3-0-28" id="h3-0-28" class="d">-impl From&lt;tokio::sync::oneshot::error::RecvError&gt; for Error {
</a><a href="#h3-0-29" id="h3-0-29" class="d">-    fn from(err: tokio::sync::oneshot::error::RecvError) -&gt; Self {
</a><a href="#h3-0-30" id="h3-0-30" class="d">-        Error::Internal(err.to_string())
</a><a href="#h3-0-31" id="h3-0-31" class="d">-    }
</a><a href="#h3-0-32" id="h3-0-32" class="d">-}
</a><b>diff --git a/<a id="h4" href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a> b/<a href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -173,11 +173,10 @@ mod tests {
</a>     use super::super::tests::{assert_messages, assert_node};
     use super::*;
     use crate::storage;
<a href="#h4-0-3" id="h4-0-3" class="d">-    use tokio::sync::mpsc;
</a> 
     #[allow(clippy::type_complexity)]
<a href="#h4-0-6" id="h4-0-6" class="d">-    fn setup() -&gt; Result&lt;(RawNode&lt;Candidate&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
</a><a href="#h4-0-7" id="h4-0-7" class="d">-        let (node_tx, node_rx) = mpsc::unbounded_channel();
</a><a href="#h4-0-8" id="h4-0-8" class="i">+    fn setup() -&gt; Result&lt;(RawNode&lt;Candidate&gt;, crossbeam::channel::Receiver&lt;Message&gt;)&gt; {
</a><a href="#h4-0-9" id="h4-0-9" class="i">+        let (node_tx, node_rx) = crossbeam::channel::unbounded();
</a>         let state = Box::new(TestState::new(0));
         let mut log = Log::new(storage::Memory::new(), false)?;
 
<b>diff --git a/<a id="h5" href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a> b/<a href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -4,7 +4,6 @@ use crate::error::{Error, Result};
</a> 
 use ::log::{debug, info};
 use std::collections::HashSet;
<a href="#h5-0-3" id="h5-0-3" class="d">-use tokio::sync::mpsc;
</a> 
 // A follower replicates state from a leader.
 #[derive(Clone, Debug, PartialEq)]
<a href="#h5-1" id="h5-1" class="h">@@ -44,7 +43,7 @@ impl RawNode&lt;Follower&gt; {
</a>         peers: HashSet&lt;NodeID&gt;,
         mut log: Log,
         state: Box&lt;dyn State&gt;,
<a href="#h5-1-3" id="h5-1-3" class="d">-        node_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h5-1-4" id="h5-1-4" class="i">+        node_tx: crossbeam::channel::Sender&lt;Message&gt;,
</a>     ) -&gt; Result&lt;Self&gt; {
         let (term, voted_for) = log.get_term()?;
         let role = Follower::new(None, voted_for);
<a href="#h5-2" id="h5-2" class="h">@@ -288,11 +287,10 @@ pub mod tests {
</a>     use super::*;
     use crate::error::Error;
     use crate::storage;
<a href="#h5-2-3" id="h5-2-3" class="d">-    use tokio::sync::mpsc;
</a> 
     #[allow(clippy::type_complexity)]
<a href="#h5-2-6" id="h5-2-6" class="d">-    fn setup() -&gt; Result&lt;(RawNode&lt;Follower&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
</a><a href="#h5-2-7" id="h5-2-7" class="d">-        let (node_tx, node_rx) = mpsc::unbounded_channel();
</a><a href="#h5-2-8" id="h5-2-8" class="i">+    fn setup() -&gt; Result&lt;(RawNode&lt;Follower&gt;, crossbeam::channel::Receiver&lt;Message&gt;)&gt; {
</a><a href="#h5-2-9" id="h5-2-9" class="i">+        let (node_tx, node_rx) = crossbeam::channel::unbounded();
</a>         let state = Box::new(TestState::new(0));
         let mut log = Log::new(storage::Memory::new(), false)?;
         log.append(1, Some(vec![0x01]))?;
<a href="#h5-3" id="h5-3" class="h">@@ -590,7 +588,7 @@ pub mod tests {
</a>     // AppendEntries accepts some entries at base 0 without changes
     fn step_appendentries_base0() -&gt; Result&lt;()&gt; {
         // TODO: Move this into a setup function.
<a href="#h5-3-3" id="h5-3-3" class="d">-        let (node_tx, mut node_rx) = mpsc::unbounded_channel();
</a><a href="#h5-3-4" id="h5-3-4" class="i">+        let (node_tx, mut node_rx) = crossbeam::channel::unbounded();
</a>         let mut log = Log::new(storage::Memory::new(), false)?;
         log.append(1, Some(vec![0x01]))?;
         log.append(1, Some(vec![0x02]))?;
<b>diff --git a/<a id="h6" href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a> b/<a href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -407,11 +407,10 @@ mod tests {
</a>     use super::*;
     use crate::storage;
     use pretty_assertions::assert_eq;
<a href="#h6-0-3" id="h6-0-3" class="d">-    use tokio::sync::mpsc;
</a> 
     #[allow(clippy::type_complexity)]
<a href="#h6-0-6" id="h6-0-6" class="d">-    fn setup() -&gt; Result&lt;(RawNode&lt;Leader&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
</a><a href="#h6-0-7" id="h6-0-7" class="d">-        let (node_tx, node_rx) = mpsc::unbounded_channel();
</a><a href="#h6-0-8" id="h6-0-8" class="i">+    fn setup() -&gt; Result&lt;(RawNode&lt;Leader&gt;, crossbeam::channel::Receiver&lt;Message&gt;)&gt; {
</a><a href="#h6-0-9" id="h6-0-9" class="i">+        let (node_tx, node_rx) = crossbeam::channel::unbounded();
</a>         let peers = HashSet::from([2, 3, 4, 5]);
         let state = Box::new(TestState::new(0));
         let mut log = Log::new(storage::Memory::new(), false)?;
<a href="#h6-1" id="h6-1" class="h">@@ -688,7 +687,7 @@ mod tests {
</a>     #[test]
     // Sending a mutate request should append it to log, replicate it to peers, and register notification.
     fn step_clientrequest_mutate() -&gt; Result&lt;()&gt; {
<a href="#h6-1-3" id="h6-1-3" class="d">-        let (leader, mut node_rx) = setup()?;
</a><a href="#h6-1-4" id="h6-1-4" class="i">+        let (leader, node_rx) = setup()?;
</a>         let peers = leader.peers.clone();
         let mut node: Node = leader.into();
 
<b>diff --git a/<a id="h7" href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a> b/<a href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -11,7 +11,6 @@ use leader::Leader;
</a> use ::log::debug;
 use rand::Rng as _;
 use std::collections::HashSet;
<a href="#h7-0-3" id="h7-0-3" class="d">-use tokio::sync::mpsc;
</a> 
 /// A node ID.
 pub type NodeID = u8;
<a href="#h7-1" id="h7-1" class="h">@@ -56,7 +55,7 @@ impl Node {
</a>         peers: HashSet&lt;NodeID&gt;,
         log: Log,
         state: Box&lt;dyn State&gt;,
<a href="#h7-1-3" id="h7-1-3" class="d">-        node_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h7-1-4" id="h7-1-4" class="i">+        node_tx: crossbeam::channel::Sender&lt;Message&gt;,
</a>     ) -&gt; Result&lt;Self&gt; {
         let node = RawNode::new(id, peers, log, state, node_tx)?;
         if node.peers.is_empty() {
<a href="#h7-2" id="h7-2" class="h">@@ -126,7 +125,7 @@ pub struct RawNode&lt;R: Role = Follower&gt; {
</a>     term: Term,
     log: Log,
     state: Box&lt;dyn State&gt;,
<a href="#h7-2-3" id="h7-2-3" class="d">-    node_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h7-2-4" id="h7-2-4" class="i">+    node_tx: crossbeam::channel::Sender&lt;Message&gt;,
</a>     role: R,
 }
 
<a href="#h7-3" id="h7-3" class="h">@@ -258,11 +257,10 @@ mod tests {
</a>     use crate::storage;
     use pretty_assertions::assert_eq;
     use std::collections::HashSet;
<a href="#h7-3-3" id="h7-3-3" class="d">-    use tokio::sync::mpsc;
</a> 
     #[track_caller]
     pub fn assert_messages&lt;T: std::fmt::Debug + PartialEq&gt;(
<a href="#h7-3-7" id="h7-3-7" class="d">-        rx: &amp;mut mpsc::UnboundedReceiver&lt;T&gt;,
</a><a href="#h7-3-8" id="h7-3-8" class="i">+        rx: &amp;mut crossbeam::channel::Receiver&lt;T&gt;,
</a>         msgs: Vec&lt;T&gt;,
     ) {
         let mut actual = Vec::new();
<a href="#h7-4" id="h7-4" class="h">@@ -432,14 +430,14 @@ mod tests {
</a>         NodeAsserter::new(node)
     }
 
<a href="#h7-4-3" id="h7-4-3" class="d">-    fn setup_rolenode() -&gt; Result&lt;(RawNode&lt;Follower&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
</a><a href="#h7-4-4" id="h7-4-4" class="i">+    fn setup_rolenode() -&gt; Result&lt;(RawNode&lt;Follower&gt;, crossbeam::channel::Receiver&lt;Message&gt;)&gt; {
</a>         setup_rolenode_peers(vec![2, 3])
     }
 
     fn setup_rolenode_peers(
         peers: Vec&lt;NodeID&gt;,
<a href="#h7-4-10" id="h7-4-10" class="d">-    ) -&gt; Result&lt;(RawNode&lt;Follower&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
</a><a href="#h7-4-11" id="h7-4-11" class="d">-        let (node_tx, node_rx) = mpsc::unbounded_channel();
</a><a href="#h7-4-12" id="h7-4-12" class="i">+    ) -&gt; Result&lt;(RawNode&lt;Follower&gt;, crossbeam::channel::Receiver&lt;Message&gt;)&gt; {
</a><a href="#h7-4-13" id="h7-4-13" class="i">+        let (node_tx, node_rx) = crossbeam::channel::unbounded();
</a>         let node = RawNode {
             role: Follower::new(None, None),
             id: 1,
<a href="#h7-5" id="h7-5" class="h">@@ -454,7 +452,7 @@ mod tests {
</a> 
     #[test]
     fn new() -&gt; Result&lt;()&gt; {
<a href="#h7-5-3" id="h7-5-3" class="d">-        let (node_tx, _) = mpsc::unbounded_channel();
</a><a href="#h7-5-4" id="h7-5-4" class="i">+        let (node_tx, _) = crossbeam::channel::unbounded();
</a>         let node = Node::new(
             1,
             HashSet::from([2, 3]),
<a href="#h7-6" id="h7-6" class="h">@@ -475,7 +473,7 @@ mod tests {
</a> 
     #[test]
     fn new_single() -&gt; Result&lt;()&gt; {
<a href="#h7-6-3" id="h7-6-3" class="d">-        let (node_tx, _node_rx) = mpsc::unbounded_channel();
</a><a href="#h7-6-4" id="h7-6-4" class="i">+        let (node_tx, _node_rx) = crossbeam::channel::unbounded();
</a>         let node = Node::new(
             1,
             HashSet::new(),
<b>diff --git a/<a id="h8" href="../file/src/raft/server.rs.html">src/raft/server.rs</a> b/<a href="../file/src/raft/server.rs.html">src/raft/server.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,20 +1,17 @@
</a> use super::{Address, Event, Log, Message, Node, NodeID, Request, Response, State};
<a href="#h8-0-1" id="h8-0-1" class="i">+use crate::encoding::bincode;
</a> use crate::error::{Error, Result};
 
 use ::log::{debug, error};
<a href="#h8-0-5" id="h8-0-5" class="d">-use futures::{sink::SinkExt as _, FutureExt as _};
</a> use std::collections::HashMap;
 use std::time::Duration;
<a href="#h8-0-8" id="h8-0-8" class="d">-use tokio::net::{TcpListener, TcpStream};
</a><a href="#h8-0-9" id="h8-0-9" class="d">-use tokio::sync::{mpsc, oneshot};
</a><a href="#h8-0-10" id="h8-0-10" class="d">-use tokio_stream::wrappers::{ReceiverStream, TcpListenerStream, UnboundedReceiverStream};
</a><a href="#h8-0-11" id="h8-0-11" class="d">-use tokio_stream::StreamExt as _;
</a><a href="#h8-0-12" id="h8-0-12" class="d">-use tokio_util::codec::{Framed, LengthDelimitedCodec};
</a> use uuid::Uuid;
 
 // TODO: simplify these types.
<a href="#h8-0-16" id="h8-0-16" class="d">-pub type ClientSender = mpsc::UnboundedSender&lt;(Request, oneshot::Sender&lt;Result&lt;Response&gt;&gt;)&gt;;
</a><a href="#h8-0-17" id="h8-0-17" class="d">-pub type ClientReceiver = mpsc::UnboundedReceiver&lt;(Request, oneshot::Sender&lt;Result&lt;Response&gt;&gt;)&gt;;
</a><a href="#h8-0-18" id="h8-0-18" class="i">+pub type ClientSender =
</a><a href="#h8-0-19" id="h8-0-19" class="i">+    crossbeam::channel::Sender&lt;(Request, crossbeam::channel::Sender&lt;Result&lt;Response&gt;&gt;)&gt;;
</a><a href="#h8-0-20" id="h8-0-20" class="i">+pub type ClientReceiver =
</a><a href="#h8-0-21" id="h8-0-21" class="i">+    crossbeam::channel::Receiver&lt;(Request, crossbeam::channel::Sender&lt;Result&lt;Response&gt;&gt;)&gt;;
</a> 
 /// The interval between Raft ticks, the unit of time for e.g. heartbeats and
 /// elections.
<a href="#h8-1" id="h8-1" class="h">@@ -24,7 +21,7 @@ const TICK_INTERVAL: Duration = Duration::from_millis(100);
</a> pub struct Server {
     node: Node,
     peers: HashMap&lt;NodeID, String&gt;,
<a href="#h8-1-3" id="h8-1-3" class="d">-    node_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
</a><a href="#h8-1-4" id="h8-1-4" class="i">+    node_rx: crossbeam::channel::Receiver&lt;Message&gt;,
</a> }
 
 impl Server {
<a href="#h8-2" id="h8-2" class="h">@@ -35,7 +32,7 @@ impl Server {
</a>         log: Log,
         state: Box&lt;dyn State&gt;,
     ) -&gt; Result&lt;Self&gt; {
<a href="#h8-2-3" id="h8-2-3" class="d">-        let (node_tx, node_rx) = mpsc::unbounded_channel();
</a><a href="#h8-2-4" id="h8-2-4" class="i">+        let (node_tx, node_rx) = crossbeam::channel::unbounded();
</a>         Ok(Self {
             node: Node::new(id, peers.keys().copied().collect(), log, state, node_tx)?,
             peers,
<a href="#h8-3" id="h8-3" class="h">@@ -44,43 +41,39 @@ impl Server {
</a>     }
 
     /// Connects to peers and serves requests.
<a href="#h8-3-3" id="h8-3-3" class="d">-    pub async fn serve(self, listener: TcpListener, client_rx: ClientReceiver) -&gt; Result&lt;()&gt; {
</a><a href="#h8-3-4" id="h8-3-4" class="d">-        let (tcp_in_tx, tcp_in_rx) = mpsc::unbounded_channel::&lt;Message&gt;();
</a><a href="#h8-3-5" id="h8-3-5" class="d">-        let (tcp_out_tx, tcp_out_rx) = mpsc::unbounded_channel::&lt;Message&gt;();
</a><a href="#h8-3-6" id="h8-3-6" class="d">-        let (task, tcp_receiver) = Self::tcp_receive(listener, tcp_in_tx).remote_handle();
</a><a href="#h8-3-7" id="h8-3-7" class="d">-        tokio::spawn(task);
</a><a href="#h8-3-8" id="h8-3-8" class="d">-        let (task, tcp_sender) = Self::tcp_send(self.peers, tcp_out_rx).remote_handle();
</a><a href="#h8-3-9" id="h8-3-9" class="d">-        tokio::spawn(task);
</a><a href="#h8-3-10" id="h8-3-10" class="d">-        let (task, eventloop) =
</a><a href="#h8-3-11" id="h8-3-11" class="d">-            Self::eventloop(self.node, self.node_rx, client_rx, tcp_in_rx, tcp_out_tx)
</a><a href="#h8-3-12" id="h8-3-12" class="d">-                .remote_handle();
</a><a href="#h8-3-13" id="h8-3-13" class="d">-        tokio::spawn(task);
</a><a href="#h8-3-14" id="h8-3-14" class="d">-
</a><a href="#h8-3-15" id="h8-3-15" class="d">-        tokio::try_join!(tcp_receiver, tcp_sender, eventloop)?;
</a><a href="#h8-3-16" id="h8-3-16" class="d">-        Ok(())
</a><a href="#h8-3-17" id="h8-3-17" class="i">+    pub fn serve(self, listener: std::net::TcpListener, client_rx: ClientReceiver) -&gt; Result&lt;()&gt; {
</a><a href="#h8-3-18" id="h8-3-18" class="i">+        std::thread::scope(|s| {
</a><a href="#h8-3-19" id="h8-3-19" class="i">+            let (tcp_in_tx, tcp_in_rx) = crossbeam::channel::unbounded::&lt;Message&gt;();
</a><a href="#h8-3-20" id="h8-3-20" class="i">+            let (tcp_out_tx, tcp_out_rx) = crossbeam::channel::unbounded::&lt;Message&gt;();
</a><a href="#h8-3-21" id="h8-3-21" class="i">+
</a><a href="#h8-3-22" id="h8-3-22" class="i">+            s.spawn(move || Self::tcp_receive(listener, tcp_in_tx));
</a><a href="#h8-3-23" id="h8-3-23" class="i">+            s.spawn(move || Self::tcp_send(self.peers, tcp_out_rx));
</a><a href="#h8-3-24" id="h8-3-24" class="i">+            s.spawn(move || {
</a><a href="#h8-3-25" id="h8-3-25" class="i">+                Self::eventloop(self.node, self.node_rx, client_rx, tcp_in_rx, tcp_out_tx)
</a><a href="#h8-3-26" id="h8-3-26" class="i">+                    .expect(&quot;event processing failed&quot;)
</a><a href="#h8-3-27" id="h8-3-27" class="i">+            });
</a><a href="#h8-3-28" id="h8-3-28" class="i">+            Ok(())
</a><a href="#h8-3-29" id="h8-3-29" class="i">+        })
</a>     }
 
     /// Runs the event loop.
<a href="#h8-3-33" id="h8-3-33" class="d">-    async fn eventloop(
</a><a href="#h8-3-34" id="h8-3-34" class="i">+    fn eventloop(
</a>         mut node: Node,
<a href="#h8-3-36" id="h8-3-36" class="d">-        node_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
</a><a href="#h8-3-37" id="h8-3-37" class="i">+        node_rx: crossbeam::channel::Receiver&lt;Message&gt;,
</a>         client_rx: ClientReceiver,
<a href="#h8-3-39" id="h8-3-39" class="d">-        tcp_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
</a><a href="#h8-3-40" id="h8-3-40" class="d">-        tcp_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h8-3-41" id="h8-3-41" class="i">+        tcp_rx: crossbeam::channel::Receiver&lt;Message&gt;,
</a><a href="#h8-3-42" id="h8-3-42" class="i">+        tcp_tx: crossbeam::channel::Sender&lt;Message&gt;,
</a>     ) -&gt; Result&lt;()&gt; {
<a href="#h8-3-44" id="h8-3-44" class="d">-        let mut node_rx = UnboundedReceiverStream::new(node_rx);
</a><a href="#h8-3-45" id="h8-3-45" class="d">-        let mut tcp_rx = UnboundedReceiverStream::new(tcp_rx);
</a><a href="#h8-3-46" id="h8-3-46" class="d">-        let mut client_rx = UnboundedReceiverStream::new(client_rx);
</a><a href="#h8-3-47" id="h8-3-47" class="d">-
</a><a href="#h8-3-48" id="h8-3-48" class="d">-        let mut ticker = tokio::time::interval(TICK_INTERVAL);
</a><a href="#h8-3-49" id="h8-3-49" class="d">-        let mut requests = HashMap::&lt;Vec&lt;u8&gt;, oneshot::Sender&lt;Result&lt;Response&gt;&gt;&gt;::new();
</a><a href="#h8-3-50" id="h8-3-50" class="i">+        let ticker = crossbeam::channel::tick(TICK_INTERVAL);
</a><a href="#h8-3-51" id="h8-3-51" class="i">+        let mut requests = HashMap::&lt;Vec&lt;u8&gt;, crossbeam::channel::Sender&lt;Result&lt;Response&gt;&gt;&gt;::new();
</a>         loop {
<a href="#h8-3-53" id="h8-3-53" class="d">-            tokio::select! {
</a><a href="#h8-3-54" id="h8-3-54" class="d">-                _ = ticker.tick() =&gt; node = node.tick()?,
</a><a href="#h8-3-55" id="h8-3-55" class="i">+            crossbeam::select! {
</a><a href="#h8-3-56" id="h8-3-56" class="i">+                recv(ticker) -&gt; _ =&gt; node = node.tick()?,
</a> 
<a href="#h8-3-58" id="h8-3-58" class="d">-                Some(msg) = tcp_rx.next() =&gt; node = node.step(msg)?,
</a><a href="#h8-3-59" id="h8-3-59" class="i">+                recv(tcp_rx) -&gt; msg =&gt; node = node.step(msg?)?,
</a> 
<a href="#h8-3-61" id="h8-3-61" class="d">-                Some(msg) = node_rx.next() =&gt; {
</a><a href="#h8-3-62" id="h8-3-62" class="i">+                recv(node_rx) -&gt; msg =&gt; {
</a><a href="#h8-3-63" id="h8-3-63" class="i">+                    let msg = msg?;
</a>                     match msg {
                         Message{to: Address::Node(_), ..} =&gt; tcp_tx.send(msg)?,
                         Message{to: Address::Broadcast, ..} =&gt; tcp_tx.send(msg)?,
<a href="#h8-4" id="h8-4" class="h">@@ -95,7 +88,8 @@ impl Server {
</a>                     }
                 }
 
<a href="#h8-4-3" id="h8-4-3" class="d">-                Some((request, response_tx)) = client_rx.next() =&gt; {
</a><a href="#h8-4-4" id="h8-4-4" class="i">+                recv(client_rx) -&gt; r =&gt; {
</a><a href="#h8-4-5" id="h8-4-5" class="i">+                    let (request, response_tx) = r?;
</a>                     let id = Uuid::new_v4().as_bytes().to_vec();
                     let msg = Message{
                         from: Address::Client,
<a href="#h8-5" id="h8-5" class="h">@@ -111,109 +105,95 @@ impl Server {
</a>     }
 
     /// Receives inbound messages from peers via TCP.
<a href="#h8-5-3" id="h8-5-3" class="d">-    async fn tcp_receive(
</a><a href="#h8-5-4" id="h8-5-4" class="d">-        listener: TcpListener,
</a><a href="#h8-5-5" id="h8-5-5" class="d">-        in_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h8-5-6" id="h8-5-6" class="d">-    ) -&gt; Result&lt;()&gt; {
</a><a href="#h8-5-7" id="h8-5-7" class="d">-        let mut listener = TcpListenerStream::new(listener);
</a><a href="#h8-5-8" id="h8-5-8" class="d">-        while let Some(socket) = listener.try_next().await? {
</a><a href="#h8-5-9" id="h8-5-9" class="d">-            let peer = socket.peer_addr()?;
</a><a href="#h8-5-10" id="h8-5-10" class="d">-            let peer_in_tx = in_tx.clone();
</a><a href="#h8-5-11" id="h8-5-11" class="d">-            tokio::spawn(async move {
</a><a href="#h8-5-12" id="h8-5-12" class="d">-                debug!(&quot;Raft peer {} connected&quot;, peer);
</a><a href="#h8-5-13" id="h8-5-13" class="d">-                match Self::tcp_receive_peer(socket, peer_in_tx).await {
</a><a href="#h8-5-14" id="h8-5-14" class="d">-                    Ok(()) =&gt; debug!(&quot;Raft peer {} disconnected&quot;, peer),
</a><a href="#h8-5-15" id="h8-5-15" class="d">-                    Err(err) =&gt; error!(&quot;Raft peer {} error: {}&quot;, peer, err.to_string()),
</a><a href="#h8-5-16" id="h8-5-16" class="d">-                };
</a><a href="#h8-5-17" id="h8-5-17" class="i">+    fn tcp_receive(listener: std::net::TcpListener, in_tx: crossbeam::channel::Sender&lt;Message&gt;) {
</a><a href="#h8-5-18" id="h8-5-18" class="i">+        std::thread::scope(|s| loop {
</a><a href="#h8-5-19" id="h8-5-19" class="i">+            let (socket, peer) = match listener.accept() {
</a><a href="#h8-5-20" id="h8-5-20" class="i">+                Ok(r) =&gt; r,
</a><a href="#h8-5-21" id="h8-5-21" class="i">+                Err(err) =&gt; {
</a><a href="#h8-5-22" id="h8-5-22" class="i">+                    error!(&quot;Connection failed: {}&quot;, err);
</a><a href="#h8-5-23" id="h8-5-23" class="i">+                    continue;
</a><a href="#h8-5-24" id="h8-5-24" class="i">+                }
</a><a href="#h8-5-25" id="h8-5-25" class="i">+            };
</a><a href="#h8-5-26" id="h8-5-26" class="i">+            let in_tx = in_tx.clone();
</a><a href="#h8-5-27" id="h8-5-27" class="i">+            s.spawn(move || {
</a><a href="#h8-5-28" id="h8-5-28" class="i">+                debug!(&quot;Raft peer {peer} connected&quot;);
</a><a href="#h8-5-29" id="h8-5-29" class="i">+                match Self::tcp_receive_peer(socket, in_tx) {
</a><a href="#h8-5-30" id="h8-5-30" class="i">+                    Ok(()) =&gt; debug!(&quot;Raft peer {peer} disconnected&quot;),
</a><a href="#h8-5-31" id="h8-5-31" class="i">+                    Err(err) =&gt; error!(&quot;Raft peer {peer} error: {err}&quot;),
</a><a href="#h8-5-32" id="h8-5-32" class="i">+                }
</a>             });
<a href="#h8-5-34" id="h8-5-34" class="d">-        }
</a><a href="#h8-5-35" id="h8-5-35" class="d">-        Ok(())
</a><a href="#h8-5-36" id="h8-5-36" class="i">+        });
</a>     }
 
     /// Receives inbound messages from a peer via TCP.
<a href="#h8-5-40" id="h8-5-40" class="d">-    async fn tcp_receive_peer(
</a><a href="#h8-5-41" id="h8-5-41" class="d">-        socket: TcpStream,
</a><a href="#h8-5-42" id="h8-5-42" class="d">-        in_tx: mpsc::UnboundedSender&lt;Message&gt;,
</a><a href="#h8-5-43" id="h8-5-43" class="i">+    fn tcp_receive_peer(
</a><a href="#h8-5-44" id="h8-5-44" class="i">+        mut socket: std::net::TcpStream,
</a><a href="#h8-5-45" id="h8-5-45" class="i">+        in_tx: crossbeam::channel::Sender&lt;Message&gt;,
</a>     ) -&gt; Result&lt;()&gt; {
<a href="#h8-5-47" id="h8-5-47" class="d">-        let mut stream = tokio_serde::SymmetricallyFramed::&lt;_, Message, _&gt;::new(
</a><a href="#h8-5-48" id="h8-5-48" class="d">-            Framed::new(socket, LengthDelimitedCodec::new()),
</a><a href="#h8-5-49" id="h8-5-49" class="d">-            tokio_serde::formats::SymmetricalBincode::&lt;Message&gt;::default(),
</a><a href="#h8-5-50" id="h8-5-50" class="d">-        );
</a><a href="#h8-5-51" id="h8-5-51" class="d">-        while let Some(message) = stream.try_next().await? {
</a><a href="#h8-5-52" id="h8-5-52" class="i">+        while let Some(message) = bincode::maybe_deserialize_from(&amp;mut socket)? {
</a>             in_tx.send(message)?;
         }
         Ok(())
     }
 
     /// Sends outbound messages to peers via TCP.
<a href="#h8-5-59" id="h8-5-59" class="d">-    async fn tcp_send(
</a><a href="#h8-5-60" id="h8-5-60" class="d">-        peers: HashMap&lt;NodeID, String&gt;,
</a><a href="#h8-5-61" id="h8-5-61" class="d">-        out_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
</a><a href="#h8-5-62" id="h8-5-62" class="d">-    ) -&gt; Result&lt;()&gt; {
</a><a href="#h8-5-63" id="h8-5-63" class="d">-        let mut out_rx = UnboundedReceiverStream::new(out_rx);
</a><a href="#h8-5-64" id="h8-5-64" class="d">-        let mut peer_txs: HashMap&lt;NodeID, mpsc::Sender&lt;Message&gt;&gt; = HashMap::new();
</a><a href="#h8-5-65" id="h8-5-65" class="d">-
</a><a href="#h8-5-66" id="h8-5-66" class="d">-        for (id, addr) in peers.into_iter() {
</a><a href="#h8-5-67" id="h8-5-67" class="d">-            let (tx, rx) = mpsc::channel::&lt;Message&gt;(1000);
</a><a href="#h8-5-68" id="h8-5-68" class="d">-            peer_txs.insert(id, tx);
</a><a href="#h8-5-69" id="h8-5-69" class="d">-            tokio::spawn(Self::tcp_send_peer(addr, rx));
</a><a href="#h8-5-70" id="h8-5-70" class="d">-        }
</a><a href="#h8-5-71" id="h8-5-71" class="i">+    fn tcp_send(peers: HashMap&lt;NodeID, String&gt;, out_rx: crossbeam::channel::Receiver&lt;Message&gt;) {
</a><a href="#h8-5-72" id="h8-5-72" class="i">+        std::thread::scope(move |s| {
</a><a href="#h8-5-73" id="h8-5-73" class="i">+            let mut peer_txs: HashMap&lt;NodeID, crossbeam::channel::Sender&lt;Message&gt;&gt; = HashMap::new();
</a><a href="#h8-5-74" id="h8-5-74" class="i">+
</a><a href="#h8-5-75" id="h8-5-75" class="i">+            for (id, addr) in peers.into_iter() {
</a><a href="#h8-5-76" id="h8-5-76" class="i">+                let (tx, rx) = crossbeam::channel::bounded::&lt;Message&gt;(1000);
</a><a href="#h8-5-77" id="h8-5-77" class="i">+                peer_txs.insert(id, tx);
</a><a href="#h8-5-78" id="h8-5-78" class="i">+                s.spawn(move || Self::tcp_send_peer(addr, rx));
</a><a href="#h8-5-79" id="h8-5-79" class="i">+            }
</a> 
<a href="#h8-5-81" id="h8-5-81" class="d">-        while let Some(message) = out_rx.next().await {
</a><a href="#h8-5-82" id="h8-5-82" class="d">-            let to = match message.to {
</a><a href="#h8-5-83" id="h8-5-83" class="d">-                Address::Broadcast =&gt; peer_txs.keys().copied().collect(),
</a><a href="#h8-5-84" id="h8-5-84" class="d">-                Address::Node(peer) =&gt; vec![peer],
</a><a href="#h8-5-85" id="h8-5-85" class="d">-                addr =&gt; {
</a><a href="#h8-5-86" id="h8-5-86" class="d">-                    error!(&quot;Received outbound message for non-TCP address {:?}&quot;, addr);
</a><a href="#h8-5-87" id="h8-5-87" class="d">-                    continue;
</a><a href="#h8-5-88" id="h8-5-88" class="d">-                }
</a><a href="#h8-5-89" id="h8-5-89" class="d">-            };
</a><a href="#h8-5-90" id="h8-5-90" class="d">-            for id in to {
</a><a href="#h8-5-91" id="h8-5-91" class="d">-                match peer_txs.get_mut(&amp;id) {
</a><a href="#h8-5-92" id="h8-5-92" class="d">-                    Some(tx) =&gt; match tx.try_send(message.clone()) {
</a><a href="#h8-5-93" id="h8-5-93" class="d">-                        Ok(()) =&gt; {}
</a><a href="#h8-5-94" id="h8-5-94" class="d">-                        Err(mpsc::error::TrySendError::Full(_)) =&gt; {
</a><a href="#h8-5-95" id="h8-5-95" class="d">-                            debug!(&quot;Full send buffer for peer {}, discarding message&quot;, id)
</a><a href="#h8-5-96" id="h8-5-96" class="i">+            while let Ok(message) = out_rx.recv() {
</a><a href="#h8-5-97" id="h8-5-97" class="i">+                let to = match message.to {
</a><a href="#h8-5-98" id="h8-5-98" class="i">+                    Address::Broadcast =&gt; peer_txs.keys().copied().collect(),
</a><a href="#h8-5-99" id="h8-5-99" class="i">+                    Address::Node(peer) =&gt; vec![peer],
</a><a href="#h8-5-100" id="h8-5-100" class="i">+                    addr =&gt; {
</a><a href="#h8-5-101" id="h8-5-101" class="i">+                        error!(&quot;Received outbound message for non-TCP address {:?}&quot;, addr);
</a><a href="#h8-5-102" id="h8-5-102" class="i">+                        continue;
</a><a href="#h8-5-103" id="h8-5-103" class="i">+                    }
</a><a href="#h8-5-104" id="h8-5-104" class="i">+                };
</a><a href="#h8-5-105" id="h8-5-105" class="i">+                for id in to {
</a><a href="#h8-5-106" id="h8-5-106" class="i">+                    if let Some(tx) = peer_txs.get_mut(&amp;id) {
</a><a href="#h8-5-107" id="h8-5-107" class="i">+                        if tx.try_send(message.clone()).is_err() {
</a><a href="#h8-5-108" id="h8-5-108" class="i">+                            error!(&quot;Full send buffer for peer {}, discarding message&quot;, id)
</a>                         }
<a href="#h8-5-110" id="h8-5-110" class="d">-                        Err(error) =&gt; return Err(error.into()),
</a><a href="#h8-5-111" id="h8-5-111" class="d">-                    },
</a><a href="#h8-5-112" id="h8-5-112" class="d">-                    None =&gt; error!(&quot;Received outbound message for unknown peer {}&quot;, id),
</a><a href="#h8-5-113" id="h8-5-113" class="i">+                    } else {
</a><a href="#h8-5-114" id="h8-5-114" class="i">+                        error!(&quot;Received outbound message for unknown peer {}&quot;, id)
</a><a href="#h8-5-115" id="h8-5-115" class="i">+                    }
</a>                 }
             }
<a href="#h8-5-118" id="h8-5-118" class="d">-        }
</a><a href="#h8-5-119" id="h8-5-119" class="d">-        Ok(())
</a><a href="#h8-5-120" id="h8-5-120" class="i">+        });
</a>     }
 
     /// Sends outbound messages to a peer, continuously reconnecting.
<a href="#h8-5-124" id="h8-5-124" class="d">-    async fn tcp_send_peer(addr: String, out_rx: mpsc::Receiver&lt;Message&gt;) {
</a><a href="#h8-5-125" id="h8-5-125" class="d">-        let mut out_rx = ReceiverStream::new(out_rx);
</a><a href="#h8-5-126" id="h8-5-126" class="i">+    fn tcp_send_peer(addr: String, mut out_rx: crossbeam::channel::Receiver&lt;Message&gt;) {
</a>         loop {
<a href="#h8-5-128" id="h8-5-128" class="d">-            match TcpStream::connect(&amp;addr).await {
</a><a href="#h8-5-129" id="h8-5-129" class="i">+            match std::net::TcpStream::connect(&amp;addr) {
</a>                 Ok(socket) =&gt; {
                     debug!(&quot;Connected to Raft peer {}&quot;, addr);
<a href="#h8-5-132" id="h8-5-132" class="d">-                    match Self::tcp_send_peer_session(socket, &amp;mut out_rx).await {
</a><a href="#h8-5-133" id="h8-5-133" class="i">+                    match Self::tcp_send_peer_session(socket, &amp;mut out_rx) {
</a>                         Ok(()) =&gt; break,
                         Err(err) =&gt; error!(&quot;Failed sending to Raft peer {}: {}&quot;, addr, err),
                     }
                 }
                 Err(err) =&gt; error!(&quot;Failed connecting to Raft peer {}: {}&quot;, addr, err),
             }
<a href="#h8-5-140" id="h8-5-140" class="d">-            tokio::time::sleep(Duration::from_millis(1000)).await;
</a><a href="#h8-5-141" id="h8-5-141" class="i">+            std::thread::sleep(Duration::from_millis(1000));
</a>         }
         debug!(&quot;Disconnected from Raft peer {}&quot;, addr);
     }
 
     /// Sends outbound messages to a peer via a TCP session.
<a href="#h8-5-147" id="h8-5-147" class="d">-    async fn tcp_send_peer_session(
</a><a href="#h8-5-148" id="h8-5-148" class="d">-        socket: TcpStream,
</a><a href="#h8-5-149" id="h8-5-149" class="d">-        out_rx: &amp;mut ReceiverStream&lt;Message&gt;,
</a><a href="#h8-5-150" id="h8-5-150" class="i">+    fn tcp_send_peer_session(
</a><a href="#h8-5-151" id="h8-5-151" class="i">+        mut socket: std::net::TcpStream,
</a><a href="#h8-5-152" id="h8-5-152" class="i">+        out_rx: &amp;mut crossbeam::channel::Receiver&lt;Message&gt;,
</a>     ) -&gt; Result&lt;()&gt; {
<a href="#h8-5-154" id="h8-5-154" class="d">-        let mut stream = tokio_serde::SymmetricallyFramed::&lt;_, Message, _&gt;::new(
</a><a href="#h8-5-155" id="h8-5-155" class="d">-            Framed::new(socket, LengthDelimitedCodec::new()),
</a><a href="#h8-5-156" id="h8-5-156" class="d">-            tokio_serde::formats::SymmetricalBincode::&lt;Message&gt;::default(),
</a><a href="#h8-5-157" id="h8-5-157" class="d">-        );
</a><a href="#h8-5-158" id="h8-5-158" class="d">-        while let Some(message) = out_rx.next().await {
</a><a href="#h8-5-159" id="h8-5-159" class="d">-            stream.send(message).await?;
</a><a href="#h8-5-160" id="h8-5-160" class="i">+        while let Ok(message) = out_rx.recv() {
</a><a href="#h8-5-161" id="h8-5-161" class="i">+            bincode::serialize_into(&amp;mut socket, &amp;message)?;
</a>         }
         Ok(())
     }
<b>diff --git a/<a id="h9" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -10,8 +10,6 @@ use crate::sql::types::Row;
</a> use ::log::{debug, error, info};
 use serde_derive::{Deserialize, Serialize};
 use std::collections::HashMap;
<a href="#h9-0-3" id="h9-0-3" class="d">-use tokio::net::TcpListener;
</a><a href="#h9-0-4" id="h9-0-4" class="d">-use tokio::sync::mpsc;
</a> 
 /// A toyDB server.
 pub struct Server {
<a href="#h9-1" id="h9-1" class="h">@@ -29,10 +27,10 @@ impl Server {
</a>         Ok(Server { raft: raft::Server::new(id, peers, raft_log, raft_state)? })
     }
 
<a href="#h9-1-3" id="h9-1-3" class="d">-    /// Serves Raft and SQL requests until the returned future is dropped. Consumes the server.
</a><a href="#h9-1-4" id="h9-1-4" class="d">-    pub async fn serve(
</a><a href="#h9-1-5" id="h9-1-5" class="i">+    /// Serves Raft and SQL requests indefinitely. Consumes the server.
</a><a href="#h9-1-6" id="h9-1-6" class="i">+    pub fn serve(
</a>         self,
<a href="#h9-1-8" id="h9-1-8" class="d">-        raft_listener: TcpListener,
</a><a href="#h9-1-9" id="h9-1-9" class="i">+        raft_listener: std::net::TcpListener,
</a>         sql_listener: std::net::TcpListener,
     ) -&gt; Result&lt;()&gt; {
         info!(
<a href="#h9-2" id="h9-2" class="h">@@ -41,12 +39,13 @@ impl Server {
</a>             raft_listener.local_addr()?
         );
 
<a href="#h9-2-3" id="h9-2-3" class="d">-        let (raft_tx, raft_rx) = mpsc::unbounded_channel();
</a><a href="#h9-2-4" id="h9-2-4" class="i">+        std::thread::scope(move |s| {
</a><a href="#h9-2-5" id="h9-2-5" class="i">+            let (raft_tx, raft_rx) = crossbeam::channel::unbounded();
</a> 
<a href="#h9-2-7" id="h9-2-7" class="d">-        tokio::task::spawn_blocking(move || Self::serve_sql(sql_listener, raft_tx));
</a><a href="#h9-2-8" id="h9-2-8" class="d">-
</a><a href="#h9-2-9" id="h9-2-9" class="d">-        tokio::try_join!(self.raft.serve(raft_listener, raft_rx))?;
</a><a href="#h9-2-10" id="h9-2-10" class="d">-        Ok(())
</a><a href="#h9-2-11" id="h9-2-11" class="i">+            s.spawn(move || Self::serve_sql(sql_listener, raft_tx));
</a><a href="#h9-2-12" id="h9-2-12" class="i">+            s.spawn(move || self.raft.serve(raft_listener, raft_rx));
</a><a href="#h9-2-13" id="h9-2-13" class="i">+            Ok(())
</a><a href="#h9-2-14" id="h9-2-14" class="i">+        })
</a>     }
 
     /// Serves SQL clients.
<b>diff --git a/<a id="h10" href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a> b/<a href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -8,7 +8,6 @@ use crate::storage::{self, mvcc::TransactionState};
</a> 
 use serde::{de::DeserializeOwned, Deserialize, Serialize};
 use std::collections::HashSet;
<a href="#h10-0-3" id="h10-0-3" class="d">-use tokio::sync::{mpsc, oneshot};
</a> 
 /// A Raft state machine mutation.
 ///
<a href="#h10-1" id="h10-1" class="h">@@ -68,22 +67,20 @@ pub struct Status {
</a> /// A client for the local Raft node.
 #[derive(Clone)]
 struct Client {
<a href="#h10-1-3" id="h10-1-3" class="d">-    tx: mpsc::UnboundedSender&lt;(raft::Request, oneshot::Sender&lt;Result&lt;raft::Response&gt;&gt;)&gt;,
</a><a href="#h10-1-4" id="h10-1-4" class="i">+    tx: raft::ClientSender,
</a> }
 
 impl Client {
     /// Creates a new Raft client.
<a href="#h10-1-9" id="h10-1-9" class="d">-    fn new(
</a><a href="#h10-1-10" id="h10-1-10" class="d">-        tx: mpsc::UnboundedSender&lt;(raft::Request, oneshot::Sender&lt;Result&lt;raft::Response&gt;&gt;)&gt;,
</a><a href="#h10-1-11" id="h10-1-11" class="d">-    ) -&gt; Self {
</a><a href="#h10-1-12" id="h10-1-12" class="i">+    fn new(tx: raft::ClientSender) -&gt; Self {
</a>         Self { tx }
     }
 
     /// Executes a request against the Raft cluster.
     fn execute(&amp;self, request: raft::Request) -&gt; Result&lt;raft::Response&gt; {
<a href="#h10-1-18" id="h10-1-18" class="d">-        let (response_tx, response_rx) = oneshot::channel();
</a><a href="#h10-1-19" id="h10-1-19" class="i">+        let (response_tx, response_rx) = crossbeam::channel::bounded(1);
</a>         self.tx.send((request, response_tx))?;
<a href="#h10-1-21" id="h10-1-21" class="d">-        futures::executor::block_on(response_rx)?
</a><a href="#h10-1-22" id="h10-1-22" class="i">+        response_rx.recv()?
</a>     }
 
     /// Mutates the Raft state machine, deserializing the response into the
<a href="#h10-2" id="h10-2" class="h">@@ -121,9 +118,7 @@ pub struct Raft {
</a> 
 impl Raft {
     /// Creates a new Raft-based SQL engine.
<a href="#h10-2-3" id="h10-2-3" class="d">-    pub fn new(
</a><a href="#h10-2-4" id="h10-2-4" class="d">-        tx: mpsc::UnboundedSender&lt;(raft::Request, oneshot::Sender&lt;Result&lt;raft::Response&gt;&gt;)&gt;,
</a><a href="#h10-2-5" id="h10-2-5" class="d">-    ) -&gt; Self {
</a><a href="#h10-2-6" id="h10-2-6" class="i">+    pub fn new(tx: raft::ClientSender) -&gt; Self {
</a>         Self { client: Client::new(tx) }
     }
 
</pre>
</div>
</body>
</html>
