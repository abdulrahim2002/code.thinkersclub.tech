<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moved serialize() and deserialize() into utility module - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a6581e5975f06f7d02003544c7b1be8e5159b694.html">a6581e5975f06f7d02003544c7b1be8e5159b694</a>
<b>parent</b> <a href="../commit/dac72d6a79d7388d279f63250031ff4667d3a48a.html">dac72d6a79d7388d279f63250031ff4667d3a48a</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sun,  1 Sep 2019 19:13:36 +0200

Moved serialize() and deserialize() into utility module

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/client.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/kv/raft.rs</a></td><td> | </td><td class="num">13</td><td><span class="i">+</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/raft/log.rs</a></td><td> | </td><td class="num">34</td><td><span class="i">+++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/server/toydb.rs</a></td><td> | </td><td class="num">14</td><td><span class="i">++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/sql/storage.rs</a></td><td> | </td><td class="num">21</td><td><span class="i">++++</span><span class="d">-----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/utility/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">src/utility/serialize.rs</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>7 files changed, 43 insertions(+), 74 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,5 +1,6 @@
</a> use crate::service;
 use crate::sql::types::{Row, Value};
<a href="#h0-0-2" id="h0-0-2" class="i">+use crate::utility::deserialize;
</a> use crate::Error;
 use grpc::ClientStubExt;
 use service::ToyDB;
<a href="#h0-1" id="h0-1" class="h">@@ -23,10 +24,13 @@ impl Client {
</a> 
     /// Fetches the table schema as SQL
     pub fn get_table(&amp;self, table: &amp;str) -&gt; Result&lt;String, Error&gt; {
<a href="#h0-1-3" id="h0-1-3" class="d">-        let (_, resp, _) = self.client.get_table(
</a><a href="#h0-1-4" id="h0-1-4" class="d">-            grpc::RequestOptions::new(),
</a><a href="#h0-1-5" id="h0-1-5" class="d">-            service::GetTableRequest { name: table.to_string(), ..Default::default() },
</a><a href="#h0-1-6" id="h0-1-6" class="d">-        ).wait()?;
</a><a href="#h0-1-7" id="h0-1-7" class="i">+        let (_, resp, _) = self
</a><a href="#h0-1-8" id="h0-1-8" class="i">+            .client
</a><a href="#h0-1-9" id="h0-1-9" class="i">+            .get_table(
</a><a href="#h0-1-10" id="h0-1-10" class="i">+                grpc::RequestOptions::new(),
</a><a href="#h0-1-11" id="h0-1-11" class="i">+                service::GetTableRequest { name: table.to_string(), ..Default::default() },
</a><a href="#h0-1-12" id="h0-1-12" class="i">+            )
</a><a href="#h0-1-13" id="h0-1-13" class="i">+            .wait()?;
</a>         Ok(resp.sql)
     }
 
<a href="#h0-2" id="h0-2" class="h">@@ -71,7 +75,7 @@ impl ResultSet {
</a>         metadata: grpc::Metadata,
         rows: Box&lt;dyn std::iter::Iterator&lt;Item = Result&lt;service::Row, grpc::Error&gt;&gt;&gt;,
     ) -&gt; Result&lt;Self, Error&gt; {
<a href="#h0-2-3" id="h0-2-3" class="d">-        let columns = Self::deserialize(
</a><a href="#h0-2-4" id="h0-2-4" class="i">+        let columns = deserialize(
</a>             metadata
                 .get(&quot;columns&quot;)
                 .map(|c| c.to_vec())
<a href="#h0-3" id="h0-3" class="h">@@ -84,11 +88,6 @@ impl ResultSet {
</a>         self.columns.clone()
     }
 
<a href="#h0-3-3" id="h0-3-3" class="d">-    /// Deserializes a value from a byte buffer
</a><a href="#h0-3-4" id="h0-3-4" class="d">-    fn deserialize&lt;&#39;de, V: serde::Deserialize&lt;&#39;de&gt;&gt;(bytes: Vec&lt;u8&gt;) -&gt; Result&lt;V, Error&gt; {
</a><a href="#h0-3-5" id="h0-3-5" class="d">-        Ok(serde::Deserialize::deserialize(&amp;mut rmps::Deserializer::new(&amp;bytes[..]))?)
</a><a href="#h0-3-6" id="h0-3-6" class="d">-    }
</a><a href="#h0-3-7" id="h0-3-7" class="d">-
</a>     /// Converts a protobuf row into a proper row
     fn row_from_protobuf(row: service::Row) -&gt; Row {
         row.field.into_iter().map(Self::value_from_protobuf).collect()
<b>diff --git a/<a id="h1" href="../file/src/kv/raft.rs.html">src/kv/raft.rs</a> b/<a href="../file/src/kv/raft.rs.html">src/kv/raft.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,5 +1,6 @@
</a> use super::Store;
 use crate::raft;
<a href="#h1-0-2" id="h1-0-2" class="i">+use crate::utility::{deserialize, serialize};
</a> use crate::Error;
 use serde_derive::{Deserialize, Serialize};
 
<a href="#h1-1" id="h1-1" class="h">@@ -103,15 +104,3 @@ impl raft::State for State {
</a>         }
     }
 }
<a href="#h1-1-3" id="h1-1-3" class="d">-
</a><a href="#h1-1-4" id="h1-1-4" class="d">-/// Deserializes a value from a byte buffer
</a><a href="#h1-1-5" id="h1-1-5" class="d">-fn deserialize&lt;&#39;de, V: serde::Deserialize&lt;&#39;de&gt;&gt;(bytes: Vec&lt;u8&gt;) -&gt; Result&lt;V, Error&gt; {
</a><a href="#h1-1-6" id="h1-1-6" class="d">-    Ok(serde::Deserialize::deserialize(&amp;mut rmps::Deserializer::new(&amp;bytes[..]))?)
</a><a href="#h1-1-7" id="h1-1-7" class="d">-}
</a><a href="#h1-1-8" id="h1-1-8" class="d">-
</a><a href="#h1-1-9" id="h1-1-9" class="d">-/// Serializes a value into a byte buffer
</a><a href="#h1-1-10" id="h1-1-10" class="d">-fn serialize&lt;V: serde::Serialize&gt;(value: V) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</a><a href="#h1-1-11" id="h1-1-11" class="d">-    let mut bytes = Vec::new();
</a><a href="#h1-1-12" id="h1-1-12" class="d">-    value.serialize(&amp;mut rmps::Serializer::new(&amp;mut bytes))?;
</a><a href="#h1-1-13" id="h1-1-13" class="d">-    Ok(bytes)
</a><a href="#h1-1-14" id="h1-1-14" class="d">-}
</a><b>diff --git a/<a id="h2" href="../file/src/raft/log.rs.html">src/raft/log.rs</a> b/<a href="../file/src/raft/log.rs.html">src/raft/log.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,6 @@
</a> use super::state::State;
 use crate::kv;
<a href="#h2-0-2" id="h2-0-2" class="i">+use crate::utility::{deserialize, serialize};
</a> use crate::Error;
 use serde_derive::{Deserialize, Serialize};
 
<a href="#h2-1" id="h2-1" class="h">@@ -37,11 +38,11 @@ impl Log {
</a>     /// Creates a new log, using a kv::Store for storage.
     pub fn new&lt;S: kv::Store&gt;(store: S) -&gt; Result&lt;Self, Error&gt; {
         let apply_index = match store.get(&quot;apply_index&quot;)? {
<a href="#h2-1-3" id="h2-1-3" class="d">-            Some(v) =&gt; Self::deserialize(v)?,
</a><a href="#h2-1-4" id="h2-1-4" class="i">+            Some(v) =&gt; deserialize(v)?,
</a>             None =&gt; 0,
         };
         let (commit_index, commit_term) = match store.get(&amp;apply_index.to_string())? {
<a href="#h2-1-8" id="h2-1-8" class="d">-            Some(raw_entry) =&gt; (apply_index, Self::deserialize::&lt;Entry&gt;(raw_entry)?.term),
</a><a href="#h2-1-9" id="h2-1-9" class="i">+            Some(raw_entry) =&gt; (apply_index, deserialize::&lt;Entry&gt;(raw_entry)?.term),
</a>             None if apply_index == 0 =&gt; (0, 0),
             None =&gt; {
                 return Err(Error::Internal(format!(&quot;Applied entry {} not found&quot;, apply_index)))
<a href="#h2-2" id="h2-2" class="h">@@ -52,7 +53,7 @@ impl Log {
</a>         let (mut last_index, mut last_term) = (0, 0);
         for i in 1..std::u64::MAX {
             if let Some(e) = store.get(&amp;i.to_string())? {
<a href="#h2-2-3" id="h2-2-3" class="d">-                let entry: Entry = Self::deserialize(e)?;
</a><a href="#h2-2-4" id="h2-2-4" class="i">+                let entry: Entry = deserialize(e)?;
</a>                 last_index = i;
                 last_term = entry.term;
             } else {
<a href="#h2-3" id="h2-3" class="h">@@ -76,7 +77,7 @@ impl Log {
</a>         let index = self.last_index + 1;
         self.last_index = index;
         self.last_term = entry.term;
<a href="#h2-3-3" id="h2-3-3" class="d">-        self.kv.set(&amp;index.to_string(), Self::serialize(entry)?)?;
</a><a href="#h2-3-4" id="h2-3-4" class="i">+        self.kv.set(&amp;index.to_string(), serialize(entry)?)?;
</a>         Ok(index)
     }
 
<a href="#h2-4" id="h2-4" class="h">@@ -97,7 +98,7 @@ impl Log {
</a>             self.apply_index += 1;
             self.apply_term = entry.term;
         }
<a href="#h2-4-3" id="h2-4-3" class="d">-        self.kv.set(&quot;apply_index&quot;, Self::serialize(self.apply_index)?)?;
</a><a href="#h2-4-4" id="h2-4-4" class="i">+        self.kv.set(&quot;apply_index&quot;, serialize(self.apply_index)?)?;
</a>         Ok(Some((self.apply_index, output)))
     }
 
<a href="#h2-5" id="h2-5" class="h">@@ -123,7 +124,7 @@ impl Log {
</a>     /// Fetches an entry at an index
     pub fn get(&amp;self, index: u64) -&gt; Result&lt;Option&lt;Entry&gt;, Error&gt; {
         if let Some(value) = self.kv.get(&amp;index.to_string())? {
<a href="#h2-5-3" id="h2-5-3" class="d">-            Ok(Some(Self::deserialize(value)?))
</a><a href="#h2-5-4" id="h2-5-4" class="i">+            Ok(Some(deserialize(value)?))
</a>         } else {
             Ok(None)
         }
<a href="#h2-6" id="h2-6" class="h">@@ -217,10 +218,9 @@ impl Log {
</a>     /// containing the term number (0 if none) and candidate voted for
     /// in current term (if any).
     pub fn load_term(&amp;self) -&gt; Result&lt;(u64, Option&lt;String&gt;), Error&gt; {
<a href="#h2-6-3" id="h2-6-3" class="d">-        let term =
</a><a href="#h2-6-4" id="h2-6-4" class="d">-            if let Some(value) = self.kv.get(&quot;term&quot;)? { Self::deserialize(value)? } else { 0 };
</a><a href="#h2-6-5" id="h2-6-5" class="i">+        let term = if let Some(value) = self.kv.get(&quot;term&quot;)? { deserialize(value)? } else { 0 };
</a>         let voted_for = if let Some(value) = self.kv.get(&quot;voted_for&quot;)? {
<a href="#h2-6-7" id="h2-6-7" class="d">-            Some(Self::deserialize(value)?)
</a><a href="#h2-6-8" id="h2-6-8" class="i">+            Some(deserialize(value)?)
</a>         } else {
             None
         };
<a href="#h2-7" id="h2-7" class="h">@@ -232,30 +232,18 @@ impl Log {
</a>     // FIXME Should be transactional.
     pub fn save_term(&amp;mut self, term: u64, voted_for: Option&lt;&amp;str&gt;) -&gt; Result&lt;(), Error&gt; {
         if term &gt; 0 {
<a href="#h2-7-3" id="h2-7-3" class="d">-            self.kv.set(&quot;term&quot;, Self::serialize(term)?)?
</a><a href="#h2-7-4" id="h2-7-4" class="i">+            self.kv.set(&quot;term&quot;, serialize(term)?)?
</a>         } else {
             self.kv.delete(&quot;term&quot;)?
         }
         if let Some(v) = voted_for {
<a href="#h2-7-9" id="h2-7-9" class="d">-            self.kv.set(&quot;voted_for&quot;, Self::serialize(v)?)?
</a><a href="#h2-7-10" id="h2-7-10" class="i">+            self.kv.set(&quot;voted_for&quot;, serialize(v)?)?
</a>         } else {
             self.kv.delete(&quot;voted_for&quot;)?
         }
         debug!(&quot;Saved term={} and voted_for={:?}&quot;, term, voted_for);
         Ok(())
     }
<a href="#h2-7-17" id="h2-7-17" class="d">-
</a><a href="#h2-7-18" id="h2-7-18" class="d">-    /// Deserializes a value from a byte buffer
</a><a href="#h2-7-19" id="h2-7-19" class="d">-    fn deserialize&lt;&#39;de, V: serde::Deserialize&lt;&#39;de&gt;&gt;(bytes: Vec&lt;u8&gt;) -&gt; Result&lt;V, Error&gt; {
</a><a href="#h2-7-20" id="h2-7-20" class="d">-        Ok(serde::Deserialize::deserialize(&amp;mut rmps::Deserializer::new(&amp;bytes[..]))?)
</a><a href="#h2-7-21" id="h2-7-21" class="d">-    }
</a><a href="#h2-7-22" id="h2-7-22" class="d">-
</a><a href="#h2-7-23" id="h2-7-23" class="d">-    /// Serializes a value into a byte buffer
</a><a href="#h2-7-24" id="h2-7-24" class="d">-    fn serialize&lt;V: serde::Serialize&gt;(value: V) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</a><a href="#h2-7-25" id="h2-7-25" class="d">-        let mut bytes = Vec::new();
</a><a href="#h2-7-26" id="h2-7-26" class="d">-        value.serialize(&amp;mut rmps::Serializer::new(&amp;mut bytes))?;
</a><a href="#h2-7-27" id="h2-7-27" class="d">-        Ok(bytes)
</a><a href="#h2-7-28" id="h2-7-28" class="d">-    }
</a> }
 
 #[cfg(test)]
<b>diff --git a/<a id="h3" href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a> b/<a href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -2,7 +2,7 @@ use crate::raft::Raft;
</a> use crate::service;
 use crate::sql::types::{Row, Value};
 use crate::sql::{Parser, Planner, Storage};
<a href="#h3-0-3" id="h3-0-3" class="d">-use crate::Error;
</a><a href="#h3-0-4" id="h3-0-4" class="i">+use crate::utility::serialize;
</a> 
 pub struct ToyDB {
     pub id: String,
<a href="#h3-1" id="h3-1" class="h">@@ -32,10 +32,7 @@ impl service::ToyDB for ToyDB {
</a>             .build(Parser::new(&amp;req.query).parse().unwrap())
             .unwrap();
         let mut metadata = grpc::Metadata::new();
<a href="#h3-1-3" id="h3-1-3" class="d">-        metadata.add(
</a><a href="#h3-1-4" id="h3-1-4" class="d">-            grpc::MetadataKey::from(&quot;columns&quot;),
</a><a href="#h3-1-5" id="h3-1-5" class="d">-            Self::serialize(&amp;plan.columns).unwrap().into(),
</a><a href="#h3-1-6" id="h3-1-6" class="d">-        );
</a><a href="#h3-1-7" id="h3-1-7" class="i">+        metadata.add(grpc::MetadataKey::from(&quot;columns&quot;), serialize(&amp;plan.columns).unwrap().into());
</a>         // FIXME This needs to handle errors
         grpc::StreamingResponse::iter_with_metadata(
             metadata,
<a href="#h3-2" id="h3-2" class="h">@@ -85,11 +82,4 @@ impl ToyDB {
</a>             ..Default::default()
         }
     }
<a href="#h3-2-3" id="h3-2-3" class="d">-
</a><a href="#h3-2-4" id="h3-2-4" class="d">-    /// Serializes a value into a byte buffer
</a><a href="#h3-2-5" id="h3-2-5" class="d">-    fn serialize&lt;V: serde::Serialize&gt;(value: V) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</a><a href="#h3-2-6" id="h3-2-6" class="d">-        let mut bytes = Vec::new();
</a><a href="#h3-2-7" id="h3-2-7" class="d">-        value.serialize(&amp;mut rmps::Serializer::new(&amp;mut bytes))?;
</a><a href="#h3-2-8" id="h3-2-8" class="d">-        Ok(bytes)
</a><a href="#h3-2-9" id="h3-2-9" class="d">-    }
</a> }
<b>diff --git a/<a id="h4" href="../file/src/sql/storage.rs.html">src/sql/storage.rs</a> b/<a href="../file/src/sql/storage.rs.html">src/sql/storage.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,6 +1,7 @@
</a> use super::schema;
 use super::types;
 use crate::kv;
<a href="#h4-0-3" id="h4-0-3" class="i">+use crate::utility::{deserialize, serialize};
</a> use crate::Error;
 use std::sync::{Arc, RwLock};
 
<a href="#h4-1" id="h4-1" class="h">@@ -28,9 +29,7 @@ impl Storage {
</a>             .get(table.get_primary_key_index())
             .ok_or_else(|| Error::Value(&quot;No primary key value&quot;.into()))?;
         // FIXME Needs to check existence
<a href="#h4-1-3" id="h4-1-3" class="d">-        self.kv
</a><a href="#h4-1-4" id="h4-1-4" class="d">-            .write()?
</a><a href="#h4-1-5" id="h4-1-5" class="d">-            .set(&amp;Self::key_row(&amp;table.name, &amp;id.to_string()), Self::serialize(row)?)?;
</a><a href="#h4-1-6" id="h4-1-6" class="i">+        self.kv.write()?.set(&amp;Self::key_row(&amp;table.name, &amp;id.to_string()), serialize(row)?)?;
</a>         Ok(())
     }
 
<a href="#h4-2" id="h4-2" class="h">@@ -39,7 +38,7 @@ impl Storage {
</a>         if self.table_exists(&amp;table.name)? {
             Err(Error::Value(format!(&quot;Table {} already exists&quot;, table.name)))
         } else {
<a href="#h4-2-3" id="h4-2-3" class="d">-            self.kv.write()?.set(&amp;Self::key_table(&amp;table.name), Self::serialize(table)?)?;
</a><a href="#h4-2-4" id="h4-2-4" class="i">+            self.kv.write()?.set(&amp;Self::key_table(&amp;table.name), serialize(table)?)?;
</a>             Ok(())
         }
     }
<a href="#h4-3" id="h4-3" class="h">@@ -53,7 +52,7 @@ impl Storage {
</a> 
     /// Fetches a table schema
     pub fn get_table(&amp;self, table: &amp;str) -&gt; Result&lt;schema::Table, Error&gt; {
<a href="#h4-3-3" id="h4-3-3" class="d">-        Self::deserialize(
</a><a href="#h4-3-4" id="h4-3-4" class="i">+        deserialize(
</a>             self.kv
                 .read()?
                 .get(&amp;Self::key_table(table))?
<a href="#h4-4" id="h4-4" class="h">@@ -75,16 +74,4 @@ impl Storage {
</a>     fn key_table(table: &amp;str) -&gt; String {
         format!(&quot;schema.table.{}&quot;, table)
     }
<a href="#h4-4-3" id="h4-4-3" class="d">-
</a><a href="#h4-4-4" id="h4-4-4" class="d">-    /// Deserializes a value from a byte buffer
</a><a href="#h4-4-5" id="h4-4-5" class="d">-    fn deserialize&lt;&#39;de, V: serde::Deserialize&lt;&#39;de&gt;&gt;(bytes: Vec&lt;u8&gt;) -&gt; Result&lt;V, Error&gt; {
</a><a href="#h4-4-6" id="h4-4-6" class="d">-        Ok(serde::Deserialize::deserialize(&amp;mut rmps::Deserializer::new(&amp;bytes[..]))?)
</a><a href="#h4-4-7" id="h4-4-7" class="d">-    }
</a><a href="#h4-4-8" id="h4-4-8" class="d">-
</a><a href="#h4-4-9" id="h4-4-9" class="d">-    /// Serializes a value into a byte buffer
</a><a href="#h4-4-10" id="h4-4-10" class="d">-    fn serialize&lt;V: serde::Serialize&gt;(value: V) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</a><a href="#h4-4-11" id="h4-4-11" class="d">-        let mut bytes = Vec::new();
</a><a href="#h4-4-12" id="h4-4-12" class="d">-        value.serialize(&amp;mut rmps::Serializer::new(&amp;mut bytes))?;
</a><a href="#h4-4-13" id="h4-4-13" class="d">-        Ok(bytes)
</a><a href="#h4-4-14" id="h4-4-14" class="d">-    }
</a> }
<b>diff --git a/<a id="h5" href="../file/src/utility/mod.rs.html">src/utility/mod.rs</a> b/<a href="../file/src/utility/mod.rs.html">src/utility/mod.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,3 +1,5 @@
</a> mod deref;
<a href="#h5-0-1" id="h5-0-1" class="i">+mod serialize;
</a> 
 pub use deref::OptionDeref;
<a href="#h5-0-4" id="h5-0-4" class="i">+pub use serialize::{deserialize, serialize};
</a><b>diff --git a/<a id="h6" href="../file/src/utility/serialize.rs.html">src/utility/serialize.rs</a> b/<a href="../file/src/utility/serialize.rs.html">src/utility/serialize.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+use crate::Error;
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+/// Deserializes a value from a byte buffer
</a><a href="#h6-0-3" id="h6-0-3" class="i">+pub fn deserialize&lt;&#39;de, V: serde::Deserialize&lt;&#39;de&gt;&gt;(bytes: Vec&lt;u8&gt;) -&gt; Result&lt;V, Error&gt; {
</a><a href="#h6-0-4" id="h6-0-4" class="i">+    Ok(serde::Deserialize::deserialize(&amp;mut rmps::Deserializer::new(&amp;bytes[..]))?)
</a><a href="#h6-0-5" id="h6-0-5" class="i">+}
</a><a href="#h6-0-6" id="h6-0-6" class="i">+
</a><a href="#h6-0-7" id="h6-0-7" class="i">+/// Serializes a value into a byte buffer
</a><a href="#h6-0-8" id="h6-0-8" class="i">+pub fn serialize&lt;V: serde::Serialize&gt;(value: V) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
</a><a href="#h6-0-9" id="h6-0-9" class="i">+    let mut bytes = Vec::new();
</a><a href="#h6-0-10" id="h6-0-10" class="i">+    value.serialize(&amp;mut rmps::Serializer::new(&amp;mut bytes))?;
</a><a href="#h6-0-11" id="h6-0-11" class="i">+    Ok(bytes)
</a><a href="#h6-0-12" id="h6-0-12" class="i">+}
</a><a href="#h6-0-13" id="h6-0-13" class="i">+\ No newline at end of file
</a></pre>
</div>
</body>
</html>
