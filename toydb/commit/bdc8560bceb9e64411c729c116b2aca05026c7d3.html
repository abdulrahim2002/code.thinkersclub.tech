<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>README: minor tweaks - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/bdc8560bceb9e64411c729c116b2aca05026c7d3.html">bdc8560bceb9e64411c729c116b2aca05026c7d3</a>
<b>parent</b> <a href="../commit/c3dc228e37010225745e947c891d1e4f6e7d6150.html">c3dc228e37010225745e947c891d1e4f6e7d6150</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat, 13 Jun 2020 18:33:09 +0200

README: minor tweaks

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README.md</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">docs/examples.md</a></td><td> | </td><td class="num">81</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------------</span></td></tr>
</table></pre><pre>2 files changed, 42 insertions(+), 41 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -34,7 +34,7 @@ A command-line REPL client can be built and used with the node on `localhost` po
</a> 
 ```
 $ cargo run --release --bin toysql
<a href="#h0-0-3" id="h0-0-3" class="d">-Connected to node &quot;toydb-e&quot; (version 0.1.0). Enter !help for instructions.
</a><a href="#h0-0-4" id="h0-0-4" class="i">+Connected to toyDB node &quot;toydb-e&quot;. Enter !help for instructions.
</a> toydb&gt; CREATE TABLE movies (id INTEGER PRIMARY KEY, title VARCHAR NOT NULL);
 toydb&gt; INSERT INTO movies VALUES (1, &#39;Sicario&#39;), (2, &#39;Stalker&#39;), (3, &#39;Her&#39;);
 toydb&gt; SELECT * FROM movies;
<b>diff --git a/<a id="h1" href="../file/docs/examples.md.html">docs/examples.md</a> b/<a href="../file/docs/examples.md.html">docs/examples.md</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -186,7 +186,7 @@ SELECT 3! + 7 % 4 - 2 ^ 3;
</a> 1
 ```
 
<a href="#h1-0-3" id="h1-0-3" class="d">-Complete 64-bit floating point support is also provided, included handling of infinity and NaN:
</a><a href="#h1-0-4" id="h1-0-4" class="i">+64-bit floating point arithmetic is also supported, including infinity and NaN:
</a> 
 ```sql
 toydb&gt; SELECT 3.14 * 2.718;
<a href="#h1-1" id="h1-1" class="h">@@ -265,7 +265,7 @@ toydb&gt; SELECT g.id, g.name, s.name FROM genres g RIGHT JOIN studios s ON g.id = 
</a> NULL|NULL|Focus Features
 ```
 
<a href="#h1-1-3" id="h1-1-3" class="d">-As well as cross joins (both implicit and explicit):
</a><a href="#h1-1-4" id="h1-1-4" class="i">+And cross joins (both implicit and explicit):
</a> 
 ```sql
 toydb&gt; SELECT g.name, s.name FROM genres g, studios s WHERE s.name &lt; &#39;S&#39;;
<a href="#h1-2" id="h1-2" class="h">@@ -325,7 +325,7 @@ toydb&gt; SELECT   m.id, m.title, g.name AS genre, m.released, s.name AS studio
</a> ## Explain
 
 When optimizing complex queries with several joins, it can often be useful to inspect the query
<a href="#h1-2-3" id="h1-2-3" class="d">-plan via an `EXPLAIN` query, as with the previous join example:
</a><a href="#h1-2-4" id="h1-2-4" class="i">+plan via an `EXPLAIN` query:
</a> 
 ```sql
 toydb&gt; EXPLAIN
<a href="#h1-3" id="h1-3" class="h">@@ -390,8 +390,9 @@ toydb&gt; SELECT s.id, s.name, ((MAX(rating^2) - MIN(rating^2)) / AVG(rating^2)) ^ 
</a> ## Transactions
 
 toyDB supports ACID transactions via MVCC-based snapshot isolation. This provides atomic
<a href="#h1-3-3" id="h1-3-3" class="d">-transactions with good isolation without taking out locks or writes blocking reads. As a
</a><a href="#h1-3-4" id="h1-3-4" class="d">-basic example, the below transaction is rolled back without taking effect:
</a><a href="#h1-3-5" id="h1-3-5" class="i">+transactions with good isolation, without taking out locks or writes blocking reads. As a basic
</a><a href="#h1-3-6" id="h1-3-6" class="i">+example, the below transaction is rolled back without taking effect, as opposed to `COMMIT`
</a><a href="#h1-3-7" id="h1-3-7" class="i">+which would make it permanent:
</a> 
 ```sql
 toydb&gt; BEGIN;
<a href="#h1-4" id="h1-4" class="h">@@ -416,7 +417,7 @@ toydb&gt; SELECT * FROM genres;
</a> 
 We&#39;ll demonstrate transactions by covering most common transaction anomalies given two
 concurrent sessions, and show how toyDB prevents these anomalies in all cases but one. In these
<a href="#h1-4-3" id="h1-4-3" class="d">-examples, the left half is user A and the right is user B, and time flows downwards, such that 
</a><a href="#h1-4-4" id="h1-4-4" class="i">+examples, the left half is user A and the right is user B, and time flows downwards such that 
</a> commands on the same line happen at the same time.
 
 **Dirty write:** an uncommitted write by A should not be affected by a concurrent B write.
<a href="#h1-5" id="h1-5" class="h">@@ -424,8 +425,8 @@ commands on the same line happen at the same time.
</a> ```sql
 a&gt; BEGIN;
 a&gt; INSERT INTO genres VALUES (5, &#39;Western&#39;);
<a href="#h1-5-3" id="h1-5-3" class="d">-                                                 b&gt; INSERT INTO genres VALUES (5, &#39;Romance&#39;);
</a><a href="#h1-5-4" id="h1-5-4" class="d">-                                                 Error: Serialization failure, retry transaction
</a><a href="#h1-5-5" id="h1-5-5" class="i">+                                                   b&gt; INSERT INTO genres VALUES (5, &#39;Romance&#39;);
</a><a href="#h1-5-6" id="h1-5-6" class="i">+                                                   Error: Serialization failure, retry transaction
</a> a&gt; SELECT * FROM genres WHERE id = 5;
 5|Western
 ```
<a href="#h1-6" id="h1-6" class="h">@@ -438,23 +439,23 @@ optimal strategy, but it is correct in terms of preventing serialization anomali
</a> ```sql
 a&gt; BEGIN;
 a&gt; INSERT INTO genres VALUES (5, &#39;Western&#39;);
<a href="#h1-6-3" id="h1-6-3" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 5;
</a><a href="#h1-6-4" id="h1-6-4" class="d">-                                                 No rows returned
</a><a href="#h1-6-5" id="h1-6-5" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 5;
</a><a href="#h1-6-6" id="h1-6-6" class="i">+                                                  No rows returned
</a> a&gt; COMMIT;
<a href="#h1-6-8" id="h1-6-8" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 5;
</a><a href="#h1-6-9" id="h1-6-9" class="d">-                                                 5|Western
</a><a href="#h1-6-10" id="h1-6-10" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 5;
</a><a href="#h1-6-11" id="h1-6-11" class="i">+                                                  5|Western
</a> ```
 
 **Lost update:** when A and B both read a value, before updating it in turn, the first write should
 not be overwritten by the second.
 
 ```sql
<a href="#h1-6-18" id="h1-6-18" class="d">-a&gt; BEGIN;                                          b&gt; BEGIN;
</a><a href="#h1-6-19" id="h1-6-19" class="d">-a&gt; SELECT title, rating FROM movies WHERE id = 2;  b&gt; SELECT title, rating FROM movies WHERE id = 2;
</a><a href="#h1-6-20" id="h1-6-20" class="d">-Sicario|7.6                                        Sicario|7.6
</a><a href="#h1-6-21" id="h1-6-21" class="i">+a&gt; BEGIN;                                         b&gt; BEGIN;
</a><a href="#h1-6-22" id="h1-6-22" class="i">+a&gt; SELECT title, rating FROM movies WHERE id = 2; b&gt; SELECT title, rating FROM movies WHERE id = 2;
</a><a href="#h1-6-23" id="h1-6-23" class="i">+Sicario|7.6                                       Sicario|7.6
</a> a&gt; UPDATE movies SET rating = 7.8 WHERE id = 2;
<a href="#h1-6-25" id="h1-6-25" class="d">-                                                   b&gt; UPDATE movies SET rating = 7.7 WHERE id = 2;
</a><a href="#h1-6-26" id="h1-6-26" class="d">-                                                   Error: Serialization failure, retry transaction
</a><a href="#h1-6-27" id="h1-6-27" class="i">+                                                  b&gt; UPDATE movies SET rating = 7.7 WHERE id = 2;
</a><a href="#h1-6-28" id="h1-6-28" class="i">+                                                  Error: Serialization failure, retry transaction
</a> a&gt; COMMIT;
 ```
 
<a href="#h1-7" id="h1-7" class="h">@@ -462,17 +463,17 @@ a&gt; COMMIT;
</a> new value.
 
 ```sql
<a href="#h1-7-3" id="h1-7-3" class="d">-a&gt; BEGIN;                                        b&gt; BEGIN;
</a><a href="#h1-7-4" id="h1-7-4" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-5" id="h1-7-5" class="d">-                                                 1|Science Fiction
</a><a href="#h1-7-6" id="h1-7-6" class="i">+a&gt; BEGIN;                                         b&gt; BEGIN;
</a><a href="#h1-7-7" id="h1-7-7" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-8" id="h1-7-8" class="i">+                                                  1|Science Fiction
</a> a&gt; UPDATE genres SET name = &#39;Scifi&#39; WHERE id = 1;
 a&gt; COMMIT;
<a href="#h1-7-11" id="h1-7-11" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-12" id="h1-7-12" class="d">-                                                 1|Science Fiction
</a><a href="#h1-7-13" id="h1-7-13" class="d">-                                                 b&gt; COMMIT;
</a><a href="#h1-7-14" id="h1-7-14" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-15" id="h1-7-15" class="i">+                                                  1|Science Fiction
</a><a href="#h1-7-16" id="h1-7-16" class="i">+                                                  b&gt; COMMIT;
</a> 
<a href="#h1-7-18" id="h1-7-18" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-19" id="h1-7-19" class="d">-                                                 1|Scifi
</a><a href="#h1-7-20" id="h1-7-20" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 1;
</a><a href="#h1-7-21" id="h1-7-21" class="i">+                                                  1|Scifi
</a> ```
 
 **Read skew:** if A reads two values, and B modifies the second value in between the reads, A 
<a href="#h1-8" id="h1-8" class="h">@@ -482,45 +483,45 @@ should see the old second value.
</a> a&gt; BEGIN;
 a&gt; SELECT * FROM genres WHERE id = 2;
 2|Action
<a href="#h1-8-3" id="h1-8-3" class="d">-                                                 b&gt; BEGIN;
</a><a href="#h1-8-4" id="h1-8-4" class="d">-                                                 b&gt; UPDATE genres SET name = &#39;Drama&#39; WHERE id = 2;
</a><a href="#h1-8-5" id="h1-8-5" class="d">-                                                 b&gt; UPDATE genres SET name = &#39;Action&#39; WHERE id = 3;
</a><a href="#h1-8-6" id="h1-8-6" class="d">-                                                 b&gt; COMMIT;
</a><a href="#h1-8-7" id="h1-8-7" class="i">+                                                  b&gt; BEGIN;
</a><a href="#h1-8-8" id="h1-8-8" class="i">+                                                  b&gt; UPDATE genres SET name = &#39;Drama&#39; WHERE id = 2;
</a><a href="#h1-8-9" id="h1-8-9" class="i">+                                                  b&gt; UPDATE genres SET name = &#39;Action&#39; WHERE id = 3;
</a><a href="#h1-8-10" id="h1-8-10" class="i">+                                                  b&gt; COMMIT;
</a> a&gt; SELECT * FROM genres WHERE id = 3;
 3|Drama
 ```
 
<a href="#h1-8-15" id="h1-8-15" class="d">-**Phantom read:** when A runs a query with some predicate, and B commits a matching write, A should
</a><a href="#h1-8-16" id="h1-8-16" class="d">-not see the write when rerunning the query.
</a><a href="#h1-8-17" id="h1-8-17" class="i">+**Phantom read:** when A runs a query with a predicate, and B commits a matching write, A should
</a><a href="#h1-8-18" id="h1-8-18" class="i">+not see the write when rerunning it.
</a> 
 ```sql
 a&gt; BEGIN;
 a&gt; SELECT * FROM genres WHERE id &gt; 2;
 3|Drama
 4|Comedy
<a href="#h1-8-25" id="h1-8-25" class="d">-                                                 b&gt; INSERT INTO genres VALUES (5, &#39;Western&#39;);
</a><a href="#h1-8-26" id="h1-8-26" class="i">+                                                  b&gt; INSERT INTO genres VALUES (5, &#39;Western&#39;);
</a> a&gt; SELECT * FROM genres WHERE id &gt; 2;
 3|Drama
 4|Comedy
 ```
 
<a href="#h1-8-32" id="h1-8-32" class="d">-**Write skew:**  when A reads row X and writes it to row Y, B should not concurrently be able to
</a><a href="#h1-8-33" id="h1-8-33" class="i">+**Write skew:** when A reads row X and writes it to row Y, B should not concurrently be able to
</a> read row Y and write it to row X.
 
 ```sql
<a href="#h1-8-37" id="h1-8-37" class="d">-a&gt; BEGIN;                                        b&gt; BEGIN;
</a><a href="#h1-8-38" id="h1-8-38" class="i">+a&gt; BEGIN;                                         b&gt; BEGIN;
</a> a&gt; SELECT * FROM genres WHERE id = 2;
 2|Action
<a href="#h1-8-41" id="h1-8-41" class="d">-                                                 b&gt; SELECT * FROM genres WHERE id = 3;
</a><a href="#h1-8-42" id="h1-8-42" class="d">-                                                 3|Drama
</a><a href="#h1-8-43" id="h1-8-43" class="d">-                                                 b&gt; UPDATE genres SET name = &#39;Drama&#39; WHERE id = 2;
</a><a href="#h1-8-44" id="h1-8-44" class="i">+                                                  b&gt; SELECT * FROM genres WHERE id = 3;
</a><a href="#h1-8-45" id="h1-8-45" class="i">+                                                  3|Drama
</a><a href="#h1-8-46" id="h1-8-46" class="i">+                                                  b&gt; UPDATE genres SET name = &#39;Drama&#39; WHERE id = 2;
</a> a&gt; UPDATE genres SET name = &#39;Action&#39; WHERE id = 3;
<a href="#h1-8-48" id="h1-8-48" class="d">-a&gt; COMMIT;                                       b&gt; COMMIT;
</a><a href="#h1-8-49" id="h1-8-49" class="i">+a&gt; COMMIT;                                        b&gt; COMMIT;
</a> ```
 
 Here, the writes actually go through. This anomaly is not protected against by snapshot isolation, 
<a href="#h1-8-53" id="h1-8-53" class="d">-and thus not by toyDB either. Doing so would require implementing serializable snapshot isolation. 
</a><a href="#h1-8-54" id="h1-8-54" class="d">-However, this is the only common serialization anomaly not handled by toyDB, and is not among the
</a><a href="#h1-8-55" id="h1-8-55" class="i">+and thus not by toyDB either - doing so would require implementing serializable snapshot isolation. 
</a><a href="#h1-8-56" id="h1-8-56" class="i">+However, this is the only common serialization anomaly not handled by toyDB, and is not amongst the
</a> most serious.
 
 ## Time-Travel Queries
</pre>
</div>
</body>
</html>
