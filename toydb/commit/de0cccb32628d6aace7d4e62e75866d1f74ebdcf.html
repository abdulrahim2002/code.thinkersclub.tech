<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Default to relative config and data dir - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/de0cccb32628d6aace7d4e62e75866d1f74ebdcf.html">de0cccb32628d6aace7d4e62e75866d1f74ebdcf</a>
<b>parent</b> <a href="../commit/944988fa3c3b0a52f755982dbc96f784b8428038.html">944988fa3c3b0a52f755982dbc96f784b8428038</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sun, 13 Aug 2023 22:28:48 +0200

Default to relative config and data dir

This patch defaults to `config/toydb.yaml` and `data/` for the config
file and data directory respectively. The previous defaults,
`/etc/toydb.yaml` and `/var/lib/toydb`, were not particularly helpful
when spinning up a local node to play with.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">.gitignore</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Dockerfile</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">README.md</a></td><td> | </td><td class="num">8</td><td><span class="i">+</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">clusters/docker/toydb-a/toydb.yaml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">clusters/docker/toydb-b/toydb.yaml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">clusters/docker/toydb-c/toydb.yaml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">clusters/docker/toydb-d/toydb.yaml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">clusters/docker/toydb-e/toydb.yaml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">config/toydb.yaml</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/bin/toydb.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
</table></pre><pre>10 files changed, 12 insertions(+), 11 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.gitignore.html">.gitignore</a> b/<a href="../file/.gitignore.html">.gitignore</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,4 +1,5 @@
</a> /clusters/*/toydb-?/data
<a href="#h0-0-1" id="h0-0-1" class="i">+/data
</a> /target
 .vscode/
 **/*.rs.bk
 \ No newline at end of file
<b>diff --git a/<a id="h1" href="../file/Dockerfile.html">Dockerfile</a> b/<a href="../file/Dockerfile.html">Dockerfile</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -24,4 +24,5 @@ RUN cargo install --bin toydb --locked --offline --path . --target=$TARGET
</a> FROM alpine:3.18
 COPY --from=build /usr/local/cargo/bin/toydb /usr/local/bin/toydb
 COPY --from=build /usr/src/toydb/config/toydb.yaml /etc/toydb.yaml
<a href="#h1-0-3" id="h1-0-3" class="d">-CMD [&quot;toydb&quot;]
</a><a href="#h1-0-4" id="h1-0-4" class="i">+RUN sed -i -e &#39;s|data_dir:.*|data_dir: /var/lib/toydb|g&#39; /etc/toydb.yaml
</a><a href="#h1-0-5" id="h1-0-5" class="i">+CMD [&quot;toydb&quot;, &quot;-c&quot;, &quot;/etc/toydb.yaml&quot;]
</a><b>diff --git a/<a id="h2" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -143,13 +143,7 @@ The debug configuration is included under `.vscode/launch.json`. Follow these st
</a> 
 2. Go to &quot;Run and Debug&quot; tab and select e.g. &quot;Debug unit tests in library &#39;toydb&#39;&quot;.
 
<a href="#h2-0-3" id="h2-0-3" class="d">-3. To debug the binary, create a data directory:
</a><a href="#h2-0-4" id="h2-0-4" class="d">-
</a><a href="#h2-0-5" id="h2-0-5" class="d">-    ```
</a><a href="#h2-0-6" id="h2-0-6" class="d">-    $ sudo mkdir /var/lib/toydb &amp;&amp; sudo chown $(whoami) /var/lib/toydb
</a><a href="#h2-0-7" id="h2-0-7" class="d">-    ```
</a><a href="#h2-0-8" id="h2-0-8" class="d">-
</a><a href="#h2-0-9" id="h2-0-9" class="d">-   And then selet &quot;Debug executable &#39;toydb&#39;&quot; under &quot;Run and Debug&quot;.
</a><a href="#h2-0-10" id="h2-0-10" class="i">+3. To debug the binary, select &quot;Debug executable &#39;toydb&#39;&quot; under &quot;Run and Debug&quot;.
</a> 
 ## Credits
 
<b>diff --git a/<a id="h3" href="../file/clusters/docker/toydb-a/toydb.yaml.html">clusters/docker/toydb-a/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-a/toydb.yaml.html">clusters/docker/toydb-a/toydb.yaml</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,4 +1,5 @@
</a> id: toydb-a
<a href="#h3-0-1" id="h3-0-1" class="i">+data_dir: /var/lib/toydb
</a> peers:
   toydb-b: 172.20.0.102
   toydb-c: 172.20.0.103
<b>diff --git a/<a id="h4" href="../file/clusters/docker/toydb-b/toydb.yaml.html">clusters/docker/toydb-b/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-b/toydb.yaml.html">clusters/docker/toydb-b/toydb.yaml</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,4 +1,5 @@
</a> id: toydb-b
<a href="#h4-0-1" id="h4-0-1" class="i">+data_dir: /var/lib/toydb
</a> peers:
   toydb-a: 172.20.0.101
   toydb-c: 172.20.0.103
<b>diff --git a/<a id="h5" href="../file/clusters/docker/toydb-c/toydb.yaml.html">clusters/docker/toydb-c/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-c/toydb.yaml.html">clusters/docker/toydb-c/toydb.yaml</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,4 +1,5 @@
</a> id: toydb-c
<a href="#h5-0-1" id="h5-0-1" class="i">+data_dir: /var/lib/toydb
</a> peers:
   toydb-a: 172.20.0.101
   toydb-b: 172.20.0.102
<b>diff --git a/<a id="h6" href="../file/clusters/docker/toydb-d/toydb.yaml.html">clusters/docker/toydb-d/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-d/toydb.yaml.html">clusters/docker/toydb-d/toydb.yaml</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,4 +1,5 @@
</a> id: toydb-d
<a href="#h6-0-1" id="h6-0-1" class="i">+data_dir: /var/lib/toydb
</a> peers:
   toydb-a: 172.20.0.101
   toydb-b: 172.20.0.102
<b>diff --git a/<a id="h7" href="../file/clusters/docker/toydb-e/toydb.yaml.html">clusters/docker/toydb-e/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-e/toydb.yaml.html">clusters/docker/toydb-e/toydb.yaml</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,4 +1,5 @@
</a> id: toydb-e
<a href="#h7-0-1" id="h7-0-1" class="i">+data_dir: /var/lib/toydb
</a> peers:
   toydb-a: 172.20.0.101
   toydb-b: 172.20.0.102
<b>diff --git a/<a id="h8" href="../file/config/toydb.yaml.html">config/toydb.yaml</a> b/<a href="../file/config/toydb.yaml.html">config/toydb.yaml</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -11,7 +11,7 @@ listen_raft: 0.0.0.0:9705
</a> # persisted to disk, but has a high performance penalty. Disabling fsync and relying on cluster
 # redundancy for data durability may be a reasonable trade-off, although this can compromise Raft
 # linearizability guarantees in rare edge cases where committed entries lose majority.
<a href="#h8-0-3" id="h8-0-3" class="d">-data_dir: /var/lib/toydb
</a><a href="#h8-0-4" id="h8-0-4" class="i">+data_dir: data
</a> sync: true
 
 # Raft log storage engine
<b>diff --git a/<a id="h9" href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a> b/<a href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -20,7 +20,7 @@ async fn main() -&gt; Result&lt;()&gt; {
</a>                 .short(&#39;c&#39;)
                 .long(&quot;config&quot;)
                 .help(&quot;Configuration file path&quot;)
<a href="#h9-0-3" id="h9-0-3" class="d">-                .default_value(&quot;/etc/toydb.yaml&quot;),
</a><a href="#h9-0-4" id="h9-0-4" class="i">+                .default_value(&quot;config/toydb.yaml&quot;),
</a>         )
         .get_matches();
     let cfg = Config::new(args.get_one::&lt;String&gt;(&quot;config&quot;).unwrap().as_ref())?;
<a href="#h9-1" id="h9-1" class="h">@@ -73,7 +73,7 @@ impl Config {
</a>             .set_default(&quot;listen_sql&quot;, &quot;0.0.0.0:9605&quot;)?
             .set_default(&quot;listen_raft&quot;, &quot;0.0.0.0:9705&quot;)?
             .set_default(&quot;log_level&quot;, &quot;info&quot;)?
<a href="#h9-1-3" id="h9-1-3" class="d">-            .set_default(&quot;data_dir&quot;, &quot;/var/lib/toydb&quot;)?
</a><a href="#h9-1-4" id="h9-1-4" class="i">+            .set_default(&quot;data_dir&quot;, &quot;data&quot;)?
</a>             .set_default(&quot;sync&quot;, true)?
             .set_default(&quot;storage_raft&quot;, &quot;hybrid&quot;)?
             .set_default(&quot;storage_sql&quot;, &quot;memory&quot;)?
</pre>
</div>
</body>
</html>
