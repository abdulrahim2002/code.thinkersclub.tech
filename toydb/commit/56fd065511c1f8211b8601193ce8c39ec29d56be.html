<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Use integer Raft node IDs. - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/56fd065511c1f8211b8601193ce8c39ec29d56be.html">56fd065511c1f8211b8601193ce8c39ec29d56be</a>
<b>parent</b> <a href="../commit/b6b48e091ba71e273aad0d3ee4ec3b430775611f.html">b6b48e091ba71e273aad0d3ee4ec3b430775611f</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sat, 18 Nov 2023 11:36:53 +0100

Use integer Raft node IDs.

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">.gitignore</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">clusters/docker/docker-compose.yml</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h2">clusters/docker/toydb-a/toydb.yaml</a></td><td> | </td><td class="num">8</td><td><span class="i"></span><span class="d">--------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">clusters/docker/toydb-b/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">clusters/docker/toydb-c/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h5">clusters/docker/toydb-d/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h6">clusters/docker/toydb-e/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="R">R</td><td><a href="#h7">clusters/docker/toydb-a/data/.gitkeep -&gt; clusters/docker/toydb1/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">clusters/docker/toydb1/toydb.yaml</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h9">clusters/docker/toydb-b/data/.gitkeep -&gt; clusters/docker/toydb2/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">clusters/docker/toydb2/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h11">clusters/docker/toydb-c/data/.gitkeep -&gt; clusters/docker/toydb3/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">clusters/docker/toydb3/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h13">clusters/docker/toydb-d/data/.gitkeep -&gt; clusters/docker/toydb4/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">clusters/docker/toydb4/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h15">clusters/docker/toydb-e/data/.gitkeep -&gt; clusters/docker/toydb5/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">clusters/docker/toydb5/toydb.yaml</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">clusters/local/run.sh</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h18">clusters/local/toydb-a/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h19">clusters/local/toydb-b/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h20">clusters/local/toydb-c/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h21">clusters/local/toydb-d/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h22">clusters/local/toydb-e/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="R">R</td><td><a href="#h23">clusters/local/toydb-a/data/.gitkeep -&gt; clusters/local/toydb1/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h24">clusters/local/toydb1/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h25">clusters/local/toydb-b/data/.gitkeep -&gt; clusters/local/toydb2/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">clusters/local/toydb2/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h27">clusters/local/toydb-c/data/.gitkeep -&gt; clusters/local/toydb3/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h28">clusters/local/toydb3/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h29">clusters/local/toydb-d/data/.gitkeep -&gt; clusters/local/toydb4/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h30">clusters/local/toydb4/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h31">clusters/local/toydb-e/data/.gitkeep -&gt; clusters/local/toydb5/data/.gitkeep</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h32">clusters/local/toydb5/toydb.yaml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">config/toydb.yaml</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">docs/examples.md</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">src/bin/toydb.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">src/raft/log.rs</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">src/raft/message.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">src/raft/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">src/raft/node/candidate.rs</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">src/raft/node/follower.rs</a></td><td> | </td><td class="num">248</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">src/raft/node/leader.rs</a></td><td> | </td><td class="num">121</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">src/raft/node/mod.rs</a></td><td> | </td><td class="num">78</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">src/raft/server.rs</a></td><td> | </td><td class="num">25</td><td><span class="i">++++++++++++</span><span class="d">-------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">src/raft/state.rs</a></td><td> | </td><td class="num">16</td><td><span class="i">++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">src/server.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">tests/client/mod.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">tests/client/pool.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">+</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">tests/setup.rs</a></td><td> | </td><td class="num">31</td><td><span class="i">++++++++++++++</span><span class="d">-----------------</span></td></tr>
</table></pre><pre>49 files changed, 410 insertions(+), 440 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.gitignore.html">.gitignore</a> b/<a href="../file/.gitignore.html">.gitignore</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,4 +1,4 @@
</a><a href="#h0-0-0" id="h0-0-0" class="d">-/clusters/*/toydb-?/data
</a><a href="#h0-0-1" id="h0-0-1" class="i">+/clusters/*/toydb*/data
</a> /data
 /target
 .vscode/
<b>diff --git a/<a id="h1" href="../file/clusters/docker/docker-compose.yml.html">clusters/docker/docker-compose.yml</a> b/<a href="../file/clusters/docker/docker-compose.yml.html">clusters/docker/docker-compose.yml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -6,62 +6,62 @@ networks:
</a>     ipam:
       driver: default
       config:
<a href="#h1-0-3" id="h1-0-3" class="d">-      - subnet: 172.20.0.0/24
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        - subnet: 172.20.0.0/24
</a> 
 services:
<a href="#h1-0-7" id="h1-0-7" class="d">-  toydb-a: &amp;toydb
</a><a href="#h1-0-8" id="h1-0-8" class="i">+  toydb1: &amp;toydb
</a>     build: ..
     environment:
<a href="#h1-0-11" id="h1-0-11" class="d">-    - TOYDB_LOG_LEVEL
</a><a href="#h1-0-12" id="h1-0-12" class="i">+      - TOYDB_LOG_LEVEL
</a>     volumes:
<a href="#h1-0-14" id="h1-0-14" class="d">-    - ./toydb-a/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-15" id="h1-0-15" class="d">-    - ./toydb-a/data:/var/lib/toydb
</a><a href="#h1-0-16" id="h1-0-16" class="i">+      - ./toydb1/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-17" id="h1-0-17" class="i">+      - ./toydb1/data:/var/lib/toydb
</a>     networks:
       toydb:
         ipv4_address: 172.20.0.101
     ports:
<a href="#h1-0-22" id="h1-0-22" class="d">-    - 9601:9605
</a><a href="#h1-0-23" id="h1-0-23" class="i">+      - 9601:9605
</a> 
<a href="#h1-0-25" id="h1-0-25" class="d">-  toydb-b:
</a><a href="#h1-0-26" id="h1-0-26" class="i">+  toydb2:
</a>     &lt;&lt;: *toydb
     volumes:
<a href="#h1-0-29" id="h1-0-29" class="d">-    - ./toydb-b/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-30" id="h1-0-30" class="d">-    - ./toydb-b/data:/var/lib/toydb
</a><a href="#h1-0-31" id="h1-0-31" class="i">+      - ./toydb2/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-32" id="h1-0-32" class="i">+      - ./toydb2/data:/var/lib/toydb
</a>     networks:
       toydb:
         ipv4_address: 172.20.0.102
     ports:
<a href="#h1-0-37" id="h1-0-37" class="d">-    - 9602:9605
</a><a href="#h1-0-38" id="h1-0-38" class="i">+      - 9602:9605
</a> 
<a href="#h1-0-40" id="h1-0-40" class="d">-  toydb-c:
</a><a href="#h1-0-41" id="h1-0-41" class="i">+  toydb3:
</a>     &lt;&lt;: *toydb
     volumes:
<a href="#h1-0-44" id="h1-0-44" class="d">-    - ./toydb-c/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-45" id="h1-0-45" class="d">-    - ./toydb-c/data:/var/lib/toydb
</a><a href="#h1-0-46" id="h1-0-46" class="i">+      - ./toydb3/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-47" id="h1-0-47" class="i">+      - ./toydb3/data:/var/lib/toydb
</a>     networks:
       toydb:
         ipv4_address: 172.20.0.103
     ports:
<a href="#h1-0-52" id="h1-0-52" class="d">-    - 9603:9605
</a><a href="#h1-0-53" id="h1-0-53" class="i">+      - 9603:9605
</a> 
<a href="#h1-0-55" id="h1-0-55" class="d">-  toydb-d:
</a><a href="#h1-0-56" id="h1-0-56" class="i">+  toydb4:
</a>     &lt;&lt;: *toydb
     volumes:
<a href="#h1-0-59" id="h1-0-59" class="d">-    - ./toydb-d/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-60" id="h1-0-60" class="d">-    - ./toydb-d/data:/var/lib/toydb
</a><a href="#h1-0-61" id="h1-0-61" class="i">+      - ./toydb4/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-62" id="h1-0-62" class="i">+      - ./toydb4/data:/var/lib/toydb
</a>     networks:
       toydb:
         ipv4_address: 172.20.0.104
     ports:
<a href="#h1-0-67" id="h1-0-67" class="d">-    - 9604:9605
</a><a href="#h1-0-68" id="h1-0-68" class="i">+      - 9604:9605
</a> 
<a href="#h1-0-70" id="h1-0-70" class="d">-  toydb-e:
</a><a href="#h1-0-71" id="h1-0-71" class="i">+  toydb5:
</a>     &lt;&lt;: *toydb
     volumes:
<a href="#h1-0-74" id="h1-0-74" class="d">-    - ./toydb-e/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-75" id="h1-0-75" class="d">-    - ./toydb-e/data:/var/lib/toydb
</a><a href="#h1-0-76" id="h1-0-76" class="i">+      - ./toydb5/toydb.yaml:/etc/toydb.yaml
</a><a href="#h1-0-77" id="h1-0-77" class="i">+      - ./toydb5/data:/var/lib/toydb
</a>     networks:
       toydb:
         ipv4_address: 172.20.0.105
     ports:
<a href="#h1-0-82" id="h1-0-82" class="d">-    - 9605:9605
</a><a href="#h1-0-83" id="h1-0-83" class="i">+      - 9605:9605
</a><b>diff --git a/<a id="h2" href="../file/clusters/docker/toydb-a/toydb.yaml.html">clusters/docker/toydb-a/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-a/toydb.yaml.html">clusters/docker/toydb-a/toydb.yaml</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,7 +0,0 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-id: toydb-a
</a><a href="#h2-0-1" id="h2-0-1" class="d">-data_dir: /var/lib/toydb
</a><a href="#h2-0-2" id="h2-0-2" class="d">-peers:
</a><a href="#h2-0-3" id="h2-0-3" class="d">-  toydb-b: 172.20.0.102
</a><a href="#h2-0-4" id="h2-0-4" class="d">-  toydb-c: 172.20.0.103
</a><a href="#h2-0-5" id="h2-0-5" class="d">-  toydb-d: 172.20.0.104
</a><a href="#h2-0-6" id="h2-0-6" class="d">-  toydb-e: 172.20.0.105
</a><a href="#h2-0-7" id="h2-0-7" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/clusters/docker/toydb-b/toydb.yaml.html">clusters/docker/toydb-b/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-b/toydb.yaml.html">clusters/docker/toydb-b/toydb.yaml</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,7 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-id: toydb-b
</a><a href="#h3-0-1" id="h3-0-1" class="d">-data_dir: /var/lib/toydb
</a><a href="#h3-0-2" id="h3-0-2" class="d">-peers:
</a><a href="#h3-0-3" id="h3-0-3" class="d">-  toydb-a: 172.20.0.101
</a><a href="#h3-0-4" id="h3-0-4" class="d">-  toydb-c: 172.20.0.103
</a><a href="#h3-0-5" id="h3-0-5" class="d">-  toydb-d: 172.20.0.104
</a><a href="#h3-0-6" id="h3-0-6" class="d">-  toydb-e: 172.20.0.105
</a><b>diff --git a/<a id="h4" href="../file/clusters/docker/toydb-c/toydb.yaml.html">clusters/docker/toydb-c/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-c/toydb.yaml.html">clusters/docker/toydb-c/toydb.yaml</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,7 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-id: toydb-c
</a><a href="#h4-0-1" id="h4-0-1" class="d">-data_dir: /var/lib/toydb
</a><a href="#h4-0-2" id="h4-0-2" class="d">-peers:
</a><a href="#h4-0-3" id="h4-0-3" class="d">-  toydb-a: 172.20.0.101
</a><a href="#h4-0-4" id="h4-0-4" class="d">-  toydb-b: 172.20.0.102
</a><a href="#h4-0-5" id="h4-0-5" class="d">-  toydb-d: 172.20.0.104
</a><a href="#h4-0-6" id="h4-0-6" class="d">-  toydb-e: 172.20.0.105
</a><b>diff --git a/<a id="h5" href="../file/clusters/docker/toydb-d/toydb.yaml.html">clusters/docker/toydb-d/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-d/toydb.yaml.html">clusters/docker/toydb-d/toydb.yaml</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,7 +0,0 @@
</a><a href="#h5-0-0" id="h5-0-0" class="d">-id: toydb-d
</a><a href="#h5-0-1" id="h5-0-1" class="d">-data_dir: /var/lib/toydb
</a><a href="#h5-0-2" id="h5-0-2" class="d">-peers:
</a><a href="#h5-0-3" id="h5-0-3" class="d">-  toydb-a: 172.20.0.101
</a><a href="#h5-0-4" id="h5-0-4" class="d">-  toydb-b: 172.20.0.102
</a><a href="#h5-0-5" id="h5-0-5" class="d">-  toydb-c: 172.20.0.103
</a><a href="#h5-0-6" id="h5-0-6" class="d">-  toydb-e: 172.20.0.105
</a><b>diff --git a/<a id="h6" href="../file/clusters/docker/toydb-e/toydb.yaml.html">clusters/docker/toydb-e/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb-e/toydb.yaml.html">clusters/docker/toydb-e/toydb.yaml</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,7 +0,0 @@
</a><a href="#h6-0-0" id="h6-0-0" class="d">-id: toydb-e
</a><a href="#h6-0-1" id="h6-0-1" class="d">-data_dir: /var/lib/toydb
</a><a href="#h6-0-2" id="h6-0-2" class="d">-peers:
</a><a href="#h6-0-3" id="h6-0-3" class="d">-  toydb-a: 172.20.0.101
</a><a href="#h6-0-4" id="h6-0-4" class="d">-  toydb-b: 172.20.0.102
</a><a href="#h6-0-5" id="h6-0-5" class="d">-  toydb-c: 172.20.0.103
</a><a href="#h6-0-6" id="h6-0-6" class="d">-  toydb-d: 172.20.0.104
</a><b>diff --git a/<a id="h7" href="../file/clusters/docker/toydb-a/data/.gitkeep.html">clusters/docker/toydb-a/data/.gitkeep</a> b/<a href="../file/clusters/docker/toydb1/data/.gitkeep.html">clusters/docker/toydb1/data/.gitkeep</a></b>
<b>diff --git a/<a id="h8" href="../file/clusters/docker/toydb1/toydb.yaml.html">clusters/docker/toydb1/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb1/toydb.yaml.html">clusters/docker/toydb1/toydb.yaml</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+id: 1
</a><a href="#h8-0-1" id="h8-0-1" class="i">+data_dir: /var/lib/toydb
</a><a href="#h8-0-2" id="h8-0-2" class="i">+peers:
</a><a href="#h8-0-3" id="h8-0-3" class="i">+  2: 172.20.0.102
</a><a href="#h8-0-4" id="h8-0-4" class="i">+  3: 172.20.0.103
</a><a href="#h8-0-5" id="h8-0-5" class="i">+  4: 172.20.0.104
</a><a href="#h8-0-6" id="h8-0-6" class="i">+  5: 172.20.0.105
</a><a href="#h8-0-7" id="h8-0-7" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/clusters/docker/toydb-b/data/.gitkeep.html">clusters/docker/toydb-b/data/.gitkeep</a> b/<a href="../file/clusters/docker/toydb2/data/.gitkeep.html">clusters/docker/toydb2/data/.gitkeep</a></b>
<b>diff --git a/<a id="h10" href="../file/clusters/docker/toydb2/toydb.yaml.html">clusters/docker/toydb2/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb2/toydb.yaml.html">clusters/docker/toydb2/toydb.yaml</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+id: 2
</a><a href="#h10-0-1" id="h10-0-1" class="i">+data_dir: /var/lib/toydb
</a><a href="#h10-0-2" id="h10-0-2" class="i">+peers:
</a><a href="#h10-0-3" id="h10-0-3" class="i">+  1: 172.20.0.101
</a><a href="#h10-0-4" id="h10-0-4" class="i">+  3: 172.20.0.103
</a><a href="#h10-0-5" id="h10-0-5" class="i">+  4: 172.20.0.104
</a><a href="#h10-0-6" id="h10-0-6" class="i">+  5: 172.20.0.105
</a><b>diff --git a/<a id="h11" href="../file/clusters/docker/toydb-c/data/.gitkeep.html">clusters/docker/toydb-c/data/.gitkeep</a> b/<a href="../file/clusters/docker/toydb3/data/.gitkeep.html">clusters/docker/toydb3/data/.gitkeep</a></b>
<b>diff --git a/<a id="h12" href="../file/clusters/docker/toydb3/toydb.yaml.html">clusters/docker/toydb3/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb3/toydb.yaml.html">clusters/docker/toydb3/toydb.yaml</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+3: toydb-c
</a><a href="#h12-0-1" id="h12-0-1" class="i">+data_dir: /var/lib/toydb
</a><a href="#h12-0-2" id="h12-0-2" class="i">+peers:
</a><a href="#h12-0-3" id="h12-0-3" class="i">+  1: 172.20.0.101
</a><a href="#h12-0-4" id="h12-0-4" class="i">+  2: 172.20.0.102
</a><a href="#h12-0-5" id="h12-0-5" class="i">+  4: 172.20.0.104
</a><a href="#h12-0-6" id="h12-0-6" class="i">+  5: 172.20.0.105
</a><b>diff --git a/<a id="h13" href="../file/clusters/docker/toydb-d/data/.gitkeep.html">clusters/docker/toydb-d/data/.gitkeep</a> b/<a href="../file/clusters/docker/toydb4/data/.gitkeep.html">clusters/docker/toydb4/data/.gitkeep</a></b>
<b>diff --git a/<a id="h14" href="../file/clusters/docker/toydb4/toydb.yaml.html">clusters/docker/toydb4/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb4/toydb.yaml.html">clusters/docker/toydb4/toydb.yaml</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+4: toydb-d
</a><a href="#h14-0-1" id="h14-0-1" class="i">+data_dir: /var/lib/toydb
</a><a href="#h14-0-2" id="h14-0-2" class="i">+peers:
</a><a href="#h14-0-3" id="h14-0-3" class="i">+  1: 172.20.0.101
</a><a href="#h14-0-4" id="h14-0-4" class="i">+  2: 172.20.0.102
</a><a href="#h14-0-5" id="h14-0-5" class="i">+  3: 172.20.0.103
</a><a href="#h14-0-6" id="h14-0-6" class="i">+  5: 172.20.0.105
</a><b>diff --git a/<a id="h15" href="../file/clusters/docker/toydb-e/data/.gitkeep.html">clusters/docker/toydb-e/data/.gitkeep</a> b/<a href="../file/clusters/docker/toydb5/data/.gitkeep.html">clusters/docker/toydb5/data/.gitkeep</a></b>
<b>diff --git a/<a id="h16" href="../file/clusters/docker/toydb5/toydb.yaml.html">clusters/docker/toydb5/toydb.yaml</a> b/<a href="../file/clusters/docker/toydb5/toydb.yaml.html">clusters/docker/toydb5/toydb.yaml</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+5: toydb-e
</a><a href="#h16-0-1" id="h16-0-1" class="i">+data_dir: /var/lib/toydb
</a><a href="#h16-0-2" id="h16-0-2" class="i">+peers:
</a><a href="#h16-0-3" id="h16-0-3" class="i">+  1: 172.20.0.101
</a><a href="#h16-0-4" id="h16-0-4" class="i">+  2: 172.20.0.102
</a><a href="#h16-0-5" id="h16-0-5" class="i">+  3: 172.20.0.103
</a><a href="#h16-0-6" id="h16-0-6" class="i">+  4: 172.20.0.104
</a><b>diff --git a/<a id="h17" href="../file/clusters/local/run.sh.html">clusters/local/run.sh</a> b/<a href="../file/clusters/local/run.sh.html">clusters/local/run.sh</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -4,8 +4,8 @@ set -euo pipefail
</a> 
 cargo build --release --bin toydb
 
<a href="#h17-0-3" id="h17-0-3" class="d">-for ID in a b c d e; do
</a><a href="#h17-0-4" id="h17-0-4" class="d">-    (cargo run -q --release -- -c toydb-$ID/toydb.yaml 2&gt;&amp;1 | sed -e &quot;s/\\(.*\\)/toydb-$ID \\1/g&quot;) &amp;
</a><a href="#h17-0-5" id="h17-0-5" class="i">+for ID in 1 2 3 4 5; do
</a><a href="#h17-0-6" id="h17-0-6" class="i">+    (cargo run -q --release -- -c toydb$ID/toydb.yaml 2&gt;&amp;1 | sed -e &quot;s/\\(.*\\)/toydb$ID \\1/g&quot;) &amp;
</a> done
 
 trap &#39;kill $(jobs -p)&#39; EXIT
<b>diff --git a/<a id="h18" href="../file/clusters/local/toydb-a/toydb.yaml.html">clusters/local/toydb-a/toydb.yaml</a> b/<a href="../file/clusters/local/toydb-a/toydb.yaml.html">clusters/local/toydb-a/toydb.yaml</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h18-0-0" id="h18-0-0" class="d">-id: toydb-a
</a><a href="#h18-0-1" id="h18-0-1" class="d">-data_dir: toydb-a/data
</a><a href="#h18-0-2" id="h18-0-2" class="d">-sync: false
</a><a href="#h18-0-3" id="h18-0-3" class="d">-listen_sql: 0.0.0.0:9601
</a><a href="#h18-0-4" id="h18-0-4" class="d">-listen_raft: 0.0.0.0:9701
</a><a href="#h18-0-5" id="h18-0-5" class="d">-peers:
</a><a href="#h18-0-6" id="h18-0-6" class="d">-  toydb-b: 127.0.0.1:9702
</a><a href="#h18-0-7" id="h18-0-7" class="d">-  toydb-c: 127.0.0.1:9703
</a><a href="#h18-0-8" id="h18-0-8" class="d">-  toydb-d: 127.0.0.1:9704
</a><a href="#h18-0-9" id="h18-0-9" class="d">-  toydb-e: 127.0.0.1:9705
</a><a href="#h18-0-10" id="h18-0-10" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/clusters/local/toydb-b/toydb.yaml.html">clusters/local/toydb-b/toydb.yaml</a> b/<a href="../file/clusters/local/toydb-b/toydb.yaml.html">clusters/local/toydb-b/toydb.yaml</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h19-0-0" id="h19-0-0" class="d">-id: toydb-b
</a><a href="#h19-0-1" id="h19-0-1" class="d">-data_dir: toydb-b/data
</a><a href="#h19-0-2" id="h19-0-2" class="d">-sync: false
</a><a href="#h19-0-3" id="h19-0-3" class="d">-listen_sql: 0.0.0.0:9602
</a><a href="#h19-0-4" id="h19-0-4" class="d">-listen_raft: 0.0.0.0:9702
</a><a href="#h19-0-5" id="h19-0-5" class="d">-peers:
</a><a href="#h19-0-6" id="h19-0-6" class="d">-  toydb-a: 127.0.0.1:9701
</a><a href="#h19-0-7" id="h19-0-7" class="d">-  toydb-c: 127.0.0.1:9703
</a><a href="#h19-0-8" id="h19-0-8" class="d">-  toydb-d: 127.0.0.1:9704
</a><a href="#h19-0-9" id="h19-0-9" class="d">-  toydb-e: 127.0.0.1:9705
</a><a href="#h19-0-10" id="h19-0-10" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/clusters/local/toydb-c/toydb.yaml.html">clusters/local/toydb-c/toydb.yaml</a> b/<a href="../file/clusters/local/toydb-c/toydb.yaml.html">clusters/local/toydb-c/toydb.yaml</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h20-0-0" id="h20-0-0" class="d">-id: toydb-c
</a><a href="#h20-0-1" id="h20-0-1" class="d">-data_dir: toydb-c/data
</a><a href="#h20-0-2" id="h20-0-2" class="d">-sync: false
</a><a href="#h20-0-3" id="h20-0-3" class="d">-listen_sql: 0.0.0.0:9603
</a><a href="#h20-0-4" id="h20-0-4" class="d">-listen_raft: 0.0.0.0:9703
</a><a href="#h20-0-5" id="h20-0-5" class="d">-peers:
</a><a href="#h20-0-6" id="h20-0-6" class="d">-  toydb-a: 127.0.0.1:9701
</a><a href="#h20-0-7" id="h20-0-7" class="d">-  toydb-b: 127.0.0.1:9702
</a><a href="#h20-0-8" id="h20-0-8" class="d">-  toydb-d: 127.0.0.1:9704
</a><a href="#h20-0-9" id="h20-0-9" class="d">-  toydb-e: 127.0.0.1:9705
</a><a href="#h20-0-10" id="h20-0-10" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h21" href="../file/clusters/local/toydb-d/toydb.yaml.html">clusters/local/toydb-d/toydb.yaml</a> b/<a href="../file/clusters/local/toydb-d/toydb.yaml.html">clusters/local/toydb-d/toydb.yaml</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h21-0-0" id="h21-0-0" class="d">-id: toydb-d
</a><a href="#h21-0-1" id="h21-0-1" class="d">-data_dir: toydb-d/data
</a><a href="#h21-0-2" id="h21-0-2" class="d">-sync: false
</a><a href="#h21-0-3" id="h21-0-3" class="d">-listen_sql: 0.0.0.0:9604
</a><a href="#h21-0-4" id="h21-0-4" class="d">-listen_raft: 0.0.0.0:9704
</a><a href="#h21-0-5" id="h21-0-5" class="d">-peers:
</a><a href="#h21-0-6" id="h21-0-6" class="d">-  toydb-a: 127.0.0.1:9701
</a><a href="#h21-0-7" id="h21-0-7" class="d">-  toydb-b: 127.0.0.1:9702
</a><a href="#h21-0-8" id="h21-0-8" class="d">-  toydb-c: 127.0.0.1:9703
</a><a href="#h21-0-9" id="h21-0-9" class="d">-  toydb-e: 127.0.0.1:9705
</a><a href="#h21-0-10" id="h21-0-10" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h22" href="../file/clusters/local/toydb-e/toydb.yaml.html">clusters/local/toydb-e/toydb.yaml</a> b/<a href="../file/clusters/local/toydb-e/toydb.yaml.html">clusters/local/toydb-e/toydb.yaml</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h22-0-0" id="h22-0-0" class="d">-id: toydb-e
</a><a href="#h22-0-1" id="h22-0-1" class="d">-data_dir: toydb-e/data
</a><a href="#h22-0-2" id="h22-0-2" class="d">-sync: false
</a><a href="#h22-0-3" id="h22-0-3" class="d">-listen_sql: 0.0.0.0:9605
</a><a href="#h22-0-4" id="h22-0-4" class="d">-listen_raft: 0.0.0.0:9705
</a><a href="#h22-0-5" id="h22-0-5" class="d">-peers:
</a><a href="#h22-0-6" id="h22-0-6" class="d">-  toydb-a: 127.0.0.1:9701
</a><a href="#h22-0-7" id="h22-0-7" class="d">-  toydb-b: 127.0.0.1:9702
</a><a href="#h22-0-8" id="h22-0-8" class="d">-  toydb-c: 127.0.0.1:9703
</a><a href="#h22-0-9" id="h22-0-9" class="d">-  toydb-d: 127.0.0.1:9704
</a><a href="#h22-0-10" id="h22-0-10" class="d">-\ No newline at end of file
</a><b>diff --git a/<a id="h23" href="../file/clusters/local/toydb-a/data/.gitkeep.html">clusters/local/toydb-a/data/.gitkeep</a> b/<a href="../file/clusters/local/toydb1/data/.gitkeep.html">clusters/local/toydb1/data/.gitkeep</a></b>
<b>diff --git a/<a id="h24" href="../file/clusters/local/toydb1/toydb.yaml.html">clusters/local/toydb1/toydb.yaml</a> b/<a href="../file/clusters/local/toydb1/toydb.yaml.html">clusters/local/toydb1/toydb.yaml</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h24-0-0" id="h24-0-0" class="i">+id: 1
</a><a href="#h24-0-1" id="h24-0-1" class="i">+data_dir: toydb1/data
</a><a href="#h24-0-2" id="h24-0-2" class="i">+sync: false
</a><a href="#h24-0-3" id="h24-0-3" class="i">+listen_sql: 0.0.0.0:9601
</a><a href="#h24-0-4" id="h24-0-4" class="i">+listen_raft: 0.0.0.0:9701
</a><a href="#h24-0-5" id="h24-0-5" class="i">+peers:
</a><a href="#h24-0-6" id="h24-0-6" class="i">+  2: 127.0.0.1:9702
</a><a href="#h24-0-7" id="h24-0-7" class="i">+  3: 127.0.0.1:9703
</a><a href="#h24-0-8" id="h24-0-8" class="i">+  4: 127.0.0.1:9704
</a><a href="#h24-0-9" id="h24-0-9" class="i">+  5: 127.0.0.1:9705
</a><a href="#h24-0-10" id="h24-0-10" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h25" href="../file/clusters/local/toydb-b/data/.gitkeep.html">clusters/local/toydb-b/data/.gitkeep</a> b/<a href="../file/clusters/local/toydb2/data/.gitkeep.html">clusters/local/toydb2/data/.gitkeep</a></b>
<b>diff --git a/<a id="h26" href="../file/clusters/local/toydb2/toydb.yaml.html">clusters/local/toydb2/toydb.yaml</a> b/<a href="../file/clusters/local/toydb2/toydb.yaml.html">clusters/local/toydb2/toydb.yaml</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h26-0-0" id="h26-0-0" class="i">+id: 2
</a><a href="#h26-0-1" id="h26-0-1" class="i">+data_dir: toydb2/data
</a><a href="#h26-0-2" id="h26-0-2" class="i">+sync: false
</a><a href="#h26-0-3" id="h26-0-3" class="i">+listen_sql: 0.0.0.0:9602
</a><a href="#h26-0-4" id="h26-0-4" class="i">+listen_raft: 0.0.0.0:9702
</a><a href="#h26-0-5" id="h26-0-5" class="i">+peers:
</a><a href="#h26-0-6" id="h26-0-6" class="i">+  1: 127.0.0.1:9701
</a><a href="#h26-0-7" id="h26-0-7" class="i">+  3: 127.0.0.1:9703
</a><a href="#h26-0-8" id="h26-0-8" class="i">+  4: 127.0.0.1:9704
</a><a href="#h26-0-9" id="h26-0-9" class="i">+  5: 127.0.0.1:9705
</a><a href="#h26-0-10" id="h26-0-10" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/clusters/local/toydb-c/data/.gitkeep.html">clusters/local/toydb-c/data/.gitkeep</a> b/<a href="../file/clusters/local/toydb3/data/.gitkeep.html">clusters/local/toydb3/data/.gitkeep</a></b>
<b>diff --git a/<a id="h28" href="../file/clusters/local/toydb3/toydb.yaml.html">clusters/local/toydb3/toydb.yaml</a> b/<a href="../file/clusters/local/toydb3/toydb.yaml.html">clusters/local/toydb3/toydb.yaml</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h28-0-0" id="h28-0-0" class="i">+id: 3
</a><a href="#h28-0-1" id="h28-0-1" class="i">+data_dir: toydb-c/data
</a><a href="#h28-0-2" id="h28-0-2" class="i">+sync: false
</a><a href="#h28-0-3" id="h28-0-3" class="i">+listen_sql: 0.0.0.0:9603
</a><a href="#h28-0-4" id="h28-0-4" class="i">+listen_raft: 0.0.0.0:9703
</a><a href="#h28-0-5" id="h28-0-5" class="i">+peers:
</a><a href="#h28-0-6" id="h28-0-6" class="i">+  1: 127.0.0.1:9701
</a><a href="#h28-0-7" id="h28-0-7" class="i">+  2: 127.0.0.1:9702
</a><a href="#h28-0-8" id="h28-0-8" class="i">+  4: 127.0.0.1:9704
</a><a href="#h28-0-9" id="h28-0-9" class="i">+  5: 127.0.0.1:9705
</a><a href="#h28-0-10" id="h28-0-10" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h29" href="../file/clusters/local/toydb-d/data/.gitkeep.html">clusters/local/toydb-d/data/.gitkeep</a> b/<a href="../file/clusters/local/toydb4/data/.gitkeep.html">clusters/local/toydb4/data/.gitkeep</a></b>
<b>diff --git a/<a id="h30" href="../file/clusters/local/toydb4/toydb.yaml.html">clusters/local/toydb4/toydb.yaml</a> b/<a href="../file/clusters/local/toydb4/toydb.yaml.html">clusters/local/toydb4/toydb.yaml</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h30-0-0" id="h30-0-0" class="i">+id: 4
</a><a href="#h30-0-1" id="h30-0-1" class="i">+data_dir: toydb-d/data
</a><a href="#h30-0-2" id="h30-0-2" class="i">+sync: false
</a><a href="#h30-0-3" id="h30-0-3" class="i">+listen_sql: 0.0.0.0:9604
</a><a href="#h30-0-4" id="h30-0-4" class="i">+listen_raft: 0.0.0.0:9704
</a><a href="#h30-0-5" id="h30-0-5" class="i">+peers:
</a><a href="#h30-0-6" id="h30-0-6" class="i">+  1: 127.0.0.1:9701
</a><a href="#h30-0-7" id="h30-0-7" class="i">+  2: 127.0.0.1:9702
</a><a href="#h30-0-8" id="h30-0-8" class="i">+  3: 127.0.0.1:9703
</a><a href="#h30-0-9" id="h30-0-9" class="i">+  5: 127.0.0.1:9705
</a><a href="#h30-0-10" id="h30-0-10" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h31" href="../file/clusters/local/toydb-e/data/.gitkeep.html">clusters/local/toydb-e/data/.gitkeep</a> b/<a href="../file/clusters/local/toydb5/data/.gitkeep.html">clusters/local/toydb5/data/.gitkeep</a></b>
<b>diff --git a/<a id="h32" href="../file/clusters/local/toydb5/toydb.yaml.html">clusters/local/toydb5/toydb.yaml</a> b/<a href="../file/clusters/local/toydb5/toydb.yaml.html">clusters/local/toydb5/toydb.yaml</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h32-0-0" id="h32-0-0" class="i">+id: 5
</a><a href="#h32-0-1" id="h32-0-1" class="i">+data_dir: toydb-e/data
</a><a href="#h32-0-2" id="h32-0-2" class="i">+sync: false
</a><a href="#h32-0-3" id="h32-0-3" class="i">+listen_sql: 0.0.0.0:9605
</a><a href="#h32-0-4" id="h32-0-4" class="i">+listen_raft: 0.0.0.0:9705
</a><a href="#h32-0-5" id="h32-0-5" class="i">+peers:
</a><a href="#h32-0-6" id="h32-0-6" class="i">+  1: 127.0.0.1:9701
</a><a href="#h32-0-7" id="h32-0-7" class="i">+  2: 127.0.0.1:9702
</a><a href="#h32-0-8" id="h32-0-8" class="i">+  3: 127.0.0.1:9703
</a><a href="#h32-0-9" id="h32-0-9" class="i">+  4: 127.0.0.1:9704
</a><a href="#h32-0-10" id="h32-0-10" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h33" href="../file/config/toydb.yaml.html">config/toydb.yaml</a> b/<a href="../file/config/toydb.yaml.html">config/toydb.yaml</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -1,5 +1,5 @@
</a> # The node ID, peer ID/address map (empty for single node), and log level.
<a href="#h33-0-1" id="h33-0-1" class="d">-id: toydb
</a><a href="#h33-0-2" id="h33-0-2" class="i">+id: 1
</a> peers: {}
 log_level: INFO
 
<b>diff --git a/<a id="h34" href="../file/docs/examples.md.html">docs/examples.md</a> b/<a href="../file/docs/examples.md.html">docs/examples.md</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -21,13 +21,13 @@ To start a five-node cluster on the local machine (requires a working
</a> 
 ```
 $ (cd clusters/local &amp;&amp; ./run.sh)
<a href="#h34-0-3" id="h34-0-3" class="d">-toydb-b 19:06:28 [ INFO] Listening on 0.0.0.0:9602 (SQL) and 0.0.0.0:9702 (Raft)
</a><a href="#h34-0-4" id="h34-0-4" class="d">-toydb-b 19:06:28 [ERROR] Failed connecting to Raft peer 127.0.0.1:9705: Connection refused
</a><a href="#h34-0-5" id="h34-0-5" class="d">-toydb-e 19:06:28 [ INFO] Listening on 0.0.0.0:9605 (SQL) and 0.0.0.0:9705 (Raft)
</a><a href="#h34-0-6" id="h34-0-6" class="i">+toydb2 19:06:28 [ INFO] Listening on 0.0.0.0:9602 (SQL) and 0.0.0.0:9702 (Raft)
</a><a href="#h34-0-7" id="h34-0-7" class="i">+toydb2 19:06:28 [ERROR] Failed connecting to Raft peer 127.0.0.1:9705: Connection refused
</a><a href="#h34-0-8" id="h34-0-8" class="i">+toydb5 19:06:28 [ INFO] Listening on 0.0.0.0:9605 (SQL) and 0.0.0.0:9705 (Raft)
</a> [...]
<a href="#h34-0-10" id="h34-0-10" class="d">-toydb-e 19:06:29 [ INFO] Voting for toydb-d in term 1 election
</a><a href="#h34-0-11" id="h34-0-11" class="d">-toydb-c 19:06:29 [ INFO] Voting for toydb-d in term 1 election
</a><a href="#h34-0-12" id="h34-0-12" class="d">-toydb-d 19:06:29 [ INFO] Won election for term 1, becoming leader
</a><a href="#h34-0-13" id="h34-0-13" class="i">+toydb5 19:06:29 [ INFO] Voting for toydb-d in term 1 election
</a><a href="#h34-0-14" id="h34-0-14" class="i">+toydb3 19:06:29 [ INFO] Voting for toydb-d in term 1 election
</a><a href="#h34-0-15" id="h34-0-15" class="i">+toydb4 19:06:29 [ INFO] Won election for term 1, becoming leader
</a> ```
 
 In a separate terminal, start a `toysql` client and check the server status:
<a href="#h34-1" id="h34-1" class="h">@@ -37,9 +37,9 @@ $ cargo run --release --bin toysql
</a> Connected to toyDB node &quot;toydb-e&quot;. Enter !help for instructions.
 toydb&gt; !status
 
<a href="#h34-1-3" id="h34-1-3" class="d">-Server:    toydb-e (leader toydb-d in term 1 with 5 nodes)
</a><a href="#h34-1-4" id="h34-1-4" class="i">+Server:    5 (leader 4 in term 1 with 5 nodes)
</a> Raft log:  1 committed, 0 applied, 0.000 MB (hybrid storage)
<a href="#h34-1-6" id="h34-1-6" class="d">-Node logs: toydb-a:1 toydb-b:1 toydb-c:1 toydb-d:1 toydb-e:1
</a><a href="#h34-1-7" id="h34-1-7" class="i">+Node logs: 1:1 2:1 3:1 4:1 5:1
</a> SQL txns:  0 active, 0 total (bitcask storage)
 ```
 
<b>diff --git a/<a id="h35" href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a> b/<a href="../file/src/bin/toydb.rs.html">src/bin/toydb.rs</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -59,7 +59,7 @@ async fn main() -&gt; Result&lt;()&gt; {
</a>         name =&gt; return Err(Error::Config(format!(&quot;Unknown SQL storage engine {}&quot;, name))),
     };
 
<a href="#h35-0-3" id="h35-0-3" class="d">-    Server::new(&amp;cfg.id, cfg.peers, raft_log, raft_state)
</a><a href="#h35-0-4" id="h35-0-4" class="i">+    Server::new(cfg.id, cfg.peers, raft_log, raft_state)
</a>         .await?
         .listen(&amp;cfg.listen_sql, &amp;cfg.listen_raft)
         .await?
<a href="#h35-1" id="h35-1" class="h">@@ -69,8 +69,8 @@ async fn main() -&gt; Result&lt;()&gt; {
</a> 
 #[derive(Debug, Deserialize)]
 struct Config {
<a href="#h35-1-3" id="h35-1-3" class="d">-    id: String,
</a><a href="#h35-1-4" id="h35-1-4" class="d">-    peers: HashMap&lt;String, String&gt;,
</a><a href="#h35-1-5" id="h35-1-5" class="i">+    id: raft::NodeID,
</a><a href="#h35-1-6" id="h35-1-6" class="i">+    peers: HashMap&lt;raft::NodeID, String&gt;,
</a>     listen_sql: String,
     listen_raft: String,
     log_level: String,
<b>diff --git a/<a id="h36" href="../file/src/raft/log.rs.html">src/raft/log.rs</a> b/<a href="../file/src/raft/log.rs.html">src/raft/log.rs</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -4,6 +4,8 @@ use crate::storage::{self, bincode, keycode};
</a> use ::log::debug;
 use serde::{Deserialize, Serialize};
 
<a href="#h36-0-3" id="h36-0-3" class="i">+use super::NodeID;
</a><a href="#h36-0-4" id="h36-0-4" class="i">+
</a> /// A log index.
 pub type Index = u64;
 
<a href="#h36-1" id="h36-1" class="h">@@ -125,7 +127,7 @@ impl Log {
</a>     }
 
     /// Returns the last known term (0 if none), and cast vote (if any).
<a href="#h36-1-3" id="h36-1-3" class="d">-    pub fn get_term(&amp;mut self) -&gt; Result&lt;(Term, Option&lt;String&gt;)&gt; {
</a><a href="#h36-1-4" id="h36-1-4" class="i">+    pub fn get_term(&amp;mut self) -&gt; Result&lt;(Term, Option&lt;NodeID&gt;)&gt; {
</a>         let (term, voted_for) = self
             .engine
             .get(&amp;Key::TermVote.encode()?)?
<a href="#h36-2" id="h36-2" class="h">@@ -137,7 +139,7 @@ impl Log {
</a>     }
 
     /// Sets the most recent term, and cast vote (if any).
<a href="#h36-2-3" id="h36-2-3" class="d">-    pub fn set_term(&amp;mut self, term: Term, voted_for: Option&lt;&amp;str&gt;) -&gt; Result&lt;()&gt; {
</a><a href="#h36-2-4" id="h36-2-4" class="i">+    pub fn set_term(&amp;mut self, term: Term, voted_for: Option&lt;NodeID&gt;) -&gt; Result&lt;()&gt; {
</a>         self.engine.set(&amp;Key::TermVote.encode()?, bincode::serialize(&amp;(term, voted_for))?)?;
         self.maybe_flush()
     }
<a href="#h36-3" id="h36-3" class="h">@@ -458,8 +460,8 @@ mod tests {
</a>         let mut l = setup();
         assert_eq!(l.get_term()?, (0, None));
 
<a href="#h36-3-3" id="h36-3-3" class="d">-        l.set_term(1, Some(&quot;a&quot;))?;
</a><a href="#h36-3-4" id="h36-3-4" class="d">-        assert_eq!(l.get_term()?, (1, Some(&quot;a&quot;.into())));
</a><a href="#h36-3-5" id="h36-3-5" class="i">+        l.set_term(1, Some(1))?;
</a><a href="#h36-3-6" id="h36-3-6" class="i">+        assert_eq!(l.get_term()?, (1, Some(1)));
</a> 
         l.set_term(0, None)?;
         assert_eq!(l.get_term()?, (0, None));
<b>diff --git a/<a id="h37" href="../file/src/raft/message.rs.html">src/raft/message.rs</a> b/<a href="../file/src/raft/message.rs.html">src/raft/message.rs</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -1,4 +1,4 @@
</a><a href="#h37-0-0" id="h37-0-0" class="d">-use super::{Entry, Status};
</a><a href="#h37-0-1" id="h37-0-1" class="i">+use super::{Entry, NodeID, Status};
</a> use crate::error::Result;
 
 use serde_derive::{Deserialize, Serialize};
<a href="#h37-1" id="h37-1" class="h">@@ -9,7 +9,7 @@ pub enum Address {
</a>     /// Broadcast to all peers.
     Peers,
     /// A remote peer.
<a href="#h37-1-3" id="h37-1-3" class="d">-    Peer(String),
</a><a href="#h37-1-4" id="h37-1-4" class="i">+    Peer(NodeID),
</a>     /// The local node.
     Local,
     /// A local client.
<b>diff --git a/<a id="h38" href="../file/src/raft/mod.rs.html">src/raft/mod.rs</a> b/<a href="../file/src/raft/mod.rs.html">src/raft/mod.rs</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -6,6 +6,6 @@ mod state;
</a> 
 pub use self::log::{Engine, Entry, Log, Scan};
 pub use message::{Address, Event, Message, Request, Response};
<a href="#h38-0-3" id="h38-0-3" class="d">-pub use node::{Node, Status};
</a><a href="#h38-0-4" id="h38-0-4" class="i">+pub use node::{Node, NodeID, Status};
</a> pub use server::Server;
 pub use state::{Driver, Instruction, State};
<b>diff --git a/<a id="h39" href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a> b/<a href="../file/src/raft/node/candidate.rs.html">src/raft/node/candidate.rs</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::{Address, Event, Message, Response};
<a href="#h39-0-1" id="h39-0-1" class="d">-use super::{Follower, Leader, Node, RoleNode, ELECTION_TIMEOUT_MAX, ELECTION_TIMEOUT_MIN};
</a><a href="#h39-0-2" id="h39-0-2" class="i">+use super::{Follower, Leader, Node, NodeID, RoleNode, ELECTION_TIMEOUT_MAX, ELECTION_TIMEOUT_MIN};
</a> use crate::error::Result;
 
 use ::log::{debug, info, warn};
<a href="#h39-1" id="h39-1" class="h">@@ -30,13 +30,13 @@ impl Candidate {
</a> 
 impl RoleNode&lt;Candidate&gt; {
     /// Transition to follower role.
<a href="#h39-1-3" id="h39-1-3" class="d">-    fn become_follower(mut self, term: u64, leader: &amp;str) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a><a href="#h39-1-4" id="h39-1-4" class="i">+    fn become_follower(mut self, term: u64, leader: NodeID) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a>         info!(&quot;Discovered leader {} for term {}, following&quot;, leader, term);
         self.term = term;
         self.log.set_term(term, None)?;
         let mut node = self.become_role(Follower::new(Some(leader), None))?;
         node.abort_proxied()?;
<a href="#h39-1-10" id="h39-1-10" class="d">-        node.forward_queued(Address::Peer(leader.to_string()))?;
</a><a href="#h39-1-11" id="h39-1-11" class="i">+        node.forward_queued(Address::Peer(leader))?;
</a>         Ok(node)
     }
 
<a href="#h39-2" id="h39-2" class="h">@@ -60,14 +60,14 @@ impl RoleNode&lt;Candidate&gt; {
</a>             return Ok(self.into());
         }
         if msg.term &gt; self.term {
<a href="#h39-2-3" id="h39-2-3" class="d">-            if let Address::Peer(from) = &amp;msg.from {
</a><a href="#h39-2-4" id="h39-2-4" class="i">+            if let Address::Peer(from) = msg.from {
</a>                 return self.become_follower(msg.term, from)?.step(msg);
             }
         }
 
         match msg.event {
             Event::Heartbeat { .. } =&gt; {
<a href="#h39-2-11" id="h39-2-11" class="d">-                if let Address::Peer(from) = &amp;msg.from {
</a><a href="#h39-2-12" id="h39-2-12" class="i">+                if let Address::Peer(from) = msg.from {
</a>                     return self.become_follower(msg.term, from)?.step(msg);
                 }
             }
<a href="#h39-3" id="h39-3" class="h">@@ -89,7 +89,7 @@ impl RoleNode&lt;Candidate&gt; {
</a> 
             Event::ClientResponse { id, mut response } =&gt; {
                 if let Ok(Response::Status(ref mut status)) = response {
<a href="#h39-3-3" id="h39-3-3" class="d">-                    status.server = self.id.clone();
</a><a href="#h39-3-4" id="h39-3-4" class="i">+                    status.server = self.id;
</a>                 }
                 self.proxied_reqs.remove(&amp;id);
                 self.send(Address::Client, Event::ClientResponse { id, response })?;
<a href="#h39-4" id="h39-4" class="h">@@ -147,8 +147,8 @@ mod tests {
</a>         log.set_term(3, None)?;
 
         let mut node = RoleNode {
<a href="#h39-4-3" id="h39-4-3" class="d">-            id: &quot;a&quot;.into(),
</a><a href="#h39-4-4" id="h39-4-4" class="d">-            peers: vec![&quot;b&quot;.into(), &quot;c&quot;.into(), &quot;d&quot;.into(), &quot;e&quot;.into()],
</a><a href="#h39-4-5" id="h39-4-5" class="i">+            id: 1,
</a><a href="#h39-4-6" id="h39-4-6" class="i">+            peers: vec![2, 3, 4, 5],
</a>             term: 3,
             log,
             node_tx,
<a href="#h39-5" id="h39-5" class="h">@@ -176,8 +176,8 @@ mod tests {
</a>     fn step_heartbeat_current_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h39-5-3" id="h39-5-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-5-4" id="h39-5-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h39-5-5" id="h39-5-5" class="i">+            from: Address::Peer(2),
</a><a href="#h39-5-6" id="h39-5-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
         })?;
<a href="#h39-6" id="h39-6" class="h">@@ -187,7 +187,7 @@ mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h39-6-3" id="h39-6-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-6-4" id="h39-6-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0xaf],
<a href="#h39-7" id="h39-7" class="h">@@ -196,7 +196,7 @@ mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h39-7-3" id="h39-7-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-7-4" id="h39-7-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 },
<a href="#h39-8" id="h39-8" class="h">@@ -212,8 +212,8 @@ mod tests {
</a>     fn step_heartbeat_future_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h39-8-3" id="h39-8-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-8-4" id="h39-8-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h39-8-5" id="h39-8-5" class="i">+            from: Address::Peer(2),
</a><a href="#h39-8-6" id="h39-8-6" class="i">+            to: Address::Peer(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
         })?;
<a href="#h39-9" id="h39-9" class="h">@@ -223,7 +223,7 @@ mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h39-9-3" id="h39-9-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-9-4" id="h39-9-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0xaf],
<a href="#h39-10" id="h39-10" class="h">@@ -232,7 +232,7 @@ mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h39-10-3" id="h39-10-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-10-4" id="h39-10-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 4,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 },
<a href="#h39-11" id="h39-11" class="h">@@ -247,8 +247,8 @@ mod tests {
</a>     fn step_heartbeat_past_term() -&gt; Result&lt;()&gt; {
         let (candidate, mut node_rx, mut state_rx) = setup()?;
         let mut node = candidate.step(Message {
<a href="#h39-11-3" id="h39-11-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h39-11-4" id="h39-11-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h39-11-5" id="h39-11-5" class="i">+            from: Address::Peer(2),
</a><a href="#h39-11-6" id="h39-11-6" class="i">+            to: Address::Peer(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
         })?;
<a href="#h39-12" id="h39-12" class="h">@@ -266,8 +266,8 @@ mod tests {
</a> 
         // The first vote is not sufficient for a quorum (3 votes including self)
         node = node.step(Message {
<a href="#h39-12-3" id="h39-12-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h39-12-4" id="h39-12-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h39-12-5" id="h39-12-5" class="i">+            from: Address::Peer(3),
</a><a href="#h39-12-6" id="h39-12-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<a href="#h39-13" id="h39-13" class="h">@@ -277,8 +277,8 @@ mod tests {
</a> 
         // However, the second external vote makes us leader
         node = node.step(Message {
<a href="#h39-13-3" id="h39-13-3" class="d">-            from: Address::Peer(&quot;e&quot;.into()),
</a><a href="#h39-13-4" id="h39-13-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h39-13-5" id="h39-13-5" class="i">+            from: Address::Peer(5),
</a><a href="#h39-13-6" id="h39-13-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<b>diff --git a/<a id="h40" href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a> b/<a href="../file/src/raft/node/follower.rs.html">src/raft/node/follower.rs</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::{Address, Event, Instruction, Message, Response};
<a href="#h40-0-1" id="h40-0-1" class="d">-use super::{Candidate, Node, RoleNode, ELECTION_TIMEOUT_MAX, ELECTION_TIMEOUT_MIN};
</a><a href="#h40-0-2" id="h40-0-2" class="i">+use super::{Candidate, Node, NodeID, RoleNode, ELECTION_TIMEOUT_MAX, ELECTION_TIMEOUT_MIN};
</a> use crate::error::Result;
 
 use ::log::{debug, info, warn};
<a href="#h40-1" id="h40-1" class="h">@@ -9,21 +9,21 @@ use rand::Rng as _;
</a> #[derive(Debug)]
 pub struct Follower {
     /// The leader, or None if just initialized.
<a href="#h40-1-3" id="h40-1-3" class="d">-    leader: Option&lt;String&gt;,
</a><a href="#h40-1-4" id="h40-1-4" class="i">+    leader: Option&lt;NodeID&gt;,
</a>     /// The number of ticks since the last message from the leader.
     leader_seen_ticks: u64,
     /// The timeout before triggering an election.
     leader_seen_timeout: u64,
     /// The node we voted for in the current term, if any.
<a href="#h40-1-10" id="h40-1-10" class="d">-    voted_for: Option&lt;String&gt;,
</a><a href="#h40-1-11" id="h40-1-11" class="i">+    voted_for: Option&lt;NodeID&gt;,
</a> }
 
 impl Follower {
     /// Creates a new follower role.
<a href="#h40-1-16" id="h40-1-16" class="d">-    pub fn new(leader: Option&lt;&amp;str&gt;, voted_for: Option&lt;&amp;str&gt;) -&gt; Self {
</a><a href="#h40-1-17" id="h40-1-17" class="i">+    pub fn new(leader: Option&lt;NodeID&gt;, voted_for: Option&lt;NodeID&gt;) -&gt; Self {
</a>         Self {
<a href="#h40-1-19" id="h40-1-19" class="d">-            leader: leader.map(String::from),
</a><a href="#h40-1-20" id="h40-1-20" class="d">-            voted_for: voted_for.map(String::from),
</a><a href="#h40-1-21" id="h40-1-21" class="i">+            leader,
</a><a href="#h40-1-22" id="h40-1-22" class="i">+            voted_for,
</a>             leader_seen_ticks: 0,
             leader_seen_timeout: rand::thread_rng()
                 .gen_range(ELECTION_TIMEOUT_MIN..=ELECTION_TIMEOUT_MAX),
<a href="#h40-2" id="h40-2" class="h">@@ -44,7 +44,7 @@ impl RoleNode&lt;Follower&gt; {
</a>     }
 
     /// Transforms the node into a follower for a new leader.
<a href="#h40-2-3" id="h40-2-3" class="d">-    fn become_follower(mut self, leader: &amp;str, term: u64) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a><a href="#h40-2-4" id="h40-2-4" class="i">+    fn become_follower(mut self, leader: NodeID, term: u64) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a>         let mut voted_for = None;
         if term &gt; self.term {
             info!(&quot;Discovered new term {}, following leader {}&quot;, term, leader);
<a href="#h40-3" id="h40-3" class="h">@@ -54,9 +54,9 @@ impl RoleNode&lt;Follower&gt; {
</a>             info!(&quot;Discovered leader {}, following&quot;, leader);
             voted_for = self.role.voted_for;
         };
<a href="#h40-3-3" id="h40-3-3" class="d">-        self.role = Follower::new(Some(leader), voted_for.as_deref());
</a><a href="#h40-3-4" id="h40-3-4" class="i">+        self.role = Follower::new(Some(leader), voted_for);
</a>         self.abort_proxied()?;
<a href="#h40-3-6" id="h40-3-6" class="d">-        self.forward_queued(Address::Peer(leader.to_string()))?;
</a><a href="#h40-3-7" id="h40-3-7" class="i">+        self.forward_queued(Address::Peer(leader))?;
</a>         Ok(self)
     }
 
<a href="#h40-4" id="h40-4" class="h">@@ -71,7 +71,7 @@ impl RoleNode&lt;Follower&gt; {
</a>             warn!(&quot;Ignoring invalid message: {}&quot;, err);
             return Ok(self.into());
         }
<a href="#h40-4-3" id="h40-4-3" class="d">-        if let Address::Peer(from) = &amp;msg.from {
</a><a href="#h40-4-4" id="h40-4-4" class="i">+        if let Address::Peer(from) = msg.from {
</a>             if msg.term &gt; self.term || self.role.leader.is_none() {
                 return self.become_follower(from, msg.term)?.step(msg);
             }
<a href="#h40-5" id="h40-5" class="h">@@ -97,8 +97,8 @@ impl RoleNode&lt;Follower&gt; {
</a>             }
 
             Event::SolicitVote { last_index, last_term } =&gt; {
<a href="#h40-5-3" id="h40-5-3" class="d">-                if let Some(voted_for) = &amp;self.role.voted_for {
</a><a href="#h40-5-4" id="h40-5-4" class="d">-                    if msg.from != Address::Peer(voted_for.clone()) {
</a><a href="#h40-5-5" id="h40-5-5" class="i">+                if let Some(voted_for) = self.role.voted_for {
</a><a href="#h40-5-6" id="h40-5-6" class="i">+                    if msg.from != Address::Peer(voted_for) {
</a>                         return Ok(self.into());
                     }
                 }
<a href="#h40-6" id="h40-6" class="h">@@ -111,8 +111,8 @@ impl RoleNode&lt;Follower&gt; {
</a>                 }
                 if let Address::Peer(from) = msg.from {
                     info!(&quot;Voting for {} in term {} election&quot;, from, self.term);
<a href="#h40-6-3" id="h40-6-3" class="d">-                    self.send(Address::Peer(from.clone()), Event::GrantVote)?;
</a><a href="#h40-6-4" id="h40-6-4" class="d">-                    self.log.set_term(self.term, Some(&amp;from))?;
</a><a href="#h40-6-5" id="h40-6-5" class="i">+                    self.send(Address::Peer(from), Event::GrantVote)?;
</a><a href="#h40-6-6" id="h40-6-6" class="i">+                    self.log.set_term(self.term, Some(from))?;
</a>                     self.role.voted_for = Some(from);
                 }
             }
<a href="#h40-7" id="h40-7" class="h">@@ -130,9 +130,9 @@ impl RoleNode&lt;Follower&gt; {
</a>             }
 
             Event::ClientRequest { ref id, .. } =&gt; {
<a href="#h40-7-3" id="h40-7-3" class="d">-                if let Some(leader) = self.role.leader.as_deref() {
</a><a href="#h40-7-4" id="h40-7-4" class="i">+                if let Some(leader) = self.role.leader {
</a>                     self.proxied_reqs.insert(id.clone(), msg.from);
<a href="#h40-7-6" id="h40-7-6" class="d">-                    self.send(Address::Peer(leader.to_string()), msg.event)?
</a><a href="#h40-7-7" id="h40-7-7" class="i">+                    self.send(Address::Peer(leader), msg.event)?
</a>                 } else {
                     self.queued_reqs.push((msg.from, msg.event));
                 }
<a href="#h40-8" id="h40-8" class="h">@@ -140,7 +140,7 @@ impl RoleNode&lt;Follower&gt; {
</a> 
             Event::ClientResponse { id, mut response } =&gt; {
                 if let Ok(Response::Status(ref mut status)) = response {
<a href="#h40-8-3" id="h40-8-3" class="d">-                    status.server = self.id.clone();
</a><a href="#h40-8-4" id="h40-8-4" class="i">+                    status.server = self.id;
</a>                 }
                 self.proxied_reqs.remove(&amp;id);
                 self.send(Address::Client, Event::ClientResponse { id, response })?;
<a href="#h40-9" id="h40-9" class="h">@@ -177,12 +177,12 @@ pub mod tests {
</a>     use std::collections::HashMap;
     use tokio::sync::mpsc;
 
<a href="#h40-9-3" id="h40-9-3" class="d">-    pub fn follower_leader(node: &amp;RoleNode&lt;Follower&gt;) -&gt; Option&lt;String&gt; {
</a><a href="#h40-9-4" id="h40-9-4" class="d">-        node.role.leader.clone()
</a><a href="#h40-9-5" id="h40-9-5" class="i">+    pub fn follower_leader(node: &amp;RoleNode&lt;Follower&gt;) -&gt; Option&lt;NodeID&gt; {
</a><a href="#h40-9-6" id="h40-9-6" class="i">+        node.role.leader
</a>     }
 
<a href="#h40-9-9" id="h40-9-9" class="d">-    pub fn follower_voted_for(node: &amp;RoleNode&lt;Follower&gt;) -&gt; Option&lt;String&gt; {
</a><a href="#h40-9-10" id="h40-9-10" class="d">-        node.role.voted_for.clone()
</a><a href="#h40-9-11" id="h40-9-11" class="i">+    pub fn follower_voted_for(node: &amp;RoleNode&lt;Follower&gt;) -&gt; Option&lt;NodeID&gt; {
</a><a href="#h40-9-12" id="h40-9-12" class="i">+        node.role.voted_for
</a>     }
 
     #[allow(clippy::type_complexity)]
<a href="#h40-10" id="h40-10" class="h">@@ -201,15 +201,15 @@ pub mod tests {
</a>         log.set_term(3, None)?;
 
         let node = RoleNode {
<a href="#h40-10-3" id="h40-10-3" class="d">-            id: &quot;a&quot;.into(),
</a><a href="#h40-10-4" id="h40-10-4" class="d">-            peers: vec![&quot;b&quot;.into(), &quot;c&quot;.into(), &quot;d&quot;.into(), &quot;e&quot;.into()],
</a><a href="#h40-10-5" id="h40-10-5" class="i">+            id: 1,
</a><a href="#h40-10-6" id="h40-10-6" class="i">+            peers: vec![2, 3, 4, 5],
</a>             term: 3,
             log,
             node_tx,
             state_tx,
             proxied_reqs: HashMap::new(),
             queued_reqs: Vec::new(),
<a href="#h40-10-13" id="h40-10-13" class="d">-            role: Follower::new(Some(&quot;b&quot;), None),
</a><a href="#h40-10-14" id="h40-10-14" class="i">+            role: Follower::new(Some(2), None),
</a>         };
         Ok((node, node_rx, state_rx))
     }
<a href="#h40-11" id="h40-11" class="h">@@ -219,17 +219,17 @@ pub mod tests {
</a>     fn step_heartbeat() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-11-3" id="h40-11-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-11-4" id="h40-11-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-11-5" id="h40-11-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-11-6" id="h40-11-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h40-11-10" id="h40-11-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(3);
</a><a href="#h40-11-11" id="h40-11-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(3);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-11-16" id="h40-11-16" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-11-17" id="h40-11-17" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h40-12" id="h40-12" class="h">@@ -248,17 +248,17 @@ pub mod tests {
</a>     fn step_heartbeat_conflict_commit_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-12-3" id="h40-12-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-12-4" id="h40-12-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-12-5" id="h40-12-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-12-6" id="h40-12-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 3 },
         })?;
<a href="#h40-12-10" id="h40-12-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(2);
</a><a href="#h40-12-11" id="h40-12-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(2);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-12-16" id="h40-12-16" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-12-17" id="h40-12-17" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: false },
             }],
<a href="#h40-13" id="h40-13" class="h">@@ -272,17 +272,17 @@ pub mod tests {
</a>     fn step_heartbeat_missing_commit_entry() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-13-3" id="h40-13-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-13-4" id="h40-13-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-13-5" id="h40-13-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-13-6" id="h40-13-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h40-13-10" id="h40-13-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(2);
</a><a href="#h40-13-11" id="h40-13-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(2);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-13-16" id="h40-13-16" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-13-17" id="h40-13-17" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 5, has_committed: false },
             }],
<a href="#h40-14" id="h40-14" class="h">@@ -296,12 +296,12 @@ pub mod tests {
</a>     fn step_heartbeat_fake_leader() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-14-3" id="h40-14-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-14-4" id="h40-14-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-14-5" id="h40-14-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-14-6" id="h40-14-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h40-14-10" id="h40-14-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(2);
</a><a href="#h40-14-11" id="h40-14-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(2);
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-15" id="h40-15" class="h">@@ -313,17 +313,17 @@ pub mod tests {
</a>         let (mut follower, mut node_rx, mut state_rx) = setup()?;
         follower.role = Follower::new(None, None);
         let mut node = follower.step(Message {
<a href="#h40-15-3" id="h40-15-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-15-4" id="h40-15-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-15-5" id="h40-15-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-15-6" id="h40-15-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h40-15-10" id="h40-15-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;c&quot;)).voted_for(None).committed(3);
</a><a href="#h40-15-11" id="h40-15-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(3)).voted_for(None).committed(3);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-15-16" id="h40-15-16" class="d">-                to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-15-17" id="h40-15-17" class="i">+                to: Address::Peer(3),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h40-16" id="h40-16" class="h">@@ -342,17 +342,17 @@ pub mod tests {
</a>     fn step_heartbeat_old_commit_index() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-16-3" id="h40-16-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-16-4" id="h40-16-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-16-5" id="h40-16-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-16-6" id="h40-16-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
         })?;
<a href="#h40-16-10" id="h40-16-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(2);
</a><a href="#h40-16-11" id="h40-16-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(2);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-16-16" id="h40-16-16" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-16-17" id="h40-16-17" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ConfirmLeader { commit_index: 1, has_committed: true },
             }],
<a href="#h40-17" id="h40-17" class="h">@@ -366,17 +366,17 @@ pub mod tests {
</a>     fn step_heartbeat_future_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-17-3" id="h40-17-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-17-4" id="h40-17-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-17-5" id="h40-17-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-17-6" id="h40-17-6" class="i">+            to: Address::Peer(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h40-17-10" id="h40-17-10" class="d">-        assert_node(&amp;mut node).is_follower().term(4).leader(Some(&quot;c&quot;)).voted_for(None);
</a><a href="#h40-17-11" id="h40-17-11" class="i">+        assert_node(&amp;mut node).is_follower().term(4).leader(Some(3)).voted_for(None);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-17-16" id="h40-17-16" class="d">-                to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-17-17" id="h40-17-17" class="i">+                to: Address::Peer(3),
</a>                 term: 4,
                 event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
             }],
<a href="#h40-18" id="h40-18" class="h">@@ -395,12 +395,12 @@ pub mod tests {
</a>     fn step_heartbeat_past_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-18-3" id="h40-18-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-18-4" id="h40-18-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-18-5" id="h40-18-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-18-6" id="h40-18-6" class="i">+            to: Address::Peer(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h40-18-10" id="h40-18-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None).committed(2);
</a><a href="#h40-18-11" id="h40-18-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None).committed(2);
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-19" id="h40-19" class="h">@@ -413,17 +413,17 @@ pub mod tests {
</a> 
         // The first vote request in this term yields a vote response.
         let mut node = follower.step(Message {
<a href="#h40-19-3" id="h40-19-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-19-4" id="h40-19-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-19-5" id="h40-19-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-19-6" id="h40-19-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h40-19-10" id="h40-19-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(Some(&quot;c&quot;));
</a><a href="#h40-19-11" id="h40-19-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(Some(3));
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-19-16" id="h40-19-16" class="d">-                to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-19-17" id="h40-19-17" class="i">+                to: Address::Peer(3),
</a>                 term: 3,
                 event: Event::GrantVote,
             }],
<a href="#h40-20" id="h40-20" class="h">@@ -432,17 +432,17 @@ pub mod tests {
</a> 
         // Another vote request from the same sender is granted.
         node = node.step(Message {
<a href="#h40-20-3" id="h40-20-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-20-4" id="h40-20-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-20-5" id="h40-20-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-20-6" id="h40-20-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h40-20-10" id="h40-20-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(Some(&quot;c&quot;));
</a><a href="#h40-20-11" id="h40-20-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(Some(3));
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-20-16" id="h40-20-16" class="d">-                to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-20-17" id="h40-20-17" class="i">+                to: Address::Peer(3),
</a>                 term: 3,
                 event: Event::GrantVote,
             }],
<a href="#h40-21" id="h40-21" class="h">@@ -451,12 +451,12 @@ pub mod tests {
</a> 
         // But a vote request from a different node is ignored.
         node = node.step(Message {
<a href="#h40-21-3" id="h40-21-3" class="d">-            from: Address::Peer(&quot;d&quot;.into()),
</a><a href="#h40-21-4" id="h40-21-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-21-5" id="h40-21-5" class="i">+            from: Address::Peer(4),
</a><a href="#h40-21-6" id="h40-21-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 2 },
         })?;
<a href="#h40-21-10" id="h40-21-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(Some(&quot;c&quot;));
</a><a href="#h40-21-11" id="h40-21-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(Some(3));
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-22" id="h40-22" class="h">@@ -467,12 +467,12 @@ pub mod tests {
</a>     fn step_grantvote_noop() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-22-3" id="h40-22-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-22-4" id="h40-22-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-22-5" id="h40-22-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-22-6" id="h40-22-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::GrantVote,
         })?;
<a href="#h40-22-10" id="h40-22-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;));
</a><a href="#h40-22-11" id="h40-22-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2));
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-23" id="h40-23" class="h">@@ -483,12 +483,12 @@ pub mod tests {
</a>     fn step_solicitvote_last_index_outdated() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-23-3" id="h40-23-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-23-4" id="h40-23-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-23-5" id="h40-23-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-23-6" id="h40-23-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 2, last_term: 2 },
         })?;
<a href="#h40-23-10" id="h40-23-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None);
</a><a href="#h40-23-11" id="h40-23-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None);
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-24" id="h40-24" class="h">@@ -499,12 +499,12 @@ pub mod tests {
</a>     fn step_solicitvote_last_term_outdated() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-24-3" id="h40-24-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-24-4" id="h40-24-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-24-5" id="h40-24-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-24-6" id="h40-24-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::SolicitVote { last_index: 3, last_term: 1 },
         })?;
<a href="#h40-24-10" id="h40-24-10" class="d">-        assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;)).voted_for(None);
</a><a href="#h40-24-11" id="h40-24-11" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).voted_for(None);
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(&amp;mut state_rx, vec![]);
         Ok(())
<a href="#h40-25" id="h40-25" class="h">@@ -522,20 +522,20 @@ pub mod tests {
</a>         log.append(2, Some(vec![0x03]))?;
 
         let follower = RoleNode {
<a href="#h40-25-3" id="h40-25-3" class="d">-            id: &quot;a&quot;.into(),
</a><a href="#h40-25-4" id="h40-25-4" class="d">-            peers: vec![&quot;b&quot;.into(), &quot;c&quot;.into(), &quot;d&quot;.into(), &quot;e&quot;.into()],
</a><a href="#h40-25-5" id="h40-25-5" class="i">+            id: 1,
</a><a href="#h40-25-6" id="h40-25-6" class="i">+            peers: vec![2, 3, 4, 5],
</a>             term: 0,
             log,
             node_tx,
             state_tx,
             proxied_reqs: HashMap::new(),
             queued_reqs: Vec::new(),
<a href="#h40-25-13" id="h40-25-13" class="d">-            role: Follower::new(Some(&quot;b&quot;), None),
</a><a href="#h40-25-14" id="h40-25-14" class="i">+            role: Follower::new(Some(2), None),
</a>         };
 
         let mut node = follower.step(Message {
<a href="#h40-25-18" id="h40-25-18" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-25-19" id="h40-25-19" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-25-20" id="h40-25-20" class="i">+            from: Address::Peer(2),
</a><a href="#h40-25-21" id="h40-25-21" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 0,
<a href="#h40-26" id="h40-26" class="h">@@ -554,7 +554,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-26-3" id="h40-26-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-26-4" id="h40-26-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 2 },
             }],
<a href="#h40-27" id="h40-27" class="h">@@ -568,8 +568,8 @@ pub mod tests {
</a>     fn step_replicateentries_append() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-27-3" id="h40-27-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-27-4" id="h40-27-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-27-5" id="h40-27-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-27-6" id="h40-27-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 3,
<a href="#h40-28" id="h40-28" class="h">@@ -591,7 +591,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-28-3" id="h40-28-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-28-4" id="h40-28-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 5 },
             }],
<a href="#h40-29" id="h40-29" class="h">@@ -605,8 +605,8 @@ pub mod tests {
</a>     fn step_replicateentries_partial_overlap() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-29-3" id="h40-29-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-29-4" id="h40-29-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-29-5" id="h40-29-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-29-6" id="h40-29-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 1,
<a href="#h40-30" id="h40-30" class="h">@@ -627,7 +627,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-30-3" id="h40-30-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-30-4" id="h40-30-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h40-31" id="h40-31" class="h">@@ -641,8 +641,8 @@ pub mod tests {
</a>     fn step_replicateentries_replace() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-31-3" id="h40-31-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-31-4" id="h40-31-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-31-5" id="h40-31-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-31-6" id="h40-31-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 2,
<a href="#h40-32" id="h40-32" class="h">@@ -663,7 +663,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-32-3" id="h40-32-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-32-4" id="h40-32-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h40-33" id="h40-33" class="h">@@ -677,8 +677,8 @@ pub mod tests {
</a>     fn step_replicateentries_replace_partial() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-33-3" id="h40-33-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-33-4" id="h40-33-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-33-5" id="h40-33-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-33-6" id="h40-33-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 2,
<a href="#h40-34" id="h40-34" class="h">@@ -699,7 +699,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-34-3" id="h40-34-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-34-4" id="h40-34-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 4 },
             }],
<a href="#h40-35" id="h40-35" class="h">@@ -713,8 +713,8 @@ pub mod tests {
</a>     fn step_replicateentries_reject_missing_base_index() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-35-3" id="h40-35-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-35-4" id="h40-35-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-35-5" id="h40-35-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-35-6" id="h40-35-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 5,
<a href="#h40-36" id="h40-36" class="h">@@ -731,7 +731,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-36-3" id="h40-36-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-36-4" id="h40-36-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::RejectEntries,
             }],
<a href="#h40-37" id="h40-37" class="h">@@ -745,8 +745,8 @@ pub mod tests {
</a>     fn step_replicateentries_reject_missing_base_term() -&gt; Result&lt;()&gt; {
         let (follower, mut node_rx, mut state_rx) = setup()?;
         let mut node = follower.step(Message {
<a href="#h40-37-3" id="h40-37-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-37-4" id="h40-37-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-37-5" id="h40-37-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-37-6" id="h40-37-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ReplicateEntries {
                 base_index: 1,
<a href="#h40-38" id="h40-38" class="h">@@ -763,7 +763,7 @@ pub mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-38-3" id="h40-38-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-38-4" id="h40-38-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::RejectEntries,
             }],
<a href="#h40-39" id="h40-39" class="h">@@ -787,14 +787,14 @@ pub mod tests {
</a>         assert_node(&amp;mut node)
             .is_follower()
             .term(3)
<a href="#h40-39-3" id="h40-39-3" class="d">-            .leader(Some(&quot;b&quot;))
</a><a href="#h40-39-4" id="h40-39-4" class="i">+            .leader(Some(2))
</a>             .proxied(vec![(vec![0x01], Address::Client)])
             .queued(vec![]);
         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-39-11" id="h40-39-11" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-39-12" id="h40-39-12" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ClientRequest {
                     id: vec![0x01],
<a href="#h40-40" id="h40-40" class="h">@@ -805,20 +805,15 @@ pub mod tests {
</a>         assert_messages(&amp;mut state_rx, vec![]);
 
         node = node.step(Message {
<a href="#h40-40-3" id="h40-40-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-40-4" id="h40-40-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-40-5" id="h40-40-5" class="i">+            from: Address::Peer(2),
</a><a href="#h40-40-6" id="h40-40-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ClientResponse {
                 id: vec![0x01],
                 response: Ok(Response::State(vec![0xaf])),
             },
         })?;
<a href="#h40-40-13" id="h40-40-13" class="d">-        assert_node(&amp;mut node)
</a><a href="#h40-40-14" id="h40-40-14" class="d">-            .is_follower()
</a><a href="#h40-40-15" id="h40-40-15" class="d">-            .term(3)
</a><a href="#h40-40-16" id="h40-40-16" class="d">-            .leader(Some(&quot;b&quot;))
</a><a href="#h40-40-17" id="h40-40-17" class="d">-            .proxied(vec![])
</a><a href="#h40-40-18" id="h40-40-18" class="d">-            .queued(vec![]);
</a><a href="#h40-40-19" id="h40-40-19" class="i">+        assert_node(&amp;mut node).is_follower().term(3).leader(Some(2)).proxied(vec![]).queued(vec![]);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
<a href="#h40-41" id="h40-41" class="h">@@ -857,15 +852,15 @@ pub mod tests {
</a> 
         // When a leader appears, we will proxy the queued request to them.
         node = node.step(Message {
<a href="#h40-41-3" id="h40-41-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-41-4" id="h40-41-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-41-5" id="h40-41-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-41-6" id="h40-41-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
         assert_node(&amp;mut node)
             .is_follower()
             .term(3)
<a href="#h40-41-13" id="h40-41-13" class="d">-            .leader(Some(&quot;c&quot;))
</a><a href="#h40-41-14" id="h40-41-14" class="i">+            .leader(Some(3))
</a>             .proxied(vec![(vec![0x01], Address::Client)])
             .queued(vec![]);
         assert_messages(
<a href="#h40-42" id="h40-42" class="h">@@ -873,7 +868,7 @@ pub mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h40-42-3" id="h40-42-3" class="d">-                    to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-42-4" id="h40-42-4" class="i">+                    to: Address::Peer(3),
</a>                     term: 0,
                     event: Event::ClientRequest {
                         id: vec![0x01],
<a href="#h40-43" id="h40-43" class="h">@@ -882,7 +877,7 @@ pub mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h40-43-3" id="h40-43-3" class="d">-                    to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-43-4" id="h40-43-4" class="i">+                    to: Address::Peer(3),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
                 },
<a href="#h40-44" id="h40-44" class="h">@@ -912,14 +907,14 @@ pub mod tests {
</a>         assert_node(&amp;mut node)
             .is_follower()
             .term(3)
<a href="#h40-44-3" id="h40-44-3" class="d">-            .leader(Some(&quot;b&quot;))
</a><a href="#h40-44-4" id="h40-44-4" class="i">+            .leader(Some(2))
</a>             .proxied(vec![(vec![0x01], Address::Client)])
             .queued(vec![]);
         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h40-44-11" id="h40-44-11" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-44-12" id="h40-44-12" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ClientRequest {
                     id: vec![0x01],
<a href="#h40-45" id="h40-45" class="h">@@ -931,17 +926,12 @@ pub mod tests {
</a> 
         // When a new leader appears, the proxied request is aborted.
         node = node.step(Message {
<a href="#h40-45-3" id="h40-45-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-45-4" id="h40-45-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-45-5" id="h40-45-5" class="i">+            from: Address::Peer(3),
</a><a href="#h40-45-6" id="h40-45-6" class="i">+            to: Address::Peer(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h40-45-10" id="h40-45-10" class="d">-        assert_node(&amp;mut node)
</a><a href="#h40-45-11" id="h40-45-11" class="d">-            .is_follower()
</a><a href="#h40-45-12" id="h40-45-12" class="d">-            .term(4)
</a><a href="#h40-45-13" id="h40-45-13" class="d">-            .leader(Some(&quot;c&quot;))
</a><a href="#h40-45-14" id="h40-45-14" class="d">-            .proxied(vec![])
</a><a href="#h40-45-15" id="h40-45-15" class="d">-            .queued(vec![]);
</a><a href="#h40-45-16" id="h40-45-16" class="i">+        assert_node(&amp;mut node).is_follower().term(4).leader(Some(3)).proxied(vec![]).queued(vec![]);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![
<a href="#h40-46" id="h40-46" class="h">@@ -953,7 +943,7 @@ pub mod tests {
</a>                 },
                 Message {
                     from: Address::Local,
<a href="#h40-46-3" id="h40-46-3" class="d">-                    to: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h40-46-4" id="h40-46-4" class="i">+                    to: Address::Peer(3),
</a>                     term: 4,
                     event: Event::ConfirmLeader { commit_index: 3, has_committed: true },
                 },
<a href="#h40-47" id="h40-47" class="h">@@ -977,11 +967,11 @@ pub mod tests {
</a>         // Make sure heartbeats reset election timeout
         assert!(timeout &gt; 0);
         for _ in 0..(3 * timeout) {
<a href="#h40-47-3" id="h40-47-3" class="d">-            assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;));
</a><a href="#h40-47-4" id="h40-47-4" class="i">+            assert_node(&amp;mut node).is_follower().term(3).leader(Some(2));
</a>             node = node.tick()?;
             node = node.step(Message {
<a href="#h40-47-7" id="h40-47-7" class="d">-                from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-47-8" id="h40-47-8" class="d">-                to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h40-47-9" id="h40-47-9" class="i">+                from: Address::Peer(2),
</a><a href="#h40-47-10" id="h40-47-10" class="i">+                to: Address::Peer(1),
</a>                 term: 3,
                 event: Event::Heartbeat { commit_index: 2, commit_term: 1 },
             })?;
<a href="#h40-48" id="h40-48" class="h">@@ -989,7 +979,7 @@ pub mod tests {
</a>                 &amp;mut node_rx,
                 vec![Message {
                     from: Address::Local,
<a href="#h40-48-3" id="h40-48-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h40-48-4" id="h40-48-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 3,
                     event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
                 }],
<a href="#h40-49" id="h40-49" class="h">@@ -997,7 +987,7 @@ pub mod tests {
</a>         }
 
         for _ in 0..timeout {
<a href="#h40-49-3" id="h40-49-3" class="d">-            assert_node(&amp;mut node).is_follower().term(3).leader(Some(&quot;b&quot;));
</a><a href="#h40-49-4" id="h40-49-4" class="i">+            assert_node(&amp;mut node).is_follower().term(3).leader(Some(2));
</a>             node = node.tick()?;
         }
         assert_node(&amp;mut node).is_candidate().term(4);
<b>diff --git a/<a id="h41" href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a> b/<a href="../file/src/raft/node/leader.rs.html">src/raft/node/leader.rs</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::{Address, Event, Instruction, Message, Request, Response, Status};
<a href="#h41-0-1" id="h41-0-1" class="d">-use super::{Follower, Node, RoleNode, HEARTBEAT_INTERVAL};
</a><a href="#h41-0-2" id="h41-0-2" class="i">+use super::{Follower, Node, NodeID, RoleNode, HEARTBEAT_INTERVAL};
</a> use crate::error::{Error, Result};
 
 use ::log::{debug, info, warn};
<a href="#h41-1" id="h41-1" class="h">@@ -11,22 +11,22 @@ pub struct Leader {
</a>     /// Number of ticks since last heartbeat.
     heartbeat_ticks: u64,
     /// The next index to replicate to a peer.
<a href="#h41-1-3" id="h41-1-3" class="d">-    peer_next_index: HashMap&lt;String, u64&gt;,
</a><a href="#h41-1-4" id="h41-1-4" class="i">+    peer_next_index: HashMap&lt;NodeID, u64&gt;,
</a>     /// The last index known to be replicated on a peer.
<a href="#h41-1-6" id="h41-1-6" class="d">-    peer_last_index: HashMap&lt;String, u64&gt;,
</a><a href="#h41-1-7" id="h41-1-7" class="i">+    peer_last_index: HashMap&lt;NodeID, u64&gt;,
</a> }
 
 impl Leader {
     /// Creates a new leader role.
<a href="#h41-1-12" id="h41-1-12" class="d">-    pub fn new(peers: Vec&lt;String&gt;, last_index: u64) -&gt; Self {
</a><a href="#h41-1-13" id="h41-1-13" class="i">+    pub fn new(peers: Vec&lt;NodeID&gt;, last_index: u64) -&gt; Self {
</a>         let mut leader = Self {
             heartbeat_ticks: 0,
             peer_next_index: HashMap::new(),
             peer_last_index: HashMap::new(),
         };
         for peer in peers {
<a href="#h41-1-20" id="h41-1-20" class="d">-            leader.peer_next_index.insert(peer.clone(), last_index + 1);
</a><a href="#h41-1-21" id="h41-1-21" class="d">-            leader.peer_last_index.insert(peer.clone(), 0);
</a><a href="#h41-1-22" id="h41-1-22" class="i">+            leader.peer_next_index.insert(peer, last_index + 1);
</a><a href="#h41-1-23" id="h41-1-23" class="i">+            leader.peer_last_index.insert(peer, 0);
</a>         }
         leader
     }
<a href="#h41-2" id="h41-2" class="h">@@ -34,7 +34,7 @@ impl Leader {
</a> 
 impl RoleNode&lt;Leader&gt; {
     /// Transforms the leader into a follower
<a href="#h41-2-3" id="h41-2-3" class="d">-    fn become_follower(mut self, term: u64, leader: &amp;str) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a><a href="#h41-2-4" id="h41-2-4" class="i">+    fn become_follower(mut self, term: u64, leader: NodeID) -&gt; Result&lt;RoleNode&lt;Follower&gt;&gt; {
</a>         info!(&quot;Discovered new leader {} for term {}, following&quot;, leader, term);
         self.term = term;
         self.log.set_term(term, None)?;
<a href="#h41-3" id="h41-3" class="h">@@ -46,7 +46,7 @@ impl RoleNode&lt;Leader&gt; {
</a>     pub fn append(&amp;mut self, command: Option&lt;Vec&lt;u8&gt;&gt;) -&gt; Result&lt;u64&gt; {
         let index = self.log.append(self.term, command)?;
         for peer in self.peers.clone() {
<a href="#h41-3-3" id="h41-3-3" class="d">-            self.replicate(&amp;peer)?;
</a><a href="#h41-3-4" id="h41-3-4" class="i">+            self.replicate(peer)?;
</a>         }
         Ok(index)
     }
<a href="#h41-4" id="h41-4" class="h">@@ -76,11 +76,11 @@ impl RoleNode&lt;Leader&gt; {
</a>     }
 
     /// Replicates the log to a peer.
<a href="#h41-4-3" id="h41-4-3" class="d">-    fn replicate(&amp;mut self, peer: &amp;str) -&gt; Result&lt;()&gt; {
</a><a href="#h41-4-4" id="h41-4-4" class="i">+    fn replicate(&amp;mut self, peer: NodeID) -&gt; Result&lt;()&gt; {
</a>         let peer_next = self
             .role
             .peer_next_index
<a href="#h41-4-8" id="h41-4-8" class="d">-            .get(peer)
</a><a href="#h41-4-9" id="h41-4-9" class="i">+            .get(&amp;peer)
</a>             .cloned()
             .ok_or_else(|| Error::Internal(format!(&quot;Unknown peer {}&quot;, peer)))?;
         let base_index = if peer_next &gt; 0 { peer_next - 1 } else { 0 };
<a href="#h41-5" id="h41-5" class="h">@@ -91,10 +91,7 @@ impl RoleNode&lt;Leader&gt; {
</a>         };
         let entries = self.log.scan(peer_next..)?.collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;()?;
         debug!(&quot;Replicating {} entries at base {} to {}&quot;, entries.len(), base_index, peer);
<a href="#h41-5-3" id="h41-5-3" class="d">-        self.send(
</a><a href="#h41-5-4" id="h41-5-4" class="d">-            Address::Peer(peer.to_string()),
</a><a href="#h41-5-5" id="h41-5-5" class="d">-            Event::ReplicateEntries { base_index, base_term, entries },
</a><a href="#h41-5-6" id="h41-5-6" class="d">-        )?;
</a><a href="#h41-5-7" id="h41-5-7" class="i">+        self.send(Address::Peer(peer), Event::ReplicateEntries { base_index, base_term, entries })?;
</a>         Ok(())
     }
 
<a href="#h41-6" id="h41-6" class="h">@@ -105,28 +102,28 @@ impl RoleNode&lt;Leader&gt; {
</a>             return Ok(self.into());
         }
         if msg.term &gt; self.term {
<a href="#h41-6-3" id="h41-6-3" class="d">-            if let Address::Peer(from) = &amp;msg.from {
</a><a href="#h41-6-4" id="h41-6-4" class="i">+            if let Address::Peer(from) = msg.from {
</a>                 return self.become_follower(msg.term, from)?.step(msg);
             }
         }
 
         match msg.event {
             Event::ConfirmLeader { commit_index, has_committed } =&gt; {
<a href="#h41-6-11" id="h41-6-11" class="d">-                if let Address::Peer(from) = msg.from.clone() {
</a><a href="#h41-6-12" id="h41-6-12" class="i">+                if let Address::Peer(from) = msg.from {
</a>                     self.state_tx.send(Instruction::Vote {
                         term: msg.term,
                         index: commit_index,
                         address: msg.from,
                     })?;
                     if !has_committed {
<a href="#h41-6-19" id="h41-6-19" class="d">-                        self.replicate(&amp;from)?;
</a><a href="#h41-6-20" id="h41-6-20" class="i">+                        self.replicate(from)?;
</a>                     }
                 }
             }
 
             Event::AcceptEntries { last_index } =&gt; {
                 if let Address::Peer(from) = msg.from {
<a href="#h41-6-27" id="h41-6-27" class="d">-                    self.role.peer_last_index.insert(from.clone(), last_index);
</a><a href="#h41-6-28" id="h41-6-28" class="i">+                    self.role.peer_last_index.insert(from, last_index);
</a>                     self.role.peer_next_index.insert(from, last_index + 1);
                 }
                 self.commit()?;
<a href="#h41-7" id="h41-7" class="h">@@ -134,12 +131,12 @@ impl RoleNode&lt;Leader&gt; {
</a> 
             Event::RejectEntries =&gt; {
                 if let Address::Peer(from) = msg.from {
<a href="#h41-7-3" id="h41-7-3" class="d">-                    self.role.peer_next_index.entry(from.clone()).and_modify(|i| {
</a><a href="#h41-7-4" id="h41-7-4" class="i">+                    self.role.peer_next_index.entry(from).and_modify(|i| {
</a>                         if *i &gt; 1 {
                             *i -= 1
                         }
                     });
<a href="#h41-7-9" id="h41-7-9" class="d">-                    self.replicate(&amp;from)?;
</a><a href="#h41-7-10" id="h41-7-10" class="i">+                    self.replicate(from)?;
</a>                 }
             }
 
<a href="#h41-8" id="h41-8" class="h">@@ -174,8 +171,8 @@ impl RoleNode&lt;Leader&gt; {
</a>             Event::ClientRequest { id, request: Request::Status } =&gt; {
                 let engine_status = self.log.status()?;
                 let mut status = Box::new(Status {
<a href="#h41-8-3" id="h41-8-3" class="d">-                    server: self.id.clone(),
</a><a href="#h41-8-4" id="h41-8-4" class="d">-                    leader: self.id.clone(),
</a><a href="#h41-8-5" id="h41-8-5" class="i">+                    server: self.id,
</a><a href="#h41-8-6" id="h41-8-6" class="i">+                    leader: self.id,
</a>                     term: self.term,
                     node_last_index: self.role.peer_last_index.clone(),
                     commit_index: self.log.get_commit_index().0,
<a href="#h41-9" id="h41-9" class="h">@@ -183,13 +180,13 @@ impl RoleNode&lt;Leader&gt; {
</a>                     storage: engine_status.name.clone(),
                     storage_size: engine_status.size,
                 });
<a href="#h41-9-3" id="h41-9-3" class="d">-                status.node_last_index.insert(self.id.clone(), self.log.get_last_index().0);
</a><a href="#h41-9-4" id="h41-9-4" class="i">+                status.node_last_index.insert(self.id, self.log.get_last_index().0);
</a>                 self.state_tx.send(Instruction::Status { id, address: msg.from, status })?
             }
 
             Event::ClientResponse { id, mut response } =&gt; {
                 if let Ok(Response::Status(ref mut status)) = response {
<a href="#h41-9-10" id="h41-9-10" class="d">-                    status.server = self.id.clone();
</a><a href="#h41-9-11" id="h41-9-11" class="i">+                    status.server = self.id;
</a>                 }
                 self.send(Address::Client, Event::ClientResponse { id, response })?;
             }
<a href="#h41-10" id="h41-10" class="h">@@ -237,7 +234,7 @@ mod tests {
</a>     )&gt; {
         let (node_tx, node_rx) = mpsc::unbounded_channel();
         let (state_tx, state_rx) = mpsc::unbounded_channel();
<a href="#h41-10-3" id="h41-10-3" class="d">-        let peers = vec![&quot;b&quot;.into(), &quot;c&quot;.into(), &quot;d&quot;.into(), &quot;e&quot;.into()];
</a><a href="#h41-10-4" id="h41-10-4" class="i">+        let peers = vec![2, 3, 4, 5];
</a>         let mut log = Log::new(Box::new(storage::engine::Memory::new()), false)?;
         log.append(1, Some(vec![0x01]))?;
         log.append(1, Some(vec![0x02]))?;
<a href="#h41-11" id="h41-11" class="h">@@ -248,7 +245,7 @@ mod tests {
</a>         log.set_term(3, None)?;
 
         let node = RoleNode {
<a href="#h41-11-3" id="h41-11-3" class="d">-            id: &quot;a&quot;.into(),
</a><a href="#h41-11-4" id="h41-11-4" class="i">+            id: 1,
</a>             peers: peers.clone(),
             term: 3,
             role: Leader::new(peers, log.get_last_index().0),
<a href="#h41-12" id="h41-12" class="h">@@ -268,8 +265,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-12-3" id="h41-12-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-12-4" id="h41-12-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-12-5" id="h41-12-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-12-6" id="h41-12-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ConfirmLeader { commit_index: 2, has_committed: true },
         })?;
<a href="#h41-13" id="h41-13" class="h">@@ -277,7 +274,7 @@ mod tests {
</a>         assert_messages(&amp;mut node_rx, vec![]);
         assert_messages(
             &amp;mut state_rx,
<a href="#h41-13-3" id="h41-13-3" class="d">-            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(&quot;b&quot;.into()) }],
</a><a href="#h41-13-4" id="h41-13-4" class="i">+            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(2) }],
</a>         );
         Ok(())
     }
<a href="#h41-14" id="h41-14" class="h">@@ -289,8 +286,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-14-3" id="h41-14-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-14-4" id="h41-14-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-14-5" id="h41-14-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-14-6" id="h41-14-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::ConfirmLeader { commit_index: 2, has_committed: false },
         })?;
<a href="#h41-15" id="h41-15" class="h">@@ -299,14 +296,14 @@ mod tests {
</a>             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h41-15-3" id="h41-15-3" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-15-4" id="h41-15-4" class="i">+                to: Address::Peer(2),
</a>                 term: 3,
                 event: Event::ReplicateEntries { base_index: 5, base_term: 3, entries: vec![] },
             }],
         );
         assert_messages(
             &amp;mut state_rx,
<a href="#h41-15-11" id="h41-15-11" class="d">-            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(&quot;b&quot;.into()) }],
</a><a href="#h41-15-12" id="h41-15-12" class="i">+            vec![Instruction::Vote { term: 3, index: 2, address: Address::Peer(2) }],
</a>         );
         Ok(())
     }
<a href="#h41-16" id="h41-16" class="h">@@ -318,8 +315,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-16-3" id="h41-16-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-16-4" id="h41-16-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-16-5" id="h41-16-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-16-6" id="h41-16-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::Heartbeat { commit_index: 5, commit_term: 3 },
         })?;
<a href="#h41-17" id="h41-17" class="h">@@ -336,17 +333,17 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-17-3" id="h41-17-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-17-4" id="h41-17-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-17-5" id="h41-17-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-17-6" id="h41-17-6" class="i">+            to: Address::Peer(1),
</a>             term: 4,
             event: Event::Heartbeat { commit_index: 7, commit_term: 4 },
         })?;
<a href="#h41-17-10" id="h41-17-10" class="d">-        assert_node(&amp;mut node).is_follower().term(4).leader(Some(&quot;b&quot;)).committed(2);
</a><a href="#h41-17-11" id="h41-17-11" class="i">+        assert_node(&amp;mut node).is_follower().term(4).leader(Some(2)).committed(2);
</a>         assert_messages(
             &amp;mut node_rx,
             vec![Message {
                 from: Address::Local,
<a href="#h41-17-16" id="h41-17-16" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-17-17" id="h41-17-17" class="i">+                to: Address::Peer(2),
</a>                 term: 4,
                 event: Event::ConfirmLeader { commit_index: 7, has_committed: false },
             }],
<a href="#h41-18" id="h41-18" class="h">@@ -362,8 +359,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-18-3" id="h41-18-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-18-4" id="h41-18-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-18-5" id="h41-18-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-18-6" id="h41-18-6" class="i">+            to: Address::Peer(1),
</a>             term: 2,
             event: Event::Heartbeat { commit_index: 3, commit_term: 2 },
         })?;
<a href="#h41-19" id="h41-19" class="h">@@ -379,8 +376,8 @@ mod tests {
</a>         let mut node: Node = leader.into();
 
         node = node.step(Message {
<a href="#h41-19-3" id="h41-19-3" class="d">-            from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-19-4" id="h41-19-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-19-5" id="h41-19-5" class="i">+            from: Address::Peer(2),
</a><a href="#h41-19-6" id="h41-19-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 4 },
         })?;
<a href="#h41-20" id="h41-20" class="h">@@ -389,8 +386,8 @@ mod tests {
</a>         assert_messages(&amp;mut state_rx, vec![]);
 
         node = node.step(Message {
<a href="#h41-20-3" id="h41-20-3" class="d">-            from: Address::Peer(&quot;c&quot;.into()),
</a><a href="#h41-20-4" id="h41-20-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-20-5" id="h41-20-5" class="i">+            from: Address::Peer(3),
</a><a href="#h41-20-6" id="h41-20-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 5 },
         })?;
<a href="#h41-21" id="h41-21" class="h">@@ -409,8 +406,8 @@ mod tests {
</a>         );
 
         node = node.step(Message {
<a href="#h41-21-3" id="h41-21-3" class="d">-            from: Address::Peer(&quot;d&quot;.into()),
</a><a href="#h41-21-4" id="h41-21-4" class="d">-            to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-21-5" id="h41-21-5" class="i">+            from: Address::Peer(4),
</a><a href="#h41-21-6" id="h41-21-6" class="i">+            to: Address::Peer(1),
</a>             term: 3,
             event: Event::AcceptEntries { last_index: 5 },
         })?;
<a href="#h41-22" id="h41-22" class="h">@@ -435,8 +432,8 @@ mod tests {
</a> 
         for _ in 0..5 {
             node = node.step(Message {
<a href="#h41-22-3" id="h41-22-3" class="d">-                from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-22-4" id="h41-22-4" class="d">-                to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-22-5" id="h41-22-5" class="i">+                from: Address::Peer(2),
</a><a href="#h41-22-6" id="h41-22-6" class="i">+                to: Address::Peer(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 5 },
             })?;
<a href="#h41-23" id="h41-23" class="h">@@ -457,7 +454,7 @@ mod tests {
</a>         for peer in peers.into_iter() {
             node = node.step(Message {
                 from: Address::Peer(peer),
<a href="#h41-23-3" id="h41-23-3" class="d">-                to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-23-4" id="h41-23-4" class="i">+                to: Address::Peer(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 3 },
             })?;
<a href="#h41-24" id="h41-24" class="h">@@ -478,7 +475,7 @@ mod tests {
</a>         for (i, peer) in peers.into_iter().enumerate() {
             node = node.step(Message {
                 from: Address::Peer(peer),
<a href="#h41-24-3" id="h41-24-3" class="d">-                to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-24-4" id="h41-24-4" class="i">+                to: Address::Peer(1),
</a>                 term: 3,
                 event: Event::AcceptEntries { last_index: 7 },
             })?;
<a href="#h41-25" id="h41-25" class="h">@@ -517,8 +514,8 @@ mod tests {
</a> 
         for i in 0..(entries.len() + 3) {
             node = node.step(Message {
<a href="#h41-25-3" id="h41-25-3" class="d">-                from: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-25-4" id="h41-25-4" class="d">-                to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h41-25-5" id="h41-25-5" class="i">+                from: Address::Peer(2),
</a><a href="#h41-25-6" id="h41-25-6" class="i">+                to: Address::Peer(1),
</a>                 term: 3,
                 event: Event::RejectEntries,
             })?;
<a href="#h41-26" id="h41-26" class="h">@@ -529,7 +526,7 @@ mod tests {
</a>                 &amp;mut node_rx,
                 vec![Message {
                     from: Address::Local,
<a href="#h41-26-3" id="h41-26-3" class="d">-                    to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h41-26-4" id="h41-26-4" class="i">+                    to: Address::Peer(2),
</a>                     term: 3,
                     event: Event::ReplicateEntries {
                         base_index: index as u64,
<a href="#h41-27" id="h41-27" class="h">@@ -649,18 +646,12 @@ mod tests {
</a>                 id: vec![0x01],
                 address: Address::Client,
                 status: Box::new(Status {
<a href="#h41-27-3" id="h41-27-3" class="d">-                    server: &quot;a&quot;.into(),
</a><a href="#h41-27-4" id="h41-27-4" class="d">-                    leader: &quot;a&quot;.into(),
</a><a href="#h41-27-5" id="h41-27-5" class="i">+                    server: 1,
</a><a href="#h41-27-6" id="h41-27-6" class="i">+                    leader: 1,
</a>                     term: 3,
<a href="#h41-27-8" id="h41-27-8" class="d">-                    node_last_index: vec![
</a><a href="#h41-27-9" id="h41-27-9" class="d">-                        (&quot;a&quot;.into(), 5),
</a><a href="#h41-27-10" id="h41-27-10" class="d">-                        (&quot;b&quot;.into(), 0),
</a><a href="#h41-27-11" id="h41-27-11" class="d">-                        (&quot;c&quot;.into(), 0),
</a><a href="#h41-27-12" id="h41-27-12" class="d">-                        (&quot;d&quot;.into(), 0),
</a><a href="#h41-27-13" id="h41-27-13" class="d">-                        (&quot;e&quot;.into(), 0),
</a><a href="#h41-27-14" id="h41-27-14" class="d">-                    ]
</a><a href="#h41-27-15" id="h41-27-15" class="d">-                    .into_iter()
</a><a href="#h41-27-16" id="h41-27-16" class="d">-                    .collect(),
</a><a href="#h41-27-17" id="h41-27-17" class="i">+                    node_last_index: vec![(1, 5), (2, 0), (3, 0), (4, 0), (5, 0)]
</a><a href="#h41-27-18" id="h41-27-18" class="i">+                        .into_iter()
</a><a href="#h41-27-19" id="h41-27-19" class="i">+                        .collect(),
</a>                     commit_index: 2,
                     apply_index: 0,
                     storage: &quot;memory&quot;.into(),
<b>diff --git a/<a id="h42" href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a> b/<a href="../file/src/raft/node/mod.rs.html">src/raft/node/mod.rs</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -13,6 +13,9 @@ use serde_derive::{Deserialize, Serialize};
</a> use std::collections::HashMap;
 use tokio::sync::mpsc;
 
<a href="#h42-0-3" id="h42-0-3" class="i">+/// A node ID.
</a><a href="#h42-0-4" id="h42-0-4" class="i">+pub type NodeID = u8;
</a><a href="#h42-0-5" id="h42-0-5" class="i">+
</a> /// The interval between leader heartbeats, in ticks.
 const HEARTBEAT_INTERVAL: u64 = 1;
 
<a href="#h42-1" id="h42-1" class="h">@@ -25,10 +28,10 @@ const ELECTION_TIMEOUT_MAX: u64 = 15 * HEARTBEAT_INTERVAL;
</a> /// Node status
 #[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
 pub struct Status {
<a href="#h42-1-3" id="h42-1-3" class="d">-    pub server: String,
</a><a href="#h42-1-4" id="h42-1-4" class="d">-    pub leader: String,
</a><a href="#h42-1-5" id="h42-1-5" class="i">+    pub server: NodeID,
</a><a href="#h42-1-6" id="h42-1-6" class="i">+    pub leader: NodeID,
</a>     pub term: u64,
<a href="#h42-1-8" id="h42-1-8" class="d">-    pub node_last_index: HashMap&lt;String, u64&gt;,
</a><a href="#h42-1-9" id="h42-1-9" class="i">+    pub node_last_index: HashMap&lt;NodeID, u64&gt;,
</a>     pub commit_index: u64,
     pub apply_index: u64,
     pub storage: String,
<a href="#h42-2" id="h42-2" class="h">@@ -45,8 +48,8 @@ pub enum Node {
</a> impl Node {
     /// Creates a new Raft node, starting as a follower, or leader if no peers.
     pub async fn new(
<a href="#h42-2-3" id="h42-2-3" class="d">-        id: &amp;str,
</a><a href="#h42-2-4" id="h42-2-4" class="d">-        peers: Vec&lt;String&gt;,
</a><a href="#h42-2-5" id="h42-2-5" class="i">+        id: NodeID,
</a><a href="#h42-2-6" id="h42-2-6" class="i">+        peers: Vec&lt;NodeID&gt;,
</a>         mut log: Log,
         mut state: Box&lt;dyn State&gt;,
         node_tx: mpsc::UnboundedSender&lt;Message&gt;,
<a href="#h42-3" id="h42-3" class="h">@@ -70,7 +73,7 @@ impl Node {
</a> 
         let (term, voted_for) = log.get_term()?;
         let node = RoleNode {
<a href="#h42-3-3" id="h42-3-3" class="d">-            id: id.to_owned(),
</a><a href="#h42-3-4" id="h42-3-4" class="i">+            id,
</a>             peers,
             term,
             log,
<a href="#h42-4" id="h42-4" class="h">@@ -78,7 +81,7 @@ impl Node {
</a>             state_tx,
             queued_reqs: Vec::new(),
             proxied_reqs: HashMap::new(),
<a href="#h42-4-3" id="h42-4-3" class="d">-            role: Follower::new(None, voted_for.as_deref()),
</a><a href="#h42-4-4" id="h42-4-4" class="i">+            role: Follower::new(None, voted_for),
</a>         };
         if node.peers.is_empty() {
             info!(&quot;No peers specified, starting as leader&quot;);
<a href="#h42-5" id="h42-5" class="h">@@ -90,11 +93,11 @@ impl Node {
</a>     }
 
     /// Returns the node ID.
<a href="#h42-5-3" id="h42-5-3" class="d">-    pub fn id(&amp;self) -&gt; String {
</a><a href="#h42-5-4" id="h42-5-4" class="i">+    pub fn id(&amp;self) -&gt; NodeID {
</a>         match self {
<a href="#h42-5-6" id="h42-5-6" class="d">-            Node::Candidate(n) =&gt; n.id.clone(),
</a><a href="#h42-5-7" id="h42-5-7" class="d">-            Node::Follower(n) =&gt; n.id.clone(),
</a><a href="#h42-5-8" id="h42-5-8" class="d">-            Node::Leader(n) =&gt; n.id.clone(),
</a><a href="#h42-5-9" id="h42-5-9" class="i">+            Node::Candidate(n) =&gt; n.id,
</a><a href="#h42-5-10" id="h42-5-10" class="i">+            Node::Follower(n) =&gt; n.id,
</a><a href="#h42-5-11" id="h42-5-11" class="i">+            Node::Leader(n) =&gt; n.id,
</a>         }
     }
 
<a href="#h42-6" id="h42-6" class="h">@@ -138,8 +141,8 @@ impl From&lt;RoleNode&lt;Leader&gt;&gt; for Node {
</a> 
 // A Raft node with role R
 pub struct RoleNode&lt;R&gt; {
<a href="#h42-6-3" id="h42-6-3" class="d">-    id: String,
</a><a href="#h42-6-4" id="h42-6-4" class="d">-    peers: Vec&lt;String&gt;,
</a><a href="#h42-6-5" id="h42-6-5" class="i">+    id: NodeID,
</a><a href="#h42-6-6" id="h42-6-6" class="i">+    peers: Vec&lt;NodeID&gt;,
</a>     term: u64,
     log: Log,
     node_tx: mpsc::UnboundedSender&lt;Message&gt;,
<a href="#h42-7" id="h42-7" class="h">@@ -224,8 +227,8 @@ impl&lt;R&gt; RoleNode&lt;R&gt; {
</a>             return Err(Error::Internal(format!(&quot;Message from past term {}&quot;, msg.term)));
         }
 
<a href="#h42-7-3" id="h42-7-3" class="d">-        match &amp;msg.to {
</a><a href="#h42-7-4" id="h42-7-4" class="d">-            Address::Peer(id) if id == &amp;self.id =&gt; Ok(()),
</a><a href="#h42-7-5" id="h42-7-5" class="i">+        match msg.to {
</a><a href="#h42-7-6" id="h42-7-6" class="i">+            Address::Peer(id) if id == self.id =&gt; Ok(()),
</a>             Address::Local =&gt; Ok(()),
             Address::Peers =&gt; Ok(()),
             Address::Peer(id) =&gt; {
<a href="#h42-8" id="h42-8" class="h">@@ -322,9 +325,9 @@ mod tests {
</a>             }
         }
 
<a href="#h42-8-3" id="h42-8-3" class="d">-        pub fn leader(self, leader: Option&lt;&amp;str&gt;) -&gt; Self {
</a><a href="#h42-8-4" id="h42-8-4" class="i">+        pub fn leader(self, leader: Option&lt;NodeID&gt;) -&gt; Self {
</a>             assert_eq!(
<a href="#h42-8-6" id="h42-8-6" class="d">-                leader.map(str::to_owned),
</a><a href="#h42-8-7" id="h42-8-7" class="i">+                leader,
</a>                 match self.node {
                     Node::Candidate(_) =&gt; None,
                     Node::Follower(n) =&gt; follower_leader(n),
<a href="#h42-9" id="h42-9" class="h">@@ -383,9 +386,9 @@ mod tests {
</a>             self
         }
 
<a href="#h42-9-3" id="h42-9-3" class="d">-        pub fn voted_for(mut self, voted_for: Option&lt;&amp;str&gt;) -&gt; Self {
</a><a href="#h42-9-4" id="h42-9-4" class="i">+        pub fn voted_for(mut self, voted_for: Option&lt;NodeID&gt;) -&gt; Self {
</a>             assert_eq!(
<a href="#h42-9-6" id="h42-9-6" class="d">-                voted_for.map(str::to_owned),
</a><a href="#h42-9-7" id="h42-9-7" class="i">+                voted_for,
</a>                 match self.node {
                     Node::Candidate(_) =&gt; None,
                     Node::Follower(n) =&gt; follower_voted_for(n),
<a href="#h42-10" id="h42-10" class="h">@@ -394,7 +397,7 @@ mod tests {
</a>                 &quot;Unexpected voted_for&quot;
             );
             let (_, saved_voted_for) = self.log().get_term().unwrap();
<a href="#h42-10-3" id="h42-10-3" class="d">-            assert_eq!(saved_voted_for.as_deref(), voted_for, &quot;Unexpected voted_for saved in log&quot;);
</a><a href="#h42-10-4" id="h42-10-4" class="i">+            assert_eq!(saved_voted_for, voted_for, &quot;Unexpected voted_for saved in log&quot;);
</a>             self
         }
     }
<a href="#h42-11" id="h42-11" class="h">@@ -404,17 +407,17 @@ mod tests {
</a>     }
 
     fn setup_rolenode() -&gt; Result&lt;(RoleNode&lt;()&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
<a href="#h42-11-3" id="h42-11-3" class="d">-        setup_rolenode_peers(vec![&quot;b&quot;.into(), &quot;c&quot;.into()])
</a><a href="#h42-11-4" id="h42-11-4" class="i">+        setup_rolenode_peers(vec![2, 3])
</a>     }
 
     fn setup_rolenode_peers(
<a href="#h42-11-8" id="h42-11-8" class="d">-        peers: Vec&lt;String&gt;,
</a><a href="#h42-11-9" id="h42-11-9" class="i">+        peers: Vec&lt;NodeID&gt;,
</a>     ) -&gt; Result&lt;(RoleNode&lt;()&gt;, mpsc::UnboundedReceiver&lt;Message&gt;)&gt; {
         let (node_tx, node_rx) = mpsc::unbounded_channel();
         let (state_tx, _) = mpsc::unbounded_channel();
         let node = RoleNode {
             role: (),
<a href="#h42-11-15" id="h42-11-15" class="d">-            id: &quot;a&quot;.into(),
</a><a href="#h42-11-16" id="h42-11-16" class="i">+            id: 1,
</a>             peers,
             term: 1,
             log: Log::new(Box::new(storage::engine::Memory::new()), false)?,
<a href="#h42-12" id="h42-12" class="h">@@ -430,8 +433,8 @@ mod tests {
</a>     async fn new() -&gt; Result&lt;()&gt; {
         let (node_tx, _) = mpsc::unbounded_channel();
         let node = Node::new(
<a href="#h42-12-3" id="h42-12-3" class="d">-            &quot;a&quot;,
</a><a href="#h42-12-4" id="h42-12-4" class="d">-            vec![&quot;b&quot;.into(), &quot;c&quot;.into()],
</a><a href="#h42-12-5" id="h42-12-5" class="i">+            1,
</a><a href="#h42-12-6" id="h42-12-6" class="i">+            vec![2, 3],
</a>             Log::new(Box::new(storage::engine::Memory::new()), false)?,
             Box::new(TestState::new(0)),
             node_tx,
<a href="#h42-13" id="h42-13" class="h">@@ -439,9 +442,9 @@ mod tests {
</a>         .await?;
         match node {
             Node::Follower(rolenode) =&gt; {
<a href="#h42-13-3" id="h42-13-3" class="d">-                assert_eq!(rolenode.id, &quot;a&quot;.to_owned());
</a><a href="#h42-13-4" id="h42-13-4" class="i">+                assert_eq!(rolenode.id, 1);
</a>                 assert_eq!(rolenode.term, 0);
<a href="#h42-13-6" id="h42-13-6" class="d">-                assert_eq!(rolenode.peers, vec![&quot;b&quot;.to_owned(), &quot;c&quot;.to_owned()]);
</a><a href="#h42-13-7" id="h42-13-7" class="i">+                assert_eq!(rolenode.peers, vec![2, 3]);
</a>             }
             _ =&gt; panic!(&quot;Expected node to start as follower&quot;),
         }
<a href="#h42-14" id="h42-14" class="h">@@ -459,7 +462,7 @@ mod tests {
</a>         log.append(2, Some(vec![0x03]))?;
         let state = Box::new(TestState::new(0));
 
<a href="#h42-14-3" id="h42-14-3" class="d">-        Node::new(&quot;a&quot;, vec![&quot;b&quot;.into(), &quot;c&quot;.into()], log, state.clone(), node_tx).await?;
</a><a href="#h42-14-4" id="h42-14-4" class="i">+        Node::new(1, vec![2, 3], log, state.clone(), node_tx).await?;
</a>         tokio::time::sleep(std::time::Duration::from_millis(100)).await;
         assert_eq!(state.list(), vec![vec![0x01], vec![0x02]]);
         assert_eq!(state.applied_index(), 3);
<a href="#h42-15" id="h42-15" class="h">@@ -477,7 +480,7 @@ mod tests {
</a>         log.append(2, Some(vec![0x03]))?;
         let state = Box::new(TestState::new(2));
 
<a href="#h42-15-3" id="h42-15-3" class="d">-        Node::new(&quot;a&quot;, vec![&quot;b&quot;.into(), &quot;c&quot;.into()], log, state.clone(), node_tx).await?;
</a><a href="#h42-15-4" id="h42-15-4" class="i">+        Node::new(1, vec![2, 3], log, state.clone(), node_tx).await?;
</a>         tokio::time::sleep(std::time::Duration::from_millis(100)).await;
         assert_eq!(state.list(), vec![vec![0x02]]);
         assert_eq!(state.applied_index(), 3);
<a href="#h42-16" id="h42-16" class="h">@@ -496,7 +499,7 @@ mod tests {
</a>         let state = Box::new(TestState::new(4));
 
         assert_eq!(
<a href="#h42-16-3" id="h42-16-3" class="d">-            Node::new(&quot;a&quot;, vec![&quot;b&quot;.into(), &quot;c&quot;.into()], log, state.clone(), node_tx).await.err(),
</a><a href="#h42-16-4" id="h42-16-4" class="i">+            Node::new(1, vec![2, 3], log, state.clone(), node_tx).await.err(),
</a>             Some(Error::Internal(
                 &quot;State machine applied index 4 greater than log committed index 3&quot;.into()
             ))
<a href="#h42-17" id="h42-17" class="h">@@ -508,7 +511,7 @@ mod tests {
</a>     async fn new_single() -&gt; Result&lt;()&gt; {
         let (node_tx, _) = mpsc::unbounded_channel();
         let node = Node::new(
<a href="#h42-17-3" id="h42-17-3" class="d">-            &quot;a&quot;,
</a><a href="#h42-17-4" id="h42-17-4" class="i">+            1,
</a>             vec![],
             Log::new(Box::new(storage::engine::Memory::new()), false)?,
             Box::new(TestState::new(0)),
<a href="#h42-18" id="h42-18" class="h">@@ -517,7 +520,7 @@ mod tests {
</a>         .await?;
         match node {
             Node::Leader(rolenode) =&gt; {
<a href="#h42-18-3" id="h42-18-3" class="d">-                assert_eq!(rolenode.id, &quot;a&quot;.to_owned());
</a><a href="#h42-18-4" id="h42-18-4" class="i">+                assert_eq!(rolenode.id, 1);
</a>                 assert_eq!(rolenode.term, 0);
                 assert!(rolenode.peers.is_empty());
             }
<a href="#h42-19" id="h42-19" class="h">@@ -530,9 +533,9 @@ mod tests {
</a>     fn become_role() -&gt; Result&lt;()&gt; {
         let (node, _) = setup_rolenode()?;
         let new = node.become_role(&quot;role&quot;)?;
<a href="#h42-19-3" id="h42-19-3" class="d">-        assert_eq!(new.id, &quot;a&quot;.to_owned());
</a><a href="#h42-19-4" id="h42-19-4" class="i">+        assert_eq!(new.id, 1);
</a>         assert_eq!(new.term, 1);
<a href="#h42-19-6" id="h42-19-6" class="d">-        assert_eq!(new.peers, vec![&quot;b&quot;.to_owned(), &quot;c&quot;.to_owned()]);
</a><a href="#h42-19-7" id="h42-19-7" class="i">+        assert_eq!(new.peers, vec![2, 3]);
</a>         assert_eq!(new.role, &quot;role&quot;);
         Ok(())
     }
<a href="#h42-20" id="h42-20" class="h">@@ -541,8 +544,7 @@ mod tests {
</a>     fn quorum() -&gt; Result&lt;()&gt; {
         let quorums = vec![(1, 1), (2, 2), (3, 2), (4, 3), (5, 3), (6, 4), (7, 4), (8, 5)];
         for (size, quorum) in quorums.into_iter() {
<a href="#h42-20-3" id="h42-20-3" class="d">-            let peers: Vec&lt;String&gt; =
</a><a href="#h42-20-4" id="h42-20-4" class="d">-                (0..(size as u8 - 1)).map(|i| (i as char).to_string()).collect();
</a><a href="#h42-20-5" id="h42-20-5" class="i">+            let peers: Vec&lt;NodeID&gt; = (1..(size as u8)).collect();
</a>             assert_eq!(peers.len(), size as usize - 1);
             let (node, _) = setup_rolenode_peers(peers)?;
             assert_eq!(node.quorum(), quorum);
<a href="#h42-21" id="h42-21" class="h">@@ -553,12 +555,12 @@ mod tests {
</a>     #[test]
     fn send() -&gt; Result&lt;()&gt; {
         let (node, mut rx) = setup_rolenode()?;
<a href="#h42-21-3" id="h42-21-3" class="d">-        node.send(Address::Peer(&quot;b&quot;.into()), Event::Heartbeat { commit_index: 1, commit_term: 1 })?;
</a><a href="#h42-21-4" id="h42-21-4" class="i">+        node.send(Address::Peer(2), Event::Heartbeat { commit_index: 1, commit_term: 1 })?;
</a>         assert_messages(
             &amp;mut rx,
             vec![Message {
                 from: Address::Local,
<a href="#h42-21-9" id="h42-21-9" class="d">-                to: Address::Peer(&quot;b&quot;.into()),
</a><a href="#h42-21-10" id="h42-21-10" class="i">+                to: Address::Peer(2),
</a>                 term: 1,
                 event: Event::Heartbeat { commit_index: 1, commit_term: 1 },
             }],
<b>diff --git a/<a id="h43" href="../file/src/raft/server.rs.html">src/raft/server.rs</a> b/<a href="../file/src/raft/server.rs.html">src/raft/server.rs</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -1,4 +1,4 @@
</a><a href="#h43-0-0" id="h43-0-0" class="d">-use super::{Address, Event, Log, Message, Node, Request, Response, State};
</a><a href="#h43-0-1" id="h43-0-1" class="i">+use super::{Address, Event, Log, Message, Node, NodeID, Request, Response, State};
</a> use crate::error::{Error, Result};
 
 use ::log::{debug, error};
<a href="#h43-1" id="h43-1" class="h">@@ -18,22 +18,21 @@ const TICK: Duration = Duration::from_millis(100);
</a> /// A Raft server.
 pub struct Server {
     node: Node,
<a href="#h43-1-3" id="h43-1-3" class="d">-    peers: HashMap&lt;String, String&gt;,
</a><a href="#h43-1-4" id="h43-1-4" class="i">+    peers: HashMap&lt;NodeID, String&gt;,
</a>     node_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
 }
 
 impl Server {
     /// Creates a new Raft cluster
     pub async fn new(
<a href="#h43-1-11" id="h43-1-11" class="d">-        id: &amp;str,
</a><a href="#h43-1-12" id="h43-1-12" class="d">-        peers: HashMap&lt;String, String&gt;,
</a><a href="#h43-1-13" id="h43-1-13" class="i">+        id: NodeID,
</a><a href="#h43-1-14" id="h43-1-14" class="i">+        peers: HashMap&lt;NodeID, String&gt;,
</a>         log: Log,
         state: Box&lt;dyn State&gt;,
     ) -&gt; Result&lt;Self&gt; {
         let (node_tx, node_rx) = mpsc::unbounded_channel();
         Ok(Self {
<a href="#h43-1-20" id="h43-1-20" class="d">-            node: Node::new(id, peers.keys().map(|k| k.to_string()).collect(), log, state, node_tx)
</a><a href="#h43-1-21" id="h43-1-21" class="d">-                .await?,
</a><a href="#h43-1-22" id="h43-1-22" class="i">+            node: Node::new(id, peers.keys().copied().collect(), log, state, node_tx).await?,
</a>             peers,
             node_rx,
         })
<a href="#h43-2" id="h43-2" class="h">@@ -147,12 +146,12 @@ impl Server {
</a> 
     /// Sends outbound messages to peers via TCP.
     async fn tcp_send(
<a href="#h43-2-3" id="h43-2-3" class="d">-        node_id: String,
</a><a href="#h43-2-4" id="h43-2-4" class="d">-        peers: HashMap&lt;String, String&gt;,
</a><a href="#h43-2-5" id="h43-2-5" class="i">+        node_id: NodeID,
</a><a href="#h43-2-6" id="h43-2-6" class="i">+        peers: HashMap&lt;NodeID, String&gt;,
</a>         out_rx: mpsc::UnboundedReceiver&lt;Message&gt;,
     ) -&gt; Result&lt;()&gt; {
         let mut out_rx = UnboundedReceiverStream::new(out_rx);
<a href="#h43-2-10" id="h43-2-10" class="d">-        let mut peer_txs: HashMap&lt;String, mpsc::Sender&lt;Message&gt;&gt; = HashMap::new();
</a><a href="#h43-2-11" id="h43-2-11" class="i">+        let mut peer_txs: HashMap&lt;NodeID, mpsc::Sender&lt;Message&gt;&gt; = HashMap::new();
</a> 
         for (id, addr) in peers.into_iter() {
             let (tx, rx) = mpsc::channel::&lt;Message&gt;(1000);
<a href="#h43-3" id="h43-3" class="h">@@ -162,11 +161,11 @@ impl Server {
</a> 
         while let Some(mut message) = out_rx.next().await {
             if message.from == Address::Local {
<a href="#h43-3-3" id="h43-3-3" class="d">-                message.from = Address::Peer(node_id.clone())
</a><a href="#h43-3-4" id="h43-3-4" class="i">+                message.from = Address::Peer(node_id)
</a>             }
<a href="#h43-3-6" id="h43-3-6" class="d">-            let to = match &amp;message.to {
</a><a href="#h43-3-7" id="h43-3-7" class="d">-                Address::Peers =&gt; peer_txs.keys().cloned().collect(),
</a><a href="#h43-3-8" id="h43-3-8" class="d">-                Address::Peer(peer) =&gt; vec![peer.to_string()],
</a><a href="#h43-3-9" id="h43-3-9" class="i">+            let to = match message.to {
</a><a href="#h43-3-10" id="h43-3-10" class="i">+                Address::Peers =&gt; peer_txs.keys().copied().collect(),
</a><a href="#h43-3-11" id="h43-3-11" class="i">+                Address::Peer(peer) =&gt; vec![peer],
</a>                 addr =&gt; {
                     error!(&quot;Received outbound message for non-TCP address {:?}&quot;, addr);
                     continue;
<b>diff --git a/<a id="h44" href="../file/src/raft/state.rs.html">src/raft/state.rs</a> b/<a href="../file/src/raft/state.rs.html">src/raft/state.rs</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -310,7 +310,7 @@ pub mod tests {
</a>         state_tx.send(Instruction::Notify {
             id: vec![0x01],
             index: 1,
<a href="#h44-0-3" id="h44-0-3" class="d">-            address: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h44-0-4" id="h44-0-4" class="i">+            address: Address::Peer(1),
</a>         })?;
         state_tx.send(Instruction::Query {
             id: vec![0x02],
<a href="#h44-1" id="h44-1" class="h">@@ -330,7 +330,7 @@ pub mod tests {
</a>             vec![
                 Message {
                     from: Address::Local,
<a href="#h44-1-3" id="h44-1-3" class="d">-                    to: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h44-1-4" id="h44-1-4" class="i">+                    to: Address::Peer(1),
</a>                     term: 0,
                     event: Event::ClientResponse { id: vec![0x01], response: Err(Error::Abort) }
                 },
<a href="#h44-2" id="h44-2" class="h">@@ -398,11 +398,7 @@ pub mod tests {
</a>             entry: Entry { index: 1, term: 2, command: Some(vec![0xaf]) },
         })?;
         state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Local })?;
<a href="#h44-2-3" id="h44-2-3" class="d">-        state_tx.send(Instruction::Vote {
</a><a href="#h44-2-4" id="h44-2-4" class="d">-            term: 2,
</a><a href="#h44-2-5" id="h44-2-5" class="d">-            index: 1,
</a><a href="#h44-2-6" id="h44-2-6" class="d">-            address: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h44-2-7" id="h44-2-7" class="d">-        })?;
</a><a href="#h44-2-8" id="h44-2-8" class="i">+        state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Peer(1) })?;
</a>         std::mem::drop(state_tx);
 
         let node_rx = UnboundedReceiverStream::new(node_rx);
<a href="#h44-3" id="h44-3" class="h">@@ -439,11 +435,7 @@ pub mod tests {
</a>             entry: Entry { index: 1, term: 1, command: Some(vec![0xaf]) },
         })?;
         state_tx.send(Instruction::Vote { term: 2, index: 1, address: Address::Local })?;
<a href="#h44-3-3" id="h44-3-3" class="d">-        state_tx.send(Instruction::Vote {
</a><a href="#h44-3-4" id="h44-3-4" class="d">-            term: 1,
</a><a href="#h44-3-5" id="h44-3-5" class="d">-            index: 1,
</a><a href="#h44-3-6" id="h44-3-6" class="d">-            address: Address::Peer(&quot;a&quot;.into()),
</a><a href="#h44-3-7" id="h44-3-7" class="d">-        })?;
</a><a href="#h44-3-8" id="h44-3-8" class="i">+        state_tx.send(Instruction::Vote { term: 1, index: 1, address: Address::Peer(1) })?;
</a>         std::mem::drop(state_tx);
 
         let node_rx = UnboundedReceiverStream::new(node_rx);
<b>diff --git a/<a id="h45" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -26,8 +26,8 @@ pub struct Server {
</a> impl Server {
     /// Creates a new toyDB server.
     pub async fn new(
<a href="#h45-0-3" id="h45-0-3" class="d">-        id: &amp;str,
</a><a href="#h45-0-4" id="h45-0-4" class="d">-        peers: HashMap&lt;String, String&gt;,
</a><a href="#h45-0-5" id="h45-0-5" class="i">+        id: raft::NodeID,
</a><a href="#h45-0-6" id="h45-0-6" class="i">+        peers: HashMap&lt;raft::NodeID, String&gt;,
</a>         raft_log: raft::Log,
         raft_state: Box&lt;dyn raft::State&gt;,
     ) -&gt; Result&lt;Self&gt; {
<b>diff --git a/<a id="h46" href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a> b/<a href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -122,10 +122,10 @@ async fn status() -&gt; Result&lt;()&gt; {
</a>         c.status().await?,
         Status {
             raft: raft::Status {
<a href="#h46-0-3" id="h46-0-3" class="d">-                server: &quot;test&quot;.into(),
</a><a href="#h46-0-4" id="h46-0-4" class="d">-                leader: &quot;test&quot;.into(),
</a><a href="#h46-0-5" id="h46-0-5" class="i">+                server: 1,
</a><a href="#h46-0-6" id="h46-0-6" class="i">+                leader: 1,
</a>                 term: 0,
<a href="#h46-0-8" id="h46-0-8" class="d">-                node_last_index: vec![(&quot;test&quot;.to_string(), 26)].into_iter().collect(),
</a><a href="#h46-0-9" id="h46-0-9" class="i">+                node_last_index: vec![(1, 26)].into_iter().collect(),
</a>                 commit_index: 26,
                 apply_index: 26,
                 storage: &quot;bitcask&quot;.into(),
<b>diff --git a/<a id="h47" href="../file/tests/client/pool.rs.html">tests/client/pool.rs</a> b/<a href="../file/tests/client/pool.rs.html">tests/client/pool.rs</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -28,10 +28,7 @@ async fn get() -&gt; Result&lt;()&gt; {
</a>         servers.insert(client.status().await?.raft.server);
         ids.insert(client.id());
     }
<a href="#h47-0-3" id="h47-0-3" class="d">-    assert_eq!(
</a><a href="#h47-0-4" id="h47-0-4" class="d">-        servers,
</a><a href="#h47-0-5" id="h47-0-5" class="d">-        HashSet::from_iter(vec![&quot;toydb0&quot;.into(), &quot;toydb1&quot;.into(), &quot;toydb2&quot;.into()])
</a><a href="#h47-0-6" id="h47-0-6" class="d">-    );
</a><a href="#h47-0-7" id="h47-0-7" class="i">+    assert_eq!(servers, HashSet::from_iter(vec![1, 2, 3]));
</a>     assert_eq!(ids, HashSet::from_iter(vec![0, 1, 2, 3, 4]));
 
     // Further clients won&#39;t be ready
<b>diff --git a/<a id="h48" href="../file/tests/setup.rs.html">tests/setup.rs</a> b/<a href="../file/tests/setup.rs.html">tests/setup.rs</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -69,10 +69,10 @@ pub fn simple() -&gt; Vec&lt;&amp;&#39;static str&gt; {
</a> 
 /// Sets up a test server
 pub async fn server(
<a href="#h48-0-3" id="h48-0-3" class="d">-    id: &amp;str,
</a><a href="#h48-0-4" id="h48-0-4" class="i">+    id: raft::NodeID,
</a>     addr_sql: &amp;str,
     addr_raft: &amp;str,
<a href="#h48-0-7" id="h48-0-7" class="d">-    peers: HashMap&lt;String, String&gt;,
</a><a href="#h48-0-8" id="h48-0-8" class="i">+    peers: HashMap&lt;raft::NodeID, String&gt;,
</a> ) -&gt; Result&lt;Teardown&gt; {
     let dir = TempDir::new(&quot;toydb&quot;)?;
     let mut srv = Server::new(
<a href="#h48-1" id="h48-1" class="h">@@ -95,7 +95,7 @@ pub async fn server(
</a> 
 /// Sets up a server with a client
 pub async fn server_with_client(queries: Vec&lt;&amp;str&gt;) -&gt; Result&lt;(Client, Teardown)&gt; {
<a href="#h48-1-3" id="h48-1-3" class="d">-    let teardown = server(&quot;test&quot;, &quot;127.0.0.1:9605&quot;, &quot;127.0.0.1:9705&quot;, HashMap::new()).await?;
</a><a href="#h48-1-4" id="h48-1-4" class="i">+    let teardown = server(1, &quot;127.0.0.1:9605&quot;, &quot;127.0.0.1:9705&quot;, HashMap::new()).await?;
</a>     let client = Client::new(&quot;127.0.0.1:9605&quot;).await?;
     if !queries.is_empty() {
         client.execute(&quot;BEGIN&quot;).await?;
<a href="#h48-2" id="h48-2" class="h">@@ -108,29 +108,26 @@ pub async fn server_with_client(queries: Vec&lt;&amp;str&gt;) -&gt; Result&lt;(Client, Teardown)
</a> }
 
 /// Sets up a server cluster
<a href="#h48-2-3" id="h48-2-3" class="d">-pub async fn cluster(nodes: HashMap&lt;String, (String, String)&gt;) -&gt; Result&lt;Teardown&gt; {
</a><a href="#h48-2-4" id="h48-2-4" class="i">+pub async fn cluster(nodes: HashMap&lt;raft::NodeID, (String, String)&gt;) -&gt; Result&lt;Teardown&gt; {
</a>     let mut teardown = Teardown::empty();
     for (id, (addr_sql, addr_raft)) in nodes.iter() {
         let peers = nodes
             .iter()
             .filter(|(i, _)| i != &amp;id)
<a href="#h48-2-10" id="h48-2-10" class="d">-            .map(|(id, (_, raft))| (id.clone(), raft.clone()))
</a><a href="#h48-2-11" id="h48-2-11" class="i">+            .map(|(id, (_, raft))| (*id, raft.clone()))
</a>             .collect();
<a href="#h48-2-13" id="h48-2-13" class="d">-        teardown.merge(server(id, addr_sql, addr_raft, peers).await?);
</a><a href="#h48-2-14" id="h48-2-14" class="i">+        teardown.merge(server(*id, addr_sql, addr_raft, peers).await?);
</a>     }
     Ok(teardown)
 }
 
 /// Sets up a server cluster with clients
<a href="#h48-2-20" id="h48-2-20" class="d">-pub async fn cluster_with_clients(
</a><a href="#h48-2-21" id="h48-2-21" class="d">-    size: u64,
</a><a href="#h48-2-22" id="h48-2-22" class="d">-    queries: Vec&lt;&amp;str&gt;,
</a><a href="#h48-2-23" id="h48-2-23" class="d">-) -&gt; Result&lt;(Vec&lt;Client&gt;, Teardown)&gt; {
</a><a href="#h48-2-24" id="h48-2-24" class="i">+pub async fn cluster_with_clients(size: u8, queries: Vec&lt;&amp;str&gt;) -&gt; Result&lt;(Vec&lt;Client&gt;, Teardown)&gt; {
</a>     let mut nodes = HashMap::new();
<a href="#h48-2-26" id="h48-2-26" class="d">-    for i in 0..size {
</a><a href="#h48-2-27" id="h48-2-27" class="i">+    for i in 1..=size {
</a>         nodes.insert(
<a href="#h48-2-29" id="h48-2-29" class="d">-            format!(&quot;toydb{}&quot;, i),
</a><a href="#h48-2-30" id="h48-2-30" class="d">-            (format!(&quot;127.0.0.1:{}&quot;, 9605 + i), format!(&quot;127.0.0.1:{}&quot;, 9705 + i)),
</a><a href="#h48-2-31" id="h48-2-31" class="i">+            i,
</a><a href="#h48-2-32" id="h48-2-32" class="i">+            (format!(&quot;127.0.0.1:{}&quot;, 9605 + i as u64), format!(&quot;127.0.0.1:{}&quot;, 9705 + i as u64)),
</a>         );
     }
     let teardown = cluster(nodes.clone()).await?;
<a href="#h48-3" id="h48-3" class="h">@@ -156,15 +153,15 @@ pub async fn cluster_with_clients(
</a> 
 /// Sets up a server cluster with a client pool
 pub async fn cluster_with_pool(
<a href="#h48-3-3" id="h48-3-3" class="d">-    cluster_size: u64,
</a><a href="#h48-3-4" id="h48-3-4" class="i">+    cluster_size: u8,
</a>     pool_size: u64,
     queries: Vec&lt;&amp;str&gt;,
 ) -&gt; Result&lt;(Pool, Teardown)&gt; {
     let mut nodes = HashMap::new();
<a href="#h48-3-9" id="h48-3-9" class="d">-    for i in 0..cluster_size {
</a><a href="#h48-3-10" id="h48-3-10" class="i">+    for i in 1..=cluster_size {
</a>         nodes.insert(
<a href="#h48-3-12" id="h48-3-12" class="d">-            format!(&quot;toydb{}&quot;, i),
</a><a href="#h48-3-13" id="h48-3-13" class="d">-            (format!(&quot;127.0.0.1:{}&quot;, 9605 + i), format!(&quot;127.0.0.1:{}&quot;, 9705 + i)),
</a><a href="#h48-3-14" id="h48-3-14" class="i">+            i,
</a><a href="#h48-3-15" id="h48-3-15" class="i">+            (format!(&quot;127.0.0.1:{}&quot;, 9605 + i as u64), format!(&quot;127.0.0.1:{}&quot;, 9705 + i as u64)),
</a>         );
     }
     let teardown = cluster(nodes.clone()).await?;
</pre>
</div>
</body>
</html>
