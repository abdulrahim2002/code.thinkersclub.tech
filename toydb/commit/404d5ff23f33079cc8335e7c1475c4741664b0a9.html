<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: push filter nodes into join nodes - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/404d5ff23f33079cc8335e7c1475c4741664b0a9.html">404d5ff23f33079cc8335e7c1475c4741664b0a9</a>
<b>parent</b> <a href="../commit/07a69b538ef3d73e9286d69c60d81a52a24d2b86.html">07a69b538ef3d73e9286d69c60d81a52a24d2b86</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Sun, 12 Apr 2020 20:28:08 +0200

sql: push filter nodes into join nodes

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/sql/plan/optimizer.rs</a></td><td> | </td><td class="num">28</td><td><span class="i">+++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">tests/sql/query/explain</a></td><td> | </td><td class="num">184</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">tests/sql/query/join_cross_alias</a></td><td> | </td><td class="num">115</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">tests/sql/query/join_inner_on_where</a></td><td> | </td><td class="num">86</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">tests/sql/query/order_field_aliased</a></td><td> | </td><td class="num">49</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">tests/sql/query/order_field_ambiguous</a></td><td> | </td><td class="num">49</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">tests/sql/query/order_field_qualified</a></td><td> | </td><td class="num">49</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">tests/sql/query/where_field_aliased_select</a></td><td> | </td><td class="num">81</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">tests/sql/query/where_field_aliased_table</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">tests/sql/query/where_field_ambiguous</a></td><td> | </td><td class="num">65</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">tests/sql/query/where_field_qualified</a></td><td> | </td><td class="num">79</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">tests/sql/query/where_join_inner</a></td><td> | </td><td class="num">49</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
</table></pre><pre>12 files changed, 459 insertions(+), 462 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/sql/plan/optimizer.rs.html">src/sql/plan/optimizer.rs</a> b/<a href="../file/src/sql/plan/optimizer.rs.html">src/sql/plan/optimizer.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -42,25 +42,31 @@ impl Optimizer for FilterPushdown {
</a> }
 
 impl FilterPushdown {
<a href="#h0-0-3" id="h0-0-3" class="d">-    /// Attempts to push a filter down into a target node, or returns a regular filter node.
</a><a href="#h0-0-4" id="h0-0-4" class="d">-    fn pushdown(filter: Expression, target: Node) -&gt; Result&lt;Node, Error&gt; {
</a><a href="#h0-0-5" id="h0-0-5" class="i">+    /// Attempts to push a predicate down into a target node, or returns a regular filter node.
</a><a href="#h0-0-6" id="h0-0-6" class="i">+    fn pushdown(mut predicate: Expression, target: Node) -&gt; Result&lt;Node, Error&gt; {
</a>         Ok(match target {
<a href="#h0-0-8" id="h0-0-8" class="d">-            // Filter nodes immediately before a scan node without a filter can be trivially pushed
</a><a href="#h0-0-9" id="h0-0-9" class="d">-            // down, as long as we remove any qualified fields (e.g. movies table aliased as m).
</a><a href="#h0-0-10" id="h0-0-10" class="d">-            Node::Scan { table, alias, filter: None } =&gt; {
</a><a href="#h0-0-11" id="h0-0-11" class="i">+            // Filter nodes immediately before a scan node can be trivially pushed down, as long as
</a><a href="#h0-0-12" id="h0-0-12" class="i">+            // we remove any field qualifyers (e.g. movies table aliased as m).
</a><a href="#h0-0-13" id="h0-0-13" class="i">+            Node::Scan { table, alias, filter } =&gt; {
</a>                 let mut map = HashMap::new();
                 map.insert(Some(table.clone()), None);
                 if let Some(alias) = &amp;alias {
                     map.insert(Some(alias.clone()), None);
                 }
<a href="#h0-0-19" id="h0-0-19" class="d">-                Node::Scan {
</a><a href="#h0-0-20" id="h0-0-20" class="d">-                    table,
</a><a href="#h0-0-21" id="h0-0-21" class="d">-                    alias,
</a><a href="#h0-0-22" id="h0-0-22" class="d">-                    filter: Some(filter.transform(&amp;|e| Self::requalify(e, &amp;map), &amp;|e| Ok(e))?),
</a><a href="#h0-0-23" id="h0-0-23" class="i">+                predicate = predicate.transform(&amp;|e| Self::requalify(e, &amp;map), &amp;|e| Ok(e))?;
</a><a href="#h0-0-24" id="h0-0-24" class="i">+                if let Some(filter) = filter {
</a><a href="#h0-0-25" id="h0-0-25" class="i">+                    predicate = Expression::And(Box::new(predicate), Box::new(filter))
</a>                 }
<a href="#h0-0-27" id="h0-0-27" class="i">+                Node::Scan { table, alias, filter: Some(predicate) }
</a>             }
<a href="#h0-0-29" id="h0-0-29" class="d">-            // FIXME We need to handle joins.
</a><a href="#h0-0-30" id="h0-0-30" class="d">-            n =&gt; Node::Filter { predicate: filter, source: Box::new(n) },
</a><a href="#h0-0-31" id="h0-0-31" class="i">+            // Filter nodes immediately before a nested loop join can be trivially pushed down.
</a><a href="#h0-0-32" id="h0-0-32" class="i">+            Node::NestedLoopJoin { outer, inner, predicate: join_predicate, pad, flip } =&gt; {
</a><a href="#h0-0-33" id="h0-0-33" class="i">+                if let Some(join_predicate) = join_predicate {
</a><a href="#h0-0-34" id="h0-0-34" class="i">+                    predicate = Expression::And(Box::new(predicate), Box::new(join_predicate));
</a><a href="#h0-0-35" id="h0-0-35" class="i">+                }
</a><a href="#h0-0-36" id="h0-0-36" class="i">+                Node::NestedLoopJoin { outer, inner, predicate: Some(predicate), pad, flip }
</a><a href="#h0-0-37" id="h0-0-37" class="i">+            }
</a><a href="#h0-0-38" id="h0-0-38" class="i">+            n =&gt; Node::Filter { predicate, source: Box::new(n) },
</a>         })
     }
 
<b>diff --git a/<a id="h1" href="../file/tests/sql/query/explain.html">tests/sql/query/explain</a> b/<a href="../file/tests/sql/query/explain.html">tests/sql/query/explain</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -194,23 +194,51 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Explain(
         Projection {
<a href="#h1-0-3" id="h1-0-3" class="d">-            source: Filter {
</a><a href="#h1-0-4" id="h1-0-4" class="d">-                source: NestedLoopJoin {
</a><a href="#h1-0-5" id="h1-0-5" class="d">-                    outer: Scan {
</a><a href="#h1-0-6" id="h1-0-6" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h1-0-7" id="h1-0-7" class="d">-                        alias: Some(
</a><a href="#h1-0-8" id="h1-0-8" class="d">-                            &quot;m&quot;,
</a><a href="#h1-0-9" id="h1-0-9" class="d">-                        ),
</a><a href="#h1-0-10" id="h1-0-10" class="d">-                        filter: None,
</a><a href="#h1-0-11" id="h1-0-11" class="d">-                    },
</a><a href="#h1-0-12" id="h1-0-12" class="d">-                    inner: Scan {
</a><a href="#h1-0-13" id="h1-0-13" class="d">-                        table: &quot;genres&quot;,
</a><a href="#h1-0-14" id="h1-0-14" class="d">-                        alias: Some(
</a><a href="#h1-0-15" id="h1-0-15" class="d">-                            &quot;g&quot;,
</a><a href="#h1-0-16" id="h1-0-16" class="i">+            source: NestedLoopJoin {
</a><a href="#h1-0-17" id="h1-0-17" class="i">+                outer: Scan {
</a><a href="#h1-0-18" id="h1-0-18" class="i">+                    table: &quot;movies&quot;,
</a><a href="#h1-0-19" id="h1-0-19" class="i">+                    alias: Some(
</a><a href="#h1-0-20" id="h1-0-20" class="i">+                        &quot;m&quot;,
</a><a href="#h1-0-21" id="h1-0-21" class="i">+                    ),
</a><a href="#h1-0-22" id="h1-0-22" class="i">+                    filter: None,
</a><a href="#h1-0-23" id="h1-0-23" class="i">+                },
</a><a href="#h1-0-24" id="h1-0-24" class="i">+                inner: Scan {
</a><a href="#h1-0-25" id="h1-0-25" class="i">+                    table: &quot;genres&quot;,
</a><a href="#h1-0-26" id="h1-0-26" class="i">+                    alias: Some(
</a><a href="#h1-0-27" id="h1-0-27" class="i">+                        &quot;g&quot;,
</a><a href="#h1-0-28" id="h1-0-28" class="i">+                    ),
</a><a href="#h1-0-29" id="h1-0-29" class="i">+                    filter: None,
</a><a href="#h1-0-30" id="h1-0-30" class="i">+                },
</a><a href="#h1-0-31" id="h1-0-31" class="i">+                predicate: Some(
</a><a href="#h1-0-32" id="h1-0-32" class="i">+                    And(
</a><a href="#h1-0-33" id="h1-0-33" class="i">+                        Or(
</a><a href="#h1-0-34" id="h1-0-34" class="i">+                            GreaterThan(
</a><a href="#h1-0-35" id="h1-0-35" class="i">+                                Field(
</a><a href="#h1-0-36" id="h1-0-36" class="i">+                                    Some(
</a><a href="#h1-0-37" id="h1-0-37" class="i">+                                        &quot;m&quot;,
</a><a href="#h1-0-38" id="h1-0-38" class="i">+                                    ),
</a><a href="#h1-0-39" id="h1-0-39" class="i">+                                    &quot;released&quot;,
</a><a href="#h1-0-40" id="h1-0-40" class="i">+                                ),
</a><a href="#h1-0-41" id="h1-0-41" class="i">+                                Constant(
</a><a href="#h1-0-42" id="h1-0-42" class="i">+                                    Integer(
</a><a href="#h1-0-43" id="h1-0-43" class="i">+                                        2000,
</a><a href="#h1-0-44" id="h1-0-44" class="i">+                                    ),
</a><a href="#h1-0-45" id="h1-0-45" class="i">+                                ),
</a><a href="#h1-0-46" id="h1-0-46" class="i">+                            ),
</a><a href="#h1-0-47" id="h1-0-47" class="i">+                            Equal(
</a><a href="#h1-0-48" id="h1-0-48" class="i">+                                Field(
</a><a href="#h1-0-49" id="h1-0-49" class="i">+                                    Some(
</a><a href="#h1-0-50" id="h1-0-50" class="i">+                                        &quot;m&quot;,
</a><a href="#h1-0-51" id="h1-0-51" class="i">+                                    ),
</a><a href="#h1-0-52" id="h1-0-52" class="i">+                                    &quot;released&quot;,
</a><a href="#h1-0-53" id="h1-0-53" class="i">+                                ),
</a><a href="#h1-0-54" id="h1-0-54" class="i">+                                Constant(
</a><a href="#h1-0-55" id="h1-0-55" class="i">+                                    Integer(
</a><a href="#h1-0-56" id="h1-0-56" class="i">+                                        2000,
</a><a href="#h1-0-57" id="h1-0-57" class="i">+                                    ),
</a><a href="#h1-0-58" id="h1-0-58" class="i">+                                ),
</a><a href="#h1-0-59" id="h1-0-59" class="i">+                            ),
</a>                         ),
<a href="#h1-0-61" id="h1-0-61" class="d">-                        filter: None,
</a><a href="#h1-0-62" id="h1-0-62" class="d">-                    },
</a><a href="#h1-0-63" id="h1-0-63" class="d">-                    predicate: Some(
</a>                         Equal(
                             Field(
                                 Some(
<a href="#h1-1" id="h1-1" class="h">@@ -226,37 +254,9 @@ Optimized plan: Plan(
</a>                             ),
                         ),
                     ),
<a href="#h1-1-3" id="h1-1-3" class="d">-                    pad: false,
</a><a href="#h1-1-4" id="h1-1-4" class="d">-                    flip: false,
</a><a href="#h1-1-5" id="h1-1-5" class="d">-                },
</a><a href="#h1-1-6" id="h1-1-6" class="d">-                predicate: Or(
</a><a href="#h1-1-7" id="h1-1-7" class="d">-                    GreaterThan(
</a><a href="#h1-1-8" id="h1-1-8" class="d">-                        Field(
</a><a href="#h1-1-9" id="h1-1-9" class="d">-                            Some(
</a><a href="#h1-1-10" id="h1-1-10" class="d">-                                &quot;m&quot;,
</a><a href="#h1-1-11" id="h1-1-11" class="d">-                            ),
</a><a href="#h1-1-12" id="h1-1-12" class="d">-                            &quot;released&quot;,
</a><a href="#h1-1-13" id="h1-1-13" class="d">-                        ),
</a><a href="#h1-1-14" id="h1-1-14" class="d">-                        Constant(
</a><a href="#h1-1-15" id="h1-1-15" class="d">-                            Integer(
</a><a href="#h1-1-16" id="h1-1-16" class="d">-                                2000,
</a><a href="#h1-1-17" id="h1-1-17" class="d">-                            ),
</a><a href="#h1-1-18" id="h1-1-18" class="d">-                        ),
</a><a href="#h1-1-19" id="h1-1-19" class="d">-                    ),
</a><a href="#h1-1-20" id="h1-1-20" class="d">-                    Equal(
</a><a href="#h1-1-21" id="h1-1-21" class="d">-                        Field(
</a><a href="#h1-1-22" id="h1-1-22" class="d">-                            Some(
</a><a href="#h1-1-23" id="h1-1-23" class="d">-                                &quot;m&quot;,
</a><a href="#h1-1-24" id="h1-1-24" class="d">-                            ),
</a><a href="#h1-1-25" id="h1-1-25" class="d">-                            &quot;released&quot;,
</a><a href="#h1-1-26" id="h1-1-26" class="d">-                        ),
</a><a href="#h1-1-27" id="h1-1-27" class="d">-                        Constant(
</a><a href="#h1-1-28" id="h1-1-28" class="d">-                            Integer(
</a><a href="#h1-1-29" id="h1-1-29" class="d">-                                2000,
</a><a href="#h1-1-30" id="h1-1-30" class="d">-                            ),
</a><a href="#h1-1-31" id="h1-1-31" class="d">-                        ),
</a><a href="#h1-1-32" id="h1-1-32" class="d">-                    ),
</a>                 ),
<a href="#h1-1-34" id="h1-1-34" class="i">+                pad: false,
</a><a href="#h1-1-35" id="h1-1-35" class="i">+                flip: false,
</a>             },
             labels: [
                 None,
<a href="#h1-2" id="h1-2" class="h">@@ -290,23 +290,51 @@ Optimized plan: Plan(
</a> Query: EXPLAIN SELECT m.id, m.title, g.name FROM movies m JOIN GENRES g ON m.genre_id = g.id WHERE m.released &gt;= 2000
 
 Result: Projection {
<a href="#h1-2-3" id="h1-2-3" class="d">-    source: Filter {
</a><a href="#h1-2-4" id="h1-2-4" class="d">-        source: NestedLoopJoin {
</a><a href="#h1-2-5" id="h1-2-5" class="d">-            outer: Scan {
</a><a href="#h1-2-6" id="h1-2-6" class="d">-                table: &quot;movies&quot;,
</a><a href="#h1-2-7" id="h1-2-7" class="d">-                alias: Some(
</a><a href="#h1-2-8" id="h1-2-8" class="d">-                    &quot;m&quot;,
</a><a href="#h1-2-9" id="h1-2-9" class="d">-                ),
</a><a href="#h1-2-10" id="h1-2-10" class="d">-                filter: None,
</a><a href="#h1-2-11" id="h1-2-11" class="d">-            },
</a><a href="#h1-2-12" id="h1-2-12" class="d">-            inner: Scan {
</a><a href="#h1-2-13" id="h1-2-13" class="d">-                table: &quot;genres&quot;,
</a><a href="#h1-2-14" id="h1-2-14" class="d">-                alias: Some(
</a><a href="#h1-2-15" id="h1-2-15" class="d">-                    &quot;g&quot;,
</a><a href="#h1-2-16" id="h1-2-16" class="i">+    source: NestedLoopJoin {
</a><a href="#h1-2-17" id="h1-2-17" class="i">+        outer: Scan {
</a><a href="#h1-2-18" id="h1-2-18" class="i">+            table: &quot;movies&quot;,
</a><a href="#h1-2-19" id="h1-2-19" class="i">+            alias: Some(
</a><a href="#h1-2-20" id="h1-2-20" class="i">+                &quot;m&quot;,
</a><a href="#h1-2-21" id="h1-2-21" class="i">+            ),
</a><a href="#h1-2-22" id="h1-2-22" class="i">+            filter: None,
</a><a href="#h1-2-23" id="h1-2-23" class="i">+        },
</a><a href="#h1-2-24" id="h1-2-24" class="i">+        inner: Scan {
</a><a href="#h1-2-25" id="h1-2-25" class="i">+            table: &quot;genres&quot;,
</a><a href="#h1-2-26" id="h1-2-26" class="i">+            alias: Some(
</a><a href="#h1-2-27" id="h1-2-27" class="i">+                &quot;g&quot;,
</a><a href="#h1-2-28" id="h1-2-28" class="i">+            ),
</a><a href="#h1-2-29" id="h1-2-29" class="i">+            filter: None,
</a><a href="#h1-2-30" id="h1-2-30" class="i">+        },
</a><a href="#h1-2-31" id="h1-2-31" class="i">+        predicate: Some(
</a><a href="#h1-2-32" id="h1-2-32" class="i">+            And(
</a><a href="#h1-2-33" id="h1-2-33" class="i">+                Or(
</a><a href="#h1-2-34" id="h1-2-34" class="i">+                    GreaterThan(
</a><a href="#h1-2-35" id="h1-2-35" class="i">+                        Field(
</a><a href="#h1-2-36" id="h1-2-36" class="i">+                            Some(
</a><a href="#h1-2-37" id="h1-2-37" class="i">+                                &quot;m&quot;,
</a><a href="#h1-2-38" id="h1-2-38" class="i">+                            ),
</a><a href="#h1-2-39" id="h1-2-39" class="i">+                            &quot;released&quot;,
</a><a href="#h1-2-40" id="h1-2-40" class="i">+                        ),
</a><a href="#h1-2-41" id="h1-2-41" class="i">+                        Constant(
</a><a href="#h1-2-42" id="h1-2-42" class="i">+                            Integer(
</a><a href="#h1-2-43" id="h1-2-43" class="i">+                                2000,
</a><a href="#h1-2-44" id="h1-2-44" class="i">+                            ),
</a><a href="#h1-2-45" id="h1-2-45" class="i">+                        ),
</a><a href="#h1-2-46" id="h1-2-46" class="i">+                    ),
</a><a href="#h1-2-47" id="h1-2-47" class="i">+                    Equal(
</a><a href="#h1-2-48" id="h1-2-48" class="i">+                        Field(
</a><a href="#h1-2-49" id="h1-2-49" class="i">+                            Some(
</a><a href="#h1-2-50" id="h1-2-50" class="i">+                                &quot;m&quot;,
</a><a href="#h1-2-51" id="h1-2-51" class="i">+                            ),
</a><a href="#h1-2-52" id="h1-2-52" class="i">+                            &quot;released&quot;,
</a><a href="#h1-2-53" id="h1-2-53" class="i">+                        ),
</a><a href="#h1-2-54" id="h1-2-54" class="i">+                        Constant(
</a><a href="#h1-2-55" id="h1-2-55" class="i">+                            Integer(
</a><a href="#h1-2-56" id="h1-2-56" class="i">+                                2000,
</a><a href="#h1-2-57" id="h1-2-57" class="i">+                            ),
</a><a href="#h1-2-58" id="h1-2-58" class="i">+                        ),
</a><a href="#h1-2-59" id="h1-2-59" class="i">+                    ),
</a>                 ),
<a href="#h1-2-61" id="h1-2-61" class="d">-                filter: None,
</a><a href="#h1-2-62" id="h1-2-62" class="d">-            },
</a><a href="#h1-2-63" id="h1-2-63" class="d">-            predicate: Some(
</a>                 Equal(
                     Field(
                         Some(
<a href="#h1-3" id="h1-3" class="h">@@ -322,37 +350,9 @@ Result: Projection {
</a>                     ),
                 ),
             ),
<a href="#h1-3-3" id="h1-3-3" class="d">-            pad: false,
</a><a href="#h1-3-4" id="h1-3-4" class="d">-            flip: false,
</a><a href="#h1-3-5" id="h1-3-5" class="d">-        },
</a><a href="#h1-3-6" id="h1-3-6" class="d">-        predicate: Or(
</a><a href="#h1-3-7" id="h1-3-7" class="d">-            GreaterThan(
</a><a href="#h1-3-8" id="h1-3-8" class="d">-                Field(
</a><a href="#h1-3-9" id="h1-3-9" class="d">-                    Some(
</a><a href="#h1-3-10" id="h1-3-10" class="d">-                        &quot;m&quot;,
</a><a href="#h1-3-11" id="h1-3-11" class="d">-                    ),
</a><a href="#h1-3-12" id="h1-3-12" class="d">-                    &quot;released&quot;,
</a><a href="#h1-3-13" id="h1-3-13" class="d">-                ),
</a><a href="#h1-3-14" id="h1-3-14" class="d">-                Constant(
</a><a href="#h1-3-15" id="h1-3-15" class="d">-                    Integer(
</a><a href="#h1-3-16" id="h1-3-16" class="d">-                        2000,
</a><a href="#h1-3-17" id="h1-3-17" class="d">-                    ),
</a><a href="#h1-3-18" id="h1-3-18" class="d">-                ),
</a><a href="#h1-3-19" id="h1-3-19" class="d">-            ),
</a><a href="#h1-3-20" id="h1-3-20" class="d">-            Equal(
</a><a href="#h1-3-21" id="h1-3-21" class="d">-                Field(
</a><a href="#h1-3-22" id="h1-3-22" class="d">-                    Some(
</a><a href="#h1-3-23" id="h1-3-23" class="d">-                        &quot;m&quot;,
</a><a href="#h1-3-24" id="h1-3-24" class="d">-                    ),
</a><a href="#h1-3-25" id="h1-3-25" class="d">-                    &quot;released&quot;,
</a><a href="#h1-3-26" id="h1-3-26" class="d">-                ),
</a><a href="#h1-3-27" id="h1-3-27" class="d">-                Constant(
</a><a href="#h1-3-28" id="h1-3-28" class="d">-                    Integer(
</a><a href="#h1-3-29" id="h1-3-29" class="d">-                        2000,
</a><a href="#h1-3-30" id="h1-3-30" class="d">-                    ),
</a><a href="#h1-3-31" id="h1-3-31" class="d">-                ),
</a><a href="#h1-3-32" id="h1-3-32" class="d">-            ),
</a>         ),
<a href="#h1-3-34" id="h1-3-34" class="i">+        pad: false,
</a><a href="#h1-3-35" id="h1-3-35" class="i">+        flip: false,
</a>     },
     labels: [
         None,
<b>diff --git a/<a id="h2" href="../file/tests/sql/query/join_cross_alias.html">tests/sql/query/join_cross_alias</a> b/<a href="../file/tests/sql/query/join_cross_alias.html">tests/sql/query/join_cross_alias</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -295,31 +295,19 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Projection {
<a href="#h2-0-3" id="h2-0-3" class="d">-        source: Filter {
</a><a href="#h2-0-4" id="h2-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h2-0-5" id="h2-0-5" class="d">-                outer: NestedLoopJoin {
</a><a href="#h2-0-6" id="h2-0-6" class="d">-                    outer: Scan {
</a><a href="#h2-0-7" id="h2-0-7" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h2-0-8" id="h2-0-8" class="d">-                        alias: Some(
</a><a href="#h2-0-9" id="h2-0-9" class="d">-                            &quot;m&quot;,
</a><a href="#h2-0-10" id="h2-0-10" class="d">-                        ),
</a><a href="#h2-0-11" id="h2-0-11" class="d">-                        filter: None,
</a><a href="#h2-0-12" id="h2-0-12" class="d">-                    },
</a><a href="#h2-0-13" id="h2-0-13" class="d">-                    inner: Scan {
</a><a href="#h2-0-14" id="h2-0-14" class="d">-                        table: &quot;genres&quot;,
</a><a href="#h2-0-15" id="h2-0-15" class="d">-                        alias: Some(
</a><a href="#h2-0-16" id="h2-0-16" class="d">-                            &quot;g&quot;,
</a><a href="#h2-0-17" id="h2-0-17" class="d">-                        ),
</a><a href="#h2-0-18" id="h2-0-18" class="d">-                        filter: None,
</a><a href="#h2-0-19" id="h2-0-19" class="d">-                    },
</a><a href="#h2-0-20" id="h2-0-20" class="d">-                    predicate: None,
</a><a href="#h2-0-21" id="h2-0-21" class="d">-                    pad: false,
</a><a href="#h2-0-22" id="h2-0-22" class="d">-                    flip: false,
</a><a href="#h2-0-23" id="h2-0-23" class="i">+        source: NestedLoopJoin {
</a><a href="#h2-0-24" id="h2-0-24" class="i">+            outer: NestedLoopJoin {
</a><a href="#h2-0-25" id="h2-0-25" class="i">+                outer: Scan {
</a><a href="#h2-0-26" id="h2-0-26" class="i">+                    table: &quot;movies&quot;,
</a><a href="#h2-0-27" id="h2-0-27" class="i">+                    alias: Some(
</a><a href="#h2-0-28" id="h2-0-28" class="i">+                        &quot;m&quot;,
</a><a href="#h2-0-29" id="h2-0-29" class="i">+                    ),
</a><a href="#h2-0-30" id="h2-0-30" class="i">+                    filter: None,
</a>                 },
                 inner: Scan {
<a href="#h2-0-33" id="h2-0-33" class="d">-                    table: &quot;countries&quot;,
</a><a href="#h2-0-34" id="h2-0-34" class="i">+                    table: &quot;genres&quot;,
</a>                     alias: Some(
<a href="#h2-0-36" id="h2-0-36" class="d">-                        &quot;c&quot;,
</a><a href="#h2-0-37" id="h2-0-37" class="i">+                        &quot;g&quot;,
</a>                     ),
                     filter: None,
                 },
<a href="#h2-1" id="h2-1" class="h">@@ -327,66 +315,77 @@ Optimized plan: Plan(
</a>                 pad: false,
                 flip: false,
             },
<a href="#h2-1-3" id="h2-1-3" class="d">-            predicate: And(
</a><a href="#h2-1-4" id="h2-1-4" class="i">+            inner: Scan {
</a><a href="#h2-1-5" id="h2-1-5" class="i">+                table: &quot;countries&quot;,
</a><a href="#h2-1-6" id="h2-1-6" class="i">+                alias: Some(
</a><a href="#h2-1-7" id="h2-1-7" class="i">+                    &quot;c&quot;,
</a><a href="#h2-1-8" id="h2-1-8" class="i">+                ),
</a><a href="#h2-1-9" id="h2-1-9" class="i">+                filter: None,
</a><a href="#h2-1-10" id="h2-1-10" class="i">+            },
</a><a href="#h2-1-11" id="h2-1-11" class="i">+            predicate: Some(
</a>                 And(
<a href="#h2-1-13" id="h2-1-13" class="d">-                    Or(
</a><a href="#h2-1-14" id="h2-1-14" class="d">-                        GreaterThan(
</a><a href="#h2-1-15" id="h2-1-15" class="d">-                            Field(
</a><a href="#h2-1-16" id="h2-1-16" class="d">-                                Some(
</a><a href="#h2-1-17" id="h2-1-17" class="d">-                                    &quot;m&quot;,
</a><a href="#h2-1-18" id="h2-1-18" class="i">+                    And(
</a><a href="#h2-1-19" id="h2-1-19" class="i">+                        Or(
</a><a href="#h2-1-20" id="h2-1-20" class="i">+                            GreaterThan(
</a><a href="#h2-1-21" id="h2-1-21" class="i">+                                Field(
</a><a href="#h2-1-22" id="h2-1-22" class="i">+                                    Some(
</a><a href="#h2-1-23" id="h2-1-23" class="i">+                                        &quot;m&quot;,
</a><a href="#h2-1-24" id="h2-1-24" class="i">+                                    ),
</a><a href="#h2-1-25" id="h2-1-25" class="i">+                                    &quot;id&quot;,
</a><a href="#h2-1-26" id="h2-1-26" class="i">+                                ),
</a><a href="#h2-1-27" id="h2-1-27" class="i">+                                Constant(
</a><a href="#h2-1-28" id="h2-1-28" class="i">+                                    Integer(
</a><a href="#h2-1-29" id="h2-1-29" class="i">+                                        3,
</a><a href="#h2-1-30" id="h2-1-30" class="i">+                                    ),
</a>                                 ),
<a href="#h2-1-32" id="h2-1-32" class="d">-                                &quot;id&quot;,
</a>                             ),
<a href="#h2-1-34" id="h2-1-34" class="d">-                            Constant(
</a><a href="#h2-1-35" id="h2-1-35" class="d">-                                Integer(
</a><a href="#h2-1-36" id="h2-1-36" class="d">-                                    3,
</a><a href="#h2-1-37" id="h2-1-37" class="i">+                            Equal(
</a><a href="#h2-1-38" id="h2-1-38" class="i">+                                Field(
</a><a href="#h2-1-39" id="h2-1-39" class="i">+                                    Some(
</a><a href="#h2-1-40" id="h2-1-40" class="i">+                                        &quot;m&quot;,
</a><a href="#h2-1-41" id="h2-1-41" class="i">+                                    ),
</a><a href="#h2-1-42" id="h2-1-42" class="i">+                                    &quot;id&quot;,
</a><a href="#h2-1-43" id="h2-1-43" class="i">+                                ),
</a><a href="#h2-1-44" id="h2-1-44" class="i">+                                Constant(
</a><a href="#h2-1-45" id="h2-1-45" class="i">+                                    Integer(
</a><a href="#h2-1-46" id="h2-1-46" class="i">+                                        3,
</a><a href="#h2-1-47" id="h2-1-47" class="i">+                                    ),
</a>                                 ),
                             ),
                         ),
                         Equal(
                             Field(
                                 Some(
<a href="#h2-1-54" id="h2-1-54" class="d">-                                    &quot;m&quot;,
</a><a href="#h2-1-55" id="h2-1-55" class="i">+                                    &quot;g&quot;,
</a>                                 ),
                                 &quot;id&quot;,
                             ),
                             Constant(
                                 Integer(
<a href="#h2-1-61" id="h2-1-61" class="d">-                                    3,
</a><a href="#h2-1-62" id="h2-1-62" class="i">+                                    2,
</a>                                 ),
                             ),
                         ),
                     ),
<a href="#h2-1-67" id="h2-1-67" class="d">-                    Equal(
</a><a href="#h2-1-68" id="h2-1-68" class="d">-                        Field(
</a><a href="#h2-1-69" id="h2-1-69" class="d">-                            Some(
</a><a href="#h2-1-70" id="h2-1-70" class="d">-                                &quot;g&quot;,
</a><a href="#h2-1-71" id="h2-1-71" class="d">-                            ),
</a><a href="#h2-1-72" id="h2-1-72" class="d">-                            &quot;id&quot;,
</a><a href="#h2-1-73" id="h2-1-73" class="d">-                        ),
</a><a href="#h2-1-74" id="h2-1-74" class="d">-                        Constant(
</a><a href="#h2-1-75" id="h2-1-75" class="d">-                            Integer(
</a><a href="#h2-1-76" id="h2-1-76" class="d">-                                2,
</a><a href="#h2-1-77" id="h2-1-77" class="d">-                            ),
</a><a href="#h2-1-78" id="h2-1-78" class="d">-                        ),
</a><a href="#h2-1-79" id="h2-1-79" class="d">-                    ),
</a><a href="#h2-1-80" id="h2-1-80" class="d">-                ),
</a><a href="#h2-1-81" id="h2-1-81" class="d">-                Not(
</a><a href="#h2-1-82" id="h2-1-82" class="d">-                    Equal(
</a><a href="#h2-1-83" id="h2-1-83" class="d">-                        Field(
</a><a href="#h2-1-84" id="h2-1-84" class="d">-                            Some(
</a><a href="#h2-1-85" id="h2-1-85" class="d">-                                &quot;c&quot;,
</a><a href="#h2-1-86" id="h2-1-86" class="i">+                    Not(
</a><a href="#h2-1-87" id="h2-1-87" class="i">+                        Equal(
</a><a href="#h2-1-88" id="h2-1-88" class="i">+                            Field(
</a><a href="#h2-1-89" id="h2-1-89" class="i">+                                Some(
</a><a href="#h2-1-90" id="h2-1-90" class="i">+                                    &quot;c&quot;,
</a><a href="#h2-1-91" id="h2-1-91" class="i">+                                ),
</a><a href="#h2-1-92" id="h2-1-92" class="i">+                                &quot;id&quot;,
</a>                             ),
<a href="#h2-1-94" id="h2-1-94" class="d">-                            &quot;id&quot;,
</a><a href="#h2-1-95" id="h2-1-95" class="d">-                        ),
</a><a href="#h2-1-96" id="h2-1-96" class="d">-                        Constant(
</a><a href="#h2-1-97" id="h2-1-97" class="d">-                            String(
</a><a href="#h2-1-98" id="h2-1-98" class="d">-                                &quot;us&quot;,
</a><a href="#h2-1-99" id="h2-1-99" class="i">+                            Constant(
</a><a href="#h2-1-100" id="h2-1-100" class="i">+                                String(
</a><a href="#h2-1-101" id="h2-1-101" class="i">+                                    &quot;us&quot;,
</a><a href="#h2-1-102" id="h2-1-102" class="i">+                                ),
</a>                             ),
                         ),
                     ),
                 ),
             ),
<a href="#h2-1-108" id="h2-1-108" class="i">+            pad: false,
</a><a href="#h2-1-109" id="h2-1-109" class="i">+            flip: false,
</a>         },
         labels: [
             None,
<b>diff --git a/<a id="h3" href="../file/tests/sql/query/join_inner_on_where.html">tests/sql/query/join_inner_on_where</a> b/<a href="../file/tests/sql/query/join_inner_on_where.html">tests/sql/query/join_inner_on_where</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -130,19 +130,47 @@ Plan: Plan(
</a> )
 
 Optimized plan: Plan(
<a href="#h3-0-3" id="h3-0-3" class="d">-    Filter {
</a><a href="#h3-0-4" id="h3-0-4" class="d">-        source: NestedLoopJoin {
</a><a href="#h3-0-5" id="h3-0-5" class="d">-            outer: Scan {
</a><a href="#h3-0-6" id="h3-0-6" class="d">-                table: &quot;movies&quot;,
</a><a href="#h3-0-7" id="h3-0-7" class="d">-                alias: None,
</a><a href="#h3-0-8" id="h3-0-8" class="d">-                filter: None,
</a><a href="#h3-0-9" id="h3-0-9" class="d">-            },
</a><a href="#h3-0-10" id="h3-0-10" class="d">-            inner: Scan {
</a><a href="#h3-0-11" id="h3-0-11" class="d">-                table: &quot;genres&quot;,
</a><a href="#h3-0-12" id="h3-0-12" class="d">-                alias: None,
</a><a href="#h3-0-13" id="h3-0-13" class="d">-                filter: None,
</a><a href="#h3-0-14" id="h3-0-14" class="d">-            },
</a><a href="#h3-0-15" id="h3-0-15" class="d">-            predicate: Some(
</a><a href="#h3-0-16" id="h3-0-16" class="i">+    NestedLoopJoin {
</a><a href="#h3-0-17" id="h3-0-17" class="i">+        outer: Scan {
</a><a href="#h3-0-18" id="h3-0-18" class="i">+            table: &quot;movies&quot;,
</a><a href="#h3-0-19" id="h3-0-19" class="i">+            alias: None,
</a><a href="#h3-0-20" id="h3-0-20" class="i">+            filter: None,
</a><a href="#h3-0-21" id="h3-0-21" class="i">+        },
</a><a href="#h3-0-22" id="h3-0-22" class="i">+        inner: Scan {
</a><a href="#h3-0-23" id="h3-0-23" class="i">+            table: &quot;genres&quot;,
</a><a href="#h3-0-24" id="h3-0-24" class="i">+            alias: None,
</a><a href="#h3-0-25" id="h3-0-25" class="i">+            filter: None,
</a><a href="#h3-0-26" id="h3-0-26" class="i">+        },
</a><a href="#h3-0-27" id="h3-0-27" class="i">+        predicate: Some(
</a><a href="#h3-0-28" id="h3-0-28" class="i">+            And(
</a><a href="#h3-0-29" id="h3-0-29" class="i">+                Or(
</a><a href="#h3-0-30" id="h3-0-30" class="i">+                    GreaterThan(
</a><a href="#h3-0-31" id="h3-0-31" class="i">+                        Field(
</a><a href="#h3-0-32" id="h3-0-32" class="i">+                            Some(
</a><a href="#h3-0-33" id="h3-0-33" class="i">+                                &quot;movies&quot;,
</a><a href="#h3-0-34" id="h3-0-34" class="i">+                            ),
</a><a href="#h3-0-35" id="h3-0-35" class="i">+                            &quot;id&quot;,
</a><a href="#h3-0-36" id="h3-0-36" class="i">+                        ),
</a><a href="#h3-0-37" id="h3-0-37" class="i">+                        Constant(
</a><a href="#h3-0-38" id="h3-0-38" class="i">+                            Integer(
</a><a href="#h3-0-39" id="h3-0-39" class="i">+                                3,
</a><a href="#h3-0-40" id="h3-0-40" class="i">+                            ),
</a><a href="#h3-0-41" id="h3-0-41" class="i">+                        ),
</a><a href="#h3-0-42" id="h3-0-42" class="i">+                    ),
</a><a href="#h3-0-43" id="h3-0-43" class="i">+                    Equal(
</a><a href="#h3-0-44" id="h3-0-44" class="i">+                        Field(
</a><a href="#h3-0-45" id="h3-0-45" class="i">+                            Some(
</a><a href="#h3-0-46" id="h3-0-46" class="i">+                                &quot;movies&quot;,
</a><a href="#h3-0-47" id="h3-0-47" class="i">+                            ),
</a><a href="#h3-0-48" id="h3-0-48" class="i">+                            &quot;id&quot;,
</a><a href="#h3-0-49" id="h3-0-49" class="i">+                        ),
</a><a href="#h3-0-50" id="h3-0-50" class="i">+                        Constant(
</a><a href="#h3-0-51" id="h3-0-51" class="i">+                            Integer(
</a><a href="#h3-0-52" id="h3-0-52" class="i">+                                3,
</a><a href="#h3-0-53" id="h3-0-53" class="i">+                            ),
</a><a href="#h3-0-54" id="h3-0-54" class="i">+                        ),
</a><a href="#h3-0-55" id="h3-0-55" class="i">+                    ),
</a><a href="#h3-0-56" id="h3-0-56" class="i">+                ),
</a>                 Equal(
                     Field(
                         Some(
<a href="#h3-1" id="h3-1" class="h">@@ -158,37 +186,9 @@ Optimized plan: Plan(
</a>                     ),
                 ),
             ),
<a href="#h3-1-3" id="h3-1-3" class="d">-            pad: false,
</a><a href="#h3-1-4" id="h3-1-4" class="d">-            flip: false,
</a><a href="#h3-1-5" id="h3-1-5" class="d">-        },
</a><a href="#h3-1-6" id="h3-1-6" class="d">-        predicate: Or(
</a><a href="#h3-1-7" id="h3-1-7" class="d">-            GreaterThan(
</a><a href="#h3-1-8" id="h3-1-8" class="d">-                Field(
</a><a href="#h3-1-9" id="h3-1-9" class="d">-                    Some(
</a><a href="#h3-1-10" id="h3-1-10" class="d">-                        &quot;movies&quot;,
</a><a href="#h3-1-11" id="h3-1-11" class="d">-                    ),
</a><a href="#h3-1-12" id="h3-1-12" class="d">-                    &quot;id&quot;,
</a><a href="#h3-1-13" id="h3-1-13" class="d">-                ),
</a><a href="#h3-1-14" id="h3-1-14" class="d">-                Constant(
</a><a href="#h3-1-15" id="h3-1-15" class="d">-                    Integer(
</a><a href="#h3-1-16" id="h3-1-16" class="d">-                        3,
</a><a href="#h3-1-17" id="h3-1-17" class="d">-                    ),
</a><a href="#h3-1-18" id="h3-1-18" class="d">-                ),
</a><a href="#h3-1-19" id="h3-1-19" class="d">-            ),
</a><a href="#h3-1-20" id="h3-1-20" class="d">-            Equal(
</a><a href="#h3-1-21" id="h3-1-21" class="d">-                Field(
</a><a href="#h3-1-22" id="h3-1-22" class="d">-                    Some(
</a><a href="#h3-1-23" id="h3-1-23" class="d">-                        &quot;movies&quot;,
</a><a href="#h3-1-24" id="h3-1-24" class="d">-                    ),
</a><a href="#h3-1-25" id="h3-1-25" class="d">-                    &quot;id&quot;,
</a><a href="#h3-1-26" id="h3-1-26" class="d">-                ),
</a><a href="#h3-1-27" id="h3-1-27" class="d">-                Constant(
</a><a href="#h3-1-28" id="h3-1-28" class="d">-                    Integer(
</a><a href="#h3-1-29" id="h3-1-29" class="d">-                        3,
</a><a href="#h3-1-30" id="h3-1-30" class="d">-                    ),
</a><a href="#h3-1-31" id="h3-1-31" class="d">-                ),
</a><a href="#h3-1-32" id="h3-1-32" class="d">-            ),
</a>         ),
<a href="#h3-1-34" id="h3-1-34" class="i">+        pad: false,
</a><a href="#h3-1-35" id="h3-1-35" class="i">+        flip: false,
</a>     },
 )
 
<b>diff --git a/<a id="h4" href="../file/tests/sql/query/order_field_aliased.html">tests/sql/query/order_field_aliased</a> b/<a href="../file/tests/sql/query/order_field_aliased.html">tests/sql/query/order_field_aliased</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -166,36 +166,35 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Order {
         source: Projection {
<a href="#h4-0-3" id="h4-0-3" class="d">-            source: Filter {
</a><a href="#h4-0-4" id="h4-0-4" class="d">-                source: NestedLoopJoin {
</a><a href="#h4-0-5" id="h4-0-5" class="d">-                    outer: Scan {
</a><a href="#h4-0-6" id="h4-0-6" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h4-0-7" id="h4-0-7" class="d">-                        alias: None,
</a><a href="#h4-0-8" id="h4-0-8" class="d">-                        filter: None,
</a><a href="#h4-0-9" id="h4-0-9" class="d">-                    },
</a><a href="#h4-0-10" id="h4-0-10" class="d">-                    inner: Scan {
</a><a href="#h4-0-11" id="h4-0-11" class="d">-                        table: &quot;genres&quot;,
</a><a href="#h4-0-12" id="h4-0-12" class="d">-                        alias: None,
</a><a href="#h4-0-13" id="h4-0-13" class="d">-                        filter: None,
</a><a href="#h4-0-14" id="h4-0-14" class="d">-                    },
</a><a href="#h4-0-15" id="h4-0-15" class="d">-                    predicate: None,
</a><a href="#h4-0-16" id="h4-0-16" class="d">-                    pad: false,
</a><a href="#h4-0-17" id="h4-0-17" class="d">-                    flip: false,
</a><a href="#h4-0-18" id="h4-0-18" class="i">+            source: NestedLoopJoin {
</a><a href="#h4-0-19" id="h4-0-19" class="i">+                outer: Scan {
</a><a href="#h4-0-20" id="h4-0-20" class="i">+                    table: &quot;movies&quot;,
</a><a href="#h4-0-21" id="h4-0-21" class="i">+                    alias: None,
</a><a href="#h4-0-22" id="h4-0-22" class="i">+                    filter: None,
</a>                 },
<a href="#h4-0-24" id="h4-0-24" class="d">-                predicate: Equal(
</a><a href="#h4-0-25" id="h4-0-25" class="d">-                    Field(
</a><a href="#h4-0-26" id="h4-0-26" class="d">-                        Some(
</a><a href="#h4-0-27" id="h4-0-27" class="d">-                            &quot;movies&quot;,
</a><a href="#h4-0-28" id="h4-0-28" class="i">+                inner: Scan {
</a><a href="#h4-0-29" id="h4-0-29" class="i">+                    table: &quot;genres&quot;,
</a><a href="#h4-0-30" id="h4-0-30" class="i">+                    alias: None,
</a><a href="#h4-0-31" id="h4-0-31" class="i">+                    filter: None,
</a><a href="#h4-0-32" id="h4-0-32" class="i">+                },
</a><a href="#h4-0-33" id="h4-0-33" class="i">+                predicate: Some(
</a><a href="#h4-0-34" id="h4-0-34" class="i">+                    Equal(
</a><a href="#h4-0-35" id="h4-0-35" class="i">+                        Field(
</a><a href="#h4-0-36" id="h4-0-36" class="i">+                            Some(
</a><a href="#h4-0-37" id="h4-0-37" class="i">+                                &quot;movies&quot;,
</a><a href="#h4-0-38" id="h4-0-38" class="i">+                            ),
</a><a href="#h4-0-39" id="h4-0-39" class="i">+                            &quot;genre_id&quot;,
</a>                         ),
<a href="#h4-0-41" id="h4-0-41" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h4-0-42" id="h4-0-42" class="d">-                    ),
</a><a href="#h4-0-43" id="h4-0-43" class="d">-                    Field(
</a><a href="#h4-0-44" id="h4-0-44" class="d">-                        Some(
</a><a href="#h4-0-45" id="h4-0-45" class="d">-                            &quot;genres&quot;,
</a><a href="#h4-0-46" id="h4-0-46" class="i">+                        Field(
</a><a href="#h4-0-47" id="h4-0-47" class="i">+                            Some(
</a><a href="#h4-0-48" id="h4-0-48" class="i">+                                &quot;genres&quot;,
</a><a href="#h4-0-49" id="h4-0-49" class="i">+                            ),
</a><a href="#h4-0-50" id="h4-0-50" class="i">+                            &quot;id&quot;,
</a>                         ),
<a href="#h4-0-52" id="h4-0-52" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
<a href="#h4-0-55" id="h4-0-55" class="i">+                pad: false,
</a><a href="#h4-0-56" id="h4-0-56" class="i">+                flip: false,
</a>             },
             labels: [
                 None,
<b>diff --git a/<a id="h5" href="../file/tests/sql/query/order_field_ambiguous.html">tests/sql/query/order_field_ambiguous</a> b/<a href="../file/tests/sql/query/order_field_ambiguous.html">tests/sql/query/order_field_ambiguous</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -101,36 +101,35 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Order {
<a href="#h5-0-3" id="h5-0-3" class="d">-        source: Filter {
</a><a href="#h5-0-4" id="h5-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h5-0-5" id="h5-0-5" class="d">-                outer: Scan {
</a><a href="#h5-0-6" id="h5-0-6" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h5-0-7" id="h5-0-7" class="d">-                    alias: None,
</a><a href="#h5-0-8" id="h5-0-8" class="d">-                    filter: None,
</a><a href="#h5-0-9" id="h5-0-9" class="d">-                },
</a><a href="#h5-0-10" id="h5-0-10" class="d">-                inner: Scan {
</a><a href="#h5-0-11" id="h5-0-11" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h5-0-12" id="h5-0-12" class="d">-                    alias: None,
</a><a href="#h5-0-13" id="h5-0-13" class="d">-                    filter: None,
</a><a href="#h5-0-14" id="h5-0-14" class="d">-                },
</a><a href="#h5-0-15" id="h5-0-15" class="d">-                predicate: None,
</a><a href="#h5-0-16" id="h5-0-16" class="d">-                pad: false,
</a><a href="#h5-0-17" id="h5-0-17" class="d">-                flip: false,
</a><a href="#h5-0-18" id="h5-0-18" class="i">+        source: NestedLoopJoin {
</a><a href="#h5-0-19" id="h5-0-19" class="i">+            outer: Scan {
</a><a href="#h5-0-20" id="h5-0-20" class="i">+                table: &quot;movies&quot;,
</a><a href="#h5-0-21" id="h5-0-21" class="i">+                alias: None,
</a><a href="#h5-0-22" id="h5-0-22" class="i">+                filter: None,
</a>             },
<a href="#h5-0-24" id="h5-0-24" class="d">-            predicate: Equal(
</a><a href="#h5-0-25" id="h5-0-25" class="d">-                Field(
</a><a href="#h5-0-26" id="h5-0-26" class="d">-                    Some(
</a><a href="#h5-0-27" id="h5-0-27" class="d">-                        &quot;movies&quot;,
</a><a href="#h5-0-28" id="h5-0-28" class="i">+            inner: Scan {
</a><a href="#h5-0-29" id="h5-0-29" class="i">+                table: &quot;genres&quot;,
</a><a href="#h5-0-30" id="h5-0-30" class="i">+                alias: None,
</a><a href="#h5-0-31" id="h5-0-31" class="i">+                filter: None,
</a><a href="#h5-0-32" id="h5-0-32" class="i">+            },
</a><a href="#h5-0-33" id="h5-0-33" class="i">+            predicate: Some(
</a><a href="#h5-0-34" id="h5-0-34" class="i">+                Equal(
</a><a href="#h5-0-35" id="h5-0-35" class="i">+                    Field(
</a><a href="#h5-0-36" id="h5-0-36" class="i">+                        Some(
</a><a href="#h5-0-37" id="h5-0-37" class="i">+                            &quot;movies&quot;,
</a><a href="#h5-0-38" id="h5-0-38" class="i">+                        ),
</a><a href="#h5-0-39" id="h5-0-39" class="i">+                        &quot;genre_id&quot;,
</a>                     ),
<a href="#h5-0-41" id="h5-0-41" class="d">-                    &quot;genre_id&quot;,
</a><a href="#h5-0-42" id="h5-0-42" class="d">-                ),
</a><a href="#h5-0-43" id="h5-0-43" class="d">-                Field(
</a><a href="#h5-0-44" id="h5-0-44" class="d">-                    Some(
</a><a href="#h5-0-45" id="h5-0-45" class="d">-                        &quot;genres&quot;,
</a><a href="#h5-0-46" id="h5-0-46" class="i">+                    Field(
</a><a href="#h5-0-47" id="h5-0-47" class="i">+                        Some(
</a><a href="#h5-0-48" id="h5-0-48" class="i">+                            &quot;genres&quot;,
</a><a href="#h5-0-49" id="h5-0-49" class="i">+                        ),
</a><a href="#h5-0-50" id="h5-0-50" class="i">+                        &quot;id&quot;,
</a>                     ),
<a href="#h5-0-52" id="h5-0-52" class="d">-                    &quot;id&quot;,
</a>                 ),
             ),
<a href="#h5-0-55" id="h5-0-55" class="i">+            pad: false,
</a><a href="#h5-0-56" id="h5-0-56" class="i">+            flip: false,
</a>         },
         orders: [
             (
<b>diff --git a/<a id="h6" href="../file/tests/sql/query/order_field_qualified.html">tests/sql/query/order_field_qualified</a> b/<a href="../file/tests/sql/query/order_field_qualified.html">tests/sql/query/order_field_qualified</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -166,36 +166,35 @@ Plan: Plan(
</a> Optimized plan: Plan(
     Order {
         source: Projection {
<a href="#h6-0-3" id="h6-0-3" class="d">-            source: Filter {
</a><a href="#h6-0-4" id="h6-0-4" class="d">-                source: NestedLoopJoin {
</a><a href="#h6-0-5" id="h6-0-5" class="d">-                    outer: Scan {
</a><a href="#h6-0-6" id="h6-0-6" class="d">-                        table: &quot;movies&quot;,
</a><a href="#h6-0-7" id="h6-0-7" class="d">-                        alias: None,
</a><a href="#h6-0-8" id="h6-0-8" class="d">-                        filter: None,
</a><a href="#h6-0-9" id="h6-0-9" class="d">-                    },
</a><a href="#h6-0-10" id="h6-0-10" class="d">-                    inner: Scan {
</a><a href="#h6-0-11" id="h6-0-11" class="d">-                        table: &quot;genres&quot;,
</a><a href="#h6-0-12" id="h6-0-12" class="d">-                        alias: None,
</a><a href="#h6-0-13" id="h6-0-13" class="d">-                        filter: None,
</a><a href="#h6-0-14" id="h6-0-14" class="d">-                    },
</a><a href="#h6-0-15" id="h6-0-15" class="d">-                    predicate: None,
</a><a href="#h6-0-16" id="h6-0-16" class="d">-                    pad: false,
</a><a href="#h6-0-17" id="h6-0-17" class="d">-                    flip: false,
</a><a href="#h6-0-18" id="h6-0-18" class="i">+            source: NestedLoopJoin {
</a><a href="#h6-0-19" id="h6-0-19" class="i">+                outer: Scan {
</a><a href="#h6-0-20" id="h6-0-20" class="i">+                    table: &quot;movies&quot;,
</a><a href="#h6-0-21" id="h6-0-21" class="i">+                    alias: None,
</a><a href="#h6-0-22" id="h6-0-22" class="i">+                    filter: None,
</a>                 },
<a href="#h6-0-24" id="h6-0-24" class="d">-                predicate: Equal(
</a><a href="#h6-0-25" id="h6-0-25" class="d">-                    Field(
</a><a href="#h6-0-26" id="h6-0-26" class="d">-                        Some(
</a><a href="#h6-0-27" id="h6-0-27" class="d">-                            &quot;movies&quot;,
</a><a href="#h6-0-28" id="h6-0-28" class="i">+                inner: Scan {
</a><a href="#h6-0-29" id="h6-0-29" class="i">+                    table: &quot;genres&quot;,
</a><a href="#h6-0-30" id="h6-0-30" class="i">+                    alias: None,
</a><a href="#h6-0-31" id="h6-0-31" class="i">+                    filter: None,
</a><a href="#h6-0-32" id="h6-0-32" class="i">+                },
</a><a href="#h6-0-33" id="h6-0-33" class="i">+                predicate: Some(
</a><a href="#h6-0-34" id="h6-0-34" class="i">+                    Equal(
</a><a href="#h6-0-35" id="h6-0-35" class="i">+                        Field(
</a><a href="#h6-0-36" id="h6-0-36" class="i">+                            Some(
</a><a href="#h6-0-37" id="h6-0-37" class="i">+                                &quot;movies&quot;,
</a><a href="#h6-0-38" id="h6-0-38" class="i">+                            ),
</a><a href="#h6-0-39" id="h6-0-39" class="i">+                            &quot;genre_id&quot;,
</a>                         ),
<a href="#h6-0-41" id="h6-0-41" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h6-0-42" id="h6-0-42" class="d">-                    ),
</a><a href="#h6-0-43" id="h6-0-43" class="d">-                    Field(
</a><a href="#h6-0-44" id="h6-0-44" class="d">-                        Some(
</a><a href="#h6-0-45" id="h6-0-45" class="d">-                            &quot;genres&quot;,
</a><a href="#h6-0-46" id="h6-0-46" class="i">+                        Field(
</a><a href="#h6-0-47" id="h6-0-47" class="i">+                            Some(
</a><a href="#h6-0-48" id="h6-0-48" class="i">+                                &quot;genres&quot;,
</a><a href="#h6-0-49" id="h6-0-49" class="i">+                            ),
</a><a href="#h6-0-50" id="h6-0-50" class="i">+                            &quot;id&quot;,
</a>                         ),
<a href="#h6-0-52" id="h6-0-52" class="d">-                        &quot;id&quot;,
</a>                     ),
                 ),
<a href="#h6-0-55" id="h6-0-55" class="i">+                pad: false,
</a><a href="#h6-0-56" id="h6-0-56" class="i">+                flip: false,
</a>             },
             labels: [
                 None,
<b>diff --git a/<a id="h7" href="../file/tests/sql/query/where_field_aliased_select.html">tests/sql/query/where_field_aliased_select</a> b/<a href="../file/tests/sql/query/where_field_aliased_select.html">tests/sql/query/where_field_aliased_select</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -171,63 +171,62 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Projection {
<a href="#h7-0-3" id="h7-0-3" class="d">-        source: Filter {
</a><a href="#h7-0-4" id="h7-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h7-0-5" id="h7-0-5" class="d">-                outer: Scan {
</a><a href="#h7-0-6" id="h7-0-6" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h7-0-7" id="h7-0-7" class="d">-                    alias: Some(
</a><a href="#h7-0-8" id="h7-0-8" class="d">-                        &quot;m&quot;,
</a><a href="#h7-0-9" id="h7-0-9" class="d">-                    ),
</a><a href="#h7-0-10" id="h7-0-10" class="d">-                    filter: None,
</a><a href="#h7-0-11" id="h7-0-11" class="d">-                },
</a><a href="#h7-0-12" id="h7-0-12" class="d">-                inner: Scan {
</a><a href="#h7-0-13" id="h7-0-13" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h7-0-14" id="h7-0-14" class="d">-                    alias: Some(
</a><a href="#h7-0-15" id="h7-0-15" class="d">-                        &quot;g&quot;,
</a><a href="#h7-0-16" id="h7-0-16" class="d">-                    ),
</a><a href="#h7-0-17" id="h7-0-17" class="d">-                    filter: None,
</a><a href="#h7-0-18" id="h7-0-18" class="d">-                },
</a><a href="#h7-0-19" id="h7-0-19" class="d">-                predicate: None,
</a><a href="#h7-0-20" id="h7-0-20" class="d">-                pad: false,
</a><a href="#h7-0-21" id="h7-0-21" class="d">-                flip: false,
</a><a href="#h7-0-22" id="h7-0-22" class="i">+        source: NestedLoopJoin {
</a><a href="#h7-0-23" id="h7-0-23" class="i">+            outer: Scan {
</a><a href="#h7-0-24" id="h7-0-24" class="i">+                table: &quot;movies&quot;,
</a><a href="#h7-0-25" id="h7-0-25" class="i">+                alias: Some(
</a><a href="#h7-0-26" id="h7-0-26" class="i">+                    &quot;m&quot;,
</a><a href="#h7-0-27" id="h7-0-27" class="i">+                ),
</a><a href="#h7-0-28" id="h7-0-28" class="i">+                filter: None,
</a>             },
<a href="#h7-0-30" id="h7-0-30" class="d">-            predicate: And(
</a><a href="#h7-0-31" id="h7-0-31" class="d">-                Or(
</a><a href="#h7-0-32" id="h7-0-32" class="d">-                    GreaterThan(
</a><a href="#h7-0-33" id="h7-0-33" class="d">-                        Field(
</a><a href="#h7-0-34" id="h7-0-34" class="d">-                            None,
</a><a href="#h7-0-35" id="h7-0-35" class="d">-                            &quot;movie_id&quot;,
</a><a href="#h7-0-36" id="h7-0-36" class="i">+            inner: Scan {
</a><a href="#h7-0-37" id="h7-0-37" class="i">+                table: &quot;genres&quot;,
</a><a href="#h7-0-38" id="h7-0-38" class="i">+                alias: Some(
</a><a href="#h7-0-39" id="h7-0-39" class="i">+                    &quot;g&quot;,
</a><a href="#h7-0-40" id="h7-0-40" class="i">+                ),
</a><a href="#h7-0-41" id="h7-0-41" class="i">+                filter: None,
</a><a href="#h7-0-42" id="h7-0-42" class="i">+            },
</a><a href="#h7-0-43" id="h7-0-43" class="i">+            predicate: Some(
</a><a href="#h7-0-44" id="h7-0-44" class="i">+                And(
</a><a href="#h7-0-45" id="h7-0-45" class="i">+                    Or(
</a><a href="#h7-0-46" id="h7-0-46" class="i">+                        GreaterThan(
</a><a href="#h7-0-47" id="h7-0-47" class="i">+                            Field(
</a><a href="#h7-0-48" id="h7-0-48" class="i">+                                None,
</a><a href="#h7-0-49" id="h7-0-49" class="i">+                                &quot;movie_id&quot;,
</a><a href="#h7-0-50" id="h7-0-50" class="i">+                            ),
</a><a href="#h7-0-51" id="h7-0-51" class="i">+                            Constant(
</a><a href="#h7-0-52" id="h7-0-52" class="i">+                                Integer(
</a><a href="#h7-0-53" id="h7-0-53" class="i">+                                    3,
</a><a href="#h7-0-54" id="h7-0-54" class="i">+                                ),
</a><a href="#h7-0-55" id="h7-0-55" class="i">+                            ),
</a>                         ),
<a href="#h7-0-57" id="h7-0-57" class="d">-                        Constant(
</a><a href="#h7-0-58" id="h7-0-58" class="d">-                            Integer(
</a><a href="#h7-0-59" id="h7-0-59" class="d">-                                3,
</a><a href="#h7-0-60" id="h7-0-60" class="i">+                        Equal(
</a><a href="#h7-0-61" id="h7-0-61" class="i">+                            Field(
</a><a href="#h7-0-62" id="h7-0-62" class="i">+                                None,
</a><a href="#h7-0-63" id="h7-0-63" class="i">+                                &quot;movie_id&quot;,
</a><a href="#h7-0-64" id="h7-0-64" class="i">+                            ),
</a><a href="#h7-0-65" id="h7-0-65" class="i">+                            Constant(
</a><a href="#h7-0-66" id="h7-0-66" class="i">+                                Integer(
</a><a href="#h7-0-67" id="h7-0-67" class="i">+                                    3,
</a><a href="#h7-0-68" id="h7-0-68" class="i">+                                ),
</a>                             ),
                         ),
                     ),
                     Equal(
                         Field(
                             None,
<a href="#h7-0-75" id="h7-0-75" class="d">-                            &quot;movie_id&quot;,
</a><a href="#h7-0-76" id="h7-0-76" class="i">+                            &quot;genre_id&quot;,
</a>                         ),
                         Constant(
                             Integer(
<a href="#h7-0-80" id="h7-0-80" class="d">-                                3,
</a><a href="#h7-0-81" id="h7-0-81" class="i">+                                1,
</a>                             ),
                         ),
                     ),
                 ),
<a href="#h7-0-86" id="h7-0-86" class="d">-                Equal(
</a><a href="#h7-0-87" id="h7-0-87" class="d">-                    Field(
</a><a href="#h7-0-88" id="h7-0-88" class="d">-                        None,
</a><a href="#h7-0-89" id="h7-0-89" class="d">-                        &quot;genre_id&quot;,
</a><a href="#h7-0-90" id="h7-0-90" class="d">-                    ),
</a><a href="#h7-0-91" id="h7-0-91" class="d">-                    Constant(
</a><a href="#h7-0-92" id="h7-0-92" class="d">-                        Integer(
</a><a href="#h7-0-93" id="h7-0-93" class="d">-                            1,
</a><a href="#h7-0-94" id="h7-0-94" class="d">-                        ),
</a><a href="#h7-0-95" id="h7-0-95" class="d">-                    ),
</a><a href="#h7-0-96" id="h7-0-96" class="d">-                ),
</a>             ),
<a href="#h7-0-98" id="h7-0-98" class="i">+            pad: false,
</a><a href="#h7-0-99" id="h7-0-99" class="i">+            flip: false,
</a>         },
         labels: [
             Some(
<b>diff --git a/<a id="h8" href="../file/tests/sql/query/where_field_aliased_table.html">tests/sql/query/where_field_aliased_table</a> b/<a href="../file/tests/sql/query/where_field_aliased_table.html">tests/sql/query/where_field_aliased_table</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -173,69 +173,68 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Projection {
<a href="#h8-0-3" id="h8-0-3" class="d">-        source: Filter {
</a><a href="#h8-0-4" id="h8-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h8-0-5" id="h8-0-5" class="d">-                outer: Scan {
</a><a href="#h8-0-6" id="h8-0-6" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h8-0-7" id="h8-0-7" class="d">-                    alias: Some(
</a><a href="#h8-0-8" id="h8-0-8" class="d">-                        &quot;m&quot;,
</a><a href="#h8-0-9" id="h8-0-9" class="d">-                    ),
</a><a href="#h8-0-10" id="h8-0-10" class="d">-                    filter: None,
</a><a href="#h8-0-11" id="h8-0-11" class="d">-                },
</a><a href="#h8-0-12" id="h8-0-12" class="d">-                inner: Scan {
</a><a href="#h8-0-13" id="h8-0-13" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h8-0-14" id="h8-0-14" class="d">-                    alias: Some(
</a><a href="#h8-0-15" id="h8-0-15" class="d">-                        &quot;g&quot;,
</a><a href="#h8-0-16" id="h8-0-16" class="d">-                    ),
</a><a href="#h8-0-17" id="h8-0-17" class="d">-                    filter: None,
</a><a href="#h8-0-18" id="h8-0-18" class="d">-                },
</a><a href="#h8-0-19" id="h8-0-19" class="d">-                predicate: None,
</a><a href="#h8-0-20" id="h8-0-20" class="d">-                pad: false,
</a><a href="#h8-0-21" id="h8-0-21" class="d">-                flip: false,
</a><a href="#h8-0-22" id="h8-0-22" class="i">+        source: NestedLoopJoin {
</a><a href="#h8-0-23" id="h8-0-23" class="i">+            outer: Scan {
</a><a href="#h8-0-24" id="h8-0-24" class="i">+                table: &quot;movies&quot;,
</a><a href="#h8-0-25" id="h8-0-25" class="i">+                alias: Some(
</a><a href="#h8-0-26" id="h8-0-26" class="i">+                    &quot;m&quot;,
</a><a href="#h8-0-27" id="h8-0-27" class="i">+                ),
</a><a href="#h8-0-28" id="h8-0-28" class="i">+                filter: None,
</a>             },
<a href="#h8-0-30" id="h8-0-30" class="d">-            predicate: And(
</a><a href="#h8-0-31" id="h8-0-31" class="d">-                Or(
</a><a href="#h8-0-32" id="h8-0-32" class="d">-                    GreaterThan(
</a><a href="#h8-0-33" id="h8-0-33" class="d">-                        Field(
</a><a href="#h8-0-34" id="h8-0-34" class="d">-                            Some(
</a><a href="#h8-0-35" id="h8-0-35" class="d">-                                &quot;m&quot;,
</a><a href="#h8-0-36" id="h8-0-36" class="i">+            inner: Scan {
</a><a href="#h8-0-37" id="h8-0-37" class="i">+                table: &quot;genres&quot;,
</a><a href="#h8-0-38" id="h8-0-38" class="i">+                alias: Some(
</a><a href="#h8-0-39" id="h8-0-39" class="i">+                    &quot;g&quot;,
</a><a href="#h8-0-40" id="h8-0-40" class="i">+                ),
</a><a href="#h8-0-41" id="h8-0-41" class="i">+                filter: None,
</a><a href="#h8-0-42" id="h8-0-42" class="i">+            },
</a><a href="#h8-0-43" id="h8-0-43" class="i">+            predicate: Some(
</a><a href="#h8-0-44" id="h8-0-44" class="i">+                And(
</a><a href="#h8-0-45" id="h8-0-45" class="i">+                    Or(
</a><a href="#h8-0-46" id="h8-0-46" class="i">+                        GreaterThan(
</a><a href="#h8-0-47" id="h8-0-47" class="i">+                            Field(
</a><a href="#h8-0-48" id="h8-0-48" class="i">+                                Some(
</a><a href="#h8-0-49" id="h8-0-49" class="i">+                                    &quot;m&quot;,
</a><a href="#h8-0-50" id="h8-0-50" class="i">+                                ),
</a><a href="#h8-0-51" id="h8-0-51" class="i">+                                &quot;id&quot;,
</a><a href="#h8-0-52" id="h8-0-52" class="i">+                            ),
</a><a href="#h8-0-53" id="h8-0-53" class="i">+                            Constant(
</a><a href="#h8-0-54" id="h8-0-54" class="i">+                                Integer(
</a><a href="#h8-0-55" id="h8-0-55" class="i">+                                    3,
</a><a href="#h8-0-56" id="h8-0-56" class="i">+                                ),
</a>                             ),
<a href="#h8-0-58" id="h8-0-58" class="d">-                            &quot;id&quot;,
</a>                         ),
<a href="#h8-0-60" id="h8-0-60" class="d">-                        Constant(
</a><a href="#h8-0-61" id="h8-0-61" class="d">-                            Integer(
</a><a href="#h8-0-62" id="h8-0-62" class="d">-                                3,
</a><a href="#h8-0-63" id="h8-0-63" class="i">+                        Equal(
</a><a href="#h8-0-64" id="h8-0-64" class="i">+                            Field(
</a><a href="#h8-0-65" id="h8-0-65" class="i">+                                Some(
</a><a href="#h8-0-66" id="h8-0-66" class="i">+                                    &quot;m&quot;,
</a><a href="#h8-0-67" id="h8-0-67" class="i">+                                ),
</a><a href="#h8-0-68" id="h8-0-68" class="i">+                                &quot;id&quot;,
</a><a href="#h8-0-69" id="h8-0-69" class="i">+                            ),
</a><a href="#h8-0-70" id="h8-0-70" class="i">+                            Constant(
</a><a href="#h8-0-71" id="h8-0-71" class="i">+                                Integer(
</a><a href="#h8-0-72" id="h8-0-72" class="i">+                                    3,
</a><a href="#h8-0-73" id="h8-0-73" class="i">+                                ),
</a>                             ),
                         ),
                     ),
                     Equal(
                         Field(
                             Some(
<a href="#h8-0-80" id="h8-0-80" class="d">-                                &quot;m&quot;,
</a><a href="#h8-0-81" id="h8-0-81" class="i">+                                &quot;g&quot;,
</a>                             ),
                             &quot;id&quot;,
                         ),
                         Constant(
                             Integer(
<a href="#h8-0-87" id="h8-0-87" class="d">-                                3,
</a><a href="#h8-0-88" id="h8-0-88" class="i">+                                1,
</a>                             ),
                         ),
                     ),
                 ),
<a href="#h8-0-93" id="h8-0-93" class="d">-                Equal(
</a><a href="#h8-0-94" id="h8-0-94" class="d">-                    Field(
</a><a href="#h8-0-95" id="h8-0-95" class="d">-                        Some(
</a><a href="#h8-0-96" id="h8-0-96" class="d">-                            &quot;g&quot;,
</a><a href="#h8-0-97" id="h8-0-97" class="d">-                        ),
</a><a href="#h8-0-98" id="h8-0-98" class="d">-                        &quot;id&quot;,
</a><a href="#h8-0-99" id="h8-0-99" class="d">-                    ),
</a><a href="#h8-0-100" id="h8-0-100" class="d">-                    Constant(
</a><a href="#h8-0-101" id="h8-0-101" class="d">-                        Integer(
</a><a href="#h8-0-102" id="h8-0-102" class="d">-                            1,
</a><a href="#h8-0-103" id="h8-0-103" class="d">-                        ),
</a><a href="#h8-0-104" id="h8-0-104" class="d">-                    ),
</a><a href="#h8-0-105" id="h8-0-105" class="d">-                ),
</a>             ),
<a href="#h8-0-107" id="h8-0-107" class="i">+            pad: false,
</a><a href="#h8-0-108" id="h8-0-108" class="i">+            flip: false,
</a>         },
         labels: [
             None,
<b>diff --git a/<a id="h9" href="../file/tests/sql/query/where_field_ambiguous.html">tests/sql/query/where_field_ambiguous</a> b/<a href="../file/tests/sql/query/where_field_ambiguous.html">tests/sql/query/where_field_ambiguous</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -125,46 +125,45 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Projection {
<a href="#h9-0-3" id="h9-0-3" class="d">-        source: Filter {
</a><a href="#h9-0-4" id="h9-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h9-0-5" id="h9-0-5" class="d">-                outer: Scan {
</a><a href="#h9-0-6" id="h9-0-6" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h9-0-7" id="h9-0-7" class="d">-                    alias: None,
</a><a href="#h9-0-8" id="h9-0-8" class="d">-                    filter: None,
</a><a href="#h9-0-9" id="h9-0-9" class="d">-                },
</a><a href="#h9-0-10" id="h9-0-10" class="d">-                inner: Scan {
</a><a href="#h9-0-11" id="h9-0-11" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h9-0-12" id="h9-0-12" class="d">-                    alias: None,
</a><a href="#h9-0-13" id="h9-0-13" class="d">-                    filter: None,
</a><a href="#h9-0-14" id="h9-0-14" class="d">-                },
</a><a href="#h9-0-15" id="h9-0-15" class="d">-                predicate: None,
</a><a href="#h9-0-16" id="h9-0-16" class="d">-                pad: false,
</a><a href="#h9-0-17" id="h9-0-17" class="d">-                flip: false,
</a><a href="#h9-0-18" id="h9-0-18" class="i">+        source: NestedLoopJoin {
</a><a href="#h9-0-19" id="h9-0-19" class="i">+            outer: Scan {
</a><a href="#h9-0-20" id="h9-0-20" class="i">+                table: &quot;movies&quot;,
</a><a href="#h9-0-21" id="h9-0-21" class="i">+                alias: None,
</a><a href="#h9-0-22" id="h9-0-22" class="i">+                filter: None,
</a>             },
<a href="#h9-0-24" id="h9-0-24" class="d">-            predicate: Or(
</a><a href="#h9-0-25" id="h9-0-25" class="d">-                GreaterThan(
</a><a href="#h9-0-26" id="h9-0-26" class="d">-                    Field(
</a><a href="#h9-0-27" id="h9-0-27" class="d">-                        None,
</a><a href="#h9-0-28" id="h9-0-28" class="d">-                        &quot;id&quot;,
</a><a href="#h9-0-29" id="h9-0-29" class="d">-                    ),
</a><a href="#h9-0-30" id="h9-0-30" class="d">-                    Constant(
</a><a href="#h9-0-31" id="h9-0-31" class="d">-                        Integer(
</a><a href="#h9-0-32" id="h9-0-32" class="d">-                            3,
</a><a href="#h9-0-33" id="h9-0-33" class="i">+            inner: Scan {
</a><a href="#h9-0-34" id="h9-0-34" class="i">+                table: &quot;genres&quot;,
</a><a href="#h9-0-35" id="h9-0-35" class="i">+                alias: None,
</a><a href="#h9-0-36" id="h9-0-36" class="i">+                filter: None,
</a><a href="#h9-0-37" id="h9-0-37" class="i">+            },
</a><a href="#h9-0-38" id="h9-0-38" class="i">+            predicate: Some(
</a><a href="#h9-0-39" id="h9-0-39" class="i">+                Or(
</a><a href="#h9-0-40" id="h9-0-40" class="i">+                    GreaterThan(
</a><a href="#h9-0-41" id="h9-0-41" class="i">+                        Field(
</a><a href="#h9-0-42" id="h9-0-42" class="i">+                            None,
</a><a href="#h9-0-43" id="h9-0-43" class="i">+                            &quot;id&quot;,
</a><a href="#h9-0-44" id="h9-0-44" class="i">+                        ),
</a><a href="#h9-0-45" id="h9-0-45" class="i">+                        Constant(
</a><a href="#h9-0-46" id="h9-0-46" class="i">+                            Integer(
</a><a href="#h9-0-47" id="h9-0-47" class="i">+                                3,
</a><a href="#h9-0-48" id="h9-0-48" class="i">+                            ),
</a>                         ),
                     ),
<a href="#h9-0-51" id="h9-0-51" class="d">-                ),
</a><a href="#h9-0-52" id="h9-0-52" class="d">-                Equal(
</a><a href="#h9-0-53" id="h9-0-53" class="d">-                    Field(
</a><a href="#h9-0-54" id="h9-0-54" class="d">-                        None,
</a><a href="#h9-0-55" id="h9-0-55" class="d">-                        &quot;id&quot;,
</a><a href="#h9-0-56" id="h9-0-56" class="d">-                    ),
</a><a href="#h9-0-57" id="h9-0-57" class="d">-                    Constant(
</a><a href="#h9-0-58" id="h9-0-58" class="d">-                        Integer(
</a><a href="#h9-0-59" id="h9-0-59" class="d">-                            3,
</a><a href="#h9-0-60" id="h9-0-60" class="i">+                    Equal(
</a><a href="#h9-0-61" id="h9-0-61" class="i">+                        Field(
</a><a href="#h9-0-62" id="h9-0-62" class="i">+                            None,
</a><a href="#h9-0-63" id="h9-0-63" class="i">+                            &quot;id&quot;,
</a><a href="#h9-0-64" id="h9-0-64" class="i">+                        ),
</a><a href="#h9-0-65" id="h9-0-65" class="i">+                        Constant(
</a><a href="#h9-0-66" id="h9-0-66" class="i">+                            Integer(
</a><a href="#h9-0-67" id="h9-0-67" class="i">+                                3,
</a><a href="#h9-0-68" id="h9-0-68" class="i">+                            ),
</a>                         ),
                     ),
                 ),
             ),
<a href="#h9-0-73" id="h9-0-73" class="i">+            pad: false,
</a><a href="#h9-0-74" id="h9-0-74" class="i">+            flip: false,
</a>         },
         labels: [
             None,
<b>diff --git a/<a id="h10" href="../file/tests/sql/query/where_field_qualified.html">tests/sql/query/where_field_qualified</a> b/<a href="../file/tests/sql/query/where_field_qualified.html">tests/sql/query/where_field_qualified</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -165,65 +165,64 @@ Plan: Plan(
</a> 
 Optimized plan: Plan(
     Projection {
<a href="#h10-0-3" id="h10-0-3" class="d">-        source: Filter {
</a><a href="#h10-0-4" id="h10-0-4" class="d">-            source: NestedLoopJoin {
</a><a href="#h10-0-5" id="h10-0-5" class="d">-                outer: Scan {
</a><a href="#h10-0-6" id="h10-0-6" class="d">-                    table: &quot;movies&quot;,
</a><a href="#h10-0-7" id="h10-0-7" class="d">-                    alias: None,
</a><a href="#h10-0-8" id="h10-0-8" class="d">-                    filter: None,
</a><a href="#h10-0-9" id="h10-0-9" class="d">-                },
</a><a href="#h10-0-10" id="h10-0-10" class="d">-                inner: Scan {
</a><a href="#h10-0-11" id="h10-0-11" class="d">-                    table: &quot;genres&quot;,
</a><a href="#h10-0-12" id="h10-0-12" class="d">-                    alias: None,
</a><a href="#h10-0-13" id="h10-0-13" class="d">-                    filter: None,
</a><a href="#h10-0-14" id="h10-0-14" class="d">-                },
</a><a href="#h10-0-15" id="h10-0-15" class="d">-                predicate: None,
</a><a href="#h10-0-16" id="h10-0-16" class="d">-                pad: false,
</a><a href="#h10-0-17" id="h10-0-17" class="d">-                flip: false,
</a><a href="#h10-0-18" id="h10-0-18" class="i">+        source: NestedLoopJoin {
</a><a href="#h10-0-19" id="h10-0-19" class="i">+            outer: Scan {
</a><a href="#h10-0-20" id="h10-0-20" class="i">+                table: &quot;movies&quot;,
</a><a href="#h10-0-21" id="h10-0-21" class="i">+                alias: None,
</a><a href="#h10-0-22" id="h10-0-22" class="i">+                filter: None,
</a>             },
<a href="#h10-0-24" id="h10-0-24" class="d">-            predicate: And(
</a><a href="#h10-0-25" id="h10-0-25" class="d">-                Or(
</a><a href="#h10-0-26" id="h10-0-26" class="d">-                    GreaterThan(
</a><a href="#h10-0-27" id="h10-0-27" class="d">-                        Field(
</a><a href="#h10-0-28" id="h10-0-28" class="d">-                            Some(
</a><a href="#h10-0-29" id="h10-0-29" class="d">-                                &quot;movies&quot;,
</a><a href="#h10-0-30" id="h10-0-30" class="i">+            inner: Scan {
</a><a href="#h10-0-31" id="h10-0-31" class="i">+                table: &quot;genres&quot;,
</a><a href="#h10-0-32" id="h10-0-32" class="i">+                alias: None,
</a><a href="#h10-0-33" id="h10-0-33" class="i">+                filter: None,
</a><a href="#h10-0-34" id="h10-0-34" class="i">+            },
</a><a href="#h10-0-35" id="h10-0-35" class="i">+            predicate: Some(
</a><a href="#h10-0-36" id="h10-0-36" class="i">+                And(
</a><a href="#h10-0-37" id="h10-0-37" class="i">+                    Or(
</a><a href="#h10-0-38" id="h10-0-38" class="i">+                        GreaterThan(
</a><a href="#h10-0-39" id="h10-0-39" class="i">+                            Field(
</a><a href="#h10-0-40" id="h10-0-40" class="i">+                                Some(
</a><a href="#h10-0-41" id="h10-0-41" class="i">+                                    &quot;movies&quot;,
</a><a href="#h10-0-42" id="h10-0-42" class="i">+                                ),
</a><a href="#h10-0-43" id="h10-0-43" class="i">+                                &quot;id&quot;,
</a><a href="#h10-0-44" id="h10-0-44" class="i">+                            ),
</a><a href="#h10-0-45" id="h10-0-45" class="i">+                            Constant(
</a><a href="#h10-0-46" id="h10-0-46" class="i">+                                Integer(
</a><a href="#h10-0-47" id="h10-0-47" class="i">+                                    3,
</a><a href="#h10-0-48" id="h10-0-48" class="i">+                                ),
</a>                             ),
<a href="#h10-0-50" id="h10-0-50" class="d">-                            &quot;id&quot;,
</a>                         ),
<a href="#h10-0-52" id="h10-0-52" class="d">-                        Constant(
</a><a href="#h10-0-53" id="h10-0-53" class="d">-                            Integer(
</a><a href="#h10-0-54" id="h10-0-54" class="d">-                                3,
</a><a href="#h10-0-55" id="h10-0-55" class="i">+                        Equal(
</a><a href="#h10-0-56" id="h10-0-56" class="i">+                            Field(
</a><a href="#h10-0-57" id="h10-0-57" class="i">+                                Some(
</a><a href="#h10-0-58" id="h10-0-58" class="i">+                                    &quot;movies&quot;,
</a><a href="#h10-0-59" id="h10-0-59" class="i">+                                ),
</a><a href="#h10-0-60" id="h10-0-60" class="i">+                                &quot;id&quot;,
</a><a href="#h10-0-61" id="h10-0-61" class="i">+                            ),
</a><a href="#h10-0-62" id="h10-0-62" class="i">+                            Constant(
</a><a href="#h10-0-63" id="h10-0-63" class="i">+                                Integer(
</a><a href="#h10-0-64" id="h10-0-64" class="i">+                                    3,
</a><a href="#h10-0-65" id="h10-0-65" class="i">+                                ),
</a>                             ),
                         ),
                     ),
                     Equal(
                         Field(
                             Some(
<a href="#h10-0-72" id="h10-0-72" class="d">-                                &quot;movies&quot;,
</a><a href="#h10-0-73" id="h10-0-73" class="i">+                                &quot;genres&quot;,
</a>                             ),
                             &quot;id&quot;,
                         ),
                         Constant(
                             Integer(
<a href="#h10-0-79" id="h10-0-79" class="d">-                                3,
</a><a href="#h10-0-80" id="h10-0-80" class="i">+                                1,
</a>                             ),
                         ),
                     ),
                 ),
<a href="#h10-0-85" id="h10-0-85" class="d">-                Equal(
</a><a href="#h10-0-86" id="h10-0-86" class="d">-                    Field(
</a><a href="#h10-0-87" id="h10-0-87" class="d">-                        Some(
</a><a href="#h10-0-88" id="h10-0-88" class="d">-                            &quot;genres&quot;,
</a><a href="#h10-0-89" id="h10-0-89" class="d">-                        ),
</a><a href="#h10-0-90" id="h10-0-90" class="d">-                        &quot;id&quot;,
</a><a href="#h10-0-91" id="h10-0-91" class="d">-                    ),
</a><a href="#h10-0-92" id="h10-0-92" class="d">-                    Constant(
</a><a href="#h10-0-93" id="h10-0-93" class="d">-                        Integer(
</a><a href="#h10-0-94" id="h10-0-94" class="d">-                            1,
</a><a href="#h10-0-95" id="h10-0-95" class="d">-                        ),
</a><a href="#h10-0-96" id="h10-0-96" class="d">-                    ),
</a><a href="#h10-0-97" id="h10-0-97" class="d">-                ),
</a>             ),
<a href="#h10-0-99" id="h10-0-99" class="i">+            pad: false,
</a><a href="#h10-0-100" id="h10-0-100" class="i">+            flip: false,
</a>         },
         labels: [
             None,
<b>diff --git a/<a id="h11" href="../file/tests/sql/query/where_join_inner.html">tests/sql/query/where_join_inner</a> b/<a href="../file/tests/sql/query/where_join_inner.html">tests/sql/query/where_join_inner</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -81,36 +81,35 @@ Plan: Plan(
</a> )
 
 Optimized plan: Plan(
<a href="#h11-0-3" id="h11-0-3" class="d">-    Filter {
</a><a href="#h11-0-4" id="h11-0-4" class="d">-        source: NestedLoopJoin {
</a><a href="#h11-0-5" id="h11-0-5" class="d">-            outer: Scan {
</a><a href="#h11-0-6" id="h11-0-6" class="d">-                table: &quot;movies&quot;,
</a><a href="#h11-0-7" id="h11-0-7" class="d">-                alias: None,
</a><a href="#h11-0-8" id="h11-0-8" class="d">-                filter: None,
</a><a href="#h11-0-9" id="h11-0-9" class="d">-            },
</a><a href="#h11-0-10" id="h11-0-10" class="d">-            inner: Scan {
</a><a href="#h11-0-11" id="h11-0-11" class="d">-                table: &quot;genres&quot;,
</a><a href="#h11-0-12" id="h11-0-12" class="d">-                alias: None,
</a><a href="#h11-0-13" id="h11-0-13" class="d">-                filter: None,
</a><a href="#h11-0-14" id="h11-0-14" class="d">-            },
</a><a href="#h11-0-15" id="h11-0-15" class="d">-            predicate: None,
</a><a href="#h11-0-16" id="h11-0-16" class="d">-            pad: false,
</a><a href="#h11-0-17" id="h11-0-17" class="d">-            flip: false,
</a><a href="#h11-0-18" id="h11-0-18" class="i">+    NestedLoopJoin {
</a><a href="#h11-0-19" id="h11-0-19" class="i">+        outer: Scan {
</a><a href="#h11-0-20" id="h11-0-20" class="i">+            table: &quot;movies&quot;,
</a><a href="#h11-0-21" id="h11-0-21" class="i">+            alias: None,
</a><a href="#h11-0-22" id="h11-0-22" class="i">+            filter: None,
</a>         },
<a href="#h11-0-24" id="h11-0-24" class="d">-        predicate: Equal(
</a><a href="#h11-0-25" id="h11-0-25" class="d">-            Field(
</a><a href="#h11-0-26" id="h11-0-26" class="d">-                Some(
</a><a href="#h11-0-27" id="h11-0-27" class="d">-                    &quot;movies&quot;,
</a><a href="#h11-0-28" id="h11-0-28" class="i">+        inner: Scan {
</a><a href="#h11-0-29" id="h11-0-29" class="i">+            table: &quot;genres&quot;,
</a><a href="#h11-0-30" id="h11-0-30" class="i">+            alias: None,
</a><a href="#h11-0-31" id="h11-0-31" class="i">+            filter: None,
</a><a href="#h11-0-32" id="h11-0-32" class="i">+        },
</a><a href="#h11-0-33" id="h11-0-33" class="i">+        predicate: Some(
</a><a href="#h11-0-34" id="h11-0-34" class="i">+            Equal(
</a><a href="#h11-0-35" id="h11-0-35" class="i">+                Field(
</a><a href="#h11-0-36" id="h11-0-36" class="i">+                    Some(
</a><a href="#h11-0-37" id="h11-0-37" class="i">+                        &quot;movies&quot;,
</a><a href="#h11-0-38" id="h11-0-38" class="i">+                    ),
</a><a href="#h11-0-39" id="h11-0-39" class="i">+                    &quot;genre_id&quot;,
</a>                 ),
<a href="#h11-0-41" id="h11-0-41" class="d">-                &quot;genre_id&quot;,
</a><a href="#h11-0-42" id="h11-0-42" class="d">-            ),
</a><a href="#h11-0-43" id="h11-0-43" class="d">-            Field(
</a><a href="#h11-0-44" id="h11-0-44" class="d">-                Some(
</a><a href="#h11-0-45" id="h11-0-45" class="d">-                    &quot;genres&quot;,
</a><a href="#h11-0-46" id="h11-0-46" class="i">+                Field(
</a><a href="#h11-0-47" id="h11-0-47" class="i">+                    Some(
</a><a href="#h11-0-48" id="h11-0-48" class="i">+                        &quot;genres&quot;,
</a><a href="#h11-0-49" id="h11-0-49" class="i">+                    ),
</a><a href="#h11-0-50" id="h11-0-50" class="i">+                    &quot;id&quot;,
</a>                 ),
<a href="#h11-0-52" id="h11-0-52" class="d">-                &quot;id&quot;,
</a>             ),
         ),
<a href="#h11-0-55" id="h11-0-55" class="i">+        pad: false,
</a><a href="#h11-0-56" id="h11-0-56" class="i">+        flip: false,
</a>     },
 )
 
</pre>
</div>
</body>
</html>
