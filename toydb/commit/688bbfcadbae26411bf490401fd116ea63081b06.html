<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Added initial toyc client and echo service - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/688bbfcadbae26411bf490401fd116ea63081b06.html">688bbfcadbae26411bf490401fd116ea63081b06</a>
<b>parent</b> <a href="../commit/cabb97c23bca7e6b5502a896e9449d56e71bc369.html">cabb97c23bca7e6b5502a896e9449d56e71bc369</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Mon, 19 Aug 2019 18:14:44 +0200

Added initial toyc client and echo service

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Cargo.lock</a></td><td> | </td><td class="num">65</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Cargo.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">protobuf/toydb.proto</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">src/bin/toyc.rs</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">src/client.rs</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/error.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/lib.rs</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/server/raft.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/server/toydb.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">++++++++++</span><span class="d">-</span></td></tr>
</table></pre><pre>9 files changed, 181 insertions(+), 4 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Cargo.lock.html">Cargo.lock</a> b/<a href="../file/Cargo.lock.html">Cargo.lock</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -241,6 +241,26 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-0-3" id="h0-0-3" class="i">+name = &quot;dirs&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+version = &quot;2.0.2&quot;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-6" id="h0-0-6" class="i">+dependencies = [
</a><a href="#h0-0-7" id="h0-0-7" class="i">+ &quot;cfg-if 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-8" id="h0-0-8" class="i">+ &quot;dirs-sys 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-9" id="h0-0-9" class="i">+]
</a><a href="#h0-0-10" id="h0-0-10" class="i">+
</a><a href="#h0-0-11" id="h0-0-11" class="i">+[[package]]
</a><a href="#h0-0-12" id="h0-0-12" class="i">+name = &quot;dirs-sys&quot;
</a><a href="#h0-0-13" id="h0-0-13" class="i">+version = &quot;0.3.4&quot;
</a><a href="#h0-0-14" id="h0-0-14" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-15" id="h0-0-15" class="i">+dependencies = [
</a><a href="#h0-0-16" id="h0-0-16" class="i">+ &quot;cfg-if 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-17" id="h0-0-17" class="i">+ &quot;libc 0.2.62 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-18" id="h0-0-18" class="i">+ &quot;redox_users 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-19" id="h0-0-19" class="i">+ &quot;winapi 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-20" id="h0-0-20" class="i">+]
</a><a href="#h0-0-21" id="h0-0-21" class="i">+
</a><a href="#h0-0-22" id="h0-0-22" class="i">+[[package]]
</a> name = &quot;failure&quot;
 version = &quot;0.1.5&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-1" id="h0-1" class="h">@@ -499,6 +519,18 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-1-3" id="h0-1-3" class="i">+name = &quot;nix&quot;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+version = &quot;0.14.1&quot;
</a><a href="#h0-1-5" id="h0-1-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-1-6" id="h0-1-6" class="i">+dependencies = [
</a><a href="#h0-1-7" id="h0-1-7" class="i">+ &quot;bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-8" id="h0-1-8" class="i">+ &quot;cc 1.0.37 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-9" id="h0-1-9" class="i">+ &quot;cfg-if 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-10" id="h0-1-10" class="i">+ &quot;libc 0.2.62 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-11" id="h0-1-11" class="i">+ &quot;void 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-12" id="h0-1-12" class="i">+]
</a><a href="#h0-1-13" id="h0-1-13" class="i">+
</a><a href="#h0-1-14" id="h0-1-14" class="i">+[[package]]
</a> name = &quot;nodrop&quot;
 version = &quot;0.1.13&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-2" id="h0-2" class="h">@@ -886,6 +918,22 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-2-3" id="h0-2-3" class="i">+name = &quot;rustyline&quot;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+version = &quot;5.0.1&quot;
</a><a href="#h0-2-5" id="h0-2-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-2-6" id="h0-2-6" class="i">+dependencies = [
</a><a href="#h0-2-7" id="h0-2-7" class="i">+ &quot;dirs 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-8" id="h0-2-8" class="i">+ &quot;libc 0.2.62 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-9" id="h0-2-9" class="i">+ &quot;log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-10" id="h0-2-10" class="i">+ &quot;memchr 2.2.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-11" id="h0-2-11" class="i">+ &quot;nix 0.14.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-12" id="h0-2-12" class="i">+ &quot;unicode-segmentation 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-13" id="h0-2-13" class="i">+ &quot;unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-14" id="h0-2-14" class="i">+ &quot;utf8parse 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-15" id="h0-2-15" class="i">+ &quot;winapi 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-16" id="h0-2-16" class="i">+]
</a><a href="#h0-2-17" id="h0-2-17" class="i">+
</a><a href="#h0-2-18" id="h0-2-18" class="i">+[[package]]
</a> name = &quot;ryu&quot;
 version = &quot;0.2.8&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-3" id="h0-3" class="h">@@ -1369,6 +1417,7 @@ dependencies = [
</a>  &quot;protoc-rust-grpc 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;rand 0.6.5 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;rmp-serde 0.13.7 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-3-3" id="h0-3-3" class="i">+ &quot;rustyline 5.0.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a>  &quot;serde 1.0.91 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;serde_derive 1.0.91 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;simplelog 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-4" id="h0-4" class="h">@@ -1382,6 +1431,11 @@ version = &quot;0.1.3&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 
 [[package]]
<a href="#h0-4-3" id="h0-4-3" class="i">+name = &quot;unicode-segmentation&quot;
</a><a href="#h0-4-4" id="h0-4-4" class="i">+version = &quot;1.3.0&quot;
</a><a href="#h0-4-5" id="h0-4-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-4-6" id="h0-4-6" class="i">+
</a><a href="#h0-4-7" id="h0-4-7" class="i">+[[package]]
</a> name = &quot;unicode-width&quot;
 version = &quot;0.1.5&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-5" id="h0-5" class="h">@@ -1406,6 +1460,11 @@ version = &quot;1.0.2&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 
 [[package]]
<a href="#h0-5-3" id="h0-5-3" class="i">+name = &quot;utf8parse&quot;
</a><a href="#h0-5-4" id="h0-5-4" class="i">+version = &quot;0.1.1&quot;
</a><a href="#h0-5-5" id="h0-5-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-5-6" id="h0-5-6" class="i">+
</a><a href="#h0-5-7" id="h0-5-7" class="i">+[[package]]
</a> name = &quot;uuid&quot;
 version = &quot;0.7.4&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-6" id="h0-6" class="h">@@ -1508,6 +1567,8 @@ dependencies = [
</a> &quot;checksum crossbeam-queue 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;7c979cd6cfe72335896575c6b5688da489e420d36a27a0b9eb0c73db574b4a4b&quot;
 &quot;checksum crossbeam-utils 0.6.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f8306fcef4a7b563b76b7dd949ca48f52bc1141aa067d2ea09565f3e2652aa5c&quot;
 &quot;checksum dirs 1.0.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;3fd78930633bd1c6e35c4b42b1df7b0cbc6bc191146e512bb3bedf243fcc3901&quot;
<a href="#h0-6-3" id="h0-6-3" class="i">+&quot;checksum dirs 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;13aea89a5c93364a98e9b37b2fa237effbb694d5cfe01c5b70941f7eb087d5e3&quot;
</a><a href="#h0-6-4" id="h0-6-4" class="i">+&quot;checksum dirs-sys 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;afa0b23de8fd801745c471deffa6e12d248f962c9fd4b4c33787b055599bde7b&quot;
</a> &quot;checksum failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;795bd83d3abeb9220f257e597aa0080a508b27533824adf336529648f6abf7e2&quot;
 &quot;checksum failure_derive 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ea1063915fd7ef4309e222a5a07cf9c319fb9c7836b1f89b85458672dbb127e1&quot;
 &quot;checksum fnv 1.0.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2fad85553e09a6f881f739c29f0b00b0f01357c743266d478b68951ce23285f3&quot;
<a href="#h0-7" id="h0-7" class="h">@@ -1538,6 +1599,7 @@ dependencies = [
</a> &quot;checksum mio-uds 0.6.7 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;966257a94e196b11bb43aca423754d87429960a768de9414f3691d6957abf125&quot;
 &quot;checksum miow 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8c1f2f3b1cf331de6896aabf6e9d55dca90356cc9960cca7eaaf408a355ae919&quot;
 &quot;checksum net2 0.2.33 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;42550d9fb7b6684a6d404d9fa7250c2eb2646df731d1c06afc06dcee9e1bcf88&quot;
<a href="#h0-7-3" id="h0-7-3" class="i">+&quot;checksum nix 0.14.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6c722bee1037d430d0f8e687bbdbf222f27cc6e4e68d5caf630857bb2b6dbdce&quot;
</a> &quot;checksum nodrop 0.1.13 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2f9667ddcc6cc8a43afc9b7917599d7216aa09c463919ea32c59ed6cac8bc945&quot;
 &quot;checksum nom 4.2.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2ad2a91a8e869eeb30b9cb3119ae87773a8f4ae617f41b1eb9c154b2905f7bd6&quot;
 &quot;checksum num-integer 0.1.39 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;e83d528d2677f0518c570baf2b7abdcf0cd2d248860b68507bdcb3e91d4c0cea&quot;
<a href="#h0-8" id="h0-8" class="h">@@ -1583,6 +1645,7 @@ dependencies = [
</a> &quot;checksum rust-ini 0.13.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;3e52c148ef37f8c375d49d5a73aa70713125b7f19095948a923f80afdeb22ec2&quot;
 &quot;checksum rustc-demangle 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ccc78bfd5acd7bf3e89cffcf899e5cb1a52d6fafa8dec2739ad70c9577a57288&quot;
 &quot;checksum rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a&quot;
<a href="#h0-8-3" id="h0-8-3" class="i">+&quot;checksum rustyline 5.0.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;b7d4ca3c9586d2c1f742284f032e328313ea55f3f60a3b0a17e2ca1a2bf9ae22&quot;
</a> &quot;checksum ryu 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;b96a9549dc8d48f2c283938303c4b5a77aa29bfbc5b54b084fb1630408899a8f&quot;
 &quot;checksum safemem 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8dca453248a96cb0749e36ccdfe2b0b4e54a61bfef89fb97ec621eb8e0a93dd9&quot;
 &quot;checksum scoped-tls 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;332ffa32bf586782a3efaeb58f127980944bbc8c4d6913a86107ac2a5ab24b28&quot;
<a href="#h0-9" id="h0-9" class="h">@@ -1633,10 +1696,12 @@ dependencies = [
</a> &quot;checksum tokio-uds 0.2.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;037ffc3ba0e12a0ab4aca92e5234e0dedeb48fddf6ccd260f1f150a36a9f2445&quot;
 &quot;checksum toml 0.4.10 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;758664fc71a3a69038656bee8b6be6477d2a6c315a6b81f7081f591bffa4111f&quot;
 &quot;checksum ucd-util 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;535c204ee4d8434478593480b8f86ab45ec9aae0e83c568ca81abf0fd0e88f86&quot;
<a href="#h0-9-3" id="h0-9-3" class="i">+&quot;checksum unicode-segmentation 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;1967f4cdfc355b37fd76d2a954fb2ed3871034eb4f26d60537d88795cfc332a9&quot;
</a> &quot;checksum unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;882386231c45df4700b275c7ff55b6f3698780a650026380e72dabe76fa46526&quot;
 &quot;checksum unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;fc72304796d0818e357ead4e000d19c9c174ab23dc11093ac919054d20a6a7fc&quot;
 &quot;checksum unix_socket 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6aa2700417c405c38f5e6902d699345241c28c0b7ade4abaad71e35a87eb1564&quot;
 &quot;checksum utf8-ranges 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;796f7e48bef87609f7ade7e06495a87d5cd06c7866e6a5cbfceffc558a243737&quot;
<a href="#h0-9-8" id="h0-9-8" class="i">+&quot;checksum utf8parse 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8772a4ccbb4e89959023bc5b7cb8623a795caa7092d99f3aa9501b9484d4557d&quot;
</a> &quot;checksum uuid 0.7.4 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;90dbc611eb48397705a6b0f6e917da23ae517e4d127123d2cf7674206627d32a&quot;
 &quot;checksum vec_map 0.8.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;05c78687fb1a80548ae3250346c3db86a80a7cdd77bda190189f2d0a0987c81a&quot;
 &quot;checksum version_check 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;914b1a6776c4c929a602fafd8bc742e06365d4bcbe48c30f9cca5824f70dc9dd&quot;
<b>diff --git a/<a id="h1" href="../file/Cargo.toml.html">Cargo.toml</a> b/<a href="../file/Cargo.toml.html">Cargo.toml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -4,6 +4,7 @@ description = &quot;A distributed SQL database&quot;
</a> version = &quot;0.1.0&quot;
 authors = [&quot;Erik Grinaker &lt;erik@grinaker.org&gt;&quot;]
 edition = &quot;2018&quot;
<a href="#h1-0-3" id="h1-0-3" class="i">+default-run = &quot;toydb&quot;
</a> 
 [dependencies]
 clap = &quot;~2.33.0&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -14,6 +15,7 @@ log = &quot;~0.4.6&quot;
</a> protobuf = &quot;~2.5.0&quot;
 rand = &quot;~0.6.5&quot;
 rmp-serde = &quot;~0.13.7&quot;
<a href="#h1-1-3" id="h1-1-3" class="i">+rustyline = &quot;~5.0.0&quot;
</a> serde = &quot;~1.0.91&quot;
 serde_derive = &quot;~1.0.91&quot;
 simplelog = &quot;~0.6.0&quot;
<b>diff --git a/<a id="h2" href="../file/protobuf/toydb.proto.html">protobuf/toydb.proto</a> b/<a href="../file/protobuf/toydb.proto.html">protobuf/toydb.proto</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -5,6 +5,9 @@ service ToyDB {
</a>   // Status asks the server for its status.
   rpc Status(StatusRequest) returns (StatusResponse) {};
 
<a href="#h2-0-3" id="h2-0-3" class="i">+  // Echo is a simple echo service.
</a><a href="#h2-0-4" id="h2-0-4" class="i">+  rpc Echo(EchoRequest) returns (EchoResponse) {};
</a><a href="#h2-0-5" id="h2-0-5" class="i">+
</a>   // Get is a temporary key-value command.
   rpc Get(GetRequest) returns (GetResponse) {};
 
<a href="#h2-1" id="h2-1" class="h">@@ -20,6 +23,14 @@ message StatusResponse {
</a>   int64 time = 3;
 };
 
<a href="#h2-1-3" id="h2-1-3" class="i">+message EchoRequest {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+  string value = 1;
</a><a href="#h2-1-5" id="h2-1-5" class="i">+};
</a><a href="#h2-1-6" id="h2-1-6" class="i">+
</a><a href="#h2-1-7" id="h2-1-7" class="i">+message EchoResponse {
</a><a href="#h2-1-8" id="h2-1-8" class="i">+  string value = 1;
</a><a href="#h2-1-9" id="h2-1-9" class="i">+}
</a><a href="#h2-1-10" id="h2-1-10" class="i">+
</a> message GetRequest {
   string key = 1;
 }
<b>diff --git a/<a id="h3" href="../file/src/bin/toyc.rs.html">src/bin/toyc.rs</a> b/<a href="../file/src/bin/toyc.rs.html">src/bin/toyc.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,48 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+#![warn(clippy::all)]
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+#[macro_use]
</a><a href="#h3-0-3" id="h3-0-3" class="i">+extern crate clap;
</a><a href="#h3-0-4" id="h3-0-4" class="i">+extern crate rustyline;
</a><a href="#h3-0-5" id="h3-0-5" class="i">+extern crate toydb;
</a><a href="#h3-0-6" id="h3-0-6" class="i">+
</a><a href="#h3-0-7" id="h3-0-7" class="i">+use rustyline::error::ReadlineError;
</a><a href="#h3-0-8" id="h3-0-8" class="i">+
</a><a href="#h3-0-9" id="h3-0-9" class="i">+fn main() -&gt; Result&lt;(), toydb::Error&gt; {
</a><a href="#h3-0-10" id="h3-0-10" class="i">+    let opts = app_from_crate!()
</a><a href="#h3-0-11" id="h3-0-11" class="i">+        .arg(
</a><a href="#h3-0-12" id="h3-0-12" class="i">+            clap::Arg::with_name(&quot;host&quot;)
</a><a href="#h3-0-13" id="h3-0-13" class="i">+                .short(&quot;h&quot;)
</a><a href="#h3-0-14" id="h3-0-14" class="i">+                .long(&quot;host&quot;)
</a><a href="#h3-0-15" id="h3-0-15" class="i">+                .help(&quot;Host to connect to (IP address)&quot;)
</a><a href="#h3-0-16" id="h3-0-16" class="i">+                .takes_value(true)
</a><a href="#h3-0-17" id="h3-0-17" class="i">+                .default_value(&quot;127.0.0.1&quot;),
</a><a href="#h3-0-18" id="h3-0-18" class="i">+        )
</a><a href="#h3-0-19" id="h3-0-19" class="i">+        .arg(
</a><a href="#h3-0-20" id="h3-0-20" class="i">+            clap::Arg::with_name(&quot;port&quot;)
</a><a href="#h3-0-21" id="h3-0-21" class="i">+                .short(&quot;p&quot;)
</a><a href="#h3-0-22" id="h3-0-22" class="i">+                .long(&quot;port&quot;)
</a><a href="#h3-0-23" id="h3-0-23" class="i">+                .help(&quot;Port number to connect to&quot;)
</a><a href="#h3-0-24" id="h3-0-24" class="i">+                .takes_value(true)
</a><a href="#h3-0-25" id="h3-0-25" class="i">+                .default_value(&quot;9605&quot;),
</a><a href="#h3-0-26" id="h3-0-26" class="i">+        )
</a><a href="#h3-0-27" id="h3-0-27" class="i">+        .get_matches();
</a><a href="#h3-0-28" id="h3-0-28" class="i">+
</a><a href="#h3-0-29" id="h3-0-29" class="i">+    let sa = format!(&quot;{}:{}&quot;, opts.value_of(&quot;host&quot;).unwrap(), opts.value_of(&quot;port&quot;).unwrap())
</a><a href="#h3-0-30" id="h3-0-30" class="i">+        .parse::&lt;std::net::SocketAddr&gt;()?;
</a><a href="#h3-0-31" id="h3-0-31" class="i">+
</a><a href="#h3-0-32" id="h3-0-32" class="i">+    let client = toydb::Client::new(sa)?;
</a><a href="#h3-0-33" id="h3-0-33" class="i">+    let mut editor = rustyline::Editor::&lt;()&gt;::new();
</a><a href="#h3-0-34" id="h3-0-34" class="i">+    loop {
</a><a href="#h3-0-35" id="h3-0-35" class="i">+        let query = match editor.readline(&quot;toydb&gt; &quot;) {
</a><a href="#h3-0-36" id="h3-0-36" class="i">+            Ok(input) =&gt; {
</a><a href="#h3-0-37" id="h3-0-37" class="i">+                editor.add_history_entry(&amp;input);
</a><a href="#h3-0-38" id="h3-0-38" class="i">+                input
</a><a href="#h3-0-39" id="h3-0-39" class="i">+            }
</a><a href="#h3-0-40" id="h3-0-40" class="i">+            Err(ReadlineError::Eof) | Err(ReadlineError::Interrupted) =&gt; break,
</a><a href="#h3-0-41" id="h3-0-41" class="i">+            Err(err) =&gt; return Err(err.into()),
</a><a href="#h3-0-42" id="h3-0-42" class="i">+        };
</a><a href="#h3-0-43" id="h3-0-43" class="i">+        let result = client.echo(&amp;query)?;
</a><a href="#h3-0-44" id="h3-0-44" class="i">+        println!(&quot;{}&quot;, result);
</a><a href="#h3-0-45" id="h3-0-45" class="i">+    }
</a><a href="#h3-0-46" id="h3-0-46" class="i">+    Ok(())
</a><a href="#h3-0-47" id="h3-0-47" class="i">+}
</a><b>diff --git a/<a id="h4" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,31 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+use crate::service;
</a><a href="#h4-0-1" id="h4-0-1" class="i">+use crate::Error;
</a><a href="#h4-0-2" id="h4-0-2" class="i">+use grpc::ClientStubExt;
</a><a href="#h4-0-3" id="h4-0-3" class="i">+use service::ToyDB;
</a><a href="#h4-0-4" id="h4-0-4" class="i">+
</a><a href="#h4-0-5" id="h4-0-5" class="i">+/// A ToyDB client
</a><a href="#h4-0-6" id="h4-0-6" class="i">+pub struct Client {
</a><a href="#h4-0-7" id="h4-0-7" class="i">+    client: service::ToyDBClient,
</a><a href="#h4-0-8" id="h4-0-8" class="i">+}
</a><a href="#h4-0-9" id="h4-0-9" class="i">+
</a><a href="#h4-0-10" id="h4-0-10" class="i">+impl Client {
</a><a href="#h4-0-11" id="h4-0-11" class="i">+    /// Creates a new client
</a><a href="#h4-0-12" id="h4-0-12" class="i">+    pub fn new(addr: std::net::SocketAddr) -&gt; Result&lt;Self, Error&gt; {
</a><a href="#h4-0-13" id="h4-0-13" class="i">+        Ok(Self {
</a><a href="#h4-0-14" id="h4-0-14" class="i">+            client: service::ToyDBClient::new_plain(
</a><a href="#h4-0-15" id="h4-0-15" class="i">+                &amp;addr.ip().to_string(),
</a><a href="#h4-0-16" id="h4-0-16" class="i">+                addr.port(),
</a><a href="#h4-0-17" id="h4-0-17" class="i">+                grpc::ClientConf::new(),
</a><a href="#h4-0-18" id="h4-0-18" class="i">+            )?,
</a><a href="#h4-0-19" id="h4-0-19" class="i">+        })
</a><a href="#h4-0-20" id="h4-0-20" class="i">+    }
</a><a href="#h4-0-21" id="h4-0-21" class="i">+
</a><a href="#h4-0-22" id="h4-0-22" class="i">+    /// Runs an echo request
</a><a href="#h4-0-23" id="h4-0-23" class="i">+    pub fn echo(&amp;self, value: &amp;str) -&gt; Result&lt;String, Error&gt; {
</a><a href="#h4-0-24" id="h4-0-24" class="i">+        let (_, resp, _) = self.client.echo(
</a><a href="#h4-0-25" id="h4-0-25" class="i">+            grpc::RequestOptions::new(),
</a><a href="#h4-0-26" id="h4-0-26" class="i">+            service::EchoRequest { value: value.to_owned(), ..Default::default() },
</a><a href="#h4-0-27" id="h4-0-27" class="i">+        ).wait()?;
</a><a href="#h4-0-28" id="h4-0-28" class="i">+        Ok(resp.value)
</a><a href="#h4-0-29" id="h4-0-29" class="i">+    }
</a><a href="#h4-0-30" id="h4-0-30" class="i">+}
</a><b>diff --git a/<a id="h5" href="../file/src/error.rs.html">src/error.rs</a> b/<a href="../file/src/error.rs.html">src/error.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -83,6 +83,12 @@ impl From&lt;rmps::encode::Error&gt; for Error {
</a>     }
 }
 
<a href="#h5-0-3" id="h5-0-3" class="i">+impl From&lt;rustyline::error::ReadlineError&gt; for Error {
</a><a href="#h5-0-4" id="h5-0-4" class="i">+    fn from(err: rustyline::error::ReadlineError) -&gt; Self {
</a><a href="#h5-0-5" id="h5-0-5" class="i">+        Error::Internal(err.to_string())
</a><a href="#h5-0-6" id="h5-0-6" class="i">+    }
</a><a href="#h5-0-7" id="h5-0-7" class="i">+}
</a><a href="#h5-0-8" id="h5-0-8" class="i">+
</a> impl From&lt;std::io::Error&gt; for Error {
     fn from(err: std::io::Error) -&gt; Self {
         Error::IO(err.to_string())
<b>diff --git a/<a id="h6" href="../file/src/lib.rs.html">src/lib.rs</a> b/<a href="../file/src/lib.rs.html">src/lib.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -11,9 +11,11 @@ extern crate httpbis;
</a> extern crate log;
 extern crate rand;
 extern crate rmp_serde as rmps;
<a href="#h6-0-3" id="h6-0-3" class="i">+extern crate rustyline;
</a> extern crate serde;
 extern crate uuid;
 
<a href="#h6-0-7" id="h6-0-7" class="i">+mod client;
</a> mod error;
 mod kv;
 mod raft;
<a href="#h6-1" id="h6-1" class="h">@@ -22,5 +24,6 @@ mod service;
</a> mod state;
 mod utility;
 
<a href="#h6-1-3" id="h6-1-3" class="i">+pub use client::Client;
</a> pub use error::Error;
 pub use server::Server;
<b>diff --git a/<a id="h7" href="../file/src/server/raft.rs.html">src/server/raft.rs</a> b/<a href="../file/src/server/raft.rs.html">src/server/raft.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -24,6 +24,7 @@ impl Transport for GRPC {
</a>     fn send(&amp;self, msg: Message) -&gt; Result&lt;(), Error&gt; {
         if let Some(to) = &amp;msg.to {
             if let Some(client) = self.peers.get(to) {
<a href="#h7-0-3" id="h7-0-3" class="i">+                // FIXME Needs to check the response.
</a>                 client.step(grpc::RequestOptions::new(), message_to_protobuf(msg));
                 Ok(())
             } else {
<a href="#h7-1" id="h7-1" class="h">@@ -87,9 +88,10 @@ fn message_from_protobuf(pb: service::Message) -&gt; Result&lt;Message, Error&gt; {
</a>             Some(service::Message_oneof_event::heartbeat(e)) =&gt; {
                 Event::Heartbeat { commit_index: e.commit_index, commit_term: e.commit_term }
             }
<a href="#h7-1-3" id="h7-1-3" class="d">-            Some(service::Message_oneof_event::confirm_leader(e)) =&gt; {
</a><a href="#h7-1-4" id="h7-1-4" class="d">-                Event::ConfirmLeader { commit_index: e.commit_index, has_committed: e.has_committed }
</a><a href="#h7-1-5" id="h7-1-5" class="d">-            }
</a><a href="#h7-1-6" id="h7-1-6" class="i">+            Some(service::Message_oneof_event::confirm_leader(e)) =&gt; Event::ConfirmLeader {
</a><a href="#h7-1-7" id="h7-1-7" class="i">+                commit_index: e.commit_index,
</a><a href="#h7-1-8" id="h7-1-8" class="i">+                has_committed: e.has_committed,
</a><a href="#h7-1-9" id="h7-1-9" class="i">+            },
</a>             Some(service::Message_oneof_event::solicit_vote(e)) =&gt; {
                 Event::SolicitVote { last_index: e.last_index, last_term: e.last_term }
             }
<b>diff --git a/<a id="h8" href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a> b/<a href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,5 +1,5 @@
</a><a href="#h8-0-0" id="h8-0-0" class="d">-use crate::service;
</a> use crate::raft::Raft;
<a href="#h8-0-2" id="h8-0-2" class="i">+use crate::service;
</a> use crate::state;
 
 pub struct ToyDB {
<a href="#h8-1" id="h8-1" class="h">@@ -8,6 +8,15 @@ pub struct ToyDB {
</a> }
 
 impl service::ToyDB for ToyDB {
<a href="#h8-1-3" id="h8-1-3" class="i">+    fn echo(
</a><a href="#h8-1-4" id="h8-1-4" class="i">+        &amp;self,
</a><a href="#h8-1-5" id="h8-1-5" class="i">+        _: grpc::RequestOptions,
</a><a href="#h8-1-6" id="h8-1-6" class="i">+        req: service::EchoRequest,
</a><a href="#h8-1-7" id="h8-1-7" class="i">+    ) -&gt; grpc::SingleResponse&lt;service::EchoResponse&gt; {
</a><a href="#h8-1-8" id="h8-1-8" class="i">+        let value = req.value.clone();
</a><a href="#h8-1-9" id="h8-1-9" class="i">+        grpc::SingleResponse::completed(service::EchoResponse { value, ..Default::default() })
</a><a href="#h8-1-10" id="h8-1-10" class="i">+    }
</a><a href="#h8-1-11" id="h8-1-11" class="i">+
</a>     fn get(
         &amp;self,
         _: grpc::RequestOptions,
</pre>
</div>
</body>
</html>
