<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>add bank test (fixes #9) - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/53e73b92e344e3af722d4b9ce5e077272070e099.html">53e73b92e344e3af722d4b9ce5e077272070e099</a>
<b>parent</b> <a href="../commit/4365d6f667f7b49dc1eb7ba76e1660bf17a3b37d.html">4365d6f667f7b49dc1eb7ba76e1660bf17a3b37d</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Thu,  9 Apr 2020 17:31:09 +0200

add bank test (fixes #9)

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Cargo.lock</a></td><td> | </td><td class="num">188</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Cargo.toml</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">src/bin/bank.rs</a></td><td> | </td><td class="num">268</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>3 files changed, 459 insertions(+), 1 deletion(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Cargo.lock.html">Cargo.lock</a> b/<a href="../file/Cargo.lock.html">Cargo.lock</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -23,6 +23,14 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> 
 [[package]]
 name = &quot;arrayvec&quot;
<a href="#h0-0-3" id="h0-0-3" class="i">+version = &quot;0.4.12&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+dependencies = [
</a><a href="#h0-0-6" id="h0-0-6" class="i">+ &quot;nodrop 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-7" id="h0-0-7" class="i">+]
</a><a href="#h0-0-8" id="h0-0-8" class="i">+
</a><a href="#h0-0-9" id="h0-0-9" class="i">+[[package]]
</a><a href="#h0-0-10" id="h0-0-10" class="i">+name = &quot;arrayvec&quot;
</a> version = &quot;0.5.1&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 
<a href="#h0-1" id="h0-1" class="h">@@ -152,6 +160,29 @@ version = &quot;0.1.5&quot;
</a> source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 
 [[package]]
<a href="#h0-1-3" id="h0-1-3" class="i">+name = &quot;crossbeam&quot;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+version = &quot;0.4.1&quot;
</a><a href="#h0-1-5" id="h0-1-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-1-6" id="h0-1-6" class="i">+dependencies = [
</a><a href="#h0-1-7" id="h0-1-7" class="i">+ &quot;crossbeam-channel 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-8" id="h0-1-8" class="i">+ &quot;crossbeam-deque 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-9" id="h0-1-9" class="i">+ &quot;crossbeam-epoch 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-10" id="h0-1-10" class="i">+ &quot;crossbeam-utils 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-11" id="h0-1-11" class="i">+]
</a><a href="#h0-1-12" id="h0-1-12" class="i">+
</a><a href="#h0-1-13" id="h0-1-13" class="i">+[[package]]
</a><a href="#h0-1-14" id="h0-1-14" class="i">+name = &quot;crossbeam-channel&quot;
</a><a href="#h0-1-15" id="h0-1-15" class="i">+version = &quot;0.2.6&quot;
</a><a href="#h0-1-16" id="h0-1-16" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-1-17" id="h0-1-17" class="i">+dependencies = [
</a><a href="#h0-1-18" id="h0-1-18" class="i">+ &quot;crossbeam-epoch 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-19" id="h0-1-19" class="i">+ &quot;crossbeam-utils 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-20" id="h0-1-20" class="i">+ &quot;parking_lot 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-21" id="h0-1-21" class="i">+ &quot;rand 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-22" id="h0-1-22" class="i">+ &quot;smallvec 0.6.13 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-1-23" id="h0-1-23" class="i">+]
</a><a href="#h0-1-24" id="h0-1-24" class="i">+
</a><a href="#h0-1-25" id="h0-1-25" class="i">+[[package]]
</a> name = &quot;crossbeam-channel&quot;
 version = &quot;0.4.2&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-2" id="h0-2" class="h">@@ -162,6 +193,15 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;crossbeam-deque&quot;
<a href="#h0-2-3" id="h0-2-3" class="i">+version = &quot;0.5.2&quot;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-2-5" id="h0-2-5" class="i">+dependencies = [
</a><a href="#h0-2-6" id="h0-2-6" class="i">+ &quot;crossbeam-epoch 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-7" id="h0-2-7" class="i">+ &quot;crossbeam-utils 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-2-8" id="h0-2-8" class="i">+]
</a><a href="#h0-2-9" id="h0-2-9" class="i">+
</a><a href="#h0-2-10" id="h0-2-10" class="i">+[[package]]
</a><a href="#h0-2-11" id="h0-2-11" class="i">+name = &quot;crossbeam-deque&quot;
</a> version = &quot;0.7.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-3" id="h0-3" class="h">@@ -172,6 +212,32 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;crossbeam-epoch&quot;
<a href="#h0-3-3" id="h0-3-3" class="i">+version = &quot;0.5.2&quot;
</a><a href="#h0-3-4" id="h0-3-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-3-5" id="h0-3-5" class="i">+dependencies = [
</a><a href="#h0-3-6" id="h0-3-6" class="i">+ &quot;arrayvec 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-7" id="h0-3-7" class="i">+ &quot;cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-8" id="h0-3-8" class="i">+ &quot;crossbeam-utils 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-9" id="h0-3-9" class="i">+ &quot;lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-10" id="h0-3-10" class="i">+ &quot;memoffset 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-11" id="h0-3-11" class="i">+ &quot;scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-12" id="h0-3-12" class="i">+]
</a><a href="#h0-3-13" id="h0-3-13" class="i">+
</a><a href="#h0-3-14" id="h0-3-14" class="i">+[[package]]
</a><a href="#h0-3-15" id="h0-3-15" class="i">+name = &quot;crossbeam-epoch&quot;
</a><a href="#h0-3-16" id="h0-3-16" class="i">+version = &quot;0.6.1&quot;
</a><a href="#h0-3-17" id="h0-3-17" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-3-18" id="h0-3-18" class="i">+dependencies = [
</a><a href="#h0-3-19" id="h0-3-19" class="i">+ &quot;arrayvec 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-20" id="h0-3-20" class="i">+ &quot;cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-21" id="h0-3-21" class="i">+ &quot;crossbeam-utils 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-22" id="h0-3-22" class="i">+ &quot;lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-23" id="h0-3-23" class="i">+ &quot;memoffset 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-24" id="h0-3-24" class="i">+ &quot;scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-3-25" id="h0-3-25" class="i">+]
</a><a href="#h0-3-26" id="h0-3-26" class="i">+
</a><a href="#h0-3-27" id="h0-3-27" class="i">+[[package]]
</a><a href="#h0-3-28" id="h0-3-28" class="i">+name = &quot;crossbeam-epoch&quot;
</a> version = &quot;0.8.2&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-4" id="h0-4" class="h">@@ -195,6 +261,20 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;crossbeam-utils&quot;
<a href="#h0-4-3" id="h0-4-3" class="i">+version = &quot;0.5.0&quot;
</a><a href="#h0-4-4" id="h0-4-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-4-5" id="h0-4-5" class="i">+
</a><a href="#h0-4-6" id="h0-4-6" class="i">+[[package]]
</a><a href="#h0-4-7" id="h0-4-7" class="i">+name = &quot;crossbeam-utils&quot;
</a><a href="#h0-4-8" id="h0-4-8" class="i">+version = &quot;0.6.6&quot;
</a><a href="#h0-4-9" id="h0-4-9" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-4-10" id="h0-4-10" class="i">+dependencies = [
</a><a href="#h0-4-11" id="h0-4-11" class="i">+ &quot;cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-4-12" id="h0-4-12" class="i">+ &quot;lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-4-13" id="h0-4-13" class="i">+]
</a><a href="#h0-4-14" id="h0-4-14" class="i">+
</a><a href="#h0-4-15" id="h0-4-15" class="i">+[[package]]
</a><a href="#h0-4-16" id="h0-4-16" class="i">+name = &quot;crossbeam-utils&quot;
</a> version = &quot;0.7.2&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-5" id="h0-5" class="h">@@ -395,6 +475,15 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> 
 [[package]]
 name = &quot;lock_api&quot;
<a href="#h0-5-3" id="h0-5-3" class="i">+version = &quot;0.1.5&quot;
</a><a href="#h0-5-4" id="h0-5-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-5-5" id="h0-5-5" class="i">+dependencies = [
</a><a href="#h0-5-6" id="h0-5-6" class="i">+ &quot;owning_ref 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-5-7" id="h0-5-7" class="i">+ &quot;scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-5-8" id="h0-5-8" class="i">+]
</a><a href="#h0-5-9" id="h0-5-9" class="i">+
</a><a href="#h0-5-10" id="h0-5-10" class="i">+[[package]]
</a><a href="#h0-5-11" id="h0-5-11" class="i">+name = &quot;lock_api&quot;
</a> version = &quot;0.3.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-6" id="h0-6" class="h">@@ -429,6 +518,11 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> 
 [[package]]
 name = &quot;memoffset&quot;
<a href="#h0-6-3" id="h0-6-3" class="i">+version = &quot;0.2.1&quot;
</a><a href="#h0-6-4" id="h0-6-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-6-5" id="h0-6-5" class="i">+
</a><a href="#h0-6-6" id="h0-6-6" class="i">+[[package]]
</a><a href="#h0-6-7" id="h0-6-7" class="i">+name = &quot;memoffset&quot;
</a> version = &quot;0.5.4&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-7" id="h0-7" class="h">@@ -475,6 +569,14 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-7-3" id="h0-7-3" class="i">+name = &quot;names&quot;
</a><a href="#h0-7-4" id="h0-7-4" class="i">+version = &quot;0.9.0&quot;
</a><a href="#h0-7-5" id="h0-7-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-7-6" id="h0-7-6" class="i">+dependencies = [
</a><a href="#h0-7-7" id="h0-7-7" class="i">+ &quot;rand 0.3.23 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-7-8" id="h0-7-8" class="i">+]
</a><a href="#h0-7-9" id="h0-7-9" class="i">+
</a><a href="#h0-7-10" id="h0-7-10" class="i">+[[package]]
</a> name = &quot;net2&quot;
 version = &quot;0.2.33&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-8" id="h0-8" class="h">@@ -497,6 +599,11 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-8-3" id="h0-8-3" class="i">+name = &quot;nodrop&quot;
</a><a href="#h0-8-4" id="h0-8-4" class="i">+version = &quot;0.1.14&quot;
</a><a href="#h0-8-5" id="h0-8-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-8-6" id="h0-8-6" class="i">+
</a><a href="#h0-8-7" id="h0-8-7" class="i">+[[package]]
</a> name = &quot;nom&quot;
 version = &quot;4.2.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-9" id="h0-9" class="h">@@ -540,6 +647,23 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-9-3" id="h0-9-3" class="i">+name = &quot;owning_ref&quot;
</a><a href="#h0-9-4" id="h0-9-4" class="i">+version = &quot;0.4.1&quot;
</a><a href="#h0-9-5" id="h0-9-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-9-6" id="h0-9-6" class="i">+dependencies = [
</a><a href="#h0-9-7" id="h0-9-7" class="i">+ &quot;stable_deref_trait 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-9-8" id="h0-9-8" class="i">+]
</a><a href="#h0-9-9" id="h0-9-9" class="i">+
</a><a href="#h0-9-10" id="h0-9-10" class="i">+[[package]]
</a><a href="#h0-9-11" id="h0-9-11" class="i">+name = &quot;parking_lot&quot;
</a><a href="#h0-9-12" id="h0-9-12" class="i">+version = &quot;0.6.4&quot;
</a><a href="#h0-9-13" id="h0-9-13" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-9-14" id="h0-9-14" class="i">+dependencies = [
</a><a href="#h0-9-15" id="h0-9-15" class="i">+ &quot;lock_api 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-9-16" id="h0-9-16" class="i">+ &quot;parking_lot_core 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-9-17" id="h0-9-17" class="i">+]
</a><a href="#h0-9-18" id="h0-9-18" class="i">+
</a><a href="#h0-9-19" id="h0-9-19" class="i">+[[package]]
</a> name = &quot;parking_lot&quot;
 version = &quot;0.9.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-10" id="h0-10" class="h">@@ -551,6 +675,18 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;parking_lot_core&quot;
<a href="#h0-10-3" id="h0-10-3" class="i">+version = &quot;0.3.1&quot;
</a><a href="#h0-10-4" id="h0-10-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-10-5" id="h0-10-5" class="i">+dependencies = [
</a><a href="#h0-10-6" id="h0-10-6" class="i">+ &quot;libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-10-7" id="h0-10-7" class="i">+ &quot;rand 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-10-8" id="h0-10-8" class="i">+ &quot;rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-10-9" id="h0-10-9" class="i">+ &quot;smallvec 0.6.13 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-10-10" id="h0-10-10" class="i">+ &quot;winapi 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-10-11" id="h0-10-11" class="i">+]
</a><a href="#h0-10-12" id="h0-10-12" class="i">+
</a><a href="#h0-10-13" id="h0-10-13" class="i">+[[package]]
</a><a href="#h0-10-14" id="h0-10-14" class="i">+name = &quot;parking_lot_core&quot;
</a> version = &quot;0.6.2&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-11" id="h0-11" class="h">@@ -633,6 +769,15 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;rand&quot;
<a href="#h0-11-3" id="h0-11-3" class="i">+version = &quot;0.3.23&quot;
</a><a href="#h0-11-4" id="h0-11-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-11-5" id="h0-11-5" class="i">+dependencies = [
</a><a href="#h0-11-6" id="h0-11-6" class="i">+ &quot;libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-11-7" id="h0-11-7" class="i">+ &quot;rand 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-11-8" id="h0-11-8" class="i">+]
</a><a href="#h0-11-9" id="h0-11-9" class="i">+
</a><a href="#h0-11-10" id="h0-11-10" class="i">+[[package]]
</a><a href="#h0-11-11" id="h0-11-11" class="i">+name = &quot;rand&quot;
</a> version = &quot;0.4.6&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-12" id="h0-12" class="h">@@ -645,6 +790,18 @@ dependencies = [
</a> 
 [[package]]
 name = &quot;rand&quot;
<a href="#h0-12-3" id="h0-12-3" class="i">+version = &quot;0.5.6&quot;
</a><a href="#h0-12-4" id="h0-12-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-12-5" id="h0-12-5" class="i">+dependencies = [
</a><a href="#h0-12-6" id="h0-12-6" class="i">+ &quot;cloudabi 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-12-7" id="h0-12-7" class="i">+ &quot;fuchsia-cprng 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-12-8" id="h0-12-8" class="i">+ &quot;libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-12-9" id="h0-12-9" class="i">+ &quot;rand_core 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-12-10" id="h0-12-10" class="i">+ &quot;winapi 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-12-11" id="h0-12-11" class="i">+]
</a><a href="#h0-12-12" id="h0-12-12" class="i">+
</a><a href="#h0-12-13" id="h0-12-13" class="i">+[[package]]
</a><a href="#h0-12-14" id="h0-12-14" class="i">+name = &quot;rand&quot;
</a> version = &quot;0.7.3&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 dependencies = [
<a href="#h0-13" id="h0-13" class="h">@@ -817,6 +974,11 @@ source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a> 
 [[package]]
 name = &quot;scopeguard&quot;
<a href="#h0-13-3" id="h0-13-3" class="i">+version = &quot;0.3.3&quot;
</a><a href="#h0-13-4" id="h0-13-4" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-13-5" id="h0-13-5" class="i">+
</a><a href="#h0-13-6" id="h0-13-6" class="i">+[[package]]
</a><a href="#h0-13-7" id="h0-13-7" class="i">+name = &quot;scopeguard&quot;
</a> version = &quot;1.1.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
 
<a href="#h0-14" id="h0-14" class="h">@@ -912,6 +1074,11 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-14-3" id="h0-14-3" class="i">+name = &quot;stable_deref_trait&quot;
</a><a href="#h0-14-4" id="h0-14-4" class="i">+version = &quot;1.1.1&quot;
</a><a href="#h0-14-5" id="h0-14-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-14-6" id="h0-14-6" class="i">+
</a><a href="#h0-14-7" id="h0-14-7" class="i">+[[package]]
</a> name = &quot;strsim&quot;
 version = &quot;0.8.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-15" id="h0-15" class="h">@@ -1237,12 +1404,14 @@ dependencies = [
</a>  &quot;assert_matches 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;clap 2.33.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;config 0.9.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-15-3" id="h0-15-3" class="i">+ &quot;crossbeam 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a>  &quot;crossbeam-channel 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;goldenfile 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;grpc 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;httpbis 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;log 0.4.8 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-15-10" id="h0-15-10" class="i">+ &quot;names 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a>  &quot;protobuf 2.8.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;protoc-rust-grpc 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;rand 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-16" id="h0-16" class="h">@@ -1363,6 +1532,7 @@ dependencies = [
</a> &quot;checksum aho-corasick 0.7.10 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8716408b8bc624ed7f65d223ddb9ac2d044c0547b6fa4b0d554f3a9540496ada&quot;
 &quot;checksum ansi_term 0.11.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ee49baf6cb617b853aa8d93bf420db2383fab46d314482ca2803b40d5fde979b&quot;
 &quot;checksum arrayref 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;a4c527152e37cf757a3f78aae5a06fbeefdb07ccc535c980a3208ee3060dd544&quot;
<a href="#h0-16-3" id="h0-16-3" class="i">+&quot;checksum arrayvec 0.4.12 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;cd9fd44efafa8690358b7408d253adf110036b88f55672a933f01d616ad9b1b9&quot;
</a> &quot;checksum arrayvec 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;cff77d8686867eceff3105329d4698d96c2391c176d5d03adc90c7389162b5b8&quot;
 &quot;checksum assert_matches 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;7deb0a829ca7bcfaf5da70b073a8d128619259a7be8216a355e23f00763059e5&quot;
 &quot;checksum atty 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;d9b39be18770d11421cdb1b9947a45dd3f37e93092cbf377614828a319d5fee8&quot;
<a href="#h0-17" id="h0-17" class="h">@@ -1380,10 +1550,17 @@ dependencies = [
</a> &quot;checksum cloudabi 0.0.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ddfc5b9aa5d4507acaf872de71051dfd0e309860e88966e1051e462a077aac4f&quot;
 &quot;checksum config 0.9.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f9107d78ed62b3fa5a86e7d18e647abed48cfd8f8fab6c72f4cdb982d196f7e6&quot;
 &quot;checksum constant_time_eq 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;245097e9a4535ee1e3e3931fcfcd55a796a44c643e8596ff6566d68f09b87bbc&quot;
<a href="#h0-17-3" id="h0-17-3" class="i">+&quot;checksum crossbeam 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;d7408247b1b87f480890f28b670c5f8d9a8a4274833433fe74dc0dfd46d33650&quot;
</a><a href="#h0-17-4" id="h0-17-4" class="i">+&quot;checksum crossbeam-channel 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;7b85741761b7f160bc5e7e0c14986ef685b7f8bf9b7ad081c60c604bb4649827&quot;
</a> &quot;checksum crossbeam-channel 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;cced8691919c02aac3cb0a1bc2e9b73d89e832bf9a06fc579d4e71b68a2da061&quot;
<a href="#h0-17-6" id="h0-17-6" class="i">+&quot;checksum crossbeam-deque 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;7792c4a9b5a4222f654e3728a3dd945aacc24d2c3a1a096ed265d80e4929cb9a&quot;
</a> &quot;checksum crossbeam-deque 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;9f02af974daeee82218205558e51ec8768b48cf524bd01d550abe5573a608285&quot;
<a href="#h0-17-8" id="h0-17-8" class="i">+&quot;checksum crossbeam-epoch 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;30fecfcac6abfef8771151f8be4abc9e4edc112c2bcb233314cafde2680536e9&quot;
</a><a href="#h0-17-9" id="h0-17-9" class="i">+&quot;checksum crossbeam-epoch 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2449aaa4ec7ef96e5fb24db16024b935df718e9ae1cec0a1e68feeca2efca7b8&quot;
</a> &quot;checksum crossbeam-epoch 0.8.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;058ed274caafc1f60c4997b5fc07bf7dc7cca454af7c6e81edffe5f33f70dace&quot;
 &quot;checksum crossbeam-queue 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c695eeca1e7173472a32221542ae469b3e9aac3a4fc81f7696bcad82029493db&quot;
<a href="#h0-17-12" id="h0-17-12" class="i">+&quot;checksum crossbeam-utils 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;677d453a17e8bd2b913fa38e8b9cf04bcdbb5be790aa294f2389661d72036015&quot;
</a><a href="#h0-17-13" id="h0-17-13" class="i">+&quot;checksum crossbeam-utils 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;04973fa96e96579258a5091af6003abde64af786b860f18622b82e026cca60e6&quot;
</a> &quot;checksum crossbeam-utils 0.7.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c3c7c73a2d1e9fc0886a08b93e98eb643461230d5f1925e4036204d5f2e261a8&quot;
 &quot;checksum difference 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;524cbf6897b527295dff137cec09ecf3a05f4fddffd7dfcd1585403449e74198&quot;
 &quot;checksum dirs 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;13aea89a5c93364a98e9b37b2fa237effbb694d5cfe01c5b70941f7eb087d5e3&quot;
<a href="#h0-18" id="h0-18" class="h">@@ -1408,23 +1585,30 @@ dependencies = [
</a> &quot;checksum libc 0.2.68 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;dea0c0405123bba743ee3f91f49b1c7cfb684eef0da0a50110f758ccf24cdff0&quot;
 &quot;checksum linked-hash-map 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6d262045c5b87c0861b3f004610afd0e2c851e2908d08b6c870cbb9d5f494ecd&quot;
 &quot;checksum linked-hash-map 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ae91b68aebc4ddb91978b11a1b02ddd8602a05ec19002801c5666000e05e0f83&quot;
<a href="#h0-18-3" id="h0-18-3" class="i">+&quot;checksum lock_api 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;62ebf1391f6acad60e5c8b43706dde4582df75c06698ab44511d15016bc2442c&quot;
</a> &quot;checksum lock_api 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;79b2de95ecb4691949fea4716ca53cdbcfccb2c612e19644a8bad05edcf9f47b&quot;
 &quot;checksum log 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;e19e8d5c34a3e0e2223db8e060f9e8264aeeb5c5fc64a4ee9965c062211c024b&quot;
 &quot;checksum log 0.4.8 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;14b6052be84e6b71ab17edffc2eeabf5c2c3ae1fdb464aae35ac50c67a44e1f7&quot;
 &quot;checksum maybe-uninit 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;60302e4db3a61da70c0cb7991976248362f30319e88850c487b9b95bbf059e00&quot;
 &quot;checksum memchr 2.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;3728d817d99e5ac407411fa471ff9800a778d88a24685968b36824eaf4bee400&quot;
<a href="#h0-18-9" id="h0-18-9" class="i">+&quot;checksum memoffset 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;0f9dc261e2b62d7a622bf416ea3c5245cdd5d9a7fcc428c0d06804dfce1775b3&quot;
</a> &quot;checksum memoffset 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;b4fc2c02a7e374099d4ee95a193111f72d2110197fe200272371758f6c3643d8&quot;
 &quot;checksum mio 0.6.21 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;302dec22bcf6bae6dfb69c647187f4b4d0fb6f535521f7bc022430ce8e12008f&quot;
 &quot;checksum mio-uds 0.6.7 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;966257a94e196b11bb43aca423754d87429960a768de9414f3691d6957abf125&quot;
 &quot;checksum miow 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8c1f2f3b1cf331de6896aabf6e9d55dca90356cc9960cca7eaaf408a355ae919&quot;
<a href="#h0-18-14" id="h0-18-14" class="i">+&quot;checksum names 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;efde7fa6db04b8f97c0d56186b7804d4b47681107ce0347615f34acb75b58f1b&quot;
</a> &quot;checksum net2 0.2.33 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;42550d9fb7b6684a6d404d9fa7250c2eb2646df731d1c06afc06dcee9e1bcf88&quot;
 &quot;checksum nix 0.14.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6c722bee1037d430d0f8e687bbdbf222f27cc6e4e68d5caf630857bb2b6dbdce&quot;
<a href="#h0-18-17" id="h0-18-17" class="i">+&quot;checksum nodrop 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;72ef4a56884ca558e5ddb05a1d1e7e1bfd9a68d9ed024c21704cc98872dae1bb&quot;
</a> &quot;checksum nom 4.2.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2ad2a91a8e869eeb30b9cb3119ae87773a8f4ae617f41b1eb9c154b2905f7bd6&quot;
 &quot;checksum num-integer 0.1.42 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;3f6ea62e9d81a77cd3ee9a2a5b9b609447857f3d358704331e4ef39eb247fcba&quot;
 &quot;checksum num-traits 0.1.43 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;92e5113e9fd4cc14ded8e499429f396a20f98c772a47cc8622a736e1ec843c31&quot;
 &quot;checksum num-traits 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c62be47e61d1842b9170f0fdeec8eba98e60e90e5446449a0545e5152acd7096&quot;
 &quot;checksum num_cpus 1.12.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;46203554f085ff89c235cd12f7075f3233af9b11ed7c9e16dfe2560d03313ce6&quot;
<a href="#h0-18-23" id="h0-18-23" class="i">+&quot;checksum owning_ref 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6ff55baddef9e4ad00f88b6c743a2a8062d4c6ade126c2a528644b8e444d52ce&quot;
</a><a href="#h0-18-24" id="h0-18-24" class="i">+&quot;checksum parking_lot 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f0802bff09003b291ba756dc7e79313e51cc31667e94afbe847def490424cde5&quot;
</a> &quot;checksum parking_lot 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f842b1982eb6c2fe34036a4fbfb06dd185a3f5c8edfaacdf7d1ea10b07de6252&quot;
<a href="#h0-18-26" id="h0-18-26" class="i">+&quot;checksum parking_lot_core 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ad7f7e6ebdc79edff6fdcb87a55b620174f7a989e3eb31b65231f4af57f00b8c&quot;
</a> &quot;checksum parking_lot_core 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;b876b1b9e7ac6e1a74a6da34d25c42e17e8862aa409cbbbdcfc8d86c6f3bc62b&quot;
 &quot;checksum ppv-lite86 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;74490b50b9fbe561ac330df47c08f3f33073d2d00c150f719147d7c54522fa1b&quot;
 &quot;checksum proc-macro2 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6c09721c6781493a2a492a96b5a5bf19b65917fe6728884e7c44dd0c60ca3435&quot;
<a href="#h0-19" id="h0-19" class="h">@@ -1434,7 +1618,9 @@ dependencies = [
</a> &quot;checksum protoc-rust 2.8.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;bea851ddc77c57935a586099f6e1f8bd7b4d366379498f25b8882ed02e0222bf&quot;
 &quot;checksum protoc-rust-grpc 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6b959e379834057693e0e5a228bc3939aa8e4fee895da1531f69b6e7e74c80d6&quot;
 &quot;checksum quote 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;2bdc6c187c65bca4260c9011c9e3132efe4909da44726bad24cf7572ae338d7f&quot;
<a href="#h0-19-3" id="h0-19-3" class="i">+&quot;checksum rand 0.3.23 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;64ac302d8f83c0c1974bf758f6b041c6c8ada916fbb44a609158ca8b064cc76c&quot;
</a> &quot;checksum rand 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;552840b97013b1a26992c11eac34bdd778e464601a4c2054b5f0bff7c6761293&quot;
<a href="#h0-19-5" id="h0-19-5" class="i">+&quot;checksum rand 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c618c47cd3ebd209790115ab837de41425723956ad3ce2e6a7f09890947cacb9&quot;
</a> &quot;checksum rand 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;6a6b1679d49b24bbfe0c803429aa1874472f50d9b363131f0e89fc356b544d03&quot;
 &quot;checksum rand_chacha 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f4c8ed856279c9737206bf725bf36935d8666ead7aa69b52be55af369d193402&quot;
 &quot;checksum rand_core 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;7a6fdeb83b075e8266dcc8762c22776f6877a63111121f5f8c7411e5be7eed4b&quot;
<a href="#h0-20" id="h0-20" class="h">@@ -1456,6 +1642,7 @@ dependencies = [
</a> &quot;checksum ryu 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;535622e6be132bccd223f4bb2b8ac8d53cda3c7a6394944d3b2b33fb974f9d76&quot;
 &quot;checksum safemem 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;ef703b7cb59335eae2eb93ceb664c0eb7ea6bf567079d843e09420219668e072&quot;
 &quot;checksum scoped-tls 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;332ffa32bf586782a3efaeb58f127980944bbc8c4d6913a86107ac2a5ab24b28&quot;
<a href="#h0-20-3" id="h0-20-3" class="i">+&quot;checksum scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;94258f53601af11e6a49f722422f6e3425c52b06245a5cf9bc09908b174f5e27&quot;
</a> &quot;checksum scopeguard 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;d29ab0c6d3fc0ee92fe66e2d99f700eab17a8d57d1c1d3b748380fb20baa78cd&quot;
 &quot;checksum semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403&quot;
 &quot;checksum semver-parser 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3&quot;
<a href="#h0-21" id="h0-21" class="h">@@ -1469,6 +1656,7 @@ dependencies = [
</a> &quot;checksum slab 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;17b4fcaed89ab08ef143da37bc52adbcc04d4a69014f4c1208d6b51f0c47bc23&quot;
 &quot;checksum slab 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c111b5bd5695e56cffe5129854aa230b39c93a305372fdbb2668ca2394eea9f8&quot;
 &quot;checksum smallvec 0.6.13 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f7b0758c52e15a8b5e3691eae6cc559f08eee9406e548a4477ba4e67770a82b6&quot;
<a href="#h0-21-3" id="h0-21-3" class="i">+&quot;checksum stable_deref_trait 1.1.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;dba1a27d3efae4351c8051072d619e3ade2820635c3958d826bfea39d59b54c8&quot;
</a> &quot;checksum strsim 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;8ea5119cdb4c55b55d432abb513a0429384878c15dde60cc77b1c99de1a95a6a&quot;
 &quot;checksum syn 1.0.17 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;0df0eb663f387145cab623dea85b09c2c5b4b0aef44e945d928e682fce71bb03&quot;
 &quot;checksum tempdir 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;15f2b5fb00ccdf689e0149d1b1b3c03fead81c2b37735d812fa8bddbbf41b6d8&quot;
<b>diff --git a/<a id="h1" href="../file/Cargo.toml.html">Cargo.toml</a> b/<a href="../file/Cargo.toml.html">Cargo.toml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -9,10 +9,12 @@ default-run = &quot;toydb&quot;
</a> [dependencies]
 clap = &quot;~2.33.0&quot;
 config = &quot;~0.9.3&quot;
<a href="#h1-0-3" id="h1-0-3" class="d">-crossbeam-channel = &quot;~0.4.0&quot;
</a><a href="#h1-0-4" id="h1-0-4" class="i">+crossbeam = &quot;~0.4.0&quot;
</a><a href="#h1-0-5" id="h1-0-5" class="i">+crossbeam-channel = &quot;~0.4.0&quot; # FIXME Use crossbeam instead
</a> grpc = &quot;~0.6.1&quot;
 lazy_static = &quot;~1.4.0&quot;
 log = &quot;~0.4.6&quot;
<a href="#h1-0-9" id="h1-0-9" class="i">+names = &quot;0.9.0&quot;
</a> protobuf = &quot;~2.8.1&quot;
 rand = &quot;~0.7.2&quot;
 regex = &quot;~1.3.1&quot;
<b>diff --git a/<a id="h2" href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a> b/<a href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,268 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+/*
</a><a href="#h2-0-1" id="h2-0-1" class="i">+ * Simulates a bank, by setting a set of accounts and making transfers between them. Records the
</a><a href="#h2-0-2" id="h2-0-2" class="i">+ * transaction throughput and checks invariants.
</a><a href="#h2-0-3" id="h2-0-3" class="i">+ */
</a><a href="#h2-0-4" id="h2-0-4" class="i">+
</a><a href="#h2-0-5" id="h2-0-5" class="i">+#![warn(clippy::all)]
</a><a href="#h2-0-6" id="h2-0-6" class="i">+
</a><a href="#h2-0-7" id="h2-0-7" class="i">+#[macro_use]
</a><a href="#h2-0-8" id="h2-0-8" class="i">+extern crate clap;
</a><a href="#h2-0-9" id="h2-0-9" class="i">+extern crate crossbeam;
</a><a href="#h2-0-10" id="h2-0-10" class="i">+extern crate names;
</a><a href="#h2-0-11" id="h2-0-11" class="i">+extern crate rand;
</a><a href="#h2-0-12" id="h2-0-12" class="i">+extern crate toydb;
</a><a href="#h2-0-13" id="h2-0-13" class="i">+
</a><a href="#h2-0-14" id="h2-0-14" class="i">+use rand::distributions::Distribution;
</a><a href="#h2-0-15" id="h2-0-15" class="i">+use rand::prelude::*;
</a><a href="#h2-0-16" id="h2-0-16" class="i">+use toydb::client::{Row, Value};
</a><a href="#h2-0-17" id="h2-0-17" class="i">+use toydb::Error;
</a><a href="#h2-0-18" id="h2-0-18" class="i">+
</a><a href="#h2-0-19" id="h2-0-19" class="i">+fn main() -&gt; Result&lt;(), Error&gt; {
</a><a href="#h2-0-20" id="h2-0-20" class="i">+    let opts = app_from_crate!()
</a><a href="#h2-0-21" id="h2-0-21" class="i">+        .arg(clap::Arg::with_name(&quot;command&quot;))
</a><a href="#h2-0-22" id="h2-0-22" class="i">+        .arg(clap::Arg::with_name(&quot;headers&quot;).short(&quot;H&quot;).long(&quot;headers&quot;).help(&quot;Show column headers&quot;))
</a><a href="#h2-0-23" id="h2-0-23" class="i">+        .arg(
</a><a href="#h2-0-24" id="h2-0-24" class="i">+            clap::Arg::with_name(&quot;host&quot;)
</a><a href="#h2-0-25" id="h2-0-25" class="i">+                .short(&quot;h&quot;)
</a><a href="#h2-0-26" id="h2-0-26" class="i">+                .long(&quot;host&quot;)
</a><a href="#h2-0-27" id="h2-0-27" class="i">+                .help(&quot;Host to connect to&quot;)
</a><a href="#h2-0-28" id="h2-0-28" class="i">+                .takes_value(true)
</a><a href="#h2-0-29" id="h2-0-29" class="i">+                .required(true)
</a><a href="#h2-0-30" id="h2-0-30" class="i">+                .default_value(&quot;127.0.0.1&quot;),
</a><a href="#h2-0-31" id="h2-0-31" class="i">+        )
</a><a href="#h2-0-32" id="h2-0-32" class="i">+        .arg(
</a><a href="#h2-0-33" id="h2-0-33" class="i">+            clap::Arg::with_name(&quot;port&quot;)
</a><a href="#h2-0-34" id="h2-0-34" class="i">+                .short(&quot;p&quot;)
</a><a href="#h2-0-35" id="h2-0-35" class="i">+                .long(&quot;port&quot;)
</a><a href="#h2-0-36" id="h2-0-36" class="i">+                .help(&quot;Port number to connect to&quot;)
</a><a href="#h2-0-37" id="h2-0-37" class="i">+                .takes_value(true)
</a><a href="#h2-0-38" id="h2-0-38" class="i">+                .required(true)
</a><a href="#h2-0-39" id="h2-0-39" class="i">+                .default_value(&quot;9605&quot;),
</a><a href="#h2-0-40" id="h2-0-40" class="i">+        )
</a><a href="#h2-0-41" id="h2-0-41" class="i">+        .arg(
</a><a href="#h2-0-42" id="h2-0-42" class="i">+            clap::Arg::with_name(&quot;concurrency&quot;)
</a><a href="#h2-0-43" id="h2-0-43" class="i">+                .short(&quot;c&quot;)
</a><a href="#h2-0-44" id="h2-0-44" class="i">+                .long(&quot;concurrency&quot;)
</a><a href="#h2-0-45" id="h2-0-45" class="i">+                .help(&quot;Concurrent workers to spawn&quot;)
</a><a href="#h2-0-46" id="h2-0-46" class="i">+                .takes_value(true)
</a><a href="#h2-0-47" id="h2-0-47" class="i">+                .required(true)
</a><a href="#h2-0-48" id="h2-0-48" class="i">+                .default_value(&quot;1&quot;),
</a><a href="#h2-0-49" id="h2-0-49" class="i">+        )
</a><a href="#h2-0-50" id="h2-0-50" class="i">+        .arg(
</a><a href="#h2-0-51" id="h2-0-51" class="i">+            clap::Arg::with_name(&quot;transactions&quot;)
</a><a href="#h2-0-52" id="h2-0-52" class="i">+                .short(&quot;t&quot;)
</a><a href="#h2-0-53" id="h2-0-53" class="i">+                .long(&quot;transactions&quot;)
</a><a href="#h2-0-54" id="h2-0-54" class="i">+                .help(&quot;Number of account transfers to execute&quot;)
</a><a href="#h2-0-55" id="h2-0-55" class="i">+                .takes_value(true)
</a><a href="#h2-0-56" id="h2-0-56" class="i">+                .required(true)
</a><a href="#h2-0-57" id="h2-0-57" class="i">+                .default_value(&quot;20&quot;),
</a><a href="#h2-0-58" id="h2-0-58" class="i">+        )
</a><a href="#h2-0-59" id="h2-0-59" class="i">+        .get_matches();
</a><a href="#h2-0-60" id="h2-0-60" class="i">+
</a><a href="#h2-0-61" id="h2-0-61" class="i">+    Bank::new(opts.value_of(&quot;host&quot;).unwrap(), opts.value_of(&quot;port&quot;).unwrap().parse()?)?.run(
</a><a href="#h2-0-62" id="h2-0-62" class="i">+        opts.value_of(&quot;concurrency&quot;).unwrap().parse()?,
</a><a href="#h2-0-63" id="h2-0-63" class="i">+        opts.value_of(&quot;transactions&quot;).unwrap().parse()?,
</a><a href="#h2-0-64" id="h2-0-64" class="i">+    )
</a><a href="#h2-0-65" id="h2-0-65" class="i">+}
</a><a href="#h2-0-66" id="h2-0-66" class="i">+
</a><a href="#h2-0-67" id="h2-0-67" class="i">+struct Bank {
</a><a href="#h2-0-68" id="h2-0-68" class="i">+    host: String,
</a><a href="#h2-0-69" id="h2-0-69" class="i">+    port: u16,
</a><a href="#h2-0-70" id="h2-0-70" class="i">+    customers: i64,
</a><a href="#h2-0-71" id="h2-0-71" class="i">+    customer_accounts: i64,
</a><a href="#h2-0-72" id="h2-0-72" class="i">+    initial_balance: i64,
</a><a href="#h2-0-73" id="h2-0-73" class="i">+}
</a><a href="#h2-0-74" id="h2-0-74" class="i">+
</a><a href="#h2-0-75" id="h2-0-75" class="i">+impl Bank {
</a><a href="#h2-0-76" id="h2-0-76" class="i">+    // Creates a new bank simulation
</a><a href="#h2-0-77" id="h2-0-77" class="i">+    fn new(host: &amp;str, port: u16) -&gt; Result&lt;Self, Error&gt; {
</a><a href="#h2-0-78" id="h2-0-78" class="i">+        Ok(Self {
</a><a href="#h2-0-79" id="h2-0-79" class="i">+            host: host.to_string(),
</a><a href="#h2-0-80" id="h2-0-80" class="i">+            port,
</a><a href="#h2-0-81" id="h2-0-81" class="i">+            customers: 10,
</a><a href="#h2-0-82" id="h2-0-82" class="i">+            customer_accounts: 10,
</a><a href="#h2-0-83" id="h2-0-83" class="i">+            initial_balance: 100,
</a><a href="#h2-0-84" id="h2-0-84" class="i">+        })
</a><a href="#h2-0-85" id="h2-0-85" class="i">+    }
</a><a href="#h2-0-86" id="h2-0-86" class="i">+
</a><a href="#h2-0-87" id="h2-0-87" class="i">+    // Creates a new client
</a><a href="#h2-0-88" id="h2-0-88" class="i">+    fn client(&amp;self) -&gt; Result&lt;toydb::Client, Error&gt; {
</a><a href="#h2-0-89" id="h2-0-89" class="i">+        toydb::Client::new(&amp;self.host, self.port)
</a><a href="#h2-0-90" id="h2-0-90" class="i">+    }
</a><a href="#h2-0-91" id="h2-0-91" class="i">+
</a><a href="#h2-0-92" id="h2-0-92" class="i">+    // Runs the bank simulation
</a><a href="#h2-0-93" id="h2-0-93" class="i">+    fn run(&amp;self, concurrency: i64, transactions: i64) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h2-0-94" id="h2-0-94" class="i">+        self.setup()?;
</a><a href="#h2-0-95" id="h2-0-95" class="i">+        self.check()?;
</a><a href="#h2-0-96" id="h2-0-96" class="i">+
</a><a href="#h2-0-97" id="h2-0-97" class="i">+        let start = std::time::Instant::now();
</a><a href="#h2-0-98" id="h2-0-98" class="i">+
</a><a href="#h2-0-99" id="h2-0-99" class="i">+        crossbeam::thread::scope(|scope| {
</a><a href="#h2-0-100" id="h2-0-100" class="i">+            let (tx, rx) = crossbeam::channel::unbounded();
</a><a href="#h2-0-101" id="h2-0-101" class="i">+            scope.spawn(move || {
</a><a href="#h2-0-102" id="h2-0-102" class="i">+                let dist = rand::distributions::Uniform::from(0..self.customers);
</a><a href="#h2-0-103" id="h2-0-103" class="i">+                let mut rng = rand::thread_rng();
</a><a href="#h2-0-104" id="h2-0-104" class="i">+                for _ in 0..transactions {
</a><a href="#h2-0-105" id="h2-0-105" class="i">+                    let from = dist.sample(&amp;mut rng);
</a><a href="#h2-0-106" id="h2-0-106" class="i">+                    let mut to = dist.sample(&amp;mut rng);
</a><a href="#h2-0-107" id="h2-0-107" class="i">+                    while from == to {
</a><a href="#h2-0-108" id="h2-0-108" class="i">+                        to = dist.sample(&amp;mut rng)
</a><a href="#h2-0-109" id="h2-0-109" class="i">+                    }
</a><a href="#h2-0-110" id="h2-0-110" class="i">+                    tx.send((from, to));
</a><a href="#h2-0-111" id="h2-0-111" class="i">+                }
</a><a href="#h2-0-112" id="h2-0-112" class="i">+                std::mem::drop(tx)
</a><a href="#h2-0-113" id="h2-0-113" class="i">+            });
</a><a href="#h2-0-114" id="h2-0-114" class="i">+
</a><a href="#h2-0-115" id="h2-0-115" class="i">+            println!();
</a><a href="#h2-0-116" id="h2-0-116" class="i">+            for i in 0..concurrency {
</a><a href="#h2-0-117" id="h2-0-117" class="i">+                let r = rx.clone();
</a><a href="#h2-0-118" id="h2-0-118" class="i">+                scope.spawn(move || self.process(i, r).unwrap());
</a><a href="#h2-0-119" id="h2-0-119" class="i">+            }
</a><a href="#h2-0-120" id="h2-0-120" class="i">+        });
</a><a href="#h2-0-121" id="h2-0-121" class="i">+
</a><a href="#h2-0-122" id="h2-0-122" class="i">+        let elapsed = start.elapsed().as_secs_f64();
</a><a href="#h2-0-123" id="h2-0-123" class="i">+        println!();
</a><a href="#h2-0-124" id="h2-0-124" class="i">+        println!(
</a><a href="#h2-0-125" id="h2-0-125" class="i">+            &quot;Ran {} transactions in {:.3}s ({:.3}/s)&quot;,
</a><a href="#h2-0-126" id="h2-0-126" class="i">+            transactions,
</a><a href="#h2-0-127" id="h2-0-127" class="i">+            elapsed,
</a><a href="#h2-0-128" id="h2-0-128" class="i">+            transactions as f64 / elapsed
</a><a href="#h2-0-129" id="h2-0-129" class="i">+        );
</a><a href="#h2-0-130" id="h2-0-130" class="i">+
</a><a href="#h2-0-131" id="h2-0-131" class="i">+        self.check()?;
</a><a href="#h2-0-132" id="h2-0-132" class="i">+        Ok(())
</a><a href="#h2-0-133" id="h2-0-133" class="i">+    }
</a><a href="#h2-0-134" id="h2-0-134" class="i">+
</a><a href="#h2-0-135" id="h2-0-135" class="i">+    // Processes transactions for a customer
</a><a href="#h2-0-136" id="h2-0-136" class="i">+    fn process(&amp;self, i: i64, rx: crossbeam::channel::Receiver&lt;(i64, i64)&gt;) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h2-0-137" id="h2-0-137" class="i">+        let mut rng = rand::thread_rng();
</a><a href="#h2-0-138" id="h2-0-138" class="i">+        let mut client = self.client()?;
</a><a href="#h2-0-139" id="h2-0-139" class="i">+        for (from, to) in rx {
</a><a href="#h2-0-140" id="h2-0-140" class="i">+            let start = std::time::Instant::now();
</a><a href="#h2-0-141" id="h2-0-141" class="i">+            client.query(&quot;BEGIN&quot;)?;
</a><a href="#h2-0-142" id="h2-0-142" class="i">+            let f = get_integers(client.query(&amp;format!(
</a><a href="#h2-0-143" id="h2-0-143" class="i">+                &quot;SELECT a.id, a.balance
</a><a href="#h2-0-144" id="h2-0-144" class="i">+                FROM account a JOIN customer c ON a.customer_id = c.id
</a><a href="#h2-0-145" id="h2-0-145" class="i">+                WHERE c.id = {}
</a><a href="#h2-0-146" id="h2-0-146" class="i">+                ORDER BY a.balance DESC
</a><a href="#h2-0-147" id="h2-0-147" class="i">+                LIMIT 1&quot;,
</a><a href="#h2-0-148" id="h2-0-148" class="i">+                from
</a><a href="#h2-0-149" id="h2-0-149" class="i">+            ))?)?;
</a><a href="#h2-0-150" id="h2-0-150" class="i">+            let (from_account, from_balance) = (f[0], f[1]);
</a><a href="#h2-0-151" id="h2-0-151" class="i">+            let to_account = get_integers(client.query(&amp;format!(
</a><a href="#h2-0-152" id="h2-0-152" class="i">+                &quot;SELECT a.id, a.balance
</a><a href="#h2-0-153" id="h2-0-153" class="i">+                FROM account a JOIN customer c ON a.customer_id = c.id
</a><a href="#h2-0-154" id="h2-0-154" class="i">+                WHERE c.id = {}
</a><a href="#h2-0-155" id="h2-0-155" class="i">+                ORDER BY a.balance ASC
</a><a href="#h2-0-156" id="h2-0-156" class="i">+                LIMIT 1&quot;,
</a><a href="#h2-0-157" id="h2-0-157" class="i">+                to
</a><a href="#h2-0-158" id="h2-0-158" class="i">+            ))?)?[0];
</a><a href="#h2-0-159" id="h2-0-159" class="i">+
</a><a href="#h2-0-160" id="h2-0-160" class="i">+            let amount = rng.gen_range(0, from_balance);
</a><a href="#h2-0-161" id="h2-0-161" class="i">+
</a><a href="#h2-0-162" id="h2-0-162" class="i">+            client.query(&amp;format!(
</a><a href="#h2-0-163" id="h2-0-163" class="i">+                &quot;UPDATE account SET balance = balance - {} WHERE id = {}&quot;,
</a><a href="#h2-0-164" id="h2-0-164" class="i">+                amount, from_account,
</a><a href="#h2-0-165" id="h2-0-165" class="i">+            ))?;
</a><a href="#h2-0-166" id="h2-0-166" class="i">+            client.query(&amp;format!(
</a><a href="#h2-0-167" id="h2-0-167" class="i">+                &quot;UPDATE account SET balance = balance + {} WHERE id = {}&quot;,
</a><a href="#h2-0-168" id="h2-0-168" class="i">+                amount, to_account,
</a><a href="#h2-0-169" id="h2-0-169" class="i">+            ))?;
</a><a href="#h2-0-170" id="h2-0-170" class="i">+            client.query(&quot;COMMIT&quot;)?;
</a><a href="#h2-0-171" id="h2-0-171" class="i">+            println!(
</a><a href="#h2-0-172" id="h2-0-172" class="i">+                &quot;Thread {} transferred {: &gt;4} from {: &gt;3} ({:0&gt;4}) to {: &gt;3} ({:0&gt;4}) in {:.3}s&quot;,
</a><a href="#h2-0-173" id="h2-0-173" class="i">+                i,
</a><a href="#h2-0-174" id="h2-0-174" class="i">+                amount,
</a><a href="#h2-0-175" id="h2-0-175" class="i">+                from,
</a><a href="#h2-0-176" id="h2-0-176" class="i">+                from_account,
</a><a href="#h2-0-177" id="h2-0-177" class="i">+                to,
</a><a href="#h2-0-178" id="h2-0-178" class="i">+                to_account,
</a><a href="#h2-0-179" id="h2-0-179" class="i">+                start.elapsed().as_secs_f64()
</a><a href="#h2-0-180" id="h2-0-180" class="i">+            );
</a><a href="#h2-0-181" id="h2-0-181" class="i">+        }
</a><a href="#h2-0-182" id="h2-0-182" class="i">+        Ok(())
</a><a href="#h2-0-183" id="h2-0-183" class="i">+    }
</a><a href="#h2-0-184" id="h2-0-184" class="i">+
</a><a href="#h2-0-185" id="h2-0-185" class="i">+    // Sets up the database
</a><a href="#h2-0-186" id="h2-0-186" class="i">+    fn setup(&amp;self) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h2-0-187" id="h2-0-187" class="i">+        let mut namegen = names::Generator::default(names::Name::Plain);
</a><a href="#h2-0-188" id="h2-0-188" class="i">+        let now = std::time::Instant::now();
</a><a href="#h2-0-189" id="h2-0-189" class="i">+        let mut client = self.client()?;
</a><a href="#h2-0-190" id="h2-0-190" class="i">+
</a><a href="#h2-0-191" id="h2-0-191" class="i">+        client.query(&quot;BEGIN&quot;)?;
</a><a href="#h2-0-192" id="h2-0-192" class="i">+        client.query(
</a><a href="#h2-0-193" id="h2-0-193" class="i">+            &quot;CREATE TABLE customer (
</a><a href="#h2-0-194" id="h2-0-194" class="i">+                id INTEGER PRIMARY KEY,
</a><a href="#h2-0-195" id="h2-0-195" class="i">+                name STRING NOT NULL
</a><a href="#h2-0-196" id="h2-0-196" class="i">+            )&quot;,
</a><a href="#h2-0-197" id="h2-0-197" class="i">+        )?;
</a><a href="#h2-0-198" id="h2-0-198" class="i">+        client.query(
</a><a href="#h2-0-199" id="h2-0-199" class="i">+            &quot;CREATE TABLE account (
</a><a href="#h2-0-200" id="h2-0-200" class="i">+                id INTEGER PRIMARY KEY,
</a><a href="#h2-0-201" id="h2-0-201" class="i">+                customer_id INTEGER NOT NULL REFERENCES customer,
</a><a href="#h2-0-202" id="h2-0-202" class="i">+                balance INTEGER NOT NULL
</a><a href="#h2-0-203" id="h2-0-203" class="i">+           )&quot;,
</a><a href="#h2-0-204" id="h2-0-204" class="i">+        )?;
</a><a href="#h2-0-205" id="h2-0-205" class="i">+
</a><a href="#h2-0-206" id="h2-0-206" class="i">+        for i in 0..self.customers {
</a><a href="#h2-0-207" id="h2-0-207" class="i">+            client.query(&amp;format!(
</a><a href="#h2-0-208" id="h2-0-208" class="i">+                &quot;INSERT INTO customer VALUES ({}, &#39;{}&#39;)&quot;,
</a><a href="#h2-0-209" id="h2-0-209" class="i">+                i,
</a><a href="#h2-0-210" id="h2-0-210" class="i">+                namegen.next().unwrap()
</a><a href="#h2-0-211" id="h2-0-211" class="i">+            ))?;
</a><a href="#h2-0-212" id="h2-0-212" class="i">+            client.query(&amp;format!(
</a><a href="#h2-0-213" id="h2-0-213" class="i">+                &quot;INSERT INTO account VALUES {}&quot;,
</a><a href="#h2-0-214" id="h2-0-214" class="i">+                (0..self.customer_accounts)
</a><a href="#h2-0-215" id="h2-0-215" class="i">+                    .map(|j| i * self.customer_accounts + j)
</a><a href="#h2-0-216" id="h2-0-216" class="i">+                    .map(|id| (format!(&quot;({}, {}, {})&quot;, id, i, self.initial_balance)))
</a><a href="#h2-0-217" id="h2-0-217" class="i">+                    .collect::&lt;Vec&lt;String&gt;&gt;()
</a><a href="#h2-0-218" id="h2-0-218" class="i">+                    .join(&quot;, &quot;)
</a><a href="#h2-0-219" id="h2-0-219" class="i">+            ))?;
</a><a href="#h2-0-220" id="h2-0-220" class="i">+        }
</a><a href="#h2-0-221" id="h2-0-221" class="i">+        client.query(&quot;COMMIT&quot;)?;
</a><a href="#h2-0-222" id="h2-0-222" class="i">+
</a><a href="#h2-0-223" id="h2-0-223" class="i">+        println!(
</a><a href="#h2-0-224" id="h2-0-224" class="i">+            &quot;Created {} customers ({} accounts) in {:.3}s&quot;,
</a><a href="#h2-0-225" id="h2-0-225" class="i">+            self.customers,
</a><a href="#h2-0-226" id="h2-0-226" class="i">+            self.customers * self.customer_accounts,
</a><a href="#h2-0-227" id="h2-0-227" class="i">+            now.elapsed().as_secs_f64()
</a><a href="#h2-0-228" id="h2-0-228" class="i">+        );
</a><a href="#h2-0-229" id="h2-0-229" class="i">+        Ok(())
</a><a href="#h2-0-230" id="h2-0-230" class="i">+    }
</a><a href="#h2-0-231" id="h2-0-231" class="i">+
</a><a href="#h2-0-232" id="h2-0-232" class="i">+    /// Checks that all invariants hold
</a><a href="#h2-0-233" id="h2-0-233" class="i">+    fn check(&amp;self) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h2-0-234" id="h2-0-234" class="i">+        let mut client = self.client()?;
</a><a href="#h2-0-235" id="h2-0-235" class="i">+        let expect_balance = self.customers * self.customer_accounts * self.initial_balance;
</a><a href="#h2-0-236" id="h2-0-236" class="i">+        let balance = get_integers(client.query(&quot;SELECT SUM(balance) FROM account&quot;)?)?[0];
</a><a href="#h2-0-237" id="h2-0-237" class="i">+        if balance != expect_balance {
</a><a href="#h2-0-238" id="h2-0-238" class="i">+            return Err(Error::Value(format!(
</a><a href="#h2-0-239" id="h2-0-239" class="i">+                &quot;Invariant violation: expected total balance {}, found {}&quot;,
</a><a href="#h2-0-240" id="h2-0-240" class="i">+                expect_balance, balance
</a><a href="#h2-0-241" id="h2-0-241" class="i">+            )));
</a><a href="#h2-0-242" id="h2-0-242" class="i">+        }
</a><a href="#h2-0-243" id="h2-0-243" class="i">+        let neg = get_integers(client.query(&quot;SELECT COUNT(*) FROM account WHERE balance &lt; 0&quot;)?)?[0];
</a><a href="#h2-0-244" id="h2-0-244" class="i">+        if neg &gt; 0 {
</a><a href="#h2-0-245" id="h2-0-245" class="i">+            return Err(Error::Value(format!(
</a><a href="#h2-0-246" id="h2-0-246" class="i">+                &quot;Invariant violation: expected 0 accounts with negative balance, got {}&quot;,
</a><a href="#h2-0-247" id="h2-0-247" class="i">+                neg
</a><a href="#h2-0-248" id="h2-0-248" class="i">+            )));
</a><a href="#h2-0-249" id="h2-0-249" class="i">+        }
</a><a href="#h2-0-250" id="h2-0-250" class="i">+        println!(&quot;Checked that total balance is {} with no negative balances&quot;, balance);
</a><a href="#h2-0-251" id="h2-0-251" class="i">+        Ok(())
</a><a href="#h2-0-252" id="h2-0-252" class="i">+    }
</a><a href="#h2-0-253" id="h2-0-253" class="i">+}
</a><a href="#h2-0-254" id="h2-0-254" class="i">+
</a><a href="#h2-0-255" id="h2-0-255" class="i">+// FIXME This should be a row or result method
</a><a href="#h2-0-256" id="h2-0-256" class="i">+fn get_integers&lt;I: Iterator&lt;Item = Result&lt;Row, Error&gt;&gt;&gt;(mut result: I) -&gt; Result&lt;Vec&lt;i64&gt;, Error&gt; {
</a><a href="#h2-0-257" id="h2-0-257" class="i">+    if let Some(row) = result.next().transpose()? {
</a><a href="#h2-0-258" id="h2-0-258" class="i">+        row.into_iter()
</a><a href="#h2-0-259" id="h2-0-259" class="i">+            .map(|f| match f {
</a><a href="#h2-0-260" id="h2-0-260" class="i">+                Value::Integer(i) =&gt; Ok(i),
</a><a href="#h2-0-261" id="h2-0-261" class="i">+                _ =&gt; Err(Error::Internal(&quot;no value received&quot;.into())),
</a><a href="#h2-0-262" id="h2-0-262" class="i">+            })
</a><a href="#h2-0-263" id="h2-0-263" class="i">+            .collect()
</a><a href="#h2-0-264" id="h2-0-264" class="i">+    } else {
</a><a href="#h2-0-265" id="h2-0-265" class="i">+        Err(Error::Internal(&quot;no row received&quot;.into()))
</a><a href="#h2-0-266" id="h2-0-266" class="i">+    }
</a><a href="#h2-0-267" id="h2-0-267" class="i">+}
</a></pre>
</div>
</body>
</html>
