<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: tightened up math operators and added docs - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/1dcf9105b5e630bfadd46ff28548898dd1d8b025.html">1dcf9105b5e630bfadd46ff28548898dd1d8b025</a>
<b>parent</b> <a href="../commit/630da1b2a6dd022d1966db5521184ef1545b5fa0.html">630da1b2a6dd022d1966db5521184ef1545b5fa0</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Thu,  2 Jan 2020 12:36:15 +0100

sql: tightened up math operators and added docs

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">docs/README.md</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/sql/tests/expression.rs</a></td><td> | </td><td class="num">174</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/types/expression.rs</a></td><td> | </td><td class="num">32</td><td><span class="i">+++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
</table></pre><pre>3 files changed, 152 insertions(+), 76 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/docs/README.md.html">docs/README.md</a> b/<a href="../file/docs/README.md.html">docs/README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -84,3 +84,24 @@ The complete truth tables are:
</a> | **`TRUE`**  | `FALSE` |
 | **`FALSE`** | `TRUE`  |
 | **`NULL`**  | `NULL`  |
<a href="#h0-0-3" id="h0-0-3" class="i">+
</a><a href="#h0-0-4" id="h0-0-4" class="i">+#### Mathematical operators
</a><a href="#h0-0-5" id="h0-0-5" class="i">+
</a><a href="#h0-0-6" id="h0-0-6" class="i">+Mathematical operators apply standard math operations on numeric (`INTEGER` or `FLOAT`) operands. If either operand is a `FLOAT`, both operands are converted to `FLOAT` and the result is a `FLOAT`. The special values `INFINITY` and `NAN` are handled according to the IEEE 754 `binary64` spec.
</a><a href="#h0-0-7" id="h0-0-7" class="i">+
</a><a href="#h0-0-8" id="h0-0-8" class="i">+For `INTEGER` operands, failure conditions such as overflow and division by zero yield an error, while for `FLOAT` operands these return `INFINITY` or `NAN` as appropriate.
</a><a href="#h0-0-9" id="h0-0-9" class="i">+
</a><a href="#h0-0-10" id="h0-0-10" class="i">+Binary operators:
</a><a href="#h0-0-11" id="h0-0-11" class="i">+
</a><a href="#h0-0-12" id="h0-0-12" class="i">+* `+`: addition, e.g. `1 + 2` yields `3`.
</a><a href="#h0-0-13" id="h0-0-13" class="i">+* `-`: subtraction, e.g. `3 - 2` yields `1`.
</a><a href="#h0-0-14" id="h0-0-14" class="i">+* `*`: multiplication, e.g. `3 * 2` yields `6`.
</a><a href="#h0-0-15" id="h0-0-15" class="i">+* `/`: division, e.g. `6 / 2` yields `3`.
</a><a href="#h0-0-16" id="h0-0-16" class="i">+* `^`: exponentiation, e.g. `2 ^ 4` yields `16`.
</a><a href="#h0-0-17" id="h0-0-17" class="i">+* `%`: modulo or remainder, e.g. `8 % 3` yields `2`. The result has the sign of the divisor.
</a><a href="#h0-0-18" id="h0-0-18" class="i">+
</a><a href="#h0-0-19" id="h0-0-19" class="i">+Unary operators:
</a><a href="#h0-0-20" id="h0-0-20" class="i">+
</a><a href="#h0-0-21" id="h0-0-21" class="i">+* `+` (prefix): identity, e.g. `+1` yields `1`.
</a><a href="#h0-0-22" id="h0-0-22" class="i">+* `-` (prefix): negation, e.g. `- -2` yields `2`.
</a><a href="#h0-0-23" id="h0-0-23" class="i">+* `!` (postfix): factorial, e.g. `5!` yields `15`.
</a><a href="#h0-0-24" id="h0-0-24" class="i">+\ No newline at end of file
</a><b>diff --git a/<a id="h1" href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a> b/<a href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -38,6 +38,7 @@ macro_rules! test_expr {
</a> use Value::*;
 
 test_expr! {
<a href="#h1-0-3" id="h1-0-3" class="i">+    // Constants and literals
</a>     const_case: &quot;TrUe&quot; =&gt; Ok(Boolean(true)),
     const_false: &quot;FALSE&quot; =&gt; Ok(Boolean(false)),
     const_infinity: &quot;INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
<a href="#h1-1" id="h1-1" class="h">@@ -73,19 +74,7 @@ test_expr! {
</a>     lit_string_whitespace: &quot;&#39; Has \n newlines and \t tabs  &#39;&quot; =&gt; Ok(String(&quot; Has \n newlines and \t tabs  &quot;.into())),
     lit_string_long: &amp;format!(&quot;&#39;{}&#39;&quot;, &quot;a&quot;.repeat(4096)) =&gt; Ok(&quot;a&quot;.repeat(4096).into()),
 
<a href="#h1-1-3" id="h1-1-3" class="d">-    op_add_float_float: &quot;3.1 + 2.71&quot; =&gt; Ok(Float(3.1 + 2.71)),
</a><a href="#h1-1-4" id="h1-1-4" class="d">-    op_add_float_int: &quot;3.72 + 1&quot; =&gt; Ok(Float(3.72 + 1.0)),
</a><a href="#h1-1-5" id="h1-1-5" class="d">-    op_add_float_null: &quot;3.14 + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-1-6" id="h1-1-6" class="d">-    op_add_int_float: &quot;1 + 3.72&quot; =&gt; Ok(Float(1.0 + 3.72)),
</a><a href="#h1-1-7" id="h1-1-7" class="d">-    op_add_int_int: &quot;1 + 2&quot; =&gt; Ok(Integer(3)),
</a><a href="#h1-1-8" id="h1-1-8" class="d">-    op_add_int_null: &quot;1 + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-1-9" id="h1-1-9" class="d">-    op_add_null_float: &quot;NULL + 3.14&quot; =&gt; Ok(Null),
</a><a href="#h1-1-10" id="h1-1-10" class="d">-    op_add_null_int: &quot;NULL + 1&quot; =&gt; Ok(Null),
</a><a href="#h1-1-11" id="h1-1-11" class="d">-    op_add_null_null: &quot;NULL + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-1-12" id="h1-1-12" class="d">-    op_add_negative: &quot;1 + -3&quot; =&gt; Ok(Integer(-2)),
</a><a href="#h1-1-13" id="h1-1-13" class="d">-    op_add_error_bool: &quot;TRUE + FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t add TRUE and FALSE&quot;.into())),
</a><a href="#h1-1-14" id="h1-1-14" class="d">-    op_add_error_strings: &quot;&#39;a&#39; + &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t add a and b&quot;.into())),
</a><a href="#h1-1-15" id="h1-1-15" class="d">-
</a><a href="#h1-1-16" id="h1-1-16" class="i">+    // Logical operators
</a>     op_and_true_true: &quot;TRUE AND TRUE&quot; =&gt; Ok(Boolean(true)),
     op_and_true_false: &quot;TRUE AND FALSE&quot; =&gt; Ok(Boolean(false)),
     op_and_false_true: &quot;FALSE AND TRUE&quot; =&gt; Ok(Boolean(false)),
<a href="#h1-2" id="h1-2" class="h">@@ -99,15 +88,85 @@ test_expr! {
</a>     op_and_error_integer: &quot;3 AND 3&quot; =&gt; Err(Error::Value(&quot;Can&#39;t and 3 and 3&quot;.into())),
     op_and_error_string: &quot;&#39;a&#39; AND &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t and a and b&quot;.into())),
 
<a href="#h1-2-3" id="h1-2-3" class="i">+    op_not_true: &quot;NOT TRUE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-4" id="h1-2-4" class="i">+    op_not_false: &quot;NOT FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-5" id="h1-2-5" class="i">+    op_not_null: &quot;NOT NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-6" id="h1-2-6" class="i">+    op_not_error_float: &quot;NOT 3.14&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate 3.14&quot;.into())),
</a><a href="#h1-2-7" id="h1-2-7" class="i">+    op_not_error_integer: &quot;NOT 3&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate 3&quot;.into())),
</a><a href="#h1-2-8" id="h1-2-8" class="i">+    op_not_error_string: &quot;NOT &#39;abc&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate abc&quot;.into())),
</a><a href="#h1-2-9" id="h1-2-9" class="i">+
</a><a href="#h1-2-10" id="h1-2-10" class="i">+    op_or_true_true: &quot;TRUE OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-11" id="h1-2-11" class="i">+    op_or_true_false: &quot;TRUE OR FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-12" id="h1-2-12" class="i">+    op_or_false_true: &quot;FALSE OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-13" id="h1-2-13" class="i">+    op_or_false_false: &quot;FALSE OR FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-14" id="h1-2-14" class="i">+    op_or_true_null: &quot;TRUE OR NULL&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-15" id="h1-2-15" class="i">+    op_or_false_null: &quot;FALSE OR NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-16" id="h1-2-16" class="i">+    op_or_null_true: &quot;NULL OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-17" id="h1-2-17" class="i">+    op_or_null_false: &quot;NULL OR FALSE&quot; =&gt; Ok(Null),
</a><a href="#h1-2-18" id="h1-2-18" class="i">+    op_or_null_null: &quot;NULL OR NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-19" id="h1-2-19" class="i">+    op_or_error_float: &quot;3.14 OR 3.14&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or 3.14 and 3.14&quot;.into())),
</a><a href="#h1-2-20" id="h1-2-20" class="i">+    op_or_error_integer: &quot;3 OR 3&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or 3 and 3&quot;.into())),
</a><a href="#h1-2-21" id="h1-2-21" class="i">+    op_or_error_string: &quot;&#39;a&#39; OR &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or a and b&quot;.into())),
</a><a href="#h1-2-22" id="h1-2-22" class="i">+
</a><a href="#h1-2-23" id="h1-2-23" class="i">+    // Comparison operators
</a><a href="#h1-2-24" id="h1-2-24" class="i">+    op_eq_bool_false_false: &quot;FALSE = FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-25" id="h1-2-25" class="i">+    op_eq_bool_true_false: &quot;TRUE = FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-26" id="h1-2-26" class="i">+    op_eq_bool_true_true: &quot;TRUE = TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-27" id="h1-2-27" class="i">+    op_eq_float: &quot;3.14 = 3.14&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-28" id="h1-2-28" class="i">+    op_eq_float_neq: &quot;3.14 = 2.718&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-29" id="h1-2-29" class="i">+    op_eq_float_int: &quot;3.0 = 3&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-30" id="h1-2-30" class="i">+    op_eq_float_int_neq: &quot;3.01 = 3&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-31" id="h1-2-31" class="i">+    op_eq_int: &quot;1 = 1&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-32" id="h1-2-32" class="i">+    op_eq_int_neq: &quot;1 = 2&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-33" id="h1-2-33" class="i">+    op_eq_str: &quot;&#39;abc&#39; = &#39;abc&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-34" id="h1-2-34" class="i">+    op_eq_str_case: &quot;&#39;abc&#39; = &#39;ABC&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-35" id="h1-2-35" class="i">+    op_eq_str_neq: &quot;&#39;abc&#39; = &#39;xyz&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-36" id="h1-2-36" class="i">+
</a><a href="#h1-2-37" id="h1-2-37" class="i">+    op_neq_bool_false_false: &quot;FALSE != FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-38" id="h1-2-38" class="i">+    op_neq_bool_true_false: &quot;TRUE != FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-39" id="h1-2-39" class="i">+    op_neq_bool_true_true: &quot;TRUE != TRUE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-40" id="h1-2-40" class="i">+    op_neq_float: &quot;3.14 != 2.718&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-41" id="h1-2-41" class="i">+    op_neq_float_eq: &quot;3.14 != 3.14&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-42" id="h1-2-42" class="i">+    op_neq_float_int: &quot;3.01 != 3&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-43" id="h1-2-43" class="i">+    op_neq_float_int_eq: &quot;3.0 != 3&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-44" id="h1-2-44" class="i">+    op_neq_int: &quot;1 != 2&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-45" id="h1-2-45" class="i">+    op_neq_int_eq: &quot;1 != 1&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-46" id="h1-2-46" class="i">+    op_neq_str: &quot;&#39;abc&#39; != &#39;xyz&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-47" id="h1-2-47" class="i">+    op_neq_str_case: &quot;&#39;abc&#39; != &#39;ABC&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-2-48" id="h1-2-48" class="i">+    op_neq_str_eq: &quot;&#39;abc&#39; != &#39;abc&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-2-49" id="h1-2-49" class="i">+
</a><a href="#h1-2-50" id="h1-2-50" class="i">+    // Math operators
</a><a href="#h1-2-51" id="h1-2-51" class="i">+    op_add_float_float: &quot;3.1 + 2.71&quot; =&gt; Ok(Float(3.1 + 2.71)),
</a><a href="#h1-2-52" id="h1-2-52" class="i">+    op_add_float_int: &quot;3.72 + 1&quot; =&gt; Ok(Float(3.72 + 1.0)),
</a><a href="#h1-2-53" id="h1-2-53" class="i">+    op_add_float_null: &quot;3.14 + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-54" id="h1-2-54" class="i">+    op_add_int_float: &quot;1 + 3.72&quot; =&gt; Ok(Float(1.0 + 3.72)),
</a><a href="#h1-2-55" id="h1-2-55" class="i">+    op_add_int_int: &quot;1 + 2&quot; =&gt; Ok(Integer(3)),
</a><a href="#h1-2-56" id="h1-2-56" class="i">+    op_add_int_null: &quot;1 + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-57" id="h1-2-57" class="i">+    op_add_null_float: &quot;NULL + 3.14&quot; =&gt; Ok(Null),
</a><a href="#h1-2-58" id="h1-2-58" class="i">+    op_add_null_int: &quot;NULL + 1&quot; =&gt; Ok(Null),
</a><a href="#h1-2-59" id="h1-2-59" class="i">+    op_add_null_null: &quot;NULL + NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-2-60" id="h1-2-60" class="i">+    op_add_negative: &quot;1 + -3&quot; =&gt; Ok(Integer(-2)),
</a><a href="#h1-2-61" id="h1-2-61" class="i">+    op_add_infinity: &quot;1 + INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-2-62" id="h1-2-62" class="i">+    op_add_nan: &quot;1 + NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-2-63" id="h1-2-63" class="i">+    op_add_overflow_int: &quot;9223372036854775807 + 1&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-2-64" id="h1-2-64" class="i">+    op_add_underflow_int: &quot;-9223372036854775807 + -2&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-2-65" id="h1-2-65" class="i">+    op_add_overflow_float: &quot;2e308 + 2e308&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-2-66" id="h1-2-66" class="i">+    op_add_round_int_float: &quot;9223372036854775807 + 10.0&quot; =&gt; Ok(Float(9_223_372_036_854_776_000.0)),
</a><a href="#h1-2-67" id="h1-2-67" class="i">+    op_add_error_bool: &quot;TRUE + FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t add TRUE and FALSE&quot;.into())),
</a><a href="#h1-2-68" id="h1-2-68" class="i">+    op_add_error_strings: &quot;&#39;a&#39; + &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t add a and b&quot;.into())),
</a><a href="#h1-2-69" id="h1-2-69" class="i">+
</a>     op_assert_float: &quot;+3.72&quot; =&gt; Ok(Float(3.72)),
     op_assert_int: &quot;+1&quot; =&gt; Ok(Integer(1)),
     op_assert_null: &quot;+NULL&quot; =&gt; Ok(Null),
<a href="#h1-2-73" id="h1-2-73" class="i">+    op_assert_infinity: &quot;+INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-2-74" id="h1-2-74" class="i">+    op_assert_nan: &quot;+NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_assert_multi: &quot;+++1&quot; =&gt; Ok(Integer(1)),
     op_assert_error_bool: &quot;+TRUE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t take the positive of TRUE&quot;.into())),
     op_assert_error_string: &quot;+&#39;abc&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t take the positive of abc&quot;.into())),
 
     op_divide_float_float: &quot;4.16 / 3.2&quot; =&gt; Ok(Float(1.3)),
     op_divide_float_float_zero: &quot;4.16 / 0.0&quot; =&gt; Ok(Float(std::f64::INFINITY)),
<a href="#h1-2-81" id="h1-2-81" class="i">+    op_divide_float_float_zero_zero: &quot;0.0 / 0.0&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_divide_float_integer: &quot;1.5 / 3&quot; =&gt; Ok(Float(0.5)),
     op_divide_float_integer_zero: &quot;4.16 / 0&quot; =&gt; Ok(Float(std::f64::INFINITY)),
     op_divide_float_null: &quot;4.16 / NULL&quot; =&gt; Ok(Null),
<a href="#h1-3" id="h1-3" class="h">@@ -115,36 +174,35 @@ test_expr! {
</a>     op_divide_integer_float_zero: &quot;3 / 0.0&quot; =&gt; Ok(Float(std::f64::INFINITY)),
     op_divide_integer_integer: &quot;8 / 3&quot; =&gt; Ok(Integer(2)),
     op_divide_integer_integer_negative: &quot;8 / -3&quot; =&gt; Ok(Integer(-2)),
<a href="#h1-3-3" id="h1-3-3" class="i">+    op_divide_integer_integer_zero: &quot;1 / 0&quot; =&gt; Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into())),
</a>     op_divide_integer_null: &quot;1 / NULL&quot; =&gt; Ok(Null),
<a href="#h1-3-5" id="h1-3-5" class="i">+    op_divide_infinity: &quot;1 / INFINITY&quot; =&gt; Ok(Float(0.0)),
</a><a href="#h1-3-6" id="h1-3-6" class="i">+    op_divide_infinity_divisor: &quot;INFINITY / 10&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-3-7" id="h1-3-7" class="i">+    op_divide_infinity_infinity: &quot;INFINITY / INFINITY&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-3-8" id="h1-3-8" class="i">+    op_divide_nan: &quot;1 / NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_divide_null_float: &quot;NULL / 3.14&quot; =&gt; Ok(Null),
     op_divide_null_integer: &quot;NULL / 1&quot; =&gt; Ok(Null),
     op_divide_null_null: &quot;NULL / NULL&quot; =&gt; Ok(Null),
     op_divide_error_bool: &quot;TRUE / FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t divide TRUE and FALSE&quot;.into())),
<a href="#h1-3-13" id="h1-3-13" class="d">-    op_divide_error_integer_zero: &quot;1 / 0&quot; =&gt; Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into())),
</a>     op_divide_error_strings: &quot;&#39;a&#39; / &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t divide a and b&quot;.into())),
 
<a href="#h1-3-16" id="h1-3-16" class="d">-    op_eq_bool_false_false: &quot;FALSE = FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-17" id="h1-3-17" class="d">-    op_eq_bool_true_false: &quot;TRUE = FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-18" id="h1-3-18" class="d">-    op_eq_bool_true_true: &quot;TRUE = TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-19" id="h1-3-19" class="d">-    op_eq_float: &quot;3.14 = 3.14&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-20" id="h1-3-20" class="d">-    op_eq_float_neq: &quot;3.14 = 2.718&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-21" id="h1-3-21" class="d">-    op_eq_float_int: &quot;3.0 = 3&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-22" id="h1-3-22" class="d">-    op_eq_float_int_neq: &quot;3.01 = 3&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-23" id="h1-3-23" class="d">-    op_eq_int: &quot;1 = 1&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-24" id="h1-3-24" class="d">-    op_eq_int_neq: &quot;1 = 2&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-25" id="h1-3-25" class="d">-    op_eq_str: &quot;&#39;abc&#39; = &#39;abc&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-3-26" id="h1-3-26" class="d">-    op_eq_str_case: &quot;&#39;abc&#39; = &#39;ABC&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-27" id="h1-3-27" class="d">-    op_eq_str_neq: &quot;&#39;abc&#39; = &#39;xyz&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-3-28" id="h1-3-28" class="d">-
</a>     op_exp_float_float: &quot;6.25 ^ 0.5&quot; =&gt; Ok(Float(2.5)),
     op_exp_float_int: &quot;6.25 ^ 2&quot; =&gt; Ok(Float(39.0625)),
     op_exp_float_null: &quot;3.14 ^ NULL&quot; =&gt; Ok(Null),
     op_exp_int_float: &quot;9 ^ 0.5&quot; =&gt; Ok(Float(3.0)),
<a href="#h1-3-33" id="h1-3-33" class="d">-    op_exp_int_int: &quot;2 ^ 3&quot; =&gt; Ok(Float(8.0)),
</a><a href="#h1-3-34" id="h1-3-34" class="i">+    op_exp_int_int: &quot;2 ^ 3&quot; =&gt; Ok(Integer(8)),
</a><a href="#h1-3-35" id="h1-3-35" class="i">+    op_exp_int_int_large: &quot;2 ^ 10000000000&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a>     op_exp_int_null: &quot;1 ^ NULL&quot; =&gt; Ok(Null),
     op_exp_null_float: &quot;NULL ^ 3.14&quot; =&gt; Ok(Null),
     op_exp_null_int: &quot;NULL ^ 1&quot; =&gt; Ok(Null),
     op_exp_null_null: &quot;NULL ^ NULL&quot; =&gt; Ok(Null),
<a href="#h1-3-40" id="h1-3-40" class="i">+    op_exp_infinity: &quot;INFINITY ^ 2&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-3-41" id="h1-3-41" class="i">+    op_exp_infinity_exp: &quot;2 ^ INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-3-42" id="h1-3-42" class="i">+    op_exp_infinity_infinity: &quot;INFINITY ^ INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-3-43" id="h1-3-43" class="i">+    op_exp_nan: &quot;NAN ^ 2&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-3-44" id="h1-3-44" class="i">+    op_exp_nan_exp: &quot;2 ^ NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-3-45" id="h1-3-45" class="i">+    op_exp_overflow_float: &quot;10e200 ^ 2&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-3-46" id="h1-3-46" class="i">+    op_exp_overflow_int: &quot;9223372036854775807 ^ 2&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a>     op_exp_negative: &quot;2 ^ -3&quot; =&gt; Ok(Float(0.125)),
     op_exp_error_bool: &quot;TRUE ^ FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t exponentiate TRUE and FALSE&quot;.into())),
     op_exp_error_strings: &quot;&#39;a&#39; ^ &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t exponentiate a and b&quot;.into())),
<a href="#h1-4" id="h1-4" class="h">@@ -158,16 +216,21 @@ test_expr! {
</a>     op_factorial_error_string: &quot;&#39;abc&#39;!&quot; =&gt; Err(Error::Value(&quot;Can&#39;t take factorial of abc&quot;.into())),
 
     op_modulo_float_float: &quot;6.28 % 2.2&quot; =&gt; Ok(Float(1.88)),
<a href="#h1-4-3" id="h1-4-3" class="i">+    op_modulo_float_float_zero: &quot;6.28 % 0.0&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_modulo_float_int: &quot;3.15 % 2&quot; =&gt; Ok(Float(1.15)),
     op_modulo_float_null: &quot;3.14 % NULL&quot; =&gt; Ok(Null),
     op_modulo_int_float: &quot;6 % 3.15&quot; =&gt; Ok(Float(2.85)),
<a href="#h1-4-7" id="h1-4-7" class="d">-    op_modulo_int_int: &quot;7 % 3&quot; =&gt; Ok(Integer(1)),
</a><a href="#h1-4-8" id="h1-4-8" class="i">+    op_modulo_int_int: &quot;5 % 3&quot; =&gt; Ok(Integer(2)),
</a><a href="#h1-4-9" id="h1-4-9" class="i">+    op_modulo_int_int_zero: &quot;7 % 0&quot; =&gt; Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into())),
</a>     op_modulo_int_null: &quot;1 % NULL&quot; =&gt; Ok(Null),
     op_modulo_null_float: &quot;NULL % 3.14&quot; =&gt; Ok(Null),
     op_modulo_null_int: &quot;NULL % 1&quot; =&gt; Ok(Null),
     op_modulo_null_null: &quot;NULL % NULL&quot; =&gt; Ok(Null),
<a href="#h1-4-14" id="h1-4-14" class="d">-    op_modulo_negative: &quot;-5 % 3&quot; =&gt; Ok(Integer(1)),
</a><a href="#h1-4-15" id="h1-4-15" class="d">-    op_modulo_negative_rhs: &quot;5 % -3&quot; =&gt; Ok(Integer(-1)),
</a><a href="#h1-4-16" id="h1-4-16" class="i">+    op_modulo_negative: &quot;-5 % 3&quot; =&gt; Ok(Integer(-2)),
</a><a href="#h1-4-17" id="h1-4-17" class="i">+    op_modulo_negative_rhs: &quot;5 % -3&quot; =&gt; Ok(Integer(2)),
</a><a href="#h1-4-18" id="h1-4-18" class="i">+    op_modulo_infinity: &quot;INFINITY % 7&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-4-19" id="h1-4-19" class="i">+    op_modulo_infinity_divisor: &quot;7 % INFINITY&quot; =&gt; Ok(Float(7.0)),
</a><a href="#h1-4-20" id="h1-4-20" class="i">+    op_modulo_nan: &quot;7 % NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_modulo_error_bool: &quot;TRUE % FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t take modulo of TRUE and FALSE&quot;.into())),
     op_modulo_error_strings: &quot;&#39;a&#39; % &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t take modulo of a and b&quot;.into())),
 
<a href="#h1-5" id="h1-5" class="h">@@ -180,7 +243,13 @@ test_expr! {
</a>     op_multiply_null_float: &quot;NULL * 3.14&quot; =&gt; Ok(Null),
     op_multiply_null_int: &quot;NULL * 1&quot; =&gt; Ok(Null),
     op_multiply_null_null: &quot;NULL * NULL&quot; =&gt; Ok(Null),
<a href="#h1-5-3" id="h1-5-3" class="d">-    op_multiply_negative: &quot;1 * -3&quot; =&gt; Ok(Integer(-3)),
</a><a href="#h1-5-4" id="h1-5-4" class="i">+    op_multiply_negative: &quot;2 * -3&quot; =&gt; Ok(Integer(-6)),
</a><a href="#h1-5-5" id="h1-5-5" class="i">+    op_multiply_infinity: &quot;2 * INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-5-6" id="h1-5-6" class="i">+    op_multiply_nan: &quot;2 * NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-5-7" id="h1-5-7" class="i">+    op_multiply_overflow_int: &quot;9223372036854775807 * 2&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-5-8" id="h1-5-8" class="i">+    op_multiply_underflow_int: &quot;9223372036854775807 * -2&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-5-9" id="h1-5-9" class="i">+    op_multiply_overflow_float: &quot;2e308 * 2&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-5-10" id="h1-5-10" class="i">+    op_multiply_round_int_float: &quot;9223372036854775807 * 2.0&quot; =&gt; Ok(Float(18_446_744_073_709_552_000.0)),
</a>     op_multiply_error_bool: &quot;TRUE * FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t multiply TRUE and FALSE&quot;.into())),
     op_multiply_error_strings: &quot;&#39;a&#39; * &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t multiply a and b&quot;.into())),
 
<a href="#h1-6" id="h1-6" class="h">@@ -190,42 +259,11 @@ test_expr! {
</a>     op_negate_mixed: &quot;-+-+-1&quot; =&gt; Ok(Integer(-1)),
     op_negate_multi: &quot;---1&quot; =&gt; Ok(Integer(-1)),
     op_negate_null: &quot;-NULL&quot; =&gt; Ok(Null),
<a href="#h1-6-3" id="h1-6-3" class="i">+    op_negate_infinity: &quot;-INFINITY&quot; =&gt; Ok(Float(-std::f64::INFINITY)),
</a><a href="#h1-6-4" id="h1-6-4" class="i">+    op_negate_nan: &quot;-NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a>     op_negate_error_bool: &quot;-TRUE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate TRUE&quot;.into())),
     op_negate_error_string: &quot;-&#39;abc&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate abc&quot;.into())),
 
<a href="#h1-6-8" id="h1-6-8" class="d">-    op_neq_bool_false_false: &quot;FALSE != FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-9" id="h1-6-9" class="d">-    op_neq_bool_true_false: &quot;TRUE != FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-10" id="h1-6-10" class="d">-    op_neq_bool_true_true: &quot;TRUE != TRUE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-11" id="h1-6-11" class="d">-    op_neq_float: &quot;3.14 != 2.718&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-12" id="h1-6-12" class="d">-    op_neq_float_eq: &quot;3.14 != 3.14&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-13" id="h1-6-13" class="d">-    op_neq_float_int: &quot;3.01 != 3&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-14" id="h1-6-14" class="d">-    op_neq_float_int_eq: &quot;3.0 != 3&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-15" id="h1-6-15" class="d">-    op_neq_int: &quot;1 != 2&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-16" id="h1-6-16" class="d">-    op_neq_int_eq: &quot;1 != 1&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-17" id="h1-6-17" class="d">-    op_neq_str: &quot;&#39;abc&#39; != &#39;xyz&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-18" id="h1-6-18" class="d">-    op_neq_str_case: &quot;&#39;abc&#39; != &#39;ABC&#39;&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-19" id="h1-6-19" class="d">-    op_neq_str_eq: &quot;&#39;abc&#39; != &#39;abc&#39;&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-20" id="h1-6-20" class="d">-
</a><a href="#h1-6-21" id="h1-6-21" class="d">-    op_not_true: &quot;NOT TRUE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-22" id="h1-6-22" class="d">-    op_not_false: &quot;NOT FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-23" id="h1-6-23" class="d">-    op_not_null: &quot;NOT NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-6-24" id="h1-6-24" class="d">-    op_not_error_float: &quot;NOT 3.14&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate 3.14&quot;.into())),
</a><a href="#h1-6-25" id="h1-6-25" class="d">-    op_not_error_integer: &quot;NOT 3&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate 3&quot;.into())),
</a><a href="#h1-6-26" id="h1-6-26" class="d">-    op_not_error_string: &quot;NOT &#39;abc&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t negate abc&quot;.into())),
</a><a href="#h1-6-27" id="h1-6-27" class="d">-
</a><a href="#h1-6-28" id="h1-6-28" class="d">-    op_or_true_true: &quot;TRUE OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-29" id="h1-6-29" class="d">-    op_or_true_false: &quot;TRUE OR FALSE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-30" id="h1-6-30" class="d">-    op_or_false_true: &quot;FALSE OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-31" id="h1-6-31" class="d">-    op_or_false_false: &quot;FALSE OR FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h1-6-32" id="h1-6-32" class="d">-    op_or_true_null: &quot;TRUE OR NULL&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-33" id="h1-6-33" class="d">-    op_or_false_null: &quot;FALSE OR NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-6-34" id="h1-6-34" class="d">-    op_or_null_true: &quot;NULL OR TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h1-6-35" id="h1-6-35" class="d">-    op_or_null_false: &quot;NULL OR FALSE&quot; =&gt; Ok(Null),
</a><a href="#h1-6-36" id="h1-6-36" class="d">-    op_or_null_null: &quot;NULL OR NULL&quot; =&gt; Ok(Null),
</a><a href="#h1-6-37" id="h1-6-37" class="d">-    op_or_error_float: &quot;3.14 OR 3.14&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or 3.14 and 3.14&quot;.into())),
</a><a href="#h1-6-38" id="h1-6-38" class="d">-    op_or_error_integer: &quot;3 OR 3&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or 3 and 3&quot;.into())),
</a><a href="#h1-6-39" id="h1-6-39" class="d">-    op_or_error_string: &quot;&#39;a&#39; OR &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t or a and b&quot;.into())),
</a><a href="#h1-6-40" id="h1-6-40" class="d">-
</a>     op_subtract_float_float: &quot;3.1 - 2.71&quot; =&gt; Ok(Float(3.1 - 2.71)),
     op_subtract_float_int: &quot;3.72 - 1&quot; =&gt; Ok(Float(3.72 - 1.0)),
     op_subtract_float_null: &quot;3.14 - NULL&quot; =&gt; Ok(Null),
<a href="#h1-7" id="h1-7" class="h">@@ -236,6 +274,12 @@ test_expr! {
</a>     op_subtract_null_int: &quot;NULL - 1&quot; =&gt; Ok(Null),
     op_subtract_null_null: &quot;NULL - NULL&quot; =&gt; Ok(Null),
     op_subtract_negative: &quot;1 - -3&quot; =&gt; Ok(Integer(4)),
<a href="#h1-7-3" id="h1-7-3" class="i">+    op_subtract_infinity: &quot;1 - INFINITY&quot; =&gt; Ok(Float(-std::f64::INFINITY)),
</a><a href="#h1-7-4" id="h1-7-4" class="i">+    op_subtract_nan: &quot;1 - NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h1-7-5" id="h1-7-5" class="i">+    op_subtract_overflow_int: &quot;9223372036854775807 - -1&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-7-6" id="h1-7-6" class="i">+    op_subtract_underflow_int: &quot;-9223372036854775807 - 2&quot; =&gt; Err(Error::Value(&quot;Integer overflow&quot;.into())),
</a><a href="#h1-7-7" id="h1-7-7" class="i">+    op_subtract_overflow_float: &quot;2e308 - -2e308&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h1-7-8" id="h1-7-8" class="i">+    op_subtract_round_int_float: &quot;9223372036854775807 - -10.0&quot; =&gt; Ok(Float(9_223_372_036_854_776_000.0)),
</a>     op_subtract_error_bool: &quot;TRUE - FALSE&quot; =&gt; Err(Error::Value(&quot;Can&#39;t subtract TRUE and FALSE&quot;.into())),
     op_subtract_error_strings: &quot;&#39;a&#39; - &#39;b&#39;&quot; =&gt; Err(Error::Value(&quot;Can&#39;t subtract a and b&quot;.into())),
 }
<b>diff --git a/<a id="h2" href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a> b/<a href="../file/src/sql/types/expression.rs.html">src/sql/types/expression.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -135,10 +135,11 @@ impl Expression {
</a>             },
 
             // Mathematical operations
<a href="#h2-0-3" id="h2-0-3" class="d">-            // FIXME Handle infinity and NaN
</a>             Self::Add(lhs, rhs) =&gt; match (lhs.evaluate(e)?, rhs.evaluate(e)?) {
<a href="#h2-0-5" id="h2-0-5" class="i">+                (Integer(lhs), Integer(rhs)) =&gt; Integer(
</a><a href="#h2-0-6" id="h2-0-6" class="i">+                    lhs.checked_add(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
</a><a href="#h2-0-7" id="h2-0-7" class="i">+                ),
</a>                 (Integer(lhs), Float(rhs)) =&gt; Float(lhs as f64 + rhs),
<a href="#h2-0-9" id="h2-0-9" class="d">-                (Integer(lhs), Integer(rhs)) =&gt; Integer(lhs + rhs),
</a>                 (Integer(_), Null) =&gt; Null,
                 (Float(lhs), Float(rhs)) =&gt; Float(lhs + rhs),
                 (Float(lhs), Integer(rhs)) =&gt; Float(lhs + rhs as f64),
<a href="#h2-1" id="h2-1" class="h">@@ -172,7 +173,10 @@ impl Expression {
</a>                 }
             },
             Self::Exponentiate(lhs, rhs) =&gt; match (lhs.evaluate(e)?, rhs.evaluate(e)?) {
<a href="#h2-1-3" id="h2-1-3" class="d">-                // FIXME Handle overflow
</a><a href="#h2-1-4" id="h2-1-4" class="i">+                (Integer(lhs), Integer(rhs)) if rhs &gt;= 0 =&gt; Integer(
</a><a href="#h2-1-5" id="h2-1-5" class="i">+                    lhs.checked_pow(rhs as u32)
</a><a href="#h2-1-6" id="h2-1-6" class="i">+                        .ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
</a><a href="#h2-1-7" id="h2-1-7" class="i">+                ),
</a>                 (Integer(lhs), Integer(rhs)) =&gt; Float((lhs as f64).powf(rhs as f64)),
                 (Integer(lhs), Float(rhs)) =&gt; Float((lhs as f64).powf(rhs)),
                 (Integer(_), Null) =&gt; Null,
<a href="#h2-2" id="h2-2" class="h">@@ -192,13 +196,15 @@ impl Expression {
</a>                 value =&gt; return Err(Error::Value(format!(&quot;Can&#39;t take factorial of {}&quot;, value))),
             },
             Self::Modulo(lhs, rhs) =&gt; match (lhs.evaluate(e)?, rhs.evaluate(e)?) {
<a href="#h2-2-3" id="h2-2-3" class="d">-                // The % operator in Rust is remainder, not modulo, so we have to do a bit of
</a><a href="#h2-2-4" id="h2-2-4" class="d">-                // acrobatics to make it work right
</a><a href="#h2-2-5" id="h2-2-5" class="d">-                (Integer(lhs), Integer(rhs)) =&gt; Integer(((lhs % rhs) + rhs) % rhs),
</a><a href="#h2-2-6" id="h2-2-6" class="d">-                (Integer(lhs), Float(rhs)) =&gt; Float(((lhs as f64 % rhs) + rhs) % rhs),
</a><a href="#h2-2-7" id="h2-2-7" class="i">+                // This uses remainder semantics, like Postgres.
</a><a href="#h2-2-8" id="h2-2-8" class="i">+                (Integer(_), Integer(rhs)) if rhs == 0 =&gt; {
</a><a href="#h2-2-9" id="h2-2-9" class="i">+                    return Err(Error::Value(&quot;Can&#39;t divide by zero&quot;.into()))
</a><a href="#h2-2-10" id="h2-2-10" class="i">+                }
</a><a href="#h2-2-11" id="h2-2-11" class="i">+                (Integer(lhs), Integer(rhs)) =&gt; Integer(lhs % rhs),
</a><a href="#h2-2-12" id="h2-2-12" class="i">+                (Integer(lhs), Float(rhs)) =&gt; Float(lhs as f64 % rhs),
</a>                 (Integer(_), Null) =&gt; Null,
<a href="#h2-2-14" id="h2-2-14" class="d">-                (Float(lhs), Integer(rhs)) =&gt; Float(((lhs % rhs as f64) + rhs as f64) % rhs as f64),
</a><a href="#h2-2-15" id="h2-2-15" class="d">-                (Float(lhs), Float(rhs)) =&gt; Float(((lhs % rhs) + rhs) % rhs),
</a><a href="#h2-2-16" id="h2-2-16" class="i">+                (Float(lhs), Integer(rhs)) =&gt; Float(lhs % rhs as f64),
</a><a href="#h2-2-17" id="h2-2-17" class="i">+                (Float(lhs), Float(rhs)) =&gt; Float(lhs % rhs),
</a>                 (Float(_), Null) =&gt; Null,
                 (Null, Float(_)) =&gt; Null,
                 (Null, Integer(_)) =&gt; Null,
<a href="#h2-3" id="h2-3" class="h">@@ -208,7 +214,9 @@ impl Expression {
</a>                 }
             },
             Self::Multiply(lhs, rhs) =&gt; match (lhs.evaluate(e)?, rhs.evaluate(e)?) {
<a href="#h2-3-3" id="h2-3-3" class="d">-                (Integer(lhs), Integer(rhs)) =&gt; Integer(lhs * rhs),
</a><a href="#h2-3-4" id="h2-3-4" class="i">+                (Integer(lhs), Integer(rhs)) =&gt; Integer(
</a><a href="#h2-3-5" id="h2-3-5" class="i">+                    lhs.checked_mul(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
</a><a href="#h2-3-6" id="h2-3-6" class="i">+                ),
</a>                 (Integer(lhs), Float(rhs)) =&gt; Float(lhs as f64 * rhs),
                 (Integer(_), Null) =&gt; Null,
                 (Float(lhs), Integer(rhs)) =&gt; Float(lhs * rhs as f64),
<a href="#h2-4" id="h2-4" class="h">@@ -228,7 +236,9 @@ impl Expression {
</a>                 value =&gt; return Err(Error::Value(format!(&quot;Can&#39;t negate {}&quot;, value))),
             },
             Self::Subtract(lhs, rhs) =&gt; match (lhs.evaluate(e)?, rhs.evaluate(e)?) {
<a href="#h2-4-3" id="h2-4-3" class="d">-                (Integer(lhs), Integer(rhs)) =&gt; Integer(lhs - rhs),
</a><a href="#h2-4-4" id="h2-4-4" class="i">+                (Integer(lhs), Integer(rhs)) =&gt; Integer(
</a><a href="#h2-4-5" id="h2-4-5" class="i">+                    lhs.checked_sub(rhs).ok_or_else(|| Error::Value(&quot;Integer overflow&quot;.into()))?,
</a><a href="#h2-4-6" id="h2-4-6" class="i">+                ),
</a>                 (Integer(lhs), Float(rhs)) =&gt; Float(lhs as f64 - rhs),
                 (Integer(_), Null) =&gt; Null,
                 (Float(lhs), Integer(rhs)) =&gt; Float(lhs - rhs as f64),
</pre>
</div>
</body>
</html>
