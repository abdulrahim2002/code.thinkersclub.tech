<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>toysql: improve status command (fixes #30) - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/ae84b635b7f53ecd0510c387320643c798db2b4c.html">ae84b635b7f53ecd0510c387320643c798db2b4c</a>
<b>parent</b> <a href="../commit/b84eac790ecdfc2a11495748de794d2a037496b6.html">b84eac790ecdfc2a11495748de794d2a037496b6</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Tue,  5 May 2020 21:23:53 +0200

toysql: improve status command (fixes #30)

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">src/bin/toysql.rs</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/client.rs</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/kv/mod.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/kv/mvcc.rs</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/server.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/sql/engine/kv.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/sql/engine/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/sql/engine/raft.rs</a></td><td> | </td><td class="num">21</td><td><span class="i">++++++++++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">tests/client/mod.rs</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">tests/client/pool.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">tests/setup.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>11 files changed, 100 insertions(+), 33 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -110,18 +110,43 @@ impl ToySQL {
</a>             },
             &quot;!help&quot; =&gt; println!(
                 r#&quot;
<a href="#h0-0-3" id="h0-0-3" class="d">-    Enter an SQL statement on a single line to execute it and display the result.
</a><a href="#h0-0-4" id="h0-0-4" class="d">-    Semicolons are not supported. The following !-commands are also available:
</a><a href="#h0-0-5" id="h0-0-5" class="d">-
</a><a href="#h0-0-6" id="h0-0-6" class="d">-      !headers &lt;on|off&gt;  Toggles/enables/disables column headers display
</a><a href="#h0-0-7" id="h0-0-7" class="d">-      !help              This help message
</a><a href="#h0-0-8" id="h0-0-8" class="d">-      !status            Display server status
</a><a href="#h0-0-9" id="h0-0-9" class="d">-      !table [table]     Display table schema, if it exists
</a><a href="#h0-0-10" id="h0-0-10" class="d">-      !tables            List tables
</a><a href="#h0-0-11" id="h0-0-11" class="d">-    &quot;#
</a><a href="#h0-0-12" id="h0-0-12" class="i">+Enter a SQL statement on a single line to execute it and display the result.
</a><a href="#h0-0-13" id="h0-0-13" class="i">+Semicolons are not supported. The following commands are also available:
</a><a href="#h0-0-14" id="h0-0-14" class="i">+
</a><a href="#h0-0-15" id="h0-0-15" class="i">+    !headers &lt;on|off&gt;  Enable or disable column headers
</a><a href="#h0-0-16" id="h0-0-16" class="i">+    !help              This help message
</a><a href="#h0-0-17" id="h0-0-17" class="i">+    !status            Display server status
</a><a href="#h0-0-18" id="h0-0-18" class="i">+    !table [table]     Display table schema, if it exists
</a><a href="#h0-0-19" id="h0-0-19" class="i">+    !tables            List tables
</a><a href="#h0-0-20" id="h0-0-20" class="i">+&quot;#
</a>             ),
<a href="#h0-0-22" id="h0-0-22" class="d">-            // FIXME This should have better formatting
</a><a href="#h0-0-23" id="h0-0-23" class="d">-            &quot;!status&quot; =&gt; println!(&quot;{:?}&quot;, self.client.status().await?),
</a><a href="#h0-0-24" id="h0-0-24" class="i">+            &quot;!status&quot; =&gt; {
</a><a href="#h0-0-25" id="h0-0-25" class="i">+                let status = self.client.status().await?;
</a><a href="#h0-0-26" id="h0-0-26" class="i">+                let mut node_logs = status
</a><a href="#h0-0-27" id="h0-0-27" class="i">+                    .raft
</a><a href="#h0-0-28" id="h0-0-28" class="i">+                    .node_last_index
</a><a href="#h0-0-29" id="h0-0-29" class="i">+                    .iter()
</a><a href="#h0-0-30" id="h0-0-30" class="i">+                    .map(|(id, index)| format!(&quot;{}:{}&quot;, id, index))
</a><a href="#h0-0-31" id="h0-0-31" class="i">+                    .collect::&lt;Vec&lt;_&gt;&gt;();
</a><a href="#h0-0-32" id="h0-0-32" class="i">+                node_logs.sort();
</a><a href="#h0-0-33" id="h0-0-33" class="i">+                println!(
</a><a href="#h0-0-34" id="h0-0-34" class="i">+                    r#&quot;
</a><a href="#h0-0-35" id="h0-0-35" class="i">+Server:    {server} (leader {leader} in term {term} with {nodes} nodes)
</a><a href="#h0-0-36" id="h0-0-36" class="i">+Raft log:  {committed} committed, {applied} applied entries
</a><a href="#h0-0-37" id="h0-0-37" class="i">+Node logs: {logs}
</a><a href="#h0-0-38" id="h0-0-38" class="i">+Txns:      {txns_active} active, {txns} total
</a><a href="#h0-0-39" id="h0-0-39" class="i">+&quot;#,
</a><a href="#h0-0-40" id="h0-0-40" class="i">+                    server = status.raft.server,
</a><a href="#h0-0-41" id="h0-0-41" class="i">+                    leader = status.raft.leader,
</a><a href="#h0-0-42" id="h0-0-42" class="i">+                    term = status.raft.term,
</a><a href="#h0-0-43" id="h0-0-43" class="i">+                    nodes = status.raft.node_last_index.len(),
</a><a href="#h0-0-44" id="h0-0-44" class="i">+                    committed = status.raft.commit_index,
</a><a href="#h0-0-45" id="h0-0-45" class="i">+                    applied = status.raft.apply_index,
</a><a href="#h0-0-46" id="h0-0-46" class="i">+                    logs = node_logs.join(&quot; &quot;),
</a><a href="#h0-0-47" id="h0-0-47" class="i">+                    txns = status.mvcc.txns,
</a><a href="#h0-0-48" id="h0-0-48" class="i">+                    txns_active = status.mvcc.txns_active
</a><a href="#h0-0-49" id="h0-0-49" class="i">+                )
</a><a href="#h0-0-50" id="h0-0-50" class="i">+            }
</a>             &quot;!table&quot; =&gt; {
                 let args = getargs(1)?;
                 println!(&quot;{}&quot;, self.client.get_table(args[0]).await?.as_sql());
<a href="#h0-1" id="h0-1" class="h">@@ -208,7 +233,10 @@ impl ToySQL {
</a>         }
 
         let status = self.client.status().await?;
<a href="#h0-1-3" id="h0-1-3" class="d">-        println!(&quot;Connected to ToyDB node \&quot;{}\&quot;. Enter !help for instructions.&quot;, status.server);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+        println!(
</a><a href="#h0-1-5" id="h0-1-5" class="i">+            &quot;Connected to ToyDB node \&quot;{}\&quot;. Enter !help for instructions.&quot;,
</a><a href="#h0-1-6" id="h0-1-6" class="i">+            status.raft.server
</a><a href="#h0-1-7" id="h0-1-7" class="i">+        );
</a> 
         while let Some(input) = self.prompt()? {
             match self.execute(&amp;input).await {
<b>diff --git a/<a id="h1" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,6 +1,5 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-use crate::raft;
</a> use crate::server::{Request, Response};
<a href="#h1-0-2" id="h1-0-2" class="d">-use crate::sql::engine::Mode;
</a><a href="#h1-0-3" id="h1-0-3" class="i">+use crate::sql::engine::{Mode, Status};
</a> use crate::sql::execution::ResultSet;
 use crate::sql::schema::Table;
 use crate::Error;
<a href="#h1-1" id="h1-1" class="h">@@ -106,7 +105,7 @@ impl Client {
</a>     }
 
     /// Checks server status
<a href="#h1-1-3" id="h1-1-3" class="d">-    pub async fn status(&amp;self) -&gt; Result&lt;raft::Status, Error&gt; {
</a><a href="#h1-1-4" id="h1-1-4" class="i">+    pub async fn status(&amp;self) -&gt; Result&lt;Status, Error&gt; {
</a>         match self.call(Request::Status).await? {
             Response::Status(s) =&gt; Ok(s),
             resp =&gt; Err(Error::Value(format!(&quot;Unexpected response: {:?}&quot;, resp))),
<b>diff --git a/<a id="h2" href="../file/src/kv/mod.rs.html">src/kv/mod.rs</a> b/<a href="../file/src/kv/mod.rs.html">src/kv/mod.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,5 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-mod mvcc;
</a><a href="#h2-0-1" id="h2-0-1" class="d">-mod simple;
</a><a href="#h2-0-2" id="h2-0-2" class="i">+pub mod mvcc;
</a><a href="#h2-0-3" id="h2-0-3" class="i">+pub mod simple;
</a> pub mod storage;
 
 pub use mvcc::{Mode, Transaction, MVCC};
<b>diff --git a/<a id="h3" href="../file/src/kv/mvcc.rs.html">src/kv/mvcc.rs</a> b/<a href="../file/src/kv/mvcc.rs.html">src/kv/mvcc.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -7,6 +7,13 @@ use std::collections::HashSet;
</a> use std::ops::{Bound, RangeBounds};
 use std::sync::{Arc, RwLock, RwLockReadGuard, RwLockWriteGuard};
 
<a href="#h3-0-3" id="h3-0-3" class="i">+/// MVCC status
</a><a href="#h3-0-4" id="h3-0-4" class="i">+#[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
</a><a href="#h3-0-5" id="h3-0-5" class="i">+pub struct Status {
</a><a href="#h3-0-6" id="h3-0-6" class="i">+    pub txns: u64,
</a><a href="#h3-0-7" id="h3-0-7" class="i">+    pub txns_active: u64,
</a><a href="#h3-0-8" id="h3-0-8" class="i">+}
</a><a href="#h3-0-9" id="h3-0-9" class="i">+
</a> /// An MVCC-based transactional key-value store.
 pub struct MVCC&lt;S: Storage&gt; {
     /// The storage backend. It is protected by a mutex so it can be shared
<a href="#h3-1" id="h3-1" class="h">@@ -54,6 +61,20 @@ impl&lt;S: Storage&gt; MVCC&lt;S&gt; {
</a>         let mut session = self.storage.write()?;
         session.write(key, value)
     }
<a href="#h3-1-3" id="h3-1-3" class="i">+
</a><a href="#h3-1-4" id="h3-1-4" class="i">+    /// Returns engine status
</a><a href="#h3-1-5" id="h3-1-5" class="i">+    pub fn status(&amp;self) -&gt; Result&lt;Status, Error&gt; {
</a><a href="#h3-1-6" id="h3-1-6" class="i">+        let session = self.storage.read()?;
</a><a href="#h3-1-7" id="h3-1-7" class="i">+        return Ok(Status {
</a><a href="#h3-1-8" id="h3-1-8" class="i">+            txns: match session.read(&amp;Key::TxnNext.encode())? {
</a><a href="#h3-1-9" id="h3-1-9" class="i">+                Some(ref v) =&gt; deserialize(v)?,
</a><a href="#h3-1-10" id="h3-1-10" class="i">+                None =&gt; 1,
</a><a href="#h3-1-11" id="h3-1-11" class="i">+            } - 1,
</a><a href="#h3-1-12" id="h3-1-12" class="i">+            txns_active: session
</a><a href="#h3-1-13" id="h3-1-13" class="i">+                .scan(&amp;Key::TxnActive(0).encode()..&amp;Key::TxnActive(std::u64::MAX).encode())
</a><a href="#h3-1-14" id="h3-1-14" class="i">+                .try_fold(0, |count, r| r.map(|_| count + 1))?,
</a><a href="#h3-1-15" id="h3-1-15" class="i">+        });
</a><a href="#h3-1-16" id="h3-1-16" class="i">+    }
</a> }
 
 /// An MVCC transaction.
<b>diff --git a/<a id="h4" href="../file/src/server.rs.html">src/server.rs</a> b/<a href="../file/src/server.rs.html">src/server.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -116,7 +116,7 @@ pub enum Response {
</a>     Row(Option&lt;Row&gt;),
     GetTable(Table),
     ListTables(Vec&lt;String&gt;),
<a href="#h4-0-3" id="h4-0-3" class="d">-    Status(raft::Status),
</a><a href="#h4-0-4" id="h4-0-4" class="i">+    Status(sql::engine::Status),
</a> }
 
 /// A client session coupled to a SQL session.
<b>diff --git a/<a id="h5" href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a> b/<a href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -11,7 +11,7 @@ use std::collections::HashSet;
</a> /// A SQL engine based on an underlying MVCC key/value store
 pub struct KV&lt;S: Storage&gt; {
     /// The underlying key/value store
<a href="#h5-0-3" id="h5-0-3" class="d">-    kv: kv::MVCC&lt;S&gt;,
</a><a href="#h5-0-4" id="h5-0-4" class="i">+    pub(super) kv: kv::MVCC&lt;S&gt;,
</a> }
 
 // FIXME Implement Clone manually due to https://github.com/rust-lang/rust/issues/26925
<b>diff --git a/<a id="h6" href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a> b/<a href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -2,7 +2,7 @@
</a> mod kv;
 pub mod raft;
 pub use kv::KV;
<a href="#h6-0-3" id="h6-0-3" class="d">-pub use raft::Raft;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+pub use raft::{Raft, Status};
</a> 
 use super::execution::{Context, ResultSet};
 use super::parser::{ast, Parser};
<b>diff --git a/<a id="h7" href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a> b/<a href="../file/src/sql/engine/raft.rs.html">src/sql/engine/raft.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -36,6 +36,8 @@ enum Mutation {
</a> /// A Raft state machine query
 #[derive(Clone, Serialize, Deserialize)]
 enum Query {
<a href="#h7-0-3" id="h7-0-3" class="i">+    /// Fetches engine status
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    Status,
</a>     /// Resumes the active transaction with the given ID
     Resume(u64),
 
<a href="#h7-1" id="h7-1" class="h">@@ -54,6 +56,13 @@ enum Query {
</a>     ReadTable { txn_id: u64, table: String },
 }
 
<a href="#h7-1-3" id="h7-1-3" class="i">+/// Status for the Raft SQL engine.
</a><a href="#h7-1-4" id="h7-1-4" class="i">+#[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
</a><a href="#h7-1-5" id="h7-1-5" class="i">+pub struct Status {
</a><a href="#h7-1-6" id="h7-1-6" class="i">+    pub raft: raft::Status,
</a><a href="#h7-1-7" id="h7-1-7" class="i">+    pub mvcc: kv::mvcc::Status,
</a><a href="#h7-1-8" id="h7-1-8" class="i">+}
</a><a href="#h7-1-9" id="h7-1-9" class="i">+
</a> /// An SQL engine that wraps a Raft cluster.
 #[derive(Clone)]
 pub struct Raft {
<a href="#h7-2" id="h7-2" class="h">@@ -71,9 +80,14 @@ impl Raft {
</a>         State::new(kv)
     }
 
<a href="#h7-2-3" id="h7-2-3" class="d">-    /// Returns engine status, for now just the Raft status.
</a><a href="#h7-2-4" id="h7-2-4" class="d">-    pub fn status(&amp;self) -&gt; Result&lt;raft::Status, Error&gt; {
</a><a href="#h7-2-5" id="h7-2-5" class="d">-        futures::executor::block_on(self.client.status())
</a><a href="#h7-2-6" id="h7-2-6" class="i">+    /// Returns Raft SQL engine status.
</a><a href="#h7-2-7" id="h7-2-7" class="i">+    pub fn status(&amp;self) -&gt; Result&lt;Status, Error&gt; {
</a><a href="#h7-2-8" id="h7-2-8" class="i">+        Ok(Status {
</a><a href="#h7-2-9" id="h7-2-9" class="i">+            raft: futures::executor::block_on(self.client.status())?,
</a><a href="#h7-2-10" id="h7-2-10" class="i">+            mvcc: deserialize(&amp;futures::executor::block_on(
</a><a href="#h7-2-11" id="h7-2-11" class="i">+                self.client.query(serialize(&amp;Query::Status)?),
</a><a href="#h7-2-12" id="h7-2-12" class="i">+            )?)?,
</a><a href="#h7-2-13" id="h7-2-13" class="i">+        })
</a>     }
 }
 
<a href="#h7-3" id="h7-3" class="h">@@ -329,6 +343,7 @@ impl&lt;S: Storage&gt; raft::State for State&lt;S&gt; {
</a>                     .scan_index(&amp;table, &amp;column)?
                     .collect::&lt;Result&lt;Vec&lt;_&gt;, Error&gt;&gt;()?,
             ),
<a href="#h7-3-3" id="h7-3-3" class="i">+            Query::Status =&gt; serialize(&amp;self.engine.kv.status()?),
</a> 
             Query::ReadTable { txn_id, table } =&gt; {
                 serialize(&amp;self.engine.resume(txn_id)?.read_table(&amp;table)?)
<b>diff --git a/<a id="h8" href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a> b/<a href="../file/tests/client/mod.rs.html">tests/client/mod.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -2,8 +2,9 @@ mod pool;
</a> 
 use super::{assert_row, assert_rows, setup};
 
<a href="#h8-0-3" id="h8-0-3" class="d">-use toydb::raft::Status;
</a><a href="#h8-0-4" id="h8-0-4" class="d">-use toydb::sql::engine::Mode;
</a><a href="#h8-0-5" id="h8-0-5" class="i">+use toydb::kv;
</a><a href="#h8-0-6" id="h8-0-6" class="i">+use toydb::raft;
</a><a href="#h8-0-7" id="h8-0-7" class="i">+use toydb::sql::engine::{Mode, Status};
</a> use toydb::sql::execution::ResultSet;
 use toydb::sql::schema;
 use toydb::sql::types::{Column, DataType, Relation, Value};
<a href="#h8-1" id="h8-1" class="h">@@ -119,12 +120,15 @@ async fn status() -&gt; Result&lt;(), Error&gt; {
</a>     assert_eq!(
         c.status().await?,
         Status {
<a href="#h8-1-3" id="h8-1-3" class="d">-            server: &quot;test&quot;.into(),
</a><a href="#h8-1-4" id="h8-1-4" class="d">-            leader: &quot;test&quot;.into(),
</a><a href="#h8-1-5" id="h8-1-5" class="d">-            term: 0,
</a><a href="#h8-1-6" id="h8-1-6" class="d">-            node_last_index: vec![(&quot;test&quot;.to_string(), 26)].into_iter().collect(),
</a><a href="#h8-1-7" id="h8-1-7" class="d">-            commit_index: 26,
</a><a href="#h8-1-8" id="h8-1-8" class="d">-            apply_index: 26,
</a><a href="#h8-1-9" id="h8-1-9" class="i">+            raft: raft::Status {
</a><a href="#h8-1-10" id="h8-1-10" class="i">+                server: &quot;test&quot;.into(),
</a><a href="#h8-1-11" id="h8-1-11" class="i">+                leader: &quot;test&quot;.into(),
</a><a href="#h8-1-12" id="h8-1-12" class="i">+                term: 0,
</a><a href="#h8-1-13" id="h8-1-13" class="i">+                node_last_index: vec![(&quot;test&quot;.to_string(), 26)].into_iter().collect(),
</a><a href="#h8-1-14" id="h8-1-14" class="i">+                commit_index: 26,
</a><a href="#h8-1-15" id="h8-1-15" class="i">+                apply_index: 26,
</a><a href="#h8-1-16" id="h8-1-16" class="i">+            },
</a><a href="#h8-1-17" id="h8-1-17" class="i">+            mvcc: kv::mvcc::Status { txns: 1, txns_active: 0 },
</a>         }
     );
     Ok(())
<b>diff --git a/<a id="h9" href="../file/tests/client/pool.rs.html">tests/client/pool.rs</a> b/<a href="../file/tests/client/pool.rs.html">tests/client/pool.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -25,7 +25,7 @@ async fn get() -&gt; Result&lt;(), Error&gt; {
</a>     let mut servers = HashSet::new();
     let mut ids = HashSet::new();
     for client in vec![a, b, c, d, e] {
<a href="#h9-0-3" id="h9-0-3" class="d">-        servers.insert(client.status().await?.server);
</a><a href="#h9-0-4" id="h9-0-4" class="i">+        servers.insert(client.status().await?.raft.server);
</a>         ids.insert(client.id());
     }
     assert_eq!(
<b>diff --git a/<a id="h10" href="../file/tests/setup.rs.html">tests/setup.rs</a> b/<a href="../file/tests/setup.rs.html">tests/setup.rs</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -132,7 +132,7 @@ pub async fn cluster_with_clients(
</a>     let mut clients = Vec::&lt;Client&gt;::new();
     for (id, (addr_sql, _)) in nodes {
         let client = Client::new(addr_sql).await?;
<a href="#h10-0-3" id="h10-0-3" class="d">-        assert_eq!(id, client.status().await?.server);
</a><a href="#h10-0-4" id="h10-0-4" class="i">+        assert_eq!(id, client.status().await?.raft.server);
</a>         clients.push(client);
     }
 
</pre>
</div>
</body>
</html>
