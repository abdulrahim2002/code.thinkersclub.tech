<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: added support for UNIQUE constraints - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/34ead6f308dc25dc1999eb396e1aeab92b98791b.html">34ead6f308dc25dc1999eb396e1aeab92b98791b</a>
<b>parent</b> <a href="../commit/8de209c27f4c4fcac48bb79249da64780a6cacd2.html">8de209c27f4c4fcac48bb79249da64780a6cacd2</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Fri, 10 Jan 2020 17:37:08 +0100

sql: added support for UNIQUE constraints

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README.md</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">docs/README.md</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/engine/kv.rs</a></td><td> | </td><td class="num">49</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/tests/schema.rs</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">src/sql/tests/schema/create_table_pk_unique</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">src/sql/tests/schema/create_table_unique</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">src/sql/tests/schema/create_table_unique_default</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">src/sql/tests/schema/create_table_unique_not_null</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">src/sql/tests/schema/create_table_unique_null</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">src/sql/tests/schema/insert_unique_boolean</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">src/sql/tests/schema/insert_unique_boolean_duplicate</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">src/sql/tests/schema/insert_unique_float</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">src/sql/tests/schema/insert_unique_float_duplicate</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">src/sql/tests/schema/insert_unique_integer</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">src/sql/tests/schema/insert_unique_integer_duplicate</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">src/sql/tests/schema/insert_unique_nulls</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">src/sql/tests/schema/insert_unique_string</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">src/sql/tests/schema/insert_unique_string_case</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">src/sql/tests/schema/insert_unique_string_duplicate</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">src/sql/tests/schema/update_unique_boolean</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h20">src/sql/tests/schema/update_unique_boolean_duplicate</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h21">src/sql/tests/schema/update_unique_boolean_same</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h22">src/sql/tests/schema/update_unique_nulls</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>23 files changed, 303 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -80,7 +80,9 @@ toydb@1&gt; SELECT * FROM movies
</a> 
 - [x] **Data Types:** Support for nulls, booleans, 64-bit integers, 64-bit floats, and UTF-8 strings up to 1 KB.
 
<a href="#h0-0-3" id="h0-0-3" class="d">-- [ ] **Schemas:** Compulsory singluar primary keys, unique and foreign key constraints, indexes.
</a><a href="#h0-0-4" id="h0-0-4" class="i">+- [x] **Schemas:** Compulsory singluar primary keys, default values, unique and foreign key constraints.
</a><a href="#h0-0-5" id="h0-0-5" class="i">+
</a><a href="#h0-0-6" id="h0-0-6" class="i">+  - [ ] Indexes.
</a> 
 - [x] **Transactions:** Self-written ACID-compliant transaction engine with MVCC-based snapshot isolation.
 
<b>diff --git a/<a id="h1" href="../file/docs/README.md.html">docs/README.md</a> b/<a href="../file/docs/README.md.html">docs/README.md</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -165,7 +165,7 @@ CREATE TABLE &lt;b&gt;&lt;i&gt;table_name&lt;/i&gt;&lt;/b&gt; (
</a> 
 where &lt;b&gt;&lt;i&gt;column_constraint&lt;/i&gt;&lt;/b&gt; is:
 
<a href="#h1-0-3" id="h1-0-3" class="d">-{ NOT NULL | NULL | PRIMARY KEY | DEFAULT &lt;b&gt;&lt;i&gt;expr&lt;/i&gt;&lt;/b&gt; | REFERENCES &lt;b&gt;&lt;i&gt;ref_table&lt;/i&gt;&lt;/b&gt; }
</a><a href="#h1-0-4" id="h1-0-4" class="i">+{ NOT NULL | NULL | PRIMARY KEY | DEFAULT &lt;b&gt;&lt;i&gt;expr&lt;/i&gt;&lt;/b&gt; | REFERENCES &lt;b&gt;&lt;i&gt;ref_table&lt;/i&gt;&lt;/b&gt; | UNIQUE }
</a> &lt;/pre&gt;
 
 * ***`table_name`***: The name of the table. Must be a [valid identifier](#identifiers). Errors if a table with this name already exists.
<a href="#h1-1" id="h1-1" class="h">@@ -184,6 +184,8 @@ where &lt;b&gt;&lt;i&gt;column_constraint&lt;/i&gt;&lt;/b&gt; is:
</a> 
 * `REFERENCES`***`ref_table`***: The column is a foreign key to ***`ref_table`***&#39;s primary key, enforcing referential integrity.
 
<a href="#h1-1-3" id="h1-1-3" class="i">+* `UNIQUE`: The column may only contain unique (distinct) values. `NULL` values are not considered equal, thus a `UNIQUE` column which allows `NULL` may contain multiple `NULL` values. `PRIMARY KEY` columns are implicitly `UNIQUE`.
</a><a href="#h1-1-4" id="h1-1-4" class="i">+
</a> #### Example
 
 ```
<a href="#h1-2" id="h1-2" class="h">@@ -191,6 +193,7 @@ CREATE TABLE movie (
</a>     id INTEGER PRIMARY KEY,
     title STRING NOT NULL,
     release_year INTEGER,
<a href="#h1-2-3" id="h1-2-3" class="i">+    imdb_id STRING UNIQUE,
</a>     bluray BOOLEAN NOT NULL DEFAULT TRUE
 )
 ```
<b>diff --git a/<a id="h2" href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a> b/<a href="../file/src/sql/engine/kv.rs.html">src/sql/engine/kv.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -86,6 +86,29 @@ impl&lt;S: kv::storage::Storage&gt; super::Transaction for Transaction&lt;S&gt; {
</a>             }
         }
 
<a href="#h2-0-3" id="h2-0-3" class="i">+        // Validate uniqueness
</a><a href="#h2-0-4" id="h2-0-4" class="i">+        let unique: Vec&lt;_&gt; = table
</a><a href="#h2-0-5" id="h2-0-5" class="i">+            .columns
</a><a href="#h2-0-6" id="h2-0-6" class="i">+            .iter()
</a><a href="#h2-0-7" id="h2-0-7" class="i">+            .zip(row.iter())
</a><a href="#h2-0-8" id="h2-0-8" class="i">+            .enumerate()
</a><a href="#h2-0-9" id="h2-0-9" class="i">+            .filter(|(_i, (c, v))| c.unique &amp;&amp; !c.primary_key &amp;&amp; v != &amp;&amp;types::Value::Null)
</a><a href="#h2-0-10" id="h2-0-10" class="i">+            .map(|(i, (c, v))| (i, c, v))
</a><a href="#h2-0-11" id="h2-0-11" class="i">+            .collect();
</a><a href="#h2-0-12" id="h2-0-12" class="i">+        if !unique.is_empty() {
</a><a href="#h2-0-13" id="h2-0-13" class="i">+            let mut scan = self.scan(&amp;table.name)?;
</a><a href="#h2-0-14" id="h2-0-14" class="i">+            while let Some(r) = scan.next().transpose()? {
</a><a href="#h2-0-15" id="h2-0-15" class="i">+                for (i, c, v) in unique.iter() {
</a><a href="#h2-0-16" id="h2-0-16" class="i">+                    if &amp;r.get(*i).unwrap_or_else(|| &amp;types::Value::Null) == v {
</a><a href="#h2-0-17" id="h2-0-17" class="i">+                        return Err(Error::Value(format!(
</a><a href="#h2-0-18" id="h2-0-18" class="i">+                            &quot;Unique value {} already exists for column {}&quot;,
</a><a href="#h2-0-19" id="h2-0-19" class="i">+                            v, c.name
</a><a href="#h2-0-20" id="h2-0-20" class="i">+                        )));
</a><a href="#h2-0-21" id="h2-0-21" class="i">+                    }
</a><a href="#h2-0-22" id="h2-0-22" class="i">+                }
</a><a href="#h2-0-23" id="h2-0-23" class="i">+            }
</a><a href="#h2-0-24" id="h2-0-24" class="i">+        }
</a><a href="#h2-0-25" id="h2-0-25" class="i">+
</a>         self.txn.set(&amp;Key::Row(&amp;table.name, &amp;id).encode(), serialize(&amp;row)?)
     }
 
<a href="#h2-1" id="h2-1" class="h">@@ -177,6 +200,32 @@ impl&lt;S: kv::storage::Storage&gt; super::Transaction for Transaction&lt;S&gt; {
</a>                 }
             }
 
<a href="#h2-1-3" id="h2-1-3" class="i">+            // Validate uniqueness
</a><a href="#h2-1-4" id="h2-1-4" class="i">+            let unique: Vec&lt;_&gt; = table
</a><a href="#h2-1-5" id="h2-1-5" class="i">+                .columns
</a><a href="#h2-1-6" id="h2-1-6" class="i">+                .iter()
</a><a href="#h2-1-7" id="h2-1-7" class="i">+                .zip(row.iter())
</a><a href="#h2-1-8" id="h2-1-8" class="i">+                .enumerate()
</a><a href="#h2-1-9" id="h2-1-9" class="i">+                .filter(|(_i, (c, v))| c.unique &amp;&amp; !c.primary_key &amp;&amp; v != &amp;&amp;types::Value::Null)
</a><a href="#h2-1-10" id="h2-1-10" class="i">+                .map(|(i, (c, v))| (i, c, v))
</a><a href="#h2-1-11" id="h2-1-11" class="i">+                .collect();
</a><a href="#h2-1-12" id="h2-1-12" class="i">+            if !unique.is_empty() {
</a><a href="#h2-1-13" id="h2-1-13" class="i">+                let mut scan = self.scan(&amp;table.name)?;
</a><a href="#h2-1-14" id="h2-1-14" class="i">+                while let Some(r) = scan.next().transpose()? {
</a><a href="#h2-1-15" id="h2-1-15" class="i">+                    if &amp;table.row_key(&amp;r)? == id {
</a><a href="#h2-1-16" id="h2-1-16" class="i">+                        continue;
</a><a href="#h2-1-17" id="h2-1-17" class="i">+                    }
</a><a href="#h2-1-18" id="h2-1-18" class="i">+                    for (i, c, v) in unique.iter() {
</a><a href="#h2-1-19" id="h2-1-19" class="i">+                        if &amp;r.get(*i).unwrap_or_else(|| &amp;types::Value::Null) == v {
</a><a href="#h2-1-20" id="h2-1-20" class="i">+                            return Err(Error::Value(format!(
</a><a href="#h2-1-21" id="h2-1-21" class="i">+                                &quot;Unique value {} already exists for column {}&quot;,
</a><a href="#h2-1-22" id="h2-1-22" class="i">+                                v, c.name
</a><a href="#h2-1-23" id="h2-1-23" class="i">+                            )));
</a><a href="#h2-1-24" id="h2-1-24" class="i">+                        }
</a><a href="#h2-1-25" id="h2-1-25" class="i">+                    }
</a><a href="#h2-1-26" id="h2-1-26" class="i">+                }
</a><a href="#h2-1-27" id="h2-1-27" class="i">+            }
</a><a href="#h2-1-28" id="h2-1-28" class="i">+
</a>             self.txn.set(&amp;Key::Row(&amp;table.name, &amp;id).encode(), serialize(&amp;row)?)
         }
     }
<b>diff --git a/<a id="h3" href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a> b/<a href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -84,6 +84,7 @@ test_schema! {
</a>     create_table_pk_multiple: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, name STRING PRIMARY KEY)&quot;,
     create_table_pk_nullable: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY NULL)&quot;,
     create_table_pk_default: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY DEFAULT 1)&quot;,
<a href="#h3-0-3" id="h3-0-3" class="i">+    create_table_pk_unique: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY UNIQUE)&quot;,
</a> 
     create_table_null: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NULL)&quot;,
     create_table_null_not: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NOT NULL)&quot;,
<a href="#h3-1" id="h3-1" class="h">@@ -100,6 +101,11 @@ test_schema! {
</a>     create_table_default_conflict: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT 7)&quot;,
     create_table_default_conflict_float_integer: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value FLOAT DEFAULT 7)&quot;,
     create_table_default_conflict_integer_float: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value INTEGER DEFAULT 3.14)&quot;,
<a href="#h3-1-3" id="h3-1-3" class="i">+
</a><a href="#h3-1-4" id="h3-1-4" class="i">+    create_table_unique: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING UNIQUE)&quot;,
</a><a href="#h3-1-5" id="h3-1-5" class="i">+    create_table_unique_null: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NULL UNIQUE)&quot;,
</a><a href="#h3-1-6" id="h3-1-6" class="i">+    create_table_unique_not_null: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NOT NULL UNIQUE)&quot;,
</a><a href="#h3-1-7" id="h3-1-7" class="i">+    create_table_unique_default: &quot;CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT &#39;foo&#39; UNIQUE)&quot;,
</a> }
 test_schema! { with [&quot;CREATE TABLE test (id INTEGER PRIMARY KEY)&quot;];
     create_table_exists: &quot;CREATE TABLE test (id INTEGER PRIMARY KEY)&quot;,
<a href="#h3-2" id="h3-2" class="h">@@ -258,6 +264,34 @@ test_schema! { with [
</a> }
 
 test_schema! { with [
<a href="#h3-2-3" id="h3-2-3" class="i">+        r#&quot;CREATE TABLE &quot;unique&quot; (
</a><a href="#h3-2-4" id="h3-2-4" class="i">+            id INTEGER PRIMARY KEY,
</a><a href="#h3-2-5" id="h3-2-5" class="i">+            &quot;boolean&quot; BOOLEAN UNIQUE,
</a><a href="#h3-2-6" id="h3-2-6" class="i">+            &quot;float&quot; FLOAT UNIQUE,
</a><a href="#h3-2-7" id="h3-2-7" class="i">+            &quot;integer&quot; INTEGER UNIQUE,
</a><a href="#h3-2-8" id="h3-2-8" class="i">+            &quot;string&quot; STRING UNIQUE
</a><a href="#h3-2-9" id="h3-2-9" class="i">+        )&quot;#,
</a><a href="#h3-2-10" id="h3-2-10" class="i">+        r#&quot;INSERT INTO &quot;unique&quot; VALUES (0, NULL, NULL, NULL, NULL, NULL)&quot;#,
</a><a href="#h3-2-11" id="h3-2-11" class="i">+        r#&quot;INSERT INTO &quot;unique&quot; VALUES (1, TRUE, 3.14, 7, &#39;foo&#39;)&quot;#,
</a><a href="#h3-2-12" id="h3-2-12" class="i">+    ];
</a><a href="#h3-2-13" id="h3-2-13" class="i">+    insert_unique_boolean: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, FALSE)&quot;#,
</a><a href="#h3-2-14" id="h3-2-14" class="i">+    insert_unique_boolean_duplicate: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, TRUE)&quot;#,
</a><a href="#h3-2-15" id="h3-2-15" class="i">+    insert_unique_float: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 2.718)&quot;#,
</a><a href="#h3-2-16" id="h3-2-16" class="i">+    insert_unique_float_duplicate: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 3.14)&quot;#,
</a><a href="#h3-2-17" id="h3-2-17" class="i">+    insert_unique_integer: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 3)&quot;#,
</a><a href="#h3-2-18" id="h3-2-18" class="i">+    insert_unique_integer_duplicate: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 7)&quot;#,
</a><a href="#h3-2-19" id="h3-2-19" class="i">+    insert_unique_string: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;bar&#39;)&quot;#,
</a><a href="#h3-2-20" id="h3-2-20" class="i">+    insert_unique_string_duplicate: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;foo&#39;)&quot;#,
</a><a href="#h3-2-21" id="h3-2-21" class="i">+    insert_unique_string_case: r#&quot;INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;Foo&#39;)&quot;#,
</a><a href="#h3-2-22" id="h3-2-22" class="i">+    insert_unique_nulls: r#&quot;INSERT INTO &quot;unique&quot; VALUES (2, NULL, NULL, NULL, NULL)&quot;#,
</a><a href="#h3-2-23" id="h3-2-23" class="i">+
</a><a href="#h3-2-24" id="h3-2-24" class="i">+    update_unique_boolean: r#&quot;UPDATE &quot;unique&quot; SET &quot;boolean&quot; = FALSE WHERE id = 0&quot;#,
</a><a href="#h3-2-25" id="h3-2-25" class="i">+    update_unique_boolean_duplicate: r#&quot;UPDATE &quot;unique&quot; SET &quot;boolean&quot; = TRUE WHERE id = 0&quot;#,
</a><a href="#h3-2-26" id="h3-2-26" class="i">+    update_unique_boolean_same: r#&quot;UPDATE &quot;unique&quot; SET &quot;boolean&quot; = TRUE WHERE id = 1&quot;#,
</a><a href="#h3-2-27" id="h3-2-27" class="i">+    update_unique_nulls: r#&quot;UPDATE &quot;unique&quot; SET &quot;boolean&quot; = NULL, &quot;float&quot; = NULL, &quot;integer&quot; = NULL, &quot;string&quot; = NULL WHERE id = 1&quot;#,
</a><a href="#h3-2-28" id="h3-2-28" class="i">+}
</a><a href="#h3-2-29" id="h3-2-29" class="i">+
</a><a href="#h3-2-30" id="h3-2-30" class="i">+test_schema! { with [
</a>         // FIXME Test non-integer references as well
         r#&quot;CREATE TABLE &quot;integer&quot; (id INTEGER PRIMARY KEY)&quot;#,
         r#&quot;INSERT INTO &quot;integer&quot; VALUES (1), (2), (3)&quot;#,
<b>diff --git a/<a id="h4" href="../file/src/sql/tests/schema/create_table_pk_unique.html">src/sql/tests/schema/create_table_pk_unique</a> b/<a href="../file/src/sql/tests/schema/create_table_pk_unique.html">src/sql/tests/schema/create_table_pk_unique</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+Query: CREATE TABLE name (id INTEGER PRIMARY KEY UNIQUE)
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+Storage:
</a><a href="#h4-0-3" id="h4-0-3" class="i">+CREATE TABLE name (
</a><a href="#h4-0-4" id="h4-0-4" class="i">+  id INTEGER PRIMARY KEY
</a><a href="#h4-0-5" id="h4-0-5" class="i">+)
</a><b>diff --git a/<a id="h5" href="../file/src/sql/tests/schema/create_table_unique.html">src/sql/tests/schema/create_table_unique</a> b/<a href="../file/src/sql/tests/schema/create_table_unique.html">src/sql/tests/schema/create_table_unique</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING UNIQUE)
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+Storage:
</a><a href="#h5-0-3" id="h5-0-3" class="i">+CREATE TABLE name (
</a><a href="#h5-0-4" id="h5-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h5-0-5" id="h5-0-5" class="i">+  value STRING DEFAULT NULL UNIQUE
</a><a href="#h5-0-6" id="h5-0-6" class="i">+)
</a><b>diff --git a/<a id="h6" href="../file/src/sql/tests/schema/create_table_unique_default.html">src/sql/tests/schema/create_table_unique_default</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_default.html">src/sql/tests/schema/create_table_unique_default</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT &#39;foo&#39; UNIQUE)
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+Storage:
</a><a href="#h6-0-3" id="h6-0-3" class="i">+CREATE TABLE name (
</a><a href="#h6-0-4" id="h6-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h6-0-5" id="h6-0-5" class="i">+  value STRING DEFAULT foo UNIQUE
</a><a href="#h6-0-6" id="h6-0-6" class="i">+)
</a><b>diff --git a/<a id="h7" href="../file/src/sql/tests/schema/create_table_unique_not_null.html">src/sql/tests/schema/create_table_unique_not_null</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_not_null.html">src/sql/tests/schema/create_table_unique_not_null</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NOT NULL UNIQUE)
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+Storage:
</a><a href="#h7-0-3" id="h7-0-3" class="i">+CREATE TABLE name (
</a><a href="#h7-0-4" id="h7-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h7-0-5" id="h7-0-5" class="i">+  value STRING NOT NULL UNIQUE
</a><a href="#h7-0-6" id="h7-0-6" class="i">+)
</a><b>diff --git a/<a id="h8" href="../file/src/sql/tests/schema/create_table_unique_null.html">src/sql/tests/schema/create_table_unique_null</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_null.html">src/sql/tests/schema/create_table_unique_null</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NULL UNIQUE)
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+Storage:
</a><a href="#h8-0-3" id="h8-0-3" class="i">+CREATE TABLE name (
</a><a href="#h8-0-4" id="h8-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h8-0-5" id="h8-0-5" class="i">+  value STRING DEFAULT NULL UNIQUE
</a><a href="#h8-0-6" id="h8-0-6" class="i">+)
</a><b>diff --git a/<a id="h9" href="../file/src/sql/tests/schema/insert_unique_boolean.html">src/sql/tests/schema/insert_unique_boolean</a> b/<a href="../file/src/sql/tests/schema/insert_unique_boolean.html">src/sql/tests/schema/insert_unique_boolean</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, FALSE)
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+Storage:
</a><a href="#h9-0-3" id="h9-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h9-0-4" id="h9-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h9-0-5" id="h9-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h9-0-6" id="h9-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h9-0-7" id="h9-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h9-0-8" id="h9-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h9-0-9" id="h9-0-9" class="i">+)
</a><a href="#h9-0-10" id="h9-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h9-0-11" id="h9-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h9-0-12" id="h9-0-12" class="i">+[Integer(2), Boolean(false), Null, Null, Null]
</a><b>diff --git a/<a id="h10" href="../file/src/sql/tests/schema/insert_unique_boolean_duplicate.html">src/sql/tests/schema/insert_unique_boolean_duplicate</a> b/<a href="../file/src/sql/tests/schema/insert_unique_boolean_duplicate.html">src/sql/tests/schema/insert_unique_boolean_duplicate</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, TRUE)
</a><a href="#h10-0-1" id="h10-0-1" class="i">+Error: Value(&quot;Unique value TRUE already exists for column boolean&quot;)
</a><a href="#h10-0-2" id="h10-0-2" class="i">+
</a><a href="#h10-0-3" id="h10-0-3" class="i">+Storage:
</a><a href="#h10-0-4" id="h10-0-4" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h10-0-5" id="h10-0-5" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h10-0-6" id="h10-0-6" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h10-0-7" id="h10-0-7" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h10-0-8" id="h10-0-8" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h10-0-9" id="h10-0-9" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h10-0-10" id="h10-0-10" class="i">+)
</a><a href="#h10-0-11" id="h10-0-11" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h10-0-12" id="h10-0-12" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h11" href="../file/src/sql/tests/schema/insert_unique_float.html">src/sql/tests/schema/insert_unique_float</a> b/<a href="../file/src/sql/tests/schema/insert_unique_float.html">src/sql/tests/schema/insert_unique_float</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 2.718)
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+Storage:
</a><a href="#h11-0-3" id="h11-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h11-0-4" id="h11-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h11-0-5" id="h11-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h11-0-6" id="h11-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h11-0-7" id="h11-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h11-0-8" id="h11-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h11-0-9" id="h11-0-9" class="i">+)
</a><a href="#h11-0-10" id="h11-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h11-0-11" id="h11-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h11-0-12" id="h11-0-12" class="i">+[Integer(2), Null, Float(2.718), Null, Null]
</a><b>diff --git a/<a id="h12" href="../file/src/sql/tests/schema/insert_unique_float_duplicate.html">src/sql/tests/schema/insert_unique_float_duplicate</a> b/<a href="../file/src/sql/tests/schema/insert_unique_float_duplicate.html">src/sql/tests/schema/insert_unique_float_duplicate</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 3.14)
</a><a href="#h12-0-1" id="h12-0-1" class="i">+Error: Value(&quot;Unique value 3.14 already exists for column float&quot;)
</a><a href="#h12-0-2" id="h12-0-2" class="i">+
</a><a href="#h12-0-3" id="h12-0-3" class="i">+Storage:
</a><a href="#h12-0-4" id="h12-0-4" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h12-0-5" id="h12-0-5" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h12-0-6" id="h12-0-6" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h12-0-7" id="h12-0-7" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h12-0-8" id="h12-0-8" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h12-0-9" id="h12-0-9" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h12-0-10" id="h12-0-10" class="i">+)
</a><a href="#h12-0-11" id="h12-0-11" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h12-0-12" id="h12-0-12" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h13" href="../file/src/sql/tests/schema/insert_unique_integer.html">src/sql/tests/schema/insert_unique_integer</a> b/<a href="../file/src/sql/tests/schema/insert_unique_integer.html">src/sql/tests/schema/insert_unique_integer</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 3)
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+Storage:
</a><a href="#h13-0-3" id="h13-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h13-0-4" id="h13-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h13-0-5" id="h13-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h13-0-6" id="h13-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h13-0-7" id="h13-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h13-0-8" id="h13-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h13-0-9" id="h13-0-9" class="i">+)
</a><a href="#h13-0-10" id="h13-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h13-0-11" id="h13-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h13-0-12" id="h13-0-12" class="i">+[Integer(2), Null, Null, Integer(3), Null]
</a><b>diff --git a/<a id="h14" href="../file/src/sql/tests/schema/insert_unique_integer_duplicate.html">src/sql/tests/schema/insert_unique_integer_duplicate</a> b/<a href="../file/src/sql/tests/schema/insert_unique_integer_duplicate.html">src/sql/tests/schema/insert_unique_integer_duplicate</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 7)
</a><a href="#h14-0-1" id="h14-0-1" class="i">+Error: Value(&quot;Unique value 7 already exists for column integer&quot;)
</a><a href="#h14-0-2" id="h14-0-2" class="i">+
</a><a href="#h14-0-3" id="h14-0-3" class="i">+Storage:
</a><a href="#h14-0-4" id="h14-0-4" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h14-0-5" id="h14-0-5" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h14-0-6" id="h14-0-6" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h14-0-7" id="h14-0-7" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h14-0-8" id="h14-0-8" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h14-0-9" id="h14-0-9" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h14-0-10" id="h14-0-10" class="i">+)
</a><a href="#h14-0-11" id="h14-0-11" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h14-0-12" id="h14-0-12" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h15" href="../file/src/sql/tests/schema/insert_unique_nulls.html">src/sql/tests/schema/insert_unique_nulls</a> b/<a href="../file/src/sql/tests/schema/insert_unique_nulls.html">src/sql/tests/schema/insert_unique_nulls</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; VALUES (2, NULL, NULL, NULL, NULL)
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+Storage:
</a><a href="#h15-0-3" id="h15-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h15-0-4" id="h15-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h15-0-5" id="h15-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h15-0-6" id="h15-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h15-0-7" id="h15-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h15-0-8" id="h15-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h15-0-9" id="h15-0-9" class="i">+)
</a><a href="#h15-0-10" id="h15-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h15-0-11" id="h15-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h15-0-12" id="h15-0-12" class="i">+[Integer(2), Null, Null, Null, Null]
</a><b>diff --git a/<a id="h16" href="../file/src/sql/tests/schema/insert_unique_string.html">src/sql/tests/schema/insert_unique_string</a> b/<a href="../file/src/sql/tests/schema/insert_unique_string.html">src/sql/tests/schema/insert_unique_string</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;bar&#39;)
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+Storage:
</a><a href="#h16-0-3" id="h16-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h16-0-4" id="h16-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h16-0-5" id="h16-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h16-0-6" id="h16-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h16-0-7" id="h16-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h16-0-8" id="h16-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h16-0-9" id="h16-0-9" class="i">+)
</a><a href="#h16-0-10" id="h16-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h16-0-11" id="h16-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h16-0-12" id="h16-0-12" class="i">+[Integer(2), Null, Null, Null, String(&quot;bar&quot;)]
</a><b>diff --git a/<a id="h17" href="../file/src/sql/tests/schema/insert_unique_string_case.html">src/sql/tests/schema/insert_unique_string_case</a> b/<a href="../file/src/sql/tests/schema/insert_unique_string_case.html">src/sql/tests/schema/insert_unique_string_case</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;Foo&#39;)
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+Storage:
</a><a href="#h17-0-3" id="h17-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h17-0-4" id="h17-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h17-0-5" id="h17-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h17-0-6" id="h17-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h17-0-7" id="h17-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h17-0-8" id="h17-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h17-0-9" id="h17-0-9" class="i">+)
</a><a href="#h17-0-10" id="h17-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h17-0-11" id="h17-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><a href="#h17-0-12" id="h17-0-12" class="i">+[Integer(2), Null, Null, Null, String(&quot;Foo&quot;)]
</a><b>diff --git a/<a id="h18" href="../file/src/sql/tests/schema/insert_unique_string_duplicate.html">src/sql/tests/schema/insert_unique_string_duplicate</a> b/<a href="../file/src/sql/tests/schema/insert_unique_string_duplicate.html">src/sql/tests/schema/insert_unique_string_duplicate</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;foo&#39;)
</a><a href="#h18-0-1" id="h18-0-1" class="i">+Error: Value(&quot;Unique value foo already exists for column string&quot;)
</a><a href="#h18-0-2" id="h18-0-2" class="i">+
</a><a href="#h18-0-3" id="h18-0-3" class="i">+Storage:
</a><a href="#h18-0-4" id="h18-0-4" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h18-0-5" id="h18-0-5" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h18-0-6" id="h18-0-6" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h18-0-7" id="h18-0-7" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h18-0-8" id="h18-0-8" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h18-0-9" id="h18-0-9" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h18-0-10" id="h18-0-10" class="i">+)
</a><a href="#h18-0-11" id="h18-0-11" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h18-0-12" id="h18-0-12" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h19" href="../file/src/sql/tests/schema/update_unique_boolean.html">src/sql/tests/schema/update_unique_boolean</a> b/<a href="../file/src/sql/tests/schema/update_unique_boolean.html">src/sql/tests/schema/update_unique_boolean</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = FALSE WHERE id = 0
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+Storage:
</a><a href="#h19-0-3" id="h19-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h19-0-4" id="h19-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h19-0-5" id="h19-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h19-0-6" id="h19-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h19-0-7" id="h19-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h19-0-8" id="h19-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h19-0-9" id="h19-0-9" class="i">+)
</a><a href="#h19-0-10" id="h19-0-10" class="i">+[Integer(0), Boolean(false), Null, Null, Null]
</a><a href="#h19-0-11" id="h19-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h20" href="../file/src/sql/tests/schema/update_unique_boolean_duplicate.html">src/sql/tests/schema/update_unique_boolean_duplicate</a> b/<a href="../file/src/sql/tests/schema/update_unique_boolean_duplicate.html">src/sql/tests/schema/update_unique_boolean_duplicate</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h20-0-0" id="h20-0-0" class="i">+Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = TRUE WHERE id = 0
</a><a href="#h20-0-1" id="h20-0-1" class="i">+Error: Value(&quot;Unique value TRUE already exists for column boolean&quot;)
</a><a href="#h20-0-2" id="h20-0-2" class="i">+
</a><a href="#h20-0-3" id="h20-0-3" class="i">+Storage:
</a><a href="#h20-0-4" id="h20-0-4" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h20-0-5" id="h20-0-5" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h20-0-6" id="h20-0-6" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h20-0-7" id="h20-0-7" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h20-0-8" id="h20-0-8" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h20-0-9" id="h20-0-9" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h20-0-10" id="h20-0-10" class="i">+)
</a><a href="#h20-0-11" id="h20-0-11" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h20-0-12" id="h20-0-12" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h21" href="../file/src/sql/tests/schema/update_unique_boolean_same.html">src/sql/tests/schema/update_unique_boolean_same</a> b/<a href="../file/src/sql/tests/schema/update_unique_boolean_same.html">src/sql/tests/schema/update_unique_boolean_same</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h21-0-0" id="h21-0-0" class="i">+Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = TRUE WHERE id = 1
</a><a href="#h21-0-1" id="h21-0-1" class="i">+
</a><a href="#h21-0-2" id="h21-0-2" class="i">+Storage:
</a><a href="#h21-0-3" id="h21-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h21-0-4" id="h21-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h21-0-5" id="h21-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h21-0-6" id="h21-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h21-0-7" id="h21-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h21-0-8" id="h21-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h21-0-9" id="h21-0-9" class="i">+)
</a><a href="#h21-0-10" id="h21-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h21-0-11" id="h21-0-11" class="i">+[Integer(1), Boolean(true), Float(3.14), Integer(7), String(&quot;foo&quot;)]
</a><b>diff --git a/<a id="h22" href="../file/src/sql/tests/schema/update_unique_nulls.html">src/sql/tests/schema/update_unique_nulls</a> b/<a href="../file/src/sql/tests/schema/update_unique_nulls.html">src/sql/tests/schema/update_unique_nulls</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h22-0-0" id="h22-0-0" class="i">+Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = NULL, &quot;float&quot; = NULL, &quot;integer&quot; = NULL, &quot;string&quot; = NULL WHERE id = 1
</a><a href="#h22-0-1" id="h22-0-1" class="i">+
</a><a href="#h22-0-2" id="h22-0-2" class="i">+Storage:
</a><a href="#h22-0-3" id="h22-0-3" class="i">+CREATE TABLE &quot;unique&quot; (
</a><a href="#h22-0-4" id="h22-0-4" class="i">+  id INTEGER PRIMARY KEY,
</a><a href="#h22-0-5" id="h22-0-5" class="i">+  &quot;boolean&quot; BOOLEAN DEFAULT NULL UNIQUE,
</a><a href="#h22-0-6" id="h22-0-6" class="i">+  &quot;float&quot; FLOAT DEFAULT NULL UNIQUE,
</a><a href="#h22-0-7" id="h22-0-7" class="i">+  &quot;integer&quot; INTEGER DEFAULT NULL UNIQUE,
</a><a href="#h22-0-8" id="h22-0-8" class="i">+  &quot;string&quot; STRING DEFAULT NULL UNIQUE
</a><a href="#h22-0-9" id="h22-0-9" class="i">+)
</a><a href="#h22-0-10" id="h22-0-10" class="i">+[Integer(0), Null, Null, Null, Null]
</a><a href="#h22-0-11" id="h22-0-11" class="i">+[Integer(1), Null, Null, Null, Null]
</a></pre>
</div>
</body>
</html>
