<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>README.md: various updates - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/28b86416a05c0aed3a16bf6c90e4935284144b8e.html">28b86416a05c0aed3a16bf6c90e4935284144b8e</a>
<b>parent</b> <a href="../commit/4a5239485fc59a2dc43f9f1416386c231dd5e48b.html">4a5239485fc59a2dc43f9f1416386c231dd5e48b</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Tue, 23 Jul 2024 05:41:25 +0200

README.md: various updates

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README.md</a></td><td> | </td><td class="num">109</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/storage/engine.rs</a></td><td> | </td><td class="num">9</td><td><span class="i">++++++</span><span class="d">---</span></td></tr>
</table></pre><pre>2 files changed, 65 insertions(+), 53 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -2,31 +2,45 @@
</a> 
 [![CI](https://github.com/erikgrinaker/toydb/actions/workflows/ci.yml/badge.svg)](https://github.com/erikgrinaker/toydb/actions/workflows/ci.yml)
 
<a href="#h0-0-3" id="h0-0-3" class="d">-Distributed SQL database in Rust, written as a learning project. Most components are built from
</a><a href="#h0-0-4" id="h0-0-4" class="d">-scratch, including:
</a><a href="#h0-0-5" id="h0-0-5" class="i">+Distributed SQL database in Rust, written as an educational project. Built from scratch, including:
</a> 
<a href="#h0-0-7" id="h0-0-7" class="d">-* Raft-based distributed consensus engine for linearizable state machine replication.
</a><a href="#h0-0-8" id="h0-0-8" class="i">+* [Raft distributed consensus engine][raft] for linearizable state machine replication.
</a> 
<a href="#h0-0-10" id="h0-0-10" class="d">-* ACID-compliant transaction engine with MVCC-based snapshot isolation.
</a><a href="#h0-0-11" id="h0-0-11" class="i">+* [ACID transaction engine][txn] with MVCC-based snapshot isolation.
</a> 
<a href="#h0-0-13" id="h0-0-13" class="d">-* Pluggable storage engine with BitCask and in-memory backends.
</a><a href="#h0-0-14" id="h0-0-14" class="i">+* [Pluggable storage engine][storage] with [BitCask][bitcask] and [in-memory][memory] backends.
</a> 
<a href="#h0-0-16" id="h0-0-16" class="d">-* Iterator-based query engine with heuristic optimization and time-travel support.
</a><a href="#h0-0-17" id="h0-0-17" class="i">+* [Iterator-based query engine][query] with [heuristic optimization][optimizer] and time-travel 
</a><a href="#h0-0-18" id="h0-0-18" class="i">+  support.
</a> 
<a href="#h0-0-20" id="h0-0-20" class="d">-* SQL interface including projections, filters, joins, aggregates, and transactions.
</a><a href="#h0-0-21" id="h0-0-21" class="i">+* [SQL interface][sql] including joins, aggregates, and transactions.
</a> 
<a href="#h0-0-23" id="h0-0-23" class="d">-toyDB is not suitable for real-world use, but may be of interest to others learning about
</a><a href="#h0-0-24" id="h0-0-24" class="d">-database internals.
</a><a href="#h0-0-25" id="h0-0-25" class="i">+toyDB is intended to illustrate the overall architecture and concepts of distributed SQL databases.
</a><a href="#h0-0-26" id="h0-0-26" class="i">+It should be functional and correct, but focuses on simplicity and understandability. In particular,
</a><a href="#h0-0-27" id="h0-0-27" class="i">+performance, scalability, and availability are explicit non-goals -- these are major sources of
</a><a href="#h0-0-28" id="h0-0-28" class="i">+complexity in production-grade databases, which obscur the basic underlying concepts. Shortcuts have
</a><a href="#h0-0-29" id="h0-0-29" class="i">+been taken wherever possible.
</a><a href="#h0-0-30" id="h0-0-30" class="i">+
</a><a href="#h0-0-31" id="h0-0-31" class="i">+toyDB is not suitable for real-world use.
</a><a href="#h0-0-32" id="h0-0-32" class="i">+
</a><a href="#h0-0-33" id="h0-0-33" class="i">+[raft]: https://github.com/erikgrinaker/toydb/blob/master/src/raft/mod.rs
</a><a href="#h0-0-34" id="h0-0-34" class="i">+[txn]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/mvcc.rs
</a><a href="#h0-0-35" id="h0-0-35" class="i">+[storage]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/engine.rs
</a><a href="#h0-0-36" id="h0-0-36" class="i">+[bitcask]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/bitcask.rs
</a><a href="#h0-0-37" id="h0-0-37" class="i">+[memory]: https://github.com/erikgrinaker/toydb/blob/master/src/storage/memory.rs
</a><a href="#h0-0-38" id="h0-0-38" class="i">+[query]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/planner/plan.rs
</a><a href="#h0-0-39" id="h0-0-39" class="i">+[optimizer]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/planner/optimizer.rs
</a><a href="#h0-0-40" id="h0-0-40" class="i">+[sql]: https://github.com/erikgrinaker/toydb/blob/master/src/sql/mod.rs
</a> 
 ## Documentation
 
<a href="#h0-0-44" id="h0-0-44" class="d">-* [Architecture guide](docs/architecture.md): a guide to toyDB&#39;s architecture and implementation.
</a><a href="#h0-0-45" id="h0-0-45" class="i">+* [Architecture guide](docs/architecture.md): overview of toyDB&#39;s architecture and implementation.
</a> 
<a href="#h0-0-47" id="h0-0-47" class="d">-* [SQL examples](docs/examples.md): comprehensive examples of toyDB&#39;s SQL features.
</a><a href="#h0-0-48" id="h0-0-48" class="i">+* [SQL examples](docs/examples.md): walkthrough of toyDB&#39;s SQL features.
</a> 
<a href="#h0-0-50" id="h0-0-50" class="d">-* [SQL reference](docs/sql.md): detailed reference documentation for toyDB&#39;s SQL dialect.
</a><a href="#h0-0-51" id="h0-0-51" class="i">+* [SQL reference](docs/sql.md): toyDB SQL reference documentation.
</a> 
<a href="#h0-0-53" id="h0-0-53" class="d">-* [References](docs/references.md): books and other research material used while building toyDB.
</a><a href="#h0-0-54" id="h0-0-54" class="i">+* [References](docs/references.md): books and other material used while building toyDB.
</a> 
 ## Usage
 
<a href="#h0-1" id="h0-1" class="h">@@ -41,13 +55,13 @@ A command-line client can be built and used with node 5 on `localhost:9605`:
</a> 
 ```
 $ cargo run --release --bin toysql
<a href="#h0-1-3" id="h0-1-3" class="d">-Connected to toyDB node &quot;toydb-e&quot;. Enter !help for instructions.
</a><a href="#h0-1-4" id="h0-1-4" class="i">+Connected to toyDB node n5. Enter !help for instructions.
</a> toydb&gt; CREATE TABLE movies (id INTEGER PRIMARY KEY, title VARCHAR NOT NULL);
 toydb&gt; INSERT INTO movies VALUES (1, &#39;Sicario&#39;), (2, &#39;Stalker&#39;), (3, &#39;Her&#39;);
 toydb&gt; SELECT * FROM movies;
<a href="#h0-1-8" id="h0-1-8" class="d">-1|Sicario
</a><a href="#h0-1-9" id="h0-1-9" class="d">-2|Stalker
</a><a href="#h0-1-10" id="h0-1-10" class="d">-3|Her
</a><a href="#h0-1-11" id="h0-1-11" class="i">+1, &#39;Sicario&#39;
</a><a href="#h0-1-12" id="h0-1-12" class="i">+2, &#39;Stalker&#39;
</a><a href="#h0-1-13" id="h0-1-13" class="i">+3, &#39;Her&#39;
</a> ```
 
 toyDB supports most common SQL features, including joins, aggregates, and ACID transactions.
<a href="#h0-2" id="h0-2" class="h">@@ -56,27 +70,28 @@ toyDB supports most common SQL features, including joins, aggregates, and ACID t
</a> 
 [![toyDB architecture](./docs/images/architecture.svg)](./docs/architecture.md)
 
<a href="#h0-2-3" id="h0-2-3" class="d">-toyDB&#39;s architecture is fairly typical for distributed SQL databases: a transactional
</a><a href="#h0-2-4" id="h0-2-4" class="i">+toyDB&#39;s architecture is fairly typical for a distributed SQL database: a transactional
</a> key/value store managed by a Raft cluster with a SQL query engine on top. See the
 [architecture guide](./docs/architecture.md) for more details.
 
 ## Tests
 
<a href="#h0-2-10" id="h0-2-10" class="d">-toyDB has decent test coverage, with about a thousand tests of core functionality. These consist
</a><a href="#h0-2-11" id="h0-2-11" class="d">-of in-code unit-tests for many low-level components, golden master integration tests of the SQL
</a><a href="#h0-2-12" id="h0-2-12" class="d">-engine under [`tests/sql`](https://github.com/erikgrinaker/toydb/tree/master/tests/sql), and a
</a><a href="#h0-2-13" id="h0-2-13" class="d">-basic set of end-to-end cluster tests under
</a><a href="#h0-2-14" id="h0-2-14" class="d">-[`tests/`](https://github.com/erikgrinaker/toydb/tree/master/tests).
</a><a href="#h0-2-15" id="h0-2-15" class="d">-[Jepsen tests](https://jepsen.io), or similar system-wide correctness and reliability tests, are 
</a><a href="#h0-2-16" id="h0-2-16" class="d">-desirable but not yet implemented.
</a><a href="#h0-2-17" id="h0-2-17" class="i">+toyDB mostly uses [Goldenscripts](https://github.com/erikgrinaker/goldenscript) for tests. These 
</a><a href="#h0-2-18" id="h0-2-18" class="i">+are used to script various scenarios, capture events and output, and later assert that the
</a><a href="#h0-2-19" id="h0-2-19" class="i">+behavior remains the same. See e.g.:
</a><a href="#h0-2-20" id="h0-2-20" class="i">+
</a><a href="#h0-2-21" id="h0-2-21" class="i">+* [Raft cluster tests](https://github.com/erikgrinaker/toydb/tree/master/src/raft/testscripts/node)
</a><a href="#h0-2-22" id="h0-2-22" class="i">+* [MVCC transaction tests](https://github.com/erikgrinaker/toydb/tree/master/src/storage/testscripts/mvcc)
</a><a href="#h0-2-23" id="h0-2-23" class="i">+* [SQL execution tests](https://github.com/erikgrinaker/toydb/tree/master/src/sql/testscripts)
</a><a href="#h0-2-24" id="h0-2-24" class="i">+* [End-to-end tests](https://github.com/erikgrinaker/toydb/tree/master/tests/scripts)
</a> 
<a href="#h0-2-26" id="h0-2-26" class="d">-Execute `cargo test` to run all tests, or check out the latest
</a><a href="#h0-2-27" id="h0-2-27" class="i">+Run tests with `cargo test`, or have a look at the latest 
</a> [CI run](https://github.com/erikgrinaker/toydb/actions/workflows/ci.yml).
 
 ## Benchmarks
 
<a href="#h0-2-32" id="h0-2-32" class="d">-toyDB is not optimized for performance, but it comes with a `workload` benchmarking tool that can
</a><a href="#h0-2-33" id="h0-2-33" class="d">-run various workloads against a toyDB cluster. For example:
</a><a href="#h0-2-34" id="h0-2-34" class="i">+toyDB is not optimized for performance, but comes with a `workload` benchmark tool that can run 
</a><a href="#h0-2-35" id="h0-2-35" class="i">+various workloads against a toyDB cluster. For example:
</a> 
 ```sh
 # Start a 5-node toyDB cluster.
<a href="#h0-3" id="h0-3" class="h">@@ -85,27 +100,21 @@ $ ./cluster/run.sh
</a> 
 # Run a read-only benchmark via all 5 nodes.
 $ cargo run --release --bin workload read
<a href="#h0-3-3" id="h0-3-3" class="d">-Preparing initial dataset... done (0.096s)
</a><a href="#h0-3-4" id="h0-3-4" class="d">-Spawning 16 workers... done (0.003s)
</a><a href="#h0-3-5" id="h0-3-5" class="i">+Preparing initial dataset... done (0.179s)
</a><a href="#h0-3-6" id="h0-3-6" class="i">+Spawning 16 workers... done (0.006s)
</a> Running workload read (rows=1000 size=64 batch=1)...
 
 Time   Progress     Txns      Rate       p50       p90       p99      pMax
<a href="#h0-3-10" id="h0-3-10" class="d">-1.0s       7.2%     7186    7181/s     2.3ms     3.1ms     4.0ms     9.6ms
</a><a href="#h0-3-11" id="h0-3-11" class="d">-2.0s      14.4%    14416    7205/s     2.3ms     3.1ms     4.2ms     9.6ms
</a><a href="#h0-3-12" id="h0-3-12" class="d">-3.0s      22.5%    22518    7504/s     2.2ms     2.9ms     4.0ms     9.6ms
</a><a href="#h0-3-13" id="h0-3-13" class="d">-4.0s      30.3%    30303    7574/s     2.2ms     2.9ms     3.8ms     9.6ms
</a><a href="#h0-3-14" id="h0-3-14" class="d">-5.0s      38.2%    38200    7639/s     2.2ms     2.8ms     3.7ms     9.6ms
</a><a href="#h0-3-15" id="h0-3-15" class="d">-6.0s      46.0%    45961    7659/s     2.2ms     2.8ms     3.7ms     9.6ms
</a><a href="#h0-3-16" id="h0-3-16" class="d">-7.0s      53.3%    53343    7620/s     2.2ms     2.8ms     3.7ms     9.6ms
</a><a href="#h0-3-17" id="h0-3-17" class="d">-8.0s      61.2%    61220    7651/s     2.2ms     2.8ms     3.6ms     9.6ms
</a><a href="#h0-3-18" id="h0-3-18" class="d">-9.0s      68.2%    68194    7576/s     2.2ms     2.8ms     3.7ms     9.6ms
</a><a href="#h0-3-19" id="h0-3-19" class="d">-10.0s     75.8%    75800    7579/s     2.2ms     2.8ms     3.7ms     9.6ms
</a><a href="#h0-3-20" id="h0-3-20" class="d">-11.0s     82.9%    82864    7533/s     2.2ms     2.9ms     3.7ms    18.2ms
</a><a href="#h0-3-21" id="h0-3-21" class="d">-12.0s     90.6%    90583    7548/s     2.2ms     2.9ms     3.7ms    18.2ms
</a><a href="#h0-3-22" id="h0-3-22" class="d">-13.0s     98.3%    98311    7562/s     2.2ms     2.9ms     3.7ms    18.2ms
</a><a href="#h0-3-23" id="h0-3-23" class="d">-13.2s    100.0%   100000    7569/s     2.2ms     2.9ms     3.7ms    18.2ms
</a><a href="#h0-3-24" id="h0-3-24" class="d">-
</a><a href="#h0-3-25" id="h0-3-25" class="d">-Verifying dataset... done (0.001s)
</a><a href="#h0-3-26" id="h0-3-26" class="i">+1.0s      13.1%    13085   13020/s     1.3ms     1.5ms     1.9ms     8.4ms
</a><a href="#h0-3-27" id="h0-3-27" class="i">+2.0s      27.2%    27183   13524/s     1.3ms     1.5ms     1.8ms     8.4ms
</a><a href="#h0-3-28" id="h0-3-28" class="i">+3.0s      41.3%    41301   13702/s     1.2ms     1.5ms     1.8ms     8.4ms
</a><a href="#h0-3-29" id="h0-3-29" class="i">+4.0s      55.3%    55340   13769/s     1.2ms     1.5ms     1.8ms     8.4ms
</a><a href="#h0-3-30" id="h0-3-30" class="i">+5.0s      70.0%    70015   13936/s     1.2ms     1.5ms     1.8ms     8.4ms
</a><a href="#h0-3-31" id="h0-3-31" class="i">+6.0s      84.7%    84663   14047/s     1.2ms     1.4ms     1.8ms     8.4ms
</a><a href="#h0-3-32" id="h0-3-32" class="i">+7.0s      99.6%    99571   14166/s     1.2ms     1.4ms     1.7ms     8.4ms
</a><a href="#h0-3-33" id="h0-3-33" class="i">+7.1s     100.0%   100000   14163/s     1.2ms     1.4ms     1.7ms     8.4ms
</a><a href="#h0-3-34" id="h0-3-34" class="i">+
</a><a href="#h0-3-35" id="h0-3-35" class="i">+Verifying dataset... done (0.002s)
</a> ```
 
 The available workloads are:
<a href="#h0-4" id="h0-4" class="h">@@ -121,20 +130,20 @@ Example workload results:
</a> 
 ```
 Workload   Time       Txns      Rate       p50       p90       p99      pMax
<a href="#h0-4-3" id="h0-4-3" class="d">-read       13.2s    100000    7569/s     2.2ms     2.9ms     3.7ms    18.2ms
</a><a href="#h0-4-4" id="h0-4-4" class="i">+read       7.1s     100000   14163/s     1.2ms     1.4ms     1.7ms     8.4ms
</a> write      22.2s    100000    4502/s     3.9ms     4.5ms     4.9ms    15.7ms
 bank       155.0s   100000     645/s    16.9ms    41.7ms    95.0ms  1044.4ms
 ```
 
 ## Debugging
 
<a href="#h0-4-11" id="h0-4-11" class="d">-[VSCode](https://code.visualstudio.com) provides a very intuitive environment for debugging toyDB.
</a><a href="#h0-4-12" id="h0-4-12" class="d">-The debug configuration is included under `.vscode/launch.json`. Follow these steps to set it up:
</a><a href="#h0-4-13" id="h0-4-13" class="i">+[VSCode](https://code.visualstudio.com) provides an intuitive environment for debugging toyDB.
</a><a href="#h0-4-14" id="h0-4-14" class="i">+The debug configuration is included under `.vscode/launch.json`, to use it:
</a> 
 1. Install the [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb)
    extension.
 
<a href="#h0-4-19" id="h0-4-19" class="d">-2. Go to &quot;Run and Debug&quot; tab and select e.g. &quot;Debug unit tests in library &#39;toydb&#39;&quot;.
</a><a href="#h0-4-20" id="h0-4-20" class="i">+2. Go to the &quot;Run and Debug&quot; tab and select e.g. &quot;Debug unit tests in library &#39;toydb&#39;&quot;.
</a> 
 3. To debug the binary, select &quot;Debug executable &#39;toydb&#39;&quot; under &quot;Run and Debug&quot;.
 
<b>diff --git a/<a id="h1" href="../file/src/storage/engine.rs.html">src/storage/engine.rs</a> b/<a href="../file/src/storage/engine.rs.html">src/storage/engine.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -3,9 +3,12 @@ use crate::error::Result;
</a> 
 use serde::{Deserialize, Serialize};
 
<a href="#h1-0-3" id="h1-0-3" class="d">-/// A key/value storage engine, where both keys and values are arbitrary byte
</a><a href="#h1-0-4" id="h1-0-4" class="d">-/// strings between 0 B and 2 GB, stored in lexicographical key order. Writes
</a><a href="#h1-0-5" id="h1-0-5" class="d">-/// are only guaranteed durable after calling flush().
</a><a href="#h1-0-6" id="h1-0-6" class="i">+/// A key/value storage engine storing arbitrary byte strings in lexicographical
</a><a href="#h1-0-7" id="h1-0-7" class="i">+/// key order. Storing keys in order allows for efficient range scans, which is
</a><a href="#h1-0-8" id="h1-0-8" class="i">+/// needed to e.g. scan a single table during SQL execution (where all rows have
</a><a href="#h1-0-9" id="h1-0-9" class="i">+/// keys with a common key prefix for the table). Keys should use the KeyCode
</a><a href="#h1-0-10" id="h1-0-10" class="i">+/// order-preserving encoding, see src/encoding/keycode. Writes are only
</a><a href="#h1-0-11" id="h1-0-11" class="i">+/// guaranteed durable after calling flush().
</a> ///
 /// Only supports single-threaded use since all methods (including reads) take a
 /// mutable reference -- serialized access can&#39;t be avoided anyway, since both
</pre>
</div>
</body>
</html>
