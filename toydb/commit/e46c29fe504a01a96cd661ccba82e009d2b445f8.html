<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: added constants for float64 infinity and NaN, and docs for constants - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/e46c29fe504a01a96cd661ccba82e009d2b445f8.html">e46c29fe504a01a96cd661ccba82e009d2b445f8</a>
<b>parent</b> <a href="../commit/ebff07fbdc68067d95c10c1908964af1cad9e47d.html">ebff07fbdc68067d95c10c1908964af1cad9e47d</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Mon, 30 Dec 2019 19:23:44 +0100

sql: added constants for float64 infinity and NaN, and docs for constants

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">docs/README.md</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">src/sql/parser/lexer.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">src/sql/parser/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/sql/tests/expression.rs</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++++++++++++</span><span class="d">------</span></td></tr>
</table></pre><pre>4 files changed, 37 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/docs/README.md.html">docs/README.md</a> b/<a href="../file/docs/README.md.html">docs/README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -22,3 +22,15 @@ Keywords are reserved words that have special meaning in SQL statements, such as
</a> ### Identifiers
 
 Identifiers are names for database objects, such as tables and columns. Identifiers must begin with any Unicode letter, and can contain any combination of Unicode letters, numbers, and underscores (`_`). Identifiers are automatically converted to lowercase, and have no length limit. Reserved keywords (see above) cannot be used as identifiers, and it is not possible to quote or escape identifiers.
<a href="#h0-0-3" id="h0-0-3" class="i">+
</a><a href="#h0-0-4" id="h0-0-4" class="i">+### Constants
</a><a href="#h0-0-5" id="h0-0-5" class="i">+
</a><a href="#h0-0-6" id="h0-0-6" class="i">+#### Named constants
</a><a href="#h0-0-7" id="h0-0-7" class="i">+
</a><a href="#h0-0-8" id="h0-0-8" class="i">+The following case-insensitive keywords evaluate to constants:
</a><a href="#h0-0-9" id="h0-0-9" class="i">+
</a><a href="#h0-0-10" id="h0-0-10" class="i">+* `FALSE`: the `BOOLEAN` false value.
</a><a href="#h0-0-11" id="h0-0-11" class="i">+* `INFINITY`: the IEEE 754 `binary64` floating-point value for infinity.
</a><a href="#h0-0-12" id="h0-0-12" class="i">+* `NAN`: the IEEE 754 `binary64` floating-point value for NaN (not a number).
</a><a href="#h0-0-13" id="h0-0-13" class="i">+* `NULL`: the unknown value.
</a><a href="#h0-0-14" id="h0-0-14" class="i">+* `TRUE`: the `BOOLEAN` true value.
</a><b>diff --git a/<a id="h1" href="../file/src/sql/parser/lexer.rs.html">src/sql/parser/lexer.rs</a> b/<a href="../file/src/sql/parser/lexer.rs.html">src/sql/parser/lexer.rs</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -86,12 +86,14 @@ pub enum Keyword {
</a>     False,
     Float,
     From,
<a href="#h1-0-3" id="h1-0-3" class="i">+    Infinity,
</a>     Insert,
     Int,
     Integer,
     Into,
     Key,
     Limit,
<a href="#h1-0-10" id="h1-0-10" class="i">+    NaN,
</a>     Not,
     Null,
     Of,
<a href="#h1-1" id="h1-1" class="h">@@ -138,12 +140,14 @@ impl Keyword {
</a>             &quot;FALSE&quot; =&gt; Self::False,
             &quot;FLOAT&quot; =&gt; Self::Float,
             &quot;FROM&quot; =&gt; Self::From,
<a href="#h1-1-3" id="h1-1-3" class="i">+            &quot;INFINITY&quot; =&gt; Self::Infinity,
</a>             &quot;INSERT&quot; =&gt; Self::Insert,
             &quot;INT&quot; =&gt; Self::Int,
             &quot;INTEGER&quot; =&gt; Self::Integer,
             &quot;INTO&quot; =&gt; Self::Into,
             &quot;KEY&quot; =&gt; Self::Key,
             &quot;LIMIT&quot; =&gt; Self::Limit,
<a href="#h1-1-10" id="h1-1-10" class="i">+            &quot;NAN&quot; =&gt; Self::NaN,
</a>             &quot;NOT&quot; =&gt; Self::Not,
             &quot;NULL&quot; =&gt; Self::Null,
             &quot;OF&quot; =&gt; Self::Of,
<a href="#h1-2" id="h1-2" class="h">@@ -191,12 +195,14 @@ impl Keyword {
</a>             Self::False =&gt; &quot;FALSE&quot;,
             Self::Float =&gt; &quot;FLOAT&quot;,
             Self::From =&gt; &quot;FROM&quot;,
<a href="#h1-2-3" id="h1-2-3" class="i">+            Self::Infinity =&gt; &quot;INFINITY&quot;,
</a>             Self::Insert =&gt; &quot;INSERT&quot;,
             Self::Int =&gt; &quot;INT&quot;,
             Self::Integer =&gt; &quot;INTEGER&quot;,
             Self::Into =&gt; &quot;INTO&quot;,
             Self::Key =&gt; &quot;KEY&quot;,
             Self::Limit =&gt; &quot;LIMIT&quot;,
<a href="#h1-2-10" id="h1-2-10" class="i">+            Self::NaN =&gt; &quot;NAN&quot;,
</a>             Self::Not =&gt; &quot;NOT&quot;,
             Self::Null =&gt; &quot;NULL&quot;,
             Self::Of =&gt; &quot;OF&quot;,
<b>diff --git a/<a id="h2" href="../file/src/sql/parser/mod.rs.html">src/sql/parser/mod.rs</a> b/<a href="../file/src/sql/parser/mod.rs.html">src/sql/parser/mod.rs</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -429,6 +429,8 @@ impl&lt;&#39;a&gt; Parser&lt;&#39;a&gt; {
</a>             }
             Token::String(s) =&gt; ast::Literal::String(s).into(),
             Token::Keyword(Keyword::False) =&gt; ast::Literal::Boolean(false).into(),
<a href="#h2-0-3" id="h2-0-3" class="i">+            Token::Keyword(Keyword::Infinity) =&gt; ast::Literal::Float(std::f64::INFINITY).into(),
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            Token::Keyword(Keyword::NaN) =&gt; ast::Literal::Float(std::f64::NAN).into(),
</a>             Token::Keyword(Keyword::Null) =&gt; ast::Literal::Null.into(),
             Token::Keyword(Keyword::True) =&gt; ast::Literal::Boolean(true).into(),
             t =&gt; return Err(Error::Parse(format!(&quot;Expected expression atom, found {}&quot;, t))),
<b>diff --git a/<a id="h3" href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a> b/<a href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -16,12 +16,19 @@ fn eval_expr(expr: &amp;str) -&gt; Result&lt;Value, Error&gt; {
</a> }
 
 macro_rules! test_expr {
<a href="#h3-0-3" id="h3-0-3" class="d">-    ( $( $name:ident: $expr:expr =&gt; $result:expr, )* ) =&gt; {
</a><a href="#h3-0-4" id="h3-0-4" class="i">+    ( $( $name:ident: $expr:expr =&gt; $expect:expr, )* ) =&gt; {
</a>     $(
         #[test]
         fn $name() -&gt; Result&lt;(), Error&gt; {
<a href="#h3-0-8" id="h3-0-8" class="d">-            let value = eval_expr($expr);
</a><a href="#h3-0-9" id="h3-0-9" class="d">-            assert_eq!($result, value);
</a><a href="#h3-0-10" id="h3-0-10" class="i">+            let expect: Result&lt;Value, Error&gt; = $expect;
</a><a href="#h3-0-11" id="h3-0-11" class="i">+            let actual = eval_expr($expr);
</a><a href="#h3-0-12" id="h3-0-12" class="i">+            match expect {
</a><a href="#h3-0-13" id="h3-0-13" class="i">+                Ok(Float(e)) if e.is_nan() =&gt; match actual {
</a><a href="#h3-0-14" id="h3-0-14" class="i">+                    Ok(Float(a)) if a.is_nan() =&gt; {},
</a><a href="#h3-0-15" id="h3-0-15" class="i">+                    _ =&gt; panic!(&quot;Expected NaN, got {:?}&quot;, actual),
</a><a href="#h3-0-16" id="h3-0-16" class="i">+                }
</a><a href="#h3-0-17" id="h3-0-17" class="i">+                _ =&gt; assert_eq!($expect, actual),
</a><a href="#h3-0-18" id="h3-0-18" class="i">+            }
</a>             Ok(())
         }
     )*
<a href="#h3-1" id="h3-1" class="h">@@ -31,8 +38,13 @@ macro_rules! test_expr {
</a> use Value::*;
 
 test_expr! {
<a href="#h3-1-3" id="h3-1-3" class="d">-    lit_bool_false: &quot;FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h3-1-4" id="h3-1-4" class="d">-    lit_bool_true: &quot;TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h3-1-5" id="h3-1-5" class="i">+    const_case: &quot;TrUe&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h3-1-6" id="h3-1-6" class="i">+    const_false: &quot;FALSE&quot; =&gt; Ok(Boolean(false)),
</a><a href="#h3-1-7" id="h3-1-7" class="i">+    const_infinity: &quot;INFINITY&quot; =&gt; Ok(Float(std::f64::INFINITY)),
</a><a href="#h3-1-8" id="h3-1-8" class="i">+    const_nan: &quot;NAN&quot; =&gt; Ok(Float(std::f64::NAN)),
</a><a href="#h3-1-9" id="h3-1-9" class="i">+    const_null: &quot;NULL&quot; =&gt; Ok(Null),
</a><a href="#h3-1-10" id="h3-1-10" class="i">+    const_true: &quot;TRUE&quot; =&gt; Ok(Boolean(true)),
</a><a href="#h3-1-11" id="h3-1-11" class="i">+
</a>     lit_float: &quot;3.72&quot; =&gt; Ok(Float(3.72)),
     lit_float_exp: &quot;3.14e3&quot; =&gt; Ok(Float(3140.0)),
     lit_float_exp_neg: &quot;2.718E-2&quot; =&gt; Ok(Float(0.02718)),
<a href="#h3-2" id="h3-2" class="h">@@ -40,7 +52,6 @@ test_expr! {
</a>     lit_int: &quot;3&quot; =&gt; Ok(Integer(3)),
     lit_int_multidigit: &quot;314&quot; =&gt; Ok(Integer(314)),
     lit_int_zeroprefix: &quot;03&quot; =&gt; Ok(Integer(3)),
<a href="#h3-2-3" id="h3-2-3" class="d">-    lit_null: &quot;NULL&quot; =&gt; Ok(Null),
</a>     lit_str: &quot;&#39;Hi! 👋&#39;&quot; =&gt; Ok(String(&quot;Hi! 👋&quot;.into())),
     lit_str_quotes: r#&quot;&#39;Has &#39;&#39;single&#39;&#39; and &quot;double&quot; quotes&#39;&quot;# =&gt; Ok(String(r#&quot;Has &#39;single&#39; and &quot;double&quot; quotes&quot;#.into())),
 
</pre>
</div>
</body>
</html>
