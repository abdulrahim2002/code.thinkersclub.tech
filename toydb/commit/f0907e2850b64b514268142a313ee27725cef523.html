<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sql: refactored result handling - toydb - An SQL engine written in Rust
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="toydb.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>toydb</h1><span class="desc">An SQL engine written in Rust
</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://github.com/erikgrinaker/toydb">https://github.com/erikgrinaker/toydb</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.md.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/f0907e2850b64b514268142a313ee27725cef523.html">f0907e2850b64b514268142a313ee27725cef523</a>
<b>parent</b> <a href="../commit/46e969e9dc2825f02f9fa009ae3de9a56a285cff.html">46e969e9dc2825f02f9fa009ae3de9a56a285cff</a>
<b>Author:</b> Erik Grinaker &lt;<a href="mailto:erik@grinaker.org">erik@grinaker.org</a>&gt;
<b>Date:</b>   Fri, 10 Apr 2020 23:52:46 +0200

sql: refactored result handling

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">Cargo.lock</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">Cargo.toml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">protobuf/toydb.proto</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">src/bin/bank.rs</a></td><td> | </td><td class="num">24</td><td><span class="i">+++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">src/bin/toysql.rs</a></td><td> | </td><td class="num">63</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">---------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">src/client.rs</a></td><td> | </td><td class="num">88</td><td><span class="i">+++++++++++++++++++++++++++</span><span class="d">----------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">src/lib.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">src/server/toydb.rs</a></td><td> | </td><td class="num">93</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d">---------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">src/sql/engine/mod.rs</a></td><td> | </td><td class="num">22</td><td><span class="i">+++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">src/sql/executor/aggregation.rs</a></td><td> | </td><td class="num">86</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">src/sql/executor/create_table.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">src/sql/executor/delete.rs</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">src/sql/executor/drop_table.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">src/sql/executor/filter.rs</a></td><td> | </td><td class="num">38</td><td><span class="i">+++++++++++++++++++++</span><span class="d">-----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">src/sql/executor/insert.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">src/sql/executor/limit.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">src/sql/executor/mod.rs</a></td><td> | </td><td class="num">109</td><td><span class="i">++++++++++++++++++++++</span><span class="d">---------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">src/sql/executor/nested_loop_join.rs</a></td><td> | </td><td class="num">66</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">src/sql/executor/nothing.rs</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">src/sql/executor/offset.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">src/sql/executor/order.rs</a></td><td> | </td><td class="num">82</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">src/sql/executor/projection.rs</a></td><td> | </td><td class="num">77</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">src/sql/executor/scan.rs</a></td><td> | </td><td class="num">19</td><td><span class="i">++++++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">src/sql/executor/update.rs</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">src/sql/mod.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">src/sql/tests/dml.rs</a></td><td> | </td><td class="num">6</td><td><span class="i">+</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">src/sql/tests/dml/delete_all</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">src/sql/tests/dml/delete_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">src/sql/tests/dml/delete_where</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">src/sql/tests/dml/delete_where_and</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">src/sql/tests/dml/delete_where_expr</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">src/sql/tests/dml/delete_where_false</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">src/sql/tests/dml/delete_where_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">src/sql/tests/dml/delete_where_true</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">src/sql/tests/dml/insert_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">src/sql/tests/dml/insert_expression</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">src/sql/tests/dml/insert_full</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">src/sql/tests/dml/insert_full_multiple</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">src/sql/tests/dml/insert_full_order</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">src/sql/tests/dml/insert_no_columns</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">src/sql/tests/dml/insert_no_columns_multiple</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">src/sql/tests/dml/insert_partial</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">src/sql/tests/dml/insert_partial_vary</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">src/sql/tests/dml/update_all</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">src/sql/tests/dml/update_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">src/sql/tests/dml/update_where</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">src/sql/tests/dml/update_where_and</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">src/sql/tests/dml/update_where_expr</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">src/sql/tests/dml/update_where_false</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h49">src/sql/tests/dml/update_where_full</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h50">src/sql/tests/dml/update_where_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h51">src/sql/tests/dml/update_where_true</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h52">src/sql/tests/expression.rs</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h53">src/sql/tests/query.rs</a></td><td> | </td><td class="num">42</td><td><span class="i">++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h54">src/sql/tests/schema.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">+</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h55">src/sql/tests/schema/create_table_datatype</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h56">src/sql/tests/schema/create_table_default_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h57">src/sql/tests/schema/create_table_default_expr</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h58">src/sql/tests/schema/create_table_default_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h59">src/sql/tests/schema/create_table_default_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h60">src/sql/tests/schema/create_table_default_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h61">src/sql/tests/schema/create_table_default_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h62">src/sql/tests/schema/create_table_name_alphanumeric</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h63">src/sql/tests/schema/create_table_name_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h64">src/sql/tests/schema/create_table_name_emoji_quoted</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h65">src/sql/tests/schema/create_table_name_japanese</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h66">src/sql/tests/schema/create_table_name_keyword_quoted</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h67">src/sql/tests/schema/create_table_name_quote_double</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h68">src/sql/tests/schema/create_table_name_quote_double_escaped</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h69">src/sql/tests/schema/create_table_name_quote_double_single</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h70">src/sql/tests/schema/create_table_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h71">src/sql/tests/schema/create_table_null_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h72">src/sql/tests/schema/create_table_null_not</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h73">src/sql/tests/schema/create_table_pk_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h74">src/sql/tests/schema/create_table_pk_unique</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h75">src/sql/tests/schema/create_table_ref</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h76">src/sql/tests/schema/create_table_ref_multiple</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h77">src/sql/tests/schema/create_table_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h78">src/sql/tests/schema/create_table_unique</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h79">src/sql/tests/schema/create_table_unique_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h80">src/sql/tests/schema/create_table_unique_not_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h81">src/sql/tests/schema/create_table_unique_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h82">src/sql/tests/schema/delete_ref_noref</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h83">src/sql/tests/schema/delete_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h84">src/sql/tests/schema/delete_ref_source</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h85">src/sql/tests/schema/drop_table</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h86">src/sql/tests/schema/drop_table_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h87">src/sql/tests/schema/drop_table_ref_source</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h88">src/sql/tests/schema/insert_boolean_false</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h89">src/sql/tests/schema/insert_boolean_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h90">src/sql/tests/schema/insert_boolean_true</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h91">src/sql/tests/schema/insert_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h92">src/sql/tests/schema/insert_default_override</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h93">src/sql/tests/schema/insert_default_override_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h94">src/sql/tests/schema/insert_default_unnamed</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h95">src/sql/tests/schema/insert_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h96">src/sql/tests/schema/insert_float_infinity</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h97">src/sql/tests/schema/insert_float_infinity_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h98">src/sql/tests/schema/insert_float_max</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h99">src/sql/tests/schema/insert_float_max_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h100">src/sql/tests/schema/insert_float_min</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h101">src/sql/tests/schema/insert_float_min_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h102">src/sql/tests/schema/insert_float_min_round</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h103">src/sql/tests/schema/insert_float_nan</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h104">src/sql/tests/schema/insert_float_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h105">src/sql/tests/schema/insert_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h106">src/sql/tests/schema/insert_integer_max</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h107">src/sql/tests/schema/insert_integer_min</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h108">src/sql/tests/schema/insert_integer_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h109">src/sql/tests/schema/insert_nulls</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h110">src/sql/tests/schema/insert_nulls_default</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h111">src/sql/tests/schema/insert_pk_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h112">src/sql/tests/schema/insert_pk_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h113">src/sql/tests/schema/insert_pk_float_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h114">src/sql/tests/schema/insert_pk_float_zero</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h115">src/sql/tests/schema/insert_pk_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h116">src/sql/tests/schema/insert_pk_integer_negative</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h117">src/sql/tests/schema/insert_pk_integer_zero</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h118">src/sql/tests/schema/insert_pk_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h119">src/sql/tests/schema/insert_pk_string_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h120">src/sql/tests/schema/insert_pk_string_empty</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h121">src/sql/tests/schema/insert_ref_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h122">src/sql/tests/schema/insert_ref_boolean_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h123">src/sql/tests/schema/insert_ref_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h124">src/sql/tests/schema/insert_ref_float_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h125">src/sql/tests/schema/insert_ref_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h126">src/sql/tests/schema/insert_ref_integer_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h127">src/sql/tests/schema/insert_ref_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h128">src/sql/tests/schema/insert_ref_self_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h129">src/sql/tests/schema/insert_ref_self_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h130">src/sql/tests/schema/insert_ref_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h131">src/sql/tests/schema/insert_ref_string_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h132">src/sql/tests/schema/insert_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h133">src/sql/tests/schema/insert_string_1024</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h134">src/sql/tests/schema/insert_string_1024_unicode</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h135">src/sql/tests/schema/insert_string_empty</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h136">src/sql/tests/schema/insert_string_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h137">src/sql/tests/schema/insert_string_unicode</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h138">src/sql/tests/schema/insert_unique_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h139">src/sql/tests/schema/insert_unique_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h140">src/sql/tests/schema/insert_unique_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h141">src/sql/tests/schema/insert_unique_nulls</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h142">src/sql/tests/schema/insert_unique_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h143">src/sql/tests/schema/insert_unique_string_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h144">src/sql/tests/schema/update_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h145">src/sql/tests/schema/update_integer_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h146">src/sql/tests/schema/update_pk_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h147">src/sql/tests/schema/update_pk_float</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h148">src/sql/tests/schema/update_pk_integer</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h149">src/sql/tests/schema/update_pk_string</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h150">src/sql/tests/schema/update_pk_string_case</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h151">src/sql/tests/schema/update_ref_pk_noref</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h152">src/sql/tests/schema/update_ref_self_pk_noref</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h153">src/sql/tests/schema/update_ref_self_self</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h154">src/sql/tests/schema/update_ref_self_value</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h155">src/sql/tests/schema/update_ref_source</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h156">src/sql/tests/schema/update_ref_source_null</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h157">src/sql/tests/schema/update_ref_value</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h158">src/sql/tests/schema/update_unique_boolean</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h159">src/sql/tests/schema/update_unique_boolean_same</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h160">src/sql/tests/schema/update_unique_nulls</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h161">src/sql/types/datatype.rs</a></td><td> | </td><td class="num">45</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h162">src/sql/types/mod.rs</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>163 files changed, 638 insertions(+), 644 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Cargo.lock.html">Cargo.lock</a> b/<a href="../file/Cargo.lock.html">Cargo.lock</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -226,6 +226,16 @@ dependencies = [
</a> ]
 
 [[package]]
<a href="#h0-0-3" id="h0-0-3" class="i">+name = &quot;derivative&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+version = &quot;2.1.0&quot;
</a><a href="#h0-0-5" id="h0-0-5" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h0-0-6" id="h0-0-6" class="i">+dependencies = [
</a><a href="#h0-0-7" id="h0-0-7" class="i">+ &quot;proc-macro2 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-8" id="h0-0-8" class="i">+ &quot;quote 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-9" id="h0-0-9" class="i">+ &quot;syn 1.0.17 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a><a href="#h0-0-10" id="h0-0-10" class="i">+]
</a><a href="#h0-0-11" id="h0-0-11" class="i">+
</a><a href="#h0-0-12" id="h0-0-12" class="i">+[[package]]
</a> name = &quot;difference&quot;
 version = &quot;2.0.0&quot;
 source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
<a href="#h0-1" id="h0-1" class="h">@@ -1343,6 +1353,7 @@ dependencies = [
</a>  &quot;clap 2.33.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;config 0.9.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;crossbeam 0.7.3 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-1-3" id="h0-1-3" class="i">+ &quot;derivative 2.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
</a>  &quot;goldenfile 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;grpc 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
  &quot;httpbis 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
<a href="#h0-2" id="h0-2" class="h">@@ -1497,6 +1508,7 @@ dependencies = [
</a> &quot;checksum crossbeam-queue 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c695eeca1e7173472a32221542ae469b3e9aac3a4fc81f7696bcad82029493db&quot;
 &quot;checksum crossbeam-utils 0.7.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;c3c7c73a2d1e9fc0886a08b93e98eb643461230d5f1925e4036204d5f2e261a8&quot;
 &quot;checksum ctor 0.1.13 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;47c5e5ac752e18207b12e16b10631ae5f7f68f8805f335f9b817ead83d9ffce1&quot;
<a href="#h0-2-3" id="h0-2-3" class="i">+&quot;checksum derivative 2.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;1eae4d76b7cefedd1b4f8cc24378b2fbd1ac1b66e3bbebe8e2192d3be81cb355&quot;
</a> &quot;checksum difference 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;524cbf6897b527295dff137cec09ecf3a05f4fddffd7dfcd1585403449e74198&quot;
 &quot;checksum dirs 2.0.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;13aea89a5c93364a98e9b37b2fa237effbb694d5cfe01c5b70941f7eb087d5e3&quot;
 &quot;checksum dirs-sys 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;afa0b23de8fd801745c471deffa6e12d248f962c9fd4b4c33787b055599bde7b&quot;
<b>diff --git a/<a id="h1" href="../file/Cargo.toml.html">Cargo.toml</a> b/<a href="../file/Cargo.toml.html">Cargo.toml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -10,6 +10,7 @@ default-run = &quot;toydb&quot;
</a> clap = &quot;~2.33.0&quot;
 config = &quot;~0.9.3&quot;
 crossbeam = &quot;~0.7.3&quot;
<a href="#h1-0-3" id="h1-0-3" class="i">+derivative = &quot;~2.1.0&quot;
</a> grpc = &quot;~0.6.1&quot;
 lazy_static = &quot;~1.4.0&quot;
 log = &quot;~0.4.6&quot;
<b>diff --git a/<a id="h2" href="../file/protobuf/toydb.proto.html">protobuf/toydb.proto</a> b/<a href="../file/protobuf/toydb.proto.html">protobuf/toydb.proto</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -4,35 +4,19 @@ syntax = &quot;proto3&quot;;
</a> // transitioning away from Protobuf and gRPC for client/server communication.
 service ToyDB {
   rpc Call(Request) returns (Result) {};
<a href="#h2-0-3" id="h2-0-3" class="d">-  rpc Query(QueryRequest) returns (stream Row) {};
</a><a href="#h2-0-4" id="h2-0-4" class="i">+  rpc Execute(Query) returns (stream Result) {};
</a> };
 
<a href="#h2-0-7" id="h2-0-7" class="d">-message Error { string message = 1; }
</a><a href="#h2-0-8" id="h2-0-8" class="d">-
</a> message Request {
   bytes body = 1;
 }
 
<a href="#h2-0-13" id="h2-0-13" class="i">+message Query {
</a><a href="#h2-0-14" id="h2-0-14" class="i">+  uint64 txn_id = 1;
</a><a href="#h2-0-15" id="h2-0-15" class="i">+  string query = 2;
</a><a href="#h2-0-16" id="h2-0-16" class="i">+};
</a><a href="#h2-0-17" id="h2-0-17" class="i">+
</a> message Result {
   bytes ok = 1;
   bytes err = 2;
 }
<a href="#h2-0-22" id="h2-0-22" class="d">-
</a><a href="#h2-0-23" id="h2-0-23" class="d">-message QueryRequest {
</a><a href="#h2-0-24" id="h2-0-24" class="d">-  string query = 1;
</a><a href="#h2-0-25" id="h2-0-25" class="d">-  uint64 txn_id = 2;
</a><a href="#h2-0-26" id="h2-0-26" class="d">-};
</a><a href="#h2-0-27" id="h2-0-27" class="d">-
</a><a href="#h2-0-28" id="h2-0-28" class="d">-message Row {
</a><a href="#h2-0-29" id="h2-0-29" class="d">-  Error error = 1;
</a><a href="#h2-0-30" id="h2-0-30" class="d">-  repeated Field field = 2;
</a><a href="#h2-0-31" id="h2-0-31" class="d">-};
</a><a href="#h2-0-32" id="h2-0-32" class="d">-
</a><a href="#h2-0-33" id="h2-0-33" class="d">-message Field {
</a><a href="#h2-0-34" id="h2-0-34" class="d">-  oneof value {
</a><a href="#h2-0-35" id="h2-0-35" class="d">-    bool boolean = 1;
</a><a href="#h2-0-36" id="h2-0-36" class="d">-    int64 integer = 2;
</a><a href="#h2-0-37" id="h2-0-37" class="d">-    double float = 3;
</a><a href="#h2-0-38" id="h2-0-38" class="d">-    string string = 4;
</a><a href="#h2-0-39" id="h2-0-39" class="d">-  };
</a><a href="#h2-0-40" id="h2-0-40" class="d">-}
</a><b>diff --git a/<a id="h3" href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a> b/<a href="../file/src/bin/bank.rs.html">src/bin/bank.rs</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -14,7 +14,7 @@ extern crate toydb;
</a> 
 use rand::distributions::Distribution;
 use rand::prelude::*;
<a href="#h3-0-3" id="h3-0-3" class="d">-use toydb::client::{Row, Value};
</a><a href="#h3-0-4" id="h3-0-4" class="i">+use toydb::client::{ResultSet, Value};
</a> use toydb::Error;
 
 fn main() -&gt; Result&lt;(), Error&gt; {
<a href="#h3-1" id="h3-1" class="h">@@ -255,15 +255,17 @@ impl Bank {
</a> }
 
 // FIXME This should be a row or result method
<a href="#h3-1-3" id="h3-1-3" class="d">-fn get_integers&lt;I: Iterator&lt;Item = Result&lt;Row, Error&gt;&gt;&gt;(mut result: I) -&gt; Result&lt;Vec&lt;i64&gt;, Error&gt; {
</a><a href="#h3-1-4" id="h3-1-4" class="d">-    if let Some(row) = result.next().transpose()? {
</a><a href="#h3-1-5" id="h3-1-5" class="d">-        row.into_iter()
</a><a href="#h3-1-6" id="h3-1-6" class="d">-            .map(|f| match f {
</a><a href="#h3-1-7" id="h3-1-7" class="d">-                Value::Integer(i) =&gt; Ok(i),
</a><a href="#h3-1-8" id="h3-1-8" class="d">-                _ =&gt; Err(Error::Internal(&quot;no value received&quot;.into())),
</a><a href="#h3-1-9" id="h3-1-9" class="d">-            })
</a><a href="#h3-1-10" id="h3-1-10" class="d">-            .collect()
</a><a href="#h3-1-11" id="h3-1-11" class="d">-    } else {
</a><a href="#h3-1-12" id="h3-1-12" class="d">-        Err(Error::Internal(&quot;no row received&quot;.into()))
</a><a href="#h3-1-13" id="h3-1-13" class="i">+fn get_integers(result: ResultSet) -&gt; Result&lt;Vec&lt;i64&gt;, Error&gt; {
</a><a href="#h3-1-14" id="h3-1-14" class="i">+    if let ResultSet::Query { mut relation } = result {
</a><a href="#h3-1-15" id="h3-1-15" class="i">+        if let Some(row) = relation.next().transpose()? {
</a><a href="#h3-1-16" id="h3-1-16" class="i">+            return row
</a><a href="#h3-1-17" id="h3-1-17" class="i">+                .into_iter()
</a><a href="#h3-1-18" id="h3-1-18" class="i">+                .map(|f| match f {
</a><a href="#h3-1-19" id="h3-1-19" class="i">+                    Value::Integer(i) =&gt; Ok(i),
</a><a href="#h3-1-20" id="h3-1-20" class="i">+                    _ =&gt; Err(Error::Internal(&quot;no value received&quot;.into())),
</a><a href="#h3-1-21" id="h3-1-21" class="i">+                })
</a><a href="#h3-1-22" id="h3-1-22" class="i">+                .collect();
</a><a href="#h3-1-23" id="h3-1-23" class="i">+        }
</a>     }
<a href="#h3-1-25" id="h3-1-25" class="i">+    Err(Error::Internal(&quot;no row received&quot;.into()))
</a> }
<b>diff --git a/<a id="h4" href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a> b/<a href="../file/src/bin/toysql.rs.html">src/bin/toysql.rs</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -11,7 +11,7 @@ extern crate rustyline;
</a> extern crate toydb;
 
 use rustyline::error::ReadlineError;
<a href="#h4-0-3" id="h4-0-3" class="d">-use toydb::client::{Effect, Mode};
</a><a href="#h4-0-4" id="h4-0-4" class="i">+use toydb::client::{Mode, ResultSet};
</a> use toydb::Error;
 
 fn main() -&gt; Result&lt;(), Error&gt; {
<a href="#h4-1" id="h4-1" class="h">@@ -137,42 +137,39 @@ Semicolons are not supported. The following !-commands are also available:
</a> 
     /// Runs a query and displays the results
     fn execute_query(&amp;mut self, query: &amp;str) -&gt; Result&lt;(), Error&gt; {
<a href="#h4-1-3" id="h4-1-3" class="d">-        let resultset = self.client.query(query)?;
</a><a href="#h4-1-4" id="h4-1-4" class="d">-
</a><a href="#h4-1-5" id="h4-1-5" class="d">-        match resultset.effect() {
</a><a href="#h4-1-6" id="h4-1-6" class="d">-            Some(Effect::Begin { id, mode: Mode::ReadWrite }) =&gt; {
</a><a href="#h4-1-7" id="h4-1-7" class="d">-                println!(&quot;Began transaction {}&quot;, id)
</a><a href="#h4-1-8" id="h4-1-8" class="d">-            }
</a><a href="#h4-1-9" id="h4-1-9" class="d">-            Some(Effect::Begin { id, mode: Mode::ReadOnly }) =&gt; {
</a><a href="#h4-1-10" id="h4-1-10" class="i">+        match self.client.query(query)? {
</a><a href="#h4-1-11" id="h4-1-11" class="i">+            ResultSet::Begin { id, mode: Mode::ReadWrite } =&gt; println!(&quot;Began transaction {}&quot;, id),
</a><a href="#h4-1-12" id="h4-1-12" class="i">+            ResultSet::Begin { id, mode: Mode::ReadOnly } =&gt; {
</a>                 println!(&quot;Began read-only transaction {}&quot;, id)
             }
<a href="#h4-1-15" id="h4-1-15" class="d">-            Some(Effect::Begin { id, mode: Mode::Snapshot { version } }) =&gt; {
</a><a href="#h4-1-16" id="h4-1-16" class="i">+            ResultSet::Begin { id, mode: Mode::Snapshot { version } } =&gt; {
</a>                 println!(&quot;Began read-only transaction {} in version {} snapshot&quot;, id, version)
             }
<a href="#h4-1-19" id="h4-1-19" class="d">-            Some(Effect::Commit { id }) =&gt; println!(&quot;Committed transaction {}&quot;, id),
</a><a href="#h4-1-20" id="h4-1-20" class="d">-            Some(Effect::Rollback { id }) =&gt; println!(&quot;Rolled back transaction {}&quot;, id),
</a><a href="#h4-1-21" id="h4-1-21" class="d">-            Some(Effect::Create { count }) =&gt; println!(&quot;Created {} rows&quot;, count),
</a><a href="#h4-1-22" id="h4-1-22" class="d">-            Some(Effect::Delete { count }) =&gt; println!(&quot;Deleted {} rows&quot;, count),
</a><a href="#h4-1-23" id="h4-1-23" class="d">-            Some(Effect::Update { count }) =&gt; println!(&quot;Updated {} rows&quot;, count),
</a><a href="#h4-1-24" id="h4-1-24" class="d">-            Some(Effect::CreateTable { name }) =&gt; println!(&quot;Created table {}&quot;, name),
</a><a href="#h4-1-25" id="h4-1-25" class="d">-            Some(Effect::DropTable { name }) =&gt; println!(&quot;Dropped table {}&quot;, name),
</a><a href="#h4-1-26" id="h4-1-26" class="d">-            None =&gt; {}
</a><a href="#h4-1-27" id="h4-1-27" class="d">-        }
</a><a href="#h4-1-28" id="h4-1-28" class="d">-
</a><a href="#h4-1-29" id="h4-1-29" class="d">-        if self.show_headers {
</a><a href="#h4-1-30" id="h4-1-30" class="d">-            println!(
</a><a href="#h4-1-31" id="h4-1-31" class="d">-                &quot;{}&quot;,
</a><a href="#h4-1-32" id="h4-1-32" class="d">-                resultset
</a><a href="#h4-1-33" id="h4-1-33" class="d">-                    .columns()
</a><a href="#h4-1-34" id="h4-1-34" class="d">-                    .into_iter()
</a><a href="#h4-1-35" id="h4-1-35" class="d">-                    .map(|c| c.unwrap_or_else(|| &quot;?&quot;.into()))
</a><a href="#h4-1-36" id="h4-1-36" class="d">-                    .collect::&lt;Vec&lt;_&gt;&gt;()
</a><a href="#h4-1-37" id="h4-1-37" class="d">-                    .join(&quot;|&quot;)
</a><a href="#h4-1-38" id="h4-1-38" class="d">-            );
</a><a href="#h4-1-39" id="h4-1-39" class="d">-        }
</a><a href="#h4-1-40" id="h4-1-40" class="d">-        for result in resultset {
</a><a href="#h4-1-41" id="h4-1-41" class="d">-            let formatted: Vec&lt;String&gt; = result?.into_iter().map(|v| format!(&quot;{}&quot;, v)).collect();
</a><a href="#h4-1-42" id="h4-1-42" class="d">-            println!(&quot;{}&quot;, formatted.join(&quot;|&quot;));
</a><a href="#h4-1-43" id="h4-1-43" class="i">+            ResultSet::Commit { id } =&gt; println!(&quot;Committed transaction {}&quot;, id),
</a><a href="#h4-1-44" id="h4-1-44" class="i">+            ResultSet::Rollback { id } =&gt; println!(&quot;Rolled back transaction {}&quot;, id),
</a><a href="#h4-1-45" id="h4-1-45" class="i">+            ResultSet::Create { count } =&gt; println!(&quot;Created {} rows&quot;, count),
</a><a href="#h4-1-46" id="h4-1-46" class="i">+            ResultSet::Delete { count } =&gt; println!(&quot;Deleted {} rows&quot;, count),
</a><a href="#h4-1-47" id="h4-1-47" class="i">+            ResultSet::Update { count } =&gt; println!(&quot;Updated {} rows&quot;, count),
</a><a href="#h4-1-48" id="h4-1-48" class="i">+            ResultSet::CreateTable { name } =&gt; println!(&quot;Created table {}&quot;, name),
</a><a href="#h4-1-49" id="h4-1-49" class="i">+            ResultSet::DropTable { name } =&gt; println!(&quot;Dropped table {}&quot;, name),
</a><a href="#h4-1-50" id="h4-1-50" class="i">+            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h4-1-51" id="h4-1-51" class="i">+                if self.show_headers {
</a><a href="#h4-1-52" id="h4-1-52" class="i">+                    println!(
</a><a href="#h4-1-53" id="h4-1-53" class="i">+                        &quot;{}&quot;,
</a><a href="#h4-1-54" id="h4-1-54" class="i">+                        relation
</a><a href="#h4-1-55" id="h4-1-55" class="i">+                            .columns
</a><a href="#h4-1-56" id="h4-1-56" class="i">+                            .iter()
</a><a href="#h4-1-57" id="h4-1-57" class="i">+                            .map(|c| c.name.clone().unwrap_or_else(|| &quot;?&quot;.into()))
</a><a href="#h4-1-58" id="h4-1-58" class="i">+                            .collect::&lt;Vec&lt;_&gt;&gt;()
</a><a href="#h4-1-59" id="h4-1-59" class="i">+                            .join(&quot;|&quot;)
</a><a href="#h4-1-60" id="h4-1-60" class="i">+                    );
</a><a href="#h4-1-61" id="h4-1-61" class="i">+                }
</a><a href="#h4-1-62" id="h4-1-62" class="i">+                while let Some(row) = relation.next().transpose()? {
</a><a href="#h4-1-63" id="h4-1-63" class="i">+                    let formatted: Vec&lt;String&gt; =
</a><a href="#h4-1-64" id="h4-1-64" class="i">+                        row.into_iter().map(|v| format!(&quot;{}&quot;, v)).collect();
</a><a href="#h4-1-65" id="h4-1-65" class="i">+                    println!(&quot;{}&quot;, formatted.join(&quot;|&quot;));
</a><a href="#h4-1-66" id="h4-1-66" class="i">+                }
</a><a href="#h4-1-67" id="h4-1-67" class="i">+            }
</a>         }
         Ok(())
     }
<b>diff --git a/<a id="h5" href="../file/src/client.rs.html">src/client.rs</a> b/<a href="../file/src/client.rs.html">src/client.rs</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -3,7 +3,7 @@ use crate::server::{Request, Response};
</a> use crate::service;
 pub use crate::sql::types::schema::Column;
 pub use crate::sql::types::DataType;
<a href="#h5-0-3" id="h5-0-3" class="d">-pub use crate::sql::{Effect, Mode, ResultColumns, ResultSet, Row, Table, Value};
</a><a href="#h5-0-4" id="h5-0-4" class="i">+pub use crate::sql::{Mode, ResultColumns, ResultSet, Row, Rows, Table, Value};
</a> use crate::utility::{deserialize, serialize};
 use crate::Error;
 use grpc::ClientStubExt;
<a href="#h5-1" id="h5-1" class="h">@@ -63,28 +63,47 @@ impl Client {
</a> 
     /// Runs a query
     pub fn query(&amp;mut self, query: &amp;str) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h5-1-3" id="h5-1-3" class="d">-        let (metadata, iter) = self
</a><a href="#h5-1-4" id="h5-1-4" class="i">+        let (_, mut stream) = self
</a>             .client
<a href="#h5-1-6" id="h5-1-6" class="d">-            .query(
</a><a href="#h5-1-7" id="h5-1-7" class="i">+            .execute(
</a>                 grpc::RequestOptions::new(),
<a href="#h5-1-9" id="h5-1-9" class="d">-                service::QueryRequest {
</a><a href="#h5-1-10" id="h5-1-10" class="d">-                    query: query.to_owned(),
</a><a href="#h5-1-11" id="h5-1-11" class="i">+                service::Query {
</a>                     txn_id: match self.txn {
                         Some((id, _)) =&gt; id,
                         None =&gt; 0,
                     },
<a href="#h5-1-16" id="h5-1-16" class="i">+                    query: query.to_owned(),
</a>                     ..Default::default()
                 },
             )
             .wait()?;
<a href="#h5-1-21" id="h5-1-21" class="d">-        let rs = resultset_from_grpc(metadata, iter)?;
</a><a href="#h5-1-22" id="h5-1-22" class="d">-        match rs.effect() {
</a><a href="#h5-1-23" id="h5-1-23" class="d">-            Some(Effect::Begin { id, mode }) =&gt; self.txn = Some((id, mode)),
</a><a href="#h5-1-24" id="h5-1-24" class="d">-            Some(Effect::Commit { .. }) =&gt; self.txn = None,
</a><a href="#h5-1-25" id="h5-1-25" class="d">-            Some(Effect::Rollback { .. }) =&gt; self.txn = None,
</a><a href="#h5-1-26" id="h5-1-26" class="i">+
</a><a href="#h5-1-27" id="h5-1-27" class="i">+        let resp =
</a><a href="#h5-1-28" id="h5-1-28" class="i">+            stream.next().ok_or_else(|| Error::Internal(&quot;Unexpected end of stream&quot;.into()))??;
</a><a href="#h5-1-29" id="h5-1-29" class="i">+        if !resp.err.is_empty() {
</a><a href="#h5-1-30" id="h5-1-30" class="i">+            return Err(deserialize(&amp;resp.err)?);
</a><a href="#h5-1-31" id="h5-1-31" class="i">+        }
</a><a href="#h5-1-32" id="h5-1-32" class="i">+        let mut result = deserialize(&amp;resp.ok)?;
</a><a href="#h5-1-33" id="h5-1-33" class="i">+        match &amp;mut result {
</a><a href="#h5-1-34" id="h5-1-34" class="i">+            ResultSet::Query { relation } =&gt; {
</a><a href="#h5-1-35" id="h5-1-35" class="i">+                relation.rows = Some(Box::new(stream.map(Self::stream_to_row)))
</a><a href="#h5-1-36" id="h5-1-36" class="i">+            }
</a><a href="#h5-1-37" id="h5-1-37" class="i">+            ResultSet::Begin { id, mode } =&gt; self.txn = Some((*id, mode.clone())),
</a><a href="#h5-1-38" id="h5-1-38" class="i">+            ResultSet::Commit { .. } =&gt; self.txn = None,
</a><a href="#h5-1-39" id="h5-1-39" class="i">+            ResultSet::Rollback { .. } =&gt; self.txn = None,
</a>             _ =&gt; {}
<a href="#h5-1-41" id="h5-1-41" class="i">+        };
</a><a href="#h5-1-42" id="h5-1-42" class="i">+        Ok(result)
</a><a href="#h5-1-43" id="h5-1-43" class="i">+    }
</a><a href="#h5-1-44" id="h5-1-44" class="i">+
</a><a href="#h5-1-45" id="h5-1-45" class="i">+    /// Transform the gRPC result stream into a row iterator
</a><a href="#h5-1-46" id="h5-1-46" class="i">+    fn stream_to_row(item: Result&lt;service::Result, grpc::Error&gt;) -&gt; Result&lt;Row, Error&gt; {
</a><a href="#h5-1-47" id="h5-1-47" class="i">+        let item = item?;
</a><a href="#h5-1-48" id="h5-1-48" class="i">+        if !item.err.is_empty() {
</a><a href="#h5-1-49" id="h5-1-49" class="i">+            return Err(deserialize(&amp;item.err)?);
</a>         }
<a href="#h5-1-51" id="h5-1-51" class="d">-        Ok(rs)
</a><a href="#h5-1-52" id="h5-1-52" class="i">+        let row = deserialize(&amp;item.ok)?;
</a><a href="#h5-1-53" id="h5-1-53" class="i">+        Ok(row)
</a>     }
 
     /// Checks server status
<a href="#h5-2" id="h5-2" class="h">@@ -95,50 +114,3 @@ impl Client {
</a>         }
     }
 }
<a href="#h5-2-3" id="h5-2-3" class="d">-
</a><a href="#h5-2-4" id="h5-2-4" class="d">-/// Converts a protobuf error into a toyDB error
</a><a href="#h5-2-5" id="h5-2-5" class="d">-fn error_from_protobuf(err: protobuf::SingularPtrField&lt;service::Error&gt;) -&gt; Result&lt;(), Error&gt; {
</a><a href="#h5-2-6" id="h5-2-6" class="d">-    match err.into_option() {
</a><a href="#h5-2-7" id="h5-2-7" class="d">-        Some(err) =&gt; Err(Error::Internal(err.message)),
</a><a href="#h5-2-8" id="h5-2-8" class="d">-        _ =&gt; Ok(()),
</a><a href="#h5-2-9" id="h5-2-9" class="d">-    }
</a><a href="#h5-2-10" id="h5-2-10" class="d">-}
</a><a href="#h5-2-11" id="h5-2-11" class="d">-
</a><a href="#h5-2-12" id="h5-2-12" class="d">-/// Converts a GRPC result into a resultset
</a><a href="#h5-2-13" id="h5-2-13" class="d">-fn resultset_from_grpc(
</a><a href="#h5-2-14" id="h5-2-14" class="d">-    metadata: grpc::Metadata,
</a><a href="#h5-2-15" id="h5-2-15" class="d">-    rows: Box&lt;dyn Iterator&lt;Item = Result&lt;service::Row, grpc::Error&gt;&gt; + Send&gt;,
</a><a href="#h5-2-16" id="h5-2-16" class="d">-) -&gt; Result&lt;ResultSet, Error&gt; {
</a><a href="#h5-2-17" id="h5-2-17" class="d">-    let rows = rows.map(|r| match r {
</a><a href="#h5-2-18" id="h5-2-18" class="d">-        Ok(protorow) =&gt; {
</a><a href="#h5-2-19" id="h5-2-19" class="d">-            if let Err(err) = error_from_protobuf(protorow.error.clone()) {
</a><a href="#h5-2-20" id="h5-2-20" class="d">-                Err(err)
</a><a href="#h5-2-21" id="h5-2-21" class="d">-            } else {
</a><a href="#h5-2-22" id="h5-2-22" class="d">-                Ok(row_from_protobuf(protorow))
</a><a href="#h5-2-23" id="h5-2-23" class="d">-            }
</a><a href="#h5-2-24" id="h5-2-24" class="d">-        }
</a><a href="#h5-2-25" id="h5-2-25" class="d">-        Err(err) =&gt; Err(err.into()),
</a><a href="#h5-2-26" id="h5-2-26" class="d">-    });
</a><a href="#h5-2-27" id="h5-2-27" class="d">-    let columns = match metadata.get(&quot;columns&quot;) {
</a><a href="#h5-2-28" id="h5-2-28" class="d">-        Some(c) =&gt; ResultColumns::from(deserialize(c)?),
</a><a href="#h5-2-29" id="h5-2-29" class="d">-        None =&gt; ResultColumns::new(Vec::new()),
</a><a href="#h5-2-30" id="h5-2-30" class="d">-    };
</a><a href="#h5-2-31" id="h5-2-31" class="d">-    let effect = metadata.get(&quot;effect&quot;).map(deserialize).transpose()?;
</a><a href="#h5-2-32" id="h5-2-32" class="d">-    Ok(ResultSet::new(effect, columns, Some(Box::new(rows))))
</a><a href="#h5-2-33" id="h5-2-33" class="d">-}
</a><a href="#h5-2-34" id="h5-2-34" class="d">-
</a><a href="#h5-2-35" id="h5-2-35" class="d">-/// Converts a protobuf row into a proper row
</a><a href="#h5-2-36" id="h5-2-36" class="d">-fn row_from_protobuf(row: service::Row) -&gt; Row {
</a><a href="#h5-2-37" id="h5-2-37" class="d">-    row.field.into_iter().map(value_from_protobuf).collect()
</a><a href="#h5-2-38" id="h5-2-38" class="d">-}
</a><a href="#h5-2-39" id="h5-2-39" class="d">-
</a><a href="#h5-2-40" id="h5-2-40" class="d">-/// Converts a protobuf field into a proper value
</a><a href="#h5-2-41" id="h5-2-41" class="d">-fn value_from_protobuf(field: service::Field) -&gt; Value {
</a><a href="#h5-2-42" id="h5-2-42" class="d">-    match field.value {
</a><a href="#h5-2-43" id="h5-2-43" class="d">-        None =&gt; Value::Null,
</a><a href="#h5-2-44" id="h5-2-44" class="d">-        Some(service::Field_oneof_value::boolean(b)) =&gt; Value::Boolean(b),
</a><a href="#h5-2-45" id="h5-2-45" class="d">-        Some(service::Field_oneof_value::float(f)) =&gt; Value::Float(f),
</a><a href="#h5-2-46" id="h5-2-46" class="d">-        Some(service::Field_oneof_value::integer(f)) =&gt; Value::Integer(f),
</a><a href="#h5-2-47" id="h5-2-47" class="d">-        Some(service::Field_oneof_value::string(s)) =&gt; Value::String(s),
</a><a href="#h5-2-48" id="h5-2-48" class="d">-    }
</a><a href="#h5-2-49" id="h5-2-49" class="d">-}
</a><b>diff --git a/<a id="h6" href="../file/src/lib.rs.html">src/lib.rs</a> b/<a href="../file/src/lib.rs.html">src/lib.rs</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -6,6 +6,8 @@ extern crate assert_matches;
</a> extern crate config;
 #[macro_use(select)]
 extern crate crossbeam;
<a href="#h6-0-3" id="h6-0-3" class="i">+#[macro_use]
</a><a href="#h6-0-4" id="h6-0-4" class="i">+extern crate derivative;
</a> #[cfg(test)]
 extern crate goldenfile;
 extern crate httpbis;
<b>diff --git a/<a id="h7" href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a> b/<a href="../file/src/server/toydb.rs.html">src/server/toydb.rs</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,7 +1,7 @@
</a> use crate::raft::Raft;
 use crate::service;
 use crate::sql;
<a href="#h7-0-3" id="h7-0-3" class="d">-use crate::sql::types::{Row, Value};
</a><a href="#h7-0-4" id="h7-0-4" class="i">+use crate::sql::{Relation, ResultSet, Row};
</a> use crate::utility::{deserialize, serialize};
 use crate::Error;
 use sql::engine::{Engine, Transaction};
<a href="#h7-1" id="h7-1" class="h">@@ -55,40 +55,30 @@ impl service::ToyDB for ToyDB {
</a>         grpc::SingleResponse::completed(resp)
     }
 
<a href="#h7-1-3" id="h7-1-3" class="d">-    fn query(
</a><a href="#h7-1-4" id="h7-1-4" class="i">+    fn execute(
</a>         &amp;self,
         _: grpc::RequestOptions,
<a href="#h7-1-7" id="h7-1-7" class="d">-        req: service::QueryRequest,
</a><a href="#h7-1-8" id="h7-1-8" class="d">-    ) -&gt; grpc::StreamingResponse&lt;service::Row&gt; {
</a><a href="#h7-1-9" id="h7-1-9" class="d">-        let result = match self
</a><a href="#h7-1-10" id="h7-1-10" class="d">-            .engine
</a><a href="#h7-1-11" id="h7-1-11" class="d">-            .session(Some(req.txn_id).filter(|&amp;id| id &gt; 0))
</a><a href="#h7-1-12" id="h7-1-12" class="d">-            .unwrap()
</a><a href="#h7-1-13" id="h7-1-13" class="d">-            .execute(&amp;req.query)
</a><a href="#h7-1-14" id="h7-1-14" class="i">+        req: service::Query,
</a><a href="#h7-1-15" id="h7-1-15" class="i">+    ) -&gt; grpc::StreamingResponse&lt;service::Result&gt; {
</a><a href="#h7-1-16" id="h7-1-16" class="i">+        let iter: Box&lt;dyn Iterator&lt;Item = service::Result&gt; + Send&gt; = match self
</a><a href="#h7-1-17" id="h7-1-17" class="i">+            .execute(req.txn_id, &amp;req.query)
</a>         {
<a href="#h7-1-19" id="h7-1-19" class="d">-            Ok(result) =&gt; result,
</a><a href="#h7-1-20" id="h7-1-20" class="d">-            Err(err) =&gt; {
</a><a href="#h7-1-21" id="h7-1-21" class="d">-                return grpc::StreamingResponse::completed(vec![service::Row {
</a><a href="#h7-1-22" id="h7-1-22" class="d">-                    error: Self::error_to_protobuf(err),
</a><a href="#h7-1-23" id="h7-1-23" class="d">-                    ..Default::default()
</a><a href="#h7-1-24" id="h7-1-24" class="d">-                }])
</a><a href="#h7-1-25" id="h7-1-25" class="i">+            Ok(result) =&gt; {
</a><a href="#h7-1-26" id="h7-1-26" class="i">+                let mut iter: Box&lt;dyn Iterator&lt;Item = service::Result&gt; + Send&gt; = Box::new(
</a><a href="#h7-1-27" id="h7-1-27" class="i">+                    vec![service::Result { ok: serialize(&amp;result).unwrap(), ..Default::default() }]
</a><a href="#h7-1-28" id="h7-1-28" class="i">+                        .into_iter(),
</a><a href="#h7-1-29" id="h7-1-29" class="i">+                );
</a><a href="#h7-1-30" id="h7-1-30" class="i">+                if let ResultSet::Query { relation: Relation { rows: Some(rows), .. } } = result {
</a><a href="#h7-1-31" id="h7-1-31" class="i">+                    iter = Box::new(iter.chain(rows.map(Self::rows_to_stream)));
</a><a href="#h7-1-32" id="h7-1-32" class="i">+                }
</a><a href="#h7-1-33" id="h7-1-33" class="i">+                iter
</a>             }
<a href="#h7-1-35" id="h7-1-35" class="i">+            Err(e) =&gt; Box::new(
</a><a href="#h7-1-36" id="h7-1-36" class="i">+                vec![service::Result { err: serialize(&amp;e).unwrap(), ..Default::default() }]
</a><a href="#h7-1-37" id="h7-1-37" class="i">+                    .into_iter(),
</a><a href="#h7-1-38" id="h7-1-38" class="i">+            ),
</a>         };
<a href="#h7-1-40" id="h7-1-40" class="d">-        let mut metadata = grpc::Metadata::new();
</a><a href="#h7-1-41" id="h7-1-41" class="d">-        metadata
</a><a href="#h7-1-42" id="h7-1-42" class="d">-            .add(grpc::MetadataKey::from(&quot;columns&quot;), serialize(&amp;result.columns()).unwrap().into());
</a><a href="#h7-1-43" id="h7-1-43" class="d">-        if let Some(effect) = result.effect() {
</a><a href="#h7-1-44" id="h7-1-44" class="d">-            metadata.add(grpc::MetadataKey::from(&quot;effect&quot;), serialize(&amp;effect).unwrap().into());
</a><a href="#h7-1-45" id="h7-1-45" class="d">-        }
</a><a href="#h7-1-46" id="h7-1-46" class="d">-        grpc::StreamingResponse::iter_with_metadata(
</a><a href="#h7-1-47" id="h7-1-47" class="d">-            metadata,
</a><a href="#h7-1-48" id="h7-1-48" class="d">-            result.map(|r| match r {
</a><a href="#h7-1-49" id="h7-1-49" class="d">-                Ok(row) =&gt; Self::row_to_protobuf(row),
</a><a href="#h7-1-50" id="h7-1-50" class="d">-                Err(err) =&gt; {
</a><a href="#h7-1-51" id="h7-1-51" class="d">-                    service::Row { error: Self::error_to_protobuf(err), ..Default::default() }
</a><a href="#h7-1-52" id="h7-1-52" class="d">-                }
</a><a href="#h7-1-53" id="h7-1-53" class="d">-            }),
</a><a href="#h7-1-54" id="h7-1-54" class="d">-        )
</a><a href="#h7-1-55" id="h7-1-55" class="i">+        grpc::StreamingResponse::iter(iter)
</a>     }
 }
 
<a href="#h7-2" id="h7-2" class="h">@@ -104,6 +94,19 @@ impl ToyDB {
</a>         })
     }
 
<a href="#h7-2-3" id="h7-2-3" class="i">+    fn execute(&amp;self, txn_id: u64, query: &amp;str) -&gt; Result&lt;ResultSet, Error&gt; {
</a><a href="#h7-2-4" id="h7-2-4" class="i">+        error!(&quot;txn_id: {}&quot;, txn_id);
</a><a href="#h7-2-5" id="h7-2-5" class="i">+        let txn_id = if txn_id &gt; 0 { Some(txn_id) } else { None };
</a><a href="#h7-2-6" id="h7-2-6" class="i">+        self.engine.session(txn_id)?.execute(query)
</a><a href="#h7-2-7" id="h7-2-7" class="i">+    }
</a><a href="#h7-2-8" id="h7-2-8" class="i">+
</a><a href="#h7-2-9" id="h7-2-9" class="i">+    fn rows_to_stream(item: Result&lt;Row, Error&gt;) -&gt; service::Result {
</a><a href="#h7-2-10" id="h7-2-10" class="i">+        match item {
</a><a href="#h7-2-11" id="h7-2-11" class="i">+            Ok(row) =&gt; service::Result { ok: serialize(&amp;row).unwrap(), ..Default::default() },
</a><a href="#h7-2-12" id="h7-2-12" class="i">+            Err(err) =&gt; service::Result { err: serialize(&amp;err).unwrap(), ..Default::default() },
</a><a href="#h7-2-13" id="h7-2-13" class="i">+        }
</a><a href="#h7-2-14" id="h7-2-14" class="i">+    }
</a><a href="#h7-2-15" id="h7-2-15" class="i">+
</a>     fn get_table(&amp;self, name: &amp;str) -&gt; Result&lt;sql::Table, Error&gt; {
         self.engine.with_txn(sql::Mode::ReadOnly, |txn| match txn.read_table(name)? {
             Some(t) =&gt; Ok(t),
<a href="#h7-3" id="h7-3" class="h">@@ -115,34 +118,4 @@ impl ToyDB {
</a>         self.engine
             .with_txn(sql::Mode::ReadOnly, |txn| Ok(txn.scan_tables()?.map(|t| t.name).collect()))
     }
<a href="#h7-3-3" id="h7-3-3" class="d">-
</a><a href="#h7-3-4" id="h7-3-4" class="d">-    /// Converts an error into a protobuf object
</a><a href="#h7-3-5" id="h7-3-5" class="d">-    fn error_to_protobuf(err: Error) -&gt; protobuf::SingularPtrField&lt;service::Error&gt; {
</a><a href="#h7-3-6" id="h7-3-6" class="d">-        protobuf::SingularPtrField::from(Some(service::Error {
</a><a href="#h7-3-7" id="h7-3-7" class="d">-            message: err.to_string(),
</a><a href="#h7-3-8" id="h7-3-8" class="d">-            ..Default::default()
</a><a href="#h7-3-9" id="h7-3-9" class="d">-        }))
</a><a href="#h7-3-10" id="h7-3-10" class="d">-    }
</a><a href="#h7-3-11" id="h7-3-11" class="d">-
</a><a href="#h7-3-12" id="h7-3-12" class="d">-    /// Converts a row into a protobuf row
</a><a href="#h7-3-13" id="h7-3-13" class="d">-    fn row_to_protobuf(row: Row) -&gt; service::Row {
</a><a href="#h7-3-14" id="h7-3-14" class="d">-        service::Row {
</a><a href="#h7-3-15" id="h7-3-15" class="d">-            field: row.into_iter().map(Self::value_to_protobuf).collect(),
</a><a href="#h7-3-16" id="h7-3-16" class="d">-            ..Default::default()
</a><a href="#h7-3-17" id="h7-3-17" class="d">-        }
</a><a href="#h7-3-18" id="h7-3-18" class="d">-    }
</a><a href="#h7-3-19" id="h7-3-19" class="d">-
</a><a href="#h7-3-20" id="h7-3-20" class="d">-    /// Converts a value into a protobuf field
</a><a href="#h7-3-21" id="h7-3-21" class="d">-    fn value_to_protobuf(value: Value) -&gt; service::Field {
</a><a href="#h7-3-22" id="h7-3-22" class="d">-        service::Field {
</a><a href="#h7-3-23" id="h7-3-23" class="d">-            value: match value {
</a><a href="#h7-3-24" id="h7-3-24" class="d">-                Value::Null =&gt; None,
</a><a href="#h7-3-25" id="h7-3-25" class="d">-                Value::Boolean(b) =&gt; Some(service::Field_oneof_value::boolean(b)),
</a><a href="#h7-3-26" id="h7-3-26" class="d">-                Value::Float(f) =&gt; Some(service::Field_oneof_value::float(f)),
</a><a href="#h7-3-27" id="h7-3-27" class="d">-                Value::Integer(i) =&gt; Some(service::Field_oneof_value::integer(i)),
</a><a href="#h7-3-28" id="h7-3-28" class="d">-                Value::String(s) =&gt; Some(service::Field_oneof_value::string(s)),
</a><a href="#h7-3-29" id="h7-3-29" class="d">-            },
</a><a href="#h7-3-30" id="h7-3-30" class="d">-            ..Default::default()
</a><a href="#h7-3-31" id="h7-3-31" class="d">-        }
</a><a href="#h7-3-32" id="h7-3-32" class="d">-    }
</a> }
<b>diff --git a/<a id="h8" href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a> b/<a href="../file/src/sql/engine/mod.rs.html">src/sql/engine/mod.rs</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -5,7 +5,7 @@ mod raft;
</a> pub use kv::KV;
 pub use raft::Raft;
 
<a href="#h8-0-3" id="h8-0-3" class="d">-use super::executor::{Context, Effect, ResultSet};
</a><a href="#h8-0-4" id="h8-0-4" class="i">+use super::executor::{Context, ResultSet};
</a> use super::parser::{ast, Parser};
 use super::planner::Plan;
 use super::types::schema::Table;
<a href="#h8-1" id="h8-1" class="h">@@ -104,39 +104,39 @@ impl&lt;E: Engine + &#39;static&gt; Session&lt;E&gt; {
</a>             }
             ast::Statement::Begin { readonly: true, version: None } =&gt; {
                 let txn = self.engine.begin_with_mode(Mode::ReadOnly)?;
<a href="#h8-1-3" id="h8-1-3" class="d">-                let effect = Effect::Begin { id: txn.id(), mode: txn.mode() };
</a><a href="#h8-1-4" id="h8-1-4" class="i">+                let result = ResultSet::Begin { id: txn.id(), mode: txn.mode() };
</a>                 self.txn = Some(txn);
<a href="#h8-1-6" id="h8-1-6" class="d">-                Ok(ResultSet::from_effect(effect))
</a><a href="#h8-1-7" id="h8-1-7" class="i">+                Ok(result)
</a>             }
             ast::Statement::Begin { readonly: true, version: Some(version) } =&gt; {
                 let txn = self.engine.begin_with_mode(Mode::Snapshot { version })?;
<a href="#h8-1-11" id="h8-1-11" class="d">-                let effect = Effect::Begin { id: txn.id(), mode: txn.mode() };
</a><a href="#h8-1-12" id="h8-1-12" class="i">+                let result = ResultSet::Begin { id: txn.id(), mode: txn.mode() };
</a>                 self.txn = Some(txn);
<a href="#h8-1-14" id="h8-1-14" class="d">-                Ok(ResultSet::from_effect(effect))
</a><a href="#h8-1-15" id="h8-1-15" class="i">+                Ok(result)
</a>             }
             ast::Statement::Begin { readonly: false, version: Some(_) } =&gt; {
                 Err(Error::Value(&quot;Can&#39;t start read-write transaction in a given version&quot;.into()))
             }
             ast::Statement::Begin { readonly: false, version: None } =&gt; {
                 let txn = self.engine.begin_with_mode(Mode::ReadWrite)?;
<a href="#h8-1-22" id="h8-1-22" class="d">-                let effect = Effect::Begin { id: txn.id(), mode: txn.mode() };
</a><a href="#h8-1-23" id="h8-1-23" class="i">+                let result = ResultSet::Begin { id: txn.id(), mode: txn.mode() };
</a>                 self.txn = Some(txn);
<a href="#h8-1-25" id="h8-1-25" class="d">-                Ok(ResultSet::from_effect(effect))
</a><a href="#h8-1-26" id="h8-1-26" class="i">+                Ok(result)
</a>             }
             ast::Statement::Commit | ast::Statement::Rollback if self.txn.is_none() =&gt; {
                 Err(Error::Value(&quot;Not in a transaction&quot;.into()))
             }
             ast::Statement::Commit =&gt; {
                 let txn = std::mem::replace(&amp;mut self.txn, None).unwrap();
<a href="#h8-1-33" id="h8-1-33" class="d">-                let effect = Effect::Commit { id: txn.id() };
</a><a href="#h8-1-34" id="h8-1-34" class="i">+                let result = ResultSet::Commit { id: txn.id() };
</a>                 txn.commit()?;
<a href="#h8-1-36" id="h8-1-36" class="d">-                Ok(ResultSet::from_effect(effect))
</a><a href="#h8-1-37" id="h8-1-37" class="i">+                Ok(result)
</a>             }
             ast::Statement::Rollback =&gt; {
                 let txn = std::mem::replace(&amp;mut self.txn, None).unwrap();
<a href="#h8-1-41" id="h8-1-41" class="d">-                let effect = Effect::Rollback { id: txn.id() };
</a><a href="#h8-1-42" id="h8-1-42" class="i">+                let result = ResultSet::Rollback { id: txn.id() };
</a>                 txn.rollback()?;
<a href="#h8-1-44" id="h8-1-44" class="d">-                Ok(ResultSet::from_effect(effect))
</a><a href="#h8-1-45" id="h8-1-45" class="i">+                Ok(result)
</a>             }
             statement if self.txn.is_some() =&gt; Plan::build(statement)?
                 .optimize()?
<b>diff --git a/<a id="h9" href="../file/src/sql/executor/aggregation.rs.html">src/sql/executor/aggregation.rs</a> b/<a href="../file/src/sql/executor/aggregation.rs.html">src/sql/executor/aggregation.rs</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,7 +1,7 @@
</a> use super::super::engine::Transaction;
 use super::super::planner::Aggregate;
<a href="#h9-0-2" id="h9-0-2" class="d">-use super::super::types::Value;
</a><a href="#h9-0-3" id="h9-0-3" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h9-0-4" id="h9-0-4" class="i">+use super::super::types::{Column, Relation, Value};
</a><a href="#h9-0-5" id="h9-0-5" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 use std::cmp::Ordering;
<a href="#h9-1" id="h9-1" class="h">@@ -26,45 +26,55 @@ impl&lt;T: Transaction&gt; Aggregation&lt;T&gt; {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Aggregation&lt;T&gt; {
     #[allow(clippy::or_fun_call)]
     fn execute(mut self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h9-1-3" id="h9-1-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a>         let agg_count = self.aggregates.len();
<a href="#h9-1-5" id="h9-1-5" class="d">-        if let Some(mut rows) = result.rows {
</a><a href="#h9-1-6" id="h9-1-6" class="d">-            while let Some(mut row) = rows.next().transpose()? {
</a><a href="#h9-1-7" id="h9-1-7" class="d">-                self.accumulators
</a><a href="#h9-1-8" id="h9-1-8" class="d">-                    .entry(row.split_off(self.aggregates.len()))
</a><a href="#h9-1-9" id="h9-1-9" class="d">-                    .or_insert(self.aggregates.iter().map(|agg| Accumulator::from(agg)).collect())
</a><a href="#h9-1-10" id="h9-1-10" class="d">-                    .iter_mut()
</a><a href="#h9-1-11" id="h9-1-11" class="d">-                    .zip(row)
</a><a href="#h9-1-12" id="h9-1-12" class="d">-                    .try_for_each(|(acc, value)| acc.accumulate(&amp;value))?
</a><a href="#h9-1-13" id="h9-1-13" class="i">+        match self.source.execute(ctx)? {
</a><a href="#h9-1-14" id="h9-1-14" class="i">+            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h9-1-15" id="h9-1-15" class="i">+                while let Some(mut row) = relation.next().transpose()? {
</a><a href="#h9-1-16" id="h9-1-16" class="i">+                    self.accumulators
</a><a href="#h9-1-17" id="h9-1-17" class="i">+                        .entry(row.split_off(self.aggregates.len()))
</a><a href="#h9-1-18" id="h9-1-18" class="i">+                        .or_insert(
</a><a href="#h9-1-19" id="h9-1-19" class="i">+                            self.aggregates.iter().map(|agg| Accumulator::from(agg)).collect(),
</a><a href="#h9-1-20" id="h9-1-20" class="i">+                        )
</a><a href="#h9-1-21" id="h9-1-21" class="i">+                        .iter_mut()
</a><a href="#h9-1-22" id="h9-1-22" class="i">+                        .zip(row)
</a><a href="#h9-1-23" id="h9-1-23" class="i">+                        .try_for_each(|(acc, value)| acc.accumulate(&amp;value))?
</a><a href="#h9-1-24" id="h9-1-24" class="i">+                }
</a><a href="#h9-1-25" id="h9-1-25" class="i">+                // If there were no rows and no group-by columns, return a row of empty accumulators:
</a><a href="#h9-1-26" id="h9-1-26" class="i">+                // SELECT COUNT(*) FROM t WHERE FALSE
</a><a href="#h9-1-27" id="h9-1-27" class="i">+                if self.accumulators.is_empty() &amp;&amp; self.aggregates.len() == relation.columns.len() {
</a><a href="#h9-1-28" id="h9-1-28" class="i">+                    self.accumulators.insert(
</a><a href="#h9-1-29" id="h9-1-29" class="i">+                        Vec::new(),
</a><a href="#h9-1-30" id="h9-1-30" class="i">+                        self.aggregates.iter().map(|agg| Accumulator::from(agg)).collect(),
</a><a href="#h9-1-31" id="h9-1-31" class="i">+                    );
</a><a href="#h9-1-32" id="h9-1-32" class="i">+                }
</a><a href="#h9-1-33" id="h9-1-33" class="i">+                Ok(ResultSet::Query {
</a><a href="#h9-1-34" id="h9-1-34" class="i">+                    relation: Relation {
</a><a href="#h9-1-35" id="h9-1-35" class="i">+                        columns: relation
</a><a href="#h9-1-36" id="h9-1-36" class="i">+                            .columns
</a><a href="#h9-1-37" id="h9-1-37" class="i">+                            .into_iter()
</a><a href="#h9-1-38" id="h9-1-38" class="i">+                            .enumerate()
</a><a href="#h9-1-39" id="h9-1-39" class="i">+                            .map(|(i, c)| {
</a><a href="#h9-1-40" id="h9-1-40" class="i">+                                if i &lt; agg_count {
</a><a href="#h9-1-41" id="h9-1-41" class="i">+                                    Column { relation: None, name: None }
</a><a href="#h9-1-42" id="h9-1-42" class="i">+                                } else {
</a><a href="#h9-1-43" id="h9-1-43" class="i">+                                    c
</a><a href="#h9-1-44" id="h9-1-44" class="i">+                                }
</a><a href="#h9-1-45" id="h9-1-45" class="i">+                            })
</a><a href="#h9-1-46" id="h9-1-46" class="i">+                            .collect(),
</a><a href="#h9-1-47" id="h9-1-47" class="i">+                        rows: Some(Box::new(self.accumulators.into_iter().map(
</a><a href="#h9-1-48" id="h9-1-48" class="i">+                            |(bucket, accs)| {
</a><a href="#h9-1-49" id="h9-1-49" class="i">+                                Ok(accs
</a><a href="#h9-1-50" id="h9-1-50" class="i">+                                    .into_iter()
</a><a href="#h9-1-51" id="h9-1-51" class="i">+                                    .map(|acc| acc.aggregate())
</a><a href="#h9-1-52" id="h9-1-52" class="i">+                                    .chain(bucket.into_iter())
</a><a href="#h9-1-53" id="h9-1-53" class="i">+                                    .collect())
</a><a href="#h9-1-54" id="h9-1-54" class="i">+                            },
</a><a href="#h9-1-55" id="h9-1-55" class="i">+                        ))),
</a><a href="#h9-1-56" id="h9-1-56" class="i">+                    },
</a><a href="#h9-1-57" id="h9-1-57" class="i">+                })
</a>             }
<a href="#h9-1-59" id="h9-1-59" class="d">-            // If there were no rows and no group-by columns, return a row of empty accumulators:
</a><a href="#h9-1-60" id="h9-1-60" class="d">-            // SELECT COUNT(*) FROM t WHERE FALSE
</a><a href="#h9-1-61" id="h9-1-61" class="d">-            if self.accumulators.is_empty() &amp;&amp; self.aggregates.len() == result.columns.len() {
</a><a href="#h9-1-62" id="h9-1-62" class="d">-                self.accumulators.insert(
</a><a href="#h9-1-63" id="h9-1-63" class="d">-                    Vec::new(),
</a><a href="#h9-1-64" id="h9-1-64" class="d">-                    self.aggregates.iter().map(|agg| Accumulator::from(agg)).collect(),
</a><a href="#h9-1-65" id="h9-1-65" class="d">-                );
</a><a href="#h9-1-66" id="h9-1-66" class="d">-            }
</a><a href="#h9-1-67" id="h9-1-67" class="d">-            result = ResultSet::from_rows(
</a><a href="#h9-1-68" id="h9-1-68" class="d">-                ResultColumns::new(
</a><a href="#h9-1-69" id="h9-1-69" class="d">-                    result
</a><a href="#h9-1-70" id="h9-1-70" class="d">-                        .columns
</a><a href="#h9-1-71" id="h9-1-71" class="d">-                        .columns
</a><a href="#h9-1-72" id="h9-1-72" class="d">-                        .into_iter()
</a><a href="#h9-1-73" id="h9-1-73" class="d">-                        .enumerate()
</a><a href="#h9-1-74" id="h9-1-74" class="d">-                        .map(|(i, c)| if i &lt; agg_count { (None, None) } else { c })
</a><a href="#h9-1-75" id="h9-1-75" class="d">-                        .collect(),
</a><a href="#h9-1-76" id="h9-1-76" class="d">-                ),
</a><a href="#h9-1-77" id="h9-1-77" class="d">-                Box::new(self.accumulators.into_iter().map(|(bucket, accs)| {
</a><a href="#h9-1-78" id="h9-1-78" class="d">-                    Ok(accs
</a><a href="#h9-1-79" id="h9-1-79" class="d">-                        .into_iter()
</a><a href="#h9-1-80" id="h9-1-80" class="d">-                        .map(|acc| acc.aggregate())
</a><a href="#h9-1-81" id="h9-1-81" class="d">-                        .chain(bucket.into_iter())
</a><a href="#h9-1-82" id="h9-1-82" class="d">-                        .collect())
</a><a href="#h9-1-83" id="h9-1-83" class="d">-                })),
</a><a href="#h9-1-84" id="h9-1-84" class="d">-            );
</a><a href="#h9-1-85" id="h9-1-85" class="i">+            r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
</a>         }
<a href="#h9-1-87" id="h9-1-87" class="d">-        Ok(result)
</a>     }
 }
 
<b>diff --git a/<a id="h10" href="../file/src/sql/executor/create_table.rs.html">src/sql/executor/create_table.rs</a> b/<a href="../file/src/sql/executor/create_table.rs.html">src/sql/executor/create_table.rs</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::types::schema::Table;
<a href="#h10-0-2" id="h10-0-2" class="d">-use super::{Context, Effect, Executor, ResultSet};
</a><a href="#h10-0-3" id="h10-0-3" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 /// A CREATE TABLE executor
<a href="#h10-1" id="h10-1" class="h">@@ -18,6 +18,6 @@ impl CreateTable {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for CreateTable {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
         ctx.txn.create_table(&amp;self.table)?;
<a href="#h10-1-3" id="h10-1-3" class="d">-        Ok(ResultSet::from_effect(Effect::CreateTable { name: self.table.name }))
</a><a href="#h10-1-4" id="h10-1-4" class="i">+        Ok(ResultSet::CreateTable { name: self.table.name })
</a>     }
 }
<b>diff --git a/<a id="h11" href="../file/src/sql/executor/delete.rs.html">src/sql/executor/delete.rs</a> b/<a href="../file/src/sql/executor/delete.rs.html">src/sql/executor/delete.rs</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::engine::Transaction;
<a href="#h11-0-1" id="h11-0-1" class="d">-use super::{Context, Effect, Executor, ResultSet};
</a><a href="#h11-0-2" id="h11-0-2" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 /// A DELETE executor
<a href="#h11-1" id="h11-1" class="h">@@ -20,11 +20,15 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Delete&lt;T&gt; {
</a>     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
         let table = ctx.txn.must_read_table(&amp;self.table)?;
         let mut count = 0;
<a href="#h11-1-3" id="h11-1-3" class="d">-        let mut rows = self.source.execute(ctx)?;
</a><a href="#h11-1-4" id="h11-1-4" class="d">-        while let Some(row) = rows.next().transpose()? {
</a><a href="#h11-1-5" id="h11-1-5" class="d">-            ctx.txn.delete(&amp;table.name, &amp;table.get_row_key(&amp;row)?)?;
</a><a href="#h11-1-6" id="h11-1-6" class="d">-            count += 1
</a><a href="#h11-1-7" id="h11-1-7" class="i">+        match self.source.execute(ctx)? {
</a><a href="#h11-1-8" id="h11-1-8" class="i">+            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h11-1-9" id="h11-1-9" class="i">+                while let Some(row) = relation.next().transpose()? {
</a><a href="#h11-1-10" id="h11-1-10" class="i">+                    ctx.txn.delete(&amp;table.name, &amp;table.get_row_key(&amp;row)?)?;
</a><a href="#h11-1-11" id="h11-1-11" class="i">+                    count += 1
</a><a href="#h11-1-12" id="h11-1-12" class="i">+                }
</a><a href="#h11-1-13" id="h11-1-13" class="i">+                Ok(ResultSet::Delete { count })
</a><a href="#h11-1-14" id="h11-1-14" class="i">+            }
</a><a href="#h11-1-15" id="h11-1-15" class="i">+            r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
</a>         }
<a href="#h11-1-17" id="h11-1-17" class="d">-        Ok(ResultSet::from_effect(Effect::Delete { count }))
</a>     }
 }
<b>diff --git a/<a id="h12" href="../file/src/sql/executor/drop_table.rs.html">src/sql/executor/drop_table.rs</a> b/<a href="../file/src/sql/executor/drop_table.rs.html">src/sql/executor/drop_table.rs</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,5 +1,5 @@
</a> use super::super::engine::Transaction;
<a href="#h12-0-1" id="h12-0-1" class="d">-use super::{Context, Effect, Executor, ResultSet};
</a><a href="#h12-0-2" id="h12-0-2" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 /// A DROP TABLE executor
<a href="#h12-1" id="h12-1" class="h">@@ -17,6 +17,6 @@ impl DropTable {
</a> impl&lt;T: Transaction&gt; Executor&lt;T&gt; for DropTable {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
         ctx.txn.delete_table(&amp;self.table)?;
<a href="#h12-1-3" id="h12-1-3" class="d">-        Ok(ResultSet::from_effect(Effect::DropTable { name: self.table }))
</a><a href="#h12-1-4" id="h12-1-4" class="i">+        Ok(ResultSet::DropTable { name: self.table })
</a>     }
 }
<b>diff --git a/<a id="h13" href="../file/src/sql/executor/filter.rs.html">src/sql/executor/filter.rs</a> b/<a href="../file/src/sql/executor/filter.rs.html">src/sql/executor/filter.rs</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,7 +1,7 @@
</a> use super::super::engine::Transaction;
 use super::super::types::expression::Expression;
 use super::super::types::Value;
<a href="#h13-0-3" id="h13-0-3" class="d">-use super::{Context, Executor, ResultSet};
</a><a href="#h13-0-4" id="h13-0-4" class="i">+use super::{Context, Executor, ResultColumns, ResultSet};
</a> use crate::Error;
 
 /// A filter executor
<a href="#h13-1" id="h13-1" class="h">@@ -20,22 +20,26 @@ impl&lt;T: Transaction&gt; Filter&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Filter&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h13-1-3" id="h13-1-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a><a href="#h13-1-4" id="h13-1-4" class="d">-        if let Some(rows) = result.rows {
</a><a href="#h13-1-5" id="h13-1-5" class="d">-            let columns = result.columns.clone();
</a><a href="#h13-1-6" id="h13-1-6" class="d">-            let predicate = self.predicate;
</a><a href="#h13-1-7" id="h13-1-7" class="d">-            result.rows = Some(Box::new(rows.filter_map(move |r| {
</a><a href="#h13-1-8" id="h13-1-8" class="d">-                r.and_then(|row| match predicate.evaluate(&amp;columns.as_env(&amp;row))? {
</a><a href="#h13-1-9" id="h13-1-9" class="d">-                    Value::Boolean(true) =&gt; Ok(Some(row)),
</a><a href="#h13-1-10" id="h13-1-10" class="d">-                    Value::Boolean(false) =&gt; Ok(None),
</a><a href="#h13-1-11" id="h13-1-11" class="d">-                    Value::Null =&gt; Ok(None),
</a><a href="#h13-1-12" id="h13-1-12" class="d">-                    value =&gt; {
</a><a href="#h13-1-13" id="h13-1-13" class="d">-                        Err(Error::Value(format!(&quot;Filter returned {}, expected boolean&quot;, value)))
</a><a href="#h13-1-14" id="h13-1-14" class="d">-                    }
</a><a href="#h13-1-15" id="h13-1-15" class="d">-                })
</a><a href="#h13-1-16" id="h13-1-16" class="d">-                .transpose()
</a><a href="#h13-1-17" id="h13-1-17" class="d">-            })));
</a><a href="#h13-1-18" id="h13-1-18" class="i">+        let result = self.source.execute(ctx)?;
</a><a href="#h13-1-19" id="h13-1-19" class="i">+        if let ResultSet::Query { mut relation } = result {
</a><a href="#h13-1-20" id="h13-1-20" class="i">+            if let Some(rows) = relation.rows {
</a><a href="#h13-1-21" id="h13-1-21" class="i">+                let columns = ResultColumns::from_new_columns(relation.columns.clone());
</a><a href="#h13-1-22" id="h13-1-22" class="i">+                let predicate = self.predicate;
</a><a href="#h13-1-23" id="h13-1-23" class="i">+                relation.rows = Some(Box::new(rows.filter_map(move |r| {
</a><a href="#h13-1-24" id="h13-1-24" class="i">+                    r.and_then(|row| match predicate.evaluate(&amp;columns.as_env(&amp;row))? {
</a><a href="#h13-1-25" id="h13-1-25" class="i">+                        Value::Boolean(true) =&gt; Ok(Some(row)),
</a><a href="#h13-1-26" id="h13-1-26" class="i">+                        Value::Boolean(false) =&gt; Ok(None),
</a><a href="#h13-1-27" id="h13-1-27" class="i">+                        Value::Null =&gt; Ok(None),
</a><a href="#h13-1-28" id="h13-1-28" class="i">+                        value =&gt; Err(Error::Value(format!(
</a><a href="#h13-1-29" id="h13-1-29" class="i">+                            &quot;Filter returned {}, expected boolean&quot;,
</a><a href="#h13-1-30" id="h13-1-30" class="i">+                            value
</a><a href="#h13-1-31" id="h13-1-31" class="i">+                        ))),
</a><a href="#h13-1-32" id="h13-1-32" class="i">+                    })
</a><a href="#h13-1-33" id="h13-1-33" class="i">+                    .transpose()
</a><a href="#h13-1-34" id="h13-1-34" class="i">+                })));
</a><a href="#h13-1-35" id="h13-1-35" class="i">+            }
</a><a href="#h13-1-36" id="h13-1-36" class="i">+            return Ok(ResultSet::Query { relation });
</a>         }
<a href="#h13-1-38" id="h13-1-38" class="d">-        Ok(result)
</a><a href="#h13-1-39" id="h13-1-39" class="i">+        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h14" href="../file/src/sql/executor/insert.rs.html">src/sql/executor/insert.rs</a> b/<a href="../file/src/sql/executor/insert.rs.html">src/sql/executor/insert.rs</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::types::expression::Expressions;
<a href="#h14-0-2" id="h14-0-2" class="d">-use super::{Context, Effect, Executor, ResultSet};
</a><a href="#h14-0-3" id="h14-0-3" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 use std::collections::HashMap;
<a href="#h14-1" id="h14-1" class="h">@@ -39,6 +39,6 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Insert {
</a>             ctx.txn.create(&amp;table.name, row)?;
             count += 1;
         }
<a href="#h14-1-3" id="h14-1-3" class="d">-        Ok(ResultSet::from_effect(Effect::Create { count }))
</a><a href="#h14-1-4" id="h14-1-4" class="i">+        Ok(ResultSet::Create { count })
</a>     }
 }
<b>diff --git a/<a id="h15" href="../file/src/sql/executor/limit.rs.html">src/sql/executor/limit.rs</a> b/<a href="../file/src/sql/executor/limit.rs.html">src/sql/executor/limit.rs</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -18,10 +18,13 @@ impl&lt;T: Transaction&gt; Limit&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Limit&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h15-0-3" id="h15-0-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a><a href="#h15-0-4" id="h15-0-4" class="d">-        if let Some(rows) = result.rows {
</a><a href="#h15-0-5" id="h15-0-5" class="d">-            result.rows = Some(Box::new(rows.take(self.limit as usize)))
</a><a href="#h15-0-6" id="h15-0-6" class="i">+        let result = self.source.execute(ctx)?;
</a><a href="#h15-0-7" id="h15-0-7" class="i">+        if let ResultSet::Query { mut relation } = result {
</a><a href="#h15-0-8" id="h15-0-8" class="i">+            if let Some(rows) = relation.rows {
</a><a href="#h15-0-9" id="h15-0-9" class="i">+                relation.rows = Some(Box::new(rows.take(self.limit as usize)))
</a><a href="#h15-0-10" id="h15-0-10" class="i">+            }
</a><a href="#h15-0-11" id="h15-0-11" class="i">+            return Ok(ResultSet::Query { relation })
</a>         }
<a href="#h15-0-13" id="h15-0-13" class="d">-        Ok(result)
</a><a href="#h15-0-14" id="h15-0-14" class="i">+        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h16" href="../file/src/sql/executor/mod.rs.html">src/sql/executor/mod.rs</a> b/<a href="../file/src/sql/executor/mod.rs.html">src/sql/executor/mod.rs</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -28,10 +28,10 @@ use projection::Projection;
</a> use scan::Scan;
 use update::Update;
 
<a href="#h16-0-3" id="h16-0-3" class="d">-use super::engine::Transaction;
</a><a href="#h16-0-4" id="h16-0-4" class="i">+use super::engine::{Mode, Transaction};
</a> use super::planner::Node;
 use super::types::expression::Environment;
<a href="#h16-0-7" id="h16-0-7" class="d">-use super::types::{Row, Value};
</a><a href="#h16-0-8" id="h16-0-8" class="i">+use super::types::{Columns, Relation, Row, Value};
</a> use crate::Error;
 
 /// A plan executor
<a href="#h16-1" id="h16-1" class="h">@@ -78,64 +78,31 @@ pub struct Context&lt;&#39;a, T: Transaction&gt; {
</a>     pub txn: &amp;&#39;a mut T,
 }
 
<a href="#h16-1-3" id="h16-1-3" class="d">-/// An executor result
</a><a href="#h16-1-4" id="h16-1-4" class="d">-pub struct ResultSet {
</a><a href="#h16-1-5" id="h16-1-5" class="d">-    /// The executor effect (i.e. mutation), if any
</a><a href="#h16-1-6" id="h16-1-6" class="d">-    effect: Option&lt;Effect&gt;,
</a><a href="#h16-1-7" id="h16-1-7" class="d">-    /// The column names of the result
</a><a href="#h16-1-8" id="h16-1-8" class="d">-    columns: ResultColumns,
</a><a href="#h16-1-9" id="h16-1-9" class="d">-    /// The result rows
</a><a href="#h16-1-10" id="h16-1-10" class="d">-    rows: Option&lt;ResultRows&gt;,
</a><a href="#h16-1-11" id="h16-1-11" class="d">-}
</a><a href="#h16-1-12" id="h16-1-12" class="d">-
</a><a href="#h16-1-13" id="h16-1-13" class="d">-impl ResultSet {
</a><a href="#h16-1-14" id="h16-1-14" class="d">-    /// Creates a new result set
</a><a href="#h16-1-15" id="h16-1-15" class="d">-    pub fn new(effect: Option&lt;Effect&gt;, columns: ResultColumns, rows: Option&lt;ResultRows&gt;) -&gt; Self {
</a><a href="#h16-1-16" id="h16-1-16" class="d">-        Self { effect, columns, rows }
</a><a href="#h16-1-17" id="h16-1-17" class="d">-    }
</a><a href="#h16-1-18" id="h16-1-18" class="d">-
</a><a href="#h16-1-19" id="h16-1-19" class="d">-    /// Creates a new result set for an effect
</a><a href="#h16-1-20" id="h16-1-20" class="d">-    pub fn from_effect(effect: Effect) -&gt; Self {
</a><a href="#h16-1-21" id="h16-1-21" class="d">-        Self { effect: Some(effect), columns: ResultColumns::new(Vec::new()), rows: None }
</a><a href="#h16-1-22" id="h16-1-22" class="d">-    }
</a><a href="#h16-1-23" id="h16-1-23" class="d">-
</a><a href="#h16-1-24" id="h16-1-24" class="d">-    /// Creates a new result set for a scan iterator
</a><a href="#h16-1-25" id="h16-1-25" class="d">-    pub fn from_rows(columns: ResultColumns, rows: ResultRows) -&gt; Self {
</a><a href="#h16-1-26" id="h16-1-26" class="d">-        Self { effect: None, columns, rows: Some(rows) }
</a><a href="#h16-1-27" id="h16-1-27" class="d">-    }
</a><a href="#h16-1-28" id="h16-1-28" class="d">-
</a><a href="#h16-1-29" id="h16-1-29" class="d">-    /// Returns the result column names
</a><a href="#h16-1-30" id="h16-1-30" class="d">-    pub fn columns(&amp;self) -&gt; Vec&lt;Option&lt;String&gt;&gt; {
</a><a href="#h16-1-31" id="h16-1-31" class="d">-        self.columns.names()
</a><a href="#h16-1-32" id="h16-1-32" class="d">-    }
</a><a href="#h16-1-33" id="h16-1-33" class="d">-
</a><a href="#h16-1-34" id="h16-1-34" class="d">-    /// Returns the query effect, if any
</a><a href="#h16-1-35" id="h16-1-35" class="d">-    pub fn effect(&amp;self) -&gt; Option&lt;Effect&gt; {
</a><a href="#h16-1-36" id="h16-1-36" class="d">-        self.effect.clone()
</a><a href="#h16-1-37" id="h16-1-37" class="d">-    }
</a><a href="#h16-1-38" id="h16-1-38" class="d">-}
</a><a href="#h16-1-39" id="h16-1-39" class="d">-
</a><a href="#h16-1-40" id="h16-1-40" class="d">-impl Iterator for ResultSet {
</a><a href="#h16-1-41" id="h16-1-41" class="d">-    type Item = Result&lt;Row, Error&gt;;
</a><a href="#h16-1-42" id="h16-1-42" class="d">-
</a><a href="#h16-1-43" id="h16-1-43" class="d">-    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
</a><a href="#h16-1-44" id="h16-1-44" class="d">-        // Make sure iteration is aborted on the first error, otherwise callers
</a><a href="#h16-1-45" id="h16-1-45" class="d">-        // will keep calling next for as long as it keeps returning errors
</a><a href="#h16-1-46" id="h16-1-46" class="d">-        if let Some(ref mut iter) = self.rows {
</a><a href="#h16-1-47" id="h16-1-47" class="d">-            let result = iter.next();
</a><a href="#h16-1-48" id="h16-1-48" class="d">-            if let Some(Err(_)) = result {
</a><a href="#h16-1-49" id="h16-1-49" class="d">-                self.rows = None
</a><a href="#h16-1-50" id="h16-1-50" class="d">-            }
</a><a href="#h16-1-51" id="h16-1-51" class="d">-            result
</a><a href="#h16-1-52" id="h16-1-52" class="d">-        } else {
</a><a href="#h16-1-53" id="h16-1-53" class="d">-            None
</a><a href="#h16-1-54" id="h16-1-54" class="d">-        }
</a><a href="#h16-1-55" id="h16-1-55" class="d">-    }
</a><a href="#h16-1-56" id="h16-1-56" class="i">+/// An executor result set
</a><a href="#h16-1-57" id="h16-1-57" class="i">+#[derive(Debug, Serialize, Deserialize)]
</a><a href="#h16-1-58" id="h16-1-58" class="i">+pub enum ResultSet {
</a><a href="#h16-1-59" id="h16-1-59" class="i">+    // Transaction started
</a><a href="#h16-1-60" id="h16-1-60" class="i">+    Begin { id: u64, mode: Mode },
</a><a href="#h16-1-61" id="h16-1-61" class="i">+    // Transaction committed
</a><a href="#h16-1-62" id="h16-1-62" class="i">+    Commit { id: u64 },
</a><a href="#h16-1-63" id="h16-1-63" class="i">+    // Transaction rolled back
</a><a href="#h16-1-64" id="h16-1-64" class="i">+    Rollback { id: u64 },
</a><a href="#h16-1-65" id="h16-1-65" class="i">+    // Rows created
</a><a href="#h16-1-66" id="h16-1-66" class="i">+    Create { count: u64 },
</a><a href="#h16-1-67" id="h16-1-67" class="i">+    // Rows deleted
</a><a href="#h16-1-68" id="h16-1-68" class="i">+    Delete { count: u64 },
</a><a href="#h16-1-69" id="h16-1-69" class="i">+    // Rows updated
</a><a href="#h16-1-70" id="h16-1-70" class="i">+    Update { count: u64 },
</a><a href="#h16-1-71" id="h16-1-71" class="i">+    // Table created
</a><a href="#h16-1-72" id="h16-1-72" class="i">+    CreateTable { name: String },
</a><a href="#h16-1-73" id="h16-1-73" class="i">+    // Table dropped
</a><a href="#h16-1-74" id="h16-1-74" class="i">+    DropTable { name: String },
</a><a href="#h16-1-75" id="h16-1-75" class="i">+    // Query result
</a><a href="#h16-1-76" id="h16-1-76" class="i">+    Query { relation: Relation },
</a> }
 
<a href="#h16-1-79" id="h16-1-79" class="d">-type ResultRows = Box&lt;dyn Iterator&lt;Item = Result&lt;Row, Error&gt;&gt; + Send&gt;;
</a><a href="#h16-1-80" id="h16-1-80" class="d">-
</a><a href="#h16-1-81" id="h16-1-81" class="d">-/// Column metadata for a result
</a><a href="#h16-1-82" id="h16-1-82" class="i">+/// Column metadata for a result.
</a><a href="#h16-1-83" id="h16-1-83" class="i">+/// FIXME This is outdated and should be removed.
</a> #[derive(Clone, Serialize, Deserialize)]
 pub struct ResultColumns {
     columns: Vec&lt;(Option&lt;String&gt;, Option&lt;String&gt;)&gt;,
<a href="#h16-2" id="h16-2" class="h">@@ -150,6 +117,10 @@ impl ResultColumns {
</a>         Self { columns: columns.into_iter().map(|c| (None, c)).collect() }
     }
 
<a href="#h16-2-3" id="h16-2-3" class="i">+    pub fn from_new_columns(columns: Columns) -&gt; Self {
</a><a href="#h16-2-4" id="h16-2-4" class="i">+        Self { columns: columns.into_iter().map(|c| (c.relation, c.name)).collect() }
</a><a href="#h16-2-5" id="h16-2-5" class="i">+    }
</a><a href="#h16-2-6" id="h16-2-6" class="i">+
</a>     fn as_env&lt;&#39;b&gt;(&amp;&#39;b self, row: &amp;&#39;b [Value]) -&gt; ResultEnv&lt;&#39;b&gt; {
         ResultEnv { columns: &amp;self, row }
     }
<a href="#h16-3" id="h16-3" class="h">@@ -229,6 +200,7 @@ impl ResultColumns {
</a> }
 
 // Environment for a result row
<a href="#h16-3-3" id="h16-3-3" class="i">+// FIXME This should be removed
</a> struct ResultEnv&lt;&#39;a&gt; {
     columns: &amp;&#39;a ResultColumns,
     row: &amp;&#39;a [Value],
<a href="#h16-4" id="h16-4" class="h">@@ -243,24 +215,3 @@ impl&lt;&#39;a&gt; Environment for ResultEnv&lt;&#39;a&gt; {
</a>         self.row.get(index).cloned().ok_or_else(|| Error::Value(&quot;index out of bounds&quot;.into()))
     }
 }
<a href="#h16-4-3" id="h16-4-3" class="d">-
</a><a href="#h16-4-4" id="h16-4-4" class="d">-#[derive(Clone, Debug, Serialize, Deserialize)]
</a><a href="#h16-4-5" id="h16-4-5" class="d">-/// An executor effect
</a><a href="#h16-4-6" id="h16-4-6" class="d">-pub enum Effect {
</a><a href="#h16-4-7" id="h16-4-7" class="d">-    // Transaction started
</a><a href="#h16-4-8" id="h16-4-8" class="d">-    Begin { id: u64, mode: super::engine::Mode },
</a><a href="#h16-4-9" id="h16-4-9" class="d">-    // Transaction committed
</a><a href="#h16-4-10" id="h16-4-10" class="d">-    Commit { id: u64 },
</a><a href="#h16-4-11" id="h16-4-11" class="d">-    // Transaction rolled back
</a><a href="#h16-4-12" id="h16-4-12" class="d">-    Rollback { id: u64 },
</a><a href="#h16-4-13" id="h16-4-13" class="d">-    // Rows created
</a><a href="#h16-4-14" id="h16-4-14" class="d">-    Create { count: u64 },
</a><a href="#h16-4-15" id="h16-4-15" class="d">-    // Rows deleted
</a><a href="#h16-4-16" id="h16-4-16" class="d">-    Delete { count: u64 },
</a><a href="#h16-4-17" id="h16-4-17" class="d">-    // Rows updated
</a><a href="#h16-4-18" id="h16-4-18" class="d">-    Update { count: u64 },
</a><a href="#h16-4-19" id="h16-4-19" class="d">-    // Table created
</a><a href="#h16-4-20" id="h16-4-20" class="d">-    CreateTable { name: String },
</a><a href="#h16-4-21" id="h16-4-21" class="d">-    // Table dropped
</a><a href="#h16-4-22" id="h16-4-22" class="d">-    DropTable { name: String },
</a><a href="#h16-4-23" id="h16-4-23" class="d">-}
</a><b>diff --git a/<a id="h17" href="../file/src/sql/executor/nested_loop_join.rs.html">src/sql/executor/nested_loop_join.rs</a> b/<a href="../file/src/sql/executor/nested_loop_join.rs.html">src/sql/executor/nested_loop_join.rs</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
<a href="#h17-0-1" id="h17-0-1" class="d">-use super::super::types::expression::Expression;
</a><a href="#h17-0-2" id="h17-0-2" class="d">-use super::{Context, Executor, ResultColumns, ResultRows, ResultSet, Row, Value};
</a><a href="#h17-0-3" id="h17-0-3" class="i">+use super::super::types::{expression::Expression, Columns, Relation, Rows};
</a><a href="#h17-0-4" id="h17-0-4" class="i">+use super::{Context, Executor, ResultColumns, ResultSet, Row, Value};
</a> use crate::Error;
 
 /// A nested loop join executor
<a href="#h17-1" id="h17-1" class="h">@@ -32,46 +32,54 @@ impl&lt;T: Transaction&gt; NestedLoopJoin&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for NestedLoopJoin&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h17-1-3" id="h17-1-3" class="d">-        let (mut result, inner) = if self.flip {
</a><a href="#h17-1-4" id="h17-1-4" class="i">+        let (result, inner) = if self.flip {
</a>             (self.inner.execute(ctx)?, self.outer.execute(ctx)?)
         } else {
             (self.outer.execute(ctx)?, self.inner.execute(ctx)?)
         };
<a href="#h17-1-9" id="h17-1-9" class="d">-        let env_columns = result.columns.clone().merge(inner.columns.clone());
</a><a href="#h17-1-10" id="h17-1-10" class="d">-        result.columns = if self.flip {
</a><a href="#h17-1-11" id="h17-1-11" class="d">-            inner.columns.merge(result.columns)
</a><a href="#h17-1-12" id="h17-1-12" class="d">-        } else {
</a><a href="#h17-1-13" id="h17-1-13" class="d">-            result.columns.merge(inner.columns)
</a><a href="#h17-1-14" id="h17-1-14" class="d">-        };
</a><a href="#h17-1-15" id="h17-1-15" class="i">+        if let ResultSet::Query { relation } = result {
</a><a href="#h17-1-16" id="h17-1-16" class="i">+            if let ResultSet::Query { relation: inner } = inner {
</a><a href="#h17-1-17" id="h17-1-17" class="i">+                let env_columns = ResultColumns::from_new_columns(relation.columns.clone())
</a><a href="#h17-1-18" id="h17-1-18" class="i">+                    .merge(ResultColumns::from_new_columns(inner.columns.clone()));
</a><a href="#h17-1-19" id="h17-1-19" class="i">+                let mut join = Relation { columns: Columns::new(), rows: None };
</a><a href="#h17-1-20" id="h17-1-20" class="i">+                if self.flip {
</a><a href="#h17-1-21" id="h17-1-21" class="i">+                    join.columns.extend(inner.columns);
</a><a href="#h17-1-22" id="h17-1-22" class="i">+                    join.columns.extend(relation.columns);
</a><a href="#h17-1-23" id="h17-1-23" class="i">+                } else {
</a><a href="#h17-1-24" id="h17-1-24" class="i">+                    join.columns.extend(relation.columns);
</a><a href="#h17-1-25" id="h17-1-25" class="i">+                    join.columns.extend(inner.columns);
</a><a href="#h17-1-26" id="h17-1-26" class="i">+                }
</a> 
<a href="#h17-1-28" id="h17-1-28" class="d">-        let mut inner_rows = vec![];
</a><a href="#h17-1-29" id="h17-1-29" class="d">-        if let Some(mut rows) = inner.rows {
</a><a href="#h17-1-30" id="h17-1-30" class="d">-            while let Some(row) = rows.next().transpose()? {
</a><a href="#h17-1-31" id="h17-1-31" class="d">-                inner_rows.push(row);
</a><a href="#h17-1-32" id="h17-1-32" class="d">-            }
</a><a href="#h17-1-33" id="h17-1-33" class="d">-        }
</a><a href="#h17-1-34" id="h17-1-34" class="i">+                let mut inner_rows = vec![];
</a><a href="#h17-1-35" id="h17-1-35" class="i">+                if let Some(mut rows) = inner.rows {
</a><a href="#h17-1-36" id="h17-1-36" class="i">+                    while let Some(row) = rows.next().transpose()? {
</a><a href="#h17-1-37" id="h17-1-37" class="i">+                        inner_rows.push(row);
</a><a href="#h17-1-38" id="h17-1-38" class="i">+                    }
</a><a href="#h17-1-39" id="h17-1-39" class="i">+                }
</a> 
<a href="#h17-1-41" id="h17-1-41" class="d">-        if let Some(rows) = result.rows {
</a><a href="#h17-1-42" id="h17-1-42" class="d">-            result.rows = Some(Box::new(NestedLoopRows::new(
</a><a href="#h17-1-43" id="h17-1-43" class="d">-                env_columns,
</a><a href="#h17-1-44" id="h17-1-44" class="d">-                rows,
</a><a href="#h17-1-45" id="h17-1-45" class="d">-                inner_rows,
</a><a href="#h17-1-46" id="h17-1-46" class="d">-                self.predicate,
</a><a href="#h17-1-47" id="h17-1-47" class="d">-                self.pad_inner,
</a><a href="#h17-1-48" id="h17-1-48" class="d">-                self.flip,
</a><a href="#h17-1-49" id="h17-1-49" class="d">-            )));
</a><a href="#h17-1-50" id="h17-1-50" class="i">+                if let Some(rows) = relation.rows {
</a><a href="#h17-1-51" id="h17-1-51" class="i">+                    join.rows = Some(Box::new(NestedLoopRows::new(
</a><a href="#h17-1-52" id="h17-1-52" class="i">+                        env_columns,
</a><a href="#h17-1-53" id="h17-1-53" class="i">+                        rows,
</a><a href="#h17-1-54" id="h17-1-54" class="i">+                        inner_rows,
</a><a href="#h17-1-55" id="h17-1-55" class="i">+                        self.predicate,
</a><a href="#h17-1-56" id="h17-1-56" class="i">+                        self.pad_inner,
</a><a href="#h17-1-57" id="h17-1-57" class="i">+                        self.flip,
</a><a href="#h17-1-58" id="h17-1-58" class="i">+                    )));
</a><a href="#h17-1-59" id="h17-1-59" class="i">+                }
</a><a href="#h17-1-60" id="h17-1-60" class="i">+                return Ok(ResultSet::Query { relation: join });
</a><a href="#h17-1-61" id="h17-1-61" class="i">+            }
</a>         }
<a href="#h17-1-63" id="h17-1-63" class="d">-
</a><a href="#h17-1-64" id="h17-1-64" class="d">-        Ok(result)
</a><a href="#h17-1-65" id="h17-1-65" class="i">+        Err(Error::Internal(&quot;Unexpected result set&quot;.into()))
</a>     }
 }
 
 struct NestedLoopRows {
     columns: ResultColumns,
     predicate: Option&lt;Expression&gt;,
<a href="#h17-1-72" id="h17-1-72" class="d">-    outer: ResultRows,
</a><a href="#h17-1-73" id="h17-1-73" class="i">+    outer: Rows,
</a>     outer_cur: Option&lt;Result&lt;Row, Error&gt;&gt;,
<a href="#h17-1-75" id="h17-1-75" class="d">-    // FIXME inner should be ResultRows too, but requires impl Clone
</a><a href="#h17-1-76" id="h17-1-76" class="i">+    // FIXME inner should be Rows too, but requires impl Clone
</a>     inner: Box&lt;dyn Iterator&lt;Item = Row&gt; + Send&gt;,
     inner_orig: Vec&lt;Row&gt;,
     inner_pad: bool,
<a href="#h17-2" id="h17-2" class="h">@@ -82,7 +90,7 @@ struct NestedLoopRows {
</a> impl NestedLoopRows {
     fn new(
         columns: ResultColumns,
<a href="#h17-2-3" id="h17-2-3" class="d">-        mut outer: ResultRows,
</a><a href="#h17-2-4" id="h17-2-4" class="i">+        mut outer: Rows,
</a>         inner: Vec&lt;Row&gt;,
         predicate: Option&lt;Expression&gt;,
         inner_pad: bool,
<b>diff --git a/<a id="h18" href="../file/src/sql/executor/nothing.rs.html">src/sql/executor/nothing.rs</a> b/<a href="../file/src/sql/executor/nothing.rs.html">src/sql/executor/nothing.rs</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::types::Row;
<a href="#h18-0-2" id="h18-0-2" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h18-0-3" id="h18-0-3" class="i">+use super::{Context, Executor, Relation, ResultSet};
</a> use crate::Error;
 
 /// An executor that produces a single empty row
<a href="#h18-1" id="h18-1" class="h">@@ -14,9 +14,11 @@ impl Nothing {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Nothing {
     fn execute(self: Box&lt;Self&gt;, _ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h18-1-3" id="h18-1-3" class="d">-        Ok(ResultSet::from_rows(
</a><a href="#h18-1-4" id="h18-1-4" class="d">-            ResultColumns::new(Vec::new()),
</a><a href="#h18-1-5" id="h18-1-5" class="d">-            Box::new(std::iter::once(Ok(Row::new()))),
</a><a href="#h18-1-6" id="h18-1-6" class="d">-        ))
</a><a href="#h18-1-7" id="h18-1-7" class="i">+        Ok(ResultSet::Query {
</a><a href="#h18-1-8" id="h18-1-8" class="i">+            relation: Relation {
</a><a href="#h18-1-9" id="h18-1-9" class="i">+                columns: Vec::new(),
</a><a href="#h18-1-10" id="h18-1-10" class="i">+                rows: Some(Box::new(std::iter::once(Ok(Row::new())))),
</a><a href="#h18-1-11" id="h18-1-11" class="i">+            },
</a><a href="#h18-1-12" id="h18-1-12" class="i">+        })
</a>     }
 }
<b>diff --git a/<a id="h19" href="../file/src/sql/executor/offset.rs.html">src/sql/executor/offset.rs</a> b/<a href="../file/src/sql/executor/offset.rs.html">src/sql/executor/offset.rs</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -18,10 +18,13 @@ impl&lt;T: Transaction&gt; Offset&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Offset&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h19-0-3" id="h19-0-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a><a href="#h19-0-4" id="h19-0-4" class="d">-        if let Some(rows) = result.rows {
</a><a href="#h19-0-5" id="h19-0-5" class="d">-            result.rows = Some(Box::new(rows.skip(self.offset as usize)))
</a><a href="#h19-0-6" id="h19-0-6" class="i">+        let result = self.source.execute(ctx)?;
</a><a href="#h19-0-7" id="h19-0-7" class="i">+        if let ResultSet::Query { mut relation } = result {
</a><a href="#h19-0-8" id="h19-0-8" class="i">+            if let Some(rows) = relation.rows {
</a><a href="#h19-0-9" id="h19-0-9" class="i">+                relation.rows = Some(Box::new(rows.skip(self.offset as usize)))
</a><a href="#h19-0-10" id="h19-0-10" class="i">+            }
</a><a href="#h19-0-11" id="h19-0-11" class="i">+            return Ok(ResultSet::Query { relation });
</a>         }
<a href="#h19-0-13" id="h19-0-13" class="d">-        Ok(result)
</a><a href="#h19-0-14" id="h19-0-14" class="i">+        Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>     }
 }
<b>diff --git a/<a id="h20" href="../file/src/sql/executor/order.rs.html">src/sql/executor/order.rs</a> b/<a href="../file/src/sql/executor/order.rs.html">src/sql/executor/order.rs</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -2,7 +2,7 @@ use super::super::engine::Transaction;
</a> use super::super::planner::Direction;
 use super::super::types::expression::Expression;
 use super::super::types::{Row, Value};
<a href="#h20-0-3" id="h20-0-3" class="d">-use super::{Context, Executor, ResultSet};
</a><a href="#h20-0-4" id="h20-0-4" class="i">+use super::{Context, Executor, ResultColumns, ResultSet};
</a> use crate::Error;
 
 /// An order executor
<a href="#h20-1" id="h20-1" class="h">@@ -21,45 +21,53 @@ impl&lt;T: Transaction&gt; Order&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Order&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h20-1-3" id="h20-1-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a><a href="#h20-1-4" id="h20-1-4" class="d">-
</a><a href="#h20-1-5" id="h20-1-5" class="d">-        if let Some(mut rows) = result.rows {
</a><a href="#h20-1-6" id="h20-1-6" class="d">-            // FIXME Since we can&#39;t return errors from the sort_by closure, we have to
</a><a href="#h20-1-7" id="h20-1-7" class="d">-            // pre-evaluate all values. This means that we can&#39;t short-circuit evaluation,
</a><a href="#h20-1-8" id="h20-1-8" class="d">-            // and have to temporarily store evaluated values, which is bad for performance
</a><a href="#h20-1-9" id="h20-1-9" class="d">-            // and memory usage respectively
</a><a href="#h20-1-10" id="h20-1-10" class="d">-            struct Item {
</a><a href="#h20-1-11" id="h20-1-11" class="d">-                row: Row,
</a><a href="#h20-1-12" id="h20-1-12" class="d">-                values: Vec&lt;Value&gt;,
</a><a href="#h20-1-13" id="h20-1-13" class="d">-            };
</a><a href="#h20-1-14" id="h20-1-14" class="d">-            let mut items = Vec::new();
</a><a href="#h20-1-15" id="h20-1-15" class="d">-            while let Some(row) = rows.next().transpose()? {
</a><a href="#h20-1-16" id="h20-1-16" class="d">-                let env = result.columns.as_env(&amp;row);
</a><a href="#h20-1-17" id="h20-1-17" class="d">-                let mut values = Vec::new();
</a><a href="#h20-1-18" id="h20-1-18" class="d">-                for (expr, _) in self.order.iter() {
</a><a href="#h20-1-19" id="h20-1-19" class="d">-                    values.push(expr.evaluate(&amp;env)?);
</a><a href="#h20-1-20" id="h20-1-20" class="d">-                }
</a><a href="#h20-1-21" id="h20-1-21" class="d">-                items.push(Item { row, values })
</a><a href="#h20-1-22" id="h20-1-22" class="d">-            }
</a><a href="#h20-1-23" id="h20-1-23" class="d">-
</a><a href="#h20-1-24" id="h20-1-24" class="d">-            let order = &amp;self.order;
</a><a href="#h20-1-25" id="h20-1-25" class="d">-            items.sort_by(|a, b| {
</a><a href="#h20-1-26" id="h20-1-26" class="d">-                for (i, (_, order)) in order.iter().enumerate() {
</a><a href="#h20-1-27" id="h20-1-27" class="d">-                    let value_a = &amp;a.values[i];
</a><a href="#h20-1-28" id="h20-1-28" class="d">-                    let value_b = &amp;b.values[i];
</a><a href="#h20-1-29" id="h20-1-29" class="d">-                    match value_a.partial_cmp(value_b) {
</a><a href="#h20-1-30" id="h20-1-30" class="d">-                        Some(std::cmp::Ordering::Equal) =&gt; {}
</a><a href="#h20-1-31" id="h20-1-31" class="d">-                        Some(o) =&gt; {
</a><a href="#h20-1-32" id="h20-1-32" class="d">-                            return if *order == Direction::Ascending { o } else { o.reverse() }
</a><a href="#h20-1-33" id="h20-1-33" class="i">+        match self.source.execute(ctx)? {
</a><a href="#h20-1-34" id="h20-1-34" class="i">+            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h20-1-35" id="h20-1-35" class="i">+                if let Some(mut rows) = relation.rows {
</a><a href="#h20-1-36" id="h20-1-36" class="i">+                    // FIXME Since we can&#39;t return errors from the sort_by closure, we have to
</a><a href="#h20-1-37" id="h20-1-37" class="i">+                    // pre-evaluate all values. This means that we can&#39;t short-circuit evaluation,
</a><a href="#h20-1-38" id="h20-1-38" class="i">+                    // and have to temporarily store evaluated values, which is bad for performance
</a><a href="#h20-1-39" id="h20-1-39" class="i">+                    // and memory usage respectively
</a><a href="#h20-1-40" id="h20-1-40" class="i">+                    struct Item {
</a><a href="#h20-1-41" id="h20-1-41" class="i">+                        row: Row,
</a><a href="#h20-1-42" id="h20-1-42" class="i">+                        values: Vec&lt;Value&gt;,
</a><a href="#h20-1-43" id="h20-1-43" class="i">+                    };
</a><a href="#h20-1-44" id="h20-1-44" class="i">+                    let mut items = Vec::new();
</a><a href="#h20-1-45" id="h20-1-45" class="i">+                    while let Some(row) = rows.next().transpose()? {
</a><a href="#h20-1-46" id="h20-1-46" class="i">+                        let env_columns = ResultColumns::from_new_columns(relation.columns.clone());
</a><a href="#h20-1-47" id="h20-1-47" class="i">+                        let env = env_columns.as_env(&amp;row);
</a><a href="#h20-1-48" id="h20-1-48" class="i">+                        let mut values = Vec::new();
</a><a href="#h20-1-49" id="h20-1-49" class="i">+                        for (expr, _) in self.order.iter() {
</a><a href="#h20-1-50" id="h20-1-50" class="i">+                            values.push(expr.evaluate(&amp;env)?);
</a>                         }
<a href="#h20-1-52" id="h20-1-52" class="d">-                        None =&gt; {}
</a><a href="#h20-1-53" id="h20-1-53" class="i">+                        items.push(Item { row, values })
</a>                     }
<a href="#h20-1-55" id="h20-1-55" class="d">-                }
</a><a href="#h20-1-56" id="h20-1-56" class="d">-                std::cmp::Ordering::Equal
</a><a href="#h20-1-57" id="h20-1-57" class="d">-            });
</a> 
<a href="#h20-1-59" id="h20-1-59" class="d">-            result.rows = Some(Box::new(items.into_iter().map(|i| Ok(i.row))));
</a><a href="#h20-1-60" id="h20-1-60" class="i">+                    let order = &amp;self.order;
</a><a href="#h20-1-61" id="h20-1-61" class="i">+                    items.sort_by(|a, b| {
</a><a href="#h20-1-62" id="h20-1-62" class="i">+                        for (i, (_, order)) in order.iter().enumerate() {
</a><a href="#h20-1-63" id="h20-1-63" class="i">+                            let value_a = &amp;a.values[i];
</a><a href="#h20-1-64" id="h20-1-64" class="i">+                            let value_b = &amp;b.values[i];
</a><a href="#h20-1-65" id="h20-1-65" class="i">+                            match value_a.partial_cmp(value_b) {
</a><a href="#h20-1-66" id="h20-1-66" class="i">+                                Some(std::cmp::Ordering::Equal) =&gt; {}
</a><a href="#h20-1-67" id="h20-1-67" class="i">+                                Some(o) =&gt; {
</a><a href="#h20-1-68" id="h20-1-68" class="i">+                                    return if *order == Direction::Ascending {
</a><a href="#h20-1-69" id="h20-1-69" class="i">+                                        o
</a><a href="#h20-1-70" id="h20-1-70" class="i">+                                    } else {
</a><a href="#h20-1-71" id="h20-1-71" class="i">+                                        o.reverse()
</a><a href="#h20-1-72" id="h20-1-72" class="i">+                                    }
</a><a href="#h20-1-73" id="h20-1-73" class="i">+                                }
</a><a href="#h20-1-74" id="h20-1-74" class="i">+                                None =&gt; {}
</a><a href="#h20-1-75" id="h20-1-75" class="i">+                            }
</a><a href="#h20-1-76" id="h20-1-76" class="i">+                        }
</a><a href="#h20-1-77" id="h20-1-77" class="i">+                        std::cmp::Ordering::Equal
</a><a href="#h20-1-78" id="h20-1-78" class="i">+                    });
</a><a href="#h20-1-79" id="h20-1-79" class="i">+
</a><a href="#h20-1-80" id="h20-1-80" class="i">+                    relation.rows = Some(Box::new(items.into_iter().map(|i| Ok(i.row))));
</a><a href="#h20-1-81" id="h20-1-81" class="i">+                }
</a><a href="#h20-1-82" id="h20-1-82" class="i">+                Ok(ResultSet::Query { relation })
</a><a href="#h20-1-83" id="h20-1-83" class="i">+            }
</a><a href="#h20-1-84" id="h20-1-84" class="i">+            r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
</a>         }
<a href="#h20-1-86" id="h20-1-86" class="d">-        Ok(result)
</a>     }
 }
<b>diff --git a/<a id="h21" href="../file/src/sql/executor/projection.rs.html">src/sql/executor/projection.rs</a> b/<a href="../file/src/sql/executor/projection.rs.html">src/sql/executor/projection.rs</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,5 +1,8 @@
</a> use super::super::engine::Transaction;
<a href="#h21-0-1" id="h21-0-1" class="d">-use super::super::types::expression::{Expression, Expressions};
</a><a href="#h21-0-2" id="h21-0-2" class="i">+use super::super::types::{
</a><a href="#h21-0-3" id="h21-0-3" class="i">+    expression::{Expression, Expressions},
</a><a href="#h21-0-4" id="h21-0-4" class="i">+    Column, Relation,
</a><a href="#h21-0-5" id="h21-0-5" class="i">+};
</a> use super::{Context, Executor, ResultColumns, ResultSet};
 use crate::Error;
 
<a href="#h21-1" id="h21-1" class="h">@@ -25,40 +28,46 @@ impl&lt;T: Transaction&gt; Projection&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Projection&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h21-1-3" id="h21-1-3" class="d">-        let mut result = self.source.execute(ctx)?;
</a><a href="#h21-1-4" id="h21-1-4" class="d">-        let columns = result.columns;
</a><a href="#h21-1-5" id="h21-1-5" class="d">-        let labels = self.labels;
</a><a href="#h21-1-6" id="h21-1-6" class="d">-        result.columns = ResultColumns::new(
</a><a href="#h21-1-7" id="h21-1-7" class="d">-            self.expressions
</a><a href="#h21-1-8" id="h21-1-8" class="d">-                .iter()
</a><a href="#h21-1-9" id="h21-1-9" class="d">-                .enumerate()
</a><a href="#h21-1-10" id="h21-1-10" class="d">-                .map(|(i, e)| {
</a><a href="#h21-1-11" id="h21-1-11" class="d">-                    Ok(if let Some(Some(label)) = labels.get(i) {
</a><a href="#h21-1-12" id="h21-1-12" class="d">-                        (None, Some(label.clone()))
</a><a href="#h21-1-13" id="h21-1-13" class="d">-                    } else if let Expression::Field(relation, field) = e {
</a><a href="#h21-1-14" id="h21-1-14" class="d">-                        let (r, f) = columns.get(relation.as_deref(), field)?;
</a><a href="#h21-1-15" id="h21-1-15" class="d">-                        (r, Some(f))
</a><a href="#h21-1-16" id="h21-1-16" class="d">-                    } else if let Expression::Column(i) = e {
</a><a href="#h21-1-17" id="h21-1-17" class="d">-                        let (r, f) = columns.columns[*i].clone(); // FIXME Should have method for this
</a><a href="#h21-1-18" id="h21-1-18" class="d">-                        (r, f)
</a><a href="#h21-1-19" id="h21-1-19" class="d">-                    } else {
</a><a href="#h21-1-20" id="h21-1-20" class="d">-                        (None, None)
</a><a href="#h21-1-21" id="h21-1-21" class="d">-                    })
</a><a href="#h21-1-22" id="h21-1-22" class="d">-                })
</a><a href="#h21-1-23" id="h21-1-23" class="d">-                .collect::&lt;Result&lt;Vec&lt;_&gt;, Error&gt;&gt;()?,
</a><a href="#h21-1-24" id="h21-1-24" class="d">-        );
</a><a href="#h21-1-25" id="h21-1-25" class="d">-        if let Some(rows) = result.rows {
</a><a href="#h21-1-26" id="h21-1-26" class="d">-            let expressions = self.expressions;
</a><a href="#h21-1-27" id="h21-1-27" class="d">-            result.rows = Some(Box::new(rows.map(move |r| {
</a><a href="#h21-1-28" id="h21-1-28" class="d">-                r.and_then(|row| {
</a><a href="#h21-1-29" id="h21-1-29" class="d">-                    let env = columns.as_env(&amp;row);
</a><a href="#h21-1-30" id="h21-1-30" class="d">-                    Ok(expressions
</a><a href="#h21-1-31" id="h21-1-31" class="i">+        match self.source.execute(ctx)? {
</a><a href="#h21-1-32" id="h21-1-32" class="i">+            ResultSet::Query { relation } =&gt; {
</a><a href="#h21-1-33" id="h21-1-33" class="i">+                let labels = self.labels;
</a><a href="#h21-1-34" id="h21-1-34" class="i">+                let columns = ResultColumns::from_new_columns(relation.columns);
</a><a href="#h21-1-35" id="h21-1-35" class="i">+                let mut projection = Relation {
</a><a href="#h21-1-36" id="h21-1-36" class="i">+                    columns: self
</a><a href="#h21-1-37" id="h21-1-37" class="i">+                        .expressions
</a>                         .iter()
<a href="#h21-1-39" id="h21-1-39" class="d">-                        .map(|e| e.evaluate(&amp;env))
</a><a href="#h21-1-40" id="h21-1-40" class="d">-                        .collect::&lt;Result&lt;_, Error&gt;&gt;()?)
</a><a href="#h21-1-41" id="h21-1-41" class="d">-                })
</a><a href="#h21-1-42" id="h21-1-42" class="d">-            })));
</a><a href="#h21-1-43" id="h21-1-43" class="i">+                        .enumerate()
</a><a href="#h21-1-44" id="h21-1-44" class="i">+                        .map(|(i, e)| {
</a><a href="#h21-1-45" id="h21-1-45" class="i">+                            Ok(if let Some(Some(label)) = labels.get(i) {
</a><a href="#h21-1-46" id="h21-1-46" class="i">+                                Column { relation: None, name: Some(label.clone()) }
</a><a href="#h21-1-47" id="h21-1-47" class="i">+                            } else if let Expression::Field(relation, field) = e {
</a><a href="#h21-1-48" id="h21-1-48" class="i">+                                let (r, f) = columns.get(relation.as_deref(), field)?;
</a><a href="#h21-1-49" id="h21-1-49" class="i">+                                Column { relation: r, name: Some(f) }
</a><a href="#h21-1-50" id="h21-1-50" class="i">+                            } else if let Expression::Column(i) = e {
</a><a href="#h21-1-51" id="h21-1-51" class="i">+                                let (r, f) = columns.columns[*i].clone(); // FIXME Should have method for this
</a><a href="#h21-1-52" id="h21-1-52" class="i">+                                Column { relation: r, name: f }
</a><a href="#h21-1-53" id="h21-1-53" class="i">+                            } else {
</a><a href="#h21-1-54" id="h21-1-54" class="i">+                                Column { relation: None, name: None }
</a><a href="#h21-1-55" id="h21-1-55" class="i">+                            })
</a><a href="#h21-1-56" id="h21-1-56" class="i">+                        })
</a><a href="#h21-1-57" id="h21-1-57" class="i">+                        .collect::&lt;Result&lt;Vec&lt;_&gt;, Error&gt;&gt;()?,
</a><a href="#h21-1-58" id="h21-1-58" class="i">+                    rows: None,
</a><a href="#h21-1-59" id="h21-1-59" class="i">+                };
</a><a href="#h21-1-60" id="h21-1-60" class="i">+                if let Some(rows) = relation.rows {
</a><a href="#h21-1-61" id="h21-1-61" class="i">+                    let expressions = self.expressions;
</a><a href="#h21-1-62" id="h21-1-62" class="i">+                    projection.rows = Some(Box::new(rows.map(move |r| {
</a><a href="#h21-1-63" id="h21-1-63" class="i">+                        r.and_then(|row| {
</a><a href="#h21-1-64" id="h21-1-64" class="i">+                            let env = columns.as_env(&amp;row);
</a><a href="#h21-1-65" id="h21-1-65" class="i">+                            Ok(expressions
</a><a href="#h21-1-66" id="h21-1-66" class="i">+                                .iter()
</a><a href="#h21-1-67" id="h21-1-67" class="i">+                                .map(|e| e.evaluate(&amp;env))
</a><a href="#h21-1-68" id="h21-1-68" class="i">+                                .collect::&lt;Result&lt;_, Error&gt;&gt;()?)
</a><a href="#h21-1-69" id="h21-1-69" class="i">+                        })
</a><a href="#h21-1-70" id="h21-1-70" class="i">+                    })));
</a><a href="#h21-1-71" id="h21-1-71" class="i">+                }
</a><a href="#h21-1-72" id="h21-1-72" class="i">+                Ok(ResultSet::Query { relation: projection })
</a><a href="#h21-1-73" id="h21-1-73" class="i">+            }
</a><a href="#h21-1-74" id="h21-1-74" class="i">+            r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
</a>         }
<a href="#h21-1-76" id="h21-1-76" class="d">-        Ok(result)
</a>     }
 }
<b>diff --git a/<a id="h22" href="../file/src/sql/executor/scan.rs.html">src/sql/executor/scan.rs</a> b/<a href="../file/src/sql/executor/scan.rs.html">src/sql/executor/scan.rs</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,5 +1,6 @@
</a> use super::super::engine::Transaction;
<a href="#h22-0-1" id="h22-0-1" class="d">-use super::{Context, Executor, ResultColumns, ResultSet};
</a><a href="#h22-0-2" id="h22-0-2" class="i">+use super::super::types::{Column, Relation};
</a><a href="#h22-0-3" id="h22-0-3" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 /// A table scan executor
<a href="#h22-1" id="h22-1" class="h">@@ -20,11 +21,15 @@ impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Scan {
</a>     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
         let table = ctx.txn.must_read_table(&amp;self.table)?;
         let name = if let Some(alias) = &amp;self.alias { alias } else { &amp;table.name };
<a href="#h22-1-3" id="h22-1-3" class="d">-        let columns = ResultColumns::new(
</a><a href="#h22-1-4" id="h22-1-4" class="d">-            table.columns.iter().map(|c| (Some(name.clone()), Some(c.name.clone()))).collect(),
</a><a href="#h22-1-5" id="h22-1-5" class="d">-        );
</a><a href="#h22-1-6" id="h22-1-6" class="d">-        let rows = ctx.txn.scan(&amp;table.name)?;
</a><a href="#h22-1-7" id="h22-1-7" class="d">-        // FIXME We use extra Box to cast to ResultRows iterator (apparently)
</a><a href="#h22-1-8" id="h22-1-8" class="d">-        Ok(ResultSet::from_rows(columns, Box::new(rows)))
</a><a href="#h22-1-9" id="h22-1-9" class="i">+        Ok(ResultSet::Query {
</a><a href="#h22-1-10" id="h22-1-10" class="i">+            relation: Relation {
</a><a href="#h22-1-11" id="h22-1-11" class="i">+                columns: table
</a><a href="#h22-1-12" id="h22-1-12" class="i">+                    .columns
</a><a href="#h22-1-13" id="h22-1-13" class="i">+                    .iter()
</a><a href="#h22-1-14" id="h22-1-14" class="i">+                    .map(|c| Column { relation: Some(name.clone()), name: Some(c.name.clone()) })
</a><a href="#h22-1-15" id="h22-1-15" class="i">+                    .collect(),
</a><a href="#h22-1-16" id="h22-1-16" class="i">+                rows: Some(Box::new(ctx.txn.scan(&amp;table.name)?)),
</a><a href="#h22-1-17" id="h22-1-17" class="i">+            },
</a><a href="#h22-1-18" id="h22-1-18" class="i">+        })
</a>     }
 }
<b>diff --git a/<a id="h23" href="../file/src/sql/executor/update.rs.html">src/sql/executor/update.rs</a> b/<a href="../file/src/sql/executor/update.rs.html">src/sql/executor/update.rs</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -1,6 +1,6 @@
</a> use super::super::engine::Transaction;
 use super::super::types::expression::Expression;
<a href="#h23-0-2" id="h23-0-2" class="d">-use super::{Context, Effect, Executor, ResultSet};
</a><a href="#h23-0-3" id="h23-0-3" class="i">+use super::{Context, Executor, ResultSet};
</a> use crate::Error;
 
 use std::collections::BTreeMap;
<a href="#h23-1" id="h23-1" class="h">@@ -28,18 +28,22 @@ impl&lt;T: Transaction&gt; Update&lt;T&gt; {
</a> 
 impl&lt;T: Transaction&gt; Executor&lt;T&gt; for Update&lt;T&gt; {
     fn execute(self: Box&lt;Self&gt;, ctx: &amp;mut Context&lt;T&gt;) -&gt; Result&lt;ResultSet, Error&gt; {
<a href="#h23-1-3" id="h23-1-3" class="d">-        let mut source = self.source.execute(ctx)?;
</a><a href="#h23-1-4" id="h23-1-4" class="d">-        let table = ctx.txn.must_read_table(&amp;self.table)?;
</a><a href="#h23-1-5" id="h23-1-5" class="d">-        let mut count = 0;
</a><a href="#h23-1-6" id="h23-1-6" class="d">-        while let Some(mut row) = source.next().transpose()? {
</a><a href="#h23-1-7" id="h23-1-7" class="d">-            let id = table.get_row_key(&amp;row)?;
</a><a href="#h23-1-8" id="h23-1-8" class="d">-            let env = table.make_row_hashmap(row.clone());
</a><a href="#h23-1-9" id="h23-1-9" class="d">-            for (field, expr) in &amp;self.expressions {
</a><a href="#h23-1-10" id="h23-1-10" class="d">-                table.set_row_field(&amp;mut row, field, expr.evaluate(&amp;env)?)?;
</a><a href="#h23-1-11" id="h23-1-11" class="i">+        match self.source.execute(ctx)? {
</a><a href="#h23-1-12" id="h23-1-12" class="i">+            ResultSet::Query { mut relation } =&gt; {
</a><a href="#h23-1-13" id="h23-1-13" class="i">+                let table = ctx.txn.must_read_table(&amp;self.table)?;
</a><a href="#h23-1-14" id="h23-1-14" class="i">+                let mut count = 0;
</a><a href="#h23-1-15" id="h23-1-15" class="i">+                while let Some(mut row) = relation.next().transpose()? {
</a><a href="#h23-1-16" id="h23-1-16" class="i">+                    let id = table.get_row_key(&amp;row)?;
</a><a href="#h23-1-17" id="h23-1-17" class="i">+                    let env = table.make_row_hashmap(row.clone());
</a><a href="#h23-1-18" id="h23-1-18" class="i">+                    for (field, expr) in &amp;self.expressions {
</a><a href="#h23-1-19" id="h23-1-19" class="i">+                        table.set_row_field(&amp;mut row, field, expr.evaluate(&amp;env)?)?;
</a><a href="#h23-1-20" id="h23-1-20" class="i">+                    }
</a><a href="#h23-1-21" id="h23-1-21" class="i">+                    ctx.txn.update(&amp;table.name, &amp;id, row)?;
</a><a href="#h23-1-22" id="h23-1-22" class="i">+                    count += 1
</a><a href="#h23-1-23" id="h23-1-23" class="i">+                }
</a><a href="#h23-1-24" id="h23-1-24" class="i">+                Ok(ResultSet::Update { count })
</a>             }
<a href="#h23-1-26" id="h23-1-26" class="d">-            ctx.txn.update(&amp;table.name, &amp;id, row)?;
</a><a href="#h23-1-27" id="h23-1-27" class="d">-            count += 1
</a><a href="#h23-1-28" id="h23-1-28" class="i">+            r =&gt; Err(Error::Internal(format!(&quot;Unexpected response {:?}&quot;, r))),
</a>         }
<a href="#h23-1-30" id="h23-1-30" class="d">-        Ok(ResultSet::from_effect(Effect::Update { count }))
</a>     }
 }
<b>diff --git a/<a id="h24" href="../file/src/sql/mod.rs.html">src/sql/mod.rs</a> b/<a href="../file/src/sql/mod.rs.html">src/sql/mod.rs</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -8,7 +8,7 @@ mod tests;
</a> pub mod types;
 
 pub use engine::{Engine, Mode, Transaction};
<a href="#h24-0-3" id="h24-0-3" class="d">-pub use executor::{Context, Effect, ResultColumns, ResultSet};
</a><a href="#h24-0-4" id="h24-0-4" class="i">+pub use executor::{Context, ResultColumns, ResultSet};
</a> pub use parser::{ast, lexer, Parser};
 pub use planner::Plan;
<a href="#h24-0-7" id="h24-0-7" class="d">-pub use types::{schema::Table, Row, Value};
</a><a href="#h24-0-8" id="h24-0-8" class="i">+pub use types::{schema::Table, Relation, Row, Rows, Value};
</a><b>diff --git a/<a id="h25" href="../file/src/sql/tests/dml.rs.html">src/sql/tests/dml.rs</a> b/<a href="../file/src/sql/tests/dml.rs.html">src/sql/tests/dml.rs</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -23,11 +23,7 @@ macro_rules! test_dml {
</a>                 write!(f, &quot;Query: {}\n&quot;, $query.trim())?;
                 match engine.session(None)?.execute($query) {
                     Ok(resultset) =&gt; {
<a href="#h25-0-3" id="h25-0-3" class="d">-                        write!(f, &quot;Effect:&quot;)?;
</a><a href="#h25-0-4" id="h25-0-4" class="d">-                        if let Some(effect) = resultset.effect() {
</a><a href="#h25-0-5" id="h25-0-5" class="d">-                            write!(f, &quot; {:?}&quot;, effect)?;
</a><a href="#h25-0-6" id="h25-0-6" class="d">-                        }
</a><a href="#h25-0-7" id="h25-0-7" class="d">-                        write!(f, &quot;\n\n&quot;)?;
</a><a href="#h25-0-8" id="h25-0-8" class="i">+                        write!(f, &quot;Result: {:?}\n\n&quot;, resultset)?;
</a>                     },
                     Err(err) =&gt; write!(f, &quot;Error: {:?}\n\n&quot;, err)?,
                 };
<b>diff --git a/<a id="h26" href="../file/src/sql/tests/dml/delete_all.html">src/sql/tests/dml/delete_all</a> b/<a href="../file/src/sql/tests/dml/delete_all.html">src/sql/tests/dml/delete_all</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test
<a href="#h26-0-1" id="h26-0-1" class="d">-Effect: Delete { count: 3 }
</a><a href="#h26-0-2" id="h26-0-2" class="i">+Result: Delete { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h27" href="../file/src/sql/tests/dml/delete_case.html">src/sql/tests/dml/delete_case</a> b/<a href="../file/src/sql/tests/dml/delete_case.html">src/sql/tests/dml/delete_case</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM TeSt WHERE ID = 1
<a href="#h27-0-1" id="h27-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h27-0-2" id="h27-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h28" href="../file/src/sql/tests/dml/delete_where.html">src/sql/tests/dml/delete_where</a> b/<a href="../file/src/sql/tests/dml/delete_where.html">src/sql/tests/dml/delete_where</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE id = 1
<a href="#h28-0-1" id="h28-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h28-0-2" id="h28-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h29" href="../file/src/sql/tests/dml/delete_where_and.html">src/sql/tests/dml/delete_where_and</a> b/<a href="../file/src/sql/tests/dml/delete_where_and.html">src/sql/tests/dml/delete_where_and</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE id = 1 AND name = &#39;a&#39;
<a href="#h29-0-1" id="h29-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h29-0-2" id="h29-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h30" href="../file/src/sql/tests/dml/delete_where_expr.html">src/sql/tests/dml/delete_where_expr</a> b/<a href="../file/src/sql/tests/dml/delete_where_expr.html">src/sql/tests/dml/delete_where_expr</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE id = 3 - 2 AND name LIKE &#39;a%&#39;
<a href="#h30-0-1" id="h30-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h30-0-2" id="h30-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h31" href="../file/src/sql/tests/dml/delete_where_false.html">src/sql/tests/dml/delete_where_false</a> b/<a href="../file/src/sql/tests/dml/delete_where_false.html">src/sql/tests/dml/delete_where_false</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE FALSE
<a href="#h31-0-1" id="h31-0-1" class="d">-Effect: Delete { count: 0 }
</a><a href="#h31-0-2" id="h31-0-2" class="i">+Result: Delete { count: 0 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h32" href="../file/src/sql/tests/dml/delete_where_null.html">src/sql/tests/dml/delete_where_null</a> b/<a href="../file/src/sql/tests/dml/delete_where_null.html">src/sql/tests/dml/delete_where_null</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE NULL
<a href="#h32-0-1" id="h32-0-1" class="d">-Effect: Delete { count: 0 }
</a><a href="#h32-0-2" id="h32-0-2" class="i">+Result: Delete { count: 0 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h33" href="../file/src/sql/tests/dml/delete_where_true.html">src/sql/tests/dml/delete_where_true</a> b/<a href="../file/src/sql/tests/dml/delete_where_true.html">src/sql/tests/dml/delete_where_true</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM test WHERE TRUE
<a href="#h33-0-1" id="h33-0-1" class="d">-Effect: Delete { count: 3 }
</a><a href="#h33-0-2" id="h33-0-2" class="i">+Result: Delete { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h34" href="../file/src/sql/tests/dml/insert_case.html">src/sql/tests/dml/insert_case</a> b/<a href="../file/src/sql/tests/dml/insert_case.html">src/sql/tests/dml/insert_case</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO TeSt (ID, Name) VALUES (1, &#39;a&#39;)
<a href="#h34-0-1" id="h34-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h34-0-2" id="h34-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h35" href="../file/src/sql/tests/dml/insert_expression.html">src/sql/tests/dml/insert_expression</a> b/<a href="../file/src/sql/tests/dml/insert_expression.html">src/sql/tests/dml/insert_expression</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 1 + 2 * 3)
<a href="#h35-0-1" id="h35-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h35-0-2" id="h35-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h36" href="../file/src/sql/tests/dml/insert_full.html">src/sql/tests/dml/insert_full</a> b/<a href="../file/src/sql/tests/dml/insert_full.html">src/sql/tests/dml/insert_full</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 101)
<a href="#h36-0-1" id="h36-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h36-0-2" id="h36-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h37" href="../file/src/sql/tests/dml/insert_full_multiple.html">src/sql/tests/dml/insert_full_multiple</a> b/<a href="../file/src/sql/tests/dml/insert_full_multiple.html">src/sql/tests/dml/insert_full_multiple</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (id, name, value) VALUES (1, &#39;a&#39;, 101), (2, &#39;b&#39;, 102), (3, &#39;c&#39;, 103)
<a href="#h37-0-1" id="h37-0-1" class="d">-Effect: Create { count: 3 }
</a><a href="#h37-0-2" id="h37-0-2" class="i">+Result: Create { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h38" href="../file/src/sql/tests/dml/insert_full_order.html">src/sql/tests/dml/insert_full_order</a> b/<a href="../file/src/sql/tests/dml/insert_full_order.html">src/sql/tests/dml/insert_full_order</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test (name, value, id) VALUES (&#39;a&#39;, 101, 1)
<a href="#h38-0-1" id="h38-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h38-0-2" id="h38-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h39" href="../file/src/sql/tests/dml/insert_no_columns.html">src/sql/tests/dml/insert_no_columns</a> b/<a href="../file/src/sql/tests/dml/insert_no_columns.html">src/sql/tests/dml/insert_no_columns</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 101)
<a href="#h39-0-1" id="h39-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h39-0-2" id="h39-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h40" href="../file/src/sql/tests/dml/insert_no_columns_multiple.html">src/sql/tests/dml/insert_no_columns_multiple</a> b/<a href="../file/src/sql/tests/dml/insert_no_columns_multiple.html">src/sql/tests/dml/insert_no_columns_multiple</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 101), (2, &#39;b&#39;, 102), (3, &#39;c&#39;, 103)
<a href="#h40-0-1" id="h40-0-1" class="d">-Effect: Create { count: 3 }
</a><a href="#h40-0-2" id="h40-0-2" class="i">+Result: Create { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h41" href="../file/src/sql/tests/dml/insert_partial.html">src/sql/tests/dml/insert_partial</a> b/<a href="../file/src/sql/tests/dml/insert_partial.html">src/sql/tests/dml/insert_partial</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;)
<a href="#h41-0-1" id="h41-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h41-0-2" id="h41-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h42" href="../file/src/sql/tests/dml/insert_partial_vary.html">src/sql/tests/dml/insert_partial_vary</a> b/<a href="../file/src/sql/tests/dml/insert_partial_vary.html">src/sql/tests/dml/insert_partial_vary</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO test VALUES (1, &#39;a&#39;, 100), (2, &#39;b&#39;), (3)
<a href="#h42-0-1" id="h42-0-1" class="d">-Effect: Create { count: 3 }
</a><a href="#h42-0-2" id="h42-0-2" class="i">+Result: Create { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h43" href="../file/src/sql/tests/dml/update_all.html">src/sql/tests/dml/update_all</a> b/<a href="../file/src/sql/tests/dml/update_all.html">src/sql/tests/dml/update_all</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39;, value = 999
<a href="#h43-0-1" id="h43-0-1" class="d">-Effect: Update { count: 3 }
</a><a href="#h43-0-2" id="h43-0-2" class="i">+Result: Update { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h44" href="../file/src/sql/tests/dml/update_case.html">src/sql/tests/dml/update_case</a> b/<a href="../file/src/sql/tests/dml/update_case.html">src/sql/tests/dml/update_case</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE TeSt SET Name = &#39;x&#39; WHERE ID = 1
<a href="#h44-0-1" id="h44-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h44-0-2" id="h44-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h45" href="../file/src/sql/tests/dml/update_where.html">src/sql/tests/dml/update_where</a> b/<a href="../file/src/sql/tests/dml/update_where.html">src/sql/tests/dml/update_where</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE id = 1
<a href="#h45-0-1" id="h45-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h45-0-2" id="h45-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h46" href="../file/src/sql/tests/dml/update_where_and.html">src/sql/tests/dml/update_where_and</a> b/<a href="../file/src/sql/tests/dml/update_where_and.html">src/sql/tests/dml/update_where_and</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE id = 1 AND name = &#39;a&#39;
<a href="#h46-0-1" id="h46-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h46-0-2" id="h46-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h47" href="../file/src/sql/tests/dml/update_where_expr.html">src/sql/tests/dml/update_where_expr</a> b/<a href="../file/src/sql/tests/dml/update_where_expr.html">src/sql/tests/dml/update_where_expr</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE id = 3 - 2 AND name LIKE &#39;a%&#39;
<a href="#h47-0-1" id="h47-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h47-0-2" id="h47-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h48" href="../file/src/sql/tests/dml/update_where_false.html">src/sql/tests/dml/update_where_false</a> b/<a href="../file/src/sql/tests/dml/update_where_false.html">src/sql/tests/dml/update_where_false</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE FALSE
<a href="#h48-0-1" id="h48-0-1" class="d">-Effect: Update { count: 0 }
</a><a href="#h48-0-2" id="h48-0-2" class="i">+Result: Update { count: 0 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h49" href="../file/src/sql/tests/dml/update_where_full.html">src/sql/tests/dml/update_where_full</a> b/<a href="../file/src/sql/tests/dml/update_where_full.html">src/sql/tests/dml/update_where_full</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET id = 9, name = &#39;x&#39;, value = 999 WHERE id = 1
<a href="#h49-0-1" id="h49-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h49-0-2" id="h49-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h50" href="../file/src/sql/tests/dml/update_where_null.html">src/sql/tests/dml/update_where_null</a> b/<a href="../file/src/sql/tests/dml/update_where_null.html">src/sql/tests/dml/update_where_null</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE NULL
<a href="#h50-0-1" id="h50-0-1" class="d">-Effect: Update { count: 0 }
</a><a href="#h50-0-2" id="h50-0-2" class="i">+Result: Update { count: 0 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h51" href="../file/src/sql/tests/dml/update_where_true.html">src/sql/tests/dml/update_where_true</a> b/<a href="../file/src/sql/tests/dml/update_where_true.html">src/sql/tests/dml/update_where_true</a></b>
<a href="#h51-0" id="h51-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET name = &#39;x&#39; WHERE TRUE
<a href="#h51-0-1" id="h51-0-1" class="d">-Effect: Update { count: 3 }
</a><a href="#h51-0-2" id="h51-0-2" class="i">+Result: Update { count: 3 }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h52" href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a> b/<a href="../file/src/sql/tests/expression.rs.html">src/sql/tests/expression.rs</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -1,13 +1,16 @@
</a> ///! Evaluates SQL expressions and compares with expectations.
 use super::super::types::Value;
<a href="#h52-0-2" id="h52-0-2" class="d">-use super::super::Engine;
</a><a href="#h52-0-3" id="h52-0-3" class="i">+use super::super::{Engine, ResultSet};
</a> use crate::Error;
 
 fn eval_expr(expr: &amp;str) -&gt; Result&lt;Value, Error&gt; {
     let engine = super::setup(Vec::new())?;
<a href="#h52-0-8" id="h52-0-8" class="d">-    let mut result = engine.session(None)?.execute(&amp;format!(&quot;SELECT {}&quot;, expr))?;
</a><a href="#h52-0-9" id="h52-0-9" class="d">-    let value = result.next().unwrap().unwrap().get(0).unwrap().clone();
</a><a href="#h52-0-10" id="h52-0-10" class="d">-    Ok(value)
</a><a href="#h52-0-11" id="h52-0-11" class="i">+    match engine.session(None)?.execute(&amp;format!(&quot;SELECT {}&quot;, expr))? {
</a><a href="#h52-0-12" id="h52-0-12" class="i">+        ResultSet::Query { mut relation } =&gt; {
</a><a href="#h52-0-13" id="h52-0-13" class="i">+            Ok(relation.next().unwrap().unwrap().get(0).unwrap().clone())
</a><a href="#h52-0-14" id="h52-0-14" class="i">+        }
</a><a href="#h52-0-15" id="h52-0-15" class="i">+        r =&gt; Err(Error::Internal(format!(&quot;Unexpected result {:?}&quot;, r))),
</a><a href="#h52-0-16" id="h52-0-16" class="i">+    }
</a> }
 
 macro_rules! test_expr {
<b>diff --git a/<a id="h53" href="../file/src/sql/tests/query.rs.html">src/sql/tests/query.rs</a> b/<a href="../file/src/sql/tests/query.rs.html">src/sql/tests/query.rs</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -1,7 +1,7 @@
</a> ///! Tests for the SQL query engine. Runs SQL queries against an in-memory database,
 ///! and compares the results with golden files stored under src/sql/tests/results/
 use super::super::types::Row;
<a href="#h53-0-3" id="h53-0-3" class="d">-use super::super::{Context, Engine, Parser, Plan, Transaction};
</a><a href="#h53-0-4" id="h53-0-4" class="i">+use super::super::{Context, Engine, Parser, Plan, ResultSet, Transaction};
</a> use crate::Error;
 use goldenfile::Mint;
 use std::io::Write;
<a href="#h53-1" id="h53-1" class="h">@@ -115,27 +115,29 @@ macro_rules! test_query {
</a>                 }
             };
             txn.commit()?;
<a href="#h53-1-3" id="h53-1-3" class="d">-            let columns = result.columns();
</a><a href="#h53-1-4" id="h53-1-4" class="d">-            let rows: Vec&lt;Row&gt; = match result.collect() {
</a><a href="#h53-1-5" id="h53-1-5" class="d">-                Ok(rows) =&gt; rows,
</a><a href="#h53-1-6" id="h53-1-6" class="d">-                Err(err) =&gt; {
</a><a href="#h53-1-7" id="h53-1-7" class="d">-                    write!(f, &quot; {:?}&quot;, err)?;
</a><a href="#h53-1-8" id="h53-1-8" class="d">-                    return Ok(())
</a><a href="#h53-1-9" id="h53-1-9" class="i">+            if let ResultSet::Query{relation} = result {
</a><a href="#h53-1-10" id="h53-1-10" class="i">+                let columns = relation.columns.clone();
</a><a href="#h53-1-11" id="h53-1-11" class="i">+                let rows: Vec&lt;Row&gt; = match relation.collect() {
</a><a href="#h53-1-12" id="h53-1-12" class="i">+                    Ok(rows) =&gt; rows,
</a><a href="#h53-1-13" id="h53-1-13" class="i">+                    Err(err) =&gt; {
</a><a href="#h53-1-14" id="h53-1-14" class="i">+                        write!(f, &quot; {:?}&quot;, err)?;
</a><a href="#h53-1-15" id="h53-1-15" class="i">+                        return Ok(())
</a><a href="#h53-1-16" id="h53-1-16" class="i">+                    }
</a><a href="#h53-1-17" id="h53-1-17" class="i">+                };
</a><a href="#h53-1-18" id="h53-1-18" class="i">+                if !columns.is_empty() || !rows.is_empty() {
</a><a href="#h53-1-19" id="h53-1-19" class="i">+                    write!(f, &quot; {:?}\n&quot;, columns
</a><a href="#h53-1-20" id="h53-1-20" class="i">+                        .into_iter()
</a><a href="#h53-1-21" id="h53-1-21" class="i">+                        .map(|c| c.name.unwrap_or_else(|| &quot;?&quot;.to_string()))
</a><a href="#h53-1-22" id="h53-1-22" class="i">+                        .collect::&lt;Vec&lt;_&gt;&gt;())?;
</a><a href="#h53-1-23" id="h53-1-23" class="i">+                    for row in rows {
</a><a href="#h53-1-24" id="h53-1-24" class="i">+                        write!(f, &quot;{:?}\n&quot;, row)?;
</a><a href="#h53-1-25" id="h53-1-25" class="i">+                    }
</a><a href="#h53-1-26" id="h53-1-26" class="i">+                } else {
</a><a href="#h53-1-27" id="h53-1-27" class="i">+                    write!(f, &quot; &lt;none&gt;\n&quot;)?;
</a>                 }
<a href="#h53-1-29" id="h53-1-29" class="d">-            };
</a><a href="#h53-1-30" id="h53-1-30" class="d">-            if !columns.is_empty() || !rows.is_empty() {
</a><a href="#h53-1-31" id="h53-1-31" class="d">-                write!(f, &quot; {:?}\n&quot;, columns
</a><a href="#h53-1-32" id="h53-1-32" class="d">-                    .into_iter()
</a><a href="#h53-1-33" id="h53-1-33" class="d">-                    .map(|c| c.unwrap_or_else(|| &quot;?&quot;.to_string()))
</a><a href="#h53-1-34" id="h53-1-34" class="d">-                    .collect::&lt;Vec&lt;_&gt;&gt;())?;
</a><a href="#h53-1-35" id="h53-1-35" class="d">-                for row in rows {
</a><a href="#h53-1-36" id="h53-1-36" class="d">-                    write!(f, &quot;{:?}\n&quot;, row)?;
</a><a href="#h53-1-37" id="h53-1-37" class="d">-                }
</a><a href="#h53-1-38" id="h53-1-38" class="d">-            } else {
</a><a href="#h53-1-39" id="h53-1-39" class="d">-                write!(f, &quot; &lt;none&gt;\n&quot;)?;
</a><a href="#h53-1-40" id="h53-1-40" class="i">+                return Ok(())
</a>             }
<a href="#h53-1-42" id="h53-1-42" class="d">-
</a><a href="#h53-1-43" id="h53-1-43" class="d">-            Ok(())
</a><a href="#h53-1-44" id="h53-1-44" class="i">+            Err(Error::Internal(&quot;Unexpected result&quot;.into()))
</a>         }
     )*
     }
<b>diff --git a/<a id="h54" href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a> b/<a href="../file/src/sql/tests/schema.rs.html">src/sql/tests/schema.rs</a></b>
<a href="#h54-0" id="h54-0" class="h">@@ -21,13 +21,7 @@ macro_rules! test_schema {
</a> 
                 write!(f, &quot;Query: {}\n&quot;, $query.trim())?;
                 match engine.session(None)?.execute($query) {
<a href="#h54-0-3" id="h54-0-3" class="d">-                    Ok(resultset) =&gt; {
</a><a href="#h54-0-4" id="h54-0-4" class="d">-                        write!(f, &quot;Effect:&quot;)?;
</a><a href="#h54-0-5" id="h54-0-5" class="d">-                        if let Some(effect) = resultset.effect() {
</a><a href="#h54-0-6" id="h54-0-6" class="d">-                            write!(f, &quot; {:?}&quot;, effect)?;
</a><a href="#h54-0-7" id="h54-0-7" class="d">-                        }
</a><a href="#h54-0-8" id="h54-0-8" class="d">-                        write!(f, &quot;\n\n&quot;)?;
</a><a href="#h54-0-9" id="h54-0-9" class="d">-                    },
</a><a href="#h54-0-10" id="h54-0-10" class="i">+                    Ok(result) =&gt; write!(f, &quot;Result: {:?}\n\n&quot;, result)?,
</a>                     Err(err) =&gt; write!(f, &quot;Error: {:?}\n\n&quot;, err)?,
                 };
 
<b>diff --git a/<a id="h55" href="../file/src/sql/tests/schema/create_table_datatype.html">src/sql/tests/schema/create_table_datatype</a> b/<a href="../file/src/sql/tests/schema/create_table_datatype.html">src/sql/tests/schema/create_table_datatype</a></b>
<a href="#h55-0" id="h55-0" class="h">@@ -11,7 +11,7 @@ Query: CREATE TABLE name (
</a>             &quot;text&quot; TEXT,
             &quot;varchar&quot; VARCHAR
         )
<a href="#h55-0-3" id="h55-0-3" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h55-0-4" id="h55-0-4" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h56" href="../file/src/sql/tests/schema/create_table_default_boolean.html">src/sql/tests/schema/create_table_default_boolean</a> b/<a href="../file/src/sql/tests/schema/create_table_default_boolean.html">src/sql/tests/schema/create_table_default_boolean</a></b>
<a href="#h56-0" id="h56-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value BOOLEAN DEFAULT TRUE)
<a href="#h56-0-1" id="h56-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h56-0-2" id="h56-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h57" href="../file/src/sql/tests/schema/create_table_default_expr.html">src/sql/tests/schema/create_table_default_expr</a> b/<a href="../file/src/sql/tests/schema/create_table_default_expr.html">src/sql/tests/schema/create_table_default_expr</a></b>
<a href="#h57-0" id="h57-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value INTEGER DEFAULT 1 + 2 * 3)
<a href="#h57-0-1" id="h57-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h57-0-2" id="h57-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h58" href="../file/src/sql/tests/schema/create_table_default_float.html">src/sql/tests/schema/create_table_default_float</a> b/<a href="../file/src/sql/tests/schema/create_table_default_float.html">src/sql/tests/schema/create_table_default_float</a></b>
<a href="#h58-0" id="h58-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value FLOAT DEFAULT 3.14)
<a href="#h58-0-1" id="h58-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h58-0-2" id="h58-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h59" href="../file/src/sql/tests/schema/create_table_default_integer.html">src/sql/tests/schema/create_table_default_integer</a> b/<a href="../file/src/sql/tests/schema/create_table_default_integer.html">src/sql/tests/schema/create_table_default_integer</a></b>
<a href="#h59-0" id="h59-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value INTEGER DEFAULT 7)
<a href="#h59-0-1" id="h59-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h59-0-2" id="h59-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h60" href="../file/src/sql/tests/schema/create_table_default_null.html">src/sql/tests/schema/create_table_default_null</a> b/<a href="../file/src/sql/tests/schema/create_table_default_null.html">src/sql/tests/schema/create_table_default_null</a></b>
<a href="#h60-0" id="h60-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT NULL)
<a href="#h60-0-1" id="h60-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h60-0-2" id="h60-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h61" href="../file/src/sql/tests/schema/create_table_default_string.html">src/sql/tests/schema/create_table_default_string</a> b/<a href="../file/src/sql/tests/schema/create_table_default_string.html">src/sql/tests/schema/create_table_default_string</a></b>
<a href="#h61-0" id="h61-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT &#39;foo&#39;)
<a href="#h61-0-1" id="h61-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h61-0-2" id="h61-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h62" href="../file/src/sql/tests/schema/create_table_name_alphanumeric.html">src/sql/tests/schema/create_table_name_alphanumeric</a> b/<a href="../file/src/sql/tests/schema/create_table_name_alphanumeric.html">src/sql/tests/schema/create_table_name_alphanumeric</a></b>
<a href="#h62-0" id="h62-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE a_123 (id INTEGER PRIMARY KEY)
<a href="#h62-0-1" id="h62-0-1" class="d">-Effect: CreateTable { name: &quot;a_123&quot; }
</a><a href="#h62-0-2" id="h62-0-2" class="i">+Result: CreateTable { name: &quot;a_123&quot; }
</a> 
 Storage:
 CREATE TABLE a_123 (
<b>diff --git a/<a id="h63" href="../file/src/sql/tests/schema/create_table_name_case.html">src/sql/tests/schema/create_table_name_case</a> b/<a href="../file/src/sql/tests/schema/create_table_name_case.html">src/sql/tests/schema/create_table_name_case</a></b>
<a href="#h63-0" id="h63-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE mIxEd_cAsE ( STRING PRIMARY KEY)
<a href="#h63-0-1" id="h63-0-1" class="d">-Effect: CreateTable { name: &quot;mixed_case&quot; }
</a><a href="#h63-0-2" id="h63-0-2" class="i">+Result: CreateTable { name: &quot;mixed_case&quot; }
</a> 
 Storage:
 CREATE TABLE mixed_case (
<b>diff --git a/<a id="h64" href="../file/src/sql/tests/schema/create_table_name_emoji_quoted.html">src/sql/tests/schema/create_table_name_emoji_quoted</a> b/<a href="../file/src/sql/tests/schema/create_table_name_emoji_quoted.html">src/sql/tests/schema/create_table_name_emoji_quoted</a></b>
<a href="#h64-0" id="h64-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE &quot;&quot; (&quot;&quot; INTEGER PRIMARY KEY)
<a href="#h64-0-1" id="h64-0-1" class="d">-Effect: CreateTable { name: &quot;&quot; }
</a><a href="#h64-0-2" id="h64-0-2" class="i">+Result: CreateTable { name: &quot;&quot; }
</a> 
 Storage:
 CREATE TABLE &quot;&quot; (
<b>diff --git a/<a id="h65" href="../file/src/sql/tests/schema/create_table_name_japanese.html">src/sql/tests/schema/create_table_name_japanese</a> b/<a href="../file/src/sql/tests/schema/create_table_name_japanese.html">src/sql/tests/schema/create_table_name_japanese</a></b>
<a href="#h65-0" id="h65-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE  ( INTEGER PRIMARY KEY,  STRING)
<a href="#h65-0-1" id="h65-0-1" class="d">-Effect: CreateTable { name: &quot;&quot; }
</a><a href="#h65-0-2" id="h65-0-2" class="i">+Result: CreateTable { name: &quot;&quot; }
</a> 
 Storage:
 CREATE TABLE  (
<b>diff --git a/<a id="h66" href="../file/src/sql/tests/schema/create_table_name_keyword_quoted.html">src/sql/tests/schema/create_table_name_keyword_quoted</a> b/<a href="../file/src/sql/tests/schema/create_table_name_keyword_quoted.html">src/sql/tests/schema/create_table_name_keyword_quoted</a></b>
<a href="#h66-0" id="h66-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE &quot;table&quot; (id INTEGER PRIMARY KEY)
<a href="#h66-0-1" id="h66-0-1" class="d">-Effect: CreateTable { name: &quot;table&quot; }
</a><a href="#h66-0-2" id="h66-0-2" class="i">+Result: CreateTable { name: &quot;table&quot; }
</a> 
 Storage:
 CREATE TABLE &quot;table&quot; (
<b>diff --git a/<a id="h67" href="../file/src/sql/tests/schema/create_table_name_quote_double.html">src/sql/tests/schema/create_table_name_quote_double</a> b/<a href="../file/src/sql/tests/schema/create_table_name_quote_double.html">src/sql/tests/schema/create_table_name_quote_double</a></b>
<a href="#h67-0" id="h67-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE &quot;name&quot; (id INTEGER PRIMARY KEY)
<a href="#h67-0-1" id="h67-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h67-0-2" id="h67-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h68" href="../file/src/sql/tests/schema/create_table_name_quote_double_escaped.html">src/sql/tests/schema/create_table_name_quote_double_escaped</a> b/<a href="../file/src/sql/tests/schema/create_table_name_quote_double_escaped.html">src/sql/tests/schema/create_table_name_quote_double_escaped</a></b>
<a href="#h68-0" id="h68-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE &quot;name with &quot;&quot; quote&quot; (id INTEGER PRIMARY KEY)
<a href="#h68-0-1" id="h68-0-1" class="d">-Effect: CreateTable { name: &quot;name with \&quot; quote&quot; }
</a><a href="#h68-0-2" id="h68-0-2" class="i">+Result: CreateTable { name: &quot;name with \&quot; quote&quot; }
</a> 
 Storage:
 CREATE TABLE &quot;name with &quot;&quot; quote&quot; (
<b>diff --git a/<a id="h69" href="../file/src/sql/tests/schema/create_table_name_quote_double_single.html">src/sql/tests/schema/create_table_name_quote_double_single</a> b/<a href="../file/src/sql/tests/schema/create_table_name_quote_double_single.html">src/sql/tests/schema/create_table_name_quote_double_single</a></b>
<a href="#h69-0" id="h69-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE &quot;name with &#39; quote&quot; (id INTEGER PRIMARY KEY)
<a href="#h69-0-1" id="h69-0-1" class="d">-Effect: CreateTable { name: &quot;name with \&#39; quote&quot; }
</a><a href="#h69-0-2" id="h69-0-2" class="i">+Result: CreateTable { name: &quot;name with \&#39; quote&quot; }
</a> 
 Storage:
 CREATE TABLE &quot;name with &#39; quote&quot; (
<b>diff --git a/<a id="h70" href="../file/src/sql/tests/schema/create_table_null.html">src/sql/tests/schema/create_table_null</a> b/<a href="../file/src/sql/tests/schema/create_table_null.html">src/sql/tests/schema/create_table_null</a></b>
<a href="#h70-0" id="h70-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NULL)
<a href="#h70-0-1" id="h70-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h70-0-2" id="h70-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h71" href="../file/src/sql/tests/schema/create_table_null_default.html">src/sql/tests/schema/create_table_null_default</a> b/<a href="../file/src/sql/tests/schema/create_table_null_default.html">src/sql/tests/schema/create_table_null_default</a></b>
<a href="#h71-0" id="h71-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING)
<a href="#h71-0-1" id="h71-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h71-0-2" id="h71-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h72" href="../file/src/sql/tests/schema/create_table_null_not.html">src/sql/tests/schema/create_table_null_not</a> b/<a href="../file/src/sql/tests/schema/create_table_null_not.html">src/sql/tests/schema/create_table_null_not</a></b>
<a href="#h72-0" id="h72-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NOT NULL)
<a href="#h72-0-1" id="h72-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h72-0-2" id="h72-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h73" href="../file/src/sql/tests/schema/create_table_pk_default.html">src/sql/tests/schema/create_table_pk_default</a> b/<a href="../file/src/sql/tests/schema/create_table_pk_default.html">src/sql/tests/schema/create_table_pk_default</a></b>
<a href="#h73-0" id="h73-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY DEFAULT 1)
<a href="#h73-0-1" id="h73-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h73-0-2" id="h73-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h74" href="../file/src/sql/tests/schema/create_table_pk_unique.html">src/sql/tests/schema/create_table_pk_unique</a> b/<a href="../file/src/sql/tests/schema/create_table_pk_unique.html">src/sql/tests/schema/create_table_pk_unique</a></b>
<a href="#h74-0" id="h74-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY UNIQUE)
<a href="#h74-0-1" id="h74-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h74-0-2" id="h74-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h75" href="../file/src/sql/tests/schema/create_table_ref.html">src/sql/tests/schema/create_table_ref</a> b/<a href="../file/src/sql/tests/schema/create_table_ref.html">src/sql/tests/schema/create_table_ref</a></b>
<a href="#h75-0" id="h75-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE other (id INTEGER PRIMARY KEY, test_id INTEGER REFERENCES test)
<a href="#h75-0-1" id="h75-0-1" class="d">-Effect: CreateTable { name: &quot;other&quot; }
</a><a href="#h75-0-2" id="h75-0-2" class="i">+Result: CreateTable { name: &quot;other&quot; }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h76" href="../file/src/sql/tests/schema/create_table_ref_multiple.html">src/sql/tests/schema/create_table_ref_multiple</a> b/<a href="../file/src/sql/tests/schema/create_table_ref_multiple.html">src/sql/tests/schema/create_table_ref_multiple</a></b>
<a href="#h76-0" id="h76-0" class="h">@@ -4,7 +4,7 @@ Query: CREATE TABLE other (
</a>         test_id_b INTEGER REFERENCES test,
         test_id_c INTEGER REFERENCES test
     )
<a href="#h76-0-3" id="h76-0-3" class="d">-Effect: CreateTable { name: &quot;other&quot; }
</a><a href="#h76-0-4" id="h76-0-4" class="i">+Result: CreateTable { name: &quot;other&quot; }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h77" href="../file/src/sql/tests/schema/create_table_ref_self.html">src/sql/tests/schema/create_table_ref_self</a> b/<a href="../file/src/sql/tests/schema/create_table_ref_self.html">src/sql/tests/schema/create_table_ref_self</a></b>
<a href="#h77-0" id="h77-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE other (id INTEGER PRIMARY KEY, self_id INTEGER REFERENCES other)
<a href="#h77-0-1" id="h77-0-1" class="d">-Effect: CreateTable { name: &quot;other&quot; }
</a><a href="#h77-0-2" id="h77-0-2" class="i">+Result: CreateTable { name: &quot;other&quot; }
</a> 
 Storage:
 CREATE TABLE other (
<b>diff --git a/<a id="h78" href="../file/src/sql/tests/schema/create_table_unique.html">src/sql/tests/schema/create_table_unique</a> b/<a href="../file/src/sql/tests/schema/create_table_unique.html">src/sql/tests/schema/create_table_unique</a></b>
<a href="#h78-0" id="h78-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING UNIQUE)
<a href="#h78-0-1" id="h78-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h78-0-2" id="h78-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h79" href="../file/src/sql/tests/schema/create_table_unique_default.html">src/sql/tests/schema/create_table_unique_default</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_default.html">src/sql/tests/schema/create_table_unique_default</a></b>
<a href="#h79-0" id="h79-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING DEFAULT &#39;foo&#39; UNIQUE)
<a href="#h79-0-1" id="h79-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h79-0-2" id="h79-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h80" href="../file/src/sql/tests/schema/create_table_unique_not_null.html">src/sql/tests/schema/create_table_unique_not_null</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_not_null.html">src/sql/tests/schema/create_table_unique_not_null</a></b>
<a href="#h80-0" id="h80-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NOT NULL UNIQUE)
<a href="#h80-0-1" id="h80-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h80-0-2" id="h80-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h81" href="../file/src/sql/tests/schema/create_table_unique_null.html">src/sql/tests/schema/create_table_unique_null</a> b/<a href="../file/src/sql/tests/schema/create_table_unique_null.html">src/sql/tests/schema/create_table_unique_null</a></b>
<a href="#h81-0" id="h81-0" class="h">@@ -1,5 +1,5 @@
</a> Query: CREATE TABLE name (id INTEGER PRIMARY KEY, value STRING NULL UNIQUE)
<a href="#h81-0-1" id="h81-0-1" class="d">-Effect: CreateTable { name: &quot;name&quot; }
</a><a href="#h81-0-2" id="h81-0-2" class="i">+Result: CreateTable { name: &quot;name&quot; }
</a> 
 Storage:
 CREATE TABLE name (
<b>diff --git a/<a id="h82" href="../file/src/sql/tests/schema/delete_ref_noref.html">src/sql/tests/schema/delete_ref_noref</a> b/<a href="../file/src/sql/tests/schema/delete_ref_noref.html">src/sql/tests/schema/delete_ref_noref</a></b>
<a href="#h82-0" id="h82-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM target WHERE id = 3
<a href="#h82-0-1" id="h82-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h82-0-2" id="h82-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h83" href="../file/src/sql/tests/schema/delete_ref_self.html">src/sql/tests/schema/delete_ref_self</a> b/<a href="../file/src/sql/tests/schema/delete_ref_self.html">src/sql/tests/schema/delete_ref_self</a></b>
<a href="#h83-0" id="h83-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM self WHERE id = 3
<a href="#h83-0-1" id="h83-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h83-0-2" id="h83-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h84" href="../file/src/sql/tests/schema/delete_ref_source.html">src/sql/tests/schema/delete_ref_source</a> b/<a href="../file/src/sql/tests/schema/delete_ref_source.html">src/sql/tests/schema/delete_ref_source</a></b>
<a href="#h84-0" id="h84-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DELETE FROM source WHERE id = 1
<a href="#h84-0-1" id="h84-0-1" class="d">-Effect: Delete { count: 1 }
</a><a href="#h84-0-2" id="h84-0-2" class="i">+Result: Delete { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h85" href="../file/src/sql/tests/schema/drop_table.html">src/sql/tests/schema/drop_table</a> b/<a href="../file/src/sql/tests/schema/drop_table.html">src/sql/tests/schema/drop_table</a></b>
<a href="#h85-0" id="h85-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE a
<a href="#h85-0-1" id="h85-0-1" class="d">-Effect: DropTable { name: &quot;a&quot; }
</a><a href="#h85-0-2" id="h85-0-2" class="i">+Result: DropTable { name: &quot;a&quot; }
</a> 
 Storage:
 CREATE TABLE b (
<b>diff --git a/<a id="h86" href="../file/src/sql/tests/schema/drop_table_ref_self.html">src/sql/tests/schema/drop_table_ref_self</a> b/<a href="../file/src/sql/tests/schema/drop_table_ref_self.html">src/sql/tests/schema/drop_table_ref_self</a></b>
<a href="#h86-0" id="h86-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE self
<a href="#h86-0-1" id="h86-0-1" class="d">-Effect: DropTable { name: &quot;self&quot; }
</a><a href="#h86-0-2" id="h86-0-2" class="i">+Result: DropTable { name: &quot;self&quot; }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h87" href="../file/src/sql/tests/schema/drop_table_ref_source.html">src/sql/tests/schema/drop_table_ref_source</a> b/<a href="../file/src/sql/tests/schema/drop_table_ref_source.html">src/sql/tests/schema/drop_table_ref_source</a></b>
<a href="#h87-0" id="h87-0" class="h">@@ -1,5 +1,5 @@
</a> Query: DROP TABLE source
<a href="#h87-0-1" id="h87-0-1" class="d">-Effect: DropTable { name: &quot;source&quot; }
</a><a href="#h87-0-2" id="h87-0-2" class="i">+Result: DropTable { name: &quot;source&quot; }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h88" href="../file/src/sql/tests/schema/insert_boolean_false.html">src/sql/tests/schema/insert_boolean_false</a> b/<a href="../file/src/sql/tests/schema/insert_boolean_false.html">src/sql/tests/schema/insert_boolean_false</a></b>
<a href="#h88-0" id="h88-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, FALSE)
<a href="#h88-0-1" id="h88-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h88-0-2" id="h88-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h89" href="../file/src/sql/tests/schema/insert_boolean_null.html">src/sql/tests/schema/insert_boolean_null</a> b/<a href="../file/src/sql/tests/schema/insert_boolean_null.html">src/sql/tests/schema/insert_boolean_null</a></b>
<a href="#h89-0" id="h89-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, NULL)
<a href="#h89-0-1" id="h89-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h89-0-2" id="h89-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h90" href="../file/src/sql/tests/schema/insert_boolean_true.html">src/sql/tests/schema/insert_boolean_true</a> b/<a href="../file/src/sql/tests/schema/insert_boolean_true.html">src/sql/tests/schema/insert_boolean_true</a></b>
<a href="#h90-0" id="h90-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;boolean&quot;) VALUES (0, TRUE)
<a href="#h90-0-1" id="h90-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h90-0-2" id="h90-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h91" href="../file/src/sql/tests/schema/insert_default.html">src/sql/tests/schema/insert_default</a> b/<a href="../file/src/sql/tests/schema/insert_default.html">src/sql/tests/schema/insert_default</a></b>
<a href="#h91-0" id="h91-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults (id, required) VALUES (1, TRUE)
<a href="#h91-0-1" id="h91-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h91-0-2" id="h91-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h92" href="../file/src/sql/tests/schema/insert_default_override.html">src/sql/tests/schema/insert_default_override</a> b/<a href="../file/src/sql/tests/schema/insert_default_override.html">src/sql/tests/schema/insert_default_override</a></b>
<a href="#h92-0" id="h92-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE, TRUE, FALSE, 2.718, 3, &#39;bar&#39;)
<a href="#h92-0-1" id="h92-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h92-0-2" id="h92-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h93" href="../file/src/sql/tests/schema/insert_default_override_null.html">src/sql/tests/schema/insert_default_override_null</a> b/<a href="../file/src/sql/tests/schema/insert_default_override_null.html">src/sql/tests/schema/insert_default_override_null</a></b>
<a href="#h93-0" id="h93-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE, NULL, NULL, NULL, NULL, NULL)
<a href="#h93-0-1" id="h93-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h93-0-2" id="h93-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h94" href="../file/src/sql/tests/schema/insert_default_unnamed.html">src/sql/tests/schema/insert_default_unnamed</a> b/<a href="../file/src/sql/tests/schema/insert_default_unnamed.html">src/sql/tests/schema/insert_default_unnamed</a></b>
<a href="#h94-0" id="h94-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO defaults VALUES (1, TRUE)
<a href="#h94-0-1" id="h94-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h94-0-2" id="h94-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE defaults (
<b>diff --git a/<a id="h95" href="../file/src/sql/tests/schema/insert_float.html">src/sql/tests/schema/insert_float</a> b/<a href="../file/src/sql/tests/schema/insert_float.html">src/sql/tests/schema/insert_float</a></b>
<a href="#h95-0" id="h95-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 3.14)
<a href="#h95-0-1" id="h95-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h95-0-2" id="h95-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h96" href="../file/src/sql/tests/schema/insert_float_infinity.html">src/sql/tests/schema/insert_float_infinity</a> b/<a href="../file/src/sql/tests/schema/insert_float_infinity.html">src/sql/tests/schema/insert_float_infinity</a></b>
<a href="#h96-0" id="h96-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, INFINITY)
<a href="#h96-0-1" id="h96-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h96-0-2" id="h96-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h97" href="../file/src/sql/tests/schema/insert_float_infinity_negative.html">src/sql/tests/schema/insert_float_infinity_negative</a> b/<a href="../file/src/sql/tests/schema/insert_float_infinity_negative.html">src/sql/tests/schema/insert_float_infinity_negative</a></b>
<a href="#h97-0" id="h97-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -INFINITY)
<a href="#h97-0-1" id="h97-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h97-0-2" id="h97-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h98" href="../file/src/sql/tests/schema/insert_float_max.html">src/sql/tests/schema/insert_float_max</a> b/<a href="../file/src/sql/tests/schema/insert_float_max.html">src/sql/tests/schema/insert_float_max</a></b>
<a href="#h98-0" id="h98-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e308)
<a href="#h98-0-1" id="h98-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h98-0-2" id="h98-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h99" href="../file/src/sql/tests/schema/insert_float_max_negative.html">src/sql/tests/schema/insert_float_max_negative</a> b/<a href="../file/src/sql/tests/schema/insert_float_max_negative.html">src/sql/tests/schema/insert_float_max_negative</a></b>
<a href="#h99-0" id="h99-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -1.23456789012345e308)
<a href="#h99-0-1" id="h99-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h99-0-2" id="h99-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h100" href="../file/src/sql/tests/schema/insert_float_min.html">src/sql/tests/schema/insert_float_min</a> b/<a href="../file/src/sql/tests/schema/insert_float_min.html">src/sql/tests/schema/insert_float_min</a></b>
<a href="#h100-0" id="h100-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e-307)
<a href="#h100-0-1" id="h100-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h100-0-2" id="h100-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h101" href="../file/src/sql/tests/schema/insert_float_min_negative.html">src/sql/tests/schema/insert_float_min_negative</a> b/<a href="../file/src/sql/tests/schema/insert_float_min_negative.html">src/sql/tests/schema/insert_float_min_negative</a></b>
<a href="#h101-0" id="h101-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, -1.23456789012345e-307)
<a href="#h101-0-1" id="h101-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h101-0-2" id="h101-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h102" href="../file/src/sql/tests/schema/insert_float_min_round.html">src/sql/tests/schema/insert_float_min_round</a> b/<a href="../file/src/sql/tests/schema/insert_float_min_round.html">src/sql/tests/schema/insert_float_min_round</a></b>
<a href="#h102-0" id="h102-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, 1.23456789012345e-323)
<a href="#h102-0-1" id="h102-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h102-0-2" id="h102-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h103" href="../file/src/sql/tests/schema/insert_float_nan.html">src/sql/tests/schema/insert_float_nan</a> b/<a href="../file/src/sql/tests/schema/insert_float_nan.html">src/sql/tests/schema/insert_float_nan</a></b>
<a href="#h103-0" id="h103-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, NAN)
<a href="#h103-0-1" id="h103-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h103-0-2" id="h103-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h104" href="../file/src/sql/tests/schema/insert_float_null.html">src/sql/tests/schema/insert_float_null</a> b/<a href="../file/src/sql/tests/schema/insert_float_null.html">src/sql/tests/schema/insert_float_null</a></b>
<a href="#h104-0" id="h104-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;float&quot;) VALUES (0, NULL)
<a href="#h104-0-1" id="h104-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h104-0-2" id="h104-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h105" href="../file/src/sql/tests/schema/insert_integer.html">src/sql/tests/schema/insert_integer</a> b/<a href="../file/src/sql/tests/schema/insert_integer.html">src/sql/tests/schema/insert_integer</a></b>
<a href="#h105-0" id="h105-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, 1)
<a href="#h105-0-1" id="h105-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h105-0-2" id="h105-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h106" href="../file/src/sql/tests/schema/insert_integer_max.html">src/sql/tests/schema/insert_integer_max</a> b/<a href="../file/src/sql/tests/schema/insert_integer_max.html">src/sql/tests/schema/insert_integer_max</a></b>
<a href="#h106-0" id="h106-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, 9223372036854775807)
<a href="#h106-0-1" id="h106-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h106-0-2" id="h106-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h107" href="../file/src/sql/tests/schema/insert_integer_min.html">src/sql/tests/schema/insert_integer_min</a> b/<a href="../file/src/sql/tests/schema/insert_integer_min.html">src/sql/tests/schema/insert_integer_min</a></b>
<a href="#h107-0" id="h107-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, -9223372036854775807)
<a href="#h107-0-1" id="h107-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h107-0-2" id="h107-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h108" href="../file/src/sql/tests/schema/insert_integer_null.html">src/sql/tests/schema/insert_integer_null</a> b/<a href="../file/src/sql/tests/schema/insert_integer_null.html">src/sql/tests/schema/insert_integer_null</a></b>
<a href="#h108-0" id="h108-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;integer&quot;) VALUES (0, NULL)
<a href="#h108-0-1" id="h108-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h108-0-2" id="h108-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h109" href="../file/src/sql/tests/schema/insert_nulls.html">src/sql/tests/schema/insert_nulls</a> b/<a href="../file/src/sql/tests/schema/insert_nulls.html">src/sql/tests/schema/insert_nulls</a></b>
<a href="#h109-0" id="h109-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO nulls (id, &quot;null&quot;, not_null, &quot;default&quot;) VALUES (1, NULL, TRUE, NULL)
<a href="#h109-0-1" id="h109-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h109-0-2" id="h109-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE nulls (
<b>diff --git a/<a id="h110" href="../file/src/sql/tests/schema/insert_nulls_default.html">src/sql/tests/schema/insert_nulls_default</a> b/<a href="../file/src/sql/tests/schema/insert_nulls_default.html">src/sql/tests/schema/insert_nulls_default</a></b>
<a href="#h110-0" id="h110-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO nulls (id, &quot;null&quot;, not_null) VALUES (1, NULL, TRUE)
<a href="#h110-0-1" id="h110-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h110-0-2" id="h110-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE nulls (
<b>diff --git a/<a id="h111" href="../file/src/sql/tests/schema/insert_pk_boolean.html">src/sql/tests/schema/insert_pk_boolean</a> b/<a href="../file/src/sql/tests/schema/insert_pk_boolean.html">src/sql/tests/schema/insert_pk_boolean</a></b>
<a href="#h111-0" id="h111-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;boolean&quot; VALUES (TRUE)
<a href="#h111-0-1" id="h111-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h111-0-2" id="h111-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;boolean&quot; (
<b>diff --git a/<a id="h112" href="../file/src/sql/tests/schema/insert_pk_float.html">src/sql/tests/schema/insert_pk_float</a> b/<a href="../file/src/sql/tests/schema/insert_pk_float.html">src/sql/tests/schema/insert_pk_float</a></b>
<a href="#h112-0" id="h112-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (1.618)
<a href="#h112-0-1" id="h112-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h112-0-2" id="h112-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h113" href="../file/src/sql/tests/schema/insert_pk_float_negative.html">src/sql/tests/schema/insert_pk_float_negative</a> b/<a href="../file/src/sql/tests/schema/insert_pk_float_negative.html">src/sql/tests/schema/insert_pk_float_negative</a></b>
<a href="#h113-0" id="h113-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (-3.14)
<a href="#h113-0-1" id="h113-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h113-0-2" id="h113-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h114" href="../file/src/sql/tests/schema/insert_pk_float_zero.html">src/sql/tests/schema/insert_pk_float_zero</a> b/<a href="../file/src/sql/tests/schema/insert_pk_float_zero.html">src/sql/tests/schema/insert_pk_float_zero</a></b>
<a href="#h114-0" id="h114-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;float&quot; VALUES (0.0)
<a href="#h114-0-1" id="h114-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h114-0-2" id="h114-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h115" href="../file/src/sql/tests/schema/insert_pk_integer.html">src/sql/tests/schema/insert_pk_integer</a> b/<a href="../file/src/sql/tests/schema/insert_pk_integer.html">src/sql/tests/schema/insert_pk_integer</a></b>
<a href="#h115-0" id="h115-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (3)
<a href="#h115-0-1" id="h115-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h115-0-2" id="h115-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h116" href="../file/src/sql/tests/schema/insert_pk_integer_negative.html">src/sql/tests/schema/insert_pk_integer_negative</a> b/<a href="../file/src/sql/tests/schema/insert_pk_integer_negative.html">src/sql/tests/schema/insert_pk_integer_negative</a></b>
<a href="#h116-0" id="h116-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (-1)
<a href="#h116-0-1" id="h116-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h116-0-2" id="h116-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h117" href="../file/src/sql/tests/schema/insert_pk_integer_zero.html">src/sql/tests/schema/insert_pk_integer_zero</a> b/<a href="../file/src/sql/tests/schema/insert_pk_integer_zero.html">src/sql/tests/schema/insert_pk_integer_zero</a></b>
<a href="#h117-0" id="h117-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;integer&quot; VALUES (0)
<a href="#h117-0-1" id="h117-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h117-0-2" id="h117-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h118" href="../file/src/sql/tests/schema/insert_pk_string.html">src/sql/tests/schema/insert_pk_string</a> b/<a href="../file/src/sql/tests/schema/insert_pk_string.html">src/sql/tests/schema/insert_pk_string</a></b>
<a href="#h118-0" id="h118-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;baz&#39;)
<a href="#h118-0-1" id="h118-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h118-0-2" id="h118-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h119" href="../file/src/sql/tests/schema/insert_pk_string_case.html">src/sql/tests/schema/insert_pk_string_case</a> b/<a href="../file/src/sql/tests/schema/insert_pk_string_case.html">src/sql/tests/schema/insert_pk_string_case</a></b>
<a href="#h119-0" id="h119-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;Foo&#39;)
<a href="#h119-0-1" id="h119-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h119-0-2" id="h119-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h120" href="../file/src/sql/tests/schema/insert_pk_string_empty.html">src/sql/tests/schema/insert_pk_string_empty</a> b/<a href="../file/src/sql/tests/schema/insert_pk_string_empty.html">src/sql/tests/schema/insert_pk_string_empty</a></b>
<a href="#h120-0" id="h120-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;string&quot; VALUES (&#39;&#39;)
<a href="#h120-0-1" id="h120-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h120-0-2" id="h120-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h121" href="../file/src/sql/tests/schema/insert_ref_boolean.html">src/sql/tests/schema/insert_ref_boolean</a> b/<a href="../file/src/sql/tests/schema/insert_ref_boolean.html">src/sql/tests/schema/insert_ref_boolean</a></b>
<a href="#h121-0" id="h121-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, TRUE)
<a href="#h121-0-1" id="h121-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h121-0-2" id="h121-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h122" href="../file/src/sql/tests/schema/insert_ref_boolean_null.html">src/sql/tests/schema/insert_ref_boolean_null</a> b/<a href="../file/src/sql/tests/schema/insert_ref_boolean_null.html">src/sql/tests/schema/insert_ref_boolean_null</a></b>
<a href="#h122-0" id="h122-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h122-0-1" id="h122-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h122-0-2" id="h122-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h123" href="../file/src/sql/tests/schema/insert_ref_float.html">src/sql/tests/schema/insert_ref_float</a> b/<a href="../file/src/sql/tests/schema/insert_ref_float.html">src/sql/tests/schema/insert_ref_float</a></b>
<a href="#h123-0" id="h123-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, 3.14)
<a href="#h123-0-1" id="h123-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h123-0-2" id="h123-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h124" href="../file/src/sql/tests/schema/insert_ref_float_null.html">src/sql/tests/schema/insert_ref_float_null</a> b/<a href="../file/src/sql/tests/schema/insert_ref_float_null.html">src/sql/tests/schema/insert_ref_float_null</a></b>
<a href="#h124-0" id="h124-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h124-0-1" id="h124-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h124-0-2" id="h124-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h125" href="../file/src/sql/tests/schema/insert_ref_integer.html">src/sql/tests/schema/insert_ref_integer</a> b/<a href="../file/src/sql/tests/schema/insert_ref_integer.html">src/sql/tests/schema/insert_ref_integer</a></b>
<a href="#h125-0" id="h125-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, 1)
<a href="#h125-0-1" id="h125-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h125-0-2" id="h125-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h126" href="../file/src/sql/tests/schema/insert_ref_integer_null.html">src/sql/tests/schema/insert_ref_integer_null</a> b/<a href="../file/src/sql/tests/schema/insert_ref_integer_null.html">src/sql/tests/schema/insert_ref_integer_null</a></b>
<a href="#h126-0" id="h126-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h126-0-1" id="h126-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h126-0-2" id="h126-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h127" href="../file/src/sql/tests/schema/insert_ref_self.html">src/sql/tests/schema/insert_ref_self</a> b/<a href="../file/src/sql/tests/schema/insert_ref_self.html">src/sql/tests/schema/insert_ref_self</a></b>
<a href="#h127-0" id="h127-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, 1, &#39;e&#39;)
<a href="#h127-0-1" id="h127-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h127-0-2" id="h127-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h128" href="../file/src/sql/tests/schema/insert_ref_self_null.html">src/sql/tests/schema/insert_ref_self_null</a> b/<a href="../file/src/sql/tests/schema/insert_ref_self_null.html">src/sql/tests/schema/insert_ref_self_null</a></b>
<a href="#h128-0" id="h128-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, NULL, &#39;e&#39;)
<a href="#h128-0-1" id="h128-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h128-0-2" id="h128-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h129" href="../file/src/sql/tests/schema/insert_ref_self_self.html">src/sql/tests/schema/insert_ref_self_self</a> b/<a href="../file/src/sql/tests/schema/insert_ref_self_self.html">src/sql/tests/schema/insert_ref_self_self</a></b>
<a href="#h129-0" id="h129-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO self VALUES (5, 5, &#39;e&#39;)
<a href="#h129-0-1" id="h129-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h129-0-2" id="h129-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h130" href="../file/src/sql/tests/schema/insert_ref_string.html">src/sql/tests/schema/insert_ref_string</a> b/<a href="../file/src/sql/tests/schema/insert_ref_string.html">src/sql/tests/schema/insert_ref_string</a></b>
<a href="#h130-0" id="h130-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, &#39;foo&#39;)
<a href="#h130-0-1" id="h130-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h130-0-2" id="h130-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h131" href="../file/src/sql/tests/schema/insert_ref_string_null.html">src/sql/tests/schema/insert_ref_string_null</a> b/<a href="../file/src/sql/tests/schema/insert_ref_string_null.html">src/sql/tests/schema/insert_ref_string_null</a></b>
<a href="#h131-0" id="h131-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO source VALUES (1, NULL)
<a href="#h131-0-1" id="h131-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h131-0-2" id="h131-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h132" href="../file/src/sql/tests/schema/insert_string.html">src/sql/tests/schema/insert_string</a> b/<a href="../file/src/sql/tests/schema/insert_string.html">src/sql/tests/schema/insert_string</a></b>
<a href="#h132-0" id="h132-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;abc&#39;)
<a href="#h132-0-1" id="h132-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h132-0-2" id="h132-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h133" href="../file/src/sql/tests/schema/insert_string_1024.html">src/sql/tests/schema/insert_string_1024</a> b/<a href="../file/src/sql/tests/schema/insert_string_1024.html">src/sql/tests/schema/insert_string_1024</a></b>
<a href="#h133-0" id="h133-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;)
<a href="#h133-0-1" id="h133-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h133-0-2" id="h133-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h134" href="../file/src/sql/tests/schema/insert_string_1024_unicode.html">src/sql/tests/schema/insert_string_1024_unicode</a> b/<a href="../file/src/sql/tests/schema/insert_string_1024_unicode.html">src/sql/tests/schema/insert_string_1024_unicode</a></b>
<a href="#h134-0" id="h134-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;&#39;)
<a href="#h134-0-1" id="h134-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h134-0-2" id="h134-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h135" href="../file/src/sql/tests/schema/insert_string_empty.html">src/sql/tests/schema/insert_string_empty</a> b/<a href="../file/src/sql/tests/schema/insert_string_empty.html">src/sql/tests/schema/insert_string_empty</a></b>
<a href="#h135-0" id="h135-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39;&#39;)
<a href="#h135-0-1" id="h135-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h135-0-2" id="h135-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h136" href="../file/src/sql/tests/schema/insert_string_null.html">src/sql/tests/schema/insert_string_null</a> b/<a href="../file/src/sql/tests/schema/insert_string_null.html">src/sql/tests/schema/insert_string_null</a></b>
<a href="#h136-0" id="h136-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, NULL)
<a href="#h136-0-1" id="h136-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h136-0-2" id="h136-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h137" href="../file/src/sql/tests/schema/insert_string_unicode.html">src/sql/tests/schema/insert_string_unicode</a> b/<a href="../file/src/sql/tests/schema/insert_string_unicode.html">src/sql/tests/schema/insert_string_unicode</a></b>
<a href="#h137-0" id="h137-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO types (id, &quot;string&quot;) VALUES (0, &#39; Hi! &#39;)
<a href="#h137-0-1" id="h137-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h137-0-2" id="h137-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE types (
<b>diff --git a/<a id="h138" href="../file/src/sql/tests/schema/insert_unique_boolean.html">src/sql/tests/schema/insert_unique_boolean</a> b/<a href="../file/src/sql/tests/schema/insert_unique_boolean.html">src/sql/tests/schema/insert_unique_boolean</a></b>
<a href="#h138-0" id="h138-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;boolean&quot;) VALUES (2, FALSE)
<a href="#h138-0-1" id="h138-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h138-0-2" id="h138-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h139" href="../file/src/sql/tests/schema/insert_unique_float.html">src/sql/tests/schema/insert_unique_float</a> b/<a href="../file/src/sql/tests/schema/insert_unique_float.html">src/sql/tests/schema/insert_unique_float</a></b>
<a href="#h139-0" id="h139-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;float&quot;) VALUES (2, 2.718)
<a href="#h139-0-1" id="h139-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h139-0-2" id="h139-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h140" href="../file/src/sql/tests/schema/insert_unique_integer.html">src/sql/tests/schema/insert_unique_integer</a> b/<a href="../file/src/sql/tests/schema/insert_unique_integer.html">src/sql/tests/schema/insert_unique_integer</a></b>
<a href="#h140-0" id="h140-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;integer&quot;) VALUES (2, 3)
<a href="#h140-0-1" id="h140-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h140-0-2" id="h140-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h141" href="../file/src/sql/tests/schema/insert_unique_nulls.html">src/sql/tests/schema/insert_unique_nulls</a> b/<a href="../file/src/sql/tests/schema/insert_unique_nulls.html">src/sql/tests/schema/insert_unique_nulls</a></b>
<a href="#h141-0" id="h141-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; VALUES (2, NULL, NULL, NULL, NULL)
<a href="#h141-0-1" id="h141-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h141-0-2" id="h141-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h142" href="../file/src/sql/tests/schema/insert_unique_string.html">src/sql/tests/schema/insert_unique_string</a> b/<a href="../file/src/sql/tests/schema/insert_unique_string.html">src/sql/tests/schema/insert_unique_string</a></b>
<a href="#h142-0" id="h142-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;bar&#39;)
<a href="#h142-0-1" id="h142-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h142-0-2" id="h142-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h143" href="../file/src/sql/tests/schema/insert_unique_string_case.html">src/sql/tests/schema/insert_unique_string_case</a> b/<a href="../file/src/sql/tests/schema/insert_unique_string_case.html">src/sql/tests/schema/insert_unique_string_case</a></b>
<a href="#h143-0" id="h143-0" class="h">@@ -1,5 +1,5 @@
</a> Query: INSERT INTO &quot;unique&quot; (id, &quot;string&quot;) VALUES (2, &#39;Foo&#39;)
<a href="#h143-0-1" id="h143-0-1" class="d">-Effect: Create { count: 1 }
</a><a href="#h143-0-2" id="h143-0-2" class="i">+Result: Create { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h144" href="../file/src/sql/tests/schema/update_integer.html">src/sql/tests/schema/update_integer</a> b/<a href="../file/src/sql/tests/schema/update_integer.html">src/sql/tests/schema/update_integer</a></b>
<a href="#h144-0" id="h144-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET value = 3
<a href="#h144-0-1" id="h144-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h144-0-2" id="h144-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE test (
<b>diff --git a/<a id="h145" href="../file/src/sql/tests/schema/update_integer_null.html">src/sql/tests/schema/update_integer_null</a> b/<a href="../file/src/sql/tests/schema/update_integer_null.html">src/sql/tests/schema/update_integer_null</a></b>
<a href="#h145-0" id="h145-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE test SET value = NULL
<a href="#h145-0-1" id="h145-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h145-0-2" id="h145-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE test (
<b>diff --git a/<a id="h146" href="../file/src/sql/tests/schema/update_pk_boolean.html">src/sql/tests/schema/update_pk_boolean</a> b/<a href="../file/src/sql/tests/schema/update_pk_boolean.html">src/sql/tests/schema/update_pk_boolean</a></b>
<a href="#h146-0" id="h146-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;boolean&quot; SET pk = TRUE WHERE pk = FALSE
<a href="#h146-0-1" id="h146-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h146-0-2" id="h146-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;boolean&quot; (
<b>diff --git a/<a id="h147" href="../file/src/sql/tests/schema/update_pk_float.html">src/sql/tests/schema/update_pk_float</a> b/<a href="../file/src/sql/tests/schema/update_pk_float.html">src/sql/tests/schema/update_pk_float</a></b>
<a href="#h147-0" id="h147-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;float&quot; SET pk = 1.618 WHERE pk = 3.14
<a href="#h147-0-1" id="h147-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h147-0-2" id="h147-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;float&quot; (
<b>diff --git a/<a id="h148" href="../file/src/sql/tests/schema/update_pk_integer.html">src/sql/tests/schema/update_pk_integer</a> b/<a href="../file/src/sql/tests/schema/update_pk_integer.html">src/sql/tests/schema/update_pk_integer</a></b>
<a href="#h148-0" id="h148-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;integer&quot; SET pk = 3 WHERE pk = 2
<a href="#h148-0-1" id="h148-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h148-0-2" id="h148-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;integer&quot; (
<b>diff --git a/<a id="h149" href="../file/src/sql/tests/schema/update_pk_string.html">src/sql/tests/schema/update_pk_string</a> b/<a href="../file/src/sql/tests/schema/update_pk_string.html">src/sql/tests/schema/update_pk_string</a></b>
<a href="#h149-0" id="h149-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;string&quot; SET pk = &#39;baz&#39; WHERE pk = &#39;foo&#39;
<a href="#h149-0-1" id="h149-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h149-0-2" id="h149-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h150" href="../file/src/sql/tests/schema/update_pk_string_case.html">src/sql/tests/schema/update_pk_string_case</a> b/<a href="../file/src/sql/tests/schema/update_pk_string_case.html">src/sql/tests/schema/update_pk_string_case</a></b>
<a href="#h150-0" id="h150-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;string&quot; SET pk = &#39;Bar&#39; WHERE pk = &#39;foo&#39;
<a href="#h150-0-1" id="h150-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h150-0-2" id="h150-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;string&quot; (
<b>diff --git a/<a id="h151" href="../file/src/sql/tests/schema/update_ref_pk_noref.html">src/sql/tests/schema/update_ref_pk_noref</a> b/<a href="../file/src/sql/tests/schema/update_ref_pk_noref.html">src/sql/tests/schema/update_ref_pk_noref</a></b>
<a href="#h151-0" id="h151-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE target SET id = 9 WHERE id = 3
<a href="#h151-0-1" id="h151-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h151-0-2" id="h151-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h152" href="../file/src/sql/tests/schema/update_ref_self_pk_noref.html">src/sql/tests/schema/update_ref_self_pk_noref</a> b/<a href="../file/src/sql/tests/schema/update_ref_self_pk_noref.html">src/sql/tests/schema/update_ref_self_pk_noref</a></b>
<a href="#h152-0" id="h152-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE self SET id = 9 WHERE id = 2
<a href="#h152-0-1" id="h152-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h152-0-2" id="h152-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h153" href="../file/src/sql/tests/schema/update_ref_self_self.html">src/sql/tests/schema/update_ref_self_self</a> b/<a href="../file/src/sql/tests/schema/update_ref_self_self.html">src/sql/tests/schema/update_ref_self_self</a></b>
<a href="#h153-0" id="h153-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE self SET self_id = 2 WHERE id = 2
<a href="#h153-0-1" id="h153-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h153-0-2" id="h153-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h154" href="../file/src/sql/tests/schema/update_ref_self_value.html">src/sql/tests/schema/update_ref_self_value</a> b/<a href="../file/src/sql/tests/schema/update_ref_self_value.html">src/sql/tests/schema/update_ref_self_value</a></b>
<a href="#h154-0" id="h154-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE self SET value = &#39;x&#39; WHERE id = 1
<a href="#h154-0-1" id="h154-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h154-0-2" id="h154-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE self (
<b>diff --git a/<a id="h155" href="../file/src/sql/tests/schema/update_ref_source.html">src/sql/tests/schema/update_ref_source</a> b/<a href="../file/src/sql/tests/schema/update_ref_source.html">src/sql/tests/schema/update_ref_source</a></b>
<a href="#h155-0" id="h155-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE source SET target_id = 1 WHERE id = 4
<a href="#h155-0-1" id="h155-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h155-0-2" id="h155-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h156" href="../file/src/sql/tests/schema/update_ref_source_null.html">src/sql/tests/schema/update_ref_source_null</a> b/<a href="../file/src/sql/tests/schema/update_ref_source_null.html">src/sql/tests/schema/update_ref_source_null</a></b>
<a href="#h156-0" id="h156-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE source SET target_id = NULL WHERE id = 2
<a href="#h156-0-1" id="h156-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h156-0-2" id="h156-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h157" href="../file/src/sql/tests/schema/update_ref_value.html">src/sql/tests/schema/update_ref_value</a> b/<a href="../file/src/sql/tests/schema/update_ref_value.html">src/sql/tests/schema/update_ref_value</a></b>
<a href="#h157-0" id="h157-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE target SET value = &#39;x&#39; WHERE id = 1
<a href="#h157-0-1" id="h157-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h157-0-2" id="h157-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE source (
<b>diff --git a/<a id="h158" href="../file/src/sql/tests/schema/update_unique_boolean.html">src/sql/tests/schema/update_unique_boolean</a> b/<a href="../file/src/sql/tests/schema/update_unique_boolean.html">src/sql/tests/schema/update_unique_boolean</a></b>
<a href="#h158-0" id="h158-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = FALSE WHERE id = 0
<a href="#h158-0-1" id="h158-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h158-0-2" id="h158-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h159" href="../file/src/sql/tests/schema/update_unique_boolean_same.html">src/sql/tests/schema/update_unique_boolean_same</a> b/<a href="../file/src/sql/tests/schema/update_unique_boolean_same.html">src/sql/tests/schema/update_unique_boolean_same</a></b>
<a href="#h159-0" id="h159-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = TRUE WHERE id = 1
<a href="#h159-0-1" id="h159-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h159-0-2" id="h159-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h160" href="../file/src/sql/tests/schema/update_unique_nulls.html">src/sql/tests/schema/update_unique_nulls</a> b/<a href="../file/src/sql/tests/schema/update_unique_nulls.html">src/sql/tests/schema/update_unique_nulls</a></b>
<a href="#h160-0" id="h160-0" class="h">@@ -1,5 +1,5 @@
</a> Query: UPDATE &quot;unique&quot; SET &quot;boolean&quot; = NULL, &quot;float&quot; = NULL, &quot;integer&quot; = NULL, &quot;string&quot; = NULL WHERE id = 1
<a href="#h160-0-1" id="h160-0-1" class="d">-Effect: Update { count: 1 }
</a><a href="#h160-0-2" id="h160-0-2" class="i">+Result: Update { count: 1 }
</a> 
 Storage:
 CREATE TABLE &quot;unique&quot; (
<b>diff --git a/<a id="h161" href="../file/src/sql/types/datatype.rs.html">src/sql/types/datatype.rs</a> b/<a href="../file/src/sql/types/datatype.rs.html">src/sql/types/datatype.rs</a></b>
<a href="#h161-0" id="h161-0" class="h">@@ -1,3 +1,5 @@
</a><a href="#h161-0-0" id="h161-0-0" class="i">+use crate::Error;
</a><a href="#h161-0-1" id="h161-0-1" class="i">+
</a> use std::cmp::Ordering;
 use std::hash::{Hash, Hasher};
 
<a href="#h161-1" id="h161-1" class="h">@@ -125,3 +127,46 @@ impl From&lt;&amp;str&gt; for Value {
</a> 
 /// A row of values
 pub type Row = Vec&lt;Value&gt;;
<a href="#h161-1-3" id="h161-1-3" class="i">+
</a><a href="#h161-1-4" id="h161-1-4" class="i">+/// A row iterator
</a><a href="#h161-1-5" id="h161-1-5" class="i">+pub type Rows = Box&lt;dyn Iterator&lt;Item = Result&lt;Row, Error&gt;&gt; + Send&gt;;
</a><a href="#h161-1-6" id="h161-1-6" class="i">+
</a><a href="#h161-1-7" id="h161-1-7" class="i">+/// A column (in a result set, see schema::Column for table columns)
</a><a href="#h161-1-8" id="h161-1-8" class="i">+#[derive(Clone, Debug, PartialEq, Serialize, Deserialize)]
</a><a href="#h161-1-9" id="h161-1-9" class="i">+pub struct Column {
</a><a href="#h161-1-10" id="h161-1-10" class="i">+    pub relation: Option&lt;String&gt;,
</a><a href="#h161-1-11" id="h161-1-11" class="i">+    pub name: Option&lt;String&gt;,
</a><a href="#h161-1-12" id="h161-1-12" class="i">+}
</a><a href="#h161-1-13" id="h161-1-13" class="i">+
</a><a href="#h161-1-14" id="h161-1-14" class="i">+/// A set of columns
</a><a href="#h161-1-15" id="h161-1-15" class="i">+pub type Columns = Vec&lt;Column&gt;;
</a><a href="#h161-1-16" id="h161-1-16" class="i">+
</a><a href="#h161-1-17" id="h161-1-17" class="i">+/// A relation, i.e. combination of columns and rows - used for query results.
</a><a href="#h161-1-18" id="h161-1-18" class="i">+/// FIXME This should possibly have a name as well, and be used to qualify query fields.
</a><a href="#h161-1-19" id="h161-1-19" class="i">+#[derive(Derivative, Serialize, Deserialize)]
</a><a href="#h161-1-20" id="h161-1-20" class="i">+#[derivative(Debug, PartialEq)]
</a><a href="#h161-1-21" id="h161-1-21" class="i">+pub struct Relation {
</a><a href="#h161-1-22" id="h161-1-22" class="i">+    pub columns: Columns,
</a><a href="#h161-1-23" id="h161-1-23" class="i">+    #[derivative(Debug = &quot;ignore&quot;)]
</a><a href="#h161-1-24" id="h161-1-24" class="i">+    #[derivative(PartialEq = &quot;ignore&quot;)]
</a><a href="#h161-1-25" id="h161-1-25" class="i">+    #[serde(skip)]
</a><a href="#h161-1-26" id="h161-1-26" class="i">+    pub rows: Option&lt;Rows&gt;,
</a><a href="#h161-1-27" id="h161-1-27" class="i">+}
</a><a href="#h161-1-28" id="h161-1-28" class="i">+
</a><a href="#h161-1-29" id="h161-1-29" class="i">+impl Iterator for Relation {
</a><a href="#h161-1-30" id="h161-1-30" class="i">+    type Item = Result&lt;Row, Error&gt;;
</a><a href="#h161-1-31" id="h161-1-31" class="i">+
</a><a href="#h161-1-32" id="h161-1-32" class="i">+    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
</a><a href="#h161-1-33" id="h161-1-33" class="i">+        // Make sure iteration is aborted on the first error, otherwise callers
</a><a href="#h161-1-34" id="h161-1-34" class="i">+        // will keep calling next for as long as it keeps returning errors
</a><a href="#h161-1-35" id="h161-1-35" class="i">+        if let Some(ref mut rows) = self.rows {
</a><a href="#h161-1-36" id="h161-1-36" class="i">+            let result = rows.next();
</a><a href="#h161-1-37" id="h161-1-37" class="i">+            if let Some(Err(_)) = result {
</a><a href="#h161-1-38" id="h161-1-38" class="i">+                self.rows = None;
</a><a href="#h161-1-39" id="h161-1-39" class="i">+            }
</a><a href="#h161-1-40" id="h161-1-40" class="i">+            result
</a><a href="#h161-1-41" id="h161-1-41" class="i">+        } else {
</a><a href="#h161-1-42" id="h161-1-42" class="i">+            None
</a><a href="#h161-1-43" id="h161-1-43" class="i">+        }
</a><a href="#h161-1-44" id="h161-1-44" class="i">+    }
</a><a href="#h161-1-45" id="h161-1-45" class="i">+}
</a><b>diff --git a/<a id="h162" href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a> b/<a href="../file/src/sql/types/mod.rs.html">src/sql/types/mod.rs</a></b>
<a href="#h162-0" id="h162-0" class="h">@@ -4,4 +4,4 @@ mod datatype;
</a> pub mod expression;
 pub mod schema;
 
<a href="#h162-0-3" id="h162-0-3" class="d">-pub use datatype::{DataType, Row, Value};
</a><a href="#h162-0-4" id="h162-0-4" class="i">+pub use datatype::{Column, Columns, DataType, Relation, Row, Rows, Value};
</a></pre>
</div>
</body>
</html>
