<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Always check if README exists in choose_readme() - cgit - Web based git repository viewer
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="cgit.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="cgit.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/tender.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
<script> hljs.highlightAll() ;</script>
<style>pre code.hljs {display: inline;padding: 0;} code.hljs {padding: 0;} .hljs {background: initial;} .hljs-comment{color: rgb(96, 96, 96);}</style></head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>cgit</h1><span class="desc">Web based git repository viewer
</span></td></tr><tr><td></td><td>
<br>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/README.html">README</a> | <a href="../file/COPYING.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/9dd67272ed57e8923510197eb5ac8d3f819fbb26.html">9dd67272ed57e8923510197eb5ac8d3f819fbb26</a>
<b>parent</b> <a href="../commit/efa2879ad760f6f12c1aa9d2bb9918f0afe9f084.html">efa2879ad760f6f12c1aa9d2bb9918f0afe9f084</a>
<b>Author:</b> Lukas Fleischer &lt;<a href="mailto:cgit@cryptocrack.de">cgit@cryptocrack.de</a>&gt;
<b>Date:</b>   Sun, 27 Jul 2014 20:50:59 +0200

Always check if README exists in choose_readme()

Specifying a nonexistent README file via the readme option is sometimes
useful, e.g. when using scan-path and setting a global default.
Currently, we check whether there is only one option in the readme
option and, if so, we choose that file without checking whether it
exists. As a consequence, all repositories are equipped with an about
link in the aforementioned scenario, even if there is no about file.
Remove the early check for the number of keys and always check whether
the file exists instead.

Signed-off-by: Lukas Fleischer &lt;cgit@cryptocrack.de&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">cgit.c</a></td><td> | </td><td class="num">6</td><td><span class="i"></span><span class="d">------</span></td></tr>
</table></pre><pre>1 file changed, 0 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/cgit.c.html">cgit.c</a> b/<a href="../file/cgit.c.html">cgit.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -504,12 +504,6 @@ static void choose_readme(struct cgit_repo *repo)
</a> 			free(ref);
 			continue;
 		}
<a href="#h0-0-3" id="h0-0-3" class="d">-		/* If there&#39;s only one item, we skip the possibly expensive
</a><a href="#h0-0-4" id="h0-0-4" class="d">-		 * selection process. */
</a><a href="#h0-0-5" id="h0-0-5" class="d">-		if (repo-&gt;readme.nr == 1) {
</a><a href="#h0-0-6" id="h0-0-6" class="d">-			found = 1;
</a><a href="#h0-0-7" id="h0-0-7" class="d">-			break;
</a><a href="#h0-0-8" id="h0-0-8" class="d">-		}
</a> 		if (ref) {
 			if (cgit_ref_path_exists(filename, ref, 1)) {
 				found = 1;
</pre>
</div>
</body>
</html>
