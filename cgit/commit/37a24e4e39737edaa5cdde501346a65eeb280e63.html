<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge branch &#39;jh/path-limit&#39; - cgit - Web based git repository viewer
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="cgit.git Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="cgit.git Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/tender.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
<script> hljs.highlightAll() ;</script>
<style>pre code.hljs {display: inline;padding: 0;} code.hljs {padding: 0;} .hljs {background: initial;} .hljs-comment{color: rgb(96, 96, 96);}</style></head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>cgit</h1><span class="desc">Web based git repository viewer
</span></td></tr><tr><td></td><td>
<br>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/README.html">README</a> | <a href="../file/COPYING.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/37a24e4e39737edaa5cdde501346a65eeb280e63.html">37a24e4e39737edaa5cdde501346a65eeb280e63</a>
<b>parent</b> <a href="../commit/47187b33be1c3de43fbed6f350ab05bc978aacd0.html">47187b33be1c3de43fbed6f350ab05bc978aacd0</a>
<b>Author:</b> Lars Hjemli &lt;<a href="mailto:hjemli@gmail.com">hjemli@gmail.com</a>&gt;
<b>Date:</b>   Tue, 22 Jun 2010 16:15:48 +0200

Merge branch &#39;jh/path-limit&#39;

Conflicts:
	cgit.h
	ui-commit.c

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">cgit.c</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">cgit.css</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">cgit.h</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">cgitrc.5.txt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">cmd.c</a></td><td> | </td><td class="num">46</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">cmd.h</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">shared.c</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">ui-commit.c</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">ui-commit.h</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">ui-diff.c</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">ui-log.c</a></td><td> | </td><td class="num">27</td><td><span class="i">+++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">ui-patch.c</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">ui-patch.h</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">ui-refs.c</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">ui-shared.c</a></td><td> | </td><td class="num">216</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">ui-shared.h</a></td><td> | </td><td class="num">72</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">ui-tree.c</a></td><td> | </td><td class="num">15</td><td><span class="i">++</span><span class="d">-------------</span></td></tr>
</table></pre><pre>17 files changed, 275 insertions(+), 164 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/cgit.c.html">cgit.c</a> b/<a href="../file/cgit.c.html">cgit.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -433,6 +433,12 @@ static void process_request(void *cbdata)
</a> 		return;
 	}
 
<a href="#h0-0-3" id="h0-0-3" class="i">+	/* If cmd-&gt;want_vpath is set, assume ctx-&gt;qry.path contains a &quot;virtual&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+	 * in-project path limit to be made available at ctx-&gt;qry.vpath.
</a><a href="#h0-0-5" id="h0-0-5" class="i">+	 * Otherwise, no path limit is in effect (ctx-&gt;qry.vpath = NULL).
</a><a href="#h0-0-6" id="h0-0-6" class="i">+	 */
</a><a href="#h0-0-7" id="h0-0-7" class="i">+	ctx-&gt;qry.vpath = cmd-&gt;want_vpath ? ctx-&gt;qry.path : NULL;
</a><a href="#h0-0-8" id="h0-0-8" class="i">+
</a> 	if (cmd-&gt;want_repo &amp;&amp; !ctx-&gt;repo) {
 		cgit_print_http_headers(ctx);
 		cgit_print_docstart(ctx);
<b>diff --git a/<a id="h1" href="../file/cgit.css.html">cgit.css</a> b/<a href="../file/cgit.css.html">cgit.css</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -64,7 +64,7 @@ table#header td.sub {
</a> }
 
 table.tabs {
<a href="#h1-0-3" id="h1-0-3" class="d">-	/* border-bottom: solid 2px #ccc; */
</a><a href="#h1-0-4" id="h1-0-4" class="i">+	border-bottom: solid 3px #ccc;
</a> 	border-collapse: collapse;
 	margin-top: 2em;
 	margin-bottom: 0px;
<a href="#h1-1" id="h1-1" class="h">@@ -102,10 +102,16 @@ table.tabs td.form select {
</a> 	font-size: 90%;
 }
 
<a href="#h1-1-3" id="h1-1-3" class="i">+div.path {
</a><a href="#h1-1-4" id="h1-1-4" class="i">+	margin: 0px;
</a><a href="#h1-1-5" id="h1-1-5" class="i">+	padding: 5px 2em 2px 2em;
</a><a href="#h1-1-6" id="h1-1-6" class="i">+	color: #000;
</a><a href="#h1-1-7" id="h1-1-7" class="i">+	background-color: #eee;
</a><a href="#h1-1-8" id="h1-1-8" class="i">+}
</a><a href="#h1-1-9" id="h1-1-9" class="i">+
</a> div.content {
 	margin: 0px;
 	padding: 2em;
<a href="#h1-1-13" id="h1-1-13" class="d">-	border-top: solid 3px #ccc;
</a> 	border-bottom: solid 3px #ccc;
 }
 
<b>diff --git a/<a id="h2" href="../file/cgit.h.html">cgit.h</a> b/<a href="../file/cgit.h.html">cgit.h</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -147,6 +147,7 @@ struct cgit_query {
</a> 	int showmsg;
 	int ssdiff;
 	int show_all;
<a href="#h2-0-3" id="h2-0-3" class="i">+	char *vpath;
</a> };
 
 struct cgit_config {
<b>diff --git a/<a id="h3" href="../file/cgitrc.5.txt.html">cgitrc.5.txt</a> b/<a href="../file/cgitrc.5.txt.html">cgitrc.5.txt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -444,7 +444,7 @@ snapshots=tar.gz tar.bz2 zip
</a> ## List of common mimetypes
 ##
 
<a href="#h3-0-3" id="h3-0-3" class="d">-mimetype.git=image/git
</a><a href="#h3-0-4" id="h3-0-4" class="i">+mimetype.gif=image/gif
</a> mimetype.html=text/html
 mimetype.jpg=image/jpeg
 mimetype.jpeg=image/jpeg
<b>diff --git a/<a id="h4" href="../file/cmd.c.html">cmd.c</a> b/<a href="../file/cmd.c.html">cmd.c</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -51,7 +51,7 @@ static void blob_fn(struct cgit_context *ctx)
</a> 
 static void commit_fn(struct cgit_context *ctx)
 {
<a href="#h4-0-3" id="h4-0-3" class="d">-	cgit_print_commit(ctx-&gt;qry.sha1);
</a><a href="#h4-0-4" id="h4-0-4" class="i">+	cgit_print_commit(ctx-&gt;qry.sha1, ctx-&gt;qry.path);
</a> }
 
 static void diff_fn(struct cgit_context *ctx)
<a href="#h4-1" id="h4-1" class="h">@@ -90,7 +90,7 @@ static void repolist_fn(struct cgit_context *ctx)
</a> 
 static void patch_fn(struct cgit_context *ctx)
 {
<a href="#h4-1-3" id="h4-1-3" class="d">-	cgit_print_patch(ctx-&gt;qry.sha1);
</a><a href="#h4-1-4" id="h4-1-4" class="i">+	cgit_print_patch(ctx-&gt;qry.sha1, ctx-&gt;qry.path);
</a> }
 
 static void plain_fn(struct cgit_context *ctx)
<a href="#h4-2" id="h4-2" class="h">@@ -129,31 +129,31 @@ static void tree_fn(struct cgit_context *ctx)
</a> 	cgit_print_tree(ctx-&gt;qry.sha1, ctx-&gt;qry.path);
 }
 
<a href="#h4-2-3" id="h4-2-3" class="d">-#define def_cmd(name, want_repo, want_layout) \
</a><a href="#h4-2-4" id="h4-2-4" class="d">-	{#name, name##_fn, want_repo, want_layout}
</a><a href="#h4-2-5" id="h4-2-5" class="i">+#define def_cmd(name, want_repo, want_layout, want_vpath) \
</a><a href="#h4-2-6" id="h4-2-6" class="i">+	{#name, name##_fn, want_repo, want_layout, want_vpath}
</a> 
 struct cgit_cmd *cgit_get_cmd(struct cgit_context *ctx)
 {
 	static struct cgit_cmd cmds[] = {
<a href="#h4-2-11" id="h4-2-11" class="d">-		def_cmd(HEAD, 1, 0),
</a><a href="#h4-2-12" id="h4-2-12" class="d">-		def_cmd(atom, 1, 0),
</a><a href="#h4-2-13" id="h4-2-13" class="d">-		def_cmd(about, 0, 1),
</a><a href="#h4-2-14" id="h4-2-14" class="d">-		def_cmd(blob, 1, 0),
</a><a href="#h4-2-15" id="h4-2-15" class="d">-		def_cmd(commit, 1, 1),
</a><a href="#h4-2-16" id="h4-2-16" class="d">-		def_cmd(diff, 1, 1),
</a><a href="#h4-2-17" id="h4-2-17" class="d">-		def_cmd(info, 1, 0),
</a><a href="#h4-2-18" id="h4-2-18" class="d">-		def_cmd(log, 1, 1),
</a><a href="#h4-2-19" id="h4-2-19" class="d">-		def_cmd(ls_cache, 0, 0),
</a><a href="#h4-2-20" id="h4-2-20" class="d">-		def_cmd(objects, 1, 0),
</a><a href="#h4-2-21" id="h4-2-21" class="d">-		def_cmd(patch, 1, 0),
</a><a href="#h4-2-22" id="h4-2-22" class="d">-		def_cmd(plain, 1, 0),
</a><a href="#h4-2-23" id="h4-2-23" class="d">-		def_cmd(refs, 1, 1),
</a><a href="#h4-2-24" id="h4-2-24" class="d">-		def_cmd(repolist, 0, 0),
</a><a href="#h4-2-25" id="h4-2-25" class="d">-		def_cmd(snapshot, 1, 0),
</a><a href="#h4-2-26" id="h4-2-26" class="d">-		def_cmd(stats, 1, 1),
</a><a href="#h4-2-27" id="h4-2-27" class="d">-		def_cmd(summary, 1, 1),
</a><a href="#h4-2-28" id="h4-2-28" class="d">-		def_cmd(tag, 1, 1),
</a><a href="#h4-2-29" id="h4-2-29" class="d">-		def_cmd(tree, 1, 1),
</a><a href="#h4-2-30" id="h4-2-30" class="i">+		def_cmd(HEAD, 1, 0, 0),
</a><a href="#h4-2-31" id="h4-2-31" class="i">+		def_cmd(atom, 1, 0, 0),
</a><a href="#h4-2-32" id="h4-2-32" class="i">+		def_cmd(about, 0, 1, 0),
</a><a href="#h4-2-33" id="h4-2-33" class="i">+		def_cmd(blob, 1, 0, 0),
</a><a href="#h4-2-34" id="h4-2-34" class="i">+		def_cmd(commit, 1, 1, 1),
</a><a href="#h4-2-35" id="h4-2-35" class="i">+		def_cmd(diff, 1, 1, 1),
</a><a href="#h4-2-36" id="h4-2-36" class="i">+		def_cmd(info, 1, 0, 0),
</a><a href="#h4-2-37" id="h4-2-37" class="i">+		def_cmd(log, 1, 1, 1),
</a><a href="#h4-2-38" id="h4-2-38" class="i">+		def_cmd(ls_cache, 0, 0, 0),
</a><a href="#h4-2-39" id="h4-2-39" class="i">+		def_cmd(objects, 1, 0, 0),
</a><a href="#h4-2-40" id="h4-2-40" class="i">+		def_cmd(patch, 1, 0, 1),
</a><a href="#h4-2-41" id="h4-2-41" class="i">+		def_cmd(plain, 1, 0, 0),
</a><a href="#h4-2-42" id="h4-2-42" class="i">+		def_cmd(refs, 1, 1, 0),
</a><a href="#h4-2-43" id="h4-2-43" class="i">+		def_cmd(repolist, 0, 0, 0),
</a><a href="#h4-2-44" id="h4-2-44" class="i">+		def_cmd(snapshot, 1, 0, 0),
</a><a href="#h4-2-45" id="h4-2-45" class="i">+		def_cmd(stats, 1, 1, 1),
</a><a href="#h4-2-46" id="h4-2-46" class="i">+		def_cmd(summary, 1, 1, 0),
</a><a href="#h4-2-47" id="h4-2-47" class="i">+		def_cmd(tag, 1, 1, 0),
</a><a href="#h4-2-48" id="h4-2-48" class="i">+		def_cmd(tree, 1, 1, 1),
</a> 	};
 	int i;
 
<b>diff --git a/<a id="h5" href="../file/cmd.h.html">cmd.h</a> b/<a href="../file/cmd.h.html">cmd.h</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -7,7 +7,8 @@ struct cgit_cmd {
</a> 	const char *name;
 	cgit_cmd_fn fn;
 	unsigned int want_repo:1,
<a href="#h5-0-3" id="h5-0-3" class="d">-		want_layout:1;
</a><a href="#h5-0-4" id="h5-0-4" class="i">+		want_layout:1,
</a><a href="#h5-0-5" id="h5-0-5" class="i">+		want_vpath:1;
</a> };
 
 extern struct cgit_cmd *cgit_get_cmd(struct cgit_context *ctx);
<b>diff --git a/<a id="h6" href="../file/shared.c.html">shared.c</a> b/<a href="../file/shared.c.html">shared.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -10,7 +10,6 @@
</a> 
 struct cgit_repolist cgit_repolist;
 struct cgit_context ctx;
<a href="#h6-0-3" id="h6-0-3" class="d">-int cgit_cmd;
</a> 
 int chk_zero(int result, char *msg)
 {
<b>diff --git a/<a id="h7" href="../file/ui-commit.c.html">ui-commit.c</a> b/<a href="../file/ui-commit.c.html">ui-commit.c</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -12,7 +12,7 @@
</a> #include &quot;ui-diff.h&quot;
 #include &quot;ui-log.h&quot;
 
<a href="#h7-0-3" id="h7-0-3" class="d">-void cgit_print_commit(char *hex)
</a><a href="#h7-0-4" id="h7-0-4" class="i">+void cgit_print_commit(char *hex, const char *prefix)
</a> {
 	struct commit *commit, *parent;
 	struct commitinfo *info, *parent_info;
<a href="#h7-1" id="h7-1" class="h">@@ -58,19 +58,23 @@ void cgit_print_commit(char *hex)
</a> 	html(&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);
 	html(&quot;&lt;tr&gt;&lt;th&gt;commit&lt;/th&gt;&lt;td colspan=&#39;2&#39; class=&#39;sha1&#39;&gt;&quot;);
 	tmp = sha1_to_hex(commit-&gt;object.sha1);
<a href="#h7-1-3" id="h7-1-3" class="d">-	cgit_commit_link(tmp, NULL, NULL, ctx.qry.head, tmp, 0);
</a><a href="#h7-1-4" id="h7-1-4" class="i">+	cgit_commit_link(tmp, NULL, NULL, ctx.qry.head, tmp, prefix, 0);
</a> 	html(&quot; (&quot;);
<a href="#h7-1-6" id="h7-1-6" class="d">-	cgit_patch_link(&quot;patch&quot;, NULL, NULL, NULL, tmp);
</a><a href="#h7-1-7" id="h7-1-7" class="i">+	cgit_patch_link(&quot;patch&quot;, NULL, NULL, NULL, tmp, prefix);
</a> 	html(&quot;) (&quot;);
 	if ((ctx.qry.ssdiff &amp;&amp; !ctx.cfg.ssdiff) || (!ctx.qry.ssdiff &amp;&amp; ctx.cfg.ssdiff))
<a href="#h7-1-10" id="h7-1-10" class="d">-		cgit_commit_link(&quot;unidiff&quot;, NULL, NULL, ctx.qry.head, tmp, 1);
</a><a href="#h7-1-11" id="h7-1-11" class="i">+		cgit_commit_link(&quot;unidiff&quot;, NULL, NULL, ctx.qry.head, tmp, prefix, 1);
</a> 	else
<a href="#h7-1-13" id="h7-1-13" class="d">-		cgit_commit_link(&quot;side-by-side diff&quot;, NULL, NULL, ctx.qry.head, tmp, 1);
</a><a href="#h7-1-14" id="h7-1-14" class="i">+		cgit_commit_link(&quot;side-by-side diff&quot;, NULL, NULL, ctx.qry.head, tmp, prefix, 1);
</a> 	html(&quot;)&lt;/td&gt;&lt;/tr&gt;\n&quot;);
 	html(&quot;&lt;tr&gt;&lt;th&gt;tree&lt;/th&gt;&lt;td colspan=&#39;2&#39; class=&#39;sha1&#39;&gt;&quot;);
 	tmp = xstrdup(hex);
 	cgit_tree_link(sha1_to_hex(commit-&gt;tree-&gt;object.sha1), NULL, NULL,
 		       ctx.qry.head, tmp, NULL);
<a href="#h7-1-20" id="h7-1-20" class="i">+	if (prefix) {
</a><a href="#h7-1-21" id="h7-1-21" class="i">+		html(&quot; /&quot;);
</a><a href="#h7-1-22" id="h7-1-22" class="i">+		cgit_tree_link(prefix, NULL, NULL, ctx.qry.head, tmp, prefix);
</a><a href="#h7-1-23" id="h7-1-23" class="i">+	}
</a> 	html(&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);
       	for (p = commit-&gt;parents; p ; p = p-&gt;next) {
 		parent = lookup_commit_reference(p-&gt;item-&gt;object.sha1);
<a href="#h7-2" id="h7-2" class="h">@@ -87,10 +91,10 @@ void cgit_print_commit(char *hex)
</a> 			parent_info = cgit_parse_commit(parent);
 			tmp2 = parent_info-&gt;subject;
 		}
<a href="#h7-2-3" id="h7-2-3" class="d">-		cgit_commit_link(tmp2, NULL, NULL, ctx.qry.head, tmp, 0);
</a><a href="#h7-2-4" id="h7-2-4" class="i">+		cgit_commit_link(tmp2, NULL, NULL, ctx.qry.head, tmp, prefix, 0);
</a> 		html(&quot; (&quot;);
 		cgit_diff_link(&quot;diff&quot;, NULL, NULL, ctx.qry.head, hex,
<a href="#h7-2-7" id="h7-2-7" class="d">-			       sha1_to_hex(p-&gt;item-&gt;object.sha1), NULL, 0);
</a><a href="#h7-2-8" id="h7-2-8" class="i">+			       sha1_to_hex(p-&gt;item-&gt;object.sha1), prefix, 0);
</a> 		html(&quot;)&lt;/td&gt;&lt;/tr&gt;&quot;);
 		parents++;
 	}
<a href="#h7-3" id="h7-3" class="h">@@ -121,7 +125,7 @@ void cgit_print_commit(char *hex)
</a> 			tmp = sha1_to_hex(commit-&gt;parents-&gt;item-&gt;object.sha1);
 		else
 			tmp = NULL;
<a href="#h7-3-3" id="h7-3-3" class="d">-		cgit_print_diff(ctx.qry.sha1, tmp, NULL);
</a><a href="#h7-3-4" id="h7-3-4" class="i">+		cgit_print_diff(ctx.qry.sha1, tmp, prefix);
</a> 	}
 	cgit_free_commitinfo(info);
 }
<b>diff --git a/<a id="h8" href="../file/ui-commit.h.html">ui-commit.h</a> b/<a href="../file/ui-commit.h.html">ui-commit.h</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,6 +1,6 @@
</a> #ifndef UI_COMMIT_H
 #define UI_COMMIT_H
 
<a href="#h8-0-3" id="h8-0-3" class="d">-extern void cgit_print_commit(char *hex);
</a><a href="#h8-0-4" id="h8-0-4" class="i">+extern void cgit_print_commit(char *hex, const char *prefix);
</a> 
 #endif /* UI_COMMIT_H */
<b>diff --git a/<a id="h9" href="../file/ui-diff.c.html">ui-diff.c</a> b/<a href="../file/ui-diff.c.html">ui-diff.c</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -154,17 +154,19 @@ static void inspect_filepair(struct diff_filepair *pair)
</a> }
 
 void cgit_print_diffstat(const unsigned char *old_sha1,
<a href="#h9-0-3" id="h9-0-3" class="d">-			 const unsigned char *new_sha1)
</a><a href="#h9-0-4" id="h9-0-4" class="i">+			 const unsigned char *new_sha1, const char *prefix)
</a> {
 	int i;
 
 	html(&quot;&lt;div class=&#39;diffstat-header&#39;&gt;&quot;);
 	cgit_diff_link(&quot;Diffstat&quot;, NULL, NULL, ctx.qry.head, ctx.qry.sha1,
 		       ctx.qry.sha2, NULL, 0);
<a href="#h9-0-11" id="h9-0-11" class="i">+	if (prefix)
</a><a href="#h9-0-12" id="h9-0-12" class="i">+		htmlf(&quot; (limited to &#39;%s&#39;)&quot;, prefix);
</a> 	html(&quot;&lt;/div&gt;&quot;);
 	html(&quot;&lt;table summary=&#39;diffstat&#39; class=&#39;diffstat&#39;&gt;&quot;);
 	max_changes = 0;
<a href="#h9-0-16" id="h9-0-16" class="d">-	cgit_diff_tree(old_sha1, new_sha1, inspect_filepair, NULL);
</a><a href="#h9-0-17" id="h9-0-17" class="i">+	cgit_diff_tree(old_sha1, new_sha1, inspect_filepair, prefix);
</a> 	for(i = 0; i&lt;files; i++)
 		print_fileinfo(&amp;items[i]);
 	html(&quot;&lt;/table&gt;&quot;);
<a href="#h9-1" id="h9-1" class="h">@@ -338,7 +340,7 @@ void cgit_print_diff(const char *new_rev, const char *old_rev, const char *prefi
</a> 		use_ssdiff = 1;
 
 	print_ssdiff_link();
<a href="#h9-1-3" id="h9-1-3" class="d">-	cgit_print_diffstat(old_rev_sha1, new_rev_sha1);
</a><a href="#h9-1-4" id="h9-1-4" class="i">+	cgit_print_diffstat(old_rev_sha1, new_rev_sha1, prefix);
</a> 
 	if (use_ssdiff) {
 		html(&quot;&lt;table summary=&#39;ssdiff&#39; class=&#39;ssdiff&#39;&gt;&quot;);
<b>diff --git a/<a id="h10" href="../file/ui-log.c.html">ui-log.c</a> b/<a href="../file/ui-log.c.html">ui-log.c</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -46,8 +46,9 @@ void show_commit_decorations(struct commit *commit)
</a> 	while (deco) {
 		if (!prefixcmp(deco-&gt;name, &quot;refs/heads/&quot;)) {
 			strncpy(buf, deco-&gt;name + 11, sizeof(buf) - 1);
<a href="#h10-0-3" id="h10-0-3" class="d">-			cgit_log_link(buf, NULL, &quot;branch-deco&quot;, buf, NULL, NULL,
</a><a href="#h10-0-4" id="h10-0-4" class="d">-				0, NULL, NULL, ctx.qry.showmsg);
</a><a href="#h10-0-5" id="h10-0-5" class="i">+			cgit_log_link(buf, NULL, &quot;branch-deco&quot;, buf, NULL,
</a><a href="#h10-0-6" id="h10-0-6" class="i">+				      ctx.qry.vpath, 0, NULL, NULL,
</a><a href="#h10-0-7" id="h10-0-7" class="i">+				      ctx.qry.showmsg);
</a> 		}
 		else if (!prefixcmp(deco-&gt;name, &quot;tag: refs/tags/&quot;)) {
 			strncpy(buf, deco-&gt;name + 15, sizeof(buf) - 1);
<a href="#h10-1" id="h10-1" class="h">@@ -60,13 +61,15 @@ void show_commit_decorations(struct commit *commit)
</a> 		else if (!prefixcmp(deco-&gt;name, &quot;refs/remotes/&quot;)) {
 			strncpy(buf, deco-&gt;name + 13, sizeof(buf) - 1);
 			cgit_log_link(buf, NULL, &quot;remote-deco&quot;, NULL,
<a href="#h10-1-3" id="h10-1-3" class="d">-				sha1_to_hex(commit-&gt;object.sha1), NULL,
</a><a href="#h10-1-4" id="h10-1-4" class="d">-				0, NULL, NULL, ctx.qry.showmsg);
</a><a href="#h10-1-5" id="h10-1-5" class="i">+				      sha1_to_hex(commit-&gt;object.sha1),
</a><a href="#h10-1-6" id="h10-1-6" class="i">+				      ctx.qry.vpath, 0, NULL, NULL,
</a><a href="#h10-1-7" id="h10-1-7" class="i">+				      ctx.qry.showmsg);
</a> 		}
 		else {
 			strncpy(buf, deco-&gt;name, sizeof(buf) - 1);
 			cgit_commit_link(buf, NULL, &quot;deco&quot;, ctx.qry.head,
<a href="#h10-1-12" id="h10-1-12" class="d">-				sha1_to_hex(commit-&gt;object.sha1), 0);
</a><a href="#h10-1-13" id="h10-1-13" class="i">+					 sha1_to_hex(commit-&gt;object.sha1),
</a><a href="#h10-1-14" id="h10-1-14" class="i">+					 ctx.qry.vpath, 0);
</a> 		}
 		deco = deco-&gt;next;
 	}
<a href="#h10-2" id="h10-2" class="h">@@ -82,14 +85,14 @@ void print_commit(struct commit *commit)
</a> 	htmlf(&quot;&lt;tr%s&gt;&lt;td&gt;&quot;,
 		ctx.qry.showmsg ? &quot; class=&#39;logheader&#39;&quot; : &quot;&quot;);
 	tmp = fmt(&quot;id=%s&quot;, sha1_to_hex(commit-&gt;object.sha1));
<a href="#h10-2-3" id="h10-2-3" class="d">-	tmp = cgit_pageurl(ctx.repo-&gt;url, &quot;commit&quot;, tmp);
</a><a href="#h10-2-4" id="h10-2-4" class="i">+	tmp = cgit_fileurl(ctx.repo-&gt;url, &quot;commit&quot;, ctx.qry.vpath, tmp);
</a> 	html_link_open(tmp, NULL, NULL);
 	cgit_print_age(commit-&gt;date, TM_WEEK * 2, FMT_SHORTDATE);
 	html_link_close();
 	htmlf(&quot;&lt;/td&gt;&lt;td%s&gt;&quot;,
 		ctx.qry.showmsg ? &quot; class=&#39;logsubject&#39;&quot; : &quot;&quot;);
 	cgit_commit_link(info-&gt;subject, NULL, NULL, ctx.qry.head,
<a href="#h10-2-11" id="h10-2-11" class="d">-			 sha1_to_hex(commit-&gt;object.sha1), 0);
</a><a href="#h10-2-12" id="h10-2-12" class="i">+			 sha1_to_hex(commit-&gt;object.sha1), ctx.qry.vpath, 0);
</a> 	show_commit_decorations(commit);
 	html(&quot;&lt;/td&gt;&lt;td&gt;&quot;);
 	html_txt(info-&gt;author);
<a href="#h10-3" id="h10-3" class="h">@@ -176,7 +179,7 @@ void cgit_print_log(const char *tip, int ofs, int cnt, char *grep, char *pattern
</a> 		html(&quot; (&quot;);
 		cgit_log_link(ctx.qry.showmsg ? &quot;Collapse&quot; : &quot;Expand&quot;, NULL,
 			      NULL, ctx.qry.head, ctx.qry.sha1,
<a href="#h10-3-3" id="h10-3-3" class="d">-			      ctx.qry.path, ctx.qry.ofs, ctx.qry.grep,
</a><a href="#h10-3-4" id="h10-3-4" class="i">+			      ctx.qry.vpath, ctx.qry.ofs, ctx.qry.grep,
</a> 			      ctx.qry.search, ctx.qry.showmsg ? 0 : 1);
 		html(&quot;)&quot;);
 	}
<a href="#h10-4" id="h10-4" class="h">@@ -213,22 +216,22 @@ void cgit_print_log(const char *tip, int ofs, int cnt, char *grep, char *pattern
</a> 		     columns);
 		if (ofs &gt; 0) {
 			cgit_log_link(&quot;[prev]&quot;, NULL, NULL, ctx.qry.head,
<a href="#h10-4-3" id="h10-4-3" class="d">-				      ctx.qry.sha1, ctx.qry.path,
</a><a href="#h10-4-4" id="h10-4-4" class="i">+				      ctx.qry.sha1, ctx.qry.vpath,
</a> 				      ofs - cnt, ctx.qry.grep,
 				      ctx.qry.search, ctx.qry.showmsg);
 			html(&quot;&amp;nbsp;&quot;);
 		}
 		if ((commit = get_revision(&amp;rev)) != NULL) {
 			cgit_log_link(&quot;[next]&quot;, NULL, NULL, ctx.qry.head,
<a href="#h10-4-11" id="h10-4-11" class="d">-				      ctx.qry.sha1, ctx.qry.path,
</a><a href="#h10-4-12" id="h10-4-12" class="i">+				      ctx.qry.sha1, ctx.qry.vpath,
</a> 				      ofs + cnt, ctx.qry.grep,
 				      ctx.qry.search, ctx.qry.showmsg);
 		}
 		html(&quot;&lt;/div&gt;&quot;);
 	} else if ((commit = get_revision(&amp;rev)) != NULL) {
 		html(&quot;&lt;tr class=&#39;nohover&#39;&gt;&lt;td colspan=&#39;3&#39;&gt;&quot;);
<a href="#h10-4-19" id="h10-4-19" class="d">-		cgit_log_link(&quot;[...]&quot;, NULL, NULL, ctx.qry.head, NULL, NULL, 0,
</a><a href="#h10-4-20" id="h10-4-20" class="d">-			      NULL, NULL, ctx.qry.showmsg);
</a><a href="#h10-4-21" id="h10-4-21" class="i">+		cgit_log_link(&quot;[...]&quot;, NULL, NULL, ctx.qry.head, NULL,
</a><a href="#h10-4-22" id="h10-4-22" class="i">+			      ctx.qry.vpath, 0, NULL, NULL, ctx.qry.showmsg);
</a> 		html(&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);
 	}
 }
<b>diff --git a/<a id="h11" href="../file/ui-patch.c.html">ui-patch.c</a> b/<a href="../file/ui-patch.c.html">ui-patch.c</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -77,7 +77,7 @@ static void filepair_cb(struct diff_filepair *pair)
</a> 		html(&quot;Binary files differ\n&quot;);
 }
 
<a href="#h11-0-3" id="h11-0-3" class="d">-void cgit_print_patch(char *hex)
</a><a href="#h11-0-4" id="h11-0-4" class="i">+void cgit_print_patch(char *hex, const char *prefix)
</a> {
 	struct commit *commit;
 	struct commitinfo *info;
<a href="#h11-1" id="h11-1" class="h">@@ -122,7 +122,9 @@ void cgit_print_patch(char *hex)
</a> 			html(&quot;\n&quot;);
 	}
 	html(&quot;---\n&quot;);
<a href="#h11-1-3" id="h11-1-3" class="d">-	cgit_diff_tree(old_sha1, sha1, filepair_cb, NULL);
</a><a href="#h11-1-4" id="h11-1-4" class="i">+	if (prefix)
</a><a href="#h11-1-5" id="h11-1-5" class="i">+		htmlf(&quot;(limited to &#39;%s&#39;)\n\n&quot;, prefix);
</a><a href="#h11-1-6" id="h11-1-6" class="i">+	cgit_diff_tree(old_sha1, sha1, filepair_cb, prefix);
</a> 	html(&quot;--\n&quot;);
 	htmlf(&quot;cgit %s\n&quot;, CGIT_VERSION);
 	cgit_free_commitinfo(info);
<b>diff --git a/<a id="h12" href="../file/ui-patch.h.html">ui-patch.h</a> b/<a href="../file/ui-patch.h.html">ui-patch.h</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,6 +1,6 @@
</a> #ifndef UI_PATCH_H
 #define UI_PATCH_H
 
<a href="#h12-0-3" id="h12-0-3" class="d">-extern void cgit_print_patch(char *hex);
</a><a href="#h12-0-4" id="h12-0-4" class="i">+extern void cgit_print_patch(char *hex, const char *prefix);
</a> 
 #endif /* UI_PATCH_H */
<b>diff --git a/<a id="h13" href="../file/ui-refs.c.html">ui-refs.c</a> b/<a href="../file/ui-refs.c.html">ui-refs.c</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -74,7 +74,7 @@ static int print_branch(struct refinfo *ref)
</a> 	html(&quot;&lt;/td&gt;&lt;td&gt;&quot;);
 
 	if (ref-&gt;object-&gt;type == OBJ_COMMIT) {
<a href="#h13-0-3" id="h13-0-3" class="d">-		cgit_commit_link(info-&gt;subject, NULL, NULL, name, NULL, 0);
</a><a href="#h13-0-4" id="h13-0-4" class="i">+		cgit_commit_link(info-&gt;subject, NULL, NULL, name, NULL, NULL, 0);
</a> 		html(&quot;&lt;/td&gt;&lt;td&gt;&quot;);
 		html_txt(info-&gt;author);
 		html(&quot;&lt;/td&gt;&lt;td colspan=&#39;2&#39;&gt;&quot;);
<b>diff --git a/<a id="h14" href="../file/ui-shared.c.html">ui-shared.c</a> b/<a href="../file/ui-shared.c.html">ui-shared.c</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -27,7 +27,7 @@ static char *http_date(time_t t)
</a> 		   tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec);
 }
 
<a href="#h14-0-3" id="h14-0-3" class="d">-void cgit_print_error(char *msg)
</a><a href="#h14-0-4" id="h14-0-4" class="i">+void cgit_print_error(const char *msg)
</a> {
 	html(&quot;&lt;div class=&#39;error&#39;&gt;&quot;);
 	html_txt(msg);
<a href="#h14-1" id="h14-1" class="h">@@ -133,7 +133,7 @@ char *cgit_currurl()
</a> 		return fmt(&quot;%s/&quot;, ctx.cfg.virtual_root);
 }
 
<a href="#h14-1-3" id="h14-1-3" class="d">-static void site_url(char *page, char *search, int ofs)
</a><a href="#h14-1-4" id="h14-1-4" class="i">+static void site_url(const char *page, const char *search, int ofs)
</a> {
 	char *delim = &quot;?&quot;;
 
<a href="#h14-2" id="h14-2" class="h">@@ -160,8 +160,8 @@ static void site_url(char *page, char *search, int ofs)
</a> 	}
 }
 
<a href="#h14-2-3" id="h14-2-3" class="d">-static void site_link(char *page, char *name, char *title, char *class,
</a><a href="#h14-2-4" id="h14-2-4" class="d">-		      char *search, int ofs)
</a><a href="#h14-2-5" id="h14-2-5" class="i">+static void site_link(const char *page, const char *name, const char *title,
</a><a href="#h14-2-6" id="h14-2-6" class="i">+		      const char *class, const char *search, int ofs)
</a> {
 	html(&quot;&lt;a&quot;);
 	if (title) {
<a href="#h14-3" id="h14-3" class="h">@@ -181,14 +181,14 @@ static void site_link(char *page, char *name, char *title, char *class,
</a> 	html(&quot;&lt;/a&gt;&quot;);
 }
 
<a href="#h14-3-3" id="h14-3-3" class="d">-void cgit_index_link(char *name, char *title, char *class, char *pattern,
</a><a href="#h14-3-4" id="h14-3-4" class="d">-		     int ofs)
</a><a href="#h14-3-5" id="h14-3-5" class="i">+void cgit_index_link(const char *name, const char *title, const char *class,
</a><a href="#h14-3-6" id="h14-3-6" class="i">+		     const char *pattern, int ofs)
</a> {
 	site_link(NULL, name, title, class, pattern, ofs);
 }
 
<a href="#h14-3-11" id="h14-3-11" class="d">-static char *repolink(char *title, char *class, char *page, char *head,
</a><a href="#h14-3-12" id="h14-3-12" class="d">-		      char *path)
</a><a href="#h14-3-13" id="h14-3-13" class="i">+static char *repolink(const char *title, const char *class, const char *page,
</a><a href="#h14-3-14" id="h14-3-14" class="i">+		      const char *head, const char *path)
</a> {
 	char *delim = &quot;?&quot;;
 
<a href="#h14-4" id="h14-4" class="h">@@ -240,8 +240,9 @@ static char *repolink(char *title, char *class, char *page, char *head,
</a> 	return fmt(&quot;%s&quot;, delim);
 }
 
<a href="#h14-4-3" id="h14-4-3" class="d">-static void reporevlink(char *page, char *name, char *title, char *class,
</a><a href="#h14-4-4" id="h14-4-4" class="d">-			char *head, char *rev, char *path)
</a><a href="#h14-4-5" id="h14-4-5" class="i">+static void reporevlink(const char *page, const char *name, const char *title,
</a><a href="#h14-4-6" id="h14-4-6" class="i">+			const char *class, const char *head, const char *rev,
</a><a href="#h14-4-7" id="h14-4-7" class="i">+			const char *path)
</a> {
 	char *delim;
 
<a href="#h14-5" id="h14-5" class="h">@@ -256,32 +257,33 @@ static void reporevlink(char *page, char *name, char *title, char *class,
</a> 	html(&quot;&lt;/a&gt;&quot;);
 }
 
<a href="#h14-5-3" id="h14-5-3" class="d">-void cgit_summary_link(char *name, char *title, char *class, char *head)
</a><a href="#h14-5-4" id="h14-5-4" class="i">+void cgit_summary_link(const char *name, const char *title, const char *class,
</a><a href="#h14-5-5" id="h14-5-5" class="i">+		       const char *head)
</a> {
 	reporevlink(NULL, name, title, class, head, NULL, NULL);
 }
 
<a href="#h14-5-10" id="h14-5-10" class="d">-void cgit_tag_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-5-11" id="h14-5-11" class="d">-		   char *rev)
</a><a href="#h14-5-12" id="h14-5-12" class="i">+void cgit_tag_link(const char *name, const char *title, const char *class,
</a><a href="#h14-5-13" id="h14-5-13" class="i">+		   const char *head, const char *rev)
</a> {
 	reporevlink(&quot;tag&quot;, name, title, class, head, rev, NULL);
 }
 
<a href="#h14-5-18" id="h14-5-18" class="d">-void cgit_tree_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-5-19" id="h14-5-19" class="d">-		    char *rev, char *path)
</a><a href="#h14-5-20" id="h14-5-20" class="i">+void cgit_tree_link(const char *name, const char *title, const char *class,
</a><a href="#h14-5-21" id="h14-5-21" class="i">+		    const char *head, const char *rev, const char *path)
</a> {
 	reporevlink(&quot;tree&quot;, name, title, class, head, rev, path);
 }
 
<a href="#h14-5-26" id="h14-5-26" class="d">-void cgit_plain_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-5-27" id="h14-5-27" class="d">-		     char *rev, char *path)
</a><a href="#h14-5-28" id="h14-5-28" class="i">+void cgit_plain_link(const char *name, const char *title, const char *class,
</a><a href="#h14-5-29" id="h14-5-29" class="i">+		     const char *head, const char *rev, const char *path)
</a> {
 	reporevlink(&quot;plain&quot;, name, title, class, head, rev, path);
 }
 
<a href="#h14-5-34" id="h14-5-34" class="d">-void cgit_log_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-5-35" id="h14-5-35" class="d">-		   char *rev, char *path, int ofs, char *grep, char *pattern,
</a><a href="#h14-5-36" id="h14-5-36" class="d">-		   int showmsg)
</a><a href="#h14-5-37" id="h14-5-37" class="i">+void cgit_log_link(const char *name, const char *title, const char *class,
</a><a href="#h14-5-38" id="h14-5-38" class="i">+		   const char *head, const char *rev, const char *path,
</a><a href="#h14-5-39" id="h14-5-39" class="i">+		   int ofs, const char *grep, const char *pattern, int showmsg)
</a> {
 	char *delim;
 
<a href="#h14-6" id="h14-6" class="h">@@ -316,8 +318,9 @@ void cgit_log_link(char *name, char *title, char *class, char *head,
</a> 	html(&quot;&lt;/a&gt;&quot;);
 }
 
<a href="#h14-6-3" id="h14-6-3" class="d">-void cgit_commit_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-6-4" id="h14-6-4" class="d">-		      char *rev, int toggle_ssdiff)
</a><a href="#h14-6-5" id="h14-6-5" class="i">+void cgit_commit_link(char *name, const char *title, const char *class,
</a><a href="#h14-6-6" id="h14-6-6" class="i">+		      const char *head, const char *rev, const char *path,
</a><a href="#h14-6-7" id="h14-6-7" class="i">+		      int toggle_ssdiff)
</a> {
 	if (strlen(name) &gt; ctx.cfg.max_msg_len &amp;&amp; ctx.cfg.max_msg_len &gt;= 15) {
 		name[ctx.cfg.max_msg_len] = &#39;\0&#39;;
<a href="#h14-7" id="h14-7" class="h">@@ -328,7 +331,7 @@ void cgit_commit_link(char *name, char *title, char *class, char *head,
</a> 
 	char *delim;
 
<a href="#h14-7-3" id="h14-7-3" class="d">-	delim = repolink(title, class, &quot;commit&quot;, head, NULL);
</a><a href="#h14-7-4" id="h14-7-4" class="i">+	delim = repolink(title, class, &quot;commit&quot;, head, path);
</a> 	if (rev &amp;&amp; strcmp(rev, ctx.qry.head)) {
 		html(delim);
 		html(&quot;id=&quot;);
<a href="#h14-8" id="h14-8" class="h">@@ -344,21 +347,22 @@ void cgit_commit_link(char *name, char *title, char *class, char *head,
</a> 	html(&quot;&lt;/a&gt;&quot;);
 }
 
<a href="#h14-8-3" id="h14-8-3" class="d">-void cgit_refs_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-8-4" id="h14-8-4" class="d">-		    char *rev, char *path)
</a><a href="#h14-8-5" id="h14-8-5" class="i">+void cgit_refs_link(const char *name, const char *title, const char *class,
</a><a href="#h14-8-6" id="h14-8-6" class="i">+		    const char *head, const char *rev, const char *path)
</a> {
 	reporevlink(&quot;refs&quot;, name, title, class, head, rev, path);
 }
 
<a href="#h14-8-11" id="h14-8-11" class="d">-void cgit_snapshot_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-8-12" id="h14-8-12" class="d">-			char *rev, char *archivename)
</a><a href="#h14-8-13" id="h14-8-13" class="i">+void cgit_snapshot_link(const char *name, const char *title, const char *class,
</a><a href="#h14-8-14" id="h14-8-14" class="i">+			const char *head, const char *rev,
</a><a href="#h14-8-15" id="h14-8-15" class="i">+			const char *archivename)
</a> {
 	reporevlink(&quot;snapshot&quot;, name, title, class, head, rev, archivename);
 }
 
<a href="#h14-8-20" id="h14-8-20" class="d">-void cgit_diff_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-8-21" id="h14-8-21" class="d">-		    char *new_rev, char *old_rev, char *path,
</a><a href="#h14-8-22" id="h14-8-22" class="d">-		    int toggle_ssdiff)
</a><a href="#h14-8-23" id="h14-8-23" class="i">+void cgit_diff_link(const char *name, const char *title, const char *class,
</a><a href="#h14-8-24" id="h14-8-24" class="i">+		    const char *head, const char *new_rev, const char *old_rev,
</a><a href="#h14-8-25" id="h14-8-25" class="i">+		    const char *path, int toggle_ssdiff)
</a> {
 	char *delim;
 
<a href="#h14-9" id="h14-9" class="h">@@ -384,18 +388,76 @@ void cgit_diff_link(char *name, char *title, char *class, char *head,
</a> 	html(&quot;&lt;/a&gt;&quot;);
 }
 
<a href="#h14-9-3" id="h14-9-3" class="d">-void cgit_patch_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-9-4" id="h14-9-4" class="d">-		     char *rev)
</a><a href="#h14-9-5" id="h14-9-5" class="i">+void cgit_patch_link(const char *name, const char *title, const char *class,
</a><a href="#h14-9-6" id="h14-9-6" class="i">+		     const char *head, const char *rev, const char *path)
</a> {
<a href="#h14-9-8" id="h14-9-8" class="d">-	reporevlink(&quot;patch&quot;, name, title, class, head, rev, NULL);
</a><a href="#h14-9-9" id="h14-9-9" class="i">+	reporevlink(&quot;patch&quot;, name, title, class, head, rev, path);
</a> }
 
<a href="#h14-9-12" id="h14-9-12" class="d">-void cgit_stats_link(char *name, char *title, char *class, char *head,
</a><a href="#h14-9-13" id="h14-9-13" class="d">-		     char *path)
</a><a href="#h14-9-14" id="h14-9-14" class="i">+void cgit_stats_link(const char *name, const char *title, const char *class,
</a><a href="#h14-9-15" id="h14-9-15" class="i">+		     const char *head, const char *path)
</a> {
 	reporevlink(&quot;stats&quot;, name, title, class, head, NULL, path);
 }
 
<a href="#h14-9-20" id="h14-9-20" class="i">+void cgit_self_link(char *name, const char *title, const char *class,
</a><a href="#h14-9-21" id="h14-9-21" class="i">+		    struct cgit_context *ctx)
</a><a href="#h14-9-22" id="h14-9-22" class="i">+{
</a><a href="#h14-9-23" id="h14-9-23" class="i">+	if (!strcmp(ctx-&gt;qry.page, &quot;repolist&quot;))
</a><a href="#h14-9-24" id="h14-9-24" class="i">+		return cgit_index_link(name, title, class, ctx-&gt;qry.search,
</a><a href="#h14-9-25" id="h14-9-25" class="i">+				       ctx-&gt;qry.ofs);
</a><a href="#h14-9-26" id="h14-9-26" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;summary&quot;))
</a><a href="#h14-9-27" id="h14-9-27" class="i">+		return cgit_summary_link(name, title, class, ctx-&gt;qry.head);
</a><a href="#h14-9-28" id="h14-9-28" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;tag&quot;))
</a><a href="#h14-9-29" id="h14-9-29" class="i">+		return cgit_tag_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-30" id="h14-9-30" class="i">+				     ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL);
</a><a href="#h14-9-31" id="h14-9-31" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;tree&quot;))
</a><a href="#h14-9-32" id="h14-9-32" class="i">+		return cgit_tree_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-33" id="h14-9-33" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-34" id="h14-9-34" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-35" id="h14-9-35" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;plain&quot;))
</a><a href="#h14-9-36" id="h14-9-36" class="i">+		return cgit_plain_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-37" id="h14-9-37" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-38" id="h14-9-38" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-39" id="h14-9-39" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;log&quot;))
</a><a href="#h14-9-40" id="h14-9-40" class="i">+		return cgit_log_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-41" id="h14-9-41" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-42" id="h14-9-42" class="i">+				      ctx-&gt;qry.path, ctx-&gt;qry.ofs,
</a><a href="#h14-9-43" id="h14-9-43" class="i">+				      ctx-&gt;qry.grep, ctx-&gt;qry.search,
</a><a href="#h14-9-44" id="h14-9-44" class="i">+				      ctx-&gt;qry.showmsg);
</a><a href="#h14-9-45" id="h14-9-45" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;commit&quot;))
</a><a href="#h14-9-46" id="h14-9-46" class="i">+		return cgit_commit_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-47" id="h14-9-47" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-48" id="h14-9-48" class="i">+				      ctx-&gt;qry.path, 0);
</a><a href="#h14-9-49" id="h14-9-49" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;patch&quot;))
</a><a href="#h14-9-50" id="h14-9-50" class="i">+		return cgit_patch_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-51" id="h14-9-51" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-52" id="h14-9-52" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-53" id="h14-9-53" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;refs&quot;))
</a><a href="#h14-9-54" id="h14-9-54" class="i">+		return cgit_refs_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-55" id="h14-9-55" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-56" id="h14-9-56" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-57" id="h14-9-57" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;snapshot&quot;))
</a><a href="#h14-9-58" id="h14-9-58" class="i">+		return cgit_snapshot_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-59" id="h14-9-59" class="i">+				      ctx-&gt;qry.has_sha1 ? ctx-&gt;qry.sha1 : NULL,
</a><a href="#h14-9-60" id="h14-9-60" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-61" id="h14-9-61" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;diff&quot;))
</a><a href="#h14-9-62" id="h14-9-62" class="i">+		return cgit_diff_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-63" id="h14-9-63" class="i">+				      ctx-&gt;qry.sha1, ctx-&gt;qry.sha2,
</a><a href="#h14-9-64" id="h14-9-64" class="i">+				      ctx-&gt;qry.path, 0);
</a><a href="#h14-9-65" id="h14-9-65" class="i">+	else if (!strcmp(ctx-&gt;qry.page, &quot;stats&quot;))
</a><a href="#h14-9-66" id="h14-9-66" class="i">+		return cgit_stats_link(name, title, class, ctx-&gt;qry.head,
</a><a href="#h14-9-67" id="h14-9-67" class="i">+				      ctx-&gt;qry.path);
</a><a href="#h14-9-68" id="h14-9-68" class="i">+
</a><a href="#h14-9-69" id="h14-9-69" class="i">+	/* Don&#39;t known how to make link for this page */
</a><a href="#h14-9-70" id="h14-9-70" class="i">+	repolink(title, class, ctx-&gt;qry.page, ctx-&gt;qry.head, ctx-&gt;qry.path);
</a><a href="#h14-9-71" id="h14-9-71" class="i">+	html(&quot;&gt;&lt;!-- cgit_self_link() doesn&#39;t know how to make link for page &#39;&quot;);
</a><a href="#h14-9-72" id="h14-9-72" class="i">+	html_txt(ctx-&gt;qry.page);
</a><a href="#h14-9-73" id="h14-9-73" class="i">+	html(&quot;&#39; --&gt;&quot;);
</a><a href="#h14-9-74" id="h14-9-74" class="i">+	html_txt(name);
</a><a href="#h14-9-75" id="h14-9-75" class="i">+	html(&quot;&lt;/a&gt;&quot;);
</a><a href="#h14-9-76" id="h14-9-76" class="i">+}
</a><a href="#h14-9-77" id="h14-9-77" class="i">+
</a> void cgit_object_link(struct object *obj)
 {
 	char *page, *shortrev, *fullrev, *name;
<a href="#h14-10" id="h14-10" class="h">@@ -405,7 +467,7 @@ void cgit_object_link(struct object *obj)
</a> 	shortrev[10] = &#39;\0&#39;;
 	if (obj-&gt;type == OBJ_COMMIT) {
                 cgit_commit_link(fmt(&quot;commit %s...&quot;, shortrev), NULL, NULL,
<a href="#h14-10-3" id="h14-10-3" class="d">-				 ctx.qry.head, fullrev, 0);
</a><a href="#h14-10-4" id="h14-10-4" class="i">+				 ctx.qry.head, fullrev, NULL, 0);
</a> 		return;
 	} else if (obj-&gt;type == OBJ_TREE)
 		page = &quot;tree&quot;;
<a href="#h14-11" id="h14-11" class="h">@@ -417,7 +479,7 @@ void cgit_object_link(struct object *obj)
</a> 	reporevlink(page, name, NULL, NULL, ctx.qry.head, fullrev, NULL);
 }
 
<a href="#h14-11-3" id="h14-11-3" class="d">-void cgit_print_date(time_t secs, char *format, int local_time)
</a><a href="#h14-11-4" id="h14-11-4" class="i">+void cgit_print_date(time_t secs, const char *format, int local_time)
</a> {
 	char buf[64];
 	struct tm *time;
<a href="#h14-12" id="h14-12" class="h">@@ -432,7 +494,7 @@ void cgit_print_date(time_t secs, char *format, int local_time)
</a> 	html_txt(buf);
 }
 
<a href="#h14-12-3" id="h14-12-3" class="d">-void cgit_print_age(time_t t, time_t max_relative, char *format)
</a><a href="#h14-12-4" id="h14-12-4" class="i">+void cgit_print_age(time_t t, time_t max_relative, const char *format)
</a> {
 	time_t now, secs;
 
<a href="#h14-13" id="h14-13" class="h">@@ -531,7 +593,7 @@ void cgit_print_docstart(struct cgit_context *ctx)
</a> 		html(&quot;&lt;link rel=&#39;alternate&#39; title=&#39;Atom feed&#39; href=&#39;&quot;);
 		html(cgit_httpscheme());
 		html_attr(cgit_hosturl());
<a href="#h14-13-3" id="h14-13-3" class="d">-		html_attr(cgit_fileurl(ctx-&gt;repo-&gt;url, &quot;atom&quot;, ctx-&gt;qry.path,
</a><a href="#h14-13-4" id="h14-13-4" class="i">+		html_attr(cgit_fileurl(ctx-&gt;repo-&gt;url, &quot;atom&quot;, ctx-&gt;qry.vpath,
</a> 				       fmt(&quot;h=%s&quot;, ctx-&gt;qry.head)));
 		html(&quot;&#39; type=&#39;application/atom+xml&#39;/&gt;\n&quot;);
 	}
<a href="#h14-14" id="h14-14" class="h">@@ -611,14 +673,15 @@ int print_archive_ref(const char *refname, const unsigned char *sha1,
</a> 	return 0;
 }
 
<a href="#h14-14-3" id="h14-14-3" class="d">-void cgit_add_hidden_formfields(int incl_head, int incl_search, char *page)
</a><a href="#h14-14-4" id="h14-14-4" class="i">+void cgit_add_hidden_formfields(int incl_head, int incl_search,
</a><a href="#h14-14-5" id="h14-14-5" class="i">+				const char *page)
</a> {
 	char *url;
 
 	if (!ctx.cfg.virtual_root) {
 		url = fmt(&quot;%s/%s&quot;, ctx.qry.repo, page);
<a href="#h14-14-11" id="h14-14-11" class="d">-		if (ctx.qry.path)
</a><a href="#h14-14-12" id="h14-14-12" class="d">-			url = fmt(&quot;%s/%s&quot;, url, ctx.qry.path);
</a><a href="#h14-14-13" id="h14-14-13" class="i">+		if (ctx.qry.vpath)
</a><a href="#h14-14-14" id="h14-14-14" class="i">+			url = fmt(&quot;%s/%s&quot;, url, ctx.qry.vpath);
</a> 		html_hidden(&quot;url&quot;, url);
 	}
 
<a href="#h14-15" id="h14-15" class="h">@@ -641,11 +704,30 @@ void cgit_add_hidden_formfields(int incl_head, int incl_search, char *page)
</a> 	}
 }
 
<a href="#h14-15-3" id="h14-15-3" class="d">-const char *fallback_cmd = &quot;repolist&quot;;
</a><a href="#h14-15-4" id="h14-15-4" class="i">+static const char *hc(struct cgit_context *ctx, const char *page)
</a><a href="#h14-15-5" id="h14-15-5" class="i">+{
</a><a href="#h14-15-6" id="h14-15-6" class="i">+	return strcmp(ctx-&gt;qry.page, page) ? NULL : &quot;active&quot;;
</a><a href="#h14-15-7" id="h14-15-7" class="i">+}
</a> 
<a href="#h14-15-9" id="h14-15-9" class="d">-char *hc(struct cgit_cmd *cmd, const char *page)
</a><a href="#h14-15-10" id="h14-15-10" class="i">+static void cgit_print_path_crumbs(struct cgit_context *ctx, char *path)
</a> {
<a href="#h14-15-12" id="h14-15-12" class="d">-	return (strcmp(cmd ? cmd-&gt;name : fallback_cmd, page) ? NULL : &quot;active&quot;);
</a><a href="#h14-15-13" id="h14-15-13" class="i">+	char *old_path = ctx-&gt;qry.path;
</a><a href="#h14-15-14" id="h14-15-14" class="i">+	char *p = path, *q, *end = path + strlen(path);
</a><a href="#h14-15-15" id="h14-15-15" class="i">+
</a><a href="#h14-15-16" id="h14-15-16" class="i">+	ctx-&gt;qry.path = NULL;
</a><a href="#h14-15-17" id="h14-15-17" class="i">+	cgit_self_link(&quot;root&quot;, NULL, NULL, ctx);
</a><a href="#h14-15-18" id="h14-15-18" class="i">+	ctx-&gt;qry.path = p = path;
</a><a href="#h14-15-19" id="h14-15-19" class="i">+	while (p &lt; end) {
</a><a href="#h14-15-20" id="h14-15-20" class="i">+		if (!(q = strchr(p, &#39;/&#39;)))
</a><a href="#h14-15-21" id="h14-15-21" class="i">+			q = end;
</a><a href="#h14-15-22" id="h14-15-22" class="i">+		*q = &#39;\0&#39;;
</a><a href="#h14-15-23" id="h14-15-23" class="i">+		html_txt(&quot;/&quot;);
</a><a href="#h14-15-24" id="h14-15-24" class="i">+		cgit_self_link(p, NULL, NULL, ctx);
</a><a href="#h14-15-25" id="h14-15-25" class="i">+		if (q &lt; end)
</a><a href="#h14-15-26" id="h14-15-26" class="i">+			*q = &#39;/&#39;;
</a><a href="#h14-15-27" id="h14-15-27" class="i">+		p = q + 1;
</a><a href="#h14-15-28" id="h14-15-28" class="i">+	}
</a><a href="#h14-15-29" id="h14-15-29" class="i">+	ctx-&gt;qry.path = old_path;
</a> }
 
 static void print_header(struct cgit_context *ctx)
<a href="#h14-16" id="h14-16" class="h">@@ -697,41 +779,37 @@ static void print_header(struct cgit_context *ctx)
</a> 
 void cgit_print_pageheader(struct cgit_context *ctx)
 {
<a href="#h14-16-3" id="h14-16-3" class="d">-	struct cgit_cmd *cmd = cgit_get_cmd(ctx);
</a><a href="#h14-16-4" id="h14-16-4" class="d">-
</a><a href="#h14-16-5" id="h14-16-5" class="d">-	if (!cmd &amp;&amp; ctx-&gt;repo)
</a><a href="#h14-16-6" id="h14-16-6" class="d">-		fallback_cmd = &quot;summary&quot;;
</a><a href="#h14-16-7" id="h14-16-7" class="d">-
</a> 	html(&quot;&lt;div id=&#39;cgit&#39;&gt;&quot;);
 	if (!ctx-&gt;cfg.noheader)
 		print_header(ctx);
 
 	html(&quot;&lt;table class=&#39;tabs&#39;&gt;&lt;tr&gt;&lt;td&gt;\n&quot;);
 	if (ctx-&gt;repo) {
<a href="#h14-16-14" id="h14-16-14" class="d">-		cgit_summary_link(&quot;summary&quot;, NULL, hc(cmd, &quot;summary&quot;),
</a><a href="#h14-16-15" id="h14-16-15" class="i">+		cgit_summary_link(&quot;summary&quot;, NULL, hc(ctx, &quot;summary&quot;),
</a> 				  ctx-&gt;qry.head);
<a href="#h14-16-17" id="h14-16-17" class="d">-		cgit_refs_link(&quot;refs&quot;, NULL, hc(cmd, &quot;refs&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-18" id="h14-16-18" class="d">-			       ctx-&gt;qry.sha1, NULL);
</a><a href="#h14-16-19" id="h14-16-19" class="d">-		cgit_log_link(&quot;log&quot;, NULL, hc(cmd, &quot;log&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-20" id="h14-16-20" class="d">-			      NULL, NULL, 0, NULL, NULL, ctx-&gt;qry.showmsg);
</a><a href="#h14-16-21" id="h14-16-21" class="d">-		cgit_tree_link(&quot;tree&quot;, NULL, hc(cmd, &quot;tree&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-22" id="h14-16-22" class="i">+		cgit_refs_link(&quot;refs&quot;, NULL, hc(ctx, &quot;refs&quot;), ctx-&gt;qry.head,
</a> 			       ctx-&gt;qry.sha1, NULL);
<a href="#h14-16-24" id="h14-16-24" class="d">-		cgit_commit_link(&quot;commit&quot;, NULL, hc(cmd, &quot;commit&quot;),
</a><a href="#h14-16-25" id="h14-16-25" class="d">-				 ctx-&gt;qry.head, ctx-&gt;qry.sha1, 0);
</a><a href="#h14-16-26" id="h14-16-26" class="d">-		cgit_diff_link(&quot;diff&quot;, NULL, hc(cmd, &quot;diff&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-27" id="h14-16-27" class="d">-			       ctx-&gt;qry.sha1, ctx-&gt;qry.sha2, NULL, 0);
</a><a href="#h14-16-28" id="h14-16-28" class="i">+		cgit_log_link(&quot;log&quot;, NULL, hc(ctx, &quot;log&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-29" id="h14-16-29" class="i">+			      NULL, ctx-&gt;qry.vpath, 0, NULL, NULL,
</a><a href="#h14-16-30" id="h14-16-30" class="i">+			      ctx-&gt;qry.showmsg);
</a><a href="#h14-16-31" id="h14-16-31" class="i">+		cgit_tree_link(&quot;tree&quot;, NULL, hc(ctx, &quot;tree&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-32" id="h14-16-32" class="i">+			       ctx-&gt;qry.sha1, ctx-&gt;qry.vpath);
</a><a href="#h14-16-33" id="h14-16-33" class="i">+		cgit_commit_link(&quot;commit&quot;, NULL, hc(ctx, &quot;commit&quot;),
</a><a href="#h14-16-34" id="h14-16-34" class="i">+				 ctx-&gt;qry.head, ctx-&gt;qry.sha1, ctx-&gt;qry.vpath, 0);
</a><a href="#h14-16-35" id="h14-16-35" class="i">+		cgit_diff_link(&quot;diff&quot;, NULL, hc(ctx, &quot;diff&quot;), ctx-&gt;qry.head,
</a><a href="#h14-16-36" id="h14-16-36" class="i">+			       ctx-&gt;qry.sha1, ctx-&gt;qry.sha2, ctx-&gt;qry.vpath, 0);
</a> 		if (ctx-&gt;repo-&gt;max_stats)
<a href="#h14-16-38" id="h14-16-38" class="d">-			cgit_stats_link(&quot;stats&quot;, NULL, hc(cmd, &quot;stats&quot;),
</a><a href="#h14-16-39" id="h14-16-39" class="d">-					ctx-&gt;qry.head, NULL);
</a><a href="#h14-16-40" id="h14-16-40" class="i">+			cgit_stats_link(&quot;stats&quot;, NULL, hc(ctx, &quot;stats&quot;),
</a><a href="#h14-16-41" id="h14-16-41" class="i">+					ctx-&gt;qry.head, ctx-&gt;qry.vpath);
</a> 		if (ctx-&gt;repo-&gt;readme)
 			reporevlink(&quot;about&quot;, &quot;about&quot;, NULL,
<a href="#h14-16-44" id="h14-16-44" class="d">-				    hc(cmd, &quot;about&quot;), ctx-&gt;qry.head, NULL,
</a><a href="#h14-16-45" id="h14-16-45" class="i">+				    hc(ctx, &quot;about&quot;), ctx-&gt;qry.head, NULL,
</a> 				    NULL);
 		html(&quot;&lt;/td&gt;&lt;td class=&#39;form&#39;&gt;&quot;);
 		html(&quot;&lt;form class=&#39;right&#39; method=&#39;get&#39; action=&#39;&quot;);
 		if (ctx-&gt;cfg.virtual_root)
 			html_url_path(cgit_fileurl(ctx-&gt;qry.repo, &quot;log&quot;,
<a href="#h14-16-51" id="h14-16-51" class="d">-						   ctx-&gt;qry.path, NULL));
</a><a href="#h14-16-52" id="h14-16-52" class="i">+						   ctx-&gt;qry.vpath, NULL));
</a> 		html(&quot;&#39;&gt;\n&quot;);
 		cgit_add_hidden_formfields(1, 0, &quot;log&quot;);
 		html(&quot;&lt;select name=&#39;qt&#39;&gt;\n&quot;);
<a href="#h14-17" id="h14-17" class="h">@@ -745,9 +823,9 @@ void cgit_print_pageheader(struct cgit_context *ctx)
</a> 		html(&quot;&lt;input type=&#39;submit&#39; value=&#39;search&#39;/&gt;\n&quot;);
 		html(&quot;&lt;/form&gt;\n&quot;);
 	} else {
<a href="#h14-17-3" id="h14-17-3" class="d">-		site_link(NULL, &quot;index&quot;, NULL, hc(cmd, &quot;repolist&quot;), NULL, 0);
</a><a href="#h14-17-4" id="h14-17-4" class="i">+		site_link(NULL, &quot;index&quot;, NULL, hc(ctx, &quot;repolist&quot;), NULL, 0);
</a> 		if (ctx-&gt;cfg.root_readme)
<a href="#h14-17-6" id="h14-17-6" class="d">-			site_link(&quot;about&quot;, &quot;about&quot;, NULL, hc(cmd, &quot;about&quot;),
</a><a href="#h14-17-7" id="h14-17-7" class="i">+			site_link(&quot;about&quot;, &quot;about&quot;, NULL, hc(ctx, &quot;about&quot;),
</a> 				  NULL, 0);
 		html(&quot;&lt;/td&gt;&lt;td class=&#39;form&#39;&gt;&quot;);
 		html(&quot;&lt;form method=&#39;get&#39; action=&#39;&quot;);
<a href="#h14-18" id="h14-18" class="h">@@ -760,6 +838,12 @@ void cgit_print_pageheader(struct cgit_context *ctx)
</a> 		html(&quot;&lt;/form&gt;&quot;);
 	}
 	html(&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n&quot;);
<a href="#h14-18-3" id="h14-18-3" class="i">+	if (ctx-&gt;qry.vpath) {
</a><a href="#h14-18-4" id="h14-18-4" class="i">+		html(&quot;&lt;div class=&#39;path&#39;&gt;&quot;);
</a><a href="#h14-18-5" id="h14-18-5" class="i">+		html(&quot;path: &quot;);
</a><a href="#h14-18-6" id="h14-18-6" class="i">+		cgit_print_path_crumbs(ctx, ctx-&gt;qry.vpath);
</a><a href="#h14-18-7" id="h14-18-7" class="i">+		html(&quot;&lt;/div&gt;&quot;);
</a><a href="#h14-18-8" id="h14-18-8" class="i">+	}
</a> 	html(&quot;&lt;div class=&#39;content&#39;&gt;&quot;);
 }
 
<b>diff --git a/<a id="h15" href="../file/ui-shared.h.html">ui-shared.h</a> b/<a href="../file/ui-shared.h.html">ui-shared.h</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -10,36 +10,50 @@ extern char *cgit_fileurl(const char *reponame, const char *pagename,
</a> extern char *cgit_pageurl(const char *reponame, const char *pagename,
 			  const char *query);
 
<a href="#h15-0-3" id="h15-0-3" class="d">-extern void cgit_index_link(char *name, char *title, char *class,
</a><a href="#h15-0-4" id="h15-0-4" class="d">-			    char *pattern, int ofs);
</a><a href="#h15-0-5" id="h15-0-5" class="d">-extern void cgit_summary_link(char *name, char *title, char *class, char *head);
</a><a href="#h15-0-6" id="h15-0-6" class="d">-extern void cgit_tag_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-7" id="h15-0-7" class="d">-			  char *rev);
</a><a href="#h15-0-8" id="h15-0-8" class="d">-extern void cgit_tree_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-9" id="h15-0-9" class="d">-			   char *rev, char *path);
</a><a href="#h15-0-10" id="h15-0-10" class="d">-extern void cgit_plain_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-11" id="h15-0-11" class="d">-			    char *rev, char *path);
</a><a href="#h15-0-12" id="h15-0-12" class="d">-extern void cgit_log_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-13" id="h15-0-13" class="d">-			  char *rev, char *path, int ofs, char *grep,
</a><a href="#h15-0-14" id="h15-0-14" class="d">-			  char *pattern, int showmsg);
</a><a href="#h15-0-15" id="h15-0-15" class="d">-extern void cgit_commit_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-16" id="h15-0-16" class="d">-			     char *rev, int toggle_ssdiff);
</a><a href="#h15-0-17" id="h15-0-17" class="d">-extern void cgit_patch_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-18" id="h15-0-18" class="d">-			    char *rev);
</a><a href="#h15-0-19" id="h15-0-19" class="d">-extern void cgit_refs_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-20" id="h15-0-20" class="d">-			   char *rev, char *path);
</a><a href="#h15-0-21" id="h15-0-21" class="d">-extern void cgit_snapshot_link(char *name, char *title, char *class,
</a><a href="#h15-0-22" id="h15-0-22" class="d">-			       char *head, char *rev, char *archivename);
</a><a href="#h15-0-23" id="h15-0-23" class="d">-extern void cgit_diff_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-24" id="h15-0-24" class="d">-			   char *new_rev, char *old_rev, char *path,
</a><a href="#h15-0-25" id="h15-0-25" class="d">-			   int toggle_ssdiff);
</a><a href="#h15-0-26" id="h15-0-26" class="d">-extern void cgit_stats_link(char *name, char *title, char *class, char *head,
</a><a href="#h15-0-27" id="h15-0-27" class="d">-			    char *path);
</a><a href="#h15-0-28" id="h15-0-28" class="i">+extern void cgit_index_link(const char *name, const char *title,
</a><a href="#h15-0-29" id="h15-0-29" class="i">+			    const char *class, const char *pattern, int ofs);
</a><a href="#h15-0-30" id="h15-0-30" class="i">+extern void cgit_summary_link(const char *name, const char *title,
</a><a href="#h15-0-31" id="h15-0-31" class="i">+			      const char *class, const char *head);
</a><a href="#h15-0-32" id="h15-0-32" class="i">+extern void cgit_tag_link(const char *name, const char *title,
</a><a href="#h15-0-33" id="h15-0-33" class="i">+			  const char *class, const char *head,
</a><a href="#h15-0-34" id="h15-0-34" class="i">+			  const char *rev);
</a><a href="#h15-0-35" id="h15-0-35" class="i">+extern void cgit_tree_link(const char *name, const char *title,
</a><a href="#h15-0-36" id="h15-0-36" class="i">+			   const char *class, const char *head,
</a><a href="#h15-0-37" id="h15-0-37" class="i">+			   const char *rev, const char *path);
</a><a href="#h15-0-38" id="h15-0-38" class="i">+extern void cgit_plain_link(const char *name, const char *title,
</a><a href="#h15-0-39" id="h15-0-39" class="i">+			    const char *class, const char *head,
</a><a href="#h15-0-40" id="h15-0-40" class="i">+			    const char *rev, const char *path);
</a><a href="#h15-0-41" id="h15-0-41" class="i">+extern void cgit_log_link(const char *name, const char *title,
</a><a href="#h15-0-42" id="h15-0-42" class="i">+			  const char *class, const char *head, const char *rev,
</a><a href="#h15-0-43" id="h15-0-43" class="i">+			  const char *path, int ofs, const char *grep,
</a><a href="#h15-0-44" id="h15-0-44" class="i">+			  const char *pattern, int showmsg);
</a><a href="#h15-0-45" id="h15-0-45" class="i">+extern void cgit_commit_link(char *name, const char *title,
</a><a href="#h15-0-46" id="h15-0-46" class="i">+			     const char *class, const char *head,
</a><a href="#h15-0-47" id="h15-0-47" class="i">+			     const char *rev, const char *path,
</a><a href="#h15-0-48" id="h15-0-48" class="i">+			     int toggle_ssdiff);
</a><a href="#h15-0-49" id="h15-0-49" class="i">+extern void cgit_patch_link(const char *name, const char *title,
</a><a href="#h15-0-50" id="h15-0-50" class="i">+			    const char *class, const char *head,
</a><a href="#h15-0-51" id="h15-0-51" class="i">+			    const char *rev, const char *path);
</a><a href="#h15-0-52" id="h15-0-52" class="i">+extern void cgit_refs_link(const char *name, const char *title,
</a><a href="#h15-0-53" id="h15-0-53" class="i">+			   const char *class, const char *head,
</a><a href="#h15-0-54" id="h15-0-54" class="i">+			   const char *rev, const char *path);
</a><a href="#h15-0-55" id="h15-0-55" class="i">+extern void cgit_snapshot_link(const char *name, const char *title,
</a><a href="#h15-0-56" id="h15-0-56" class="i">+			       const char *class, const char *head,
</a><a href="#h15-0-57" id="h15-0-57" class="i">+			       const char *rev, const char *archivename);
</a><a href="#h15-0-58" id="h15-0-58" class="i">+extern void cgit_diff_link(const char *name, const char *title,
</a><a href="#h15-0-59" id="h15-0-59" class="i">+			   const char *class, const char *head,
</a><a href="#h15-0-60" id="h15-0-60" class="i">+			   const char *new_rev, const char *old_rev,
</a><a href="#h15-0-61" id="h15-0-61" class="i">+			   const char *path, int toggle_ssdiff);
</a><a href="#h15-0-62" id="h15-0-62" class="i">+extern void cgit_stats_link(const char *name, const char *title,
</a><a href="#h15-0-63" id="h15-0-63" class="i">+			    const char *class, const char *head,
</a><a href="#h15-0-64" id="h15-0-64" class="i">+			    const char *path);
</a><a href="#h15-0-65" id="h15-0-65" class="i">+extern void cgit_self_link(char *name, const char *title,
</a><a href="#h15-0-66" id="h15-0-66" class="i">+			   const char *class, struct cgit_context *ctx);
</a> extern void cgit_object_link(struct object *obj);
 
<a href="#h15-0-69" id="h15-0-69" class="d">-extern void cgit_print_error(char *msg);
</a><a href="#h15-0-70" id="h15-0-70" class="d">-extern void cgit_print_date(time_t secs, char *format, int local_time);
</a><a href="#h15-0-71" id="h15-0-71" class="d">-extern void cgit_print_age(time_t t, time_t max_relative, char *format);
</a><a href="#h15-0-72" id="h15-0-72" class="i">+extern void cgit_print_error(const char *msg);
</a><a href="#h15-0-73" id="h15-0-73" class="i">+extern void cgit_print_date(time_t secs, const char *format, int local_time);
</a><a href="#h15-0-74" id="h15-0-74" class="i">+extern void cgit_print_age(time_t t, time_t max_relative, const char *format);
</a> extern void cgit_print_http_headers(struct cgit_context *ctx);
 extern void cgit_print_docstart(struct cgit_context *ctx);
 extern void cgit_print_docend();
<a href="#h15-1" id="h15-1" class="h">@@ -48,5 +62,5 @@ extern void cgit_print_filemode(unsigned short mode);
</a> extern void cgit_print_snapshot_links(const char *repo, const char *head,
 				      const char *hex, int snapshots);
 extern void cgit_add_hidden_formfields(int incl_head, int incl_search,
<a href="#h15-1-3" id="h15-1-3" class="d">-				       char *page);
</a><a href="#h15-1-4" id="h15-1-4" class="i">+				       const char *page);
</a> #endif /* UI_SHARED_H */
<b>diff --git a/<a id="h16" href="../file/ui-tree.c.html">ui-tree.c</a> b/<a href="../file/ui-tree.c.html">ui-tree.c</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -102,10 +102,10 @@ static void print_object(const unsigned char *sha1, char *path, const char *base
</a> 		return;
 	}
 
<a href="#h16-0-3" id="h16-0-3" class="d">-	html(&quot; (&quot;);
</a><a href="#h16-0-4" id="h16-0-4" class="i">+	htmlf(&quot;blob: %s (&quot;, sha1_to_hex(sha1));
</a> 	cgit_plain_link(&quot;plain&quot;, NULL, NULL, ctx.qry.head,
 		        curr_rev, path);
<a href="#h16-0-7" id="h16-0-7" class="d">-	htmlf(&quot;)&lt;br/&gt;blob: %s\n&quot;, sha1_to_hex(sha1));
</a><a href="#h16-0-8" id="h16-0-8" class="i">+	html(&quot;)\n&quot;);
</a> 
 	if (ctx.cfg.max_blob_size &amp;&amp; size / 1024 &gt; ctx.cfg.max_blob_size) {
 		htmlf(&quot;&lt;div class=&#39;error&#39;&gt;blob size (%dKB) exceeds display size limit (%dKB).&lt;/div&gt;&quot;,
<a href="#h16-1" id="h16-1" class="h">@@ -225,17 +225,10 @@ static int walk_tree(const unsigned char *sha1, const char *base, int baselen,
</a> {
 	static int state;
 	static char buffer[PATH_MAX];
<a href="#h16-1-3" id="h16-1-3" class="d">-	char *url;
</a> 
 	if (state == 0) {
 		memcpy(buffer, base, baselen);
 		strcpy(buffer+baselen, pathname);
<a href="#h16-1-8" id="h16-1-8" class="d">-		url = cgit_pageurl(ctx.qry.repo, &quot;tree&quot;,
</a><a href="#h16-1-9" id="h16-1-9" class="d">-				   fmt(&quot;h=%s&amp;amp;path=%s&quot;, curr_rev, buffer));
</a><a href="#h16-1-10" id="h16-1-10" class="d">-		html(&quot;/&quot;);
</a><a href="#h16-1-11" id="h16-1-11" class="d">-		cgit_tree_link(xstrdup(pathname), NULL, NULL, ctx.qry.head,
</a><a href="#h16-1-12" id="h16-1-12" class="d">-			       curr_rev, buffer);
</a><a href="#h16-1-13" id="h16-1-13" class="d">-
</a> 		if (strcmp(match_path, buffer))
 			return READ_TREE_RECURSIVE;
 
<a href="#h16-2" id="h16-2" class="h">@@ -278,10 +271,6 @@ void cgit_print_tree(const char *rev, char *path)
</a> 		return;
 	}
 
<a href="#h16-2-3" id="h16-2-3" class="d">-	html(&quot;path: &lt;a href=&#39;&quot;);
</a><a href="#h16-2-4" id="h16-2-4" class="d">-	html_attr(cgit_pageurl(ctx.qry.repo, &quot;tree&quot;, fmt(&quot;h=%s&quot;, rev)));
</a><a href="#h16-2-5" id="h16-2-5" class="d">-	html(&quot;&#39;&gt;root&lt;/a&gt;&quot;);
</a><a href="#h16-2-6" id="h16-2-6" class="d">-
</a> 	if (path == NULL) {
 		ls_tree(commit-&gt;tree-&gt;object.sha1, NULL);
 		return;
</pre>
</div>
</body>
</html>
